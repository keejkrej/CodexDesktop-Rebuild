"use strict";var hD=Object.create;var JS=Object.defineProperty;var SD=Object.getOwnPropertyDescriptor;var mD=Object.getOwnPropertyNames;var AD=Object.getPrototypeOf,gD=Object.prototype.hasOwnProperty;var RD=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of mD(t))!gD.call(e,o)&&o!==n&&JS(e,o,{get:()=>t[o],enumerable:!(r=SD(t,o))||r.enumerable});return e};var Yl=(e,t,n)=>(n=e!=null?hD(AD(e)):{},RD(t||!e||!e.__esModule?JS(n,"default",{value:e,enumerable:!0}):n,e));const Ku=require("node:worker_threads"),Ec=require("path"),qo=require("node:os"),le=require("node:path"),zu=require("events"),zp=require("child_process"),de=require("node:fs"),nc=require("node:crypto"),Tc=require("node:child_process"),wn=require("node:buffer"),ND=require("path/posix"),em=require("node:string_decoder"),Wo=require("node:util"),yD=require("node:net");require("crypto");const kI=require("node:fs/promises"),OD=require("perf_hooks"),Zr=require("util"),Zu=require("url"),GI=require("module"),VI=require("tty"),bD=require("os"),tp=require("worker_threads"),ID=require("fs"),hn=require("node:diagnostics_channel"),CD=require("node:events"),xI=require("diagnostics_channel"),$I=require("async_hooks"),MD=require("node:readline"),PD=require("node:http"),vD=require("node:https"),LD=require("node:stream"),DD=require("node:zlib"),wD=require("node:tls");var jl=typeof document<"u"?document.currentScript:null;function un(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const n in e)if(n!=="default"){const r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:()=>e[n]})}}return t.default=e,Object.freeze(t)}const qr=un(Ec),Lt=un(qo),BI=un(le),UD=un(Wo),Ro=un(yD),kD=un(GI),ou=un(hn),ql=un(xI),su=un(PD),GD=un(vD),tm=un(wD);var np=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zp(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function HI(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var n=function r(){var o=!1;try{o=this instanceof r}catch{}return o?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var o=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,o.get?o:{enumerable:!0,get:function(){return e[r]}})}),n}var Wl={},lr={},yi={},Oi={},bn={},dr={},fr={},bi={},nm;function VD(){return nm||(nm=1,Object.defineProperty(bi,"__esModule",{value:!0}),bi._globalThis=void 0,bi._globalThis=typeof globalThis=="object"?globalThis:np),bi}var rm;function xD(){return rm||(rm=1,(function(e){var t=fr&&fr.__createBinding||(Object.create?(function(r,o,s,i){i===void 0&&(i=s),Object.defineProperty(r,i,{enumerable:!0,get:function(){return o[s]}})}):(function(r,o,s,i){i===void 0&&(i=s),r[i]=o[s]})),n=fr&&fr.__exportStar||function(r,o){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(o,s)&&t(o,r,s)};Object.defineProperty(e,"__esModule",{value:!0}),n(VD(),e)})(fr)),fr}var om;function $D(){return om||(om=1,(function(e){var t=dr&&dr.__createBinding||(Object.create?(function(r,o,s,i){i===void 0&&(i=s),Object.defineProperty(r,i,{enumerable:!0,get:function(){return o[s]}})}):(function(r,o,s,i){i===void 0&&(i=s),r[i]=o[s]})),n=dr&&dr.__exportStar||function(r,o){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(o,s)&&t(o,r,s)};Object.defineProperty(e,"__esModule",{value:!0}),n(xD(),e)})(dr)),dr}var Ii={},sm;function FI(){return sm||(sm=1,Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.VERSION=void 0,Ii.VERSION="1.9.0"),Ii}var _r={},im;function BD(){if(im)return _r;im=1,Object.defineProperty(_r,"__esModule",{value:!0}),_r.isCompatible=_r._makeCompatibilityCheck=void 0;const e=FI(),t=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function n(r){const o=new Set([r]),s=new Set,i=r.match(t);if(!i)return()=>!1;const a={major:+i[1],minor:+i[2],patch:+i[3],prerelease:i[4]};if(a.prerelease!=null)return function(d){return d===r};function c(f){return s.add(f),!1}function l(f){return o.add(f),!0}return function(d){if(o.has(d))return!0;if(s.has(d))return!1;const u=d.match(t);if(!u)return c(d);const _={major:+u[1],minor:+u[2],patch:+u[3],prerelease:u[4]};return _.prerelease!=null||a.major!==_.major?c(d):a.major===0?a.minor===_.minor&&a.patch<=_.patch?l(d):c(d):a.minor<=_.minor?l(d):c(d)}}return _r._makeCompatibilityCheck=n,_r.isCompatible=n(e.VERSION),_r}var am;function Ko(){if(am)return bn;am=1,Object.defineProperty(bn,"__esModule",{value:!0}),bn.unregisterGlobal=bn.getGlobal=bn.registerGlobal=void 0;const e=$D(),t=FI(),n=BD(),r=t.VERSION.split(".")[0],o=Symbol.for(`opentelemetry.js.api.${r}`),s=e._globalThis;function i(l,f,d,u=!1){var _;const p=s[o]=(_=s[o])!==null&&_!==void 0?_:{version:t.VERSION};if(!u&&p[l]){const E=new Error(`@opentelemetry/api: Attempted duplicate registration of API: ${l}`);return d.error(E.stack||E.message),!1}if(p.version!==t.VERSION){const E=new Error(`@opentelemetry/api: Registration of version v${p.version} for ${l} does not match previously registered API v${t.VERSION}`);return d.error(E.stack||E.message),!1}return p[l]=f,d.debug(`@opentelemetry/api: Registered a global for ${l} v${t.VERSION}.`),!0}bn.registerGlobal=i;function a(l){var f,d;const u=(f=s[o])===null||f===void 0?void 0:f.version;if(!(!u||!(0,n.isCompatible)(u)))return(d=s[o])===null||d===void 0?void 0:d[l]}bn.getGlobal=a;function c(l,f){f.debug(`@opentelemetry/api: Unregistering a global for ${l} v${t.VERSION}.`);const d=s[o];d&&delete d[l]}return bn.unregisterGlobal=c,bn}var cm;function HD(){if(cm)return Oi;cm=1,Object.defineProperty(Oi,"__esModule",{value:!0}),Oi.DiagComponentLogger=void 0;const e=Ko();class t{constructor(o){this._namespace=o.namespace||"DiagComponentLogger"}debug(...o){return n("debug",this._namespace,o)}error(...o){return n("error",this._namespace,o)}info(...o){return n("info",this._namespace,o)}warn(...o){return n("warn",this._namespace,o)}verbose(...o){return n("verbose",this._namespace,o)}}Oi.DiagComponentLogger=t;function n(r,o,s){const i=(0,e.getGlobal)("diag");if(i)return s.unshift(o),i[r](...s)}return Oi}var Ci={},Kl={},um;function Xp(){return um||(um=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DiagLogLevel=void 0,(function(t){t[t.NONE=0]="NONE",t[t.ERROR=30]="ERROR",t[t.WARN=50]="WARN",t[t.INFO=60]="INFO",t[t.DEBUG=70]="DEBUG",t[t.VERBOSE=80]="VERBOSE",t[t.ALL=9999]="ALL"})(e.DiagLogLevel||(e.DiagLogLevel={}))})(Kl)),Kl}var lm;function FD(){if(lm)return Ci;lm=1,Object.defineProperty(Ci,"__esModule",{value:!0}),Ci.createLogLevelDiagLogger=void 0;const e=Xp();function t(n,r){n<e.DiagLogLevel.NONE?n=e.DiagLogLevel.NONE:n>e.DiagLogLevel.ALL&&(n=e.DiagLogLevel.ALL),r=r||{};function o(s,i){const a=r[s];return typeof a=="function"&&n>=i?a.bind(r):function(){}}return{error:o("error",e.DiagLogLevel.ERROR),warn:o("warn",e.DiagLogLevel.WARN),info:o("info",e.DiagLogLevel.INFO),debug:o("debug",e.DiagLogLevel.DEBUG),verbose:o("verbose",e.DiagLogLevel.VERBOSE)}}return Ci.createLogLevelDiagLogger=t,Ci}var dm;function zo(){if(dm)return yi;dm=1,Object.defineProperty(yi,"__esModule",{value:!0}),yi.DiagAPI=void 0;const e=HD(),t=FD(),n=Xp(),r=Ko(),o="diag";class s{constructor(){function a(f){return function(...d){const u=(0,r.getGlobal)("diag");if(u)return u[f](...d)}}const c=this,l=(f,d={logLevel:n.DiagLogLevel.INFO})=>{var u,_,p;if(f===c){const h=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return c.error((u=h.stack)!==null&&u!==void 0?u:h.message),!1}typeof d=="number"&&(d={logLevel:d});const E=(0,r.getGlobal)("diag"),T=(0,t.createLogLevelDiagLogger)((_=d.logLevel)!==null&&_!==void 0?_:n.DiagLogLevel.INFO,f);if(E&&!d.suppressOverrideMessage){const h=(p=new Error().stack)!==null&&p!==void 0?p:"<failed to generate stacktrace>";E.warn(`Current logger will be overwritten from ${h}`),T.warn(`Current logger will overwrite one already registered from ${h}`)}return(0,r.registerGlobal)("diag",T,c,!0)};c.setLogger=l,c.disable=()=>{(0,r.unregisterGlobal)(o,c)},c.createComponentLogger=f=>new e.DiagComponentLogger(f),c.verbose=a("verbose"),c.debug=a("debug"),c.info=a("info"),c.warn=a("warn"),c.error=a("error")}static instance(){return this._instance||(this._instance=new s),this._instance}}return yi.DiagAPI=s,yi}var Mi={},fm;function YD(){if(fm)return Mi;fm=1,Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.BaggageImpl=void 0;class e{constructor(n){this._entries=n?new Map(n):new Map}getEntry(n){const r=this._entries.get(n);if(r)return Object.assign({},r)}getAllEntries(){return Array.from(this._entries.entries()).map(([n,r])=>[n,r])}setEntry(n,r){const o=new e(this._entries);return o._entries.set(n,r),o}removeEntry(n){const r=new e(this._entries);return r._entries.delete(n),r}removeEntries(...n){const r=new e(this._entries);for(const o of n)r._entries.delete(o);return r}clear(){return new e}}return Mi.BaggageImpl=e,Mi}var Pi={},_m;function jD(){return _m||(_m=1,Object.defineProperty(Pi,"__esModule",{value:!0}),Pi.baggageEntryMetadataSymbol=void 0,Pi.baggageEntryMetadataSymbol=Symbol("BaggageEntryMetadata")),Pi}var pm;function YI(){if(pm)return lr;pm=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.baggageEntryMetadataFromString=lr.createBaggage=void 0;const e=zo(),t=YD(),n=jD(),r=e.DiagAPI.instance();function o(i={}){return new t.BaggageImpl(new Map(Object.entries(i)))}lr.createBaggage=o;function s(i){return typeof i!="string"&&(r.error(`Cannot create baggage metadata from unknown type: ${typeof i}`),i=""),{__TYPE__:n.baggageEntryMetadataSymbol,toString(){return i}}}return lr.baggageEntryMetadataFromString=s,lr}var pr={},Em;function Xu(){if(Em)return pr;Em=1,Object.defineProperty(pr,"__esModule",{value:!0}),pr.ROOT_CONTEXT=pr.createContextKey=void 0;function e(n){return Symbol.for(n)}pr.createContextKey=e;class t{constructor(r){const o=this;o._currentContext=r?new Map(r):new Map,o.getValue=s=>o._currentContext.get(s),o.setValue=(s,i)=>{const a=new t(o._currentContext);return a._currentContext.set(s,i),a},o.deleteValue=s=>{const i=new t(o._currentContext);return i._currentContext.delete(s),i}}}return pr.ROOT_CONTEXT=new t,pr}var vi={},Tm;function qD(){if(Tm)return vi;Tm=1,Object.defineProperty(vi,"__esModule",{value:!0}),vi.DiagConsoleLogger=void 0;const e=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}];class t{constructor(){function r(o){return function(...s){if(console){let i=console[o];if(typeof i!="function"&&(i=console.log),typeof i=="function")return i.apply(console,s)}}}for(let o=0;o<e.length;o++)this[e[o].n]=r(e[o].c)}}return vi.DiagConsoleLogger=t,vi}var zl={},hm;function jI(){return hm||(hm=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createNoopMeter=e.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC=e.NOOP_OBSERVABLE_GAUGE_METRIC=e.NOOP_OBSERVABLE_COUNTER_METRIC=e.NOOP_UP_DOWN_COUNTER_METRIC=e.NOOP_HISTOGRAM_METRIC=e.NOOP_GAUGE_METRIC=e.NOOP_COUNTER_METRIC=e.NOOP_METER=e.NoopObservableUpDownCounterMetric=e.NoopObservableGaugeMetric=e.NoopObservableCounterMetric=e.NoopObservableMetric=e.NoopHistogramMetric=e.NoopGaugeMetric=e.NoopUpDownCounterMetric=e.NoopCounterMetric=e.NoopMetric=e.NoopMeter=void 0;class t{constructor(){}createGauge(_,p){return e.NOOP_GAUGE_METRIC}createHistogram(_,p){return e.NOOP_HISTOGRAM_METRIC}createCounter(_,p){return e.NOOP_COUNTER_METRIC}createUpDownCounter(_,p){return e.NOOP_UP_DOWN_COUNTER_METRIC}createObservableGauge(_,p){return e.NOOP_OBSERVABLE_GAUGE_METRIC}createObservableCounter(_,p){return e.NOOP_OBSERVABLE_COUNTER_METRIC}createObservableUpDownCounter(_,p){return e.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC}addBatchObservableCallback(_,p){}removeBatchObservableCallback(_){}}e.NoopMeter=t;class n{}e.NoopMetric=n;class r extends n{add(_,p){}}e.NoopCounterMetric=r;class o extends n{add(_,p){}}e.NoopUpDownCounterMetric=o;class s extends n{record(_,p){}}e.NoopGaugeMetric=s;class i extends n{record(_,p){}}e.NoopHistogramMetric=i;class a{addCallback(_){}removeCallback(_){}}e.NoopObservableMetric=a;class c extends a{}e.NoopObservableCounterMetric=c;class l extends a{}e.NoopObservableGaugeMetric=l;class f extends a{}e.NoopObservableUpDownCounterMetric=f,e.NOOP_METER=new t,e.NOOP_COUNTER_METRIC=new r,e.NOOP_GAUGE_METRIC=new s,e.NOOP_HISTOGRAM_METRIC=new i,e.NOOP_UP_DOWN_COUNTER_METRIC=new o,e.NOOP_OBSERVABLE_COUNTER_METRIC=new c,e.NOOP_OBSERVABLE_GAUGE_METRIC=new l,e.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC=new f;function d(){return e.NOOP_METER}e.createNoopMeter=d})(zl)),zl}var Zl={},Sm;function WD(){return Sm||(Sm=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ValueType=void 0,(function(t){t[t.INT=0]="INT",t[t.DOUBLE=1]="DOUBLE"})(e.ValueType||(e.ValueType={}))})(Zl)),Zl}var Er={},mm;function qI(){return mm||(mm=1,Object.defineProperty(Er,"__esModule",{value:!0}),Er.defaultTextMapSetter=Er.defaultTextMapGetter=void 0,Er.defaultTextMapGetter={get(e,t){if(e!=null)return e[t]},keys(e){return e==null?[]:Object.keys(e)}},Er.defaultTextMapSetter={set(e,t,n){e!=null&&(e[t]=n)}}),Er}var Li={},Di={},wi={},Ui={},Am;function KD(){if(Am)return Ui;Am=1,Object.defineProperty(Ui,"__esModule",{value:!0}),Ui.NoopContextManager=void 0;const e=Xu();let t=class{active(){return e.ROOT_CONTEXT}with(r,o,s,...i){return o.call(s,...i)}bind(r,o){return o}enable(){return this}disable(){return this}};return Ui.NoopContextManager=t,Ui}var gm;function Qu(){if(gm)return wi;gm=1,Object.defineProperty(wi,"__esModule",{value:!0}),wi.ContextAPI=void 0;const e=KD(),t=Ko(),n=zo(),r="context",o=new e.NoopContextManager;class s{constructor(){}static getInstance(){return this._instance||(this._instance=new s),this._instance}setGlobalContextManager(a){return(0,t.registerGlobal)(r,a,n.DiagAPI.instance())}active(){return this._getContextManager().active()}with(a,c,l,...f){return this._getContextManager().with(a,c,l,...f)}bind(a,c){return this._getContextManager().bind(a,c)}_getContextManager(){return(0,t.getGlobal)(r)||o}disable(){this._getContextManager().disable(),(0,t.unregisterGlobal)(r,n.DiagAPI.instance())}}return wi.ContextAPI=s,wi}var pt={},ki={},Xl={},Ql={},Rm;function WI(){return Rm||(Rm=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TraceFlags=void 0,(function(t){t[t.NONE=0]="NONE",t[t.SAMPLED=1]="SAMPLED"})(e.TraceFlags||(e.TraceFlags={}))})(Ql)),Ql}var Nm;function Qp(){return Nm||(Nm=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.INVALID_SPAN_CONTEXT=e.INVALID_TRACEID=e.INVALID_SPANID=void 0;const t=WI();e.INVALID_SPANID="0000000000000000",e.INVALID_TRACEID="00000000000000000000000000000000",e.INVALID_SPAN_CONTEXT={traceId:e.INVALID_TRACEID,spanId:e.INVALID_SPANID,traceFlags:t.TraceFlags.NONE}})(Xl)),Xl}var ym;function Jp(){if(ym)return ki;ym=1,Object.defineProperty(ki,"__esModule",{value:!0}),ki.NonRecordingSpan=void 0;const e=Qp();let t=class{constructor(r=e.INVALID_SPAN_CONTEXT){this._spanContext=r}spanContext(){return this._spanContext}setAttribute(r,o){return this}setAttributes(r){return this}addEvent(r,o){return this}addLink(r){return this}addLinks(r){return this}setStatus(r){return this}updateName(r){return this}end(r){}isRecording(){return!1}recordException(r,o){}};return ki.NonRecordingSpan=t,ki}var Om;function KI(){if(Om)return pt;Om=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.getSpanContext=pt.setSpanContext=pt.deleteSpan=pt.setSpan=pt.getActiveSpan=pt.getSpan=void 0;const e=Xu(),t=Jp(),n=Qu(),r=(0,e.createContextKey)("OpenTelemetry Context Key SPAN");function o(f){return f.getValue(r)||void 0}pt.getSpan=o;function s(){return o(n.ContextAPI.getInstance().active())}pt.getActiveSpan=s;function i(f,d){return f.setValue(r,d)}pt.setSpan=i;function a(f){return f.deleteValue(r)}pt.deleteSpan=a;function c(f,d){return i(f,new t.NonRecordingSpan(d))}pt.setSpanContext=c;function l(f){var d;return(d=o(f))===null||d===void 0?void 0:d.spanContext()}return pt.getSpanContext=l,pt}var Zt={},bm;function eE(){if(bm)return Zt;bm=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.wrapSpanContext=Zt.isSpanContextValid=Zt.isValidSpanId=Zt.isValidTraceId=void 0;const e=Qp(),t=Jp(),n=/^([0-9a-f]{32})$/i,r=/^[0-9a-f]{16}$/i;function o(c){return n.test(c)&&c!==e.INVALID_TRACEID}Zt.isValidTraceId=o;function s(c){return r.test(c)&&c!==e.INVALID_SPANID}Zt.isValidSpanId=s;function i(c){return o(c.traceId)&&s(c.spanId)}Zt.isSpanContextValid=i;function a(c){return new t.NonRecordingSpan(c)}return Zt.wrapSpanContext=a,Zt}var Im;function zI(){if(Im)return Di;Im=1,Object.defineProperty(Di,"__esModule",{value:!0}),Di.NoopTracer=void 0;const e=Qu(),t=KI(),n=Jp(),r=eE(),o=e.ContextAPI.getInstance();let s=class{startSpan(c,l,f=o.active()){if(!!l?.root)return new n.NonRecordingSpan;const u=f&&(0,t.getSpanContext)(f);return i(u)&&(0,r.isSpanContextValid)(u)?new n.NonRecordingSpan(u):new n.NonRecordingSpan}startActiveSpan(c,l,f,d){let u,_,p;if(arguments.length<2)return;arguments.length===2?p=l:arguments.length===3?(u=l,p=f):(u=l,_=f,p=d);const E=_??o.active(),T=this.startSpan(c,u,E),h=(0,t.setSpan)(E,T);return o.with(h,p,void 0,T)}};Di.NoopTracer=s;function i(a){return typeof a=="object"&&typeof a.spanId=="string"&&typeof a.traceId=="string"&&typeof a.traceFlags=="number"}return Di}var Cm;function ZI(){if(Cm)return Li;Cm=1,Object.defineProperty(Li,"__esModule",{value:!0}),Li.ProxyTracer=void 0;const e=zI(),t=new e.NoopTracer;let n=class{constructor(o,s,i,a){this._provider=o,this.name=s,this.version=i,this.options=a}startSpan(o,s,i){return this._getTracer().startSpan(o,s,i)}startActiveSpan(o,s,i,a){const c=this._getTracer();return Reflect.apply(c.startActiveSpan,c,arguments)}_getTracer(){if(this._delegate)return this._delegate;const o=this._provider.getDelegateTracer(this.name,this.version,this.options);return o?(this._delegate=o,this._delegate):t}};return Li.ProxyTracer=n,Li}var Gi={},Vi={},Mm;function zD(){if(Mm)return Vi;Mm=1,Object.defineProperty(Vi,"__esModule",{value:!0}),Vi.NoopTracerProvider=void 0;const e=zI();let t=class{getTracer(r,o,s){return new e.NoopTracer}};return Vi.NoopTracerProvider=t,Vi}var Pm;function XI(){if(Pm)return Gi;Pm=1,Object.defineProperty(Gi,"__esModule",{value:!0}),Gi.ProxyTracerProvider=void 0;const e=ZI(),t=zD(),n=new t.NoopTracerProvider;let r=class{getTracer(s,i,a){var c;return(c=this.getDelegateTracer(s,i,a))!==null&&c!==void 0?c:new e.ProxyTracer(this,s,i,a)}getDelegate(){var s;return(s=this._delegate)!==null&&s!==void 0?s:n}setDelegate(s){this._delegate=s}getDelegateTracer(s,i,a){var c;return(c=this._delegate)===null||c===void 0?void 0:c.getTracer(s,i,a)}};return Gi.ProxyTracerProvider=r,Gi}var Jl={},vm;function ZD(){return vm||(vm=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SamplingDecision=void 0,(function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(e.SamplingDecision||(e.SamplingDecision={}))})(Jl)),Jl}var ed={},Lm;function XD(){return Lm||(Lm=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpanKind=void 0,(function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"})(e.SpanKind||(e.SpanKind={}))})(ed)),ed}var td={},Dm;function QD(){return Dm||(Dm=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpanStatusCode=void 0,(function(t){t[t.UNSET=0]="UNSET",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR"})(e.SpanStatusCode||(e.SpanStatusCode={}))})(td)),td}var xi={},$i={},Tr={},wm;function JD(){if(wm)return Tr;wm=1,Object.defineProperty(Tr,"__esModule",{value:!0}),Tr.validateValue=Tr.validateKey=void 0;const e="[_0-9a-z-*/]",t=`[a-z]${e}{0,255}`,n=`[a-z0-9]${e}{0,240}@[a-z]${e}{0,13}`,r=new RegExp(`^(?:${t}|${n})$`),o=/^[ -~]{0,255}[!-~]$/,s=/,|=/;function i(c){return r.test(c)}Tr.validateKey=i;function a(c){return o.test(c)&&!s.test(c)}return Tr.validateValue=a,Tr}var Um;function ew(){if(Um)return $i;Um=1,Object.defineProperty($i,"__esModule",{value:!0}),$i.TraceStateImpl=void 0;const e=JD(),t=32,n=512,r=",",o="=";class s{constructor(a){this._internalState=new Map,a&&this._parse(a)}set(a,c){const l=this._clone();return l._internalState.has(a)&&l._internalState.delete(a),l._internalState.set(a,c),l}unset(a){const c=this._clone();return c._internalState.delete(a),c}get(a){return this._internalState.get(a)}serialize(){return this._keys().reduce((a,c)=>(a.push(c+o+this.get(c)),a),[]).join(r)}_parse(a){a.length>n||(this._internalState=a.split(r).reverse().reduce((c,l)=>{const f=l.trim(),d=f.indexOf(o);if(d!==-1){const u=f.slice(0,d),_=f.slice(d+1,l.length);(0,e.validateKey)(u)&&(0,e.validateValue)(_)&&c.set(u,_)}return c},new Map),this._internalState.size>t&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,t))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){const a=new s;return a._internalState=new Map(this._internalState),a}}return $i.TraceStateImpl=s,$i}var km;function tw(){if(km)return xi;km=1,Object.defineProperty(xi,"__esModule",{value:!0}),xi.createTraceState=void 0;const e=ew();function t(n){return new e.TraceStateImpl(n)}return xi.createTraceState=t,xi}var Bi={},Gm;function nw(){if(Gm)return Bi;Gm=1,Object.defineProperty(Bi,"__esModule",{value:!0}),Bi.context=void 0;const e=Qu();return Bi.context=e.ContextAPI.getInstance(),Bi}var Hi={},Vm;function rw(){if(Vm)return Hi;Vm=1,Object.defineProperty(Hi,"__esModule",{value:!0}),Hi.diag=void 0;const e=zo();return Hi.diag=e.DiagAPI.instance(),Hi}var Fi={},Yi={},hr={},xm;function ow(){if(xm)return hr;xm=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.NOOP_METER_PROVIDER=hr.NoopMeterProvider=void 0;const e=jI();let t=class{getMeter(r,o,s){return e.NOOP_METER}};return hr.NoopMeterProvider=t,hr.NOOP_METER_PROVIDER=new t,hr}var $m;function sw(){if($m)return Yi;$m=1,Object.defineProperty(Yi,"__esModule",{value:!0}),Yi.MetricsAPI=void 0;const e=ow(),t=Ko(),n=zo(),r="metrics";class o{constructor(){}static getInstance(){return this._instance||(this._instance=new o),this._instance}setGlobalMeterProvider(i){return(0,t.registerGlobal)(r,i,n.DiagAPI.instance())}getMeterProvider(){return(0,t.getGlobal)(r)||e.NOOP_METER_PROVIDER}getMeter(i,a,c){return this.getMeterProvider().getMeter(i,a,c)}disable(){(0,t.unregisterGlobal)(r,n.DiagAPI.instance())}}return Yi.MetricsAPI=o,Yi}var Bm;function iw(){if(Bm)return Fi;Bm=1,Object.defineProperty(Fi,"__esModule",{value:!0}),Fi.metrics=void 0;const e=sw();return Fi.metrics=e.MetricsAPI.getInstance(),Fi}var ji={},qi={},Wi={},Hm;function aw(){if(Hm)return Wi;Hm=1,Object.defineProperty(Wi,"__esModule",{value:!0}),Wi.NoopTextMapPropagator=void 0;let e=class{inject(n,r){}extract(n,r){return n}fields(){return[]}};return Wi.NoopTextMapPropagator=e,Wi}var Xt={},Fm;function cw(){if(Fm)return Xt;Fm=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.deleteBaggage=Xt.setBaggage=Xt.getActiveBaggage=Xt.getBaggage=void 0;const e=Qu(),n=(0,Xu().createContextKey)("OpenTelemetry Baggage Key");function r(a){return a.getValue(n)||void 0}Xt.getBaggage=r;function o(){return r(e.ContextAPI.getInstance().active())}Xt.getActiveBaggage=o;function s(a,c){return a.setValue(n,c)}Xt.setBaggage=s;function i(a){return a.deleteValue(n)}return Xt.deleteBaggage=i,Xt}var Ym;function uw(){if(Ym)return qi;Ym=1,Object.defineProperty(qi,"__esModule",{value:!0}),qi.PropagationAPI=void 0;const e=Ko(),t=aw(),n=qI(),r=cw(),o=YI(),s=zo(),i="propagation",a=new t.NoopTextMapPropagator;class c{constructor(){this.createBaggage=o.createBaggage,this.getBaggage=r.getBaggage,this.getActiveBaggage=r.getActiveBaggage,this.setBaggage=r.setBaggage,this.deleteBaggage=r.deleteBaggage}static getInstance(){return this._instance||(this._instance=new c),this._instance}setGlobalPropagator(f){return(0,e.registerGlobal)(i,f,s.DiagAPI.instance())}inject(f,d,u=n.defaultTextMapSetter){return this._getGlobalPropagator().inject(f,d,u)}extract(f,d,u=n.defaultTextMapGetter){return this._getGlobalPropagator().extract(f,d,u)}fields(){return this._getGlobalPropagator().fields()}disable(){(0,e.unregisterGlobal)(i,s.DiagAPI.instance())}_getGlobalPropagator(){return(0,e.getGlobal)(i)||a}}return qi.PropagationAPI=c,qi}var jm;function lw(){if(jm)return ji;jm=1,Object.defineProperty(ji,"__esModule",{value:!0}),ji.propagation=void 0;const e=uw();return ji.propagation=e.PropagationAPI.getInstance(),ji}var Ki={},zi={},qm;function dw(){if(qm)return zi;qm=1,Object.defineProperty(zi,"__esModule",{value:!0}),zi.TraceAPI=void 0;const e=Ko(),t=XI(),n=eE(),r=KI(),o=zo(),s="trace";class i{constructor(){this._proxyTracerProvider=new t.ProxyTracerProvider,this.wrapSpanContext=n.wrapSpanContext,this.isSpanContextValid=n.isSpanContextValid,this.deleteSpan=r.deleteSpan,this.getSpan=r.getSpan,this.getActiveSpan=r.getActiveSpan,this.getSpanContext=r.getSpanContext,this.setSpan=r.setSpan,this.setSpanContext=r.setSpanContext}static getInstance(){return this._instance||(this._instance=new i),this._instance}setGlobalTracerProvider(c){const l=(0,e.registerGlobal)(s,this._proxyTracerProvider,o.DiagAPI.instance());return l&&this._proxyTracerProvider.setDelegate(c),l}getTracerProvider(){return(0,e.getGlobal)(s)||this._proxyTracerProvider}getTracer(c,l){return this.getTracerProvider().getTracer(c,l)}disable(){(0,e.unregisterGlobal)(s,o.DiagAPI.instance()),this._proxyTracerProvider=new t.ProxyTracerProvider}}return zi.TraceAPI=i,zi}var Wm;function fw(){if(Wm)return Ki;Wm=1,Object.defineProperty(Ki,"__esModule",{value:!0}),Ki.trace=void 0;const e=dw();return Ki.trace=e.TraceAPI.getInstance(),Ki}var Km;function Me(){return Km||(Km=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.trace=e.propagation=e.metrics=e.diag=e.context=e.INVALID_SPAN_CONTEXT=e.INVALID_TRACEID=e.INVALID_SPANID=e.isValidSpanId=e.isValidTraceId=e.isSpanContextValid=e.createTraceState=e.TraceFlags=e.SpanStatusCode=e.SpanKind=e.SamplingDecision=e.ProxyTracerProvider=e.ProxyTracer=e.defaultTextMapSetter=e.defaultTextMapGetter=e.ValueType=e.createNoopMeter=e.DiagLogLevel=e.DiagConsoleLogger=e.ROOT_CONTEXT=e.createContextKey=e.baggageEntryMetadataFromString=void 0;var t=YI();Object.defineProperty(e,"baggageEntryMetadataFromString",{enumerable:!0,get:function(){return t.baggageEntryMetadataFromString}});var n=Xu();Object.defineProperty(e,"createContextKey",{enumerable:!0,get:function(){return n.createContextKey}}),Object.defineProperty(e,"ROOT_CONTEXT",{enumerable:!0,get:function(){return n.ROOT_CONTEXT}});var r=qD();Object.defineProperty(e,"DiagConsoleLogger",{enumerable:!0,get:function(){return r.DiagConsoleLogger}});var o=Xp();Object.defineProperty(e,"DiagLogLevel",{enumerable:!0,get:function(){return o.DiagLogLevel}});var s=jI();Object.defineProperty(e,"createNoopMeter",{enumerable:!0,get:function(){return s.createNoopMeter}});var i=WD();Object.defineProperty(e,"ValueType",{enumerable:!0,get:function(){return i.ValueType}});var a=qI();Object.defineProperty(e,"defaultTextMapGetter",{enumerable:!0,get:function(){return a.defaultTextMapGetter}}),Object.defineProperty(e,"defaultTextMapSetter",{enumerable:!0,get:function(){return a.defaultTextMapSetter}});var c=ZI();Object.defineProperty(e,"ProxyTracer",{enumerable:!0,get:function(){return c.ProxyTracer}});var l=XI();Object.defineProperty(e,"ProxyTracerProvider",{enumerable:!0,get:function(){return l.ProxyTracerProvider}});var f=ZD();Object.defineProperty(e,"SamplingDecision",{enumerable:!0,get:function(){return f.SamplingDecision}});var d=XD();Object.defineProperty(e,"SpanKind",{enumerable:!0,get:function(){return d.SpanKind}});var u=QD();Object.defineProperty(e,"SpanStatusCode",{enumerable:!0,get:function(){return u.SpanStatusCode}});var _=WI();Object.defineProperty(e,"TraceFlags",{enumerable:!0,get:function(){return _.TraceFlags}});var p=tw();Object.defineProperty(e,"createTraceState",{enumerable:!0,get:function(){return p.createTraceState}});var E=eE();Object.defineProperty(e,"isSpanContextValid",{enumerable:!0,get:function(){return E.isSpanContextValid}}),Object.defineProperty(e,"isValidTraceId",{enumerable:!0,get:function(){return E.isValidTraceId}}),Object.defineProperty(e,"isValidSpanId",{enumerable:!0,get:function(){return E.isValidSpanId}});var T=Qp();Object.defineProperty(e,"INVALID_SPANID",{enumerable:!0,get:function(){return T.INVALID_SPANID}}),Object.defineProperty(e,"INVALID_TRACEID",{enumerable:!0,get:function(){return T.INVALID_TRACEID}}),Object.defineProperty(e,"INVALID_SPAN_CONTEXT",{enumerable:!0,get:function(){return T.INVALID_SPAN_CONTEXT}});const h=nw();Object.defineProperty(e,"context",{enumerable:!0,get:function(){return h.context}});const m=rw();Object.defineProperty(e,"diag",{enumerable:!0,get:function(){return m.diag}});const A=iw();Object.defineProperty(e,"metrics",{enumerable:!0,get:function(){return A.metrics}});const g=lw();Object.defineProperty(e,"propagation",{enumerable:!0,get:function(){return g.propagation}});const R=fw();Object.defineProperty(e,"trace",{enumerable:!0,get:function(){return R.trace}}),e.default={context:h.context,diag:m.diag,metrics:A.metrics,propagation:g.propagation,trace:R.trace}})(Wl)),Wl}var b=Me(),nd={},Zi={};const tE=b.createContextKey("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function Xr(e){return e.setValue(tE,!0)}function _w(e){return e.deleteValue(tE)}function Nn(e){return e.getValue(tE)===!0}const pw="=",rp=";",iu=",",rd="baggage",Ew=180,Tw=4096,hw=8192;function Sw(e){return e.reduce((t,n)=>{const r=`${t}${t!==""?iu:""}${n}`;return r.length>hw?t:r},"")}function mw(e){return e.getAllEntries().map(([t,n])=>{let r=`${encodeURIComponent(t)}=${encodeURIComponent(n.value)}`;return n.metadata!==void 0&&(r+=rp+n.metadata.toString()),r})}function QI(e){const t=e.split(rp);if(t.length<=0)return;const n=t.shift();if(!n)return;const r=n.indexOf(pw);if(r<=0)return;const o=decodeURIComponent(n.substring(0,r).trim()),s=decodeURIComponent(n.substring(r+1).trim());let i;return t.length>0&&(i=b.baggageEntryMetadataFromString(t.join(rp))),{key:o,value:s,metadata:i}}function Aw(e){const t={};return typeof e=="string"&&e.length>0&&e.split(iu).forEach(n=>{const r=QI(n);r!==void 0&&r.value.length>0&&(t[r.key]=r.value)}),t}class JI{inject(t,n,r){const o=b.propagation.getBaggage(t);if(!o||Nn(t))return;const s=mw(o).filter(a=>a.length<=Tw).slice(0,Ew),i=Sw(s);i.length>0&&r.set(n,rd,i)}extract(t,n,r){const o=r.get(n,rd),s=Array.isArray(o)?o.join(iu):o;if(!s)return t;const i={};return s.length===0||(s.split(iu).forEach(c=>{const l=QI(c);if(l){const f={value:l.value};l.metadata&&(f.metadata=l.metadata),i[l.key]=f}}),Object.entries(i).length===0)?t:b.propagation.setBaggage(t,b.propagation.createBaggage(i))}fields(){return[rd]}}class gw{_monotonicClock;_epochMillis;_performanceMillis;constructor(t,n){this._monotonicClock=n,this._epochMillis=t.now(),this._performanceMillis=n.now()}now(){const t=this._monotonicClock.now()-this._performanceMillis;return this._epochMillis+t}}function Ka(e){const t={};if(typeof e!="object"||e==null)return t;for(const n in e){if(!Object.prototype.hasOwnProperty.call(e,n))continue;if(!Rw(n)){b.diag.warn(`Invalid attribute key: ${n}`);continue}const r=e[n];if(!nE(r)){b.diag.warn(`Invalid attribute value set for key: ${n}`);continue}Array.isArray(r)?t[n]=r.slice():t[n]=r}return t}function Rw(e){return typeof e=="string"&&e!==""}function nE(e){return e==null?!0:Array.isArray(e)?Nw(e):eC(typeof e)}function Nw(e){let t;for(const n of e){if(n==null)continue;const r=typeof n;if(r!==t){if(!t){if(eC(r)){t=r;continue}return!1}return!1}}return!0}function eC(e){switch(e){case"number":case"boolean":case"string":return!0}return!1}function tC(){return e=>{b.diag.error(yw(e))}}function yw(e){return typeof e=="string"?e:JSON.stringify(Ow(e))}function Ow(e){const t={};let n=e;for(;n!==null;)Object.getOwnPropertyNames(n).forEach(r=>{if(t[r])return;const o=n[r];o&&(t[r]=String(o))}),n=Object.getPrototypeOf(n);return t}let nC=tC();function bw(e){nC=e}function rE(e){try{nC(e)}catch{}}function bt(e){const t=process.env[e];if(t==null||t.trim()==="")return;const n=Number(t);if(isNaN(n)){b.diag.warn(`Unknown value ${Zr.inspect(t)} for ${e}, expected a number, using defaults`);return}return n}function oE(e){const t=process.env[e];if(!(t==null||t.trim()===""))return t}function Iw(e){const t=process.env[e]?.trim().toLowerCase();return t==null||t===""?!1:t==="true"?!0:(t==="false"||b.diag.warn(`Unknown value ${Zr.inspect(t)} for ${e}, expected 'true' or 'false', falling back to 'false' (default)`),!1)}function Cw(e){return oE(e)?.split(",").map(t=>t.trim()).filter(t=>t!=="")}const Mw=typeof globalThis=="object"?globalThis:global,zr=OD.performance,Pw="2.2.0";var Sr={},mr={},S={},Xi={},zm;function rC(){if(zm)return Xi;zm=1,Object.defineProperty(Xi,"__esModule",{value:!0}),Xi.createConstMap=void 0;function e(t){let n={};const r=t.length;for(let o=0;o<r;o++){const s=t[o];s&&(n[String(s).toUpperCase().replace(/[-.]/g,"_")]=s)}return n}return Xi.createConstMap=e,Xi}var Zm;function vw(){if(Zm)return S;Zm=1,Object.defineProperty(S,"__esModule",{value:!0}),S.SEMATTRS_NET_HOST_CARRIER_ICC=S.SEMATTRS_NET_HOST_CARRIER_MNC=S.SEMATTRS_NET_HOST_CARRIER_MCC=S.SEMATTRS_NET_HOST_CARRIER_NAME=S.SEMATTRS_NET_HOST_CONNECTION_SUBTYPE=S.SEMATTRS_NET_HOST_CONNECTION_TYPE=S.SEMATTRS_NET_HOST_NAME=S.SEMATTRS_NET_HOST_PORT=S.SEMATTRS_NET_HOST_IP=S.SEMATTRS_NET_PEER_NAME=S.SEMATTRS_NET_PEER_PORT=S.SEMATTRS_NET_PEER_IP=S.SEMATTRS_NET_TRANSPORT=S.SEMATTRS_FAAS_INVOKED_REGION=S.SEMATTRS_FAAS_INVOKED_PROVIDER=S.SEMATTRS_FAAS_INVOKED_NAME=S.SEMATTRS_FAAS_COLDSTART=S.SEMATTRS_FAAS_CRON=S.SEMATTRS_FAAS_TIME=S.SEMATTRS_FAAS_DOCUMENT_NAME=S.SEMATTRS_FAAS_DOCUMENT_TIME=S.SEMATTRS_FAAS_DOCUMENT_OPERATION=S.SEMATTRS_FAAS_DOCUMENT_COLLECTION=S.SEMATTRS_FAAS_EXECUTION=S.SEMATTRS_FAAS_TRIGGER=S.SEMATTRS_EXCEPTION_ESCAPED=S.SEMATTRS_EXCEPTION_STACKTRACE=S.SEMATTRS_EXCEPTION_MESSAGE=S.SEMATTRS_EXCEPTION_TYPE=S.SEMATTRS_DB_SQL_TABLE=S.SEMATTRS_DB_MONGODB_COLLECTION=S.SEMATTRS_DB_REDIS_DATABASE_INDEX=S.SEMATTRS_DB_HBASE_NAMESPACE=S.SEMATTRS_DB_CASSANDRA_COORDINATOR_DC=S.SEMATTRS_DB_CASSANDRA_COORDINATOR_ID=S.SEMATTRS_DB_CASSANDRA_SPECULATIVE_EXECUTION_COUNT=S.SEMATTRS_DB_CASSANDRA_IDEMPOTENCE=S.SEMATTRS_DB_CASSANDRA_TABLE=S.SEMATTRS_DB_CASSANDRA_CONSISTENCY_LEVEL=S.SEMATTRS_DB_CASSANDRA_PAGE_SIZE=S.SEMATTRS_DB_CASSANDRA_KEYSPACE=S.SEMATTRS_DB_MSSQL_INSTANCE_NAME=S.SEMATTRS_DB_OPERATION=S.SEMATTRS_DB_STATEMENT=S.SEMATTRS_DB_NAME=S.SEMATTRS_DB_JDBC_DRIVER_CLASSNAME=S.SEMATTRS_DB_USER=S.SEMATTRS_DB_CONNECTION_STRING=S.SEMATTRS_DB_SYSTEM=S.SEMATTRS_AWS_LAMBDA_INVOKED_ARN=void 0,S.SEMATTRS_MESSAGING_DESTINATION_KIND=S.SEMATTRS_MESSAGING_DESTINATION=S.SEMATTRS_MESSAGING_SYSTEM=S.SEMATTRS_AWS_DYNAMODB_GLOBAL_SECONDARY_INDEX_UPDATES=S.SEMATTRS_AWS_DYNAMODB_ATTRIBUTE_DEFINITIONS=S.SEMATTRS_AWS_DYNAMODB_SCANNED_COUNT=S.SEMATTRS_AWS_DYNAMODB_COUNT=S.SEMATTRS_AWS_DYNAMODB_TOTAL_SEGMENTS=S.SEMATTRS_AWS_DYNAMODB_SEGMENT=S.SEMATTRS_AWS_DYNAMODB_SCAN_FORWARD=S.SEMATTRS_AWS_DYNAMODB_TABLE_COUNT=S.SEMATTRS_AWS_DYNAMODB_EXCLUSIVE_START_TABLE=S.SEMATTRS_AWS_DYNAMODB_LOCAL_SECONDARY_INDEXES=S.SEMATTRS_AWS_DYNAMODB_GLOBAL_SECONDARY_INDEXES=S.SEMATTRS_AWS_DYNAMODB_SELECT=S.SEMATTRS_AWS_DYNAMODB_INDEX_NAME=S.SEMATTRS_AWS_DYNAMODB_ATTRIBUTES_TO_GET=S.SEMATTRS_AWS_DYNAMODB_LIMIT=S.SEMATTRS_AWS_DYNAMODB_PROJECTION=S.SEMATTRS_AWS_DYNAMODB_CONSISTENT_READ=S.SEMATTRS_AWS_DYNAMODB_PROVISIONED_WRITE_CAPACITY=S.SEMATTRS_AWS_DYNAMODB_PROVISIONED_READ_CAPACITY=S.SEMATTRS_AWS_DYNAMODB_ITEM_COLLECTION_METRICS=S.SEMATTRS_AWS_DYNAMODB_CONSUMED_CAPACITY=S.SEMATTRS_AWS_DYNAMODB_TABLE_NAMES=S.SEMATTRS_HTTP_CLIENT_IP=S.SEMATTRS_HTTP_ROUTE=S.SEMATTRS_HTTP_SERVER_NAME=S.SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED=S.SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH=S.SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED=S.SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH=S.SEMATTRS_HTTP_USER_AGENT=S.SEMATTRS_HTTP_FLAVOR=S.SEMATTRS_HTTP_STATUS_CODE=S.SEMATTRS_HTTP_SCHEME=S.SEMATTRS_HTTP_HOST=S.SEMATTRS_HTTP_TARGET=S.SEMATTRS_HTTP_URL=S.SEMATTRS_HTTP_METHOD=S.SEMATTRS_CODE_LINENO=S.SEMATTRS_CODE_FILEPATH=S.SEMATTRS_CODE_NAMESPACE=S.SEMATTRS_CODE_FUNCTION=S.SEMATTRS_THREAD_NAME=S.SEMATTRS_THREAD_ID=S.SEMATTRS_ENDUSER_SCOPE=S.SEMATTRS_ENDUSER_ROLE=S.SEMATTRS_ENDUSER_ID=S.SEMATTRS_PEER_SERVICE=void 0,S.DBSYSTEMVALUES_FILEMAKER=S.DBSYSTEMVALUES_DERBY=S.DBSYSTEMVALUES_FIREBIRD=S.DBSYSTEMVALUES_ADABAS=S.DBSYSTEMVALUES_CACHE=S.DBSYSTEMVALUES_EDB=S.DBSYSTEMVALUES_FIRSTSQL=S.DBSYSTEMVALUES_INGRES=S.DBSYSTEMVALUES_HANADB=S.DBSYSTEMVALUES_MAXDB=S.DBSYSTEMVALUES_PROGRESS=S.DBSYSTEMVALUES_HSQLDB=S.DBSYSTEMVALUES_CLOUDSCAPE=S.DBSYSTEMVALUES_HIVE=S.DBSYSTEMVALUES_REDSHIFT=S.DBSYSTEMVALUES_POSTGRESQL=S.DBSYSTEMVALUES_DB2=S.DBSYSTEMVALUES_ORACLE=S.DBSYSTEMVALUES_MYSQL=S.DBSYSTEMVALUES_MSSQL=S.DBSYSTEMVALUES_OTHER_SQL=S.SemanticAttributes=S.SEMATTRS_MESSAGE_UNCOMPRESSED_SIZE=S.SEMATTRS_MESSAGE_COMPRESSED_SIZE=S.SEMATTRS_MESSAGE_ID=S.SEMATTRS_MESSAGE_TYPE=S.SEMATTRS_RPC_JSONRPC_ERROR_MESSAGE=S.SEMATTRS_RPC_JSONRPC_ERROR_CODE=S.SEMATTRS_RPC_JSONRPC_REQUEST_ID=S.SEMATTRS_RPC_JSONRPC_VERSION=S.SEMATTRS_RPC_GRPC_STATUS_CODE=S.SEMATTRS_RPC_METHOD=S.SEMATTRS_RPC_SERVICE=S.SEMATTRS_RPC_SYSTEM=S.SEMATTRS_MESSAGING_KAFKA_TOMBSTONE=S.SEMATTRS_MESSAGING_KAFKA_PARTITION=S.SEMATTRS_MESSAGING_KAFKA_CLIENT_ID=S.SEMATTRS_MESSAGING_KAFKA_CONSUMER_GROUP=S.SEMATTRS_MESSAGING_KAFKA_MESSAGE_KEY=S.SEMATTRS_MESSAGING_RABBITMQ_ROUTING_KEY=S.SEMATTRS_MESSAGING_CONSUMER_ID=S.SEMATTRS_MESSAGING_OPERATION=S.SEMATTRS_MESSAGING_MESSAGE_PAYLOAD_COMPRESSED_SIZE_BYTES=S.SEMATTRS_MESSAGING_MESSAGE_PAYLOAD_SIZE_BYTES=S.SEMATTRS_MESSAGING_CONVERSATION_ID=S.SEMATTRS_MESSAGING_MESSAGE_ID=S.SEMATTRS_MESSAGING_URL=S.SEMATTRS_MESSAGING_PROTOCOL_VERSION=S.SEMATTRS_MESSAGING_PROTOCOL=S.SEMATTRS_MESSAGING_TEMP_DESTINATION=void 0,S.FAASINVOKEDPROVIDERVALUES_ALIBABA_CLOUD=S.FaasDocumentOperationValues=S.FAASDOCUMENTOPERATIONVALUES_DELETE=S.FAASDOCUMENTOPERATIONVALUES_EDIT=S.FAASDOCUMENTOPERATIONVALUES_INSERT=S.FaasTriggerValues=S.FAASTRIGGERVALUES_OTHER=S.FAASTRIGGERVALUES_TIMER=S.FAASTRIGGERVALUES_PUBSUB=S.FAASTRIGGERVALUES_HTTP=S.FAASTRIGGERVALUES_DATASOURCE=S.DbCassandraConsistencyLevelValues=S.DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_SERIAL=S.DBCASSANDRACONSISTENCYLEVELVALUES_SERIAL=S.DBCASSANDRACONSISTENCYLEVELVALUES_ANY=S.DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_ONE=S.DBCASSANDRACONSISTENCYLEVELVALUES_THREE=S.DBCASSANDRACONSISTENCYLEVELVALUES_TWO=S.DBCASSANDRACONSISTENCYLEVELVALUES_ONE=S.DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_QUORUM=S.DBCASSANDRACONSISTENCYLEVELVALUES_QUORUM=S.DBCASSANDRACONSISTENCYLEVELVALUES_EACH_QUORUM=S.DBCASSANDRACONSISTENCYLEVELVALUES_ALL=S.DbSystemValues=S.DBSYSTEMVALUES_COCKROACHDB=S.DBSYSTEMVALUES_MEMCACHED=S.DBSYSTEMVALUES_ELASTICSEARCH=S.DBSYSTEMVALUES_GEODE=S.DBSYSTEMVALUES_NEO4J=S.DBSYSTEMVALUES_DYNAMODB=S.DBSYSTEMVALUES_COSMOSDB=S.DBSYSTEMVALUES_COUCHDB=S.DBSYSTEMVALUES_COUCHBASE=S.DBSYSTEMVALUES_REDIS=S.DBSYSTEMVALUES_MONGODB=S.DBSYSTEMVALUES_HBASE=S.DBSYSTEMVALUES_CASSANDRA=S.DBSYSTEMVALUES_COLDFUSION=S.DBSYSTEMVALUES_H2=S.DBSYSTEMVALUES_VERTICA=S.DBSYSTEMVALUES_TERADATA=S.DBSYSTEMVALUES_SYBASE=S.DBSYSTEMVALUES_SQLITE=S.DBSYSTEMVALUES_POINTBASE=S.DBSYSTEMVALUES_PERVASIVE=S.DBSYSTEMVALUES_NETEZZA=S.DBSYSTEMVALUES_MARIADB=S.DBSYSTEMVALUES_INTERBASE=S.DBSYSTEMVALUES_INSTANTDB=S.DBSYSTEMVALUES_INFORMIX=void 0,S.MESSAGINGOPERATIONVALUES_RECEIVE=S.MessagingDestinationKindValues=S.MESSAGINGDESTINATIONKINDVALUES_TOPIC=S.MESSAGINGDESTINATIONKINDVALUES_QUEUE=S.HttpFlavorValues=S.HTTPFLAVORVALUES_QUIC=S.HTTPFLAVORVALUES_SPDY=S.HTTPFLAVORVALUES_HTTP_2_0=S.HTTPFLAVORVALUES_HTTP_1_1=S.HTTPFLAVORVALUES_HTTP_1_0=S.NetHostConnectionSubtypeValues=S.NETHOSTCONNECTIONSUBTYPEVALUES_LTE_CA=S.NETHOSTCONNECTIONSUBTYPEVALUES_NRNSA=S.NETHOSTCONNECTIONSUBTYPEVALUES_NR=S.NETHOSTCONNECTIONSUBTYPEVALUES_IWLAN=S.NETHOSTCONNECTIONSUBTYPEVALUES_TD_SCDMA=S.NETHOSTCONNECTIONSUBTYPEVALUES_GSM=S.NETHOSTCONNECTIONSUBTYPEVALUES_HSPAP=S.NETHOSTCONNECTIONSUBTYPEVALUES_EHRPD=S.NETHOSTCONNECTIONSUBTYPEVALUES_LTE=S.NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_B=S.NETHOSTCONNECTIONSUBTYPEVALUES_IDEN=S.NETHOSTCONNECTIONSUBTYPEVALUES_HSPA=S.NETHOSTCONNECTIONSUBTYPEVALUES_HSUPA=S.NETHOSTCONNECTIONSUBTYPEVALUES_HSDPA=S.NETHOSTCONNECTIONSUBTYPEVALUES_CDMA2000_1XRTT=S.NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_A=S.NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_0=S.NETHOSTCONNECTIONSUBTYPEVALUES_CDMA=S.NETHOSTCONNECTIONSUBTYPEVALUES_UMTS=S.NETHOSTCONNECTIONSUBTYPEVALUES_EDGE=S.NETHOSTCONNECTIONSUBTYPEVALUES_GPRS=S.NetHostConnectionTypeValues=S.NETHOSTCONNECTIONTYPEVALUES_UNKNOWN=S.NETHOSTCONNECTIONTYPEVALUES_UNAVAILABLE=S.NETHOSTCONNECTIONTYPEVALUES_CELL=S.NETHOSTCONNECTIONTYPEVALUES_WIRED=S.NETHOSTCONNECTIONTYPEVALUES_WIFI=S.NetTransportValues=S.NETTRANSPORTVALUES_OTHER=S.NETTRANSPORTVALUES_INPROC=S.NETTRANSPORTVALUES_PIPE=S.NETTRANSPORTVALUES_UNIX=S.NETTRANSPORTVALUES_IP=S.NETTRANSPORTVALUES_IP_UDP=S.NETTRANSPORTVALUES_IP_TCP=S.FaasInvokedProviderValues=S.FAASINVOKEDPROVIDERVALUES_GCP=S.FAASINVOKEDPROVIDERVALUES_AZURE=S.FAASINVOKEDPROVIDERVALUES_AWS=void 0,S.MessageTypeValues=S.MESSAGETYPEVALUES_RECEIVED=S.MESSAGETYPEVALUES_SENT=S.RpcGrpcStatusCodeValues=S.RPCGRPCSTATUSCODEVALUES_UNAUTHENTICATED=S.RPCGRPCSTATUSCODEVALUES_DATA_LOSS=S.RPCGRPCSTATUSCODEVALUES_UNAVAILABLE=S.RPCGRPCSTATUSCODEVALUES_INTERNAL=S.RPCGRPCSTATUSCODEVALUES_UNIMPLEMENTED=S.RPCGRPCSTATUSCODEVALUES_OUT_OF_RANGE=S.RPCGRPCSTATUSCODEVALUES_ABORTED=S.RPCGRPCSTATUSCODEVALUES_FAILED_PRECONDITION=S.RPCGRPCSTATUSCODEVALUES_RESOURCE_EXHAUSTED=S.RPCGRPCSTATUSCODEVALUES_PERMISSION_DENIED=S.RPCGRPCSTATUSCODEVALUES_ALREADY_EXISTS=S.RPCGRPCSTATUSCODEVALUES_NOT_FOUND=S.RPCGRPCSTATUSCODEVALUES_DEADLINE_EXCEEDED=S.RPCGRPCSTATUSCODEVALUES_INVALID_ARGUMENT=S.RPCGRPCSTATUSCODEVALUES_UNKNOWN=S.RPCGRPCSTATUSCODEVALUES_CANCELLED=S.RPCGRPCSTATUSCODEVALUES_OK=S.MessagingOperationValues=S.MESSAGINGOPERATIONVALUES_PROCESS=void 0;const e=rC(),t="aws.lambda.invoked_arn",n="db.system",r="db.connection_string",o="db.user",s="db.jdbc.driver_classname",i="db.name",a="db.statement",c="db.operation",l="db.mssql.instance_name",f="db.cassandra.keyspace",d="db.cassandra.page_size",u="db.cassandra.consistency_level",_="db.cassandra.table",p="db.cassandra.idempotence",E="db.cassandra.speculative_execution_count",T="db.cassandra.coordinator.id",h="db.cassandra.coordinator.dc",m="db.hbase.namespace",A="db.redis.database_index",g="db.mongodb.collection",R="db.sql.table",O="exception.type",C="exception.message",I="exception.stacktrace",L="exception.escaped",U="faas.trigger",q="faas.execution",H="faas.document.collection",$="faas.document.operation",B="faas.document.time",F="faas.document.name",w="faas.time",k="faas.cron",Y="faas.coldstart",oe="faas.invoked_name",ae="faas.invoked_provider",ne="faas.invoked_region",M="net.transport",P="net.peer.ip",G="net.peer.port",V="net.peer.name",K="net.host.ip",X="net.host.port",v="net.host.name",D="net.host.connection.type",z="net.host.connection.subtype",j="net.host.carrier.name",ee="net.host.carrier.mcc",te="net.host.carrier.mnc",_e="net.host.carrier.icc",se="peer.service",ce="enduser.id",he="enduser.role",ve="enduser.scope",De="thread.id",qe="thread.name",Mt="code.function",st="code.namespace",it="code.filepath",nt="code.lineno",is="http.method",as="http.url",cs="http.target",us="http.host",ls="http.scheme",ds="http.status_code",fs="http.flavor",_s="http.user_agent",ps="http.request_content_length",Es="http.request_content_length_uncompressed",Ts="http.response_content_length",hs="http.response_content_length_uncompressed",Ss="http.server_name",ms="http.route",As="http.client_ip",gs="aws.dynamodb.table_names",Rs="aws.dynamodb.consumed_capacity",Ns="aws.dynamodb.item_collection_metrics",ys="aws.dynamodb.provisioned_read_capacity",Os="aws.dynamodb.provisioned_write_capacity",bs="aws.dynamodb.consistent_read",Is="aws.dynamodb.projection",Cs="aws.dynamodb.limit",Ms="aws.dynamodb.attributes_to_get",Ps="aws.dynamodb.index_name",vs="aws.dynamodb.select",Ls="aws.dynamodb.global_secondary_indexes",Ds="aws.dynamodb.local_secondary_indexes",ws="aws.dynamodb.exclusive_start_table",Us="aws.dynamodb.table_count",ks="aws.dynamodb.scan_forward",Gs="aws.dynamodb.segment",Vs="aws.dynamodb.total_segments",xs="aws.dynamodb.count",$s="aws.dynamodb.scanned_count",Bs="aws.dynamodb.attribute_definitions",Hs="aws.dynamodb.global_secondary_index_updates",Fs="messaging.system",Ys="messaging.destination",js="messaging.destination_kind",qs="messaging.temp_destination",Ws="messaging.protocol",Ks="messaging.protocol_version",zs="messaging.url",Zs="messaging.message_id",Xs="messaging.conversation_id",Qs="messaging.message_payload_size_bytes",Js="messaging.message_payload_compressed_size_bytes",ei="messaging.operation",ti="messaging.consumer_id",ni="messaging.rabbitmq.routing_key",ri="messaging.kafka.message_key",oi="messaging.kafka.consumer_group",si="messaging.kafka.client_id",ii="messaging.kafka.partition",ai="messaging.kafka.tombstone",ci="rpc.system",ui="rpc.service",li="rpc.method",di="rpc.grpc.status_code",fi="rpc.jsonrpc.version",_i="rpc.jsonrpc.request_id",pi="rpc.jsonrpc.error_code",Ei="rpc.jsonrpc.error_message",Ti="message.type",hi="message.id",Si="message.compressed_size",mi="message.uncompressed_size";S.SEMATTRS_AWS_LAMBDA_INVOKED_ARN=t,S.SEMATTRS_DB_SYSTEM=n,S.SEMATTRS_DB_CONNECTION_STRING=r,S.SEMATTRS_DB_USER=o,S.SEMATTRS_DB_JDBC_DRIVER_CLASSNAME=s,S.SEMATTRS_DB_NAME=i,S.SEMATTRS_DB_STATEMENT=a,S.SEMATTRS_DB_OPERATION=c,S.SEMATTRS_DB_MSSQL_INSTANCE_NAME=l,S.SEMATTRS_DB_CASSANDRA_KEYSPACE=f,S.SEMATTRS_DB_CASSANDRA_PAGE_SIZE=d,S.SEMATTRS_DB_CASSANDRA_CONSISTENCY_LEVEL=u,S.SEMATTRS_DB_CASSANDRA_TABLE=_,S.SEMATTRS_DB_CASSANDRA_IDEMPOTENCE=p,S.SEMATTRS_DB_CASSANDRA_SPECULATIVE_EXECUTION_COUNT=E,S.SEMATTRS_DB_CASSANDRA_COORDINATOR_ID=T,S.SEMATTRS_DB_CASSANDRA_COORDINATOR_DC=h,S.SEMATTRS_DB_HBASE_NAMESPACE=m,S.SEMATTRS_DB_REDIS_DATABASE_INDEX=A,S.SEMATTRS_DB_MONGODB_COLLECTION=g,S.SEMATTRS_DB_SQL_TABLE=R,S.SEMATTRS_EXCEPTION_TYPE=O,S.SEMATTRS_EXCEPTION_MESSAGE=C,S.SEMATTRS_EXCEPTION_STACKTRACE=I,S.SEMATTRS_EXCEPTION_ESCAPED=L,S.SEMATTRS_FAAS_TRIGGER=U,S.SEMATTRS_FAAS_EXECUTION=q,S.SEMATTRS_FAAS_DOCUMENT_COLLECTION=H,S.SEMATTRS_FAAS_DOCUMENT_OPERATION=$,S.SEMATTRS_FAAS_DOCUMENT_TIME=B,S.SEMATTRS_FAAS_DOCUMENT_NAME=F,S.SEMATTRS_FAAS_TIME=w,S.SEMATTRS_FAAS_CRON=k,S.SEMATTRS_FAAS_COLDSTART=Y,S.SEMATTRS_FAAS_INVOKED_NAME=oe,S.SEMATTRS_FAAS_INVOKED_PROVIDER=ae,S.SEMATTRS_FAAS_INVOKED_REGION=ne,S.SEMATTRS_NET_TRANSPORT=M,S.SEMATTRS_NET_PEER_IP=P,S.SEMATTRS_NET_PEER_PORT=G,S.SEMATTRS_NET_PEER_NAME=V,S.SEMATTRS_NET_HOST_IP=K,S.SEMATTRS_NET_HOST_PORT=X,S.SEMATTRS_NET_HOST_NAME=v,S.SEMATTRS_NET_HOST_CONNECTION_TYPE=D,S.SEMATTRS_NET_HOST_CONNECTION_SUBTYPE=z,S.SEMATTRS_NET_HOST_CARRIER_NAME=j,S.SEMATTRS_NET_HOST_CARRIER_MCC=ee,S.SEMATTRS_NET_HOST_CARRIER_MNC=te,S.SEMATTRS_NET_HOST_CARRIER_ICC=_e,S.SEMATTRS_PEER_SERVICE=se,S.SEMATTRS_ENDUSER_ID=ce,S.SEMATTRS_ENDUSER_ROLE=he,S.SEMATTRS_ENDUSER_SCOPE=ve,S.SEMATTRS_THREAD_ID=De,S.SEMATTRS_THREAD_NAME=qe,S.SEMATTRS_CODE_FUNCTION=Mt,S.SEMATTRS_CODE_NAMESPACE=st,S.SEMATTRS_CODE_FILEPATH=it,S.SEMATTRS_CODE_LINENO=nt,S.SEMATTRS_HTTP_METHOD=is,S.SEMATTRS_HTTP_URL=as,S.SEMATTRS_HTTP_TARGET=cs,S.SEMATTRS_HTTP_HOST=us,S.SEMATTRS_HTTP_SCHEME=ls,S.SEMATTRS_HTTP_STATUS_CODE=ds,S.SEMATTRS_HTTP_FLAVOR=fs,S.SEMATTRS_HTTP_USER_AGENT=_s,S.SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH=ps,S.SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED=Es,S.SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH=Ts,S.SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED=hs,S.SEMATTRS_HTTP_SERVER_NAME=Ss,S.SEMATTRS_HTTP_ROUTE=ms,S.SEMATTRS_HTTP_CLIENT_IP=As,S.SEMATTRS_AWS_DYNAMODB_TABLE_NAMES=gs,S.SEMATTRS_AWS_DYNAMODB_CONSUMED_CAPACITY=Rs,S.SEMATTRS_AWS_DYNAMODB_ITEM_COLLECTION_METRICS=Ns,S.SEMATTRS_AWS_DYNAMODB_PROVISIONED_READ_CAPACITY=ys,S.SEMATTRS_AWS_DYNAMODB_PROVISIONED_WRITE_CAPACITY=Os,S.SEMATTRS_AWS_DYNAMODB_CONSISTENT_READ=bs,S.SEMATTRS_AWS_DYNAMODB_PROJECTION=Is,S.SEMATTRS_AWS_DYNAMODB_LIMIT=Cs,S.SEMATTRS_AWS_DYNAMODB_ATTRIBUTES_TO_GET=Ms,S.SEMATTRS_AWS_DYNAMODB_INDEX_NAME=Ps,S.SEMATTRS_AWS_DYNAMODB_SELECT=vs,S.SEMATTRS_AWS_DYNAMODB_GLOBAL_SECONDARY_INDEXES=Ls,S.SEMATTRS_AWS_DYNAMODB_LOCAL_SECONDARY_INDEXES=Ds,S.SEMATTRS_AWS_DYNAMODB_EXCLUSIVE_START_TABLE=ws,S.SEMATTRS_AWS_DYNAMODB_TABLE_COUNT=Us,S.SEMATTRS_AWS_DYNAMODB_SCAN_FORWARD=ks,S.SEMATTRS_AWS_DYNAMODB_SEGMENT=Gs,S.SEMATTRS_AWS_DYNAMODB_TOTAL_SEGMENTS=Vs,S.SEMATTRS_AWS_DYNAMODB_COUNT=xs,S.SEMATTRS_AWS_DYNAMODB_SCANNED_COUNT=$s,S.SEMATTRS_AWS_DYNAMODB_ATTRIBUTE_DEFINITIONS=Bs,S.SEMATTRS_AWS_DYNAMODB_GLOBAL_SECONDARY_INDEX_UPDATES=Hs,S.SEMATTRS_MESSAGING_SYSTEM=Fs,S.SEMATTRS_MESSAGING_DESTINATION=Ys,S.SEMATTRS_MESSAGING_DESTINATION_KIND=js,S.SEMATTRS_MESSAGING_TEMP_DESTINATION=qs,S.SEMATTRS_MESSAGING_PROTOCOL=Ws,S.SEMATTRS_MESSAGING_PROTOCOL_VERSION=Ks,S.SEMATTRS_MESSAGING_URL=zs,S.SEMATTRS_MESSAGING_MESSAGE_ID=Zs,S.SEMATTRS_MESSAGING_CONVERSATION_ID=Xs,S.SEMATTRS_MESSAGING_MESSAGE_PAYLOAD_SIZE_BYTES=Qs,S.SEMATTRS_MESSAGING_MESSAGE_PAYLOAD_COMPRESSED_SIZE_BYTES=Js,S.SEMATTRS_MESSAGING_OPERATION=ei,S.SEMATTRS_MESSAGING_CONSUMER_ID=ti,S.SEMATTRS_MESSAGING_RABBITMQ_ROUTING_KEY=ni,S.SEMATTRS_MESSAGING_KAFKA_MESSAGE_KEY=ri,S.SEMATTRS_MESSAGING_KAFKA_CONSUMER_GROUP=oi,S.SEMATTRS_MESSAGING_KAFKA_CLIENT_ID=si,S.SEMATTRS_MESSAGING_KAFKA_PARTITION=ii,S.SEMATTRS_MESSAGING_KAFKA_TOMBSTONE=ai,S.SEMATTRS_RPC_SYSTEM=ci,S.SEMATTRS_RPC_SERVICE=ui,S.SEMATTRS_RPC_METHOD=li,S.SEMATTRS_RPC_GRPC_STATUS_CODE=di,S.SEMATTRS_RPC_JSONRPC_VERSION=fi,S.SEMATTRS_RPC_JSONRPC_REQUEST_ID=_i,S.SEMATTRS_RPC_JSONRPC_ERROR_CODE=pi,S.SEMATTRS_RPC_JSONRPC_ERROR_MESSAGE=Ei,S.SEMATTRS_MESSAGE_TYPE=Ti,S.SEMATTRS_MESSAGE_ID=hi,S.SEMATTRS_MESSAGE_COMPRESSED_SIZE=Si,S.SEMATTRS_MESSAGE_UNCOMPRESSED_SIZE=mi,S.SemanticAttributes=(0,e.createConstMap)([t,n,r,o,s,i,a,c,l,f,d,u,_,p,E,T,h,m,A,g,R,O,C,I,L,U,q,H,$,B,F,w,k,Y,oe,ae,ne,M,P,G,V,K,X,v,D,z,j,ee,te,_e,se,ce,he,ve,De,qe,Mt,st,it,nt,is,as,cs,us,ls,ds,fs,_s,ps,Es,Ts,hs,Ss,ms,As,gs,Rs,Ns,ys,Os,bs,Is,Cs,Ms,Ps,vs,Ls,Ds,ws,Us,ks,Gs,Vs,xs,$s,Bs,Hs,Fs,Ys,js,qs,Ws,Ks,zs,Zs,Xs,Qs,Js,ei,ti,ni,ri,oi,si,ii,ai,ci,ui,li,di,fi,_i,pi,Ei,Ti,hi,Si,mi]);const Ai="other_sql",gi="mssql",Ri="mysql",Ni="oracle",wT="db2",UT="postgresql",kT="redshift",GT="hive",VT="cloudscape",xT="hsqldb",$T="progress",BT="maxdb",HT="hanadb",FT="ingres",YT="firstsql",jT="edb",qT="cache",WT="adabas",KT="firebird",zT="derby",ZT="filemaker",XT="informix",QT="instantdb",JT="interbase",eh="mariadb",th="netezza",nh="pervasive",rh="pointbase",oh="sqlite",sh="sybase",ih="teradata",ah="vertica",ch="h2",uh="coldfusion",lh="cassandra",dh="hbase",fh="mongodb",_h="redis",ph="couchbase",Eh="couchdb",Th="cosmosdb",hh="dynamodb",Sh="neo4j",mh="geode",Ah="elasticsearch",gh="memcached",Rh="cockroachdb";S.DBSYSTEMVALUES_OTHER_SQL=Ai,S.DBSYSTEMVALUES_MSSQL=gi,S.DBSYSTEMVALUES_MYSQL=Ri,S.DBSYSTEMVALUES_ORACLE=Ni,S.DBSYSTEMVALUES_DB2=wT,S.DBSYSTEMVALUES_POSTGRESQL=UT,S.DBSYSTEMVALUES_REDSHIFT=kT,S.DBSYSTEMVALUES_HIVE=GT,S.DBSYSTEMVALUES_CLOUDSCAPE=VT,S.DBSYSTEMVALUES_HSQLDB=xT,S.DBSYSTEMVALUES_PROGRESS=$T,S.DBSYSTEMVALUES_MAXDB=BT,S.DBSYSTEMVALUES_HANADB=HT,S.DBSYSTEMVALUES_INGRES=FT,S.DBSYSTEMVALUES_FIRSTSQL=YT,S.DBSYSTEMVALUES_EDB=jT,S.DBSYSTEMVALUES_CACHE=qT,S.DBSYSTEMVALUES_ADABAS=WT,S.DBSYSTEMVALUES_FIREBIRD=KT,S.DBSYSTEMVALUES_DERBY=zT,S.DBSYSTEMVALUES_FILEMAKER=ZT,S.DBSYSTEMVALUES_INFORMIX=XT,S.DBSYSTEMVALUES_INSTANTDB=QT,S.DBSYSTEMVALUES_INTERBASE=JT,S.DBSYSTEMVALUES_MARIADB=eh,S.DBSYSTEMVALUES_NETEZZA=th,S.DBSYSTEMVALUES_PERVASIVE=nh,S.DBSYSTEMVALUES_POINTBASE=rh,S.DBSYSTEMVALUES_SQLITE=oh,S.DBSYSTEMVALUES_SYBASE=sh,S.DBSYSTEMVALUES_TERADATA=ih,S.DBSYSTEMVALUES_VERTICA=ah,S.DBSYSTEMVALUES_H2=ch,S.DBSYSTEMVALUES_COLDFUSION=uh,S.DBSYSTEMVALUES_CASSANDRA=lh,S.DBSYSTEMVALUES_HBASE=dh,S.DBSYSTEMVALUES_MONGODB=fh,S.DBSYSTEMVALUES_REDIS=_h,S.DBSYSTEMVALUES_COUCHBASE=ph,S.DBSYSTEMVALUES_COUCHDB=Eh,S.DBSYSTEMVALUES_COSMOSDB=Th,S.DBSYSTEMVALUES_DYNAMODB=hh,S.DBSYSTEMVALUES_NEO4J=Sh,S.DBSYSTEMVALUES_GEODE=mh,S.DBSYSTEMVALUES_ELASTICSEARCH=Ah,S.DBSYSTEMVALUES_MEMCACHED=gh,S.DBSYSTEMVALUES_COCKROACHDB=Rh,S.DbSystemValues=(0,e.createConstMap)([Ai,gi,Ri,Ni,wT,UT,kT,GT,VT,xT,$T,BT,HT,FT,YT,jT,qT,WT,KT,zT,ZT,XT,QT,JT,eh,th,nh,rh,oh,sh,ih,ah,ch,uh,lh,dh,fh,_h,ph,Eh,Th,hh,Sh,mh,Ah,gh,Rh]);const Nh="all",yh="each_quorum",Oh="quorum",bh="local_quorum",Ih="one",Ch="two",Mh="three",Ph="local_one",vh="any",Lh="serial",Dh="local_serial";S.DBCASSANDRACONSISTENCYLEVELVALUES_ALL=Nh,S.DBCASSANDRACONSISTENCYLEVELVALUES_EACH_QUORUM=yh,S.DBCASSANDRACONSISTENCYLEVELVALUES_QUORUM=Oh,S.DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_QUORUM=bh,S.DBCASSANDRACONSISTENCYLEVELVALUES_ONE=Ih,S.DBCASSANDRACONSISTENCYLEVELVALUES_TWO=Ch,S.DBCASSANDRACONSISTENCYLEVELVALUES_THREE=Mh,S.DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_ONE=Ph,S.DBCASSANDRACONSISTENCYLEVELVALUES_ANY=vh,S.DBCASSANDRACONSISTENCYLEVELVALUES_SERIAL=Lh,S.DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_SERIAL=Dh,S.DbCassandraConsistencyLevelValues=(0,e.createConstMap)([Nh,yh,Oh,bh,Ih,Ch,Mh,Ph,vh,Lh,Dh]);const wh="datasource",Uh="http",kh="pubsub",Gh="timer",Vh="other";S.FAASTRIGGERVALUES_DATASOURCE=wh,S.FAASTRIGGERVALUES_HTTP=Uh,S.FAASTRIGGERVALUES_PUBSUB=kh,S.FAASTRIGGERVALUES_TIMER=Gh,S.FAASTRIGGERVALUES_OTHER=Vh,S.FaasTriggerValues=(0,e.createConstMap)([wh,Uh,kh,Gh,Vh]);const xh="insert",$h="edit",Bh="delete";S.FAASDOCUMENTOPERATIONVALUES_INSERT=xh,S.FAASDOCUMENTOPERATIONVALUES_EDIT=$h,S.FAASDOCUMENTOPERATIONVALUES_DELETE=Bh,S.FaasDocumentOperationValues=(0,e.createConstMap)([xh,$h,Bh]);const Hh="alibaba_cloud",Fh="aws",Yh="azure",jh="gcp";S.FAASINVOKEDPROVIDERVALUES_ALIBABA_CLOUD=Hh,S.FAASINVOKEDPROVIDERVALUES_AWS=Fh,S.FAASINVOKEDPROVIDERVALUES_AZURE=Yh,S.FAASINVOKEDPROVIDERVALUES_GCP=jh,S.FaasInvokedProviderValues=(0,e.createConstMap)([Hh,Fh,Yh,jh]);const qh="ip_tcp",Wh="ip_udp",Kh="ip",zh="unix",Zh="pipe",Xh="inproc",Qh="other";S.NETTRANSPORTVALUES_IP_TCP=qh,S.NETTRANSPORTVALUES_IP_UDP=Wh,S.NETTRANSPORTVALUES_IP=Kh,S.NETTRANSPORTVALUES_UNIX=zh,S.NETTRANSPORTVALUES_PIPE=Zh,S.NETTRANSPORTVALUES_INPROC=Xh,S.NETTRANSPORTVALUES_OTHER=Qh,S.NetTransportValues=(0,e.createConstMap)([qh,Wh,Kh,zh,Zh,Xh,Qh]);const Jh="wifi",eS="wired",tS="cell",nS="unavailable",rS="unknown";S.NETHOSTCONNECTIONTYPEVALUES_WIFI=Jh,S.NETHOSTCONNECTIONTYPEVALUES_WIRED=eS,S.NETHOSTCONNECTIONTYPEVALUES_CELL=tS,S.NETHOSTCONNECTIONTYPEVALUES_UNAVAILABLE=nS,S.NETHOSTCONNECTIONTYPEVALUES_UNKNOWN=rS,S.NetHostConnectionTypeValues=(0,e.createConstMap)([Jh,eS,tS,nS,rS]);const oS="gprs",sS="edge",iS="umts",aS="cdma",cS="evdo_0",uS="evdo_a",lS="cdma2000_1xrtt",dS="hsdpa",fS="hsupa",_S="hspa",pS="iden",ES="evdo_b",TS="lte",hS="ehrpd",SS="hspap",mS="gsm",AS="td_scdma",gS="iwlan",RS="nr",NS="nrnsa",yS="lte_ca";S.NETHOSTCONNECTIONSUBTYPEVALUES_GPRS=oS,S.NETHOSTCONNECTIONSUBTYPEVALUES_EDGE=sS,S.NETHOSTCONNECTIONSUBTYPEVALUES_UMTS=iS,S.NETHOSTCONNECTIONSUBTYPEVALUES_CDMA=aS,S.NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_0=cS,S.NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_A=uS,S.NETHOSTCONNECTIONSUBTYPEVALUES_CDMA2000_1XRTT=lS,S.NETHOSTCONNECTIONSUBTYPEVALUES_HSDPA=dS,S.NETHOSTCONNECTIONSUBTYPEVALUES_HSUPA=fS,S.NETHOSTCONNECTIONSUBTYPEVALUES_HSPA=_S,S.NETHOSTCONNECTIONSUBTYPEVALUES_IDEN=pS,S.NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_B=ES,S.NETHOSTCONNECTIONSUBTYPEVALUES_LTE=TS,S.NETHOSTCONNECTIONSUBTYPEVALUES_EHRPD=hS,S.NETHOSTCONNECTIONSUBTYPEVALUES_HSPAP=SS,S.NETHOSTCONNECTIONSUBTYPEVALUES_GSM=mS,S.NETHOSTCONNECTIONSUBTYPEVALUES_TD_SCDMA=AS,S.NETHOSTCONNECTIONSUBTYPEVALUES_IWLAN=gS,S.NETHOSTCONNECTIONSUBTYPEVALUES_NR=RS,S.NETHOSTCONNECTIONSUBTYPEVALUES_NRNSA=NS,S.NETHOSTCONNECTIONSUBTYPEVALUES_LTE_CA=yS,S.NetHostConnectionSubtypeValues=(0,e.createConstMap)([oS,sS,iS,aS,cS,uS,lS,dS,fS,_S,pS,ES,TS,hS,SS,mS,AS,gS,RS,NS,yS]);const OS="1.0",bS="1.1",IS="2.0",CS="SPDY",MS="QUIC";S.HTTPFLAVORVALUES_HTTP_1_0=OS,S.HTTPFLAVORVALUES_HTTP_1_1=bS,S.HTTPFLAVORVALUES_HTTP_2_0=IS,S.HTTPFLAVORVALUES_SPDY=CS,S.HTTPFLAVORVALUES_QUIC=MS,S.HttpFlavorValues={HTTP_1_0:OS,HTTP_1_1:bS,HTTP_2_0:IS,SPDY:CS,QUIC:MS};const PS="queue",vS="topic";S.MESSAGINGDESTINATIONKINDVALUES_QUEUE=PS,S.MESSAGINGDESTINATIONKINDVALUES_TOPIC=vS,S.MessagingDestinationKindValues=(0,e.createConstMap)([PS,vS]);const LS="receive",DS="process";S.MESSAGINGOPERATIONVALUES_RECEIVE=LS,S.MESSAGINGOPERATIONVALUES_PROCESS=DS,S.MessagingOperationValues=(0,e.createConstMap)([LS,DS]);const wS=0,US=1,kS=2,GS=3,VS=4,xS=5,$S=6,BS=7,HS=8,FS=9,YS=10,jS=11,qS=12,WS=13,KS=14,zS=15,ZS=16;S.RPCGRPCSTATUSCODEVALUES_OK=wS,S.RPCGRPCSTATUSCODEVALUES_CANCELLED=US,S.RPCGRPCSTATUSCODEVALUES_UNKNOWN=kS,S.RPCGRPCSTATUSCODEVALUES_INVALID_ARGUMENT=GS,S.RPCGRPCSTATUSCODEVALUES_DEADLINE_EXCEEDED=VS,S.RPCGRPCSTATUSCODEVALUES_NOT_FOUND=xS,S.RPCGRPCSTATUSCODEVALUES_ALREADY_EXISTS=$S,S.RPCGRPCSTATUSCODEVALUES_PERMISSION_DENIED=BS,S.RPCGRPCSTATUSCODEVALUES_RESOURCE_EXHAUSTED=HS,S.RPCGRPCSTATUSCODEVALUES_FAILED_PRECONDITION=FS,S.RPCGRPCSTATUSCODEVALUES_ABORTED=YS,S.RPCGRPCSTATUSCODEVALUES_OUT_OF_RANGE=jS,S.RPCGRPCSTATUSCODEVALUES_UNIMPLEMENTED=qS,S.RPCGRPCSTATUSCODEVALUES_INTERNAL=WS,S.RPCGRPCSTATUSCODEVALUES_UNAVAILABLE=KS,S.RPCGRPCSTATUSCODEVALUES_DATA_LOSS=zS,S.RPCGRPCSTATUSCODEVALUES_UNAUTHENTICATED=ZS,S.RpcGrpcStatusCodeValues={OK:wS,CANCELLED:US,UNKNOWN:kS,INVALID_ARGUMENT:GS,DEADLINE_EXCEEDED:VS,NOT_FOUND:xS,ALREADY_EXISTS:$S,PERMISSION_DENIED:BS,RESOURCE_EXHAUSTED:HS,FAILED_PRECONDITION:FS,ABORTED:YS,OUT_OF_RANGE:jS,UNIMPLEMENTED:qS,INTERNAL:WS,UNAVAILABLE:KS,DATA_LOSS:zS,UNAUTHENTICATED:ZS};const XS="SENT",QS="RECEIVED";return S.MESSAGETYPEVALUES_SENT=XS,S.MESSAGETYPEVALUES_RECEIVED=QS,S.MessageTypeValues=(0,e.createConstMap)([XS,QS]),S}var Xm;function Lw(){return Xm||(Xm=1,(function(e){var t=mr&&mr.__createBinding||(Object.create?(function(r,o,s,i){i===void 0&&(i=s);var a=Object.getOwnPropertyDescriptor(o,s);(!a||("get"in a?!o.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return o[s]}}),Object.defineProperty(r,i,a)}):(function(r,o,s,i){i===void 0&&(i=s),r[i]=o[s]})),n=mr&&mr.__exportStar||function(r,o){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(o,s)&&t(o,r,s)};Object.defineProperty(e,"__esModule",{value:!0}),n(vw(),e)})(mr)),mr}var Ar={},N={},Qm;function Dw(){if(Qm)return N;Qm=1,Object.defineProperty(N,"__esModule",{value:!0}),N.SEMRESATTRS_K8S_STATEFULSET_NAME=N.SEMRESATTRS_K8S_STATEFULSET_UID=N.SEMRESATTRS_K8S_DEPLOYMENT_NAME=N.SEMRESATTRS_K8S_DEPLOYMENT_UID=N.SEMRESATTRS_K8S_REPLICASET_NAME=N.SEMRESATTRS_K8S_REPLICASET_UID=N.SEMRESATTRS_K8S_CONTAINER_NAME=N.SEMRESATTRS_K8S_POD_NAME=N.SEMRESATTRS_K8S_POD_UID=N.SEMRESATTRS_K8S_NAMESPACE_NAME=N.SEMRESATTRS_K8S_NODE_UID=N.SEMRESATTRS_K8S_NODE_NAME=N.SEMRESATTRS_K8S_CLUSTER_NAME=N.SEMRESATTRS_HOST_IMAGE_VERSION=N.SEMRESATTRS_HOST_IMAGE_ID=N.SEMRESATTRS_HOST_IMAGE_NAME=N.SEMRESATTRS_HOST_ARCH=N.SEMRESATTRS_HOST_TYPE=N.SEMRESATTRS_HOST_NAME=N.SEMRESATTRS_HOST_ID=N.SEMRESATTRS_FAAS_MAX_MEMORY=N.SEMRESATTRS_FAAS_INSTANCE=N.SEMRESATTRS_FAAS_VERSION=N.SEMRESATTRS_FAAS_ID=N.SEMRESATTRS_FAAS_NAME=N.SEMRESATTRS_DEVICE_MODEL_NAME=N.SEMRESATTRS_DEVICE_MODEL_IDENTIFIER=N.SEMRESATTRS_DEVICE_ID=N.SEMRESATTRS_DEPLOYMENT_ENVIRONMENT=N.SEMRESATTRS_CONTAINER_IMAGE_TAG=N.SEMRESATTRS_CONTAINER_IMAGE_NAME=N.SEMRESATTRS_CONTAINER_RUNTIME=N.SEMRESATTRS_CONTAINER_ID=N.SEMRESATTRS_CONTAINER_NAME=N.SEMRESATTRS_AWS_LOG_STREAM_ARNS=N.SEMRESATTRS_AWS_LOG_STREAM_NAMES=N.SEMRESATTRS_AWS_LOG_GROUP_ARNS=N.SEMRESATTRS_AWS_LOG_GROUP_NAMES=N.SEMRESATTRS_AWS_EKS_CLUSTER_ARN=N.SEMRESATTRS_AWS_ECS_TASK_REVISION=N.SEMRESATTRS_AWS_ECS_TASK_FAMILY=N.SEMRESATTRS_AWS_ECS_TASK_ARN=N.SEMRESATTRS_AWS_ECS_LAUNCHTYPE=N.SEMRESATTRS_AWS_ECS_CLUSTER_ARN=N.SEMRESATTRS_AWS_ECS_CONTAINER_ARN=N.SEMRESATTRS_CLOUD_PLATFORM=N.SEMRESATTRS_CLOUD_AVAILABILITY_ZONE=N.SEMRESATTRS_CLOUD_REGION=N.SEMRESATTRS_CLOUD_ACCOUNT_ID=N.SEMRESATTRS_CLOUD_PROVIDER=void 0,N.CLOUDPLATFORMVALUES_GCP_COMPUTE_ENGINE=N.CLOUDPLATFORMVALUES_AZURE_APP_SERVICE=N.CLOUDPLATFORMVALUES_AZURE_FUNCTIONS=N.CLOUDPLATFORMVALUES_AZURE_AKS=N.CLOUDPLATFORMVALUES_AZURE_CONTAINER_INSTANCES=N.CLOUDPLATFORMVALUES_AZURE_VM=N.CLOUDPLATFORMVALUES_AWS_ELASTIC_BEANSTALK=N.CLOUDPLATFORMVALUES_AWS_LAMBDA=N.CLOUDPLATFORMVALUES_AWS_EKS=N.CLOUDPLATFORMVALUES_AWS_ECS=N.CLOUDPLATFORMVALUES_AWS_EC2=N.CLOUDPLATFORMVALUES_ALIBABA_CLOUD_FC=N.CLOUDPLATFORMVALUES_ALIBABA_CLOUD_ECS=N.CloudProviderValues=N.CLOUDPROVIDERVALUES_GCP=N.CLOUDPROVIDERVALUES_AZURE=N.CLOUDPROVIDERVALUES_AWS=N.CLOUDPROVIDERVALUES_ALIBABA_CLOUD=N.SemanticResourceAttributes=N.SEMRESATTRS_WEBENGINE_DESCRIPTION=N.SEMRESATTRS_WEBENGINE_VERSION=N.SEMRESATTRS_WEBENGINE_NAME=N.SEMRESATTRS_TELEMETRY_AUTO_VERSION=N.SEMRESATTRS_TELEMETRY_SDK_VERSION=N.SEMRESATTRS_TELEMETRY_SDK_LANGUAGE=N.SEMRESATTRS_TELEMETRY_SDK_NAME=N.SEMRESATTRS_SERVICE_VERSION=N.SEMRESATTRS_SERVICE_INSTANCE_ID=N.SEMRESATTRS_SERVICE_NAMESPACE=N.SEMRESATTRS_SERVICE_NAME=N.SEMRESATTRS_PROCESS_RUNTIME_DESCRIPTION=N.SEMRESATTRS_PROCESS_RUNTIME_VERSION=N.SEMRESATTRS_PROCESS_RUNTIME_NAME=N.SEMRESATTRS_PROCESS_OWNER=N.SEMRESATTRS_PROCESS_COMMAND_ARGS=N.SEMRESATTRS_PROCESS_COMMAND_LINE=N.SEMRESATTRS_PROCESS_COMMAND=N.SEMRESATTRS_PROCESS_EXECUTABLE_PATH=N.SEMRESATTRS_PROCESS_EXECUTABLE_NAME=N.SEMRESATTRS_PROCESS_PID=N.SEMRESATTRS_OS_VERSION=N.SEMRESATTRS_OS_NAME=N.SEMRESATTRS_OS_DESCRIPTION=N.SEMRESATTRS_OS_TYPE=N.SEMRESATTRS_K8S_CRONJOB_NAME=N.SEMRESATTRS_K8S_CRONJOB_UID=N.SEMRESATTRS_K8S_JOB_NAME=N.SEMRESATTRS_K8S_JOB_UID=N.SEMRESATTRS_K8S_DAEMONSET_NAME=N.SEMRESATTRS_K8S_DAEMONSET_UID=void 0,N.TelemetrySdkLanguageValues=N.TELEMETRYSDKLANGUAGEVALUES_WEBJS=N.TELEMETRYSDKLANGUAGEVALUES_RUBY=N.TELEMETRYSDKLANGUAGEVALUES_PYTHON=N.TELEMETRYSDKLANGUAGEVALUES_PHP=N.TELEMETRYSDKLANGUAGEVALUES_NODEJS=N.TELEMETRYSDKLANGUAGEVALUES_JAVA=N.TELEMETRYSDKLANGUAGEVALUES_GO=N.TELEMETRYSDKLANGUAGEVALUES_ERLANG=N.TELEMETRYSDKLANGUAGEVALUES_DOTNET=N.TELEMETRYSDKLANGUAGEVALUES_CPP=N.OsTypeValues=N.OSTYPEVALUES_Z_OS=N.OSTYPEVALUES_SOLARIS=N.OSTYPEVALUES_AIX=N.OSTYPEVALUES_HPUX=N.OSTYPEVALUES_DRAGONFLYBSD=N.OSTYPEVALUES_OPENBSD=N.OSTYPEVALUES_NETBSD=N.OSTYPEVALUES_FREEBSD=N.OSTYPEVALUES_DARWIN=N.OSTYPEVALUES_LINUX=N.OSTYPEVALUES_WINDOWS=N.HostArchValues=N.HOSTARCHVALUES_X86=N.HOSTARCHVALUES_PPC64=N.HOSTARCHVALUES_PPC32=N.HOSTARCHVALUES_IA64=N.HOSTARCHVALUES_ARM64=N.HOSTARCHVALUES_ARM32=N.HOSTARCHVALUES_AMD64=N.AwsEcsLaunchtypeValues=N.AWSECSLAUNCHTYPEVALUES_FARGATE=N.AWSECSLAUNCHTYPEVALUES_EC2=N.CloudPlatformValues=N.CLOUDPLATFORMVALUES_GCP_APP_ENGINE=N.CLOUDPLATFORMVALUES_GCP_CLOUD_FUNCTIONS=N.CLOUDPLATFORMVALUES_GCP_KUBERNETES_ENGINE=N.CLOUDPLATFORMVALUES_GCP_CLOUD_RUN=void 0;const e=rC(),t="cloud.provider",n="cloud.account.id",r="cloud.region",o="cloud.availability_zone",s="cloud.platform",i="aws.ecs.container.arn",a="aws.ecs.cluster.arn",c="aws.ecs.launchtype",l="aws.ecs.task.arn",f="aws.ecs.task.family",d="aws.ecs.task.revision",u="aws.eks.cluster.arn",_="aws.log.group.names",p="aws.log.group.arns",E="aws.log.stream.names",T="aws.log.stream.arns",h="container.name",m="container.id",A="container.runtime",g="container.image.name",R="container.image.tag",O="deployment.environment",C="device.id",I="device.model.identifier",L="device.model.name",U="faas.name",q="faas.id",H="faas.version",$="faas.instance",B="faas.max_memory",F="host.id",w="host.name",k="host.type",Y="host.arch",oe="host.image.name",ae="host.image.id",ne="host.image.version",M="k8s.cluster.name",P="k8s.node.name",G="k8s.node.uid",V="k8s.namespace.name",K="k8s.pod.uid",X="k8s.pod.name",v="k8s.container.name",D="k8s.replicaset.uid",z="k8s.replicaset.name",j="k8s.deployment.uid",ee="k8s.deployment.name",te="k8s.statefulset.uid",_e="k8s.statefulset.name",se="k8s.daemonset.uid",ce="k8s.daemonset.name",he="k8s.job.uid",ve="k8s.job.name",De="k8s.cronjob.uid",qe="k8s.cronjob.name",Mt="os.type",st="os.description",it="os.name",nt="os.version",is="process.pid",as="process.executable.name",cs="process.executable.path",us="process.command",ls="process.command_line",ds="process.command_args",fs="process.owner",_s="process.runtime.name",ps="process.runtime.version",Es="process.runtime.description",Ts="service.name",hs="service.namespace",Ss="service.instance.id",ms="service.version",As="telemetry.sdk.name",gs="telemetry.sdk.language",Rs="telemetry.sdk.version",Ns="telemetry.auto.version",ys="webengine.name",Os="webengine.version",bs="webengine.description";N.SEMRESATTRS_CLOUD_PROVIDER=t,N.SEMRESATTRS_CLOUD_ACCOUNT_ID=n,N.SEMRESATTRS_CLOUD_REGION=r,N.SEMRESATTRS_CLOUD_AVAILABILITY_ZONE=o,N.SEMRESATTRS_CLOUD_PLATFORM=s,N.SEMRESATTRS_AWS_ECS_CONTAINER_ARN=i,N.SEMRESATTRS_AWS_ECS_CLUSTER_ARN=a,N.SEMRESATTRS_AWS_ECS_LAUNCHTYPE=c,N.SEMRESATTRS_AWS_ECS_TASK_ARN=l,N.SEMRESATTRS_AWS_ECS_TASK_FAMILY=f,N.SEMRESATTRS_AWS_ECS_TASK_REVISION=d,N.SEMRESATTRS_AWS_EKS_CLUSTER_ARN=u,N.SEMRESATTRS_AWS_LOG_GROUP_NAMES=_,N.SEMRESATTRS_AWS_LOG_GROUP_ARNS=p,N.SEMRESATTRS_AWS_LOG_STREAM_NAMES=E,N.SEMRESATTRS_AWS_LOG_STREAM_ARNS=T,N.SEMRESATTRS_CONTAINER_NAME=h,N.SEMRESATTRS_CONTAINER_ID=m,N.SEMRESATTRS_CONTAINER_RUNTIME=A,N.SEMRESATTRS_CONTAINER_IMAGE_NAME=g,N.SEMRESATTRS_CONTAINER_IMAGE_TAG=R,N.SEMRESATTRS_DEPLOYMENT_ENVIRONMENT=O,N.SEMRESATTRS_DEVICE_ID=C,N.SEMRESATTRS_DEVICE_MODEL_IDENTIFIER=I,N.SEMRESATTRS_DEVICE_MODEL_NAME=L,N.SEMRESATTRS_FAAS_NAME=U,N.SEMRESATTRS_FAAS_ID=q,N.SEMRESATTRS_FAAS_VERSION=H,N.SEMRESATTRS_FAAS_INSTANCE=$,N.SEMRESATTRS_FAAS_MAX_MEMORY=B,N.SEMRESATTRS_HOST_ID=F,N.SEMRESATTRS_HOST_NAME=w,N.SEMRESATTRS_HOST_TYPE=k,N.SEMRESATTRS_HOST_ARCH=Y,N.SEMRESATTRS_HOST_IMAGE_NAME=oe,N.SEMRESATTRS_HOST_IMAGE_ID=ae,N.SEMRESATTRS_HOST_IMAGE_VERSION=ne,N.SEMRESATTRS_K8S_CLUSTER_NAME=M,N.SEMRESATTRS_K8S_NODE_NAME=P,N.SEMRESATTRS_K8S_NODE_UID=G,N.SEMRESATTRS_K8S_NAMESPACE_NAME=V,N.SEMRESATTRS_K8S_POD_UID=K,N.SEMRESATTRS_K8S_POD_NAME=X,N.SEMRESATTRS_K8S_CONTAINER_NAME=v,N.SEMRESATTRS_K8S_REPLICASET_UID=D,N.SEMRESATTRS_K8S_REPLICASET_NAME=z,N.SEMRESATTRS_K8S_DEPLOYMENT_UID=j,N.SEMRESATTRS_K8S_DEPLOYMENT_NAME=ee,N.SEMRESATTRS_K8S_STATEFULSET_UID=te,N.SEMRESATTRS_K8S_STATEFULSET_NAME=_e,N.SEMRESATTRS_K8S_DAEMONSET_UID=se,N.SEMRESATTRS_K8S_DAEMONSET_NAME=ce,N.SEMRESATTRS_K8S_JOB_UID=he,N.SEMRESATTRS_K8S_JOB_NAME=ve,N.SEMRESATTRS_K8S_CRONJOB_UID=De,N.SEMRESATTRS_K8S_CRONJOB_NAME=qe,N.SEMRESATTRS_OS_TYPE=Mt,N.SEMRESATTRS_OS_DESCRIPTION=st,N.SEMRESATTRS_OS_NAME=it,N.SEMRESATTRS_OS_VERSION=nt,N.SEMRESATTRS_PROCESS_PID=is,N.SEMRESATTRS_PROCESS_EXECUTABLE_NAME=as,N.SEMRESATTRS_PROCESS_EXECUTABLE_PATH=cs,N.SEMRESATTRS_PROCESS_COMMAND=us,N.SEMRESATTRS_PROCESS_COMMAND_LINE=ls,N.SEMRESATTRS_PROCESS_COMMAND_ARGS=ds,N.SEMRESATTRS_PROCESS_OWNER=fs,N.SEMRESATTRS_PROCESS_RUNTIME_NAME=_s,N.SEMRESATTRS_PROCESS_RUNTIME_VERSION=ps,N.SEMRESATTRS_PROCESS_RUNTIME_DESCRIPTION=Es,N.SEMRESATTRS_SERVICE_NAME=Ts,N.SEMRESATTRS_SERVICE_NAMESPACE=hs,N.SEMRESATTRS_SERVICE_INSTANCE_ID=Ss,N.SEMRESATTRS_SERVICE_VERSION=ms,N.SEMRESATTRS_TELEMETRY_SDK_NAME=As,N.SEMRESATTRS_TELEMETRY_SDK_LANGUAGE=gs,N.SEMRESATTRS_TELEMETRY_SDK_VERSION=Rs,N.SEMRESATTRS_TELEMETRY_AUTO_VERSION=Ns,N.SEMRESATTRS_WEBENGINE_NAME=ys,N.SEMRESATTRS_WEBENGINE_VERSION=Os,N.SEMRESATTRS_WEBENGINE_DESCRIPTION=bs,N.SemanticResourceAttributes=(0,e.createConstMap)([t,n,r,o,s,i,a,c,l,f,d,u,_,p,E,T,h,m,A,g,R,O,C,I,L,U,q,H,$,B,F,w,k,Y,oe,ae,ne,M,P,G,V,K,X,v,D,z,j,ee,te,_e,se,ce,he,ve,De,qe,Mt,st,it,nt,is,as,cs,us,ls,ds,fs,_s,ps,Es,Ts,hs,Ss,ms,As,gs,Rs,Ns,ys,Os,bs]);const Is="alibaba_cloud",Cs="aws",Ms="azure",Ps="gcp";N.CLOUDPROVIDERVALUES_ALIBABA_CLOUD=Is,N.CLOUDPROVIDERVALUES_AWS=Cs,N.CLOUDPROVIDERVALUES_AZURE=Ms,N.CLOUDPROVIDERVALUES_GCP=Ps,N.CloudProviderValues=(0,e.createConstMap)([Is,Cs,Ms,Ps]);const vs="alibaba_cloud_ecs",Ls="alibaba_cloud_fc",Ds="aws_ec2",ws="aws_ecs",Us="aws_eks",ks="aws_lambda",Gs="aws_elastic_beanstalk",Vs="azure_vm",xs="azure_container_instances",$s="azure_aks",Bs="azure_functions",Hs="azure_app_service",Fs="gcp_compute_engine",Ys="gcp_cloud_run",js="gcp_kubernetes_engine",qs="gcp_cloud_functions",Ws="gcp_app_engine";N.CLOUDPLATFORMVALUES_ALIBABA_CLOUD_ECS=vs,N.CLOUDPLATFORMVALUES_ALIBABA_CLOUD_FC=Ls,N.CLOUDPLATFORMVALUES_AWS_EC2=Ds,N.CLOUDPLATFORMVALUES_AWS_ECS=ws,N.CLOUDPLATFORMVALUES_AWS_EKS=Us,N.CLOUDPLATFORMVALUES_AWS_LAMBDA=ks,N.CLOUDPLATFORMVALUES_AWS_ELASTIC_BEANSTALK=Gs,N.CLOUDPLATFORMVALUES_AZURE_VM=Vs,N.CLOUDPLATFORMVALUES_AZURE_CONTAINER_INSTANCES=xs,N.CLOUDPLATFORMVALUES_AZURE_AKS=$s,N.CLOUDPLATFORMVALUES_AZURE_FUNCTIONS=Bs,N.CLOUDPLATFORMVALUES_AZURE_APP_SERVICE=Hs,N.CLOUDPLATFORMVALUES_GCP_COMPUTE_ENGINE=Fs,N.CLOUDPLATFORMVALUES_GCP_CLOUD_RUN=Ys,N.CLOUDPLATFORMVALUES_GCP_KUBERNETES_ENGINE=js,N.CLOUDPLATFORMVALUES_GCP_CLOUD_FUNCTIONS=qs,N.CLOUDPLATFORMVALUES_GCP_APP_ENGINE=Ws,N.CloudPlatformValues=(0,e.createConstMap)([vs,Ls,Ds,ws,Us,ks,Gs,Vs,xs,$s,Bs,Hs,Fs,Ys,js,qs,Ws]);const Ks="ec2",zs="fargate";N.AWSECSLAUNCHTYPEVALUES_EC2=Ks,N.AWSECSLAUNCHTYPEVALUES_FARGATE=zs,N.AwsEcsLaunchtypeValues=(0,e.createConstMap)([Ks,zs]);const Zs="amd64",Xs="arm32",Qs="arm64",Js="ia64",ei="ppc32",ti="ppc64",ni="x86";N.HOSTARCHVALUES_AMD64=Zs,N.HOSTARCHVALUES_ARM32=Xs,N.HOSTARCHVALUES_ARM64=Qs,N.HOSTARCHVALUES_IA64=Js,N.HOSTARCHVALUES_PPC32=ei,N.HOSTARCHVALUES_PPC64=ti,N.HOSTARCHVALUES_X86=ni,N.HostArchValues=(0,e.createConstMap)([Zs,Xs,Qs,Js,ei,ti,ni]);const ri="windows",oi="linux",si="darwin",ii="freebsd",ai="netbsd",ci="openbsd",ui="dragonflybsd",li="hpux",di="aix",fi="solaris",_i="z_os";N.OSTYPEVALUES_WINDOWS=ri,N.OSTYPEVALUES_LINUX=oi,N.OSTYPEVALUES_DARWIN=si,N.OSTYPEVALUES_FREEBSD=ii,N.OSTYPEVALUES_NETBSD=ai,N.OSTYPEVALUES_OPENBSD=ci,N.OSTYPEVALUES_DRAGONFLYBSD=ui,N.OSTYPEVALUES_HPUX=li,N.OSTYPEVALUES_AIX=di,N.OSTYPEVALUES_SOLARIS=fi,N.OSTYPEVALUES_Z_OS=_i,N.OsTypeValues=(0,e.createConstMap)([ri,oi,si,ii,ai,ci,ui,li,di,fi,_i]);const pi="cpp",Ei="dotnet",Ti="erlang",hi="go",Si="java",mi="nodejs",Ai="php",gi="python",Ri="ruby",Ni="webjs";return N.TELEMETRYSDKLANGUAGEVALUES_CPP=pi,N.TELEMETRYSDKLANGUAGEVALUES_DOTNET=Ei,N.TELEMETRYSDKLANGUAGEVALUES_ERLANG=Ti,N.TELEMETRYSDKLANGUAGEVALUES_GO=hi,N.TELEMETRYSDKLANGUAGEVALUES_JAVA=Si,N.TELEMETRYSDKLANGUAGEVALUES_NODEJS=mi,N.TELEMETRYSDKLANGUAGEVALUES_PHP=Ai,N.TELEMETRYSDKLANGUAGEVALUES_PYTHON=gi,N.TELEMETRYSDKLANGUAGEVALUES_RUBY=Ri,N.TELEMETRYSDKLANGUAGEVALUES_WEBJS=Ni,N.TelemetrySdkLanguageValues=(0,e.createConstMap)([pi,Ei,Ti,hi,Si,mi,Ai,gi,Ri,Ni]),N}var Jm;function ww(){return Jm||(Jm=1,(function(e){var t=Ar&&Ar.__createBinding||(Object.create?(function(r,o,s,i){i===void 0&&(i=s);var a=Object.getOwnPropertyDescriptor(o,s);(!a||("get"in a?!o.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return o[s]}}),Object.defineProperty(r,i,a)}):(function(r,o,s,i){i===void 0&&(i=s),r[i]=o[s]})),n=Ar&&Ar.__exportStar||function(r,o){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(o,s)&&t(o,r,s)};Object.defineProperty(e,"__esModule",{value:!0}),n(Dw(),e)})(Ar)),Ar}var y={},eA;function Uw(){if(eA)return y;eA=1,Object.defineProperty(y,"__esModule",{value:!0}),y.ATTR_EXCEPTION_TYPE=y.ATTR_EXCEPTION_STACKTRACE=y.ATTR_EXCEPTION_MESSAGE=y.ATTR_EXCEPTION_ESCAPED=y.ERROR_TYPE_VALUE_OTHER=y.ATTR_ERROR_TYPE=y.DOTNET_GC_HEAP_GENERATION_VALUE_POH=y.DOTNET_GC_HEAP_GENERATION_VALUE_LOH=y.DOTNET_GC_HEAP_GENERATION_VALUE_GEN2=y.DOTNET_GC_HEAP_GENERATION_VALUE_GEN1=y.DOTNET_GC_HEAP_GENERATION_VALUE_GEN0=y.ATTR_DOTNET_GC_HEAP_GENERATION=y.DB_SYSTEM_NAME_VALUE_POSTGRESQL=y.DB_SYSTEM_NAME_VALUE_MYSQL=y.DB_SYSTEM_NAME_VALUE_MICROSOFT_SQL_SERVER=y.DB_SYSTEM_NAME_VALUE_MARIADB=y.ATTR_DB_SYSTEM_NAME=y.ATTR_DB_STORED_PROCEDURE_NAME=y.ATTR_DB_RESPONSE_STATUS_CODE=y.ATTR_DB_QUERY_TEXT=y.ATTR_DB_QUERY_SUMMARY=y.ATTR_DB_OPERATION_NAME=y.ATTR_DB_OPERATION_BATCH_SIZE=y.ATTR_DB_NAMESPACE=y.ATTR_DB_COLLECTION_NAME=y.ATTR_CODE_STACKTRACE=y.ATTR_CODE_LINE_NUMBER=y.ATTR_CODE_FUNCTION_NAME=y.ATTR_CODE_FILE_PATH=y.ATTR_CODE_COLUMN_NUMBER=y.ATTR_CLIENT_PORT=y.ATTR_CLIENT_ADDRESS=y.ATTR_ASPNETCORE_USER_IS_AUTHENTICATED=y.ASPNETCORE_ROUTING_MATCH_STATUS_VALUE_SUCCESS=y.ASPNETCORE_ROUTING_MATCH_STATUS_VALUE_FAILURE=y.ATTR_ASPNETCORE_ROUTING_MATCH_STATUS=y.ATTR_ASPNETCORE_ROUTING_IS_FALLBACK=y.ATTR_ASPNETCORE_REQUEST_IS_UNHANDLED=y.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_REQUEST_CANCELED=y.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_GLOBAL_LIMITER=y.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_ENDPOINT_LIMITER=y.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_ACQUIRED=y.ATTR_ASPNETCORE_RATE_LIMITING_RESULT=y.ATTR_ASPNETCORE_RATE_LIMITING_POLICY=y.ATTR_ASPNETCORE_DIAGNOSTICS_HANDLER_TYPE=y.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_UNHANDLED=y.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_SKIPPED=y.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_HANDLED=y.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_ABORTED=y.ATTR_ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT=void 0,y.OTEL_STATUS_CODE_VALUE_ERROR=y.ATTR_OTEL_STATUS_CODE=y.ATTR_OTEL_SCOPE_VERSION=y.ATTR_OTEL_SCOPE_NAME=y.NETWORK_TYPE_VALUE_IPV6=y.NETWORK_TYPE_VALUE_IPV4=y.ATTR_NETWORK_TYPE=y.NETWORK_TRANSPORT_VALUE_UNIX=y.NETWORK_TRANSPORT_VALUE_UDP=y.NETWORK_TRANSPORT_VALUE_TCP=y.NETWORK_TRANSPORT_VALUE_QUIC=y.NETWORK_TRANSPORT_VALUE_PIPE=y.ATTR_NETWORK_TRANSPORT=y.ATTR_NETWORK_PROTOCOL_VERSION=y.ATTR_NETWORK_PROTOCOL_NAME=y.ATTR_NETWORK_PEER_PORT=y.ATTR_NETWORK_PEER_ADDRESS=y.ATTR_NETWORK_LOCAL_PORT=y.ATTR_NETWORK_LOCAL_ADDRESS=y.JVM_THREAD_STATE_VALUE_WAITING=y.JVM_THREAD_STATE_VALUE_TIMED_WAITING=y.JVM_THREAD_STATE_VALUE_TERMINATED=y.JVM_THREAD_STATE_VALUE_RUNNABLE=y.JVM_THREAD_STATE_VALUE_NEW=y.JVM_THREAD_STATE_VALUE_BLOCKED=y.ATTR_JVM_THREAD_STATE=y.ATTR_JVM_THREAD_DAEMON=y.JVM_MEMORY_TYPE_VALUE_NON_HEAP=y.JVM_MEMORY_TYPE_VALUE_HEAP=y.ATTR_JVM_MEMORY_TYPE=y.ATTR_JVM_MEMORY_POOL_NAME=y.ATTR_JVM_GC_NAME=y.ATTR_JVM_GC_ACTION=y.ATTR_HTTP_ROUTE=y.ATTR_HTTP_RESPONSE_STATUS_CODE=y.ATTR_HTTP_RESPONSE_HEADER=y.ATTR_HTTP_REQUEST_RESEND_COUNT=y.ATTR_HTTP_REQUEST_METHOD_ORIGINAL=y.HTTP_REQUEST_METHOD_VALUE_TRACE=y.HTTP_REQUEST_METHOD_VALUE_PUT=y.HTTP_REQUEST_METHOD_VALUE_POST=y.HTTP_REQUEST_METHOD_VALUE_PATCH=y.HTTP_REQUEST_METHOD_VALUE_OPTIONS=y.HTTP_REQUEST_METHOD_VALUE_HEAD=y.HTTP_REQUEST_METHOD_VALUE_GET=y.HTTP_REQUEST_METHOD_VALUE_DELETE=y.HTTP_REQUEST_METHOD_VALUE_CONNECT=y.HTTP_REQUEST_METHOD_VALUE_OTHER=y.ATTR_HTTP_REQUEST_METHOD=y.ATTR_HTTP_REQUEST_HEADER=void 0,y.ATTR_USER_AGENT_ORIGINAL=y.ATTR_URL_SCHEME=y.ATTR_URL_QUERY=y.ATTR_URL_PATH=y.ATTR_URL_FULL=y.ATTR_URL_FRAGMENT=y.ATTR_TELEMETRY_SDK_VERSION=y.ATTR_TELEMETRY_SDK_NAME=y.TELEMETRY_SDK_LANGUAGE_VALUE_WEBJS=y.TELEMETRY_SDK_LANGUAGE_VALUE_SWIFT=y.TELEMETRY_SDK_LANGUAGE_VALUE_RUST=y.TELEMETRY_SDK_LANGUAGE_VALUE_RUBY=y.TELEMETRY_SDK_LANGUAGE_VALUE_PYTHON=y.TELEMETRY_SDK_LANGUAGE_VALUE_PHP=y.TELEMETRY_SDK_LANGUAGE_VALUE_NODEJS=y.TELEMETRY_SDK_LANGUAGE_VALUE_JAVA=y.TELEMETRY_SDK_LANGUAGE_VALUE_GO=y.TELEMETRY_SDK_LANGUAGE_VALUE_ERLANG=y.TELEMETRY_SDK_LANGUAGE_VALUE_DOTNET=y.TELEMETRY_SDK_LANGUAGE_VALUE_CPP=y.ATTR_TELEMETRY_SDK_LANGUAGE=y.SIGNALR_TRANSPORT_VALUE_WEB_SOCKETS=y.SIGNALR_TRANSPORT_VALUE_SERVER_SENT_EVENTS=y.SIGNALR_TRANSPORT_VALUE_LONG_POLLING=y.ATTR_SIGNALR_TRANSPORT=y.SIGNALR_CONNECTION_STATUS_VALUE_TIMEOUT=y.SIGNALR_CONNECTION_STATUS_VALUE_NORMAL_CLOSURE=y.SIGNALR_CONNECTION_STATUS_VALUE_APP_SHUTDOWN=y.ATTR_SIGNALR_CONNECTION_STATUS=y.ATTR_SERVICE_VERSION=y.ATTR_SERVICE_NAME=y.ATTR_SERVER_PORT=y.ATTR_SERVER_ADDRESS=y.ATTR_OTEL_STATUS_DESCRIPTION=y.OTEL_STATUS_CODE_VALUE_OK=void 0,y.ATTR_ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT="aspnetcore.diagnostics.exception.result",y.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_ABORTED="aborted",y.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_HANDLED="handled",y.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_SKIPPED="skipped",y.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_UNHANDLED="unhandled",y.ATTR_ASPNETCORE_DIAGNOSTICS_HANDLER_TYPE="aspnetcore.diagnostics.handler.type",y.ATTR_ASPNETCORE_RATE_LIMITING_POLICY="aspnetcore.rate_limiting.policy",y.ATTR_ASPNETCORE_RATE_LIMITING_RESULT="aspnetcore.rate_limiting.result",y.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_ACQUIRED="acquired",y.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_ENDPOINT_LIMITER="endpoint_limiter",y.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_GLOBAL_LIMITER="global_limiter",y.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_REQUEST_CANCELED="request_canceled",y.ATTR_ASPNETCORE_REQUEST_IS_UNHANDLED="aspnetcore.request.is_unhandled",y.ATTR_ASPNETCORE_ROUTING_IS_FALLBACK="aspnetcore.routing.is_fallback",y.ATTR_ASPNETCORE_ROUTING_MATCH_STATUS="aspnetcore.routing.match_status",y.ASPNETCORE_ROUTING_MATCH_STATUS_VALUE_FAILURE="failure",y.ASPNETCORE_ROUTING_MATCH_STATUS_VALUE_SUCCESS="success",y.ATTR_ASPNETCORE_USER_IS_AUTHENTICATED="aspnetcore.user.is_authenticated",y.ATTR_CLIENT_ADDRESS="client.address",y.ATTR_CLIENT_PORT="client.port",y.ATTR_CODE_COLUMN_NUMBER="code.column.number",y.ATTR_CODE_FILE_PATH="code.file.path",y.ATTR_CODE_FUNCTION_NAME="code.function.name",y.ATTR_CODE_LINE_NUMBER="code.line.number",y.ATTR_CODE_STACKTRACE="code.stacktrace",y.ATTR_DB_COLLECTION_NAME="db.collection.name",y.ATTR_DB_NAMESPACE="db.namespace",y.ATTR_DB_OPERATION_BATCH_SIZE="db.operation.batch.size",y.ATTR_DB_OPERATION_NAME="db.operation.name",y.ATTR_DB_QUERY_SUMMARY="db.query.summary",y.ATTR_DB_QUERY_TEXT="db.query.text",y.ATTR_DB_RESPONSE_STATUS_CODE="db.response.status_code",y.ATTR_DB_STORED_PROCEDURE_NAME="db.stored_procedure.name",y.ATTR_DB_SYSTEM_NAME="db.system.name",y.DB_SYSTEM_NAME_VALUE_MARIADB="mariadb",y.DB_SYSTEM_NAME_VALUE_MICROSOFT_SQL_SERVER="microsoft.sql_server",y.DB_SYSTEM_NAME_VALUE_MYSQL="mysql",y.DB_SYSTEM_NAME_VALUE_POSTGRESQL="postgresql",y.ATTR_DOTNET_GC_HEAP_GENERATION="dotnet.gc.heap.generation",y.DOTNET_GC_HEAP_GENERATION_VALUE_GEN0="gen0",y.DOTNET_GC_HEAP_GENERATION_VALUE_GEN1="gen1",y.DOTNET_GC_HEAP_GENERATION_VALUE_GEN2="gen2",y.DOTNET_GC_HEAP_GENERATION_VALUE_LOH="loh",y.DOTNET_GC_HEAP_GENERATION_VALUE_POH="poh",y.ATTR_ERROR_TYPE="error.type",y.ERROR_TYPE_VALUE_OTHER="_OTHER",y.ATTR_EXCEPTION_ESCAPED="exception.escaped",y.ATTR_EXCEPTION_MESSAGE="exception.message",y.ATTR_EXCEPTION_STACKTRACE="exception.stacktrace",y.ATTR_EXCEPTION_TYPE="exception.type";const e=n=>`http.request.header.${n}`;y.ATTR_HTTP_REQUEST_HEADER=e,y.ATTR_HTTP_REQUEST_METHOD="http.request.method",y.HTTP_REQUEST_METHOD_VALUE_OTHER="_OTHER",y.HTTP_REQUEST_METHOD_VALUE_CONNECT="CONNECT",y.HTTP_REQUEST_METHOD_VALUE_DELETE="DELETE",y.HTTP_REQUEST_METHOD_VALUE_GET="GET",y.HTTP_REQUEST_METHOD_VALUE_HEAD="HEAD",y.HTTP_REQUEST_METHOD_VALUE_OPTIONS="OPTIONS",y.HTTP_REQUEST_METHOD_VALUE_PATCH="PATCH",y.HTTP_REQUEST_METHOD_VALUE_POST="POST",y.HTTP_REQUEST_METHOD_VALUE_PUT="PUT",y.HTTP_REQUEST_METHOD_VALUE_TRACE="TRACE",y.ATTR_HTTP_REQUEST_METHOD_ORIGINAL="http.request.method_original",y.ATTR_HTTP_REQUEST_RESEND_COUNT="http.request.resend_count";const t=n=>`http.response.header.${n}`;return y.ATTR_HTTP_RESPONSE_HEADER=t,y.ATTR_HTTP_RESPONSE_STATUS_CODE="http.response.status_code",y.ATTR_HTTP_ROUTE="http.route",y.ATTR_JVM_GC_ACTION="jvm.gc.action",y.ATTR_JVM_GC_NAME="jvm.gc.name",y.ATTR_JVM_MEMORY_POOL_NAME="jvm.memory.pool.name",y.ATTR_JVM_MEMORY_TYPE="jvm.memory.type",y.JVM_MEMORY_TYPE_VALUE_HEAP="heap",y.JVM_MEMORY_TYPE_VALUE_NON_HEAP="non_heap",y.ATTR_JVM_THREAD_DAEMON="jvm.thread.daemon",y.ATTR_JVM_THREAD_STATE="jvm.thread.state",y.JVM_THREAD_STATE_VALUE_BLOCKED="blocked",y.JVM_THREAD_STATE_VALUE_NEW="new",y.JVM_THREAD_STATE_VALUE_RUNNABLE="runnable",y.JVM_THREAD_STATE_VALUE_TERMINATED="terminated",y.JVM_THREAD_STATE_VALUE_TIMED_WAITING="timed_waiting",y.JVM_THREAD_STATE_VALUE_WAITING="waiting",y.ATTR_NETWORK_LOCAL_ADDRESS="network.local.address",y.ATTR_NETWORK_LOCAL_PORT="network.local.port",y.ATTR_NETWORK_PEER_ADDRESS="network.peer.address",y.ATTR_NETWORK_PEER_PORT="network.peer.port",y.ATTR_NETWORK_PROTOCOL_NAME="network.protocol.name",y.ATTR_NETWORK_PROTOCOL_VERSION="network.protocol.version",y.ATTR_NETWORK_TRANSPORT="network.transport",y.NETWORK_TRANSPORT_VALUE_PIPE="pipe",y.NETWORK_TRANSPORT_VALUE_QUIC="quic",y.NETWORK_TRANSPORT_VALUE_TCP="tcp",y.NETWORK_TRANSPORT_VALUE_UDP="udp",y.NETWORK_TRANSPORT_VALUE_UNIX="unix",y.ATTR_NETWORK_TYPE="network.type",y.NETWORK_TYPE_VALUE_IPV4="ipv4",y.NETWORK_TYPE_VALUE_IPV6="ipv6",y.ATTR_OTEL_SCOPE_NAME="otel.scope.name",y.ATTR_OTEL_SCOPE_VERSION="otel.scope.version",y.ATTR_OTEL_STATUS_CODE="otel.status_code",y.OTEL_STATUS_CODE_VALUE_ERROR="ERROR",y.OTEL_STATUS_CODE_VALUE_OK="OK",y.ATTR_OTEL_STATUS_DESCRIPTION="otel.status_description",y.ATTR_SERVER_ADDRESS="server.address",y.ATTR_SERVER_PORT="server.port",y.ATTR_SERVICE_NAME="service.name",y.ATTR_SERVICE_VERSION="service.version",y.ATTR_SIGNALR_CONNECTION_STATUS="signalr.connection.status",y.SIGNALR_CONNECTION_STATUS_VALUE_APP_SHUTDOWN="app_shutdown",y.SIGNALR_CONNECTION_STATUS_VALUE_NORMAL_CLOSURE="normal_closure",y.SIGNALR_CONNECTION_STATUS_VALUE_TIMEOUT="timeout",y.ATTR_SIGNALR_TRANSPORT="signalr.transport",y.SIGNALR_TRANSPORT_VALUE_LONG_POLLING="long_polling",y.SIGNALR_TRANSPORT_VALUE_SERVER_SENT_EVENTS="server_sent_events",y.SIGNALR_TRANSPORT_VALUE_WEB_SOCKETS="web_sockets",y.ATTR_TELEMETRY_SDK_LANGUAGE="telemetry.sdk.language",y.TELEMETRY_SDK_LANGUAGE_VALUE_CPP="cpp",y.TELEMETRY_SDK_LANGUAGE_VALUE_DOTNET="dotnet",y.TELEMETRY_SDK_LANGUAGE_VALUE_ERLANG="erlang",y.TELEMETRY_SDK_LANGUAGE_VALUE_GO="go",y.TELEMETRY_SDK_LANGUAGE_VALUE_JAVA="java",y.TELEMETRY_SDK_LANGUAGE_VALUE_NODEJS="nodejs",y.TELEMETRY_SDK_LANGUAGE_VALUE_PHP="php",y.TELEMETRY_SDK_LANGUAGE_VALUE_PYTHON="python",y.TELEMETRY_SDK_LANGUAGE_VALUE_RUBY="ruby",y.TELEMETRY_SDK_LANGUAGE_VALUE_RUST="rust",y.TELEMETRY_SDK_LANGUAGE_VALUE_SWIFT="swift",y.TELEMETRY_SDK_LANGUAGE_VALUE_WEBJS="webjs",y.ATTR_TELEMETRY_SDK_NAME="telemetry.sdk.name",y.ATTR_TELEMETRY_SDK_VERSION="telemetry.sdk.version",y.ATTR_URL_FRAGMENT="url.fragment",y.ATTR_URL_FULL="url.full",y.ATTR_URL_PATH="url.path",y.ATTR_URL_QUERY="url.query",y.ATTR_URL_SCHEME="url.scheme",y.ATTR_USER_AGENT_ORIGINAL="user_agent.original",y}var Z={},tA;function kw(){return tA||(tA=1,Object.defineProperty(Z,"__esModule",{value:!0}),Z.METRIC_SIGNALR_SERVER_ACTIVE_CONNECTIONS=Z.METRIC_KESTREL_UPGRADED_CONNECTIONS=Z.METRIC_KESTREL_TLS_HANDSHAKE_DURATION=Z.METRIC_KESTREL_REJECTED_CONNECTIONS=Z.METRIC_KESTREL_QUEUED_REQUESTS=Z.METRIC_KESTREL_QUEUED_CONNECTIONS=Z.METRIC_KESTREL_CONNECTION_DURATION=Z.METRIC_KESTREL_ACTIVE_TLS_HANDSHAKES=Z.METRIC_KESTREL_ACTIVE_CONNECTIONS=Z.METRIC_JVM_THREAD_COUNT=Z.METRIC_JVM_MEMORY_USED_AFTER_LAST_GC=Z.METRIC_JVM_MEMORY_USED=Z.METRIC_JVM_MEMORY_LIMIT=Z.METRIC_JVM_MEMORY_COMMITTED=Z.METRIC_JVM_GC_DURATION=Z.METRIC_JVM_CPU_TIME=Z.METRIC_JVM_CPU_RECENT_UTILIZATION=Z.METRIC_JVM_CPU_COUNT=Z.METRIC_JVM_CLASS_UNLOADED=Z.METRIC_JVM_CLASS_LOADED=Z.METRIC_JVM_CLASS_COUNT=Z.METRIC_HTTP_SERVER_REQUEST_DURATION=Z.METRIC_HTTP_CLIENT_REQUEST_DURATION=Z.METRIC_DOTNET_TIMER_COUNT=Z.METRIC_DOTNET_THREAD_POOL_WORK_ITEM_COUNT=Z.METRIC_DOTNET_THREAD_POOL_THREAD_COUNT=Z.METRIC_DOTNET_THREAD_POOL_QUEUE_LENGTH=Z.METRIC_DOTNET_PROCESS_MEMORY_WORKING_SET=Z.METRIC_DOTNET_PROCESS_CPU_TIME=Z.METRIC_DOTNET_PROCESS_CPU_COUNT=Z.METRIC_DOTNET_MONITOR_LOCK_CONTENTIONS=Z.METRIC_DOTNET_JIT_COMPILED_METHODS=Z.METRIC_DOTNET_JIT_COMPILED_IL_SIZE=Z.METRIC_DOTNET_JIT_COMPILATION_TIME=Z.METRIC_DOTNET_GC_PAUSE_TIME=Z.METRIC_DOTNET_GC_LAST_COLLECTION_MEMORY_COMMITTED_SIZE=Z.METRIC_DOTNET_GC_LAST_COLLECTION_HEAP_SIZE=Z.METRIC_DOTNET_GC_LAST_COLLECTION_HEAP_FRAGMENTATION_SIZE=Z.METRIC_DOTNET_GC_HEAP_TOTAL_ALLOCATED=Z.METRIC_DOTNET_GC_COLLECTIONS=Z.METRIC_DOTNET_EXCEPTIONS=Z.METRIC_DOTNET_ASSEMBLY_COUNT=Z.METRIC_DB_CLIENT_OPERATION_DURATION=Z.METRIC_ASPNETCORE_ROUTING_MATCH_ATTEMPTS=Z.METRIC_ASPNETCORE_RATE_LIMITING_REQUESTS=Z.METRIC_ASPNETCORE_RATE_LIMITING_REQUEST_LEASE_DURATION=Z.METRIC_ASPNETCORE_RATE_LIMITING_REQUEST_TIME_IN_QUEUE=Z.METRIC_ASPNETCORE_RATE_LIMITING_QUEUED_REQUESTS=Z.METRIC_ASPNETCORE_RATE_LIMITING_ACTIVE_REQUEST_LEASES=Z.METRIC_ASPNETCORE_DIAGNOSTICS_EXCEPTIONS=void 0,Z.METRIC_SIGNALR_SERVER_CONNECTION_DURATION=void 0,Z.METRIC_ASPNETCORE_DIAGNOSTICS_EXCEPTIONS="aspnetcore.diagnostics.exceptions",Z.METRIC_ASPNETCORE_RATE_LIMITING_ACTIVE_REQUEST_LEASES="aspnetcore.rate_limiting.active_request_leases",Z.METRIC_ASPNETCORE_RATE_LIMITING_QUEUED_REQUESTS="aspnetcore.rate_limiting.queued_requests",Z.METRIC_ASPNETCORE_RATE_LIMITING_REQUEST_TIME_IN_QUEUE="aspnetcore.rate_limiting.request.time_in_queue",Z.METRIC_ASPNETCORE_RATE_LIMITING_REQUEST_LEASE_DURATION="aspnetcore.rate_limiting.request_lease.duration",Z.METRIC_ASPNETCORE_RATE_LIMITING_REQUESTS="aspnetcore.rate_limiting.requests",Z.METRIC_ASPNETCORE_ROUTING_MATCH_ATTEMPTS="aspnetcore.routing.match_attempts",Z.METRIC_DB_CLIENT_OPERATION_DURATION="db.client.operation.duration",Z.METRIC_DOTNET_ASSEMBLY_COUNT="dotnet.assembly.count",Z.METRIC_DOTNET_EXCEPTIONS="dotnet.exceptions",Z.METRIC_DOTNET_GC_COLLECTIONS="dotnet.gc.collections",Z.METRIC_DOTNET_GC_HEAP_TOTAL_ALLOCATED="dotnet.gc.heap.total_allocated",Z.METRIC_DOTNET_GC_LAST_COLLECTION_HEAP_FRAGMENTATION_SIZE="dotnet.gc.last_collection.heap.fragmentation.size",Z.METRIC_DOTNET_GC_LAST_COLLECTION_HEAP_SIZE="dotnet.gc.last_collection.heap.size",Z.METRIC_DOTNET_GC_LAST_COLLECTION_MEMORY_COMMITTED_SIZE="dotnet.gc.last_collection.memory.committed_size",Z.METRIC_DOTNET_GC_PAUSE_TIME="dotnet.gc.pause.time",Z.METRIC_DOTNET_JIT_COMPILATION_TIME="dotnet.jit.compilation.time",Z.METRIC_DOTNET_JIT_COMPILED_IL_SIZE="dotnet.jit.compiled_il.size",Z.METRIC_DOTNET_JIT_COMPILED_METHODS="dotnet.jit.compiled_methods",Z.METRIC_DOTNET_MONITOR_LOCK_CONTENTIONS="dotnet.monitor.lock_contentions",Z.METRIC_DOTNET_PROCESS_CPU_COUNT="dotnet.process.cpu.count",Z.METRIC_DOTNET_PROCESS_CPU_TIME="dotnet.process.cpu.time",Z.METRIC_DOTNET_PROCESS_MEMORY_WORKING_SET="dotnet.process.memory.working_set",Z.METRIC_DOTNET_THREAD_POOL_QUEUE_LENGTH="dotnet.thread_pool.queue.length",Z.METRIC_DOTNET_THREAD_POOL_THREAD_COUNT="dotnet.thread_pool.thread.count",Z.METRIC_DOTNET_THREAD_POOL_WORK_ITEM_COUNT="dotnet.thread_pool.work_item.count",Z.METRIC_DOTNET_TIMER_COUNT="dotnet.timer.count",Z.METRIC_HTTP_CLIENT_REQUEST_DURATION="http.client.request.duration",Z.METRIC_HTTP_SERVER_REQUEST_DURATION="http.server.request.duration",Z.METRIC_JVM_CLASS_COUNT="jvm.class.count",Z.METRIC_JVM_CLASS_LOADED="jvm.class.loaded",Z.METRIC_JVM_CLASS_UNLOADED="jvm.class.unloaded",Z.METRIC_JVM_CPU_COUNT="jvm.cpu.count",Z.METRIC_JVM_CPU_RECENT_UTILIZATION="jvm.cpu.recent_utilization",Z.METRIC_JVM_CPU_TIME="jvm.cpu.time",Z.METRIC_JVM_GC_DURATION="jvm.gc.duration",Z.METRIC_JVM_MEMORY_COMMITTED="jvm.memory.committed",Z.METRIC_JVM_MEMORY_LIMIT="jvm.memory.limit",Z.METRIC_JVM_MEMORY_USED="jvm.memory.used",Z.METRIC_JVM_MEMORY_USED_AFTER_LAST_GC="jvm.memory.used_after_last_gc",Z.METRIC_JVM_THREAD_COUNT="jvm.thread.count",Z.METRIC_KESTREL_ACTIVE_CONNECTIONS="kestrel.active_connections",Z.METRIC_KESTREL_ACTIVE_TLS_HANDSHAKES="kestrel.active_tls_handshakes",Z.METRIC_KESTREL_CONNECTION_DURATION="kestrel.connection.duration",Z.METRIC_KESTREL_QUEUED_CONNECTIONS="kestrel.queued_connections",Z.METRIC_KESTREL_QUEUED_REQUESTS="kestrel.queued_requests",Z.METRIC_KESTREL_REJECTED_CONNECTIONS="kestrel.rejected_connections",Z.METRIC_KESTREL_TLS_HANDSHAKE_DURATION="kestrel.tls_handshake.duration",Z.METRIC_KESTREL_UPGRADED_CONNECTIONS="kestrel.upgraded_connections",Z.METRIC_SIGNALR_SERVER_ACTIVE_CONNECTIONS="signalr.server.active_connections",Z.METRIC_SIGNALR_SERVER_CONNECTION_DURATION="signalr.server.connection.duration"),Z}var Qi={},nA;function Gw(){return nA||(nA=1,Object.defineProperty(Qi,"__esModule",{value:!0}),Qi.EVENT_EXCEPTION=void 0,Qi.EVENT_EXCEPTION="exception"),Qi}var rA;function _t(){return rA||(rA=1,(function(e){var t=Sr&&Sr.__createBinding||(Object.create?(function(r,o,s,i){i===void 0&&(i=s);var a=Object.getOwnPropertyDescriptor(o,s);(!a||("get"in a?!o.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return o[s]}}),Object.defineProperty(r,i,a)}):(function(r,o,s,i){i===void 0&&(i=s),r[i]=o[s]})),n=Sr&&Sr.__exportStar||function(r,o){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(o,s)&&t(o,r,s)};Object.defineProperty(e,"__esModule",{value:!0}),n(Lw(),e),n(ww(),e),n(Uw(),e),n(kw(),e),n(Gw(),e)})(Sr)),Sr}var Q=_t();const Vw="process.runtime.name",Xc={[Q.ATTR_TELEMETRY_SDK_NAME]:"opentelemetry",[Vw]:"node",[Q.ATTR_TELEMETRY_SDK_LANGUAGE]:Q.TELEMETRY_SDK_LANGUAGE_VALUE_NODEJS,[Q.ATTR_TELEMETRY_SDK_VERSION]:Pw},oC=9,xw=6,$w=Math.pow(10,xw),au=Math.pow(10,oC);function Gn(e){const t=e/1e3,n=Math.trunc(t),r=Math.round(e%1e3*$w);return[n,r]}function Ju(){let e=zr.timeOrigin;if(typeof e!="number"){const t=zr;e=t.timing&&t.timing.fetchStart}return e}function sE(e){const t=Gn(Ju()),n=Gn(typeof e=="number"?e:zr.now());return iE(t,n)}function Bw(e){if(el(e))return e;if(typeof e=="number")return e<Ju()?sE(e):Gn(e);if(e instanceof Date)return Gn(e.getTime());throw TypeError("Invalid input type")}function sC(e,t){let n=t[0]-e[0],r=t[1]-e[1];return r<0&&(n-=1,r+=au),[n,r]}function Hw(e){const t=oC,n=`${"0".repeat(t)}${e[1]}Z`,r=n.substring(n.length-t-1);return new Date(e[0]*1e3).toISOString().replace("000Z",r)}function Fw(e){return e[0]*au+e[1]}function Yw(e){return e[0]*1e3+e[1]/1e6}function jw(e){return e[0]*1e6+e[1]/1e3}function el(e){return Array.isArray(e)&&e.length===2&&typeof e[0]=="number"&&typeof e[1]=="number"}function op(e){return el(e)||typeof e=="number"||e instanceof Date}function iE(e,t){const n=[e[0]+t[0],e[1]+t[1]];return n[1]>=au&&(n[1]-=au,n[0]+=1),n}function qw(e){typeof e!="number"&&e.unref()}var sp;(function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAILED=1]="FAILED"})(sp||(sp={}));class Ww{_propagators;_fields;constructor(t={}){this._propagators=t.propagators??[],this._fields=Array.from(new Set(this._propagators.map(n=>typeof n.fields=="function"?n.fields():[]).reduce((n,r)=>n.concat(r),[])))}inject(t,n,r){for(const o of this._propagators)try{o.inject(t,n,r)}catch(s){b.diag.warn(`Failed to inject with ${o.constructor.name}. Err: ${s.message}`)}}extract(t,n,r){return this._propagators.reduce((o,s)=>{try{return s.extract(o,n,r)}catch(i){b.diag.warn(`Failed to extract with ${s.constructor.name}. Err: ${i.message}`)}return o},t)}fields(){return this._fields.slice()}}const ip="[_0-9a-z-*/]",Kw=`[a-z]${ip}{0,255}`,zw=`[a-z0-9]${ip}{0,240}@[a-z]${ip}{0,13}`,Zw=new RegExp(`^(?:${Kw}|${zw})$`),Xw=/^[ -~]{0,255}[!-~]$/,Qw=/,|=/;function Jw(e){return Zw.test(e)}function e0(e){return Xw.test(e)&&!Qw.test(e)}const oA=32,t0=512,sA=",",iA="=";class Zo{_internalState=new Map;constructor(t){t&&this._parse(t)}set(t,n){const r=this._clone();return r._internalState.has(t)&&r._internalState.delete(t),r._internalState.set(t,n),r}unset(t){const n=this._clone();return n._internalState.delete(t),n}get(t){return this._internalState.get(t)}serialize(){return this._keys().reduce((t,n)=>(t.push(n+iA+this.get(n)),t),[]).join(sA)}_parse(t){t.length>t0||(this._internalState=t.split(sA).reverse().reduce((n,r)=>{const o=r.trim(),s=o.indexOf(iA);if(s!==-1){const i=o.slice(0,s),a=o.slice(s+1,r.length);Jw(i)&&e0(a)&&n.set(i,a)}return n},new Map),this._internalState.size>oA&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,oA))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){const t=new Zo;return t._internalState=new Map(this._internalState),t}}const Qc="traceparent",Jc="tracestate",n0="00",r0="(?!ff)[\\da-f]{2}",o0="(?![0]{32})[\\da-f]{32}",s0="(?![0]{16})[\\da-f]{16}",i0="[\\da-f]{2}",a0=new RegExp(`^\\s?(${r0})-(${o0})-(${s0})-(${i0})(-.*)?\\s?$`);function iC(e){const t=a0.exec(e);return!t||t[1]==="00"&&t[5]?null:{traceId:t[2],spanId:t[3],traceFlags:parseInt(t[4],16)}}class c0{inject(t,n,r){const o=b.trace.getSpanContext(t);if(!o||Nn(t)||!b.isSpanContextValid(o))return;const s=`${n0}-${o.traceId}-${o.spanId}-0${Number(o.traceFlags||b.TraceFlags.NONE).toString(16)}`;r.set(n,Qc,s),o.traceState&&r.set(n,Jc,o.traceState.serialize())}extract(t,n,r){const o=r.get(n,Qc);if(!o)return t;const s=Array.isArray(o)?o[0]:o;if(typeof s!="string")return t;const i=iC(s);if(!i)return t;i.isRemote=!0;const a=r.get(n,Jc);if(a){const c=Array.isArray(a)?a.join(","):a;i.traceState=new Zo(typeof c=="string"?c:void 0)}return b.trace.setSpanContext(t,i)}fields(){return[Qc,Jc]}}const aE=b.createContextKey("OpenTelemetry SDK Context Key RPC_METADATA");var Qr;(function(e){e.HTTP="http"})(Qr||(Qr={}));function aC(e,t){return e.setValue(aE,t)}function u0(e){return e.deleteValue(aE)}function tl(e){return e.getValue(aE)}const l0="[object Object]",d0="[object Null]",f0="[object Undefined]",_0=Function.prototype,cC=_0.toString,p0=cC.call(Object),E0=Object.getPrototypeOf,uC=Object.prototype,lC=uC.hasOwnProperty,Wr=Symbol?Symbol.toStringTag:void 0,dC=uC.toString;function aA(e){if(!T0(e)||h0(e)!==l0)return!1;const t=E0(e);if(t===null)return!0;const n=lC.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&cC.call(n)===p0}function T0(e){return e!=null&&typeof e=="object"}function h0(e){return e==null?e===void 0?f0:d0:Wr&&Wr in Object(e)?S0(e):m0(e)}function S0(e){const t=lC.call(e,Wr),n=e[Wr];let r=!1;try{e[Wr]=void 0,r=!0}catch{}const o=dC.call(e);return r&&(t?e[Wr]=n:delete e[Wr]),o}function m0(e){return dC.call(e)}const A0=20;function fC(...e){let t=e.shift();const n=new WeakMap;for(;e.length>0;)t=_C(t,e.shift(),0,n);return t}function od(e){return cu(e)?e.slice():e}function _C(e,t,n=0,r){let o;if(!(n>A0)){if(n++,eu(e)||eu(t)||pC(t))o=od(t);else if(cu(e)){if(o=e.slice(),cu(t))for(let s=0,i=t.length;s<i;s++)o.push(od(t[s]));else if(Ji(t)){const s=Object.keys(t);for(let i=0,a=s.length;i<a;i++){const c=s[i];o[c]=od(t[c])}}}else if(Ji(e))if(Ji(t)){if(!g0(e,t))return t;o=Object.assign({},e);const s=Object.keys(t);for(let i=0,a=s.length;i<a;i++){const c=s[i],l=t[c];if(eu(l))typeof l>"u"?delete o[c]:o[c]=l;else{const f=o[c],d=l;if(cA(e,c,r)||cA(t,c,r))delete o[c];else{if(Ji(f)&&Ji(d)){const u=r.get(f)||[],_=r.get(d)||[];u.push({obj:e,key:c}),_.push({obj:t,key:c}),r.set(f,u),r.set(d,_)}o[c]=_C(o[c],l,n,r)}}}}else o=t;return o}}function cA(e,t,n){const r=n.get(e[t])||[];for(let o=0,s=r.length;o<s;o++){const i=r[o];if(i.key===t&&i.obj===e)return!0}return!1}function cu(e){return Array.isArray(e)}function pC(e){return typeof e=="function"}function Ji(e){return!eu(e)&&!cu(e)&&!pC(e)&&typeof e=="object"}function eu(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e>"u"||e instanceof Date||e instanceof RegExp||e===null}function g0(e,t){return!(!aA(e)||!aA(t))}class nl extends Error{constructor(t){super(t),Object.setPrototypeOf(this,nl.prototype)}}function R0(e,t){let n;const r=new Promise(function(s,i){n=setTimeout(function(){i(new nl("Operation timed out."))},t)});return Promise.race([e,r]).then(o=>(clearTimeout(n),o),o=>{throw clearTimeout(n),o})}function EC(e,t){return typeof t=="string"?e===t:!!e.match(t)}function N0(e,t){if(!t)return!1;for(const n of t)if(EC(e,n))return!0;return!1}class y0{_promise;_resolve;_reject;constructor(){this._promise=new Promise((t,n)=>{this._resolve=t,this._reject=n})}get promise(){return this._promise}resolve(t){this._resolve(t)}reject(t){this._reject(t)}}class O0{_callback;_that;_isCalled=!1;_deferred=new y0;constructor(t,n){this._callback=t,this._that=n}get isCalled(){return this._isCalled}get promise(){return this._deferred.promise}call(...t){if(!this._isCalled){this._isCalled=!0;try{Promise.resolve(this._callback.call(this._that,...t)).then(n=>this._deferred.resolve(n),n=>this._deferred.reject(n))}catch(n){this._deferred.reject(n)}}return this._deferred.promise}}const uA={ALL:b.DiagLogLevel.ALL,VERBOSE:b.DiagLogLevel.VERBOSE,DEBUG:b.DiagLogLevel.DEBUG,INFO:b.DiagLogLevel.INFO,WARN:b.DiagLogLevel.WARN,ERROR:b.DiagLogLevel.ERROR,NONE:b.DiagLogLevel.NONE};function b0(e){if(e==null)return;const t=uA[e.toUpperCase()];return t??(b.diag.warn(`Unknown log level "${e}", expected one of ${Object.keys(uA)}, using default`),b.DiagLogLevel.INFO)}function I0(e,t){return new Promise(n=>{b.context.with(Xr(b.context.active()),()=>{e.export(t,r=>{n(r)})})})}const C0={_export:I0},M0=Object.freeze(Object.defineProperty({__proto__:null,AnchoredClock:gw,BindOnceFuture:O0,CompositePropagator:Ww,get ExportResultCode(){return sp},get RPCType(){return Qr},SDK_INFO:Xc,TRACE_PARENT_HEADER:Qc,TRACE_STATE_HEADER:Jc,TimeoutError:nl,TraceState:Zo,W3CBaggagePropagator:JI,W3CTraceContextPropagator:c0,_globalThis:Mw,addHrTimes:iE,callWithTimeout:R0,deleteRPCMetadata:u0,diagLogLevelFromString:b0,getBooleanFromEnv:Iw,getNumberFromEnv:bt,getRPCMetadata:tl,getStringFromEnv:oE,getStringListFromEnv:Cw,getTimeOrigin:Ju,globalErrorHandler:rE,hrTime:sE,hrTimeDuration:sC,hrTimeToMicroseconds:jw,hrTimeToMilliseconds:Yw,hrTimeToNanoseconds:Fw,hrTimeToTimeStamp:Hw,internal:C0,isAttributeValue:nE,isTimeInput:op,isTimeInputHrTime:el,isTracingSuppressed:Nn,isUrlIgnored:N0,loggingErrorHandler:tC,merge:fC,millisToHrTime:Gn,otperformance:zr,parseKeyPairsIntoRecord:Aw,parseTraceParent:iC,sanitizeAttributes:Ka,setGlobalErrorHandler:bw,setRPCMetadata:aC,suppressTracing:Xr,timeInputToHrTime:Bw,unrefTimer:qw,unsuppressTracing:_w,urlMatches:EC},Symbol.toStringTag,{value:"Module"})),ln=HI(M0);var ea={},lA;function P0(){return lA||(lA=1,Object.defineProperty(ea,"__esModule",{value:!0}),ea.VERSION=void 0,ea.VERSION="0.208.0"),ea}class TC{emit(t){}}const v0=new TC;class L0{getLogger(t,n,r){return new TC}}const hC=new L0;class D0{constructor(t,n,r,o){this._provider=t,this.name=n,this.version=r,this.options=o}emit(t){this._getLogger().emit(t)}_getLogger(){if(this._delegate)return this._delegate;const t=this._provider._getDelegateLogger(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):v0}}class dA{getLogger(t,n,r){var o;return(o=this._getDelegateLogger(t,n,r))!==null&&o!==void 0?o:new D0(this,t,n,r)}_getDelegate(){var t;return(t=this._delegate)!==null&&t!==void 0?t:hC}_setDelegate(t){this._delegate=t}_getDelegateLogger(t,n,r){var o;return(o=this._delegate)===null||o===void 0?void 0:o.getLogger(t,n,r)}}const w0=typeof globalThis=="object"?globalThis:global,Oc=Symbol.for("io.opentelemetry.js.api.logs"),ta=w0;function U0(e,t,n){return r=>r===e?t:n}const fA=1;class cE{constructor(){this._proxyLoggerProvider=new dA}static getInstance(){return this._instance||(this._instance=new cE),this._instance}setGlobalLoggerProvider(t){return ta[Oc]?this.getLoggerProvider():(ta[Oc]=U0(fA,t,hC),this._proxyLoggerProvider._setDelegate(t),t)}getLoggerProvider(){var t,n;return(n=(t=ta[Oc])===null||t===void 0?void 0:t.call(ta,fA))!==null&&n!==void 0?n:this._proxyLoggerProvider}getLogger(t,n,r){return this.getLoggerProvider().getLogger(t,n,r)}disable(){delete ta[Oc],this._proxyLoggerProvider=new dA}}const SC=cE.getInstance();function k0(e,t,n,r){for(let o=0,s=e.length;o<s;o++){const i=e[o];t&&i.setTracerProvider(t),n&&i.setMeterProvider(n),r&&i.setLoggerProvider&&i.setLoggerProvider(r),i.getConfig().enabled||i.enable()}}function G0(e){e.forEach(t=>t.disable())}function rl(e){const t=e.tracerProvider||b.trace.getTracerProvider(),n=e.meterProvider||b.metrics.getMeterProvider(),r=e.loggerProvider||SC.getLoggerProvider(),o=e.instrumentations?.flat()??[];return k0(o,t,n,r),()=>{G0(o)}}const mC=/^(?:v)?(?<version>(?<major>0|[1-9]\d*)\.(?<minor>0|[1-9]\d*)\.(?<patch>0|[1-9]\d*))(?:-(?<prerelease>(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+(?<build>[0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/,V0=/^(?<op><|>|=|==|<=|>=|~|\^|~>)?\s*(?:v)?(?<version>(?<major>x|X|\*|0|[1-9]\d*)(?:\.(?<minor>x|X|\*|0|[1-9]\d*))?(?:\.(?<patch>x|X|\*|0|[1-9]\d*))?)(?:-(?<prerelease>(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+(?<build>[0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/,x0={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]};function $0(e,t,n){if(!B0(e))return b.diag.error(`Invalid version: ${e}`),!1;if(!t)return!0;t=t.replace(/([<>=~^]+)\s+/g,"$1");const r=j0(e);if(!r)return!1;const o=[],s=AC(r,t,o,n);return s&&!n?.includePrerelease?F0(r,o):s}function B0(e){return typeof e=="string"&&mC.test(e)}function AC(e,t,n,r){if(t.includes("||")){const o=t.trim().split("||");for(const s of o)if(sd(e,s,n,r))return!0;return!1}else if(t.includes(" - "))t=fU(t,r);else if(t.includes(" ")){const o=t.trim().replace(/\s{2,}/g," ").split(" ");for(const s of o)if(!sd(e,s,n,r))return!1;return!0}return sd(e,t,n,r)}function sd(e,t,n,r){if(t=Y0(t,r),t.includes(" "))return AC(e,t,n,r);{const o=q0(t);return n.push(o),H0(e,o)}}function H0(e,t){if(t.invalid)return!1;if(!t.version||ap(t.version))return!0;let n=pA(e.versionSegments||[],t.versionSegments||[]);if(n===0){const r=e.prereleaseSegments||[],o=t.prereleaseSegments||[];!r.length&&!o.length?n=0:!r.length&&o.length?n=1:r.length&&!o.length?n=-1:n=pA(r,o)}return x0[t.op]?.includes(n)}function F0(e,t){return e.prerelease?t.some(n=>n.prerelease&&n.version===e.version):!0}function Y0(e,t){return e=e.trim(),e=lU(e,t),e=uU(e),e=dU(e,t),e=e.trim(),e}function gt(e){return!e||e.toLowerCase()==="x"||e==="*"}function j0(e){const t=e.match(mC);if(!t){b.diag.error(`Invalid version: ${e}`);return}const n=t.groups.version,r=t.groups.prerelease,o=t.groups.build,s=n.split("."),i=r?.split(".");return{op:void 0,version:n,versionSegments:s,versionSegmentCount:s.length,prerelease:r,prereleaseSegments:i,prereleaseSegmentCount:i?i.length:0,build:o}}function q0(e){if(!e)return{};const t=e.match(V0);if(!t)return b.diag.error(`Invalid range: ${e}`),{invalid:!0};let n=t.groups.op;const r=t.groups.version,o=t.groups.prerelease,s=t.groups.build,i=r.split("."),a=o?.split(".");return n==="=="&&(n="="),{op:n||"=",version:r,versionSegments:i,versionSegmentCount:i.length,prerelease:o,prereleaseSegments:a,prereleaseSegmentCount:a?a.length:0,build:s}}function ap(e){return e==="*"||e==="x"||e==="X"}function _A(e){const t=parseInt(e,10);return isNaN(t)?e:t}function W0(e,t){if(typeof e==typeof t){if(typeof e=="number")return[e,t];if(typeof e=="string")return[e,t];throw new Error("Version segments can only be strings or numbers")}else return[String(e),String(t)]}function K0(e,t){if(ap(e)||ap(t))return 0;const[n,r]=W0(_A(e),_A(t));return n>r?1:n<r?-1:0}function pA(e,t){for(let n=0;n<Math.max(e.length,t.length);n++){const r=K0(e[n]||"0",t[n]||"0");if(r!==0)return r}return 0}const gC="[a-zA-Z0-9-]",RC="0|[1-9]\\d*",z0=`\\d*[a-zA-Z-]${gC}*`,Z0="((?:<|>)?=?)",EA=`(?:${RC}|${z0})`,X0=`(?:-(${EA}(?:\\.${EA})*))`,TA=`${gC}+`,Q0=`(?:\\+(${TA}(?:\\.${TA})*))`,id=`${RC}|x|X|\\*`,rc=`[v=\\s]*(${id})(?:\\.(${id})(?:\\.(${id})(?:${X0})?${Q0}?)?)?`,J0=`^${Z0}\\s*${rc}$`,eU=new RegExp(J0),tU=`^\\s*(${rc})\\s+-\\s+(${rc})\\s*$`,nU=new RegExp(tU),rU="(?:~>?)",oU=`^${rU}${rc}$`,sU=new RegExp(oU),iU="(?:\\^)",aU=`^${iU}${rc}$`,cU=new RegExp(aU);function uU(e){const t=sU;return e.replace(t,(n,r,o,s,i)=>{let a;return gt(r)?a="":gt(o)?a=`>=${r}.0.0 <${+r+1}.0.0-0`:gt(s)?a=`>=${r}.${o}.0 <${r}.${+o+1}.0-0`:i?a=`>=${r}.${o}.${s}-${i} <${r}.${+o+1}.0-0`:a=`>=${r}.${o}.${s} <${r}.${+o+1}.0-0`,a})}function lU(e,t){const n=cU,r=t?.includePrerelease?"-0":"";return e.replace(n,(o,s,i,a,c)=>{let l;return gt(s)?l="":gt(i)?l=`>=${s}.0.0${r} <${+s+1}.0.0-0`:gt(a)?s==="0"?l=`>=${s}.${i}.0${r} <${s}.${+i+1}.0-0`:l=`>=${s}.${i}.0${r} <${+s+1}.0.0-0`:c?s==="0"?i==="0"?l=`>=${s}.${i}.${a}-${c} <${s}.${i}.${+a+1}-0`:l=`>=${s}.${i}.${a}-${c} <${s}.${+i+1}.0-0`:l=`>=${s}.${i}.${a}-${c} <${+s+1}.0.0-0`:s==="0"?i==="0"?l=`>=${s}.${i}.${a}${r} <${s}.${i}.${+a+1}-0`:l=`>=${s}.${i}.${a}${r} <${s}.${+i+1}.0-0`:l=`>=${s}.${i}.${a} <${+s+1}.0.0-0`,l})}function dU(e,t){const n=eU;return e.replace(n,(r,o,s,i,a,c)=>{const l=gt(s),f=l||gt(i),d=f||gt(a),u=d;return o==="="&&u&&(o=""),c=t?.includePrerelease?"-0":"",l?o===">"||o==="<"?r="<0.0.0-0":r="*":o&&u?(f&&(i=0),a=0,o===">"?(o=">=",f?(s=+s+1,i=0,a=0):(i=+i+1,a=0)):o==="<="&&(o="<",f?s=+s+1:i=+i+1),o==="<"&&(c="-0"),r=`${o+s}.${i}.${a}${c}`):f?r=`>=${s}.0.0${c} <${+s+1}.0.0-0`:d&&(r=`>=${s}.${i}.0${c} <${s}.${+i+1}.0-0`),r})}function fU(e,t){const n=nU;return e.replace(n,(r,o,s,i,a,c,l,f,d,u,_,p)=>(gt(s)?o="":gt(i)?o=`>=${s}.0.0${t?.includePrerelease?"-0":""}`:gt(a)?o=`>=${s}.${i}.0${t?.includePrerelease?"-0":""}`:c?o=`>=${o}`:o=`>=${o}${t?.includePrerelease?"-0":""}`,gt(d)?f="":gt(u)?f=`<${+d+1}.0.0-0`:gt(_)?f=`<${d}.${+u+1}.0-0`:p?f=`<=${d}.${u}.${_}-${p}`:t?.includePrerelease?f=`<${d}.${u}.${+_+1}-0`:f=`<=${f}`,`${o} ${f}`.trim()))}let wt=console.error.bind(console);function na(e,t,n){const r=!!e[t]&&Object.prototype.propertyIsEnumerable.call(e,t);Object.defineProperty(e,t,{configurable:!0,enumerable:r,writable:!0,value:n})}const uu=(e,t,n)=>{if(!e||!e[t]){wt("no original function "+String(t)+" to wrap");return}if(!n){wt("no wrapper function"),wt(new Error().stack);return}const r=e[t];if(typeof r!="function"||typeof n!="function"){wt("original object and wrapper must be functions");return}const o=n(r,t);return na(o,"__original",r),na(o,"__unwrap",()=>{e[t]===o&&na(e,t,r)}),na(o,"__wrapped",!0),na(e,t,o),o},_U=(e,t,n)=>{if(e)Array.isArray(e)||(e=[e]);else{wt("must provide one or more modules to patch"),wt(new Error().stack);return}if(!(t&&Array.isArray(t))){wt("must provide one or more functions to wrap on modules");return}e.forEach(r=>{t.forEach(o=>{uu(r,o,n)})})},uE=(e,t)=>{if(!e||!e[t]){wt("no function to unwrap."),wt(new Error().stack);return}const n=e[t];if(!n.__unwrap)wt("no original to unwrap to -- has "+String(t)+" already been unwrapped?");else{n.__unwrap();return}},pU=(e,t)=>{if(e)Array.isArray(e)||(e=[e]);else{wt("must provide one or more modules to patch"),wt(new Error().stack);return}if(!(t&&Array.isArray(t))){wt("must provide one or more functions to unwrap on modules");return}e.forEach(n=>{t.forEach(r=>{uE(n,r)})})};class EU{instrumentationName;instrumentationVersion;_config={};_tracer;_meter;_logger;_diag;constructor(t,n,r){this.instrumentationName=t,this.instrumentationVersion=n,this.setConfig(r),this._diag=b.diag.createComponentLogger({namespace:t}),this._tracer=b.trace.getTracer(t,n),this._meter=b.metrics.getMeter(t,n),this._logger=SC.getLogger(t,n),this._updateMetricInstruments()}_wrap=uu;_unwrap=uE;_massWrap=_U;_massUnwrap=pU;get meter(){return this._meter}setMeterProvider(t){this._meter=t.getMeter(this.instrumentationName,this.instrumentationVersion),this._updateMetricInstruments()}get logger(){return this._logger}setLoggerProvider(t){this._logger=t.getLogger(this.instrumentationName,this.instrumentationVersion)}getModuleDefinitions(){const t=this.init()??[];return Array.isArray(t)?t:[t]}_updateMetricInstruments(){}getConfig(){return this._config}setConfig(t){this._config={enabled:!0,...t}}setTracerProvider(t){this._tracer=t.getTracer(this.instrumentationName,this.instrumentationVersion)}get tracer(){return this._tracer}_runSpanCustomizationHook(t,n,r,o){if(t)try{t(r,o)}catch(s){this._diag.error("Error running span customization hook due to exception in handler",{triggerName:n},s)}}}var bc={exports:{}},Ic={exports:{}},Cc={exports:{}},ad,hA;function TU(){if(hA)return ad;hA=1;var e=1e3,t=e*60,n=t*60,r=n*24,o=r*7,s=r*365.25;ad=function(f,d){d=d||{};var u=typeof f;if(u==="string"&&f.length>0)return i(f);if(u==="number"&&isFinite(f))return d.long?c(f):a(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))};function i(f){if(f=String(f),!(f.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(d){var u=parseFloat(d[1]),_=(d[2]||"ms").toLowerCase();switch(_){case"years":case"year":case"yrs":case"yr":case"y":return u*s;case"weeks":case"week":case"w":return u*o;case"days":case"day":case"d":return u*r;case"hours":case"hour":case"hrs":case"hr":case"h":return u*n;case"minutes":case"minute":case"mins":case"min":case"m":return u*t;case"seconds":case"second":case"secs":case"sec":case"s":return u*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return u;default:return}}}}function a(f){var d=Math.abs(f);return d>=r?Math.round(f/r)+"d":d>=n?Math.round(f/n)+"h":d>=t?Math.round(f/t)+"m":d>=e?Math.round(f/e)+"s":f+"ms"}function c(f){var d=Math.abs(f);return d>=r?l(f,d,r,"day"):d>=n?l(f,d,n,"hour"):d>=t?l(f,d,t,"minute"):d>=e?l(f,d,e,"second"):f+" ms"}function l(f,d,u,_){var p=d>=u*1.5;return Math.round(f/u)+" "+_+(p?"s":"")}return ad}var cd,SA;function NC(){if(SA)return cd;SA=1;function e(t){r.debug=r,r.default=r,r.coerce=l,r.disable=a,r.enable=s,r.enabled=c,r.humanize=TU(),r.destroy=f,Object.keys(t).forEach(d=>{r[d]=t[d]}),r.names=[],r.skips=[],r.formatters={};function n(d){let u=0;for(let _=0;_<d.length;_++)u=(u<<5)-u+d.charCodeAt(_),u|=0;return r.colors[Math.abs(u)%r.colors.length]}r.selectColor=n;function r(d){let u,_=null,p,E;function T(...h){if(!T.enabled)return;const m=T,A=Number(new Date),g=A-(u||A);m.diff=g,m.prev=u,m.curr=A,u=A,h[0]=r.coerce(h[0]),typeof h[0]!="string"&&h.unshift("%O");let R=0;h[0]=h[0].replace(/%([a-zA-Z%])/g,(C,I)=>{if(C==="%%")return"%";R++;const L=r.formatters[I];if(typeof L=="function"){const U=h[R];C=L.call(m,U),h.splice(R,1),R--}return C}),r.formatArgs.call(m,h),(m.log||r.log).apply(m,h)}return T.namespace=d,T.useColors=r.useColors(),T.color=r.selectColor(d),T.extend=o,T.destroy=r.destroy,Object.defineProperty(T,"enabled",{enumerable:!0,configurable:!1,get:()=>_!==null?_:(p!==r.namespaces&&(p=r.namespaces,E=r.enabled(d)),E),set:h=>{_=h}}),typeof r.init=="function"&&r.init(T),T}function o(d,u){const _=r(this.namespace+(typeof u>"u"?":":u)+d);return _.log=this.log,_}function s(d){r.save(d),r.namespaces=d,r.names=[],r.skips=[];const u=(typeof d=="string"?d:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const _ of u)_[0]==="-"?r.skips.push(_.slice(1)):r.names.push(_)}function i(d,u){let _=0,p=0,E=-1,T=0;for(;_<d.length;)if(p<u.length&&(u[p]===d[_]||u[p]==="*"))u[p]==="*"?(E=p,T=_,p++):(_++,p++);else if(E!==-1)p=E+1,T++,_=T;else return!1;for(;p<u.length&&u[p]==="*";)p++;return p===u.length}function a(){const d=[...r.names,...r.skips.map(u=>"-"+u)].join(",");return r.enable(""),d}function c(d){for(const u of r.skips)if(i(d,u))return!1;for(const u of r.names)if(i(d,u))return!0;return!1}function l(d){return d instanceof Error?d.stack||d.message:d}function f(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}return cd=e,cd}var mA;function hU(){return mA||(mA=1,(function(e,t){t.formatArgs=r,t.save=o,t.load=s,t.useColors=n,t.storage=i(),t.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;c.splice(1,0,l,"color: inherit");let f=0,d=0;c[0].replace(/%[a-zA-Z%]/g,u=>{u!=="%%"&&(f++,u==="%c"&&(d=f))}),c.splice(d,0,l)}t.log=console.debug||console.log||(()=>{});function o(c){try{c?t.storage.setItem("debug",c):t.storage.removeItem("debug")}catch{}}function s(){let c;try{c=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=process.env.DEBUG),c}function i(){try{return localStorage}catch{}}e.exports=NC()(t);const{formatters:a}=e.exports;a.j=function(c){try{return JSON.stringify(c)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}})(Cc,Cc.exports)),Cc.exports}var Mc={exports:{}},ud,AA;function SU(){return AA||(AA=1,ud=(e,t=process.argv)=>{const n=e.startsWith("-")?"":e.length===1?"-":"--",r=t.indexOf(n+e),o=t.indexOf("--");return r!==-1&&(o===-1||r<o)}),ud}var ld,gA;function mU(){if(gA)return ld;gA=1;const e=bD,t=VI,n=SU(),{env:r}=process;let o;n("no-color")||n("no-colors")||n("color=false")||n("color=never")?o=0:(n("color")||n("colors")||n("color=true")||n("color=always"))&&(o=1);function s(){if("FORCE_COLOR"in r)return r.FORCE_COLOR==="true"?1:r.FORCE_COLOR==="false"?0:r.FORCE_COLOR.length===0?1:Math.min(Number.parseInt(r.FORCE_COLOR,10),3)}function i(l){return l===0?!1:{level:l,hasBasic:!0,has256:l>=2,has16m:l>=3}}function a(l,{streamIsTTY:f,sniffFlags:d=!0}={}){const u=s();u!==void 0&&(o=u);const _=d?o:u;if(_===0)return 0;if(d){if(n("color=16m")||n("color=full")||n("color=truecolor"))return 3;if(n("color=256"))return 2}if(l&&!f&&_===void 0)return 0;const p=_||0;if(r.TERM==="dumb")return p;if(process.platform==="win32"){const E=e.release().split(".");return Number(E[0])>=10&&Number(E[2])>=10586?Number(E[2])>=14931?3:2:1}if("CI"in r)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE","DRONE"].some(E=>E in r)||r.CI_NAME==="codeship"?1:p;if("TEAMCITY_VERSION"in r)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(r.TEAMCITY_VERSION)?1:0;if(r.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in r){const E=Number.parseInt((r.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(r.TERM_PROGRAM){case"iTerm.app":return E>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(r.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(r.TERM)||"COLORTERM"in r?1:p}function c(l,f={}){const d=a(l,{streamIsTTY:l&&l.isTTY,...f});return i(d)}return ld={supportsColor:c,stdout:c({isTTY:t.isatty(1)}),stderr:c({isTTY:t.isatty(2)})},ld}var RA;function AU(){return RA||(RA=1,(function(e,t){const n=VI,r=Zr;t.init=f,t.log=a,t.formatArgs=s,t.save=c,t.load=l,t.useColors=o,t.destroy=r.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),t.colors=[6,2,3,4,5,1];try{const u=mU();u&&(u.stderr||u).level>=2&&(t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}t.inspectOpts=Object.keys(process.env).filter(u=>/^debug_/i.test(u)).reduce((u,_)=>{const p=_.substring(6).toLowerCase().replace(/_([a-z])/g,(T,h)=>h.toUpperCase());let E=process.env[_];return/^(yes|on|true|enabled)$/i.test(E)?E=!0:/^(no|off|false|disabled)$/i.test(E)?E=!1:E==="null"?E=null:E=Number(E),u[p]=E,u},{});function o(){return"colors"in t.inspectOpts?!!t.inspectOpts.colors:n.isatty(process.stderr.fd)}function s(u){const{namespace:_,useColors:p}=this;if(p){const E=this.color,T="\x1B[3"+(E<8?E:"8;5;"+E),h=`  ${T};1m${_} \x1B[0m`;u[0]=h+u[0].split(`
`).join(`
`+h),u.push(T+"m+"+e.exports.humanize(this.diff)+"\x1B[0m")}else u[0]=i()+_+" "+u[0]}function i(){return t.inspectOpts.hideDate?"":new Date().toISOString()+" "}function a(...u){return process.stderr.write(r.formatWithOptions(t.inspectOpts,...u)+`
`)}function c(u){u?process.env.DEBUG=u:delete process.env.DEBUG}function l(){return process.env.DEBUG}function f(u){u.inspectOpts={};const _=Object.keys(t.inspectOpts);for(let p=0;p<_.length;p++)u.inspectOpts[_[p]]=t.inspectOpts[_[p]]}e.exports=NC()(t);const{formatters:d}=e.exports;d.o=function(u){return this.inspectOpts.colors=this.useColors,r.inspect(u,this.inspectOpts).split(`
`).map(_=>_.trim()).join(" ")},d.O=function(u){return this.inspectOpts.colors=this.useColors,r.inspect(u,this.inspectOpts)}})(Mc,Mc.exports)),Mc.exports}var NA;function gU(){return NA||(NA=1,typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?Ic.exports=hU():Ic.exports=AU()),Ic.exports}var dd,yA;function yC(){if(yA)return dd;yA=1;var e=Ec.sep;return dd=function(t){var n=t.split(e),r=n.lastIndexOf("node_modules");if(r!==-1&&n[r+1]){for(var o=n[r+1][0]==="@",s=o?n[r+1]+"/"+n[r+2]:n[r+1],i=o?3:2,a="",c=r+i-1,l=0;l<=c;l++)l===c?a+=n[l]:a+=n[l]+e;for(var f="",d=n.length-1,u=r+i;u<=d;u++)u===d?f+=n[u]:f+=n[u]+e;return{name:s,basedir:a,path:f}}},dd}var OA;function RU(){if(OA)return bc.exports;OA=1;const e=Ec,t=GI,n=gU()("require-in-the-middle"),r=yC();bc.exports=c,bc.exports.Hook=c;let o,s;if(t.isBuiltin)s=t.isBuiltin;else if(t.builtinModules)s=f=>f.startsWith("node:")?!0:(o===void 0&&(o=new Set(t.builtinModules)),o.has(f));else throw new Error("'require-in-the-middle' requires Node.js >=v9.3.0 or >=v8.10.0");const i=/([/\\]index)?(\.js)?$/;class a{constructor(){this._localCache=new Map,this._kRitmExports=Symbol("RitmExports")}has(d,u){if(this._localCache.has(d))return!0;if(u)return!1;{const _=require.cache[d];return!!(_&&this._kRitmExports in _)}}get(d,u){const _=this._localCache.get(d);if(_!==void 0)return _;if(!u){const p=require.cache[d];return p&&p[this._kRitmExports]}}set(d,u,_){_?this._localCache.set(d,u):d in require.cache?require.cache[d][this._kRitmExports]=u:(n('non-core module is unexpectedly not in require.cache: "%s"',d),this._localCache.set(d,u))}}function c(f,d,u){if(!(this instanceof c))return new c(f,d,u);if(typeof f=="function"?(u=f,f=null,d=null):typeof d=="function"&&(u=d,d=null),typeof t._resolveFilename!="function"){console.error("Error: Expected Module._resolveFilename to be a function (was: %s) - aborting!",typeof t._resolveFilename),console.error("Please report this error as an issue related to Node.js %s at https://github.com/nodejs/require-in-the-middle/issues",process.version);return}this._cache=new a,this._unhooked=!1,this._origRequire=t.prototype.require;const _=this,p=new Set,E=d?d.internals===!0:!1,T=Array.isArray(f);n("registering require hook"),this._require=t.prototype.require=function(m){return _._unhooked===!0?(n("ignoring require call - module is soft-unhooked"),_._origRequire.apply(this,arguments)):h.call(this,arguments,!1)},typeof process.getBuiltinModule=="function"&&(this._origGetBuiltinModule=process.getBuiltinModule,this._getBuiltinModule=process.getBuiltinModule=function(m){return _._unhooked===!0?(n("ignoring process.getBuiltinModule call - module is soft-unhooked"),_._origGetBuiltinModule.apply(this,arguments)):h.call(this,arguments,!0)});function h(m,A){const g=m[0],R=s(g);let O;if(R){if(O=g,g.startsWith("node:")){const H=g.slice(5);s(H)&&(O=H)}}else{if(A)return n("call to process.getBuiltinModule with unknown built-in id"),_._origGetBuiltinModule.apply(this,m);try{O=t._resolveFilename(g,this)}catch(H){return n('Module._resolveFilename("%s") threw %j, calling original Module.require',g,H.message),_._origRequire.apply(this,m)}}let C,I;if(n("processing %s module require('%s'): %s",R===!0?"core":"non-core",g,O),_._cache.has(O,R)===!0)return n("returning already patched cached module: %s",O),_._cache.get(O,R);const L=p.has(O);L===!1&&p.add(O);const U=A?_._origGetBuiltinModule.apply(this,m):_._origRequire.apply(this,m);if(L===!0)return n("module is in the process of being patched already - ignoring: %s",O),U;if(p.delete(O),R===!0){if(T===!0&&f.includes(O)===!1)return n("ignoring core module not on whitelist: %s",O),U;C=O}else if(T===!0&&f.includes(O)){const H=e.parse(O);C=H.name,I=H.dir}else{const H=r(O);if(H===void 0)return n("could not parse filename: %s",O),U;C=H.name,I=H.basedir;const $=l(H);n("resolved filename to module: %s (id: %s, resolved: %s, basedir: %s)",C,g,$,I);let B=!1;if(T){if(!g.startsWith(".")&&f.includes(g)&&(C=g,B=!0),!f.includes(C)&&!f.includes($))return U;f.includes($)&&$!==C&&(C=$,B=!0)}if(!B){let F;try{F=require.resolve(C,{paths:[I]})}catch{return n("could not resolve module: %s",C),_._cache.set(O,U,R),U}if(F!==O)if(E===!0)C=C+e.sep+e.relative(I,O),n("preparing to process require of internal file: %s",C);else return n("ignoring require of non-main module file: %s",F),_._cache.set(O,U,R),U}}_._cache.set(O,U,R),n("calling require hook: %s",C);const q=u(U,C,I);return _._cache.set(O,q,R),n("returning module: %s",C),q}}c.prototype.unhook=function(){this._unhooked=!0,this._require===t.prototype.require?(t.prototype.require=this._origRequire,n("require unhook successful")):n("require unhook unsuccessful"),process.getBuiltinModule!==void 0&&(this._getBuiltinModule===process.getBuiltinModule?(process.getBuiltinModule=this._origGetBuiltinModule,n("process.getBuiltinModule unhook successful")):n("process.getBuiltinModule unhook unsuccessful"))};function l(f){const d=e.sep!=="/"?f.path.split(e.sep).join("/"):f.path;return e.posix.join(f.name,d).replace(i,"")}return bc.exports}var OC=RU();const lu="/";class bA{hooks=[];children=new Map}class NU{_trie=new bA;_counter=0;insert(t){let n=this._trie;for(const r of t.moduleName.split(lu)){let o=n.children.get(r);o||(o=new bA,n.children.set(r,o)),n=o}n.hooks.push({hook:t,insertedId:this._counter++})}search(t,{maintainInsertionOrder:n,fullOnly:r}={}){let o=this._trie;const s=[];let i=!0;for(const a of t.split(lu)){const c=o.children.get(a);if(!c){i=!1;break}r||s.push(...c.hooks),o=c}return r&&i&&s.push(...o.hooks),s.length===0?[]:s.length===1?[s[0].hook]:(n&&s.sort((a,c)=>a.insertedId-c.insertedId),s.map(({hook:a})=>a))}}const yU=["afterEach","after","beforeEach","before","describe","it"].every(e=>typeof global[e]=="function");class du{_moduleNameTrie=new NU;static _instance;constructor(){this._initialize()}_initialize(){new OC.Hook(null,{internals:!0},(t,n,r)=>{const o=OU(n),s=this._moduleNameTrie.search(o,{maintainInsertionOrder:!0,fullOnly:r===void 0});for(const{onRequire:i}of s)t=i(t,n,r);return t})}register(t,n){const r={moduleName:t,onRequire:n};return this._moduleNameTrie.insert(r),r}static getInstance(){return yU?new du:this._instance=this._instance??new du}}function OU(e){return qr.sep!==lu?e.split(qr.sep).join(lu):e}var gr={exports:{}},jn={},IA;function bU(){if(IA)return jn;IA=1;const e=[],t=new WeakMap,n=new WeakMap,r=new Map,o=[],s={set(f,d,u){return t.get(f)[d](u)},get(f,d){if(d===Symbol.toStringTag)return"Module";const u=n.get(f)[d];if(typeof u=="function")return u()},defineProperty(f,d,u){if(!("value"in u))throw new Error("Getters/setters are not supported for exports property descriptors.");return t.get(f)[d](u.value)}};function i(f,d,u,_,p){r.set(f,p),t.set(d,u),n.set(d,_);const E=new Proxy(d,s);e.forEach(T=>T(f,E)),o.push([f,E])}let a=!1;function c(){return a}function l(f){a=f}return jn.register=i,jn.importHooks=e,jn.specifiers=r,jn.toHook=o,jn.getExperimentalPatchInternals=c,jn.setExperimentalPatchInternals=l,jn}var CA;function IU(){if(CA)return gr.exports;CA=1;const e=Ec,t=yC(),{fileURLToPath:n}=Zu,{MessageChannel:r}=tp,{importHooks:o,specifiers:s,toHook:i,getExperimentalPatchInternals:a}=bU();function c(p){o.push(p),i.forEach(([E,T])=>p(E,T))}function l(p){const E=o.indexOf(p);E>-1&&o.splice(E,1)}function f(p,E,T,h){const m=p(E,T,h);m&&m!==E&&(E.default=m)}let d;function u(){const{port1:p,port2:E}=new r;let T=0,h;d=R=>{T++,p.postMessage(R)},p.on("message",()=>{T--,h&&T<=0&&h()}).unref();function m(){const R=setInterval(()=>{},1e3),O=new Promise(C=>{h=C}).then(()=>{clearInterval(R)});return T===0&&h(),O}const A=E;return{registerOptions:{data:{addHookMessagePort:A,include:[]},transferList:[A]},addHookMessagePort:A,waitForAllMessagesAcknowledged:m}}function _(p,E,T){if(!(this instanceof _))return new _(p,E,T);typeof p=="function"?(T=p,p=null,E=null):typeof E=="function"&&(T=E,E=null);const h=E?E.internals===!0:!1;d&&Array.isArray(p)&&d(p),this._iitmHook=(m,A)=>{const g=m,R=m.startsWith("node:");let O;if(R)m=m.replace(/^node:/,"");else{if(m.startsWith("file://"))try{m=n(m)}catch{}const C=t(m);C&&(m=C.name,O=C.basedir)}if(p){for(const C of p)if(C===m){if(O){if(h)m=m+e.sep+e.relative(O,n(g));else if(!a()&&!O.endsWith(s.get(g)))continue}f(T,A,m,O)}}else f(T,A,m,O)},c(this._iitmHook)}return _.prototype.unhook=function(){l(this._iitmHook)},gr.exports=_,gr.exports.Hook=_,gr.exports.addHook=c,gr.exports.removeHook=l,gr.exports.createAddHookMessageChannel=u,gr.exports}var bC=IU();function er(e,t,n){let r,o;try{o=e()}catch(s){r=s}finally{if(t(r,o),r&&!n)throw r;return o}}async function CU(e,t,n){let r,o;try{o=await e()}catch(s){r=s}finally{if(await t(r,o),r&&!n)throw r;return o}}function ol(e){return typeof e=="function"&&typeof e.__original=="function"&&typeof e.__unwrap=="function"&&e.__wrapped===!0}class yt extends EU{_modules;_hooks=[];_requireInTheMiddleSingleton=du.getInstance();_enabled=!1;constructor(t,n,r){super(t,n,r);let o=this.init();o&&!Array.isArray(o)&&(o=[o]),this._modules=o||[],this._config.enabled&&this.enable()}_wrap=(t,n,r)=>{if(ol(t[n])&&this._unwrap(t,n),Zr.types.isProxy(t)){const o=uu(Object.assign({},t),n,r);return Object.defineProperty(t,n,{value:o}),o}else return uu(t,n,r)};_unwrap=(t,n)=>Zr.types.isProxy(t)?Object.defineProperty(t,n,{value:t[n]}):uE(t,n);_massWrap=(t,n,r)=>{if(t)Array.isArray(t)||(t=[t]);else{b.diag.error("must provide one or more modules to patch");return}if(!(n&&Array.isArray(n))){b.diag.error("must provide one or more functions to wrap on modules");return}t.forEach(o=>{n.forEach(s=>{this._wrap(o,s,r)})})};_massUnwrap=(t,n)=>{if(t)Array.isArray(t)||(t=[t]);else{b.diag.error("must provide one or more modules to patch");return}if(!(n&&Array.isArray(n))){b.diag.error("must provide one or more functions to wrap on modules");return}t.forEach(r=>{n.forEach(o=>{this._unwrap(r,o)})})};_warnOnPreloadedModules(){this._modules.forEach(t=>{const{name:n}=t;try{const r=require.resolve(n);require.cache[r]&&this._diag.warn(`Module ${n} has been loaded before ${this.instrumentationName} so it might not work, please initialize it before requiring ${n}`)}catch{}})}_extractPackageVersion(t){try{const n=ID.readFileSync(qr.join(t,"package.json"),{encoding:"utf8"}),r=JSON.parse(n).version;return typeof r=="string"?r:void 0}catch{b.diag.warn("Failed extracting version",t)}}_onRequire(t,n,r,o){if(!o)return typeof t.patch=="function"&&(t.moduleExports=n,this._enabled)?(this._diag.debug("Applying instrumentation patch for nodejs core module on require hook",{module:t.name}),t.patch(n)):n;const s=this._extractPackageVersion(o);if(t.moduleVersion=s,t.name===r)return MA(t.supportedVersions,s,t.includePrerelease)&&typeof t.patch=="function"&&(t.moduleExports=n,this._enabled)?(this._diag.debug("Applying instrumentation patch for module on require hook",{module:t.name,version:t.moduleVersion,baseDir:o}),t.patch(n,t.moduleVersion)):n;const i=t.files??[],a=qr.normalize(r);return i.filter(l=>l.name===a).filter(l=>MA(l.supportedVersions,s,t.includePrerelease)).reduce((l,f)=>(f.moduleExports=l,this._enabled?(this._diag.debug("Applying instrumentation patch for nodejs module file on require hook",{module:t.name,version:t.moduleVersion,fileName:f.name,baseDir:o}),f.patch(l,t.moduleVersion)):l),n)}enable(){if(!this._enabled){if(this._enabled=!0,this._hooks.length>0){for(const t of this._modules){typeof t.patch=="function"&&t.moduleExports&&(this._diag.debug("Applying instrumentation patch for nodejs module on instrumentation enabled",{module:t.name,version:t.moduleVersion}),t.patch(t.moduleExports,t.moduleVersion));for(const n of t.files)n.moduleExports&&(this._diag.debug("Applying instrumentation patch for nodejs module file on instrumentation enabled",{module:t.name,version:t.moduleVersion,fileName:n.name}),n.patch(n.moduleExports,t.moduleVersion))}return}this._warnOnPreloadedModules();for(const t of this._modules){const n=(i,a,c)=>{if(!c&&qr.isAbsolute(a)){const l=qr.parse(a);a=l.name,c=l.dir}return this._onRequire(t,i,a,c)},r=(i,a,c)=>this._onRequire(t,i,a,c),o=qr.isAbsolute(t.name)?new OC.Hook([t.name],{internals:!0},r):this._requireInTheMiddleSingleton.register(t.name,r);this._hooks.push(o);const s=new bC.Hook([t.name],{internals:!1},n);this._hooks.push(s)}}}disable(){if(this._enabled){this._enabled=!1;for(const t of this._modules){typeof t.unpatch=="function"&&t.moduleExports&&(this._diag.debug("Removing instrumentation patch for nodejs module on instrumentation disabled",{module:t.name,version:t.moduleVersion}),t.unpatch(t.moduleExports,t.moduleVersion));for(const n of t.files)n.moduleExports&&(this._diag.debug("Removing instrumentation patch for nodejs module file on instrumentation disabled",{module:t.name,version:t.moduleVersion,fileName:n.name}),n.unpatch(n.moduleExports,t.moduleVersion))}}}isEnabled(){return this._enabled}}function MA(e,t,n){return typeof t>"u"?e.includes("*"):e.some(r=>$0(t,r,{includePrerelease:n}))}class dt{name;supportedVersions;patch;unpatch;files;constructor(t,n,r,o,s){this.name=t,this.supportedVersions=n,this.patch=r,this.unpatch=o,this.files=s||[]}}class Bn{supportedVersions;patch;unpatch;name;constructor(t,n,r,o){this.supportedVersions=n,this.patch=r,this.unpatch=o,this.name=Ec.normalize(t)}}var Po;(function(e){e[e.STABLE=1]="STABLE",e[e.OLD=2]="OLD",e[e.DUPLICATE=3]="DUPLICATE"})(Po||(Po={}));function MU(e,t){let n=Po.OLD;const r=t?.split(",").map(o=>o.trim()).filter(o=>o!=="");for(const o of r??[])if(o.toLowerCase()===e+"/dup"){n=Po.DUPLICATE;break}else o.toLowerCase()===e&&(n=Po.STABLE);return n}const PU=Object.freeze(Object.defineProperty({__proto__:null,InstrumentationBase:yt,InstrumentationNodeModuleDefinition:dt,InstrumentationNodeModuleFile:Bn,get SemconvStability(){return Po},isWrapped:ol,registerInstrumentations:rl,safeExecuteInTheMiddle:er,safeExecuteInTheMiddleAsync:CU,semconvStabilityFromStr:MU},Symbol.toStringTag,{value:"Module"})),Le=HI(PU);var fd={},ie={},PA;function vU(){return PA||(PA=1,Object.defineProperty(ie,"__esModule",{value:!0}),ie.HTTP_FLAVOR_VALUE_HTTP_1_1=ie.NET_TRANSPORT_VALUE_IP_UDP=ie.NET_TRANSPORT_VALUE_IP_TCP=ie.ATTR_NET_TRANSPORT=ie.ATTR_NET_PEER_PORT=ie.ATTR_NET_PEER_NAME=ie.ATTR_NET_PEER_IP=ie.ATTR_NET_HOST_PORT=ie.ATTR_NET_HOST_NAME=ie.ATTR_NET_HOST_IP=ie.ATTR_HTTP_USER_AGENT=ie.ATTR_HTTP_URL=ie.ATTR_HTTP_TARGET=ie.ATTR_HTTP_STATUS_CODE=ie.ATTR_HTTP_SERVER_NAME=ie.ATTR_HTTP_SCHEME=ie.ATTR_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED=ie.ATTR_HTTP_RESPONSE_CONTENT_LENGTH=ie.ATTR_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED=ie.ATTR_HTTP_REQUEST_CONTENT_LENGTH=ie.ATTR_HTTP_METHOD=ie.ATTR_HTTP_HOST=ie.ATTR_HTTP_FLAVOR=ie.ATTR_HTTP_CLIENT_IP=ie.USER_AGENT_SYNTHETIC_TYPE_VALUE_TEST=ie.USER_AGENT_SYNTHETIC_TYPE_VALUE_BOT=ie.ATTR_USER_AGENT_SYNTHETIC_TYPE=void 0,ie.ATTR_USER_AGENT_SYNTHETIC_TYPE="user_agent.synthetic.type",ie.USER_AGENT_SYNTHETIC_TYPE_VALUE_BOT="bot",ie.USER_AGENT_SYNTHETIC_TYPE_VALUE_TEST="test",ie.ATTR_HTTP_CLIENT_IP="http.client_ip",ie.ATTR_HTTP_FLAVOR="http.flavor",ie.ATTR_HTTP_HOST="http.host",ie.ATTR_HTTP_METHOD="http.method",ie.ATTR_HTTP_REQUEST_CONTENT_LENGTH="http.request_content_length",ie.ATTR_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED="http.request_content_length_uncompressed",ie.ATTR_HTTP_RESPONSE_CONTENT_LENGTH="http.response_content_length",ie.ATTR_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED="http.response_content_length_uncompressed",ie.ATTR_HTTP_SCHEME="http.scheme",ie.ATTR_HTTP_SERVER_NAME="http.server_name",ie.ATTR_HTTP_STATUS_CODE="http.status_code",ie.ATTR_HTTP_TARGET="http.target",ie.ATTR_HTTP_URL="http.url",ie.ATTR_HTTP_USER_AGENT="http.user_agent",ie.ATTR_NET_HOST_IP="net.host.ip",ie.ATTR_NET_HOST_NAME="net.host.name",ie.ATTR_NET_HOST_PORT="net.host.port",ie.ATTR_NET_PEER_IP="net.peer.ip",ie.ATTR_NET_PEER_NAME="net.peer.name",ie.ATTR_NET_PEER_PORT="net.peer.port",ie.ATTR_NET_TRANSPORT="net.transport",ie.NET_TRANSPORT_VALUE_IP_TCP="ip_tcp",ie.NET_TRANSPORT_VALUE_IP_UDP="ip_udp",ie.HTTP_FLAVOR_VALUE_HTTP_1_1="1.1"),ie}var _d={},vA;function LU(){return vA||(vA=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,(function(t){t.HTTP_ERROR_NAME="http.error_name",t.HTTP_ERROR_MESSAGE="http.error_message",t.HTTP_STATUS_TEXT="http.status_text"})(e.AttributeNames||(e.AttributeNames={}))})(_d)),_d}var Qt={},LA;function DA(){return LA||(LA=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.DEFAULT_QUERY_STRINGS_TO_REDACT=Qt.STR_REDACTED=Qt.SYNTHETIC_BOT_NAMES=Qt.SYNTHETIC_TEST_NAMES=void 0,Qt.SYNTHETIC_TEST_NAMES=["alwayson"],Qt.SYNTHETIC_BOT_NAMES=["googlebot","bingbot"],Qt.STR_REDACTED="REDACTED",Qt.DEFAULT_QUERY_STRINGS_TO_REDACT=["sig","Signature","AWSAccessKeyId","X-Goog-Signature"]),Qt}var pd,wA;function DU(){if(wA)return pd;wA=1;var e=Zr;function t(n,r){Error.captureStackTrace(this,t),this.name=this.constructor.name,this.message=n,this.input=r}return e.inherits(t,Error),pd=t,pd}var Ed,UA;function wU(){if(UA)return Ed;UA=1;function e(o){return o===34||o===40||o===41||o===44||o===47||o>=58&&o<=64||o>=91&&o<=93||o===123||o===125}function t(o){return o===33||o>=35&&o<=39||o===42||o===43||o===45||o===46||o>=48&&o<=57||o>=65&&o<=90||o>=94&&o<=122||o===124||o===126}function n(o){return o>=32&&o<=126}function r(o){return o>=128&&o<=255}return Ed={isDelimiter:e,isTokenChar:t,isExtended:r,isPrint:n},Ed}var Td,kA;function UU(){if(kA)return Td;kA=1;var e=Zr,t=DU(),n=wU(),r=n.isDelimiter,o=n.isTokenChar,s=n.isExtended,i=n.isPrint;function a(f){return f.replace(/\\(.)/g,"$1")}function c(f,d){return e.format("Unexpected character '%s' at index %d",f.charAt(d),d)}function l(f){for(var d=!1,u=!1,_=!1,p={},E=[],T=-1,h=-1,m,A,g=0;g<f.length;g++)if(A=f.charCodeAt(g),m===void 0){if(g!==0&&T===-1&&(A===32||A===9))continue;if(o(A))T===-1&&(T=g);else if(A===61&&T!==-1)m=f.slice(T,g).toLowerCase(),T=-1;else throw new t(c(f,g),f)}else if(u&&(A===9||i(A)||s(A)))u=!1;else if(o(A)){if(h!==-1)throw new t(c(f,g),f);T===-1&&(T=g)}else if(r(A)||s(A))if(_)A===34?(_=!1,h=g):A===92?(T===-1&&(T=g),u=d=!0):T===-1&&(T=g);else if(A===34&&f.charCodeAt(g-1)===61)_=!0;else if((A===44||A===59)&&(T!==-1||h!==-1))T!==-1?(h===-1&&(h=g),p[m]=d?a(f.slice(T,h)):f.slice(T,h)):p[m]="",A===44&&(E.push(p),p={}),m=void 0,T=h=-1;else throw new t(c(f,g),f);else if(A===32||A===9){if(h!==-1)continue;if(_)T===-1&&(T=g);else if(T!==-1)h=g;else throw new t(c(f,g),f)}else throw new t(c(f,g),f);if(m===void 0||_||T===-1&&h===-1||A===32||A===9)throw new t("Unexpected end of input",f);return T!==-1?(h===-1&&(h=g),p[m]=d?a(f.slice(T,h)):f.slice(T,h)):p[m]="",E.push(p),E}return Td=l,Td}var GA;function kU(){return GA||(GA=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.headerCapture=e.getIncomingStableRequestMetricAttributesOnResponse=e.getIncomingRequestMetricAttributesOnResponse=e.getIncomingRequestAttributesOnResponse=e.getIncomingRequestMetricAttributes=e.getIncomingRequestAttributes=e.getRemoteClientAddress=e.getOutgoingStableRequestMetricAttributesOnResponse=e.getOutgoingRequestMetricAttributesOnResponse=e.getOutgoingRequestAttributesOnResponse=e.setAttributesFromHttpKind=e.getOutgoingRequestMetricAttributes=e.getOutgoingRequestAttributes=e.extractHostnameAndPort=e.isValidOptionsType=e.getRequestInfo=e.isCompressed=e.setResponseContentLengthAttribute=e.setRequestContentLengthAttribute=e.setSpanWithError=e.satisfiesPattern=e.parseResponseStatus=e.getAbsoluteUrl=void 0;const t=Me(),n=_t(),r=vU(),o=ln,s=Le,i=Zu,a=LU(),c=DA(),l=DA(),f=UU(),d=(v,D,z="http:",j=Array.from(l.DEFAULT_QUERY_STRINGS_TO_REDACT))=>{const ee=v||{},te=ee.protocol||z,_e=(ee.port||"").toString();let se=ee.path||"/",ce=ee.host||ee.hostname||D.host||"localhost";if(ce.indexOf(":")===-1&&_e&&_e!=="80"&&_e!=="443"&&(ce+=`:${_e}`),se.includes("?")){const ve=i.parse(se),De=ve.pathname||"",qe=ve.query||"",Mt=new URLSearchParams(qe),st=j||[];for(const nt of st)Mt.has(nt)&&Mt.get(nt)!==""&&Mt.set(nt,l.STR_REDACTED);const it=Mt.toString();se=`${De}?${it}`}const he=ee.auth?`${l.STR_REDACTED}:${l.STR_REDACTED}@`:"";return`${te}//${he}${ce}${se}`};e.getAbsoluteUrl=d;const u=(v,D)=>{const z=v===t.SpanKind.CLIENT?400:500;return D&&D>=100&&D<z?t.SpanStatusCode.UNSET:t.SpanStatusCode.ERROR};e.parseResponseStatus=u;const _=(v,D)=>{if(typeof D=="string")return D===v;if(D instanceof RegExp)return D.test(v);if(typeof D=="function")return D(v);throw new TypeError("Pattern is in unsupported datatype")};e.satisfiesPattern=_;const p=(v,D,z)=>{const j=D.message;z&s.SemconvStability.OLD&&(v.setAttribute(a.AttributeNames.HTTP_ERROR_NAME,D.name),v.setAttribute(a.AttributeNames.HTTP_ERROR_MESSAGE,j)),z&s.SemconvStability.STABLE&&v.setAttribute(n.ATTR_ERROR_TYPE,D.name),v.setStatus({code:t.SpanStatusCode.ERROR,message:j}),v.recordException(D)};e.setSpanWithError=p;const E=(v,D)=>{const z=h(v.headers);z!==null&&((0,e.isCompressed)(v.headers)?D[r.ATTR_HTTP_REQUEST_CONTENT_LENGTH]=z:D[r.ATTR_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED]=z)};e.setRequestContentLengthAttribute=E;const T=(v,D)=>{const z=h(v.headers);z!==null&&((0,e.isCompressed)(v.headers)?D[r.ATTR_HTTP_RESPONSE_CONTENT_LENGTH]=z:D[r.ATTR_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED]=z)};e.setResponseContentLengthAttribute=T;function h(v){const D=v["content-length"];if(D===void 0)return null;const z=parseInt(D,10);return isNaN(z)?null:z}const m=v=>{const D=v["content-encoding"];return!!D&&D!=="identity"};e.isCompressed=m;function A(v){const{hostname:D,pathname:z,port:j,username:ee,password:te,search:_e,protocol:se,hash:ce,href:he,origin:ve,host:De}=new URL(v),qe={protocol:se,hostname:D&&D[0]==="["?D.slice(1,-1):D,hash:ce,search:_e,pathname:z,path:`${z||""}${_e||""}`,href:he,origin:ve,host:De};return j!==""&&(qe.port=Number(j)),(ee||te)&&(qe.auth=`${decodeURIComponent(ee)}:${decodeURIComponent(te)}`),qe}const g=(v,D,z)=>{let j,ee,te,_e=!1;if(typeof D=="string"){try{const ce=A(D);te=ce,j=ce.pathname||"/"}catch(ce){_e=!0,v.verbose("Unable to parse URL provided to HTTP request, using fallback to determine path. Original error:",ce),te={path:D},j=te.path||"/"}ee=`${te.protocol||"http:"}//${te.host}`,z!==void 0&&Object.assign(te,z)}else if(D instanceof i.URL)te={protocol:D.protocol,hostname:typeof D.hostname=="string"&&D.hostname.startsWith("[")?D.hostname.slice(1,-1):D.hostname,path:`${D.pathname||""}${D.search||""}`},D.port!==""&&(te.port=Number(D.port)),(D.username||D.password)&&(te.auth=`${D.username}:${D.password}`),j=D.pathname,ee=D.origin,z!==void 0&&Object.assign(te,z);else{te=Object.assign({protocol:D.host?"http:":void 0},D);const ce=te.host||(te.port!=null?`${te.hostname}${te.port}`:te.hostname);if(ee=`${te.protocol||"http:"}//${ce}`,j=D.pathname,!j&&te.path)try{j=new URL(te.path,ee).pathname||"/"}catch{j="/"}}const se=te.method?te.method.toUpperCase():"GET";return{origin:ee,pathname:j,method:se,optionsParsed:te,invalidUrl:_e}};e.getRequestInfo=g;const R=v=>{if(!v)return!1;const D=typeof v;return D==="string"||D==="object"&&!Array.isArray(v)};e.isValidOptionsType=R;const O=v=>{if(v.hostname&&v.port)return{hostname:v.hostname,port:v.port};const D=v.host?.match(/^([^:/ ]+)(:\d{1,5})?/)||null,z=v.hostname||(D===null?"localhost":D[1]);let j=v.port;return j||(D&&D[2]?j=D[2].substring(1):j=v.protocol==="https:"?"443":"80"),{hostname:z,port:j}};e.extractHostnameAndPort=O;const C=(v,D,z,j)=>{const ee=D.hostname,te=D.port,_e=v.method??"GET",se=K(_e),ce=v.headers||{},he=ce["user-agent"],ve=(0,e.getAbsoluteUrl)(v,ce,`${D.component}:`,D.redactedQueryParams),De={[r.ATTR_HTTP_URL]:ve,[r.ATTR_HTTP_METHOD]:_e,[r.ATTR_HTTP_TARGET]:v.path||"/",[r.ATTR_NET_PEER_NAME]:ee,[r.ATTR_HTTP_HOST]:ce.host??`${ee}:${te}`},qe={[n.ATTR_HTTP_REQUEST_METHOD]:se,[n.ATTR_SERVER_ADDRESS]:ee,[n.ATTR_SERVER_PORT]:Number(te),[n.ATTR_URL_FULL]:ve,[n.ATTR_USER_AGENT_ORIGINAL]:he};switch(_e!==se&&(qe[n.ATTR_HTTP_REQUEST_METHOD_ORIGINAL]=_e),j&&he&&(qe[r.ATTR_USER_AGENT_SYNTHETIC_TYPE]=U(he)),he!==void 0&&(De[r.ATTR_HTTP_USER_AGENT]=he),z){case s.SemconvStability.STABLE:return Object.assign(qe,D.hookAttributes);case s.SemconvStability.OLD:return Object.assign(De,D.hookAttributes)}return Object.assign(De,qe,D.hookAttributes)};e.getOutgoingRequestAttributes=C;const I=v=>{const D={};return D[r.ATTR_HTTP_METHOD]=v[r.ATTR_HTTP_METHOD],D[r.ATTR_NET_PEER_NAME]=v[r.ATTR_NET_PEER_NAME],D};e.getOutgoingRequestMetricAttributes=I;const L=(v,D)=>{v&&(D[r.ATTR_HTTP_FLAVOR]=v,v.toUpperCase()!=="QUIC"?D[r.ATTR_NET_TRANSPORT]=r.NET_TRANSPORT_VALUE_IP_TCP:D[r.ATTR_NET_TRANSPORT]=r.NET_TRANSPORT_VALUE_IP_UDP)};e.setAttributesFromHttpKind=L;const U=v=>{const D=String(v).toLowerCase();for(const z of c.SYNTHETIC_TEST_NAMES)if(D.includes(z))return r.USER_AGENT_SYNTHETIC_TYPE_VALUE_TEST;for(const z of c.SYNTHETIC_BOT_NAMES)if(D.includes(z))return r.USER_AGENT_SYNTHETIC_TYPE_VALUE_BOT},q=(v,D)=>{const{statusCode:z,statusMessage:j,httpVersion:ee,socket:te}=v,_e={},se={};if(z!=null&&(se[n.ATTR_HTTP_RESPONSE_STATUS_CODE]=z),te){const{remoteAddress:ce,remotePort:he}=te;_e[r.ATTR_NET_PEER_IP]=ce,_e[r.ATTR_NET_PEER_PORT]=he,se[n.ATTR_NETWORK_PEER_ADDRESS]=ce,se[n.ATTR_NETWORK_PEER_PORT]=he,se[n.ATTR_NETWORK_PROTOCOL_VERSION]=v.httpVersion}switch((0,e.setResponseContentLengthAttribute)(v,_e),z&&(_e[r.ATTR_HTTP_STATUS_CODE]=z,_e[a.AttributeNames.HTTP_STATUS_TEXT]=(j||"").toUpperCase()),(0,e.setAttributesFromHttpKind)(ee,_e),D){case s.SemconvStability.STABLE:return se;case s.SemconvStability.OLD:return _e}return Object.assign(_e,se)};e.getOutgoingRequestAttributesOnResponse=q;const H=v=>{const D={};return D[r.ATTR_NET_PEER_PORT]=v[r.ATTR_NET_PEER_PORT],D[r.ATTR_HTTP_STATUS_CODE]=v[r.ATTR_HTTP_STATUS_CODE],D[r.ATTR_HTTP_FLAVOR]=v[r.ATTR_HTTP_FLAVOR],D};e.getOutgoingRequestMetricAttributesOnResponse=H;const $=v=>{const D={};return v[n.ATTR_NETWORK_PROTOCOL_VERSION]&&(D[n.ATTR_NETWORK_PROTOCOL_VERSION]=v[n.ATTR_NETWORK_PROTOCOL_VERSION]),v[n.ATTR_HTTP_RESPONSE_STATUS_CODE]&&(D[n.ATTR_HTTP_RESPONSE_STATUS_CODE]=v[n.ATTR_HTTP_RESPONSE_STATUS_CODE]),D};e.getOutgoingStableRequestMetricAttributesOnResponse=$;function B(v,D){const z=v.split(":");if(z.length===1)return D==="http"?{host:z[0],port:"80"}:D==="https"?{host:z[0],port:"443"}:{host:z[0]};if(z.length===2)return{host:z[0],port:z[1]};if(z[0].startsWith("[")){if(z[z.length-1].endsWith("]")){if(D==="http")return{host:v,port:"80"};if(D==="https")return{host:v,port:"443"}}else if(z[z.length-2].endsWith("]"))return{host:z.slice(0,-1).join(":"),port:z[z.length-1]}}return{host:v}}function F(v,D){const z=v.headers.forwarded;if(z){for(const te of X(z))if(te.host)return B(te.host,te.proto)}const j=v.headers["x-forwarded-host"];if(typeof j=="string")return typeof v.headers["x-forwarded-proto"]=="string"?B(j,v.headers["x-forwarded-proto"]):Array.isArray(v.headers["x-forwarded-proto"])?B(j,v.headers["x-forwarded-proto"][0]):B(j);if(Array.isArray(j)&&typeof j[0]=="string"&&j[0].length>0)return typeof v.headers["x-forwarded-proto"]=="string"?B(j[0],v.headers["x-forwarded-proto"]):Array.isArray(v.headers["x-forwarded-proto"])?B(j[0],v.headers["x-forwarded-proto"][0]):B(j[0]);const ee=v.headers.host;return typeof ee=="string"&&ee.length>0?B(ee,D):null}function w(v){const D=v.headers.forwarded;if(D){for(const ee of X(D))if(ee.for)return k(ee.for)}const z=v.headers["x-forwarded-for"];if(z){let ee;if(typeof z=="string"?ee=z:Array.isArray(z)&&(ee=z[0]),typeof ee=="string")return ee=ee.split(",")[0].trim(),k(ee)}const j=v.socket.remoteAddress;return j||null}e.getRemoteClientAddress=w;function k(v){try{const{hostname:D}=new URL(`http://${v}`);return D.startsWith("[")&&D.endsWith("]")?D.slice(1,-1):D}catch{return v}}function Y(v,D,z){try{if(D.headers.host)return new URL(D.url??"/",`${v}://${D.headers.host}`);{const j=new URL(D.url??"/",`${v}://localhost`);return{pathname:j.pathname,search:j.search,toString:function(){return j.pathname+j.search}}}}catch(j){return z.verbose("Unable to get URL from request",j),{}}}const oe=(v,D,z)=>{const j=v.headers,ee=j["user-agent"],te=j["x-forwarded-for"],_e=v.httpVersion,se=j.host,ce=se?.replace(/^(.*)(:[0-9]{1,5})/,"$1")||"localhost",he=v.method,ve=K(he),De=F(v,D.component),qe=D.serverName,Mt=w(v),st={[n.ATTR_HTTP_REQUEST_METHOD]:ve,[n.ATTR_URL_SCHEME]:D.component,[n.ATTR_SERVER_ADDRESS]:De?.host,[n.ATTR_NETWORK_PEER_ADDRESS]:v.socket.remoteAddress,[n.ATTR_NETWORK_PEER_PORT]:v.socket.remotePort,[n.ATTR_NETWORK_PROTOCOL_VERSION]:v.httpVersion,[n.ATTR_USER_AGENT_ORIGINAL]:ee},it=Y(D.component,v,z);it?.pathname!=null&&(st[n.ATTR_URL_PATH]=it.pathname),it.search&&(st[n.ATTR_URL_QUERY]=it.search.slice(1)),Mt!=null&&(st[n.ATTR_CLIENT_ADDRESS]=Mt),De?.port!=null&&(st[n.ATTR_SERVER_PORT]=Number(De.port)),he!==ve&&(st[n.ATTR_HTTP_REQUEST_METHOD_ORIGINAL]=he),D.enableSyntheticSourceDetection&&ee&&(st[r.ATTR_USER_AGENT_SYNTHETIC_TYPE]=U(ee));const nt={[r.ATTR_HTTP_URL]:it.toString(),[r.ATTR_HTTP_HOST]:se,[r.ATTR_NET_HOST_NAME]:ce,[r.ATTR_HTTP_METHOD]:he,[r.ATTR_HTTP_SCHEME]:D.component};switch(typeof te=="string"&&(nt[r.ATTR_HTTP_CLIENT_IP]=te.split(",")[0]),typeof qe=="string"&&(nt[r.ATTR_HTTP_SERVER_NAME]=qe),it?.pathname&&(nt[r.ATTR_HTTP_TARGET]=it?.pathname+it?.search||"/"),ee!==void 0&&(nt[r.ATTR_HTTP_USER_AGENT]=ee),(0,e.setRequestContentLengthAttribute)(v,nt),(0,e.setAttributesFromHttpKind)(_e,nt),D.semconvStability){case s.SemconvStability.STABLE:return Object.assign(st,D.hookAttributes);case s.SemconvStability.OLD:return Object.assign(nt,D.hookAttributes)}return Object.assign(nt,st,D.hookAttributes)};e.getIncomingRequestAttributes=oe;const ae=v=>{const D={};return D[r.ATTR_HTTP_SCHEME]=v[r.ATTR_HTTP_SCHEME],D[r.ATTR_HTTP_METHOD]=v[r.ATTR_HTTP_METHOD],D[r.ATTR_NET_HOST_NAME]=v[r.ATTR_NET_HOST_NAME],D[r.ATTR_HTTP_FLAVOR]=v[r.ATTR_HTTP_FLAVOR],D};e.getIncomingRequestMetricAttributes=ae;const ne=(v,D,z)=>{const{socket:j}=v,{statusCode:ee,statusMessage:te}=D,_e={[n.ATTR_HTTP_RESPONSE_STATUS_CODE]:ee},se=(0,o.getRPCMetadata)(t.context.active()),ce={};if(j){const{localAddress:he,localPort:ve,remoteAddress:De,remotePort:qe}=j;ce[r.ATTR_NET_HOST_IP]=he,ce[r.ATTR_NET_HOST_PORT]=ve,ce[r.ATTR_NET_PEER_IP]=De,ce[r.ATTR_NET_PEER_PORT]=qe}switch(ce[r.ATTR_HTTP_STATUS_CODE]=ee,ce[a.AttributeNames.HTTP_STATUS_TEXT]=(te||"").toUpperCase(),se?.type===o.RPCType.HTTP&&se.route!==void 0&&(ce[n.ATTR_HTTP_ROUTE]=se.route,_e[n.ATTR_HTTP_ROUTE]=se.route),z){case s.SemconvStability.STABLE:return _e;case s.SemconvStability.OLD:return ce}return Object.assign(ce,_e)};e.getIncomingRequestAttributesOnResponse=ne;const M=v=>{const D={};return D[r.ATTR_HTTP_STATUS_CODE]=v[r.ATTR_HTTP_STATUS_CODE],D[r.ATTR_NET_HOST_PORT]=v[r.ATTR_NET_HOST_PORT],v[n.ATTR_HTTP_ROUTE]!==void 0&&(D[n.ATTR_HTTP_ROUTE]=v[n.ATTR_HTTP_ROUTE]),D};e.getIncomingRequestMetricAttributesOnResponse=M;const P=v=>{const D={};return v[n.ATTR_HTTP_ROUTE]!==void 0&&(D[n.ATTR_HTTP_ROUTE]=v[n.ATTR_HTTP_ROUTE]),v[n.ATTR_HTTP_RESPONSE_STATUS_CODE]&&(D[n.ATTR_HTTP_RESPONSE_STATUS_CODE]=v[n.ATTR_HTTP_RESPONSE_STATUS_CODE]),D};e.getIncomingStableRequestMetricAttributesOnResponse=P;function G(v,D){const z=new Map;for(let j=0,ee=D.length;j<ee;j++){const te=D[j].toLowerCase();z.set(te,te.replace(/-/g,"_"))}return(j,ee)=>{for(const te of z.keys()){const _e=ee(te);if(_e===void 0)continue;const se=z.get(te),ce=`http.${v}.header.${se}`;typeof _e=="string"?j.setAttribute(ce,[_e]):Array.isArray(_e)?j.setAttribute(ce,_e):j.setAttribute(ce,[_e])}}}e.headerCapture=G;const V=new Set(["GET","HEAD","POST","PUT","DELETE","CONNECT","OPTIONS","TRACE","PATCH"]);function K(v){if(v==null)return"GET";const D=v.toUpperCase();return V.has(D)?D:"_OTHER"}function X(v){try{return f(v)}catch{return[]}}})(fd)),fd}var VA;function GU(){if(VA)return Zi;VA=1,Object.defineProperty(Zi,"__esModule",{value:!0}),Zi.HttpInstrumentation=void 0;const e=Me(),t=ln,n=Zu,r=P0(),o=Le,s=zu,i=_t(),a=kU();class c extends o.InstrumentationBase{_spanNotEnded=new WeakSet;_headerCapture;_semconvStability=o.SemconvStability.OLD;constructor(f={}){super("@opentelemetry/instrumentation-http",r.VERSION,f),this._headerCapture=this._createHeaderCapture(),this._semconvStability=(0,o.semconvStabilityFromStr)("http",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}_updateMetricInstruments(){this._oldHttpServerDurationHistogram=this.meter.createHistogram("http.server.duration",{description:"Measures the duration of inbound HTTP requests.",unit:"ms",valueType:e.ValueType.DOUBLE}),this._oldHttpClientDurationHistogram=this.meter.createHistogram("http.client.duration",{description:"Measures the duration of outbound HTTP requests.",unit:"ms",valueType:e.ValueType.DOUBLE}),this._stableHttpServerDurationHistogram=this.meter.createHistogram(i.METRIC_HTTP_SERVER_REQUEST_DURATION,{description:"Duration of HTTP server requests.",unit:"s",valueType:e.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[.005,.01,.025,.05,.075,.1,.25,.5,.75,1,2.5,5,7.5,10]}}),this._stableHttpClientDurationHistogram=this.meter.createHistogram(i.METRIC_HTTP_CLIENT_REQUEST_DURATION,{description:"Duration of HTTP client requests.",unit:"s",valueType:e.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[.005,.01,.025,.05,.075,.1,.25,.5,.75,1,2.5,5,7.5,10]}})}_recordServerDuration(f,d,u){this._semconvStability&o.SemconvStability.OLD&&this._oldHttpServerDurationHistogram.record(f,d),this._semconvStability&o.SemconvStability.STABLE&&this._stableHttpServerDurationHistogram.record(f/1e3,u)}_recordClientDuration(f,d,u){this._semconvStability&o.SemconvStability.OLD&&this._oldHttpClientDurationHistogram.record(f,d),this._semconvStability&o.SemconvStability.STABLE&&this._stableHttpClientDurationHistogram.record(f/1e3,u)}setConfig(f={}){super.setConfig(f),this._headerCapture=this._createHeaderCapture()}init(){return[this._getHttpsInstrumentation(),this._getHttpInstrumentation()]}_getHttpInstrumentation(){return new o.InstrumentationNodeModuleDefinition("http",["*"],f=>{const d=f[Symbol.toStringTag]==="Module";if(!this.getConfig().disableOutgoingRequestInstrumentation){const u=this._wrap(f,"request",this._getPatchOutgoingRequestFunction("http")),_=this._wrap(f,"get",this._getPatchOutgoingGetFunction(u));d&&(f.default.request=u,f.default.get=_)}return this.getConfig().disableIncomingRequestInstrumentation||this._wrap(f.Server.prototype,"emit",this._getPatchIncomingRequestFunction("http")),f},f=>{f!==void 0&&(this.getConfig().disableOutgoingRequestInstrumentation||(this._unwrap(f,"request"),this._unwrap(f,"get")),this.getConfig().disableIncomingRequestInstrumentation||this._unwrap(f.Server.prototype,"emit"))})}_getHttpsInstrumentation(){return new o.InstrumentationNodeModuleDefinition("https",["*"],f=>{const d=f[Symbol.toStringTag]==="Module";if(!this.getConfig().disableOutgoingRequestInstrumentation){const u=this._wrap(f,"request",this._getPatchHttpsOutgoingRequestFunction("https")),_=this._wrap(f,"get",this._getPatchHttpsOutgoingGetFunction(u));d&&(f.default.request=u,f.default.get=_)}return this.getConfig().disableIncomingRequestInstrumentation||this._wrap(f.Server.prototype,"emit",this._getPatchIncomingRequestFunction("https")),f},f=>{f!==void 0&&(this.getConfig().disableOutgoingRequestInstrumentation||(this._unwrap(f,"request"),this._unwrap(f,"get")),this.getConfig().disableIncomingRequestInstrumentation||this._unwrap(f.Server.prototype,"emit"))})}_getPatchIncomingRequestFunction(f){return d=>this._incomingRequestFunction(f,d)}_getPatchOutgoingRequestFunction(f){return d=>this._outgoingRequestFunction(f,d)}_getPatchOutgoingGetFunction(f){return d=>function(_,...p){const E=f(_,...p);return E.end(),E}}_getPatchHttpsOutgoingRequestFunction(f){return d=>{const u=this;return function(p,...E){return f==="https"&&typeof p=="object"&&p?.constructor?.name!=="URL"&&(p=Object.assign({},p),u._setDefaultOptions(p)),u._getPatchOutgoingRequestFunction(f)(d)(p,...E)}}}_setDefaultOptions(f){f.protocol=f.protocol||"https:",f.port=f.port||443}_getPatchHttpsOutgoingGetFunction(f){return d=>{const u=this;return function(p,...E){return u._getPatchOutgoingGetFunction(f)(d)(p,...E)}}}_traceClientRequest(f,d,u,_,p){this.getConfig().requestHook&&this._callRequestHook(d,f);let E=!1;return f.prependListener("response",T=>{this._diag.debug("outgoingRequest on response()"),f.listenerCount("response")<=1&&T.resume();const h=(0,a.getOutgoingRequestAttributesOnResponse)(T,this._semconvStability);d.setAttributes(h),_=Object.assign(_,(0,a.getOutgoingRequestMetricAttributesOnResponse)(h)),p=Object.assign(p,(0,a.getOutgoingStableRequestMetricAttributesOnResponse)(h)),this.getConfig().responseHook&&this._callResponseHook(d,T),this._headerCapture.client.captureRequestHeaders(d,A=>f.getHeader(A)),this._headerCapture.client.captureResponseHeaders(d,A=>T.headers[A]),e.context.bind(e.context.active(),T);const m=()=>{if(this._diag.debug("outgoingRequest on end()"),E)return;E=!0;let A;T.aborted&&!T.complete?A={code:e.SpanStatusCode.ERROR}:A={code:(0,a.parseResponseStatus)(e.SpanKind.CLIENT,T.statusCode)},d.setStatus(A),this.getConfig().applyCustomAttributesOnSpan&&(0,o.safeExecuteInTheMiddle)(()=>this.getConfig().applyCustomAttributesOnSpan(d,f,T),()=>{},!0),this._closeHttpSpan(d,e.SpanKind.CLIENT,u,_,p)};T.on("end",m),T.on(s.errorMonitor,A=>{this._diag.debug("outgoingRequest on error()",A),!E&&(E=!0,this._onOutgoingRequestError(d,_,p,u,A))})}),f.on("close",()=>{this._diag.debug("outgoingRequest on request close()"),!(f.aborted||E)&&(E=!0,this._closeHttpSpan(d,e.SpanKind.CLIENT,u,_,p))}),f.on(s.errorMonitor,T=>{this._diag.debug("outgoingRequest on request error()",T),!E&&(E=!0,this._onOutgoingRequestError(d,_,p,u,T))}),this._diag.debug("http.ClientRequest return request"),f}_incomingRequestFunction(f,d){const u=this;return function(p,...E){if(p!=="request")return d.apply(this,[p,...E]);const T=E[0],h=E[1],m=T.method||"GET";if(u._diag.debug(`${f} instrumentation incomingRequest`),(0,o.safeExecuteInTheMiddle)(()=>u.getConfig().ignoreIncomingRequestHook?.(T),H=>{H!=null&&u._diag.error("caught ignoreIncomingRequestHook error: ",H)},!0))return e.context.with((0,t.suppressTracing)(e.context.active()),()=>(e.context.bind(e.context.active(),T),e.context.bind(e.context.active(),h),d.apply(this,[p,...E])));const A=T.headers,g=(0,a.getIncomingRequestAttributes)(T,{component:f,serverName:u.getConfig().serverName,hookAttributes:u._callStartSpanHook(T,u.getConfig().startIncomingSpanHook),semconvStability:u._semconvStability,enableSyntheticSourceDetection:u.getConfig().enableSyntheticSourceDetection||!1},u._diag),R={kind:e.SpanKind.SERVER,attributes:g},O=(0,t.hrTime)(),C=(0,a.getIncomingRequestMetricAttributes)(g),I={[i.ATTR_HTTP_REQUEST_METHOD]:g[i.ATTR_HTTP_REQUEST_METHOD],[i.ATTR_URL_SCHEME]:g[i.ATTR_URL_SCHEME]};g[i.ATTR_NETWORK_PROTOCOL_VERSION]&&(I[i.ATTR_NETWORK_PROTOCOL_VERSION]=g[i.ATTR_NETWORK_PROTOCOL_VERSION]);const L=e.propagation.extract(e.ROOT_CONTEXT,A),U=u._startHttpSpan(m,R,L),q={type:t.RPCType.HTTP,span:U};return e.context.with((0,t.setRPCMetadata)(e.trace.setSpan(L,U),q),()=>{e.context.bind(e.context.active(),T),e.context.bind(e.context.active(),h),u.getConfig().requestHook&&u._callRequestHook(U,T),u.getConfig().responseHook&&u._callResponseHook(U,h),u._headerCapture.server.captureRequestHeaders(U,$=>T.headers[$]);let H=!1;return h.on("close",()=>{H||u._onServerResponseFinish(T,h,U,C,I,O)}),h.on(s.errorMonitor,$=>{H=!0,u._onServerResponseError(U,C,I,O,$)}),(0,o.safeExecuteInTheMiddle)(()=>d.apply(this,[p,...E]),$=>{if($)throw u._onServerResponseError(U,C,I,O,$),$})})}}_outgoingRequestFunction(f,d){const u=this;return function(p,...E){if(!(0,a.isValidOptionsType)(p))return d.apply(this,[p,...E]);const T=typeof E[0]=="object"&&(typeof p=="string"||p instanceof n.URL)?E.shift():void 0,{method:h,invalidUrl:m,optionsParsed:A}=(0,a.getRequestInfo)(u._diag,p,T);if((0,o.safeExecuteInTheMiddle)(()=>u.getConfig().ignoreOutgoingRequestHook?.(A),B=>{B!=null&&u._diag.error("caught ignoreOutgoingRequestHook error: ",B)},!0))return d.apply(this,[A,...E]);const{hostname:g,port:R}=(0,a.extractHostnameAndPort)(A),O=(0,a.getOutgoingRequestAttributes)(A,{component:f,port:R,hostname:g,hookAttributes:u._callStartSpanHook(A,u.getConfig().startOutgoingSpanHook),redactedQueryParams:u.getConfig().redactedQueryParams},u._semconvStability,u.getConfig().enableSyntheticSourceDetection||!1),C=(0,t.hrTime)(),I=(0,a.getOutgoingRequestMetricAttributes)(O),L={[i.ATTR_HTTP_REQUEST_METHOD]:O[i.ATTR_HTTP_REQUEST_METHOD],[i.ATTR_SERVER_ADDRESS]:O[i.ATTR_SERVER_ADDRESS],[i.ATTR_SERVER_PORT]:O[i.ATTR_SERVER_PORT]};O[i.ATTR_HTTP_RESPONSE_STATUS_CODE]&&(L[i.ATTR_HTTP_RESPONSE_STATUS_CODE]=O[i.ATTR_HTTP_RESPONSE_STATUS_CODE]),O[i.ATTR_NETWORK_PROTOCOL_VERSION]&&(L[i.ATTR_NETWORK_PROTOCOL_VERSION]=O[i.ATTR_NETWORK_PROTOCOL_VERSION]);const U={kind:e.SpanKind.CLIENT,attributes:O},q=u._startHttpSpan(h,U),H=e.context.active(),$=e.trace.setSpan(H,q);return A.headers?A.headers=Object.assign({},A.headers):A.headers={},e.propagation.inject($,A.headers),e.context.with($,()=>{const B=E[E.length-1];typeof B=="function"&&(E[E.length-1]=e.context.bind(H,B));const F=(0,o.safeExecuteInTheMiddle)(()=>m?d.apply(this,[p,...E]):d.apply(this,[A,...E]),w=>{if(w)throw u._onOutgoingRequestError(q,I,L,C,w),w});return u._diag.debug(`${f} instrumentation outgoingRequest`),e.context.bind(H,F),u._traceClientRequest(F,q,C,I,L)})}}_onServerResponseFinish(f,d,u,_,p,E){const T=(0,a.getIncomingRequestAttributesOnResponse)(f,d,this._semconvStability);_=Object.assign(_,(0,a.getIncomingRequestMetricAttributesOnResponse)(T)),p=Object.assign(p,(0,a.getIncomingStableRequestMetricAttributesOnResponse)(T)),this._headerCapture.server.captureResponseHeaders(u,m=>d.getHeader(m)),u.setAttributes(T).setStatus({code:(0,a.parseResponseStatus)(e.SpanKind.SERVER,d.statusCode)});const h=T[i.ATTR_HTTP_ROUTE];h&&u.updateName(`${f.method||"GET"} ${h}`),this.getConfig().applyCustomAttributesOnSpan&&(0,o.safeExecuteInTheMiddle)(()=>this.getConfig().applyCustomAttributesOnSpan(u,f,d),()=>{},!0),this._closeHttpSpan(u,e.SpanKind.SERVER,E,_,p)}_onOutgoingRequestError(f,d,u,_,p){(0,a.setSpanWithError)(f,p,this._semconvStability),u[i.ATTR_ERROR_TYPE]=p.name,this._closeHttpSpan(f,e.SpanKind.CLIENT,_,d,u)}_onServerResponseError(f,d,u,_,p){(0,a.setSpanWithError)(f,p,this._semconvStability),u[i.ATTR_ERROR_TYPE]=p.name,this._closeHttpSpan(f,e.SpanKind.SERVER,_,d,u)}_startHttpSpan(f,d,u=e.context.active()){const _=d.kind===e.SpanKind.CLIENT?this.getConfig().requireParentforOutgoingSpans:this.getConfig().requireParentforIncomingSpans;let p;const E=e.trace.getSpan(u);return _===!0&&(!E||!e.trace.isSpanContextValid(E.spanContext()))?p=e.trace.wrapSpanContext(e.INVALID_SPAN_CONTEXT):_===!0&&E?.spanContext().isRemote?p=E:p=this.tracer.startSpan(f,d,u),this._spanNotEnded.add(p),p}_closeHttpSpan(f,d,u,_,p){if(!this._spanNotEnded.has(f))return;f.end(),this._spanNotEnded.delete(f);const E=(0,t.hrTimeToMilliseconds)((0,t.hrTimeDuration)(u,(0,t.hrTime)()));d===e.SpanKind.SERVER?this._recordServerDuration(E,_,p):d===e.SpanKind.CLIENT&&this._recordClientDuration(E,_,p)}_callResponseHook(f,d){(0,o.safeExecuteInTheMiddle)(()=>this.getConfig().responseHook(f,d),()=>{},!0)}_callRequestHook(f,d){(0,o.safeExecuteInTheMiddle)(()=>this.getConfig().requestHook(f,d),()=>{},!0)}_callStartSpanHook(f,d){if(typeof d=="function")return(0,o.safeExecuteInTheMiddle)(()=>d(f),()=>{},!0)}_createHeaderCapture(){const f=this.getConfig();return{client:{captureRequestHeaders:(0,a.headerCapture)("request",f.headersToSpanAttributes?.client?.requestHeaders??[]),captureResponseHeaders:(0,a.headerCapture)("response",f.headersToSpanAttributes?.client?.responseHeaders??[])},server:{captureRequestHeaders:(0,a.headerCapture)("request",f.headersToSpanAttributes?.server?.requestHeaders??[]),captureResponseHeaders:(0,a.headerCapture)("response",f.headersToSpanAttributes?.server?.responseHeaders??[])}}}}return Zi.HttpInstrumentation=c,Zi}var xA;function VU(){return xA||(xA=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.HttpInstrumentation=void 0;var t=GU();Object.defineProperty(e,"HttpInstrumentation",{enumerable:!0,get:function(){return t.HttpInstrumentation}})})(nd)),nd}var xU=VU();const ue=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,ye=globalThis,Ze="10.29.0";function Fn(){return hc(ye),ye}function hc(e){const t=e.__SENTRY__=e.__SENTRY__||{};return t.version=t.version||Ze,t[Ze]=t[Ze]||{}}function Xo(e,t,n=ye){const r=n.__SENTRY__=n.__SENTRY__||{},o=r[Ze]=r[Ze]||{};return o[e]||(o[e]=t())}const IC=["debug","info","warn","error","log","assert","trace"],$U="Sentry Logger ",fu={};function sn(e){if(!("console"in ye))return e();const t=ye.console,n={},r=Object.keys(fu);r.forEach(o=>{const s=fu[o];n[o]=t[o],t[o]=s});try{return e()}finally{r.forEach(o=>{t[o]=n[o]})}}function BU(){dE().enabled=!0}function HU(){dE().enabled=!1}function CC(){return dE().enabled}function FU(...e){lE("log",...e)}function YU(...e){lE("warn",...e)}function jU(...e){lE("error",...e)}function lE(e,...t){ue&&CC()&&sn(()=>{ye.console[e](`${$U}[${e}]:`,...t)})}function dE(){return ue?Xo("loggerSettings",()=>({enabled:!1})):{enabled:!1}}const x={enable:BU,disable:HU,isEnabled:CC,log:FU,warn:YU,error:jU},MC=50,PC="?",$A=/\(error: (.*)\)/,BA=/captureMessage|captureException/;function vC(...e){const t=e.sort((n,r)=>n[0]-r[0]).map(n=>n[1]);return(n,r=0,o=0)=>{const s=[],i=n.split(`
`);for(let a=r;a<i.length;a++){let c=i[a];c.length>1024&&(c=c.slice(0,1024));const l=$A.test(c)?c.replace($A,"$1"):c;if(!l.match(/\S*Error: /)){for(const f of t){const d=f(l);if(d){s.push(d);break}}if(s.length>=MC+o)break}}return WU(s.slice(o))}}function qU(e){return Array.isArray(e)?vC(...e):e}function WU(e){if(!e.length)return[];const t=Array.from(e);return/sentryWrapped/.test(Pc(t).function||"")&&t.pop(),t.reverse(),BA.test(Pc(t).function||"")&&(t.pop(),BA.test(Pc(t).function||"")&&t.pop()),t.slice(0,MC).map(n=>({...n,filename:n.filename||Pc(t).filename,function:n.function||PC}))}function Pc(e){return e[e.length-1]||{}}const hd="<anonymous>";function LC(e){try{return!e||typeof e!="function"?hd:e.name||hd}catch{return hd}}function DC(e){return"__v_isVNode"in e&&e.__v_isVNode?"[VueVNode]":"[VueViewModel]"}const tu={},HA={};function fE(e,t){tu[e]=tu[e]||[],tu[e].push(t)}function _E(e,t){if(!HA[e]){HA[e]=!0;try{t()}catch(n){ue&&x.error(`Error while instrumenting ${e}`,n)}}}function pE(e,t){const n=e&&tu[e];if(n)for(const r of n)try{r(t)}catch(o){ue&&x.error(`Error while triggering instrumentation handler.
Type: ${e}
Name: ${LC(r)}
Error:`,o)}}let Sd=null;function KU(e){const t="error";fE(t,e),_E(t,zU)}function zU(){Sd=ye.onerror,ye.onerror=function(e,t,n,r,o){return pE("error",{column:r,error:o,line:n,msg:e,url:t}),Sd?Sd.apply(this,arguments):!1},ye.onerror.__SENTRY_INSTRUMENTED__=!0}let md=null;function ZU(e){const t="unhandledrejection";fE(t,e),_E(t,XU)}function XU(){md=ye.onunhandledrejection,ye.onunhandledrejection=function(e){return pE("unhandledrejection",e),md?md.apply(this,arguments):!0},ye.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}const wC=Object.prototype.toString;function _u(e){switch(wC.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return Jr(e,Error)}}function sl(e,t){return wC.call(e)===`[object ${t}]`}function QU(e){return sl(e,"ErrorEvent")}function pu(e){return sl(e,"String")}function EE(e){return typeof e=="object"&&e!==null&&"__sentry_template_string__"in e&&"__sentry_template_values__"in e}function UC(e){return e===null||EE(e)||typeof e!="object"&&typeof e!="function"}function oc(e){return sl(e,"Object")}function JU(e){return typeof Event<"u"&&Jr(e,Event)}function ek(e){return typeof Element<"u"&&Jr(e,Element)}function tk(e){return sl(e,"RegExp")}function tr(e){return!!(e?.then&&typeof e.then=="function")}function nk(e){return oc(e)&&"nativeEvent"in e&&"preventDefault"in e&&"stopPropagation"in e}function Jr(e,t){try{return e instanceof t}catch{return!1}}function kC(e){return!!(typeof e=="object"&&e!==null&&(e.__isVue||e._isVue||e.__v_isVNode))}const rk=ye,ok=80;function sk(e,t={}){if(!e)return"<unknown>";try{let n=e;const r=5,o=[];let s=0,i=0;const a=" > ",c=a.length;let l;const f=Array.isArray(t)?t:t.keyAttrs,d=!Array.isArray(t)&&t.maxStringLength||ok;for(;n&&s++<r&&(l=ik(n,f),!(l==="html"||s>1&&i+o.length*c+l.length>=d));)o.push(l),i+=l.length,n=n.parentNode;return o.reverse().join(a)}catch{return"<unknown>"}}function ik(e,t){const n=e,r=[];if(!n?.tagName)return"";if(rk.HTMLElement&&n instanceof HTMLElement&&n.dataset){if(n.dataset.sentryComponent)return n.dataset.sentryComponent;if(n.dataset.sentryElement)return n.dataset.sentryElement}r.push(n.tagName.toLowerCase());const o=t?.length?t.filter(i=>n.getAttribute(i)).map(i=>[i,n.getAttribute(i)]):null;if(o?.length)o.forEach(i=>{r.push(`[${i[0]}="${i[1]}"]`)});else{n.id&&r.push(`#${n.id}`);const i=n.className;if(i&&pu(i)){const a=i.split(/\s+/);for(const c of a)r.push(`.${c}`)}}const s=["aria-label","type","name","title","alt"];for(const i of s){const a=n.getAttribute(i);a&&r.push(`[${i}="${a}"]`)}return r.join("")}function ak(e,t,n){if(!(t in e))return;const r=e[t];if(typeof r!="function")return;const o=n(r);typeof o=="function"&&ck(o,r);try{e[t]=o}catch{ue&&x.log(`Failed to replace method "${t}" in object`,e)}}function an(e,t,n){try{Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0})}catch{ue&&x.log(`Failed to add non-enumerable property "${t}" to object`,e)}}function ck(e,t){try{const n=t.prototype||{};e.prototype=t.prototype=n,an(e,"__sentry_original__",t)}catch{}}function uk(e){return e.__sentry_original__}function GC(e){if(_u(e))return{message:e.message,name:e.name,stack:e.stack,...YA(e)};if(JU(e)){const t={type:e.type,target:FA(e.target),currentTarget:FA(e.currentTarget),...YA(e)};return typeof CustomEvent<"u"&&Jr(e,CustomEvent)&&(t.detail=e.detail),t}else return e}function FA(e){try{return ek(e)?sk(e):Object.prototype.toString.call(e)}catch{return"<unknown>"}}function YA(e){if(typeof e=="object"&&e!==null){const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}else return{}}function lk(e){const t=Object.keys(GC(e));return t.sort(),t[0]?t.join(", "):"[object has no keys]"}function Eu(e,t=0){return typeof e!="string"||t===0||e.length<=t?e:`${e.slice(0,t)}...`}function dk(e,t){let n=e;const r=n.length;if(r<=150)return n;t>r&&(t=r);let o=Math.max(t-60,0);o<5&&(o=0);let s=Math.min(o+140,r);return s>r-5&&(s=r),s===r&&(o=Math.max(s-140,0)),n=n.slice(o,s),o>0&&(n=`'{snip} ${n}`),s<r&&(n+=" {snip}"),n}function fk(e,t){if(!Array.isArray(e))return"";const n=[];for(let r=0;r<e.length;r++){const o=e[r];try{kC(o)?n.push(DC(o)):n.push(String(o))}catch{n.push("[value cannot be serialized]")}}return n.join(t)}function vo(e,t,n=!1){return pu(e)?tk(t)?t.test(e):pu(t)?n?e===t:e.includes(t):!1:!1}function Sc(e,t=[],n=!1){return t.some(r=>vo(e,r,n))}function _k(){const e=ye;return e.crypto||e.msCrypto}let Ad;function pk(){return Math.random()*16}function Ht(e=_k()){try{if(e?.randomUUID)return e.randomUUID().replace(/-/g,"")}catch{}return Ad||(Ad="10000000100040008000"+1e11),Ad.replace(/[018]/g,t=>(t^(pk()&15)>>t/4).toString(16))}function VC(e){return e.exception?.values?.[0]}function No(e){const{message:t,event_id:n}=e;if(t)return t;const r=VC(e);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||n||"<unknown>":n||"<unknown>"}function Ek(e,t,n){const r=e.exception=e.exception||{},o=r.values=r.values||[],s=o[0]=o[0]||{};s.value||(s.value=""),s.type||(s.type="Error")}function TE(e,t){const n=VC(e);if(!n)return;const r={type:"generic",handled:!0},o=n.mechanism;if(n.mechanism={...r,...o,...t},t&&"data"in t){const s={...o?.data,...t.data};n.mechanism.data=s}}const Tk=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/;function gd(e){return parseInt(e||"",10)}function hk(e){const t=e.match(Tk)||[],n=gd(t[1]),r=gd(t[2]),o=gd(t[3]);return{buildmetadata:t[5],major:isNaN(n)?void 0:n,minor:isNaN(r)?void 0:r,patch:isNaN(o)?void 0:o,prerelease:t[4]}}function jA(e){if(Sk(e))return!0;try{an(e,"__sentry_captured__",!0)}catch{}return!1}function Sk(e){try{return e.__sentry_captured__}catch{}}const xC=1e3;function mc(){return Date.now()/xC}function mk(){const{performance:e}=ye;if(!e?.now||!e.timeOrigin)return mc;const t=e.timeOrigin;return()=>(t+e.now())/xC}let qA;function sc(){return(qA??(qA=mk()))()}function Ak(e){const t=sc(),n={sid:Ht(),init:!0,timestamp:t,started:t,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>Rk(n)};return e&&Uo(n,e),n}function Uo(e,t={}){if(t.user&&(!e.ipAddress&&t.user.ip_address&&(e.ipAddress=t.user.ip_address),!e.did&&!t.did&&(e.did=t.user.id||t.user.email||t.user.username)),e.timestamp=t.timestamp||sc(),t.abnormal_mechanism&&(e.abnormal_mechanism=t.abnormal_mechanism),t.ignoreDuration&&(e.ignoreDuration=t.ignoreDuration),t.sid&&(e.sid=t.sid.length===32?t.sid:Ht()),t.init!==void 0&&(e.init=t.init),!e.did&&t.did&&(e.did=`${t.did}`),typeof t.started=="number"&&(e.started=t.started),e.ignoreDuration)e.duration=void 0;else if(typeof t.duration=="number")e.duration=t.duration;else{const n=e.timestamp-e.started;e.duration=n>=0?n:0}t.release&&(e.release=t.release),t.environment&&(e.environment=t.environment),!e.ipAddress&&t.ipAddress&&(e.ipAddress=t.ipAddress),!e.userAgent&&t.userAgent&&(e.userAgent=t.userAgent),typeof t.errors=="number"&&(e.errors=t.errors),t.status&&(e.status=t.status)}function gk(e,t){let n={};e.status==="ok"&&(n={status:"exited"}),Uo(e,n)}function Rk(e){return{sid:`${e.sid}`,init:e.init,started:new Date(e.started*1e3).toISOString(),timestamp:new Date(e.timestamp*1e3).toISOString(),status:e.status,errors:e.errors,did:typeof e.did=="number"||typeof e.did=="string"?`${e.did}`:void 0,duration:e.duration,abnormal_mechanism:e.abnormal_mechanism,attrs:{release:e.release,environment:e.environment,ip_address:e.ipAddress,user_agent:e.userAgent}}}function Ac(e,t,n=2){if(!t||typeof t!="object"||n<=0)return t;if(e&&Object.keys(t).length===0)return e;const r={...e};for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=Ac(r[o],t[o],n-1));return r}function eo(){return Ht()}function uo(){return Ht().substring(16)}const cp="_sentrySpan";function ic(e,t){t?an(e,cp,t):delete e[cp]}function Tu(e){return e[cp]}const Nk=100;class An{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._attributes={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:eo(),sampleRand:Math.random()}}clone(){const t=new An;return t._breadcrumbs=[...this._breadcrumbs],t._tags={...this._tags},t._attributes={...this._attributes},t._extra={...this._extra},t._contexts={...this._contexts},this._contexts.flags&&(t._contexts.flags={values:[...this._contexts.flags.values]}),t._user=this._user,t._level=this._level,t._session=this._session,t._transactionName=this._transactionName,t._fingerprint=this._fingerprint,t._eventProcessors=[...this._eventProcessors],t._attachments=[...this._attachments],t._sdkProcessingMetadata={...this._sdkProcessingMetadata},t._propagationContext={...this._propagationContext},t._client=this._client,t._lastEventId=this._lastEventId,ic(t,Tu(this)),t}setClient(t){this._client=t}setLastEventId(t){this._lastEventId=t}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(t){this._scopeListeners.push(t)}addEventProcessor(t){return this._eventProcessors.push(t),this}setUser(t){return this._user=t||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&Uo(this._session,{user:t}),this._notifyScopeListeners(),this}getUser(){return this._user}setTags(t){return this._tags={...this._tags,...t},this._notifyScopeListeners(),this}setTag(t,n){return this.setTags({[t]:n})}setAttributes(t){return this._attributes={...this._attributes,...t},this._notifyScopeListeners(),this}setAttribute(t,n){return this.setAttributes({[t]:n})}removeAttribute(t){return t in this._attributes&&(delete this._attributes[t],this._notifyScopeListeners()),this}setExtras(t){return this._extra={...this._extra,...t},this._notifyScopeListeners(),this}setExtra(t,n){return this._extra={...this._extra,[t]:n},this._notifyScopeListeners(),this}setFingerprint(t){return this._fingerprint=t,this._notifyScopeListeners(),this}setLevel(t){return this._level=t,this._notifyScopeListeners(),this}setTransactionName(t){return this._transactionName=t,this._notifyScopeListeners(),this}setContext(t,n){return n===null?delete this._contexts[t]:this._contexts[t]=n,this._notifyScopeListeners(),this}setSession(t){return t?this._session=t:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(t){if(!t)return this;const n=typeof t=="function"?t(this):t,r=n instanceof An?n.getScopeData():oc(n)?t:void 0,{tags:o,attributes:s,extra:i,user:a,contexts:c,level:l,fingerprint:f=[],propagationContext:d}=r||{};return this._tags={...this._tags,...o},this._attributes={...this._attributes,...s},this._extra={...this._extra,...i},this._contexts={...this._contexts,...c},a&&Object.keys(a).length&&(this._user=a),l&&(this._level=l),f.length&&(this._fingerprint=f),d&&(this._propagationContext=d),this}clear(){return this._breadcrumbs=[],this._tags={},this._attributes={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._session=void 0,ic(this,void 0),this._attachments=[],this.setPropagationContext({traceId:eo(),sampleRand:Math.random()}),this._notifyScopeListeners(),this}addBreadcrumb(t,n){const r=typeof n=="number"?n:Nk;if(r<=0)return this;const o={timestamp:mc(),...t,message:t.message?Eu(t.message,2048):t.message};return this._breadcrumbs.push(o),this._breadcrumbs.length>r&&(this._breadcrumbs=this._breadcrumbs.slice(-r),this._client?.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(t){return this._attachments.push(t),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,attributes:this._attributes,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:Tu(this)}}setSDKProcessingMetadata(t){return this._sdkProcessingMetadata=Ac(this._sdkProcessingMetadata,t,2),this}setPropagationContext(t){return this._propagationContext=t,this}getPropagationContext(){return this._propagationContext}captureException(t,n){const r=n?.event_id||Ht();if(!this._client)return ue&&x.warn("No client configured on scope - will not capture exception!"),r;const o=new Error("Sentry syntheticException");return this._client.captureException(t,{originalException:t,syntheticException:o,...n,event_id:r},this),r}captureMessage(t,n,r){const o=r?.event_id||Ht();if(!this._client)return ue&&x.warn("No client configured on scope - will not capture message!"),o;const s=r?.syntheticException??new Error(t);return this._client.captureMessage(t,n,{originalException:t,syntheticException:s,...r,event_id:o},this),o}captureEvent(t,n){const r=n?.event_id||Ht();return this._client?(this._client.captureEvent(t,{...n,event_id:r},this),r):(ue&&x.warn("No client configured on scope - will not capture event!"),r)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(t=>{t(this)}),this._notifyingListeners=!1)}}function hE(){return Xo("defaultCurrentScope",()=>new An)}function Qo(){return Xo("defaultIsolationScope",()=>new An)}class yk{constructor(t,n){let r;t?r=t:r=new An;let o;n?o=n:o=new An,this._stack=[{scope:r}],this._isolationScope=o}withScope(t){const n=this._pushScope();let r;try{r=t(n)}catch(o){throw this._popScope(),o}return tr(r)?r.then(o=>(this._popScope(),o),o=>{throw this._popScope(),o}):(this._popScope(),r)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const t=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:t}),t}_popScope(){return this._stack.length<=1?!1:!!this._stack.pop()}}function ko(){const e=Fn(),t=hc(e);return t.stack=t.stack||new yk(hE(),Qo())}function Ok(e){return ko().withScope(e)}function bk(e,t){const n=ko();return n.withScope(()=>(n.getStackTop().scope=e,t(e)))}function WA(e){return ko().withScope(()=>e(ko().getIsolationScope()))}function Ik(){return{withIsolationScope:WA,withScope:Ok,withSetScope:bk,withSetIsolationScope:(e,t)=>WA(t),getCurrentScope:()=>ko().getScope(),getIsolationScope:()=>ko().getIsolationScope()}}function Ck(e){const t=Fn(),n=hc(t);n.acs=e}function lo(e){const t=hc(e);return t.acs?t.acs:Ik()}function Ke(){const e=Fn();return lo(e).getCurrentScope()}function je(){const e=Fn();return lo(e).getIsolationScope()}function Mk(){return Xo("globalScope",()=>new An)}function to(...e){const t=Fn(),n=lo(t);if(e.length===2){const[r,o]=e;return r?n.withSetScope(r,o):n.withScope(o)}return n.withScope(e[0])}function Pk(...e){const t=Fn(),n=lo(t);if(e.length===2){const[r,o]=e;return r?n.withSetIsolationScope(r,o):n.withIsolationScope(o)}return n.withIsolationScope(e[0])}function Te(){return Ke().getClient()}function SE(e){const t=e.getPropagationContext(),{traceId:n,parentSpanId:r,propagationSpanId:o}=t,s={trace_id:n,span_id:o||uo()};return r&&(s.parent_span_id=r),s}const Wt="sentry.source",Go="sentry.sample_rate",vk="sentry.previous_trace_sample_rate",Ee="sentry.op",Ge="sentry.origin",Lk="sentry.measurement_unit",Dk="sentry.measurement_value",Vo="sentry.custom_span_name",mE="sentry.profile_id",AE="sentry.exclusive_time",wk="cache.hit",Uk="cache.key",kk="cache.item_size",Gk=0,hu=1,Ae=2;function up(e){if(e<400&&e>=100)return{code:hu};if(e>=400&&e<500)switch(e){case 401:return{code:Ae,message:"unauthenticated"};case 403:return{code:Ae,message:"permission_denied"};case 404:return{code:Ae,message:"not_found"};case 409:return{code:Ae,message:"already_exists"};case 413:return{code:Ae,message:"failed_precondition"};case 429:return{code:Ae,message:"resource_exhausted"};case 499:return{code:Ae,message:"cancelled"};default:return{code:Ae,message:"invalid_argument"}}if(e>=500&&e<600)switch(e){case 501:return{code:Ae,message:"unimplemented"};case 503:return{code:Ae,message:"unavailable"};case 504:return{code:Ae,message:"deadline_exceeded"};default:return{code:Ae,message:"internal_error"}}return{code:Ae,message:"internal_error"}}const $C="_sentryScope",BC="_sentryIsolationScope";function Vk(e){try{const t=ye.WeakRef;if(typeof t=="function")return new t(e)}catch{}return e}function xk(e){if(e){if(typeof e=="object"&&"deref"in e&&typeof e.deref=="function")try{return e.deref()}catch{return}return e}}function HC(e,t,n){e&&(an(e,BC,Vk(n)),an(e,$C,t))}function xo(e){const t=e;return{scope:t[$C],isolationScope:xk(t[BC])}}const gE="sentry-",$k=/^sentry-/,Bk=8192;function gc(e){const t=Su(e);if(!t)return;const n=Object.entries(t).reduce((r,[o,s])=>{if(o.match($k)){const i=o.slice(gE.length);r[i]=s}return r},{});if(Object.keys(n).length>0)return n}function RE(e){if(!e)return;const t=Object.entries(e).reduce((n,[r,o])=>(o&&(n[`${gE}${r}`]=o),n),{});return FC(t)}function Su(e){if(!(!e||!pu(e)&&!Array.isArray(e)))return Array.isArray(e)?e.reduce((t,n)=>{const r=KA(n);return Object.entries(r).forEach(([o,s])=>{t[o]=s}),t},{}):KA(e)}function KA(e){return e.split(",").map(t=>{const n=t.indexOf("=");if(n===-1)return[];const r=t.slice(0,n),o=t.slice(n+1);return[r,o].map(s=>{try{return decodeURIComponent(s.trim())}catch{return}})}).reduce((t,[n,r])=>(n&&r&&(t[n]=r),t),{})}function FC(e){if(Object.keys(e).length!==0)return Object.entries(e).reduce((t,[n,r],o)=>{const s=`${encodeURIComponent(n)}=${encodeURIComponent(r)}`,i=o===0?s:`${t},${s}`;return i.length>Bk?(ue&&x.warn(`Not adding key: ${n} with val: ${r} to baggage header due to exceeding baggage size limits.`),t):i},"")}const Hk=/^o(\d+)\./,Fk=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function Yk(e){return e==="http"||e==="https"}function fo(e,t=!1){const{host:n,path:r,pass:o,port:s,projectId:i,protocol:a,publicKey:c}=e;return`${a}://${c}${t&&o?`:${o}`:""}@${n}${s?`:${s}`:""}/${r&&`${r}/`}${i}`}function jk(e){const t=Fk.exec(e);if(!t){sn(()=>{console.error(`Invalid Sentry Dsn: ${e}`)});return}const[n,r,o="",s="",i="",a=""]=t.slice(1);let c="",l=a;const f=l.split("/");if(f.length>1&&(c=f.slice(0,-1).join("/"),l=f.pop()),l){const d=l.match(/^\d+/);d&&(l=d[0])}return YC({host:s,pass:o,path:c,projectId:l,port:i,protocol:n,publicKey:r})}function YC(e){return{protocol:e.protocol,publicKey:e.publicKey||"",pass:e.pass||"",host:e.host,port:e.port||"",path:e.path||"",projectId:e.projectId}}function qk(e){if(!ue)return!0;const{port:t,projectId:n,protocol:r}=e;return["protocol","publicKey","host","projectId"].find(i=>e[i]?!1:(x.error(`Invalid Sentry Dsn: ${i} missing`),!0))?!1:n.match(/^\d+$/)?Yk(r)?t&&isNaN(parseInt(t,10))?(x.error(`Invalid Sentry Dsn: Invalid port ${t}`),!1):!0:(x.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),!1):(x.error(`Invalid Sentry Dsn: Invalid projectId ${n}`),!1)}function Wk(e){return e.match(Hk)?.[1]}function jC(e){const t=e.getOptions(),{host:n}=e.getDsn()||{};let r;return t.orgId?r=String(t.orgId):n&&(r=Wk(n)),r}function Kk(e){const t=typeof e=="string"?jk(e):YC(e);if(!(!t||!qk(t)))return t}function no(e){if(typeof e=="boolean")return Number(e);const t=typeof e=="string"?parseFloat(e):e;if(!(typeof t!="number"||isNaN(t)||t<0||t>1))return t}const qC=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function zk(e){if(!e)return;const t=e.match(qC);if(!t)return;let n;return t[3]==="1"?n=!0:t[3]==="0"&&(n=!1),{traceId:t[1],parentSampled:n,parentSpanId:t[2]}}function WC(e,t){const n=zk(e),r=gc(t);if(!n?.traceId)return{traceId:eo(),sampleRand:Math.random()};const o=Zk(n,r);r&&(r.sample_rand=o.toString());const{traceId:s,parentSpanId:i,parentSampled:a}=n;return{traceId:s,parentSpanId:i,sampled:a,dsc:r||{},sampleRand:o}}function il(e=eo(),t=uo(),n){let r="";return n!==void 0&&(r=n?"-1":"-0"),`${e}-${t}${r}`}function KC(e=eo(),t=uo(),n){return`00-${e}-${t}-${n?"01":"00"}`}function Zk(e,t){const n=no(t?.sample_rand);if(n!==void 0)return n;const r=no(t?.sample_rate);return r&&e?.parentSampled!==void 0?e.parentSampled?Math.random()*r:r+Math.random()*(1-r):Math.random()}function Xk(e,t){const n=jC(e);return t&&n&&t!==n?(x.log(`Won't continue trace because org IDs don't match (incoming baggage: ${t}, SDK options: ${n})`),!1):(e.getOptions().strictTraceContinuation||!1)&&(t&&!n||!t&&n)?(x.log(`Starting a new trace because strict trace continuation is enabled but one org ID is missing (incoming baggage: ${t}, Sentry client: ${n})`),!1):!0}const zC=0,NE=1;let zA=!1;function Qk(e){const{spanId:t,traceId:n}=e.spanContext(),{data:r,op:o,parent_span_id:s,status:i,origin:a,links:c}=Re(e);return{parent_span_id:s,span_id:t,trace_id:n,data:r,op:o,status:i,origin:a,links:c}}function al(e){const{spanId:t,traceId:n,isRemote:r}=e.spanContext(),o=r?t:Re(e).parent_span_id,s=xo(e).scope,i=r?s?.getPropagationContext().propagationSpanId||uo():t;return{parent_span_id:o,span_id:i,trace_id:n}}function Jk(e){const{traceId:t,spanId:n}=e.spanContext(),r=_o(e);return il(t,n,r)}function e1(e){const{traceId:t,spanId:n}=e.spanContext(),r=_o(e);return KC(t,n,r)}function cl(e){if(e&&e.length>0)return e.map(({context:{spanId:t,traceId:n,traceFlags:r,...o},attributes:s})=>({span_id:t,trace_id:n,sampled:r===NE,attributes:s,...o}))}function mn(e){return typeof e=="number"?ZA(e):Array.isArray(e)?e[0]+e[1]/1e9:e instanceof Date?ZA(e.getTime()):sc()}function ZA(e){return e>9999999999?e/1e3:e}function Re(e){if(n1(e))return e.getSpanJSON();const{spanId:t,traceId:n}=e.spanContext();if(t1(e)){const{attributes:r,startTime:o,name:s,endTime:i,status:a,links:c}=e,l="parentSpanId"in e?e.parentSpanId:"parentSpanContext"in e?e.parentSpanContext?.spanId:void 0;return{span_id:t,trace_id:n,data:r,description:s,parent_span_id:l,start_timestamp:mn(o),timestamp:mn(i)||void 0,status:ul(a),op:r[Ee],origin:r[Ge],links:cl(c)}}return{span_id:t,trace_id:n,start_timestamp:0,data:{}}}function t1(e){const t=e;return!!t.attributes&&!!t.startTime&&!!t.name&&!!t.endTime&&!!t.status}function n1(e){return typeof e.getSpanJSON=="function"}function _o(e){const{traceFlags:t}=e.spanContext();return t===NE}function ul(e){if(!(!e||e.code===Gk))return e.code===hu?"ok":e.message||"internal_error"}const za="_sentryChildSpans",lp="_sentryRootSpan";function yE(e,t){const n=e[lp]||e;an(t,lp,n),e[za]?e[za].add(t):an(e,za,new Set([t]))}function r1(e){const t=new Set;function n(r){if(!t.has(r)&&_o(r)){t.add(r);const o=r[za]?Array.from(r[za]):[];for(const s of o)n(s)}}return n(e),Array.from(t)}function Ft(e){return e[lp]||e}function ll(){const e=Fn(),t=lo(e);return t.getActiveSpan?t.getActiveSpan():Tu(Ke())}function dp(){zA||(sn(()=>{console.warn("[Sentry] Returning null from `beforeSendSpan` is disallowed. To drop certain spans, configure the respective integrations directly or use `ignoreSpans`.")}),zA=!0)}let XA=!1;function o1(){if(XA)return;function e(){const t=ll(),n=t&&Ft(t);if(n){const r="internal_error";ue&&x.log(`[Tracing] Root span: ${r} -> Global error occurred`),n.setStatus({code:Ae,message:r})}}e.tag="sentry_tracingErrorCallback",XA=!0,KU(e),ZU(e)}function Kt(e){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;const t=e||Te()?.getOptions();return!!t&&(t.tracesSampleRate!=null||!!t.tracesSampler)}function QA(e){x.log(`Ignoring span ${e.op} - ${e.description} because it matches \`ignoreSpans\`.`)}function fp(e,t){if(!t?.length||!e.description)return!1;for(const n of t){if(i1(n)){if(vo(e.description,n))return ue&&QA(e),!0;continue}if(!n.name&&!n.op)continue;const r=n.name?vo(e.description,n.name):!0,o=n.op?e.op&&vo(e.op,n.op):!0;if(r&&o)return ue&&QA(e),!0}return!1}function s1(e,t){const n=t.parent_span_id,r=t.span_id;if(n)for(const o of e)o.parent_span_id===r&&(o.parent_span_id=n)}function i1(e){return typeof e=="string"||e instanceof RegExp}const OE="production",ZC="_frozenDsc";function Rd(e,t){an(e,ZC,t)}function XC(e,t){const n=t.getOptions(),{publicKey:r}=t.getDsn()||{},o={environment:n.environment||OE,release:n.release,public_key:r,trace_id:e,org_id:jC(t)};return t.emit("createDsc",o),o}function Rc(e,t){const n=t.getPropagationContext();return n.dsc||XC(n.traceId,e)}function Vt(e){const t=Te();if(!t)return{};const n=Ft(e),r=Re(n),o=r.data,s=n.spanContext().traceState,i=s?.get("sentry.sample_rate")??o[Go]??o[vk];function a(p){return(typeof i=="number"||typeof i=="string")&&(p.sample_rate=`${i}`),p}const c=n[ZC];if(c)return a(c);const l=s?.get("sentry.dsc"),f=l&&gc(l);if(f)return a(f);const d=XC(e.spanContext().traceId,t),u=o[Wt],_=r.description;return u!=="url"&&_&&(d.transaction=_),Kt()&&(d.sampled=String(_o(n)),d.sample_rand=s?.get("sentry.sample_rand")??xo(n).scope?.getPropagationContext().sampleRand.toString()),a(d),t.emit("createDsc",d,n),d}class dl{constructor(t={}){this._traceId=t.traceId||eo(),this._spanId=t.spanId||uo()}spanContext(){return{spanId:this._spanId,traceId:this._traceId,traceFlags:zC}}end(t){}setAttribute(t,n){return this}setAttributes(t){return this}setStatus(t){return this}updateName(t){return this}isRecording(){return!1}addEvent(t,n,r){return this}addLink(t){return this}addLinks(t){return this}recordException(t,n){}}function Un(e,t=100,n=1/0){try{return _p("",e,t,n)}catch(r){return{ERROR:`**non-serializable** (${r})`}}}function QC(e,t=3,n=100*1024){const r=Un(e,t);return l1(r)>n?QC(e,t-1,n):r}function _p(e,t,n=1/0,r=1/0,o=d1()){const[s,i]=o;if(t==null||["boolean","string"].includes(typeof t)||typeof t=="number"&&Number.isFinite(t))return t;const a=a1(e,t);if(!a.startsWith("[object "))return a;if(t.__sentry_skip_normalization__)return t;const c=typeof t.__sentry_override_normalization_depth__=="number"?t.__sentry_override_normalization_depth__:n;if(c===0)return a.replace("object ","");if(s(t))return"[Circular ~]";const l=t;if(l&&typeof l.toJSON=="function")try{const _=l.toJSON();return _p("",_,c-1,r,o)}catch{}const f=Array.isArray(t)?[]:{};let d=0;const u=GC(t);for(const _ in u){if(!Object.prototype.hasOwnProperty.call(u,_))continue;if(d>=r){f[_]="[MaxProperties ~]";break}const p=u[_];f[_]=_p(_,p,c-1,r,o),d++}return i(t),f}function a1(e,t){try{if(e==="domain"&&t&&typeof t=="object"&&t._events)return"[Domain]";if(e==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&t===global)return"[Global]";if(typeof window<"u"&&t===window)return"[Window]";if(typeof document<"u"&&t===document)return"[Document]";if(kC(t))return DC(t);if(nk(t))return"[SyntheticEvent]";if(typeof t=="number"&&!Number.isFinite(t))return`[${t}]`;if(typeof t=="function")return`[Function: ${LC(t)}]`;if(typeof t=="symbol")return`[${String(t)}]`;if(typeof t=="bigint")return`[BigInt: ${String(t)}]`;const n=c1(t);return/^HTML(\w*)Element$/.test(n)?`[HTMLElement: ${n}]`:`[object ${n}]`}catch(n){return`**non-serializable** (${n})`}}function c1(e){const t=Object.getPrototypeOf(e);return t?.constructor?t.constructor.name:"null prototype"}function u1(e){return~-encodeURI(e).split(/%..|./).length}function l1(e){return u1(JSON.stringify(e))}function d1(){const e=new WeakSet;function t(r){return e.has(r)?!0:(e.add(r),!1)}function n(r){e.delete(r)}return[t,n]}function rr(e,t=[]){return[e,t]}function f1(e,t){const[n,r]=e;return[n,[...r,t]]}function JA(e,t){const n=e[1];for(const r of n){const o=r[0].type;if(t(r,o))return!0}return!1}function pp(e){const t=hc(ye);return t.encodePolyfill?t.encodePolyfill(e):new TextEncoder().encode(e)}function JC(e){const[t,n]=e;let r=JSON.stringify(t);function o(s){typeof r=="string"?r=typeof s=="string"?r+s:[pp(r),s]:r.push(typeof s=="string"?pp(s):s)}for(const s of n){const[i,a]=s;if(o(`
${JSON.stringify(i)}
`),typeof a=="string"||a instanceof Uint8Array)o(a);else{let c;try{c=JSON.stringify(a)}catch{c=JSON.stringify(Un(a))}o(c)}}return typeof r=="string"?r:_1(r)}function _1(e){const t=e.reduce((o,s)=>o+s.length,0),n=new Uint8Array(t);let r=0;for(const o of e)n.set(o,r),r+=o.length;return n}function p1(e){return[{type:"span"},e]}function E1(e){const t=typeof e.data=="string"?pp(e.data):e.data;return[{type:"attachment",length:t.length,filename:e.filename,content_type:e.contentType,attachment_type:e.attachmentType},t]}const T1={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",raw_security:"security",log:"log_item",metric:"metric",trace_metric:"metric"};function eg(e){return T1[e]}function eM(e){if(!e?.sdk)return;const{name:t,version:n}=e.sdk;return{name:t,version:n}}function h1(e,t,n,r){const o=e.sdkProcessingMetadata?.dynamicSamplingContext;return{event_id:e.event_id,sent_at:new Date().toISOString(),...t&&{sdk:t},...!!n&&r&&{dsn:fo(r)},...o&&{trace:o}}}function S1(e,t){if(!t)return e;const n=e.sdk||{};return e.sdk={...n,name:n.name||t.name,version:n.version||t.version,integrations:[...e.sdk?.integrations||[],...t.integrations||[]],packages:[...e.sdk?.packages||[],...t.packages||[]],settings:e.sdk?.settings||t.settings?{...e.sdk?.settings,...t.settings}:void 0},e}function m1(e,t,n,r){const o=eM(n),s={sent_at:new Date().toISOString(),...o&&{sdk:o},...!!r&&t&&{dsn:fo(t)}},i="aggregates"in e?[{type:"sessions"},e]:[{type:"session"},e.toJSON()];return rr(s,[i])}function A1(e,t,n,r){const o=eM(n),s=e.type&&e.type!=="replay_event"?e.type:"event";S1(e,n?.sdk);const i=h1(e,o,r,t);return delete e.sdkProcessingMetadata,rr(i,[[{type:s},e]])}function g1(e,t){function n(_){return!!_.trace_id&&!!_.public_key}const r=Vt(e[0]),o=t?.getDsn(),s=t?.getOptions().tunnel,i={sent_at:new Date().toISOString(),...n(r)&&{trace:r},...!!s&&o&&{dsn:fo(o)}},{beforeSendSpan:a,ignoreSpans:c}=t?.getOptions()||{},l=c?.length?e.filter(_=>!fp(Re(_),c)):e,f=e.length-l.length;f&&t?.recordDroppedEvent("before_send","span",f);const d=a?_=>{const p=Re(_),E=a(p);return E||(dp(),p)}:Re,u=[];for(const _ of l){const p=d(_);p&&u.push(p1(p))}return rr(i,u)}function tM(e){if(!ue)return;const{description:t="< unknown name >",op:n="< unknown op >",parent_span_id:r}=Re(e),{spanId:o}=e.spanContext(),s=_o(e),i=Ft(e),a=i===e,c=`[Tracing] Starting ${s?"sampled":"unsampled"} ${a?"root ":""}span`,l=[`op: ${n}`,`name: ${t}`,`ID: ${o}`];if(r&&l.push(`parent ID: ${r}`),!a){const{op:f,description:d}=Re(i);l.push(`root ID: ${i.spanContext().spanId}`),f&&l.push(`root op: ${f}`),d&&l.push(`root description: ${d}`)}x.log(`${c}
  ${l.join(`
  `)}`)}function nM(e){if(!ue)return;const{description:t="< unknown name >",op:n="< unknown op >"}=Re(e),{spanId:r}=e.spanContext(),s=Ft(e)===e,i=`[Tracing] Finishing "${n}" ${s?"root ":""}span "${t}" with ID ${r}`;x.log(i)}function mu(e){if(!e||e.length===0)return;const t={};return e.forEach(n=>{const r=n.attributes||{},o=r[Lk],s=r[Dk];typeof o=="string"&&typeof s=="number"&&(t[n.name]={value:s,unit:o})}),t}const tg=1e3;class bE{constructor(t={}){this._traceId=t.traceId||eo(),this._spanId=t.spanId||uo(),this._startTime=t.startTimestamp||sc(),this._links=t.links,this._attributes={},this.setAttributes({[Ge]:"manual",[Ee]:t.op,...t.attributes}),this._name=t.name,t.parentSpanId&&(this._parentSpanId=t.parentSpanId),"sampled"in t&&(this._sampled=t.sampled),t.endTimestamp&&(this._endTime=t.endTimestamp),this._events=[],this._isStandaloneSpan=t.isStandalone,this._endTime&&this._onSpanEnded()}addLink(t){return this._links?this._links.push(t):this._links=[t],this}addLinks(t){return this._links?this._links.push(...t):this._links=t,this}recordException(t,n){}spanContext(){const{_spanId:t,_traceId:n,_sampled:r}=this;return{spanId:t,traceId:n,traceFlags:r?NE:zC}}setAttribute(t,n){return n===void 0?delete this._attributes[t]:this._attributes[t]=n,this}setAttributes(t){return Object.keys(t).forEach(n=>this.setAttribute(n,t[n])),this}updateStartTime(t){this._startTime=mn(t)}setStatus(t){return this._status=t,this}updateName(t){return this._name=t,this.setAttribute(Wt,"custom"),this}end(t){this._endTime||(this._endTime=mn(t),nM(this),this._onSpanEnded())}getSpanJSON(){return{data:this._attributes,description:this._name,op:this._attributes[Ee],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:ul(this._status),timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[Ge],profile_id:this._attributes[mE],exclusive_time:this._attributes[AE],measurements:mu(this._events),is_segment:this._isStandaloneSpan&&Ft(this)===this||void 0,segment_id:this._isStandaloneSpan?Ft(this).spanContext().spanId:void 0,links:cl(this._links)}}isRecording(){return!this._endTime&&!!this._sampled}addEvent(t,n,r){ue&&x.log("[Tracing] Adding an event to span:",t);const o=ng(n)?n:r||sc(),s=ng(n)?{}:n||{},i={name:t,time:mn(o),attributes:s};return this._events.push(i),this}isStandaloneSpan(){return!!this._isStandaloneSpan}_onSpanEnded(){const t=Te();if(t&&t.emit("spanEnd",this),!(this._isStandaloneSpan||this===Ft(this)))return;if(this._isStandaloneSpan){this._sampled?N1(g1([this],t)):(ue&&x.log("[Tracing] Discarding standalone span because its trace was not chosen to be sampled."),t&&t.recordDroppedEvent("sample_rate","span"));return}const r=this._convertSpanToTransaction();r&&(xo(this).scope||Ke()).captureEvent(r)}_convertSpanToTransaction(){if(!rg(Re(this)))return;this._name||(ue&&x.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>");const{scope:t,isolationScope:n}=xo(this),r=t?.getScopeData().sdkProcessingMetadata?.normalizedRequest;if(this._sampled!==!0)return;const s=r1(this).filter(f=>f!==this&&!R1(f)).map(f=>Re(f)).filter(rg),i=this._attributes[Wt];delete this._attributes[Vo],s.forEach(f=>{delete f.data[Vo]});const a={contexts:{trace:Qk(this)},spans:s.length>tg?s.sort((f,d)=>f.start_timestamp-d.start_timestamp).slice(0,tg):s,start_timestamp:this._startTime,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:t,capturedSpanIsolationScope:n,dynamicSamplingContext:Vt(this)},request:r,...i&&{transaction_info:{source:i}}},c=mu(this._events);return c&&Object.keys(c).length&&(ue&&x.log("[Measurements] Adding measurements to transaction event",JSON.stringify(c,void 0,2)),a.measurements=c),a}}function ng(e){return e&&typeof e=="number"||e instanceof Date||Array.isArray(e)}function rg(e){return!!e.start_timestamp&&!!e.timestamp&&!!e.span_id&&!!e.trace_id}function R1(e){return e instanceof bE&&e.isStandaloneSpan()}function N1(e){const t=Te();if(!t)return;const n=e[1];if(!n||n.length===0){t.recordDroppedEvent("before_send","span");return}t.sendEnvelope(e)}function ro(e,t,n=()=>{},r=()=>{}){let o;try{o=e()}catch(s){throw t(s),n(),s}return y1(o,t,n,r)}function y1(e,t,n,r){return tr(e)?e.then(o=>(n(),r(o),o),o=>{throw t(o),n(),o}):(n(),r(e),e)}function rM(e,t,n){if(!Kt(e))return[!1];let r,o;typeof e.tracesSampler=="function"?(o=e.tracesSampler({...t,inheritOrSampleWith:a=>typeof t.parentSampleRate=="number"?t.parentSampleRate:typeof t.parentSampled=="boolean"?Number(t.parentSampled):a}),r=!0):t.parentSampled!==void 0?o=t.parentSampled:typeof e.tracesSampleRate<"u"&&(o=e.tracesSampleRate,r=!0);const s=no(o);if(s===void 0)return ue&&x.warn(`[Tracing] Discarding root span because of invalid sample rate. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(o)} of type ${JSON.stringify(typeof o)}.`),[!1];if(!s)return ue&&x.log(`[Tracing] Discarding transaction because ${typeof e.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0"}`),[!1,s,r];const i=n<s;return i||ue&&x.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(o)})`),[i,s,r]}const Au="__SENTRY_SUPPRESS_TRACING__";function Jo(e,t){const n=fl();if(n.startSpan)return n.startSpan(e,t);const r=aM(e),{forceTransaction:o,parentSpan:s,scope:i}=e,a=i?.clone();return to(a,()=>uM(s)(()=>{const l=Ke(),f=cM(l,s),u=e.onlyIfParent&&!f?new dl:iM({parentSpan:f,spanArguments:r,forceTransaction:o,scope:l});return ic(l,u),ro(()=>t(u),()=>{const{status:_}=Re(u);u.isRecording()&&(!_||_==="ok")&&u.setStatus({code:Ae,message:"internal_error"})},()=>{u.end()})}))}function Vn(e,t){const n=fl();if(n.startSpanManual)return n.startSpanManual(e,t);const r=aM(e),{forceTransaction:o,parentSpan:s,scope:i}=e,a=i?.clone();return to(a,()=>uM(s)(()=>{const l=Ke(),f=cM(l,s),u=e.onlyIfParent&&!f?new dl:iM({parentSpan:f,spanArguments:r,forceTransaction:o,scope:l});return ic(l,u),ro(()=>t(u,()=>u.end()),()=>{const{status:_}=Re(u);u.isRecording()&&(!_||_==="ok")&&u.setStatus({code:Ae,message:"internal_error"})})}))}function oM(e,t){const n=fl();return n.withActiveSpan?n.withActiveSpan(e,t):to(r=>(ic(r,e||void 0),t(r)))}function sM(e){const t=fl();return t.suppressTracing?t.suppressTracing(e):to(n=>{n.setSDKProcessingMetadata({[Au]:!0});const r=e();return n.setSDKProcessingMetadata({[Au]:void 0}),r})}function iM({parentSpan:e,spanArguments:t,forceTransaction:n,scope:r}){if(!Kt()){const i=new dl;if(n||!e){const a={sampled:"false",sample_rate:"0",transaction:t.name,...Vt(i)};Rd(i,a)}return i}const o=je();let s;if(e&&!n)s=O1(e,r,t),yE(e,s);else if(e){const i=Vt(e),{traceId:a,spanId:c}=e.spanContext(),l=_o(e);s=og({traceId:a,parentSpanId:c,...t},r,l),Rd(s,i)}else{const{traceId:i,dsc:a,parentSpanId:c,sampled:l}={...o.getPropagationContext(),...r.getPropagationContext()};s=og({traceId:i,parentSpanId:c,...t},r,l),a&&Rd(s,a)}return tM(s),HC(s,r,o),s}function aM(e){const n={isStandalone:(e.experimental||{}).standalone,...e};if(e.startTime){const r={...n};return r.startTimestamp=mn(e.startTime),delete r.startTime,r}return n}function fl(){const e=Fn();return lo(e)}function og(e,t,n){const r=Te(),o=r?.getOptions()||{},{name:s=""}=e,i={spanAttributes:{...e.attributes},spanName:s,parentSampled:n};r?.emit("beforeSampling",i,{decision:!1});const a=i.parentSampled??n,c=i.spanAttributes,l=t.getPropagationContext(),[f,d,u]=t.getScopeData().sdkProcessingMetadata[Au]?[!1]:rM(o,{name:s,parentSampled:a,attributes:c,parentSampleRate:no(l.dsc?.sample_rate)},l.sampleRand),_=new bE({...e,attributes:{[Wt]:"custom",[Go]:d!==void 0&&u?d:void 0,...c},sampled:f});return!f&&r&&(ue&&x.log("[Tracing] Discarding root span because its trace was not chosen to be sampled."),r.recordDroppedEvent("sample_rate","transaction")),r&&r.emit("spanStart",_),_}function O1(e,t,n){const{spanId:r,traceId:o}=e.spanContext(),s=t.getScopeData().sdkProcessingMetadata[Au]?!1:_o(e),i=s?new bE({...n,parentSpanId:r,traceId:o,sampled:s}):new dl({traceId:o});yE(e,i);const a=Te();return a&&(a.emit("spanStart",i),n.endTimestamp&&a.emit("spanEnd",i)),i}function cM(e,t){if(t)return t;if(t===null)return;const n=Tu(e);if(!n)return;const r=Te();return(r?r.getOptions():{}).parentSpanIsAlwaysRootSpan?Ft(n):n}function uM(e){return e!==void 0?t=>oM(e,t):t=>t()}const Nd=0,sg=1,ig=2;function gu(e){return new ac(t=>{t(e)})}function IE(e){return new ac((t,n)=>{n(e)})}class ac{constructor(t){this._state=Nd,this._handlers=[],this._runExecutor(t)}then(t,n){return new ac((r,o)=>{this._handlers.push([!1,s=>{if(!t)r(s);else try{r(t(s))}catch(i){o(i)}},s=>{if(!n)o(s);else try{r(n(s))}catch(i){o(i)}}]),this._executeHandlers()})}catch(t){return this.then(n=>n,t)}finally(t){return new ac((n,r)=>{let o,s;return this.then(i=>{s=!1,o=i,t&&t()},i=>{s=!0,o=i,t&&t()}).then(()=>{if(s){r(o);return}n(o)})})}_executeHandlers(){if(this._state===Nd)return;const t=this._handlers.slice();this._handlers=[],t.forEach(n=>{n[0]||(this._state===sg&&n[1](this._value),this._state===ig&&n[2](this._value),n[0]=!0)})}_runExecutor(t){const n=(s,i)=>{if(this._state===Nd){if(tr(i)){i.then(r,o);return}this._state=s,this._value=i,this._executeHandlers()}},r=s=>{n(sg,s)},o=s=>{n(ig,s)};try{t(r,o)}catch(s){o(s)}}}function b1(e,t,n,r=0){try{const o=Ep(t,n,e,r);return tr(o)?o:gu(o)}catch(o){return IE(o)}}function Ep(e,t,n,r){const o=n[r];if(!e||!o)return e;const s=o({...e},t);return ue&&s===null&&x.log(`Event processor "${o.id||"?"}" dropped event`),tr(s)?s.then(i=>Ep(i,t,n,r+1)):Ep(s,t,n,r+1)}function I1(e,t){const{fingerprint:n,span:r,breadcrumbs:o,sdkProcessingMetadata:s}=t;C1(e,t),r&&v1(e,r),L1(e,n),M1(e,o),P1(e,s)}function ag(e,t){const{extra:n,tags:r,user:o,contexts:s,level:i,sdkProcessingMetadata:a,breadcrumbs:c,fingerprint:l,eventProcessors:f,attachments:d,propagationContext:u,transactionName:_,span:p}=t;vc(e,"extra",n),vc(e,"tags",r),vc(e,"user",o),vc(e,"contexts",s),e.sdkProcessingMetadata=Ac(e.sdkProcessingMetadata,a,2),i&&(e.level=i),_&&(e.transactionName=_),p&&(e.span=p),c.length&&(e.breadcrumbs=[...e.breadcrumbs,...c]),l.length&&(e.fingerprint=[...e.fingerprint,...l]),f.length&&(e.eventProcessors=[...e.eventProcessors,...f]),d.length&&(e.attachments=[...e.attachments,...d]),e.propagationContext={...e.propagationContext,...u}}function vc(e,t,n){e[t]=Ac(e[t],n,1)}function C1(e,t){const{extra:n,tags:r,user:o,contexts:s,level:i,transactionName:a}=t;Object.keys(n).length&&(e.extra={...n,...e.extra}),Object.keys(r).length&&(e.tags={...r,...e.tags}),Object.keys(o).length&&(e.user={...o,...e.user}),Object.keys(s).length&&(e.contexts={...s,...e.contexts}),i&&(e.level=i),a&&e.type!=="transaction"&&(e.transaction=a)}function M1(e,t){const n=[...e.breadcrumbs||[],...t];e.breadcrumbs=n.length?n:void 0}function P1(e,t){e.sdkProcessingMetadata={...e.sdkProcessingMetadata,...t}}function v1(e,t){e.contexts={trace:al(t),...e.contexts},e.sdkProcessingMetadata={dynamicSamplingContext:Vt(t),...e.sdkProcessingMetadata};const n=Ft(t),r=Re(n).description;r&&!e.transaction&&e.type==="transaction"&&(e.transaction=r)}function L1(e,t){e.fingerprint=e.fingerprint?Array.isArray(e.fingerprint)?e.fingerprint:[e.fingerprint]:[],t&&(e.fingerprint=e.fingerprint.concat(t)),e.fingerprint.length||delete e.fingerprint}let Rr,cg,ug,qn;function D1(e){const t=ye._sentryDebugIds,n=ye._debugIds;if(!t&&!n)return{};const r=t?Object.keys(t):[],o=n?Object.keys(n):[];if(qn&&r.length===cg&&o.length===ug)return qn;cg=r.length,ug=o.length,qn={},Rr||(Rr={});const s=(i,a)=>{for(const c of i){const l=a[c],f=Rr?.[c];if(f&&qn&&l)qn[f[0]]=l,Rr&&(Rr[c]=[f[0],l]);else if(l){const d=e(c);for(let u=d.length-1;u>=0;u--){const p=d[u]?.filename;if(p&&qn&&Rr){qn[p]=l,Rr[c]=[p,l];break}}}}};return t&&s(r,t),n&&s(o,n),qn}function w1(e,t,n,r,o,s){const{normalizeDepth:i=3,normalizeMaxBreadth:a=1e3}=e,c={...t,event_id:t.event_id||n.event_id||Ht(),timestamp:t.timestamp||mc()},l=n.integrations||e.integrations.map(T=>T.name);U1(c,e),V1(c,l),o&&o.emit("applyFrameMetadata",t),t.type===void 0&&k1(c,e.stackParser);const f=$1(r,n.captureContext);n.mechanism&&TE(c,n.mechanism);const d=o?o.getEventProcessors():[],u=Mk().getScopeData();if(s){const T=s.getScopeData();ag(u,T)}if(f){const T=f.getScopeData();ag(u,T)}const _=[...n.attachments||[],...u.attachments];_.length&&(n.attachments=_),I1(c,u);const p=[...d,...u.eventProcessors];return b1(p,c,n).then(T=>(T&&G1(T),typeof i=="number"&&i>0?x1(T,i,a):T))}function U1(e,t){const{environment:n,release:r,dist:o,maxValueLength:s}=t;e.environment=e.environment||n||OE,!e.release&&r&&(e.release=r),!e.dist&&o&&(e.dist=o);const i=e.request;i?.url&&s&&(i.url=Eu(i.url,s)),s&&e.exception?.values?.forEach(a=>{a.value&&(a.value=Eu(a.value,s))})}function k1(e,t){const n=D1(t);e.exception?.values?.forEach(r=>{r.stacktrace?.frames?.forEach(o=>{o.filename&&(o.debug_id=n[o.filename])})})}function G1(e){const t={};if(e.exception?.values?.forEach(r=>{r.stacktrace?.frames?.forEach(o=>{o.debug_id&&(o.abs_path?t[o.abs_path]=o.debug_id:o.filename&&(t[o.filename]=o.debug_id),delete o.debug_id)})}),Object.keys(t).length===0)return;e.debug_meta=e.debug_meta||{},e.debug_meta.images=e.debug_meta.images||[];const n=e.debug_meta.images;Object.entries(t).forEach(([r,o])=>{n.push({type:"sourcemap",code_file:r,debug_id:o})})}function V1(e,t){t.length>0&&(e.sdk=e.sdk||{},e.sdk.integrations=[...e.sdk.integrations||[],...t])}function x1(e,t,n){if(!e)return null;const r={...e,...e.breadcrumbs&&{breadcrumbs:e.breadcrumbs.map(o=>({...o,...o.data&&{data:Un(o.data,t,n)}}))},...e.user&&{user:Un(e.user,t,n)},...e.contexts&&{contexts:Un(e.contexts,t,n)},...e.extra&&{extra:Un(e.extra,t,n)}};return e.contexts?.trace&&r.contexts&&(r.contexts.trace=e.contexts.trace,e.contexts.trace.data&&(r.contexts.trace.data=Un(e.contexts.trace.data,t,n))),e.spans&&(r.spans=e.spans.map(o=>({...o,...o.data&&{data:Un(o.data,t,n)}}))),e.contexts?.flags&&r.contexts&&(r.contexts.flags=Un(e.contexts.flags,3,n)),r}function $1(e,t){if(!t)return e;const n=e?e.clone():new An;return n.update(t),n}function B1(e){if(e)return H1(e)?{captureContext:e}:Y1(e)?{captureContext:e}:e}function H1(e){return e instanceof An||typeof e=="function"}const F1=["user","level","extra","contexts","tags","fingerprint","propagationContext"];function Y1(e){return Object.keys(e).some(t=>F1.includes(t))}function xe(e,t){return Ke().captureException(e,B1(t))}function j1(e,t){return Ke().captureEvent(e,t)}function q1(e,t){je().setTag(e,t)}function lg(e){je().setUser(e)}async function W1(e){const t=Te();return t?t.flush(e):(ue&&x.warn("Cannot flush events. No client defined."),Promise.resolve(!1))}function K1(){const e=Te();return e?.getOptions().enabled!==!1&&!!e?.getTransport()}function z1(e){const t=je(),n=Ke(),{userAgent:r}=ye.navigator||{},o=Ak({user:n.getUser()||t.getUser(),...r&&{userAgent:r},...e}),s=t.getSession();return s?.status==="ok"&&Uo(s,{status:"exited"}),lM(),t.setSession(o),o}function lM(){const e=je(),n=Ke().getSession()||e.getSession();n&&gk(n),Z1(),e.setSession()}function Z1(){const e=je(),t=Te(),n=e.getSession();n&&t&&t.captureSession(n)}const X1="7";function Q1(e){const t=e.protocol?`${e.protocol}:`:"",n=e.port?`:${e.port}`:"";return`${t}//${e.host}${n}${e.path?`/${e.path}`:""}/api/`}function J1(e){return`${Q1(e)}${e.projectId}/envelope/`}function eG(e,t){const n={sentry_version:X1};return e.publicKey&&(n.sentry_key=e.publicKey),t&&(n.sentry_client=`${t.name}/${t.version}`),new URLSearchParams(n).toString()}function tG(e,t,n){return t||`${J1(e)}?${eG(e,n)}`}const dg=[];function nG(e){const t={};return e.forEach(n=>{const{name:r}=n,o=t[r];o&&!o.isDefaultInstance&&n.isDefaultInstance||(t[r]=n)}),Object.values(t)}function rG(e){const t=e.defaultIntegrations||[],n=e.integrations;t.forEach(o=>{o.isDefaultInstance=!0});let r;if(Array.isArray(n))r=[...t,...n];else if(typeof n=="function"){const o=n(t);r=Array.isArray(o)?o:[o]}else r=t;return nG(r)}function oG(e,t){const n={};return t.forEach(r=>{r&&dM(e,r,n)}),n}function fg(e,t){for(const n of t)n?.afterAllSetup&&n.afterAllSetup(e)}function dM(e,t,n){if(n[t.name]){ue&&x.log(`Integration skipped because it was already installed: ${t.name}`);return}if(n[t.name]=t,!dg.includes(t.name)&&typeof t.setupOnce=="function"&&(t.setupOnce(),dg.push(t.name)),t.setup&&typeof t.setup=="function"&&t.setup(e),typeof t.preprocessEvent=="function"){const r=t.preprocessEvent.bind(t);e.on("preprocessEvent",(o,s)=>r(o,s,e))}if(typeof t.processEvent=="function"){const r=t.processEvent.bind(t),o=Object.assign((s,i)=>r(s,i,e),{id:t.name});e.addEventProcessor(o)}ue&&x.log(`Integration installed: ${t.name}`)}function sG(e,t){return t?to(t,()=>{const n=ll(),r=n?al(n):SE(t);return[n?Vt(n):Rc(e,t),r]}):[void 0,void 0]}function iG(e){return[{type:"log",item_count:e.length,content_type:"application/vnd.sentry.items.log+json"},{items:e}]}function aG(e,t,n,r){const o={};return t?.sdk&&(o.sdk={name:t.sdk.name,version:t.sdk.version}),n&&r&&(o.dsn=fo(r)),rr(o,[iG(e)])}function fM(e,t){const n=t??cG(e)??[];if(n.length===0)return;const r=e.getOptions(),o=aG(n,r._metadata,r.tunnel,e.getDsn());_M().set(e,[]),e.emit("flushLogs"),e.sendEnvelope(o)}function cG(e){return _M().get(e)}function _M(){return Xo("clientToLogBufferMap",()=>new WeakMap)}function uG(e){return[{type:"trace_metric",item_count:e.length,content_type:"application/vnd.sentry.items.trace-metric+json"},{items:e}]}function lG(e,t,n,r){const o={};return t?.sdk&&(o.sdk={name:t.sdk.name,version:t.sdk.version}),n&&r&&(o.dsn=fo(r)),rr(o,[uG(e)])}function dG(e,t){const n=t??fG(e)??[];if(n.length===0)return;const r=e.getOptions(),o=lG(n,r._metadata,r.tunnel,e.getDsn());pM().set(e,[]),e.emit("flushMetrics"),e.sendEnvelope(o)}function fG(e){return pM().get(e)}function pM(){return Xo("clientToMetricBufferMap",()=>new WeakMap)}const CE=Symbol.for("SentryBufferFullError");function EM(e=100){const t=new Set;function n(){return t.size<e}function r(i){t.delete(i)}function o(i){if(!n())return IE(CE);const a=i();return t.add(a),a.then(()=>r(a),()=>r(a)),a}function s(i){if(!t.size)return gu(!0);const a=Promise.allSettled(Array.from(t)).then(()=>!0);if(!i)return a;const c=[a,new Promise(l=>setTimeout(()=>l(!1),i))];return Promise.race(c)}return{get $(){return Array.from(t)},add:o,drain:s}}const _G=60*1e3;function pG(e,t=Date.now()){const n=parseInt(`${e}`,10);if(!isNaN(n))return n*1e3;const r=Date.parse(`${e}`);return isNaN(r)?_G:r-t}function EG(e,t){return e[t]||e.all||0}function TG(e,t,n=Date.now()){return EG(e,t)>n}function hG(e,{statusCode:t,headers:n},r=Date.now()){const o={...e},s=n?.["x-sentry-rate-limits"],i=n?.["retry-after"];if(s)for(const a of s.trim().split(",")){const[c,l,,,f]=a.split(":",5),d=parseInt(c,10),u=(isNaN(d)?60:d)*1e3;if(!l)o.all=r+u;else for(const _ of l.split(";"))_==="metric_bucket"?(!f||f.split(";").includes("custom"))&&(o[_]=r+u):o[_]=r+u}else i?o.all=r+pG(i,r):t===429&&(o.all=r+60*1e3);return o}const TM=64;function _g(e,t,n=EM(e.bufferSize||TM)){let r={};const o=i=>n.drain(i);function s(i){const a=[];if(JA(i,(d,u)=>{const _=eg(u);TG(r,_)?e.recordDroppedEvent("ratelimit_backoff",_):a.push(d)}),a.length===0)return Promise.resolve({});const c=rr(i[0],a),l=d=>{JA(c,(u,_)=>{e.recordDroppedEvent(d,eg(_))})},f=()=>t({body:JC(c)}).then(d=>(d.statusCode!==void 0&&(d.statusCode<200||d.statusCode>=300)&&ue&&x.warn(`Sentry responded with status code ${d.statusCode} to sent event.`),r=hG(r,d),d),d=>{throw l("network_error"),ue&&x.error("Encountered error running transport request:",d),d});return n.add(f).then(d=>d,d=>{if(d===CE)return ue&&x.error("Skipped sending event because buffer is full."),l("queue_overflow"),Promise.resolve({});throw d})}return{send:s,flush:o}}function SG(e,t,n){const r=[{type:"client_report"},{timestamp:mc(),discarded_events:e}];return rr(t?{dsn:t}:{},[r])}function hM(e){const t=[];e.message&&t.push(e.message);try{const n=e.exception.values[e.exception.values.length-1];n?.value&&(t.push(n.value),n.type&&t.push(`${n.type}: ${n.value}`))}catch{}return t}function mG(e){const{trace_id:t,parent_span_id:n,span_id:r,status:o,origin:s,data:i,op:a}=e.contexts?.trace??{};return{data:i??{},description:e.transaction,op:a,parent_span_id:n,span_id:r??"",start_timestamp:e.start_timestamp??0,status:o,timestamp:e.timestamp,trace_id:t??"",origin:s,profile_id:i?.[mE],exclusive_time:i?.[AE],measurements:e.measurements,is_segment:!0}}function AG(e){return{type:"transaction",timestamp:e.timestamp,start_timestamp:e.start_timestamp,transaction:e.description,contexts:{trace:{trace_id:e.trace_id,span_id:e.span_id,parent_span_id:e.parent_span_id,op:e.op,status:e.status,origin:e.origin,data:{...e.data,...e.profile_id&&{[mE]:e.profile_id},...e.exclusive_time&&{[AE]:e.exclusive_time}}}},measurements:e.measurements}}const pg="Not capturing exception because it's already been captured.",Eg="Discarded session because of missing or non-string release",SM=Symbol.for("SentryInternalError"),mM=Symbol.for("SentryDoNotSendEventError"),gG=5e3;function nu(e){return{message:e,[SM]:!0}}function yd(e){return{message:e,[mM]:!0}}function Tg(e){return!!e&&typeof e=="object"&&SM in e}function hg(e){return!!e&&typeof e=="object"&&mM in e}function Sg(e,t,n,r,o){let s=0,i,a=!1;e.on(n,()=>{s=0,clearTimeout(i),a=!1}),e.on(t,c=>{s+=r(c),s>=8e5?o(e):a||(a=!0,i=setTimeout(()=>{o(e)},gG))}),e.on("flush",()=>{o(e)})}class RG{constructor(t){if(this._options=t,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],this._promiseBuffer=EM(t.transportOptions?.bufferSize??TM),t.dsn?this._dsn=Kk(t.dsn):ue&&x.warn("No DSN provided, client will not send events."),this._dsn){const r=tG(this._dsn,t.tunnel,t._metadata?t._metadata.sdk:void 0);this._transport=t.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...t.transportOptions,url:r})}this._options.enableLogs=this._options.enableLogs??this._options._experiments?.enableLogs,this._options.enableLogs&&Sg(this,"afterCaptureLog","flushLogs",bG,fM),(this._options.enableMetrics??this._options._experiments?.enableMetrics??!0)&&Sg(this,"afterCaptureMetric","flushMetrics",OG,dG)}captureException(t,n,r){const o=Ht();if(jA(t))return ue&&x.log(pg),o;const s={event_id:o,...n};return this._process(()=>this.eventFromException(t,s).then(i=>this._captureEvent(i,s,r)).then(i=>i),"error"),s.event_id}captureMessage(t,n,r,o){const s={event_id:Ht(),...r},i=EE(t)?t:String(t),a=UC(t),c=a?this.eventFromMessage(i,n,s):this.eventFromException(t,s);return this._process(()=>c.then(l=>this._captureEvent(l,s,o)),a?"unknown":"error"),s.event_id}captureEvent(t,n,r){const o=Ht();if(n?.originalException&&jA(n.originalException))return ue&&x.log(pg),o;const s={event_id:o,...n},i=t.sdkProcessingMetadata||{},a=i.capturedSpanScope,c=i.capturedSpanIsolationScope,l=mg(t.type);return this._process(()=>this._captureEvent(t,s,a||r,c),l),s.event_id}captureSession(t){this.sendSession(t),Uo(t,{init:!1})}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}async flush(t){const n=this._transport;if(!n)return!0;this.emit("flush");const r=await this._isClientDoneProcessing(t),o=await n.flush(t);return r&&o}async close(t){const n=await this.flush(t);return this.getOptions().enabled=!1,this.emit("close"),n}getEventProcessors(){return this._eventProcessors}addEventProcessor(t){this._eventProcessors.push(t)}init(){(this._isEnabled()||this._options.integrations.some(({name:t})=>t.startsWith("Spotlight")))&&this._setupIntegrations()}getIntegrationByName(t){return this._integrations[t]}addIntegration(t){const n=this._integrations[t.name];dM(this,t,this._integrations),n||fg(this,[t])}sendEvent(t,n={}){this.emit("beforeSendEvent",t,n);let r=A1(t,this._dsn,this._options._metadata,this._options.tunnel);for(const o of n.attachments||[])r=f1(r,E1(o));this.sendEnvelope(r).then(o=>this.emit("afterSendEvent",t,o))}sendSession(t){const{release:n,environment:r=OE}=this._options;if("aggregates"in t){const s=t.attrs||{};if(!s.release&&!n){ue&&x.warn(Eg);return}s.release=s.release||n,s.environment=s.environment||r,t.attrs=s}else{if(!t.release&&!n){ue&&x.warn(Eg);return}t.release=t.release||n,t.environment=t.environment||r}this.emit("beforeSendSession",t);const o=m1(t,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(o)}recordDroppedEvent(t,n,r=1){if(this._options.sendClientReports){const o=`${t}:${n}`;ue&&x.log(`Recording outcome: "${o}"${r>1?` (${r} times)`:""}`),this._outcomes[o]=(this._outcomes[o]||0)+r}}on(t,n){const r=this._hooks[t]=this._hooks[t]||new Set,o=(...s)=>n(...s);return r.add(o),()=>{r.delete(o)}}emit(t,...n){const r=this._hooks[t];r&&r.forEach(o=>o(...n))}async sendEnvelope(t){if(this.emit("beforeEnvelope",t),this._isEnabled()&&this._transport)try{return await this._transport.send(t)}catch(n){return ue&&x.error("Error while sending envelope:",n),{}}return ue&&x.error("Transport disabled"),{}}_setupIntegrations(){const{integrations:t}=this._options;this._integrations=oG(this,t),fg(this,t)}_updateSessionFromEvent(t,n){let r=n.level==="fatal",o=!1;const s=n.exception?.values;if(s){o=!0,r=!1;for(const c of s)if(c.mechanism?.handled===!1){r=!0;break}}const i=t.status==="ok";(i&&t.errors===0||i&&r)&&(Uo(t,{...r&&{status:"crashed"},errors:t.errors||Number(o||r)}),this.captureSession(t))}async _isClientDoneProcessing(t){let n=0;for(;!t||n<t;){if(await new Promise(r=>setTimeout(r,1)),!this._numProcessing)return!0;n++}return!1}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(t,n,r,o){const s=this.getOptions(),i=Object.keys(this._integrations);return!n.integrations&&i?.length&&(n.integrations=i),this.emit("preprocessEvent",t,n),t.type||o.setLastEventId(t.event_id||n.event_id),w1(s,t,n,r,this,o).then(a=>{if(a===null)return a;this.emit("postprocessEvent",a,n),a.contexts={trace:SE(r),...a.contexts};const c=Rc(this,r);return a.sdkProcessingMetadata={dynamicSamplingContext:c,...a.sdkProcessingMetadata},a})}_captureEvent(t,n={},r=Ke(),o=je()){return ue&&Tp(t)&&x.log(`Captured error event \`${hM(t)[0]||"<unknown>"}\``),this._processEvent(t,n,r,o).then(s=>s.event_id,s=>{ue&&(hg(s)?x.log(s.message):Tg(s)?x.warn(s.message):x.warn(s))})}_processEvent(t,n,r,o){const s=this.getOptions(),{sampleRate:i}=s,a=AM(t),c=Tp(t),f=`before send for type \`${t.type||"error"}\``,d=typeof i>"u"?void 0:no(i);if(c&&typeof d=="number"&&Math.random()>d)return this.recordDroppedEvent("sample_rate","error"),IE(yd(`Discarding event because it's not included in the random sample (sampling rate = ${i})`));const u=mg(t.type);return this._prepareEvent(t,n,r,o).then(_=>{if(_===null)throw this.recordDroppedEvent("event_processor",u),yd("An event processor returned `null`, will not send event.");if(n.data&&n.data.__sentry__===!0)return _;const E=yG(this,s,_,n);return NG(E,f)}).then(_=>{if(_===null){if(this.recordDroppedEvent("before_send",u),a){const h=1+(t.spans||[]).length;this.recordDroppedEvent("before_send","span",h)}throw yd(`${f} returned \`null\`, will not send event.`)}const p=r.getSession()||o.getSession();if(c&&p&&this._updateSessionFromEvent(p,_),a){const T=_.sdkProcessingMetadata?.spanCountBeforeProcessing||0,h=_.spans?_.spans.length:0,m=T-h;m>0&&this.recordDroppedEvent("before_send","span",m)}const E=_.transaction_info;if(a&&E&&_.transaction!==t.transaction){const T="custom";_.transaction_info={...E,source:T}}return this.sendEvent(_,n),_}).then(null,_=>{throw hg(_)||Tg(_)?_:(this.captureException(_,{mechanism:{handled:!1,type:"internal"},data:{__sentry__:!0},originalException:_}),nu(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${_}`))})}_process(t,n){this._numProcessing++,this._promiseBuffer.add(t).then(r=>(this._numProcessing--,r),r=>(this._numProcessing--,r===CE&&this.recordDroppedEvent("queue_overflow",n),r))}_clearOutcomes(){const t=this._outcomes;return this._outcomes={},Object.entries(t).map(([n,r])=>{const[o,s]=n.split(":");return{reason:o,category:s,quantity:r}})}_flushOutcomes(){ue&&x.log("Flushing outcomes...");const t=this._clearOutcomes();if(t.length===0){ue&&x.log("No outcomes to send");return}if(!this._dsn){ue&&x.log("No dsn provided, will not send outcomes");return}ue&&x.log("Sending outcomes:",t);const n=SG(t,this._options.tunnel&&fo(this._dsn));this.sendEnvelope(n)}}function mg(e){return e==="replay_event"?"replay":e||"error"}function NG(e,t){const n=`${t} must return \`null\` or a valid event.`;if(tr(e))return e.then(r=>{if(!oc(r)&&r!==null)throw nu(n);return r},r=>{throw nu(`${t} rejected with ${r}`)});if(!oc(e)&&e!==null)throw nu(n);return e}function yG(e,t,n,r){const{beforeSend:o,beforeSendTransaction:s,beforeSendSpan:i,ignoreSpans:a}=t;let c=n;if(Tp(c)&&o)return o(c,r);if(AM(c)){if(i||a){const l=mG(c);if(a?.length&&fp(l,a))return null;if(i){const f=i(l);f?c=Ac(n,AG(f)):dp()}if(c.spans){const f=[],d=c.spans;for(const _ of d){if(a?.length&&fp(_,a)){s1(d,_);continue}if(i){const p=i(_);p?f.push(p):(dp(),f.push(_))}else f.push(_)}const u=c.spans.length-f.length;u&&e.recordDroppedEvent("before_send","span",u),c.spans=f}}if(s){if(c.spans){const l=c.spans.length;c.sdkProcessingMetadata={...n.sdkProcessingMetadata,spanCountBeforeProcessing:l}}return s(c,r)}}return c}function Tp(e){return e.type===void 0}function AM(e){return e.type==="transaction"}function OG(e){let t=0;return e.name&&(t+=e.name.length*2),t+=8,t+gM(e.attributes)}function bG(e){let t=0;return e.message&&(t+=e.message.length*2),t+gM(e.attributes)}function gM(e){if(!e)return 0;let t=0;return Object.values(e).forEach(n=>{Array.isArray(n)?t+=n.length*Ag(n[0]):UC(n)?t+=Ag(n):t+=100}),t}function Ag(e){return typeof e=="string"?e.length*2:typeof e=="number"?8:typeof e=="boolean"?4:0}function IG(e,t,n,r,o){const s={sent_at:new Date().toISOString()};n?.sdk&&(s.sdk={name:n.sdk.name,version:n.sdk.version}),r&&o&&(s.dsn=fo(o)),t&&(s.trace=t);const i=CG(e);return rr(s,[i])}function CG(e){return[{type:"check_in"},e]}function MG(e){const t=e._metadata?.sdk,n=t?.name&&t?.version?`${t?.name}/${t?.version}`:void 0;e.transportOptions={...e.transportOptions,headers:{...n&&{"user-agent":n},...e.transportOptions?.headers}}}function RM(e,t){return e(t.stack||"",1)}function NM(e,t){const n={type:t.name||t.constructor.name,value:t.message},r=RM(e,t);return r.length&&(n.stacktrace={frames:r}),n}function PG(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const n=e[t];if(n instanceof Error)return n}}function vG(e){if("name"in e&&typeof e.name=="string"){let r=`'${e.name}' captured as exception`;return"message"in e&&typeof e.message=="string"&&(r+=` with message '${e.message}'`),r}else if("message"in e&&typeof e.message=="string")return e.message;const t=lk(e);if(QU(e))return`Event \`ErrorEvent\` captured as exception with message \`${e.message}\``;const n=LG(e);return`${n&&n!=="Object"?`'${n}'`:"Object"} captured as exception with keys: ${t}`}function LG(e){try{const t=Object.getPrototypeOf(e);return t?t.constructor.name:void 0}catch{}}function DG(e,t,n,r){if(_u(n))return[n,void 0];if(t.synthetic=!0,oc(n)){const s=e?.getOptions().normalizeDepth,i={__serialized__:QC(n,s)},a=PG(n);if(a)return[a,i];const c=vG(n),l=r?.syntheticException||new Error(c);return l.message=c,[l,i]}const o=r?.syntheticException||new Error(n);return o.message=`${n}`,[o,void 0]}function wG(e,t,n,r){const s=r?.data&&r.data.mechanism||{handled:!0,type:"generic"},[i,a]=DG(e,s,n,r),c={exception:{values:[NM(t,i)]}};return a&&(c.extra=a),Ek(c),TE(c,s),{...c,event_id:r?.event_id}}function UG(e,t,n="info",r,o){const s={event_id:r?.event_id,level:n};if(o&&r?.syntheticException){const i=RM(e,r.syntheticException);i.length&&(s.exception={values:[{value:t,stacktrace:{frames:i}}]},TE(s,{synthetic:!0}))}if(EE(t)){const{__sentry_template_string__:i,__sentry_template_values__:a}=t;return s.logentry={message:i,params:a},s}return s.message=t,s}class kG extends RG{constructor(t){o1(),MG(t),super(t),this._setUpMetricsProcessing()}eventFromException(t,n){const r=wG(this,this._options.stackParser,t,n);return r.level="error",gu(r)}eventFromMessage(t,n="info",r){return gu(UG(this._options.stackParser,t,n,r,this._options.attachStacktrace))}captureException(t,n,r){return gg(n),super.captureException(t,n,r)}captureEvent(t,n,r){return!t.type&&t.exception?.values&&t.exception.values.length>0&&gg(n),super.captureEvent(t,n,r)}captureCheckIn(t,n,r){const o="checkInId"in t&&t.checkInId?t.checkInId:Ht();if(!this._isEnabled())return ue&&x.warn("SDK not enabled, will not capture check-in."),o;const s=this.getOptions(),{release:i,environment:a,tunnel:c}=s,l={check_in_id:o,monitor_slug:t.monitorSlug,status:t.status,release:i,environment:a};"duration"in t&&(l.duration=t.duration),n&&(l.monitor_config={schedule:n.schedule,checkin_margin:n.checkinMargin,max_runtime:n.maxRuntime,timezone:n.timezone,failure_issue_threshold:n.failureIssueThreshold,recovery_threshold:n.recoveryThreshold});const[f,d]=sG(this,r);d&&(l.contexts={trace:d});const u=IG(l,f,this.getSdkMetadata(),c,this.getDsn());return ue&&x.log("Sending checkin:",t.monitorSlug,t.status),this.sendEnvelope(u),o}_prepareEvent(t,n,r,o){return this._options.platform&&(t.platform=t.platform||this._options.platform),this._options.runtime&&(t.contexts={...t.contexts,runtime:t.contexts?.runtime||this._options.runtime}),this._options.serverName&&(t.server_name=t.server_name||this._options.serverName),super._prepareEvent(t,n,r,o)}_setUpMetricsProcessing(){this.on("processMetric",t=>{this._options.serverName&&(t.attributes={"server.address":this._options.serverName,...t.attributes})})}}function gg(e){const t=je().getScopeData().sdkProcessingMetadata.requestSession;if(t){const n=e?.mechanism?.handled??!0;n&&t.status!=="crashed"?t.status="errored":n||(t.status="crashed")}}const ME=new Set;function GG(e){e.forEach(t=>{ME.add(t),ue&&x.log(`AI provider "${t}" wrapping will be skipped`)})}function PE(e){return ME.has(e)}function VG(){ME.clear(),ue&&x.log("Cleared AI provider skip registrations")}const xG="thismessage:/";function $G(e,t){const n=e.indexOf("://")<=0&&e.indexOf("//")!==0,r=n?xG:void 0;try{if("canParse"in URL&&!URL.canParse(e,r))return;const o=new URL(e,r);return n?{isRelative:n,pathname:o.pathname,search:o.search,hash:o.hash}:o}catch{}}function _l(e){if(!e)return{};const t=e.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};const n=t[6]||"",r=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],search:n,hash:r,relative:t[5]+n+r}}function cc(e){return e.split(/[?#]/,1)[0]}function pl(e){const{protocol:t,host:n,path:r}=e,o=n?.replace(/^.*@/,"[filtered]:[filtered]@").replace(/(:80)$/,"").replace(/(:443)$/,"")||"";return`${t?`${t}://`:""}${o}${r}`}function vE(e,t,n=[t],r="npm"){const o=e._metadata||{};o.sdk||(o.sdk={name:`sentry.javascript.${t}`,packages:n.map(s=>({name:`${r}:@sentry/${s}`,version:Ze})),version:Ze}),e._metadata=o}function yM(e={}){const t=e.client||Te();if(!K1()||!t)return{};const n=Fn(),r=lo(n);if(r.getTraceData)return r.getTraceData(e);const o=e.scope||Ke(),s=e.span||ll(),i=s?Jk(s):BG(o),a=s?Vt(s):Rc(t,o),c=RE(a);if(!qC.test(i))return x.warn("Invalid sentry-trace data. Cannot generate trace data"),{};const f={"sentry-trace":i,baggage:c};if(e.propagateTraceparent){const d=s?e1(s):HG(o);d&&(f.traceparent=d)}return f}function BG(e){const{traceId:t,sampled:n,propagationSpanId:r}=e.getPropagationContext();return il(t,r,n)}function HG(e){const{traceId:t,sampled:n,propagationSpanId:r}=e.getPropagationContext();return KC(t,r,n)}function FG(e,t,n){let r,o,s;const i=Math.max(n.maxWait,t),a=n?.setTimeoutImpl||setTimeout;function c(){return l(),r=e(),r}function l(){o!==void 0&&clearTimeout(o),s!==void 0&&clearTimeout(s),o=s=void 0}function f(){return o!==void 0||s!==void 0?c():r}function d(){return o&&clearTimeout(o),o=a(c,t),i&&s===void 0&&(s=a(c,i)),r}return d.cancel=l,d.flush=f,d}function YG(e){const t=Object.create(null);try{Object.entries(e).forEach(([n,r])=>{typeof r=="string"&&(t[n]=r)})}catch{}return t}function jG(e){const t=e.headers||{},r=(typeof t["x-forwarded-host"]=="string"?t["x-forwarded-host"]:void 0)||(typeof t.host=="string"?t.host:void 0),s=(typeof t["x-forwarded-proto"]=="string"?t["x-forwarded-proto"]:void 0)||e.protocol||(e.socket?.encrypted?"https":"http"),i=e.url||"",a=qG({url:i,host:r,protocol:s}),c=e.body||void 0,l=e.cookies;return{url:a,method:e.method,query_string:zG(i),headers:YG(t),cookies:l,data:c}}function qG({url:e,protocol:t,host:n}){if(e?.startsWith("http"))return e;if(e&&n)return`${t}://${n}${e}`}const WG=["auth","token","secret","cookie","-user","password","key","jwt","bearer","sso","saml"];function KG(e){const t={};try{Object.entries(e).forEach(([n,r])=>{if(r==null)return;const o=n.toLowerCase(),s=WG.some(a=>o.includes(a)),i=`http.request.header.${o.replace(/-/g,"_")}`;s?t[i]="[Filtered]":Array.isArray(r)?t[i]=r.map(a=>a!=null?String(a):a).join(";"):typeof r=="string"&&(t[i]=r)})}catch{}return t}function zG(e){if(e)try{const t=new URL(e,"http://s.io").search.slice(1);return t.length?t:void 0}catch{return}}const ZG=100;function $o(e,t){const n=Te(),r=je();if(!n)return;const{beforeBreadcrumb:o=null,maxBreadcrumbs:s=ZG}=n.getOptions();if(s<=0)return;const a={timestamp:mc(),...e},c=o?sn(()=>o(a,t)):a;c!==null&&(n.emit&&n.emit("beforeAddBreadcrumb",c,t),r.addBreadcrumb(c,s))}let Rg;const XG="FunctionToString",Ng=new WeakMap,QG=(()=>({name:XG,setupOnce(){Rg=Function.prototype.toString;try{Function.prototype.toString=function(...e){const t=uk(this),n=Ng.has(Te())&&t!==void 0?t:this;return Rg.apply(n,e)}}catch{}},setup(e){Ng.set(e,!0)}})),JG=QG,eV=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,/^Can't find variable: gmo$/,/^undefined is not an object \(evaluating 'a\.[A-Z]'\)$/,`can't redefine non-configurable property "solana"`,"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler",/^Non-Error promise rejection captured with value: Object Not Found Matching Id:\d+, MethodName:simulateEvent, ParamCount:\d+$/,/^Java exception was raised during method invocation$/],tV="EventFilters",nV=(e={})=>{let t;return{name:tV,setup(n){const r=n.getOptions();t=yg(e,r)},processEvent(n,r,o){if(!t){const s=o.getOptions();t=yg(e,s)}return oV(n,t)?null:n}}},rV=((e={})=>({...nV(e),name:"InboundFilters"}));function yg(e={},t={}){return{allowUrls:[...e.allowUrls||[],...t.allowUrls||[]],denyUrls:[...e.denyUrls||[],...t.denyUrls||[]],ignoreErrors:[...e.ignoreErrors||[],...t.ignoreErrors||[],...e.disableErrorDefaults?[]:eV],ignoreTransactions:[...e.ignoreTransactions||[],...t.ignoreTransactions||[]]}}function oV(e,t){if(e.type){if(e.type==="transaction"&&iV(e,t.ignoreTransactions))return ue&&x.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${No(e)}`),!0}else{if(sV(e,t.ignoreErrors))return ue&&x.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${No(e)}`),!0;if(lV(e))return ue&&x.warn(`Event dropped due to not having an error message, error type or stacktrace.
Event: ${No(e)}`),!0;if(aV(e,t.denyUrls))return ue&&x.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${No(e)}.
Url: ${Ru(e)}`),!0;if(!cV(e,t.allowUrls))return ue&&x.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${No(e)}.
Url: ${Ru(e)}`),!0}return!1}function sV(e,t){return t?.length?hM(e).some(n=>Sc(n,t)):!1}function iV(e,t){if(!t?.length)return!1;const n=e.transaction;return n?Sc(n,t):!1}function aV(e,t){if(!t?.length)return!1;const n=Ru(e);return n?Sc(n,t):!1}function cV(e,t){if(!t?.length)return!0;const n=Ru(e);return n?Sc(n,t):!0}function uV(e=[]){for(let t=e.length-1;t>=0;t--){const n=e[t];if(n&&n.filename!=="<anonymous>"&&n.filename!=="[native code]")return n.filename||null}return null}function Ru(e){try{const n=[...e.exception?.values??[]].reverse().find(r=>r.mechanism?.parent_id===void 0&&r.stacktrace?.frames?.length)?.stacktrace?.frames;return n?uV(n):null}catch{return ue&&x.error(`Cannot extract url for event ${No(e)}`),null}}function lV(e){return e.exception?.values?.length?!e.message&&!e.exception.values.some(t=>t.stacktrace||t.type&&t.type!=="Error"||t.value):!1}function dV(e,t,n,r,o,s){if(!o.exception?.values||!s||!Jr(s.originalException,Error))return;const i=o.exception.values.length>0?o.exception.values[o.exception.values.length-1]:void 0;i&&(o.exception.values=hp(e,t,r,s.originalException,n,o.exception.values,i,0))}function hp(e,t,n,r,o,s,i,a){if(s.length>=n+1)return s;let c=[...s];if(Jr(r[o],Error)){Og(i,a);const l=e(t,r[o]),f=c.length;bg(l,o,f,a),c=hp(e,t,n,r[o],o,[l,...c],l,f)}return Array.isArray(r.errors)&&r.errors.forEach((l,f)=>{if(Jr(l,Error)){Og(i,a);const d=e(t,l),u=c.length;bg(d,`errors[${f}]`,u,a),c=hp(e,t,n,l,o,[d,...c],d,u)}}),c}function Og(e,t){e.mechanism={handled:!0,type:"auto.core.linked_errors",...e.mechanism,...e.type==="AggregateError"&&{is_exception_group:!0},exception_id:t}}function bg(e,t,n,r){e.mechanism={handled:!0,...e.mechanism,type:"chained",source:t,exception_id:n,parent_id:r}}const fV="cause",_V=5,pV="LinkedErrors",EV=((e={})=>{const t=e.limit||_V,n=e.key||fV;return{name:pV,preprocessEvent(r,o,s){const i=s.getOptions();dV(NM,i.stackParser,n,t,r,o)}}}),TV=EV;function hV(e){const t={};let n=0;for(;n<e.length;){const r=e.indexOf("=",n);if(r===-1)break;let o=e.indexOf(";",n);if(o===-1)o=e.length;else if(o<r){n=e.lastIndexOf(";",r-1)+1;continue}const s=e.slice(n,r).trim();if(t[s]===void 0){let i=e.slice(r+1,o).trim();i.charCodeAt(0)===34&&(i=i.slice(1,-1));try{t[s]=i.indexOf("%")!==-1?decodeURIComponent(i):i}catch{t[s]=i}}n=o+1}return t}const OM=["X-Client-IP","X-Forwarded-For","Fly-Client-IP","CF-Connecting-IP","Fastly-Client-Ip","True-Client-Ip","X-Real-IP","X-Cluster-Client-IP","X-Forwarded","Forwarded-For","Forwarded","X-Vercel-Forwarded-For"];function SV(e){return OM.map(o=>{const s=e[o],i=Array.isArray(s)?s.join(";"):s;return o==="Forwarded"?mV(i):i?.split(",").map(a=>a.trim())}).reduce((o,s)=>s?o.concat(s):o,[]).find(o=>o!==null&&AV(o))||null}function mV(e){if(!e)return null;for(const t of e.split(";"))if(t.startsWith("for="))return t.slice(4);return null}function AV(e){return/(?:^(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}$)|(?:^(?:(?:[a-fA-F\d]{1,4}:){7}(?:[a-fA-F\d]{1,4}|:)|(?:[a-fA-F\d]{1,4}:){6}(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|:[a-fA-F\d]{1,4}|:)|(?:[a-fA-F\d]{1,4}:){5}(?::(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,2}|:)|(?:[a-fA-F\d]{1,4}:){4}(?:(?::[a-fA-F\d]{1,4}){0,1}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,3}|:)|(?:[a-fA-F\d]{1,4}:){3}(?:(?::[a-fA-F\d]{1,4}){0,2}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,4}|:)|(?:[a-fA-F\d]{1,4}:){2}(?:(?::[a-fA-F\d]{1,4}){0,3}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,5}|:)|(?:[a-fA-F\d]{1,4}:){1}(?:(?::[a-fA-F\d]{1,4}){0,4}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,6}|:)|(?::(?:(?::[a-fA-F\d]{1,4}){0,5}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,7}|:)))(?:%[0-9a-zA-Z]{1,})?$)/.test(e)}const gV={cookies:!0,data:!0,headers:!0,query_string:!0,url:!0},RV="RequestData",NV=((e={})=>{const t={...gV,...e.include};return{name:RV,processEvent(n,r,o){const{sdkProcessingMetadata:s={}}=n,{normalizedRequest:i,ipAddress:a}=s,c={...t,ip:t.ip??o.getOptions().sendDefaultPii};return i&&OV(n,i,{ipAddress:a},c),n}}}),yV=NV;function OV(e,t,n,r){if(e.request={...e.request,...bV(t,r)},r.ip){const o=t.headers&&SV(t.headers)||n.ipAddress;o&&(e.user={...e.user,ip_address:o})}}function bV(e,t){const n={},r={...e.headers};if(t.headers&&(n.headers=r,t.cookies||delete r.cookie,t.ip||OM.forEach(o=>{delete r[o]})),n.method=e.method,t.url&&(n.url=e.url),t.cookies){const o=e.cookies||(r?.cookie?hV(r.cookie):void 0);n.cookies=o||{}}return t.query_string&&(n.query_string=e.query_string),t.data&&(n.data=e.data),n}function IV(e){const t="console";fE(t,e),_E(t,CV)}function CV(){"console"in ye&&IC.forEach(function(e){e in ye.console&&ak(ye.console,e,function(t){return fu[e]=t,function(...n){pE("console",{args:n,level:e}),fu[e]?.apply(ye.console,n)}})})}function MV(e){return e==="warn"?"warning":["fatal","error","warning","log","info","debug"].includes(e)?e:"log"}function PV(e,t){let n=0;for(let r=e.length-1;r>=0;r--){const o=e[r];o==="."?e.splice(r,1):o===".."?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}const vV=/^(\S+:\\|\/?)([\s\S]*?)((?:\.{1,2}|[^/\\]+?|)(\.[^./\\]*|))(?:[/\\]*)$/;function bM(e){const t=e.length>1024?`<truncated>${e.slice(-1024)}`:e,n=vV.exec(t);return n?n.slice(1):[]}function Ig(...e){let t="",n=!1;for(let r=e.length-1;r>=-1&&!n;r--){const o=r>=0?e[r]:"/";o&&(t=`${o}/${t}`,n=o.charAt(0)==="/")}return t=PV(t.split("/").filter(r=>!!r),!n).join("/"),(n?"/":"")+t||"."}function Cg(e){let t=0;for(;t<e.length&&e[t]==="";t++);let n=e.length-1;for(;n>=0&&e[n]==="";n--);return t>n?[]:e.slice(t,n-t+1)}function LV(e,t){e=Ig(e).slice(1),t=Ig(t).slice(1);const n=Cg(e.split("/")),r=Cg(t.split("/")),o=Math.min(n.length,r.length);let s=o;for(let a=0;a<o;a++)if(n[a]!==r[a]){s=a;break}let i=[];for(let a=s;a<n.length;a++)i.push("..");return i=i.concat(r.slice(s)),i.join("/")}function DV(e){const t=bM(e),n=t[0]||"";let r=t[1];return!n&&!r?".":(r&&(r=r.slice(0,r.length-1)),n+r)}function wV(e,t){return bM(e)[2]||""}const UV="RewriteFrames",kV=(e={})=>{const t=e.root,n=e.prefix||"app:///",r="window"in ye&&!!ye.window,o=e.iteratee||GV({isBrowser:r,root:t,prefix:n});function s(a){try{return{...a,exception:{...a.exception,values:a.exception.values.map(c=>({...c,...c.stacktrace&&{stacktrace:i(c.stacktrace)}}))}}}catch{return a}}function i(a){return{...a,frames:a?.frames?.map(c=>o(c))}}return{name:UV,processEvent(a){let c=a;return a.exception&&Array.isArray(a.exception.values)&&(c=s(c)),c}}};function GV({isBrowser:e,root:t,prefix:n}){return r=>{if(!r.filename)return r;const o=/^[a-zA-Z]:\\/.test(r.filename)||r.filename.includes("\\")&&!r.filename.includes("/"),s=/^\//.test(r.filename);if(e){if(t){const i=r.filename;i.indexOf(t)===0&&(r.filename=i.replace(t,n))}}else if(o||s){const i=o?r.filename.replace(/^[a-zA-Z]:/,"").replace(/\\/g,"/"):r.filename,a=t?LV(t,i):wV(i);r.filename=`${n}${a}`}return r}}const VV="Console",xV=(e={})=>{const t=new Set(e.levels||IC);return{name:VV,setup(n){IV(({args:r,level:o})=>{Te()!==n||!t.has(o)||$V(o,r)})}}};function $V(e,t){const n={category:"console",data:{arguments:t,logger:"console"},level:MV(e),message:Mg(t)};if(e==="assert")if(t[0]===!1){const r=t.slice(1);n.message=r.length>0?`Assertion failed: ${Mg(r)}`:"Assertion failed",n.data.arguments=r}else return;$o(n,{input:t,level:e})}function Mg(e){return"util"in ye&&typeof ye.util.format=="function"?ye.util.format(...e):fk(e," ")}const BV="gen_ai.prompt",El="gen_ai.system",Rt="gen_ai.request.model",LE="gen_ai.request.stream",Tl="gen_ai.request.temperature",DE="gen_ai.request.max_tokens",hl="gen_ai.request.frequency_penalty",wE="gen_ai.request.presence_penalty",Sl="gen_ai.request.top_p",IM="gen_ai.request.top_k",HV="gen_ai.request.encoding_format",FV="gen_ai.request.dimensions",or="gen_ai.response.finish_reasons",gn="gen_ai.response.model",es="gen_ai.response.id",YV="gen_ai.response.stop_reason",Yt="gen_ai.usage.input_tokens",jt="gen_ai.usage.output_tokens",oo="gen_ai.usage.total_tokens",Hn="gen_ai.operation.name",kt="gen_ai.request.messages",qt="gen_ai.response.text",ml="gen_ai.request.available_tools",Al="gen_ai.response.streaming",yn="gen_ai.response.tool_calls",CM="gen_ai.agent.name",jV="gen_ai.pipeline.name",qV="gen_ai.usage.cache_creation_input_tokens",WV="gen_ai.usage.cache_read_input_tokens",Pg="gen_ai.usage.input_tokens.cache_write",$a="gen_ai.usage.input_tokens.cached",KV="gen_ai.invoke_agent",zV="openai.response.id",MM="openai.response.model",ZV="openai.response.timestamp",XV="openai.usage.completion_tokens",QV="openai.usage.prompt_tokens",Od={CHAT:"chat",RESPONSES:"responses",EMBEDDINGS:"embeddings"},vg="anthropic.response.timestamp",UE=new Map,PM=2e4,Nu=e=>new TextEncoder().encode(e).length,yu=e=>Nu(JSON.stringify(e));function kE(e,t){if(Nu(e)<=t)return e;let n=0,r=e.length,o="";for(;n<=r;){const s=Math.floor((n+r)/2),i=e.slice(0,s);Nu(i)<=t?(o=i,n=s+1):r=s-1}return o}function JV(e){return typeof e=="string"?e:e.text}function Lg(e,t){return typeof e=="string"?t:{...e,text:t}}function ex(e){return e!==null&&typeof e=="object"&&"content"in e&&typeof e.content=="string"}function tx(e){return e!==null&&typeof e=="object"&&"parts"in e&&Array.isArray(e.parts)&&e.parts.length>0}function nx(e,t){const n={...e,content:""},r=yu(n),o=t-r;if(o<=0)return[];const s=kE(e.content,o);return[{...e,content:s}]}function rx(e,t){const{parts:n}=e,r=n.map(a=>Lg(a,"")),o=yu({...e,parts:r});let s=t-o;if(s<=0)return[];const i=[];for(const a of n){const c=JV(a),l=Nu(c);if(l<=s)i.push(a),s-=l;else if(i.length===0){const f=kE(c,s);f&&i.push(Lg(a,f));break}else break}return i.length>0?[{...e,parts:i}]:[]}function ox(e,t){return!e||typeof e!="object"?[]:ex(e)?nx(e,t):tx(e)?rx(e,t):[]}function sx(e,t){if(!Array.isArray(e)||e.length===0||yu(e)<=t)return e;const r=e.map(yu);let o=0,s=e.length;for(let i=e.length-1;i>=0;i--){const a=r[i];if(a&&o+a>t)break;a&&(o+=a),s=i}if(s===e.length){const i=e[e.length-1];return ox(i,t)}return e.slice(s)}function GE(e){return sx(e,PM)}function ix(e){return kE(e,PM)}function Nc(e){return e.includes("messages")?"messages":e.includes("completions")?"completions":e.includes("models")?"models":e.includes("chat")?"chat":e.split(".").pop()||"unknown"}function Ou(e){return`gen_ai.${Nc(e)}`}function vM(e,t){return e?`${e}.${t}`:t}function VE(e,t,n,r,o){if(t!==void 0&&e.setAttributes({[Yt]:t}),n!==void 0&&e.setAttributes({[jt]:n}),t!==void 0||n!==void 0||r!==void 0||o!==void 0){const s=(t??0)+(n??0)+(r??0)+(o??0);e.setAttributes({[oo]:s})}}function xn(e){if(typeof e=="string")return ix(e);if(Array.isArray(e)){const t=GE(e);return JSON.stringify(t)}return JSON.stringify(e)}const ax="operation.name",bd="ai.prompt",cx="ai.schema",ux="ai.response.object",lx="ai.response.text",dx="ai.response.toolCalls",LM="ai.prompt.messages",ra="ai.prompt.tools",_n="ai.model.id",fx="ai.model.provider",_x="ai.response.providerMetadata",px="ai.usage.cachedInputTokens",Ex="ai.telemetry.functionId",Tx="ai.usage.completionTokens",hx="ai.usage.promptTokens",DM="ai.toolCall.name",wM="ai.toolCall.id",Sx="ai.toolCall.args",mx="ai.toolCall.result";function Ax(e,t){const n=e.parent_span_id;if(!n)return;const r=e.data[Yt],o=e.data[jt];if(typeof r=="number"||typeof o=="number"){const s=t.get(n)||{inputTokens:0,outputTokens:0};typeof r=="number"&&(s.inputTokens+=r),typeof o=="number"&&(s.outputTokens+=o),t.set(n,s)}}function Dg(e,t){const n=t.get(e.span_id);!n||!e.data||(n.inputTokens>0&&(e.data[Yt]=n.inputTokens),n.outputTokens>0&&(e.data[jt]=n.outputTokens),(n.inputTokens>0||n.outputTokens>0)&&(e.data["gen_ai.usage.total_tokens"]=n.inputTokens+n.outputTokens))}function gx(e){return UE.get(e)}function Rx(e){UE.delete(e)}function Nx(e){const t=e.map(n=>{if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n});return JSON.stringify(t)}function yx(e){try{const t=JSON.parse(e);if(t&&typeof t=="object"){const{prompt:n,system:r}=t;if(typeof n=="string"||typeof r=="string"){const o=[];return typeof r=="string"&&o.push({role:"system",content:r}),typeof n=="string"&&o.push({role:"user",content:n}),o}}}catch{}return[]}function Ox(e,t){if(t[bd]){const r=xn(t[bd]);e.setAttribute("gen_ai.prompt",r)}const n=t[bd];if(typeof n=="string"&&!t[kt]&&!t[LM]){const r=yx(n);r.length&&e.setAttribute(kt,xn(r))}}function UM(e,t){e.setAttribute(Ge,t)}function bx(e){const{data:t,description:n}=Re(e);if(!n)return;if(t[DM]&&t[wM]&&n==="ai.toolCall"){Mx(e,t);return}const r=t[_n],o=t[fx];typeof r!="string"||typeof o!="string"||!r||!o||Px(e,n,t)}function Ix(e){if(e.type==="transaction"&&e.spans){const t=new Map;for(const r of e.spans)Cx(r),Ax(r,t);for(const r of e.spans)r.op==="gen_ai.invoke_agent"&&Dg(r,t);const n=e.contexts?.trace;n&&n.op==="gen_ai.invoke_agent"&&Dg(n,t)}return e}function Cx(e){const{data:t,origin:n}=e;if(n==="auto.vercelai.otel"){at(t,Tx,jt),at(t,hx,Yt),at(t,px,$a),typeof t[jt]=="number"&&typeof t[Yt]=="number"&&(t["gen_ai.usage.total_tokens"]=t[jt]+t[Yt]),t[ra]&&Array.isArray(t[ra])&&(t[ra]=Nx(t[ra])),at(t,ax,Hn),at(t,LM,kt),at(t,lx,"gen_ai.response.text"),at(t,dx,"gen_ai.response.tool_calls"),at(t,ux,"gen_ai.response.object"),at(t,ra,"gen_ai.request.available_tools"),at(t,Sx,"gen_ai.tool.input"),at(t,mx,"gen_ai.tool.output"),at(t,cx,"gen_ai.request.schema"),at(t,_n,Rt),vx(t);for(const r of Object.keys(t))r.startsWith("ai.")&&at(t,r,`vercel.${r}`)}}function at(e,t,n){e[t]!=null&&(e[n]=e[t],delete e[t])}function Mx(e,t){UM(e,"auto.vercelai.otel"),e.setAttribute(Ee,"gen_ai.execute_tool"),at(t,DM,"gen_ai.tool.name"),at(t,wM,"gen_ai.tool.call.id");const n=t["gen_ai.tool.call.id"];typeof n=="string"&&UE.set(n,e),t["gen_ai.tool.type"]||e.setAttribute("gen_ai.tool.type","function");const r=t["gen_ai.tool.name"];r&&e.updateName(`execute_tool ${r}`)}function Px(e,t,n){UM(e,"auto.vercelai.otel");const r=t.replace("ai.","");e.setAttribute("ai.pipeline.name",r),e.updateName(r);const o=n[Ex];if(o&&typeof o=="string"&&(e.updateName(`${r} ${o}`),e.setAttribute("gen_ai.function_id",o)),Ox(e,n),n[_n]&&!n[gn]&&e.setAttribute(gn,n[_n]),e.setAttribute("ai.streaming",t.includes("stream")),t==="ai.generateText"){e.setAttribute(Ee,"gen_ai.invoke_agent");return}if(t==="ai.generateText.doGenerate"){e.setAttribute(Ee,"gen_ai.generate_text"),e.updateName(`generate_text ${n[_n]}`);return}if(t==="ai.streamText"){e.setAttribute(Ee,"gen_ai.invoke_agent");return}if(t==="ai.streamText.doStream"){e.setAttribute(Ee,"gen_ai.stream_text"),e.updateName(`stream_text ${n[_n]}`);return}if(t==="ai.generateObject"){e.setAttribute(Ee,"gen_ai.invoke_agent");return}if(t==="ai.generateObject.doGenerate"){e.setAttribute(Ee,"gen_ai.generate_object"),e.updateName(`generate_object ${n[_n]}`);return}if(t==="ai.streamObject"){e.setAttribute(Ee,"gen_ai.invoke_agent");return}if(t==="ai.streamObject.doStream"){e.setAttribute(Ee,"gen_ai.stream_object"),e.updateName(`stream_object ${n[_n]}`);return}if(t==="ai.embed"){e.setAttribute(Ee,"gen_ai.invoke_agent");return}if(t==="ai.embed.doEmbed"){e.setAttribute(Ee,"gen_ai.embed"),e.updateName(`embed ${n[_n]}`);return}if(t==="ai.embedMany"){e.setAttribute(Ee,"gen_ai.invoke_agent");return}if(t==="ai.embedMany.doEmbed"){e.setAttribute(Ee,"gen_ai.embed_many"),e.updateName(`embed_many ${n[_n]}`);return}if(t.startsWith("ai.stream")){e.setAttribute(Ee,"ai.run");return}}function wg(e){e.on("spanStart",bx),e.addEventProcessor(Object.assign(Ix,{id:"VercelAiEventProcessor"}))}function vx(e){const t=e[_x];if(t)try{const n=JSON.parse(t);if(n.openai&&(Jt(e,$a,n.openai.cachedPromptTokens),Jt(e,"gen_ai.usage.output_tokens.reasoning",n.openai.reasoningTokens),Jt(e,"gen_ai.usage.output_tokens.prediction_accepted",n.openai.acceptedPredictionTokens),Jt(e,"gen_ai.usage.output_tokens.prediction_rejected",n.openai.rejectedPredictionTokens),Jt(e,"gen_ai.conversation.id",n.openai.responseId)),n.anthropic){const r=n.anthropic.usage?.cache_read_input_tokens??n.anthropic.cacheReadInputTokens;Jt(e,$a,r);const o=n.anthropic.usage?.cache_creation_input_tokens??n.anthropic.cacheCreationInputTokens;Jt(e,Pg,o)}n.bedrock?.usage&&(Jt(e,$a,n.bedrock.usage.cacheReadInputTokens),Jt(e,Pg,n.bedrock.usage.cacheWriteInputTokens)),n.deepseek&&(Jt(e,$a,n.deepseek.promptCacheHitTokens),Jt(e,"gen_ai.usage.input_tokens.cache_miss",n.deepseek.promptCacheMissTokens))}catch{}}function Jt(e,t,n){n!=null&&(e[t]=n)}const gl="OpenAI",Lx=["responses.create","chat.completions.create","embeddings.create"],Dx=["response.output_item.added","response.function_call_arguments.delta","response.function_call_arguments.done","response.output_item.done"],wx=["response.created","response.in_progress","response.failed","response.completed","response.incomplete","response.queued","response.output_text.delta",...Dx];function xE(e){return e.includes("chat.completions")?Od.CHAT:e.includes("responses")?Od.RESPONSES:e.includes("embeddings")?Od.EMBEDDINGS:e.split(".").pop()||"unknown"}function Ug(e){return`gen_ai.${xE(e)}`}function Ux(e){return Lx.includes(e)}function kx(e,t){return e?`${e}.${t}`:t}function Gx(e){return e!==null&&typeof e=="object"&&"object"in e&&e.object==="chat.completion"}function Vx(e){return e!==null&&typeof e=="object"&&"object"in e&&e.object==="response"}function xx(e){if(e===null||typeof e!="object"||!("object"in e))return!1;const t=e;return t.object==="list"&&typeof t.model=="string"&&t.model.toLowerCase().includes("embedding")}function $x(e){return e!==null&&typeof e=="object"&&"type"in e&&typeof e.type=="string"&&e.type.startsWith("response.")}function Bx(e){return e!==null&&typeof e=="object"&&"object"in e&&e.object==="chat.completion.chunk"}function Hx(e,t,n){if($E(e,t.id,t.model,t.created),t.usage&&Rl(e,t.usage.prompt_tokens,t.usage.completion_tokens,t.usage.total_tokens),Array.isArray(t.choices)){const r=t.choices.map(o=>o.finish_reason).filter(o=>o!==null);if(r.length>0&&e.setAttributes({[or]:JSON.stringify(r)}),n){const o=t.choices.map(s=>s.message?.tool_calls).filter(s=>Array.isArray(s)&&s.length>0).flat();o.length>0&&e.setAttributes({[yn]:JSON.stringify(o)})}}}function Fx(e,t,n){if($E(e,t.id,t.model,t.created_at),t.status&&e.setAttributes({[or]:JSON.stringify([t.status])}),t.usage&&Rl(e,t.usage.input_tokens,t.usage.output_tokens,t.usage.total_tokens),n){const r=t;if(Array.isArray(r.output)&&r.output.length>0){const o=r.output.filter(s=>typeof s=="object"&&s!==null&&s.type==="function_call");o.length>0&&e.setAttributes({[yn]:JSON.stringify(o)})}}}function Yx(e,t){e.setAttributes({[MM]:t.model,[gn]:t.model}),t.usage&&Rl(e,t.usage.prompt_tokens,void 0,t.usage.total_tokens)}function Rl(e,t,n,r){t!==void 0&&e.setAttributes({[QV]:t,[Yt]:t}),n!==void 0&&e.setAttributes({[XV]:n,[jt]:n}),r!==void 0&&e.setAttributes({[oo]:r})}function $E(e,t,n,r){e.setAttributes({[zV]:t,[es]:t}),e.setAttributes({[MM]:n,[gn]:n}),e.setAttributes({[ZV]:new Date(r*1e3).toISOString()})}function jx(e,t){for(const n of e){const r=n.index;if(!(r===void 0||!n.function))if(!(r in t.chatCompletionToolCalls))t.chatCompletionToolCalls[r]={...n,function:{name:n.function.name,arguments:n.function.arguments||""}};else{const o=t.chatCompletionToolCalls[r];n.function.arguments&&o?.function&&(o.function.arguments+=n.function.arguments)}}}function qx(e,t,n){t.responseId=e.id??t.responseId,t.responseModel=e.model??t.responseModel,t.responseTimestamp=e.created??t.responseTimestamp,e.usage&&(t.promptTokens=e.usage.prompt_tokens,t.completionTokens=e.usage.completion_tokens,t.totalTokens=e.usage.total_tokens);for(const r of e.choices??[])n&&(r.delta?.content&&t.responseTexts.push(r.delta.content),r.delta?.tool_calls&&jx(r.delta.tool_calls,t)),r.finish_reason&&t.finishReasons.push(r.finish_reason)}function Wx(e,t,n,r){if(!(e&&typeof e=="object")){t.eventTypes.push("unknown:non-object");return}if(e instanceof Error){r.setStatus({code:Ae,message:"internal_error"}),xe(e,{mechanism:{handled:!1,type:"auto.ai.openai.stream-response"}});return}if(!("type"in e))return;const o=e;if(!wx.includes(o.type)){t.eventTypes.push(o.type);return}if(n&&(o.type==="response.output_item.done"&&"item"in o&&t.responsesApiToolCalls.push(o.item),o.type==="response.output_text.delta"&&"delta"in o&&o.delta)){t.responseTexts.push(o.delta);return}if("response"in o){const{response:s}=o;t.responseId=s.id??t.responseId,t.responseModel=s.model??t.responseModel,t.responseTimestamp=s.created_at??t.responseTimestamp,s.usage&&(t.promptTokens=s.usage.input_tokens,t.completionTokens=s.usage.output_tokens,t.totalTokens=s.usage.total_tokens),s.status&&t.finishReasons.push(s.status),n&&s.output_text&&t.responseTexts.push(s.output_text)}}async function*Kx(e,t,n){const r={eventTypes:[],responseTexts:[],finishReasons:[],responseId:"",responseModel:"",responseTimestamp:0,promptTokens:void 0,completionTokens:void 0,totalTokens:void 0,chatCompletionToolCalls:{},responsesApiToolCalls:[]};try{for await(const o of e)Bx(o)?qx(o,r,n):$x(o)&&Wx(o,r,n,t),yield o}finally{$E(t,r.responseId,r.responseModel,r.responseTimestamp),Rl(t,r.promptTokens,r.completionTokens,r.totalTokens),t.setAttributes({[Al]:!0}),r.finishReasons.length&&t.setAttributes({[or]:JSON.stringify(r.finishReasons)}),n&&r.responseTexts.length&&t.setAttributes({[qt]:r.responseTexts.join("")});const s=[...Object.values(r.chatCompletionToolCalls),...r.responsesApiToolCalls];s.length>0&&t.setAttributes({[yn]:JSON.stringify(s)}),t.end()}}function zx(e,t){const n={[El]:"openai",[Hn]:xE(t),[Ge]:"auto.ai.openai"};if(e.length>0&&typeof e[0]=="object"&&e[0]!==null){const r=e[0],o=Array.isArray(r.tools)?r.tools:[],i=r.web_search_options&&typeof r.web_search_options=="object"?[{type:"web_search_options",...r.web_search_options}]:[],a=[...o,...i];a.length>0&&(n[ml]=JSON.stringify(a))}if(e.length>0&&typeof e[0]=="object"&&e[0]!==null){const r=e[0];n[Rt]=r.model??"unknown","temperature"in r&&(n[Tl]=r.temperature),"top_p"in r&&(n[Sl]=r.top_p),"frequency_penalty"in r&&(n[hl]=r.frequency_penalty),"presence_penalty"in r&&(n[wE]=r.presence_penalty),"stream"in r&&(n[LE]=r.stream),"encoding_format"in r&&(n[HV]=r.encoding_format),"dimensions"in r&&(n[FV]=r.dimensions)}else n[Rt]="unknown";return n}function Zx(e,t,n){if(!t||typeof t!="object")return;const r=t;if(Gx(r)){if(Hx(e,r,n),n&&r.choices?.length){const o=r.choices.map(s=>s.message?.content||"");e.setAttributes({[qt]:JSON.stringify(o)})}}else Vx(r)?(Fx(e,r,n),n&&r.output_text&&e.setAttributes({[qt]:r.output_text})):xx(r)&&Yx(e,r)}function kg(e,t){if("messages"in t){const n=xn(t.messages);e.setAttributes({[kt]:n})}if("input"in t){const n=xn(t.input);e.setAttributes({[kt]:n})}}function Xx(e,t,n,r){return async function(...s){const i=zx(s,t),a=i[Rt]||"unknown",c=xE(t),l=s[0];return l&&typeof l=="object"&&l.stream===!0?Vn({name:`${c} ${a} stream-response`,op:Ug(t),attributes:i},async d=>{try{r.recordInputs&&l&&kg(d,l);const u=await e.apply(n,s);return Kx(u,d,r.recordOutputs??!1)}catch(u){throw d.setStatus({code:Ae,message:"internal_error"}),xe(u,{mechanism:{handled:!1,type:"auto.ai.openai.stream",data:{function:t}}}),d.end(),u}}):Jo({name:`${c} ${a}`,op:Ug(t),attributes:i},async d=>{try{r.recordInputs&&l&&kg(d,l);const u=await e.apply(n,s);return Zx(d,u,r.recordOutputs),u}catch(u){throw xe(u,{mechanism:{handled:!1,type:"auto.ai.openai",data:{function:t}}}),u}})}}function kM(e,t="",n){return new Proxy(e,{get(r,o){const s=r[o],i=kx(t,String(o));return typeof s=="function"&&Ux(i)?Xx(s,i,r,n):typeof s=="function"?s.bind(r):s&&typeof s=="object"?kM(s,i,n):s}})}function Qx(e,t){const n=!!Te()?.getOptions().sendDefaultPii,r={recordInputs:n,recordOutputs:n,...t};return kM(e,"",r)}function Jx(e,t){return"type"in e&&typeof e.type=="string"&&e.type==="error"?(t.setStatus({code:Ae,message:e.error?.type??"internal_error"}),xe(e.error,{mechanism:{handled:!1,type:"auto.ai.anthropic.anthropic_error"}}),!0):!1}function e$(e,t){if(e.type==="message_delta"&&e.usage&&"output_tokens"in e.usage&&typeof e.usage.output_tokens=="number"&&(t.completionTokens=e.usage.output_tokens),e.message){const n=e.message;n.id&&(t.responseId=n.id),n.model&&(t.responseModel=n.model),n.stop_reason&&t.finishReasons.push(n.stop_reason),n.usage&&(typeof n.usage.input_tokens=="number"&&(t.promptTokens=n.usage.input_tokens),typeof n.usage.cache_creation_input_tokens=="number"&&(t.cacheCreationInputTokens=n.usage.cache_creation_input_tokens),typeof n.usage.cache_read_input_tokens=="number"&&(t.cacheReadInputTokens=n.usage.cache_read_input_tokens))}}function t$(e,t){e.type!=="content_block_start"||typeof e.index!="number"||!e.content_block||(e.content_block.type==="tool_use"||e.content_block.type==="server_tool_use")&&(t.activeToolBlocks[e.index]={id:e.content_block.id,name:e.content_block.name,inputJsonParts:[]})}function n$(e,t,n){if(!(e.type!=="content_block_delta"||!e.delta)){if(typeof e.index=="number"&&"partial_json"in e.delta&&typeof e.delta.partial_json=="string"){const r=t.activeToolBlocks[e.index];r&&r.inputJsonParts.push(e.delta.partial_json)}n&&typeof e.delta.text=="string"&&t.responseTexts.push(e.delta.text)}}function r$(e,t){if(e.type!=="content_block_stop"||typeof e.index!="number")return;const n=t.activeToolBlocks[e.index];if(!n)return;const r=n.inputJsonParts.join("");let o;try{o=r?JSON.parse(r):{}}catch{o={__unparsed:r}}t.toolCalls.push({type:"tool_use",id:n.id,name:n.name,input:o}),delete t.activeToolBlocks[e.index]}function GM(e,t,n,r){!(e&&typeof e=="object")||Jx(e,r)||(e$(e,t),t$(e,t),n$(e,t,n),r$(e,t))}function o$(e,t,n){t.isRecording()&&(e.responseId&&t.setAttributes({[es]:e.responseId}),e.responseModel&&t.setAttributes({[gn]:e.responseModel}),VE(t,e.promptTokens,e.completionTokens,e.cacheCreationInputTokens,e.cacheReadInputTokens),t.setAttributes({[Al]:!0}),e.finishReasons.length>0&&t.setAttributes({[or]:JSON.stringify(e.finishReasons)}),n&&e.responseTexts.length>0&&t.setAttributes({[qt]:e.responseTexts.join("")}),n&&e.toolCalls.length>0&&t.setAttributes({[yn]:JSON.stringify(e.toolCalls)}),t.end())}async function*s$(e,t,n){const r={responseTexts:[],finishReasons:[],responseId:"",responseModel:"",promptTokens:void 0,completionTokens:void 0,cacheCreationInputTokens:void 0,cacheReadInputTokens:void 0,toolCalls:[],activeToolBlocks:{}};try{for await(const o of e)GM(o,r,n,t),yield o}finally{r.responseId&&t.setAttributes({[es]:r.responseId}),r.responseModel&&t.setAttributes({[gn]:r.responseModel}),VE(t,r.promptTokens,r.completionTokens,r.cacheCreationInputTokens,r.cacheReadInputTokens),t.setAttributes({[Al]:!0}),r.finishReasons.length>0&&t.setAttributes({[or]:JSON.stringify(r.finishReasons)}),n&&r.responseTexts.length>0&&t.setAttributes({[qt]:r.responseTexts.join("")}),n&&r.toolCalls.length>0&&t.setAttributes({[yn]:JSON.stringify(r.toolCalls)}),t.end()}}function i$(e,t,n){const r={responseTexts:[],finishReasons:[],responseId:"",responseModel:"",promptTokens:void 0,completionTokens:void 0,cacheCreationInputTokens:void 0,cacheReadInputTokens:void 0,toolCalls:[],activeToolBlocks:{}};return e.on("streamEvent",o=>{GM(o,r,n,t)}),e.on("message",()=>{o$(r,t,n)}),e.on("error",o=>{xe(o,{mechanism:{handled:!1,type:"auto.ai.anthropic.stream_error"}}),t.isRecording()&&(t.setStatus({code:Ae,message:"stream_error"}),t.end())}),e}const Nl="Anthropic_AI",a$=["messages.create","messages.stream","messages.countTokens","models.get","completions.create","models.retrieve","beta.messages.create"];function c$(e){return a$.includes(e)}function u$(e,t){t.error&&(e.setStatus({code:Ae,message:t.error.type||"internal_error"}),xe(t.error,{mechanism:{handled:!1,type:"auto.ai.anthropic.anthropic_error"}}))}function l$(e){const{system:t,messages:n}=e,r=typeof t=="string"?[{role:"system",content:e.system}]:[],o=Array.isArray(n)?n:n!=null?[n]:[];return[...r,...o]}function d$(e,t){const n={[El]:"anthropic",[Hn]:Nc(t),[Ge]:"auto.ai.anthropic"};if(e.length>0&&typeof e[0]=="object"&&e[0]!==null){const r=e[0];r.tools&&Array.isArray(r.tools)&&(n[ml]=JSON.stringify(r.tools)),n[Rt]=r.model??"unknown","temperature"in r&&(n[Tl]=r.temperature),"top_p"in r&&(n[Sl]=r.top_p),"stream"in r&&(n[LE]=r.stream),"top_k"in r&&(n[IM]=r.top_k),"frequency_penalty"in r&&(n[hl]=r.frequency_penalty),"max_tokens"in r&&(n[DE]=r.max_tokens)}else t==="models.retrieve"||t==="models.get"?n[Rt]=e[0]:n[Rt]="unknown";return n}function Sp(e,t){const n=l$(t);if(n.length){const r=xn(n);e.setAttributes({[kt]:r})}if("input"in t){const r=xn(t.input);e.setAttributes({[kt]:r})}"prompt"in t&&e.setAttributes({[BV]:JSON.stringify(t.prompt)})}function f$(e,t){if("content"in t&&Array.isArray(t.content)){e.setAttributes({[qt]:t.content.map(r=>r.text).filter(r=>!!r).join("")});const n=[];for(const r of t.content)(r.type==="tool_use"||r.type==="server_tool_use")&&n.push(r);n.length>0&&e.setAttributes({[yn]:JSON.stringify(n)})}"completion"in t&&e.setAttributes({[qt]:t.completion}),"input_tokens"in t&&e.setAttributes({[qt]:JSON.stringify(t.input_tokens)})}function _$(e,t){"id"in t&&"model"in t&&(e.setAttributes({[es]:t.id,[gn]:t.model}),"created"in t&&typeof t.created=="number"&&e.setAttributes({[vg]:new Date(t.created*1e3).toISOString()}),"created_at"in t&&typeof t.created_at=="number"&&e.setAttributes({[vg]:new Date(t.created_at*1e3).toISOString()}),"usage"in t&&t.usage&&VE(e,t.usage.input_tokens,t.usage.output_tokens,t.usage.cache_creation_input_tokens,t.usage.cache_read_input_tokens))}function p$(e,t,n){if(!(!t||typeof t!="object")){if("type"in t&&t.type==="error"){u$(e,t);return}n&&f$(e,t),_$(e,t)}}function Gg(e,t,n){throw xe(e,{mechanism:{handled:!1,type:"auto.ai.anthropic",data:{function:n}}}),t.isRecording()&&(t.setStatus({code:Ae,message:"internal_error"}),t.end()),e}function E$(e,t,n,r,o,s,i,a,c,l,f){const d=o[Rt]??"unknown",u={name:`${s} ${d} stream-response`,op:Ou(i),attributes:o};return l&&!f?Vn(u,async _=>{try{c.recordInputs&&a&&Sp(_,a);const p=await e.apply(n,r);return s$(p,_,c.recordOutputs??!1)}catch(p){return Gg(p,_,i)}}):Vn(u,_=>{try{c.recordInputs&&a&&Sp(_,a);const p=t.apply(n,r);return i$(p,_,c.recordOutputs??!1)}catch(p){return Gg(p,_,i)}})}function T$(e,t,n,r){return new Proxy(e,{apply(o,s,i){const a=d$(i,t),c=a[Rt]??"unknown",l=Nc(t),f=typeof i[0]=="object"?i[0]:void 0,d=!!f?.stream,u=t==="messages.stream";return d||u?E$(e,o,n,i,a,l,t,f,r,d,u):Jo({name:`${l} ${c}`,op:Ou(t),attributes:a},_=>(r.recordInputs&&f&&Sp(_,f),ro(()=>o.apply(n,i),p=>{xe(p,{mechanism:{handled:!1,type:"auto.ai.anthropic",data:{function:t}}})},()=>{},p=>p$(_,p,r.recordOutputs))))}})}function VM(e,t="",n){return new Proxy(e,{get(r,o){const s=r[o],i=vM(t,String(o));return typeof s=="function"&&c$(i)?T$(s,i,r,n):typeof s=="function"?s.bind(r):s&&typeof s=="object"?VM(s,i,n):s}})}function h$(e,t){const n=!!Te()?.getOptions().sendDefaultPii,r={recordInputs:n,recordOutputs:n,...t};return VM(e,"",r)}const yl="Google_GenAI",Vg=["models.generateContent","models.generateContentStream","chats.create","sendMessage","sendMessageStream"],S$="google_genai",xM="chats.create",m$="chat";function A$(e,t){const n=e?.promptFeedback;if(n?.blockReason){const r=n.blockReasonMessage??n.blockReason;return t.setStatus({code:Ae,message:`Content blocked: ${r}`}),xe(`Content blocked: ${r}`,{mechanism:{handled:!1,type:"auto.ai.google_genai"}}),!0}return!1}function g$(e,t){typeof e.responseId=="string"&&(t.responseId=e.responseId),typeof e.modelVersion=="string"&&(t.responseModel=e.modelVersion);const n=e.usageMetadata;n&&(typeof n.promptTokenCount=="number"&&(t.promptTokens=n.promptTokenCount),typeof n.candidatesTokenCount=="number"&&(t.completionTokens=n.candidatesTokenCount),typeof n.totalTokenCount=="number"&&(t.totalTokens=n.totalTokenCount))}function R$(e,t,n){Array.isArray(e.functionCalls)&&t.toolCalls.push(...e.functionCalls);for(const r of e.candidates??[]){r?.finishReason&&!t.finishReasons.includes(r.finishReason)&&t.finishReasons.push(r.finishReason);for(const o of r?.content?.parts??[])n&&o.text&&t.responseTexts.push(o.text),o.functionCall&&t.toolCalls.push({type:"function",id:o.functionCall.id,name:o.functionCall.name,arguments:o.functionCall.args})}}function N$(e,t,n,r){!e||A$(e,r)||(g$(e,t),R$(e,t,n))}async function*y$(e,t,n){const r={responseTexts:[],finishReasons:[],toolCalls:[]};try{for await(const o of e)N$(o,r,n,t),yield o}finally{const o={[Al]:!0};r.responseId&&(o[es]=r.responseId),r.responseModel&&(o[gn]=r.responseModel),r.promptTokens!==void 0&&(o[Yt]=r.promptTokens),r.completionTokens!==void 0&&(o[jt]=r.completionTokens),r.totalTokens!==void 0&&(o[oo]=r.totalTokens),r.finishReasons.length&&(o[or]=JSON.stringify(r.finishReasons)),n&&r.responseTexts.length&&(o[qt]=r.responseTexts.join("")),n&&r.toolCalls.length&&(o[yn]=JSON.stringify(r.toolCalls)),t.setAttributes(o),t.end()}}function O$(e){if(Vg.includes(e))return!0;const t=e.split(".").pop();return Vg.includes(t)}function b$(e){return e.includes("Stream")||e.endsWith("generateContentStream")||e.endsWith("sendMessageStream")}function xg(e,t){if("model"in e&&typeof e.model=="string")return e.model;if(t&&typeof t=="object"){const n=t;if("model"in n&&typeof n.model=="string")return n.model;if("modelVersion"in n&&typeof n.modelVersion=="string")return n.modelVersion}return"unknown"}function I$(e){const t={};return"temperature"in e&&typeof e.temperature=="number"&&(t[Tl]=e.temperature),"topP"in e&&typeof e.topP=="number"&&(t[Sl]=e.topP),"topK"in e&&typeof e.topK=="number"&&(t[IM]=e.topK),"maxOutputTokens"in e&&typeof e.maxOutputTokens=="number"&&(t[DE]=e.maxOutputTokens),"frequencyPenalty"in e&&typeof e.frequencyPenalty=="number"&&(t[hl]=e.frequencyPenalty),"presencePenalty"in e&&typeof e.presencePenalty=="number"&&(t[wE]=e.presencePenalty),t}function C$(e,t,n){const r={[El]:S$,[Hn]:Nc(e),[Ge]:"auto.ai.google_genai"};if(t){if(r[Rt]=xg(t,n),"config"in t&&typeof t.config=="object"&&t.config){const o=t.config;if(Object.assign(r,I$(o)),"tools"in o&&Array.isArray(o.tools)){const s=o.tools.flatMap(i=>i.functionDeclarations);r[ml]=JSON.stringify(s)}}}else r[Rt]=xg({},n);return r}function $g(e,t){if("contents"in t){const n=t.contents,r=xn(n);e.setAttributes({[kt]:r})}if("message"in t){const n=t.message,r=xn(n);e.setAttributes({[kt]:r})}if("history"in t){const n=t.history,r=xn(n);e.setAttributes({[kt]:r})}}function M$(e,t,n){if(!(!t||typeof t!="object")){if(t.usageMetadata&&typeof t.usageMetadata=="object"){const r=t.usageMetadata;typeof r.promptTokenCount=="number"&&e.setAttributes({[Yt]:r.promptTokenCount}),typeof r.candidatesTokenCount=="number"&&e.setAttributes({[jt]:r.candidatesTokenCount}),typeof r.totalTokenCount=="number"&&e.setAttributes({[oo]:r.totalTokenCount})}if(n&&Array.isArray(t.candidates)&&t.candidates.length>0){const r=t.candidates.map(o=>o.content?.parts&&Array.isArray(o.content.parts)?o.content.parts.map(s=>typeof s.text=="string"?s.text:"").filter(s=>s.length>0).join(""):"").filter(o=>o.length>0);r.length>0&&e.setAttributes({[qt]:r.join("")})}if(n&&t.functionCalls){const r=t.functionCalls;Array.isArray(r)&&r.length>0&&e.setAttributes({[yn]:JSON.stringify(r)})}}}function Bg(e,t,n,r){const o=t===xM;return new Proxy(e,{apply(s,i,a){const c=a[0],l=C$(t,c,n),f=l[Rt]??"unknown",d=Nc(t);return b$(t)?Vn({name:`${d} ${f} stream-response`,op:Ou(t),attributes:l},async u=>{try{r.recordInputs&&c&&$g(u,c);const _=await s.apply(n,a);return y$(_,u,!!r.recordOutputs)}catch(_){throw u.setStatus({code:Ae,message:"internal_error"}),xe(_,{mechanism:{handled:!1,type:"auto.ai.google_genai",data:{function:t}}}),u.end(),_}}):Jo({name:o?`${d} ${f} create`:`${d} ${f}`,op:Ou(t),attributes:l},u=>(r.recordInputs&&c&&$g(u,c),ro(()=>s.apply(n,a),_=>{xe(_,{mechanism:{handled:!1,type:"auto.ai.google_genai",data:{function:t}}})},()=>{},_=>{o||M$(u,_,r.recordOutputs)})))}})}function mp(e,t="",n){return new Proxy(e,{get:(r,o,s)=>{const i=Reflect.get(r,o,s),a=vM(t,String(o));if(typeof i=="function"&&O$(a)){if(a===xM){const c=Bg(i,a,r,n);return function(...f){const d=c(...f);return d&&typeof d=="object"?mp(d,m$,n):d}}return Bg(i,a,r,n)}return typeof i=="function"?i.bind(r):i&&typeof i=="object"?mp(i,a,n):i}})}function P$(e,t){const n=!!Te()?.getOptions().sendDefaultPii,r={recordInputs:n,recordOutputs:n,...t};return mp(e,"",r)}const $M="LangChain",Ba="auto.ai.langchain",v$={human:"user",ai:"assistant",assistant:"assistant",system:"system",function:"function",tool:"tool"},kn=(e,t,n)=>{n!=null&&(e[t]=n)},vt=(e,t,n)=>{const r=Number(n);Number.isNaN(r)||(e[t]=r)};function It(e){if(typeof e=="string")return e;try{return JSON.stringify(e)}catch{return String(e)}}function oa(e){const t=e.toLowerCase();return v$[t]??t}function Hg(e){return e.includes("System")?"system":e.includes("Human")?"user":e.includes("AI")||e.includes("Assistant")?"assistant":e.includes("Function")?"function":e.includes("Tool")?"tool":"user"}function Fg(e){if(!(!e||Array.isArray(e)))return e.invocation_params}function BE(e){return e.map(t=>{const n=t._getType;if(typeof n=="function"){const o=n.call(t);return{role:oa(o),content:It(t.content)}}const r=t.constructor?.name;if(r)return{role:oa(Hg(r)),content:It(t.content)};if(t.type){const o=String(t.type).toLowerCase();return{role:oa(o),content:It(t.content)}}if(t.role)return{role:oa(String(t.role)),content:It(t.content)};if(t.lc===1&&t.kwargs){const o=t.id,s=Array.isArray(o)&&o.length>0?o[o.length-1]:"",i=typeof s=="string"?Hg(s):"user";return{role:oa(i),content:It(t.kwargs?.content)}}return{role:"user",content:It(t.content)}})}function L$(e,t,n){const r={},o="kwargs"in e?e.kwargs:void 0,s=t?.temperature??n?.ls_temperature??o?.temperature;vt(r,Tl,s);const i=t?.max_tokens??n?.ls_max_tokens??o?.max_tokens;vt(r,DE,i);const a=t?.top_p??o?.top_p;vt(r,Sl,a);const c=t?.frequency_penalty;vt(r,hl,c);const l=t?.presence_penalty;return vt(r,wE,l),t&&"stream"in t&&kn(r,LE,!!t.stream),r}function BM(e,t,n,r,o,s){return{[El]:It(e??"langchain"),[Hn]:n,[Rt]:It(t),[Ge]:Ba,...L$(r,o,s)}}function D$(e,t,n,r,o){const s=o?.ls_provider,i=r?.model??o?.ls_model_name??"unknown",a=BM(s,i,"pipeline",e,r,o);if(n&&Array.isArray(t)&&t.length>0){const c=t.map(l=>({role:"user",content:l}));kn(a,kt,It(c))}return a}function w$(e,t,n,r,o){const s=o?.ls_provider??e.id?.[2],i=r?.model??o?.ls_model_name??"unknown",a=BM(s,i,"chat",e,r,o);if(n&&Array.isArray(t)&&t.length>0){const c=BE(t.flat()),l=GE(c);kn(a,kt,It(l))}return a}function U$(e,t){const n=[],r=e.flat();for(const o of r){const s=o.message?.content;if(Array.isArray(s))for(const i of s){const a=i;a.type==="tool_use"&&n.push(a)}}n.length>0&&kn(t,yn,It(n))}function k$(e,t){if(!e)return;const n=e.tokenUsage,r=e.usage;if(n)vt(t,Yt,n.promptTokens),vt(t,jt,n.completionTokens),vt(t,oo,n.totalTokens);else if(r){vt(t,Yt,r.input_tokens),vt(t,jt,r.output_tokens);const o=Number(r.input_tokens),s=Number(r.output_tokens),i=(Number.isNaN(o)?0:o)+(Number.isNaN(s)?0:s);i>0&&vt(t,oo,i),r.cache_creation_input_tokens!==void 0&&vt(t,qV,r.cache_creation_input_tokens),r.cache_read_input_tokens!==void 0&&vt(t,WV,r.cache_read_input_tokens)}}function G$(e,t){if(!e)return;const n={};if(Array.isArray(e.generations)){const l=e.generations.flat().map(f=>f.generationInfo?.finish_reason?f.generationInfo.finish_reason:f.generation_info?.finish_reason?f.generation_info.finish_reason:null).filter(f=>typeof f=="string");if(l.length>0&&kn(n,or,It(l)),U$(e.generations,n),t){const f=e.generations.flat().map(d=>d.text??d.message?.content).filter(d=>typeof d=="string");f.length>0&&kn(n,qt,It(f))}}k$(e.llmOutput,n);const r=e.llmOutput,s=e.generations?.[0]?.[0]?.message,i=r?.model_name??r?.model??s?.response_metadata?.model_name;i&&kn(n,gn,i);const a=r?.id??s?.id;a&&kn(n,es,a);const c=r?.stop_reason??s?.response_metadata?.finish_reason;return c&&kn(n,YV,It(c)),n}function V$(e={}){const t=e.recordInputs??!1,n=e.recordOutputs??!1,r=new Map,o=i=>{const a=r.get(i);a?.isRecording()&&(a.end(),r.delete(i))},s={lc_serializable:!1,lc_namespace:["langchain_core","callbacks","sentry"],lc_secrets:void 0,lc_attributes:void 0,lc_aliases:void 0,lc_serializable_keys:void 0,lc_id:["langchain_core","callbacks","sentry"],lc_kwargs:{},name:"SentryCallbackHandler",ignoreLLM:!1,ignoreChain:!1,ignoreAgent:!1,ignoreRetriever:!1,ignoreCustomEvent:!1,raiseError:!1,awaitHandlers:!0,handleLLMStart(i,a,c,l,f,d,u,_){const p=Fg(d),E=D$(i,a,t,p,u),T=E[Rt],h=E[Hn];Vn({name:`${h} ${T}`,op:"gen_ai.pipeline",attributes:{...E,[Ee]:"gen_ai.pipeline"}},m=>(r.set(c,m),m))},handleChatModelStart(i,a,c,l,f,d,u,_){const p=Fg(d),E=w$(i,a,t,p,u),T=E[Rt],h=E[Hn];Vn({name:`${h} ${T}`,op:"gen_ai.chat",attributes:{...E,[Ee]:"gen_ai.chat"}},m=>(r.set(c,m),m))},handleLLMEnd(i,a,c,l,f){const d=r.get(a);if(d?.isRecording()){const u=G$(i,n);u&&d.setAttributes(u),o(a)}},handleLLMError(i,a){const c=r.get(a);c?.isRecording()&&(c.setStatus({code:Ae,message:"llm_error"}),o(a)),xe(i,{mechanism:{handled:!1,type:`${Ba}.llm_error_handler`}})},handleChainStart(i,a,c,l){const f=i.name||"unknown_chain",d={[Ge]:"auto.ai.langchain","langchain.chain.name":f};t&&(d["langchain.chain.inputs"]=JSON.stringify(a)),Vn({name:`chain ${f}`,op:"gen_ai.invoke_agent",attributes:{...d,[Ee]:"gen_ai.invoke_agent"}},u=>(r.set(c,u),u))},handleChainEnd(i,a){const c=r.get(a);c?.isRecording()&&(n&&c.setAttributes({"langchain.chain.outputs":JSON.stringify(i)}),o(a))},handleChainError(i,a){const c=r.get(a);c?.isRecording()&&(c.setStatus({code:Ae,message:"chain_error"}),o(a)),xe(i,{mechanism:{handled:!1,type:`${Ba}.chain_error_handler`}})},handleToolStart(i,a,c,l){const f=i.name||"unknown_tool",d={[Ge]:Ba,"gen_ai.tool.name":f};t&&(d["gen_ai.tool.input"]=a),Vn({name:`execute_tool ${f}`,op:"gen_ai.execute_tool",attributes:{...d,[Ee]:"gen_ai.execute_tool"}},u=>(r.set(c,u),u))},handleToolEnd(i,a){const c=r.get(a);c?.isRecording()&&(n&&c.setAttributes({"gen_ai.tool.output":JSON.stringify(i)}),o(a))},handleToolError(i,a){const c=r.get(a);c?.isRecording()&&(c.setStatus({code:Ae,message:"tool_error"}),o(a)),xe(i,{mechanism:{handled:!1,type:`${Ba}.tool_error_handler`}})},copy(){return s},toJSON(){return{lc:1,type:"not_implemented",id:s.lc_id}},toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:s.lc_id}}};return s}const HM="LangGraph",FM="auto.ai.langgraph";function x$(e){if(!e||e.length===0)return null;const t=[];for(const n of e)if(n&&typeof n=="object"){const r=n.tool_calls;r&&Array.isArray(r)&&t.push(...r)}return t.length>0?t:null}function $$(e){const t=e;let n=0,r=0,o=0;if(t.usage_metadata&&typeof t.usage_metadata=="object"){const s=t.usage_metadata;return typeof s.input_tokens=="number"&&(n=s.input_tokens),typeof s.output_tokens=="number"&&(r=s.output_tokens),typeof s.total_tokens=="number"&&(o=s.total_tokens),{inputTokens:n,outputTokens:r,totalTokens:o}}if(t.response_metadata&&typeof t.response_metadata=="object"){const s=t.response_metadata;if(s.tokenUsage&&typeof s.tokenUsage=="object"){const i=s.tokenUsage;typeof i.promptTokens=="number"&&(n=i.promptTokens),typeof i.completionTokens=="number"&&(r=i.completionTokens),typeof i.totalTokens=="number"&&(o=i.totalTokens)}}return{inputTokens:n,outputTokens:r,totalTokens:o}}function B$(e,t){const n=t;if(n.response_metadata&&typeof n.response_metadata=="object"){const r=n.response_metadata;r.model_name&&typeof r.model_name=="string"&&e.setAttribute(gn,r.model_name),r.finish_reason&&typeof r.finish_reason=="string"&&e.setAttribute(or,[r.finish_reason])}}function H$(e){if(!e.builder?.nodes?.tools?.runnable?.tools)return null;const t=e.builder?.nodes?.tools?.runnable?.tools;return!t||!Array.isArray(t)||t.length===0?null:t.map(n=>({name:n.lc_kwargs?.name,description:n.lc_kwargs?.description,schema:n.lc_kwargs?.schema}))}function F$(e,t,n){const o=n?.messages;if(!o||!Array.isArray(o))return;const s=t?.length??0,i=o.length>s?o.slice(s):[];if(i.length===0)return;const a=x$(i);a&&e.setAttribute(yn,JSON.stringify(a));const c=BE(i);e.setAttribute(qt,JSON.stringify(c));let l=0,f=0,d=0;for(const u of i){const _=$$(u);l+=_.inputTokens,f+=_.outputTokens,d+=_.totalTokens,B$(e,u)}l>0&&e.setAttribute(Yt,l),f>0&&e.setAttribute(jt,f),d>0&&e.setAttribute(oo,d)}function Y$(e,t){return new Proxy(e,{apply(n,r,o){return Jo({op:"gen_ai.create_agent",name:"create_agent",attributes:{[Ge]:FM,[Ee]:"gen_ai.create_agent",[Hn]:"create_agent"}},s=>{try{const i=Reflect.apply(n,r,o),a=o.length>0?o[0]:{};a?.name&&typeof a.name=="string"&&(s.setAttribute(CM,a.name),s.updateName(`create_agent ${a.name}`));const c=i.invoke;return c&&typeof c=="function"&&(i.invoke=j$(c.bind(i),i,a,t)),i}catch(i){throw s.setStatus({code:Ae,message:"internal_error"}),xe(i,{mechanism:{handled:!1,type:"auto.ai.langgraph.error"}}),i}})}})}function j$(e,t,n,r){return new Proxy(e,{apply(o,s,i){return Jo({op:"gen_ai.invoke_agent",name:"invoke_agent",attributes:{[Ge]:FM,[Ee]:KV,[Hn]:"invoke_agent"}},async a=>{try{const c=n?.name;c&&typeof c=="string"&&(a.setAttribute(jV,c),a.setAttribute(CM,c),a.updateName(`invoke_agent ${c}`));const l=H$(t);l&&a.setAttribute(ml,JSON.stringify(l));const f=r.recordInputs,d=r.recordOutputs,u=i.length>0?i[0].messages??[]:[];if(u&&f){const p=BE(u),E=GE(p);a.setAttribute(kt,JSON.stringify(E))}const _=await Reflect.apply(o,s,i);return d&&F$(a,u??null,_),_}catch(c){throw a.setStatus({code:Ae,message:"internal_error"}),xe(c,{mechanism:{handled:!1,type:"auto.ai.langgraph.error"}}),c}})}})}function YM(e){if(e!==void 0)return e>=400&&e<500?"warning":e>=500?"error":void 0}function q$(e,t,n){const r=e[t];if(typeof r=="function"){try{e[t]=n}catch{Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0,enumerable:!0})}if(e.default===r)try{e.default=n}catch{Object.defineProperty(e,"default",{value:n,writable:!0,configurable:!0,enumerable:!0})}}}function W$(e,t=!1){return!(t||e&&!e.startsWith("/")&&!e.match(/^[A-Z]:/)&&!e.startsWith(".")&&!e.match(/^[a-zA-Z]([a-zA-Z0-9.\-+])*:\/\//))&&e!==void 0&&!e.includes("node_modules/")}function K$(e){const t=/^\s*[-]{4,}$/,n=/at (?:async )?(?:(.+?)\s+\()?(?:(.+):(\d+):(\d+)?|([^)]+))\)?/,r=/at (?:async )?(.+?) \(data:(.*?),/;return o=>{const s=o.match(r);if(s)return{filename:`<data:${s[2]}>`,function:s[1]};const i=o.match(n);if(i){let a,c,l,f,d;if(i[1]){l=i[1];let p=l.lastIndexOf(".");if(l[p-1]==="."&&p--,p>0){a=l.slice(0,p),c=l.slice(p+1);const E=a.indexOf(".Module");E>0&&(l=l.slice(E+1),a=a.slice(0,E))}f=void 0}c&&(f=a,d=c),c==="<anonymous>"&&(d=void 0,l=void 0),l===void 0&&(d=d||PC,l=f?`${f}.${d}`:d);let u=i[2]?.startsWith("file://")?i[2].slice(7):i[2];const _=i[5]==="native";return u?.match(/\/[A-Z]:/)&&(u=u.slice(1)),!u&&i[5]&&!_&&(u=i[5]),{filename:u?decodeURI(u):void 0,module:e?e(u):void 0,function:l,lineno:Yg(i[3]),colno:Yg(i[4]),in_app:W$(u||"",_)}}if(o.match(t))return{filename:o}}}function z$(e){return[90,K$(e)]}function Yg(e){return parseInt(e||"",10)||void 0}class ts{constructor(t){this._maxSize=t,this._cache=new Map}get size(){return this._cache.size}get(t){const n=this._cache.get(t);if(n!==void 0)return this._cache.delete(t),this._cache.set(t,n),n}set(t,n){if(this._cache.size>=this._maxSize){const r=this._cache.keys().next().value;this._cache.delete(r)}this._cache.set(t,n)}remove(t){const n=this._cache.get(t);return n&&this._cache.delete(t),n}clear(){this._cache.clear()}keys(){return Array.from(this._cache.keys())}values(){const t=[];return this._cache.forEach(n=>t.push(n)),t}}const bu={};function Ne(e,t,n){return n?X$(e,t,n):Z$(e,t)}function Z$(e,t){return Object.assign(n=>{const r=bu[e];if(r)return n&&r.setConfig(n),r;const o=t(n);return bu[e]=o,rl({instrumentations:[o]}),o},{id:e})}function X$(e,t,n){return Object.assign(r=>{const o=n(r),s=bu[e];if(s)return s.setConfig(o),s;const i=new t(o);return bu[e]=i,rl({instrumentations:[i]}),i},{id:e})}function jM(e){let t=!1,n=[];if(!Q$(e))t=!0;else{const o=e._wrap;e._wrap=(...s)=>(t=!0,n.forEach(i=>i()),n=[],o(...s))}return o=>{t?o():n.push(o)}}function Q$(e){return typeof e._wrap=="function"}const Ce=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,yo="@sentry/instrumentation-http",J$=1024*1024,jg=b.createContextKey("sentry_http_server_instrumented"),zn="Http.Server",Id=new Map,qg=new WeakSet;function eB(e,t){an(e,"_startSpanCallback",new WeakRef(t))}const tB=((e={})=>{const t={sessions:e.sessions??!0,sessionFlushingDelayMS:e.sessionFlushingDelayMS??6e4,maxRequestBodySize:e.maxRequestBodySize??"medium",ignoreRequestBody:e.ignoreRequestBody};return{name:zn,setupOnce(){const n=(r=>{nB(r.server,t)});hn.subscribe("http.server.request.start",n)},afterAllSetup(n){Ce&&n.getIntegrationByName("Http")&&x.warn("It seems that you have manually added `httpServerIntegration` while `httpIntegration` is also present. Make sure to remove `httpServerIntegration` when adding `httpIntegration`.")}}}),qM=tB;function nB(e,{ignoreRequestBody:t,maxRequestBodySize:n,sessions:r,sessionFlushingDelayMS:o}){const s=e.emit;if(qg.has(s))return;const i=new Proxy(s,{apply(a,c,l){if(l[0]!=="request")return a.apply(c,l);const f=Te();if(b.context.active().getValue(jg)||!f)return a.apply(c,l);Ce&&x.log(zn,"Handling incoming request");const d=je().clone(),u=l[1],_=l[2],p=jG(u),E=u.ip||u.socket?.remoteAddress,T=u.url||"/";n!=="none"&&!t?.(T,u)&&oB(u,d,n),d.setSDKProcessingMetadata({normalizedRequest:p,ipAddress:E});const h=(u.method||"GET").toUpperCase(),m=cc(T),A=`${h} ${m}`;return d.setTransactionName(A),r&&f&&rB(f,{requestIsolationScope:d,response:_,sessionFlushingDelayMS:o??6e4}),Pk(d,()=>{Ke().getPropagationContext().propagationSpanId=uo();const g=b.propagation.extract(b.context.active(),p.headers).setValue(jg,!0);return b.context.with(g,()=>{f.emit("httpServerRequest",u,_,p);const R=u._startSpanCallback?.deref();return R?R(()=>a.apply(c,l)):a.apply(c,l)})})}});qg.add(i),e.emit=i}function rB(e,{requestIsolationScope:t,response:n,sessionFlushingDelayMS:r}){t.setSDKProcessingMetadata({requestSession:{status:"ok"}}),n.once("close",()=>{const o=t.getScopeData().sdkProcessingMetadata.requestSession;if(e&&o){Ce&&x.log(`Recorded request session with status: ${o.status}`);const s=new Date;s.setSeconds(0,0);const i=s.toISOString(),a=Id.get(e),c=a?.[i]||{exited:0,crashed:0,errored:0};if(c[{ok:"exited",crashed:"crashed",errored:"errored"}[o.status]]++,a)a[i]=c;else{Ce&&x.log("Opened new request session aggregate.");const l={[i]:c};Id.set(e,l);const f=()=>{clearTimeout(u),d(),Id.delete(e);const _=Object.entries(l).map(([p,E])=>({started:p,exited:E.exited,errored:E.errored,crashed:E.crashed}));e.sendSession({aggregates:_})},d=e.on("flush",()=>{Ce&&x.log("Sending request session aggregate due to client flush"),f()}),u=setTimeout(()=>{Ce&&x.log("Sending request session aggregate due to flushing schedule"),f()},r).unref()}}})}function oB(e,t,n){let r=0;const o=[];Ce&&x.log(zn,"Patching request.on");const s=new WeakMap,i=n==="small"?1e3:n==="medium"?1e4:J$;try{e.on=new Proxy(e.on,{apply:(a,c,l)=>{const[f,d,...u]=l;if(f==="data"){Ce&&x.log(zn,`Handling request.on("data") with maximum body size of ${i}b`);const _=new Proxy(d,{apply:(p,E,T)=>{try{const h=T[0],m=Buffer.from(h);r<i?(o.push(m),r+=m.byteLength):Ce&&x.log(zn,`Dropping request body chunk because maximum body length of ${i}b is exceeded.`)}catch{Ce&&x.error(zn,"Encountered error while storing body chunk.")}return Reflect.apply(p,E,T)}});return s.set(d,_),Reflect.apply(a,c,[f,_,...u])}return Reflect.apply(a,c,l)}}),e.off=new Proxy(e.off,{apply:(a,c,l)=>{const[,f]=l,d=s.get(f);if(d){s.delete(f);const u=l.slice();return u[1]=d,Reflect.apply(a,c,u)}return Reflect.apply(a,c,l)}}),e.on("end",()=>{try{const a=Buffer.concat(o).toString("utf-8");if(a){const l=Buffer.byteLength(a,"utf-8")>i?`${Buffer.from(a).subarray(0,i-3).toString("utf-8")}...`:a;t.setSDKProcessingMetadata({normalizedRequest:{data:l}})}}catch(a){Ce&&x.error(zn,"Error building captured request body",a)}})}catch(a){Ce&&x.error(zn,"Error patching request to capture body",a)}}const Wg="Http.ServerSpans",sB=((e={})=>{const t=e.ignoreStaticAssets??!0,n=e.ignoreIncomingRequests,r=e.ignoreStatusCodes??[[401,404],[301,303],[305,399]],{onSpanCreated:o}=e,{requestHook:s,responseHook:i,applyCustomAttributesOnSpan:a}=e.instrumentation??{};return{name:Wg,setup(c){typeof __SENTRY_TRACING__<"u"&&!__SENTRY_TRACING__||c.on("httpServerRequest",(l,f,d)=>{const u=l,_=f;eB(u,E=>{if(cB(u,{ignoreStaticAssets:t,ignoreIncomingRequests:n}))return Ce&&x.log(Wg,"Skipping span creation for incoming request",u.url),E();const T=d.url||u.url||"/",h=$G(T),m=u.headers,A=m["user-agent"],g=m["x-forwarded-for"],R=u.httpVersion,O=m.host,C=O?.replace(/^(.*)(:[0-9]{1,5})/,"$1")||"localhost",I=c.tracer,L=T.startsWith("https")?"https":"http",U=d.method||u.method?.toUpperCase()||"GET",q=h?h.pathname:cc(T),H=`${U} ${q}`,$=I.startSpan(H,{kind:b.SpanKind.SERVER,attributes:{[Ee]:"http.server",[Ge]:"auto.http.otel.http","sentry.http.prefetch":iB(u)||void 0,"http.url":T,"http.method":d.method,"http.target":h?`${h.pathname}${h.search}`:q,"http.host":O,"net.host.name":C,"http.client_ip":typeof g=="string"?g.split(",")[0]:void 0,"http.user_agent":A,"http.scheme":L,"http.flavor":R,"net.transport":R?.toUpperCase()==="QUIC"?"ip_udp":"ip_tcp",...uB(u),...KG(d.headers||{})}});s?.($,u),i?.($,_),a?.($,u,_),o?.($,u,_);const B={type:Qr.HTTP,span:$};return b.context.with(aC(b.trace.setSpan(b.context.active(),$),B),()=>{b.context.bind(b.context.active(),u),b.context.bind(b.context.active(),_);let F=!1;function w(k){if(F)return;F=!0;const Y=fB(u,_);$.setAttributes(Y),$.setStatus(k),$.end();const oe=Y["http.route"];oe&&je().setTransactionName(`${u.method?.toUpperCase()||"GET"} ${oe}`)}return _.on("close",()=>{w(up(_.statusCode))}),_.on(CD.errorMonitor,()=>{const k=up(_.statusCode);w(k.code===Ae?k:{code:Ae})}),E()})})})},processEvent(c){if(c.type==="transaction"){const l=c.contexts?.trace?.data?.["http.response.status_code"];if(typeof l=="number"&&_B(l,r))return Ce&&x.log("Dropping transaction due to status code",l),null}return c},afterAllSetup(c){Ce&&(c.getIntegrationByName("Http")&&x.warn("It seems that you have manually added `httpServerSpansIntergation` while `httpIntegration` is also present. Make sure to remove `httpIntegration` when adding `httpServerSpansIntegration`."),c.getIntegrationByName("Http.Server")||x.error("It seems that you have manually added `httpServerSpansIntergation` without adding `httpServerIntegration`. This is a requiement for spans to be created - please add the `httpServerIntegration` integration."))}}}),WM=sB;function iB(e){return e.headers["next-router-prefetch"]==="1"}function aB(e){const t=cc(e);return!!(t.match(/\.(ico|png|jpg|jpeg|gif|svg|css|js|woff|woff2|ttf|eot|webp|avif)$/)||t.match(/^\/(robots\.txt|sitemap\.xml|manifest\.json|browserconfig\.xml)$/))}function cB(e,{ignoreStaticAssets:t,ignoreIncomingRequests:n}){if(Nn(b.context.active()))return!0;const r=e.url,o=e.method?.toUpperCase();return!!(o==="OPTIONS"||o==="HEAD"||!r||t&&o==="GET"&&aB(r)||n?.(r,e))}function uB(e){const t=lB(e.headers);return t==null?{}:dB(e.headers)?{"http.request_content_length":t}:{"http.request_content_length_uncompressed":t}}function lB(e){const t=e["content-length"];if(t===void 0)return null;const n=parseInt(t,10);return isNaN(n)?null:n}function dB(e){const t=e["content-encoding"];return!!t&&t!=="identity"}function fB(e,t){const{socket:n}=e,{statusCode:r,statusMessage:o}=t,s={[Q.ATTR_HTTP_RESPONSE_STATUS_CODE]:r,[Q.SEMATTRS_HTTP_STATUS_CODE]:r,"http.status_text":o?.toUpperCase()},i=tl(b.context.active());if(n){const{localAddress:a,localPort:c,remoteAddress:l,remotePort:f}=n;s[Q.SEMATTRS_NET_HOST_IP]=a,s[Q.SEMATTRS_NET_HOST_PORT]=c,s[Q.SEMATTRS_NET_PEER_IP]=l,s["net.peer.port"]=f}if(s[Q.SEMATTRS_HTTP_STATUS_CODE]=r,s["http.status_text"]=(o||"").toUpperCase(),i?.type===Qr.HTTP&&i.route!==void 0){const a=i.route;s[Q.ATTR_HTTP_ROUTE]=a}return s}function _B(e,t){return t.some(n=>{if(typeof n=="number")return n===e;const[r,o]=n;return e>=r&&e<=o})}function KM(e){const t=e.protocol||"",n=e.hostname||e.host||"",r=!e.port||e.port===80||e.port===443||/^(.*):(\d+)$/.test(n)?"":`:${e.port}`,o=e.path?e.path:"/";return`${t}//${n}${r}${o}`}function pB(){return`unknown_service:${process.argv0}`}const Ha=e=>e!==null&&typeof e=="object"&&typeof e.then=="function";class Iu{_rawAttributes;_asyncAttributesPending=!1;_schemaUrl;_memoizedAttributes;static FromAttributeList(t,n){const r=new Iu({},n);return r._rawAttributes=Kg(t),r._asyncAttributesPending=t.filter(([o,s])=>Ha(s)).length>0,r}constructor(t,n){const r=t.attributes??{};this._rawAttributes=Object.entries(r).map(([o,s])=>(Ha(s)&&(this._asyncAttributesPending=!0),[o,s])),this._rawAttributes=Kg(this._rawAttributes),this._schemaUrl=EB(n?.schemaUrl)}get asyncAttributesPending(){return this._asyncAttributesPending}async waitForAsyncAttributes(){if(this.asyncAttributesPending){for(let t=0;t<this._rawAttributes.length;t++){const[n,r]=this._rawAttributes[t];this._rawAttributes[t]=[n,Ha(r)?await r:r]}this._asyncAttributesPending=!1}}get attributes(){if(this.asyncAttributesPending&&b.diag.error("Accessing resource attributes before async attributes settled"),this._memoizedAttributes)return this._memoizedAttributes;const t={};for(const[n,r]of this._rawAttributes){if(Ha(r)){b.diag.debug(`Unsettled resource attribute ${n} skipped`);continue}r!=null&&(t[n]??=r)}return this._asyncAttributesPending||(this._memoizedAttributes=t),t}getRawAttributes(){return this._rawAttributes}get schemaUrl(){return this._schemaUrl}merge(t){if(t==null)return this;const n=TB(this,t),r=n?{schemaUrl:n}:void 0;return Iu.FromAttributeList([...t.getRawAttributes(),...this.getRawAttributes()],r)}}function zM(e,t){return Iu.FromAttributeList(Object.entries(e),t)}function ZM(){return zM({[Q.ATTR_SERVICE_NAME]:pB(),[Q.ATTR_TELEMETRY_SDK_LANGUAGE]:Xc[Q.ATTR_TELEMETRY_SDK_LANGUAGE],[Q.ATTR_TELEMETRY_SDK_NAME]:Xc[Q.ATTR_TELEMETRY_SDK_NAME],[Q.ATTR_TELEMETRY_SDK_VERSION]:Xc[Q.ATTR_TELEMETRY_SDK_VERSION]})}function Kg(e){return e.map(([t,n])=>Ha(n)?[t,n.catch(r=>{b.diag.debug("promise rejection for resource attribute: %s - %s",t,r)})]:[t,n])}function EB(e){if(typeof e=="string"||e===void 0)return e;b.diag.warn("Schema URL must be string or undefined, got %s. Schema URL will be ignored.",e)}function TB(e,t){const n=e?.schemaUrl,r=t?.schemaUrl,o=n===void 0||n==="",s=r===void 0||r==="";if(o)return r;if(s||n===r)return n;b.diag.warn('Schema URL merge conflict: old resource has "%s", updating resource has "%s". Resulting resource will have undefined Schema URL.',n,r)}const hB="exception";class SB{_spanContext;kind;parentSpanContext;attributes={};links=[];events=[];startTime;resource;instrumentationScope;_droppedAttributesCount=0;_droppedEventsCount=0;_droppedLinksCount=0;name;status={code:b.SpanStatusCode.UNSET};endTime=[0,0];_ended=!1;_duration=[-1,-1];_spanProcessor;_spanLimits;_attributeValueLengthLimit;_performanceStartTime;_performanceOffset;_startTimeProvided;constructor(t){const n=Date.now();this._spanContext=t.spanContext,this._performanceStartTime=zr.now(),this._performanceOffset=n-(this._performanceStartTime+Ju()),this._startTimeProvided=t.startTime!=null,this._spanLimits=t.spanLimits,this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0,this._spanProcessor=t.spanProcessor,this.name=t.name,this.parentSpanContext=t.parentSpanContext,this.kind=t.kind,this.links=t.links||[],this.startTime=this._getTime(t.startTime??n),this.resource=t.resource,this.instrumentationScope=t.scope,t.attributes!=null&&this.setAttributes(t.attributes),this._spanProcessor.onStart(this,t.context)}spanContext(){return this._spanContext}setAttribute(t,n){if(n==null||this._isSpanEnded())return this;if(t.length===0)return b.diag.warn(`Invalid attribute key: ${t}`),this;if(!nE(n))return b.diag.warn(`Invalid attribute value set for key: ${t}`),this;const{attributeCountLimit:r}=this._spanLimits;return r!==void 0&&Object.keys(this.attributes).length>=r&&!Object.prototype.hasOwnProperty.call(this.attributes,t)?(this._droppedAttributesCount++,this):(this.attributes[t]=this._truncateToSize(n),this)}setAttributes(t){for(const[n,r]of Object.entries(t))this.setAttribute(n,r);return this}addEvent(t,n,r){if(this._isSpanEnded())return this;const{eventCountLimit:o}=this._spanLimits;if(o===0)return b.diag.warn("No events allowed."),this._droppedEventsCount++,this;o!==void 0&&this.events.length>=o&&(this._droppedEventsCount===0&&b.diag.debug("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),op(n)&&(op(r)||(r=n),n=void 0);const s=Ka(n);return this.events.push({name:t,attributes:s,time:this._getTime(r),droppedAttributesCount:0}),this}addLink(t){return this.links.push(t),this}addLinks(t){return this.links.push(...t),this}setStatus(t){return this._isSpanEnded()?this:(this.status={...t},this.status.message!=null&&typeof t.message!="string"&&(b.diag.warn(`Dropping invalid status.message of type '${typeof t.message}', expected 'string'`),delete this.status.message),this)}updateName(t){return this._isSpanEnded()?this:(this.name=t,this)}end(t){if(this._isSpanEnded()){b.diag.error(`${this.name} ${this._spanContext.traceId}-${this._spanContext.spanId} - You can only call end() on a span once.`);return}this._ended=!0,this.endTime=this._getTime(t),this._duration=sC(this.startTime,this.endTime),this._duration[0]<0&&(b.diag.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._droppedEventsCount>0&&b.diag.warn(`Dropped ${this._droppedEventsCount} events because eventCountLimit reached`),this._spanProcessor.onEnd(this)}_getTime(t){if(typeof t=="number"&&t<=zr.now())return sE(t+this._performanceOffset);if(typeof t=="number")return Gn(t);if(t instanceof Date)return Gn(t.getTime());if(el(t))return t;if(this._startTimeProvided)return Gn(Date.now());const n=zr.now()-this._performanceStartTime;return iE(this.startTime,Gn(n))}isRecording(){return this._ended===!1}recordException(t,n){const r={};typeof t=="string"?r[Q.ATTR_EXCEPTION_MESSAGE]=t:t&&(t.code?r[Q.ATTR_EXCEPTION_TYPE]=t.code.toString():t.name&&(r[Q.ATTR_EXCEPTION_TYPE]=t.name),t.message&&(r[Q.ATTR_EXCEPTION_MESSAGE]=t.message),t.stack&&(r[Q.ATTR_EXCEPTION_STACKTRACE]=t.stack)),r[Q.ATTR_EXCEPTION_TYPE]||r[Q.ATTR_EXCEPTION_MESSAGE]?this.addEvent(hB,r,n):b.diag.warn(`Failed to record an exception ${t}`)}get duration(){return this._duration}get ended(){return this._ended}get droppedAttributesCount(){return this._droppedAttributesCount}get droppedEventsCount(){return this._droppedEventsCount}get droppedLinksCount(){return this._droppedLinksCount}_isSpanEnded(){if(this._ended){const t=new Error(`Operation attempted on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`);b.diag.warn(`Cannot execute the operation on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`,t)}return this._ended}_truncateToLimitUtil(t,n){return t.length<=n?t:t.substring(0,n)}_truncateToSize(t){const n=this._attributeValueLengthLimit;return n<=0?(b.diag.warn(`Attribute value limit must be positive, got ${n}`),t):typeof t=="string"?this._truncateToLimitUtil(t,n):Array.isArray(t)?t.map(r=>typeof r=="string"?this._truncateToLimitUtil(r,n):r):t}}var Dt;(function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(Dt||(Dt={}));class Cu{shouldSample(){return{decision:Dt.NOT_RECORD}}toString(){return"AlwaysOffSampler"}}class Lo{shouldSample(){return{decision:Dt.RECORD_AND_SAMPLED}}toString(){return"AlwaysOnSampler"}}class Lc{_root;_remoteParentSampled;_remoteParentNotSampled;_localParentSampled;_localParentNotSampled;constructor(t){this._root=t.root,this._root||(rE(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new Lo),this._remoteParentSampled=t.remoteParentSampled??new Lo,this._remoteParentNotSampled=t.remoteParentNotSampled??new Cu,this._localParentSampled=t.localParentSampled??new Lo,this._localParentNotSampled=t.localParentNotSampled??new Cu}shouldSample(t,n,r,o,s,i){const a=b.trace.getSpanContext(t);return!a||!b.isSpanContextValid(a)?this._root.shouldSample(t,n,r,o,s,i):a.isRemote?a.traceFlags&b.TraceFlags.SAMPLED?this._remoteParentSampled.shouldSample(t,n,r,o,s,i):this._remoteParentNotSampled.shouldSample(t,n,r,o,s,i):a.traceFlags&b.TraceFlags.SAMPLED?this._localParentSampled.shouldSample(t,n,r,o,s,i):this._localParentNotSampled.shouldSample(t,n,r,o,s,i)}toString(){return`ParentBased{root=${this._root.toString()}, remoteParentSampled=${this._remoteParentSampled.toString()}, remoteParentNotSampled=${this._remoteParentNotSampled.toString()}, localParentSampled=${this._localParentSampled.toString()}, localParentNotSampled=${this._localParentNotSampled.toString()}}`}}class zg{_ratio;_upperBound;constructor(t=0){this._ratio=t,this._ratio=this._normalize(t),this._upperBound=Math.floor(this._ratio*4294967295)}shouldSample(t,n){return{decision:b.isValidTraceId(n)&&this._accumulate(n)<this._upperBound?Dt.RECORD_AND_SAMPLED:Dt.NOT_RECORD}}toString(){return`TraceIdRatioBased{${this._ratio}}`}_normalize(t){return typeof t!="number"||isNaN(t)?0:t>=1?1:t<=0?0:t}_accumulate(t){let n=0;for(let r=0;r<t.length/8;r++){const o=r*8,s=parseInt(t.slice(o,o+8),16);n=(n^s)>>>0}return n}}var pn;(function(e){e.AlwaysOff="always_off",e.AlwaysOn="always_on",e.ParentBasedAlwaysOff="parentbased_always_off",e.ParentBasedAlwaysOn="parentbased_always_on",e.ParentBasedTraceIdRatio="parentbased_traceidratio",e.TraceIdRatio="traceidratio"})(pn||(pn={}));const Dc=1;function XM(){return{sampler:QM(),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:bt("OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT")??1/0,attributeCountLimit:bt("OTEL_ATTRIBUTE_COUNT_LIMIT")??128},spanLimits:{attributeValueLengthLimit:bt("OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT")??1/0,attributeCountLimit:bt("OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT")??128,linkCountLimit:bt("OTEL_SPAN_LINK_COUNT_LIMIT")??128,eventCountLimit:bt("OTEL_SPAN_EVENT_COUNT_LIMIT")??128,attributePerEventCountLimit:bt("OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT")??128,attributePerLinkCountLimit:bt("OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT")??128}}}function QM(){const e=oE("OTEL_TRACES_SAMPLER")??pn.ParentBasedAlwaysOn;switch(e){case pn.AlwaysOn:return new Lo;case pn.AlwaysOff:return new Cu;case pn.ParentBasedAlwaysOn:return new Lc({root:new Lo});case pn.ParentBasedAlwaysOff:return new Lc({root:new Cu});case pn.TraceIdRatio:return new zg(Zg());case pn.ParentBasedTraceIdRatio:return new Lc({root:new zg(Zg())});default:return b.diag.error(`OTEL_TRACES_SAMPLER value "${e}" invalid, defaulting to "${pn.ParentBasedAlwaysOn}".`),new Lc({root:new Lo})}}function Zg(){const e=bt("OTEL_TRACES_SAMPLER_ARG");return e==null?(b.diag.error(`OTEL_TRACES_SAMPLER_ARG is blank, defaulting to ${Dc}.`),Dc):e<0||e>1?(b.diag.error(`OTEL_TRACES_SAMPLER_ARG=${e} was given, but it is out of range ([0..1]), defaulting to ${Dc}.`),Dc):e}const mB=128,AB=1/0;function gB(e){const t={sampler:QM()},n=XM(),r=Object.assign({},n,t,e);return r.generalLimits=Object.assign({},n.generalLimits,e.generalLimits||{}),r.spanLimits=Object.assign({},n.spanLimits,e.spanLimits||{}),r}function RB(e){const t=Object.assign({},e.spanLimits);return t.attributeCountLimit=e.spanLimits?.attributeCountLimit??e.generalLimits?.attributeCountLimit??bt("OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT")??bt("OTEL_ATTRIBUTE_COUNT_LIMIT")??mB,t.attributeValueLengthLimit=e.spanLimits?.attributeValueLengthLimit??e.generalLimits?.attributeValueLengthLimit??bt("OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT")??bt("OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT")??AB,Object.assign({},e,{spanLimits:t})}const NB=8,JM=16;class yB{generateTraceId=Xg(JM);generateSpanId=Xg(NB)}const wc=Buffer.allocUnsafe(JM);function Xg(e){return function(){for(let n=0;n<e/4;n++)wc.writeUInt32BE(Math.random()*2**32>>>0,n*4);for(let n=0;n<e&&!(wc[n]>0);n++)n===e-1&&(wc[e-1]=1);return wc.toString("hex",0,e)}}class OB{_sampler;_generalLimits;_spanLimits;_idGenerator;instrumentationScope;_resource;_spanProcessor;constructor(t,n,r,o){const s=gB(n);this._sampler=s.sampler,this._generalLimits=s.generalLimits,this._spanLimits=s.spanLimits,this._idGenerator=n.idGenerator||new yB,this._resource=r,this._spanProcessor=o,this.instrumentationScope=t}startSpan(t,n={},r=b.context.active()){n.root&&(r=b.trace.deleteSpan(r));const o=b.trace.getSpan(r);if(Nn(r))return b.diag.debug("Instrumentation suppressed, returning Noop Span"),b.trace.wrapSpanContext(b.INVALID_SPAN_CONTEXT);const s=o?.spanContext(),i=this._idGenerator.generateSpanId();let a,c,l;!s||!b.trace.isSpanContextValid(s)?c=this._idGenerator.generateTraceId():(c=s.traceId,l=s.traceState,a=s);const f=n.kind??b.SpanKind.INTERNAL,d=(n.links??[]).map(m=>({context:m.context,attributes:Ka(m.attributes)})),u=Ka(n.attributes),_=this._sampler.shouldSample(r,c,t,f,u,d);l=_.traceState??l;const p=_.decision===b.SamplingDecision.RECORD_AND_SAMPLED?b.TraceFlags.SAMPLED:b.TraceFlags.NONE,E={traceId:c,spanId:i,traceFlags:p,traceState:l};if(_.decision===b.SamplingDecision.NOT_RECORD)return b.diag.debug("Recording is off, propagating context in a non-recording span"),b.trace.wrapSpanContext(E);const T=Ka(Object.assign(u,_.attributes));return new SB({resource:this._resource,scope:this.instrumentationScope,context:r,spanContext:E,name:t,kind:f,links:d,parentSpanContext:a,attributes:T,startTime:n.startTime,spanProcessor:this._spanProcessor,spanLimits:this._spanLimits})}startActiveSpan(t,n,r,o){let s,i,a;if(arguments.length<2)return;arguments.length===2?a=n:arguments.length===3?(s=n,a=r):(s=n,i=r,a=o);const c=i??b.context.active(),l=this.startSpan(t,s,c),f=b.trace.setSpan(c,l);return b.context.with(f,a,void 0,l)}getGeneralLimits(){return this._generalLimits}getSpanLimits(){return this._spanLimits}}class bB{_spanProcessors;constructor(t){this._spanProcessors=t}forceFlush(){const t=[];for(const n of this._spanProcessors)t.push(n.forceFlush());return new Promise(n=>{Promise.all(t).then(()=>{n()}).catch(r=>{rE(r||new Error("MultiSpanProcessor: forceFlush failed")),n()})})}onStart(t,n){for(const r of this._spanProcessors)r.onStart(t,n)}onEnd(t){for(const n of this._spanProcessors)n.onEnd(t)}shutdown(){const t=[];for(const n of this._spanProcessors)t.push(n.shutdown());return new Promise((n,r)=>{Promise.all(t).then(()=>{n()},r)})}}var Kr;(function(e){e[e.resolved=0]="resolved",e[e.timeout=1]="timeout",e[e.error=2]="error",e[e.unresolved=3]="unresolved"})(Kr||(Kr={}));class IB{_config;_tracers=new Map;_resource;_activeSpanProcessor;constructor(t={}){const n=fC({},XM(),RB(t));this._resource=n.resource??ZM(),this._config=Object.assign({},n,{resource:this._resource});const r=[];t.spanProcessors?.length&&r.push(...t.spanProcessors),this._activeSpanProcessor=new bB(r)}getTracer(t,n,r){const o=`${t}@${n||""}:${r?.schemaUrl||""}`;return this._tracers.has(o)||this._tracers.set(o,new OB({name:t,version:n,schemaUrl:r?.schemaUrl},this._config,this._resource,this._activeSpanProcessor)),this._tracers.get(o)}forceFlush(){const t=this._config.forceFlushTimeoutMillis,n=this._activeSpanProcessor._spanProcessors.map(r=>new Promise(o=>{let s;const i=setTimeout(()=>{o(new Error(`Span processor did not completed within timeout period of ${t} ms`)),s=Kr.timeout},t);r.forceFlush().then(()=>{clearTimeout(i),s!==Kr.timeout&&(s=Kr.resolved,o(s))}).catch(a=>{clearTimeout(i),s=Kr.error,o(a)})}));return new Promise((r,o)=>{Promise.all(n).then(s=>{const i=s.filter(a=>a!==Kr.resolved);i.length>0?o(i):r()}).catch(s=>o([s]))})}shutdown(){return this._activeSpanProcessor.shutdown()}}const HE="sentry.parentIsRemote",Fa="sentry.graphql.operation";function FE(e){if("parentSpanId"in e)return e.parentSpanId;if("parentSpanContext"in e)return e.parentSpanContext?.spanId}function YE(e){const t=e;return!!t.attributes&&typeof t.attributes=="object"}function CB(e){return typeof e.kind=="number"}function MB(e){return!!e.status}function eP(e){return!!e.name}function PB(e){if(!YE(e))return{};const t=e.attributes[Q.ATTR_URL_FULL]||e.attributes[Q.SEMATTRS_HTTP_URL],n={url:t,"http.method":e.attributes[Q.ATTR_HTTP_REQUEST_METHOD]||e.attributes[Q.SEMATTRS_HTTP_METHOD]};!n["http.method"]&&n.url&&(n["http.method"]="GET");try{if(typeof t=="string"){const r=_l(t);n.url=pl(r),r.search&&(n["http.query"]=r.search),r.hash&&(n["http.fragment"]=r.hash)}}catch{}return n}function vB(e){return CB(e)?e.kind:b.SpanKind.INTERNAL}const Cd="sentry-trace",Ap="baggage",jE="sentry.dsc",qE="sentry.sampled_not_recording",tP="sentry.url",LB="sentry.sample_rand",DB="sentry.sample_rate",nP=b.createContextKey("sentry_scopes"),gp=b.createContextKey("sentry_fork_isolation_scope"),Rp=b.createContextKey("sentry_fork_set_scope"),Np=b.createContextKey("sentry_fork_set_isolation_scope"),rP="_scopeContext";function ns(e){return e.getValue(nP)}function oP(e,t){return e.setValue(nP,t)}function wB(e,t){an(e,rP,t)}function uc(e){return e[rP]}function Bo(e){const{traceFlags:t,traceState:n}=e,r=n?n.get(qE)==="1":!1;if(t===b.TraceFlags.SAMPLED)return!0;if(r)return!1;const o=n?n.get(jE):void 0,s=o?gc(o):void 0;if(s?.sampled==="true")return!0;if(s?.sampled==="false")return!1}function sP(e,t,n){const r=t[Q.ATTR_HTTP_REQUEST_METHOD]||t[Q.SEMATTRS_HTTP_METHOD];if(r)return kB({attributes:t,name:e,kind:n},r);const o=t[Q.SEMATTRS_DB_SYSTEM],s=typeof t[Ee]=="string"&&t[Ee].startsWith("cache.");if(o&&!s)return UB({attributes:t,name:e});const i=t[Wt]==="custom"?"custom":"route";if(t[Q.SEMATTRS_RPC_SERVICE])return{...Za(e,t,"route"),op:"rpc"};if(t[Q.SEMATTRS_MESSAGING_SYSTEM])return{...Za(e,t,i),op:"message"};const l=t[Q.SEMATTRS_FAAS_TRIGGER];return l?{...Za(e,t,i),op:l.toString()}:{op:void 0,description:e,source:"custom"}}function iP(e){const t=YE(e)?e.attributes:{},n=eP(e)?e.name:"<unknown>",r=vB(e);return sP(n,t,r)}function UB({attributes:e,name:t}){const n=e[Vo];if(typeof n=="string")return{op:"db",description:n,source:e[Wt]||"custom"};if(e[Wt]==="custom")return{op:"db",description:t,source:"custom"};const r=e[Q.SEMATTRS_DB_STATEMENT];return{op:"db",description:r?r.toString():t,source:"task"}}function kB({name:e,kind:t,attributes:n},r){const o=["http"];switch(t){case b.SpanKind.CLIENT:o.push("client");break;case b.SpanKind.SERVER:o.push("server");break}n["sentry.http.prefetch"]&&o.push("prefetch");const{urlPath:s,url:i,query:a,fragment:c,hasRoute:l}=VB(n,t);if(!s)return{...Za(e,n),op:o.join(".")};const f=n[Fa],d=`${r} ${s}`,u=f?`${d} (${GB(f)})`:d,_=l||s==="/"?"route":"url",p={};i&&(p.url=i),a&&(p["http.query"]=a),c&&(p["http.fragment"]=c);const E=t===b.SpanKind.CLIENT||t===b.SpanKind.SERVER,h=!`${n[Ge]||"manual"}`.startsWith("auto"),m=n[Wt]==="custom",A=n[Vo],g=!m&&A==null&&(E||!h),{description:R,source:O}=g?{description:u,source:_}:Za(e,n);return{op:o.join("."),description:R,source:O,data:p}}function GB(e){if(Array.isArray(e)){const t=e.slice().sort();return t.length<=5?t.join(", "):`${t.slice(0,5).join(", ")}, +${t.length-5}`}return`${e}`}function VB(e,t){const n=e[Q.SEMATTRS_HTTP_TARGET],r=e[Q.SEMATTRS_HTTP_URL]||e[Q.ATTR_URL_FULL],o=e[Q.ATTR_HTTP_ROUTE],s=typeof r=="string"?_l(r):void 0,i=s?pl(s):void 0,a=s?.search||void 0,c=s?.hash||void 0;return typeof o=="string"?{urlPath:o,url:i,query:a,fragment:c,hasRoute:!0}:t===b.SpanKind.SERVER&&typeof n=="string"?{urlPath:cc(n),url:i,query:a,fragment:c,hasRoute:!1}:s?{urlPath:i,url:i,query:a,fragment:c,hasRoute:!1}:typeof n=="string"?{urlPath:cc(n),url:i,query:a,fragment:c,hasRoute:!1}:{urlPath:void 0,url:i,query:a,fragment:c,hasRoute:!1}}function Za(e,t,n="custom"){const r=t[Wt]||n,o=t[Vo];return o&&typeof o=="string"?{description:o,source:r}:{description:e,source:r}}function xB(e){e.on("createDsc",(t,n)=>{if(!n)return;const s=Re(n).data[Wt],{description:i}=eP(n)?iP(n):{description:void 0};if(s!=="url"&&i&&(t.transaction=i),Kt()){const a=Bo(n.spanContext());t.sampled=a==null?void 0:String(a)}})}function aP(){return b.trace.getActiveSpan()}const Rn=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function cP({dsc:e,sampled:t}){const n=e?RE(e):void 0,r=new Zo,o=n?r.set(jE,n):r;return t===!1?o.set(qE,"1"):o}const uP=new Set;function $B(){return Array.from(uP)}function Ol(e){uP.add(e)}class BB extends JI{constructor(){super(),Ol("SentryPropagator"),this._urlMatchesTargetsMap=new ts(100)}inject(t,n,r){if(Nn(t)){Rn&&x.log("[Tracing] Not injecting trace data for url because tracing is suppressed.");return}const o=b.trace.getSpan(t),s=o&&YB(o),i=Te()?.getOptions()?.tracePropagationTargets;if(!WE(s,i,this._urlMatchesTargetsMap)){Rn&&x.log("[Tracing] Not injecting trace data for url because it does not match tracePropagationTargets:",s);return}const a=FB(n);let c=b.propagation.getBaggage(t)||b.propagation.createBaggage({});const{dynamicSamplingContext:l,traceId:f,spanId:d,sampled:u}=lP(t);if(a){const _=Su(a);_&&Object.entries(_).forEach(([p,E])=>{c=c.setEntry(p,{value:E})})}l&&(c=Object.entries(l).reduce((_,[p,E])=>E?_.setEntry(`${gE}${p}`,{value:E}):_,c)),f&&f!==b.INVALID_TRACEID&&r.set(n,Cd,il(f,d,u)),super.inject(b.propagation.setBaggage(t,c),n,r)}extract(t,n,r){const o=r.get(n,Cd),s=r.get(n,Ap),i=o?Array.isArray(o)?o[0]:o:void 0;return fP(dP(t,{sentryTrace:i,baggage:s}))}fields(){return[Cd,Ap]}}const Qg="[Tracing] Not injecting trace data for url because it does not match tracePropagationTargets:";function WE(e,t,n){if(typeof e!="string"||!t)return!0;const r=n?.get(e);if(r!==void 0)return Rn&&!r&&x.log(Qg,e),r;const o=Sc(e,t);return n?.set(e,o),Rn&&!o&&x.log(Qg,e),o}function lP(e,t={}){const n=b.trace.getSpan(e);if(n?.spanContext().isRemote){const a=n.spanContext();return{dynamicSamplingContext:Vt(n),traceId:a.traceId,spanId:void 0,sampled:Bo(a)}}if(n){const a=n.spanContext();return{dynamicSamplingContext:Vt(n),traceId:a.traceId,spanId:a.spanId,sampled:Bo(a)}}const r=t.scope||ns(e)?.scope||Ke(),o=t.client||Te(),s=r.getPropagationContext();return{dynamicSamplingContext:o?Rc(o,r):void 0,traceId:s.traceId,spanId:s.propagationSpanId,sampled:s.sampled}}function dP(e,{sentryTrace:t,baggage:n}){const r=WC(t,n),{traceId:o,parentSpanId:s,sampled:i,dsc:a}=r,c=Te(),l=gc(n);if(!s||c&&!Xk(c,l?.org_id))return e;const f=jB({traceId:o,spanId:s,sampled:i,dsc:a});return b.trace.setSpanContext(e,f)}function HB(e,t,n){const r=fP(dP(e,t));return b.context.with(r,n)}function fP(e){const t=ns(e),n={scope:t?t.scope:Ke().clone(),isolationScope:t?t.isolationScope:je()};return oP(e,n)}function FB(e){try{const t=e[Ap];return Array.isArray(t)?t.join(","):t}catch{return}}function YB(e){const t=Re(e).data,n=t[Q.SEMATTRS_HTTP_URL]||t[Q.ATTR_URL_FULL];if(typeof n=="string")return n;const r=e.spanContext().traceState?.get(tP);if(r)return r}function jB({spanId:e,traceId:t,sampled:n,dsc:r}){const o=cP({dsc:r,sampled:n});return{traceId:t,spanId:e,isRemote:!0,traceFlags:n?b.TraceFlags.SAMPLED:b.TraceFlags.NONE,traceState:o}}function _P(e,t,n){const r=EP(),{name:o,parentSpan:s}=e;return SP(s)(()=>{const a=hP(e.scope,e.forceTransaction),l=e.onlyIfParent&&!b.trace.getSpan(a)?Xr(a):a,f=TP(e);if(!Kt()){const d=Nn(l)?l:Xr(l);return b.context.with(d,()=>r.startActiveSpan(o,f,d,u=>b.context.with(a,()=>ro(()=>t(u),()=>{Re(u).status===void 0&&u.setStatus({code:b.SpanStatusCode.ERROR})},n?()=>u.end():void 0))))}return r.startActiveSpan(o,f,l,d=>ro(()=>t(d),()=>{Re(d).status===void 0&&d.setStatus({code:b.SpanStatusCode.ERROR})},n?()=>d.end():void 0))})}function qB(e,t){return _P(e,t,!0)}function WB(e,t){return _P(e,n=>t(n,()=>n.end()),!1)}function KB(e){const t=EP(),{name:n,parentSpan:r}=e;return SP(r)(()=>{const s=hP(e.scope,e.forceTransaction);let a=e.onlyIfParent&&!b.trace.getSpan(s)?Xr(s):s;const c=TP(e);return Kt()||(a=Nn(a)?a:Xr(a)),t.startSpan(n,c,a)})}function pP(e,t){const n=e?b.trace.setSpan(b.context.active(),e):b.trace.deleteSpan(b.context.active());return b.context.with(n,()=>t(Ke()))}function EP(){return Te()?.tracer||b.trace.getTracer("@sentry/opentelemetry",Ze)}function TP(e){const{startTime:t,attributes:n,kind:r,op:o,links:s}=e,i=typeof t=="number"?zB(t):t;return{attributes:o?{[Ee]:o,...n}:n,kind:r,links:s,startTime:i}}function zB(e){return e<9999999999?e*1e3:e}function hP(e,t){const n=ZB(e),r=b.trace.getSpan(n);if(!r||!t)return n;const o=b.trace.deleteSpan(n),{spanId:s,traceId:i}=r.spanContext(),a=Bo(r.spanContext()),c=Ft(r),l=Vt(c),f=cP({dsc:l,sampled:a}),d={traceId:i,spanId:s,isRemote:!0,traceFlags:a?b.TraceFlags.SAMPLED:b.TraceFlags.NONE,traceState:f};return b.trace.setSpanContext(o,d)}function ZB(e){if(e){const t=uc(e);if(t)return t}return b.context.active()}function XB(e,t){return HB(b.context.active(),e,t)}function QB(e,t){const n=uc(t),r=n&&b.trace.getSpan(n),o=r?al(r):SE(t);return[r?Vt(r):Rc(e,t),o]}function SP(e){return e!==void 0?t=>pP(e,t):t=>t()}function JB(e){const t=Xr(b.context.active());return b.context.with(t,e)}function eH(e){e.on("preprocessEvent",t=>{const n=aP();if(!n||t.type==="transaction")return;t.contexts={trace:al(n),...t.contexts};const r=Ft(n);return t.sdkProcessingMetadata={dynamicSamplingContext:Vt(r),...t.sdkProcessingMetadata},t})}function tH({span:e,scope:t,client:n}={}){let r=(t&&uc(t))??b.context.active();if(e){const{scope:c}=xo(e);r=c&&uc(c)||b.trace.setSpan(b.context.active(),e)}const{traceId:o,spanId:s,sampled:i,dynamicSamplingContext:a}=lP(r,{scope:t,client:n});return{"sentry-trace":il(o,s,i),baggage:RE(a)}}function nH(){function e(){const a=b.context.active(),c=ns(a);return c||{scope:hE(),isolationScope:Qo()}}function t(a){const c=b.context.active();return b.context.with(c,()=>a(s()))}function n(a,c){const l=uc(a)||b.context.active();return b.context.with(l.setValue(Rp,a),()=>c(a))}function r(a){const c=b.context.active();return b.context.with(c.setValue(gp,!0),()=>a(i()))}function o(a,c){const l=b.context.active();return b.context.with(l.setValue(Np,a),()=>c(i()))}function s(){return e().scope}function i(){return e().isolationScope}Ck({withScope:t,withSetScope:n,withSetIsolationScope:o,withIsolationScope:r,getCurrentScope:s,getIsolationScope:i,startSpan:qB,startSpanManual:WB,startInactiveSpan:KB,getActiveSpan:aP,suppressTracing:JB,getTraceData:tH,continueTrace:XB,withActiveSpan:pP})}function rH(e){class t extends e{constructor(...r){super(...r),Ol("SentryContextManager")}with(r,o,s,...i){const a=ns(r),c=a?.scope||Ke(),l=a?.isolationScope||je(),f=r.getValue(gp)===!0,d=r.getValue(Rp),u=r.getValue(Np),_=d||c.clone(),p=u||(f?l.clone():l),h=oP(r,{scope:_,isolationScope:p}).deleteValue(gp).deleteValue(Rp).deleteValue(Np);return wB(_,h),super.with(h,o,s,...i)}}return t}function oH(e){const t=new Map;for(const n of e)sH(t,n);return Array.from(t,function([n,r]){return r})}function mP(e){return e.attributes[HE]===!0?void 0:FE(e)}function sH(e,t){const n=t.spanContext().spanId,r=mP(t);if(!r){yp(e,{id:n,span:t,children:[]});return}const o=iH(e,r),s=yp(e,{id:n,span:t,parentNode:o,children:[]});o.children.push(s)}function iH(e,t){const n=e.get(t);return n||yp(e,{id:t,children:[]})}function yp(e,t){const n=e.get(t.id);return n?.span?n:n&&!n.span?(n.span=t.span,n.parentNode=t.parentNode,n):(e.set(t.id,t),t)}const AP={1:"cancelled",2:"unknown_error",3:"invalid_argument",4:"deadline_exceeded",5:"not_found",6:"already_exists",7:"permission_denied",8:"resource_exhausted",9:"failed_precondition",10:"aborted",11:"out_of_range",12:"unimplemented",13:"internal_error",14:"unavailable",15:"data_loss",16:"unauthenticated"},aH=e=>Object.values(AP).includes(e);function gP(e){const t=YE(e)?e.attributes:{},n=MB(e)?e.status:void 0;if(n){if(n.code===b.SpanStatusCode.OK)return{code:hu};if(n.code===b.SpanStatusCode.ERROR){if(typeof n.message>"u"){const o=Jg(t);if(o)return o}return n.message&&aH(n.message)?{code:Ae,message:n.message}:{code:Ae,message:"internal_error"}}}const r=Jg(t);return r||(n?.code===b.SpanStatusCode.UNSET?{code:hu}:{code:Ae,message:"unknown_error"})}function Jg(e){const t=e[Q.ATTR_HTTP_RESPONSE_STATUS_CODE]||e[Q.SEMATTRS_HTTP_STATUS_CODE],n=e[Q.SEMATTRS_RPC_GRPC_STATUS_CODE],r=typeof t=="number"?t:typeof t=="string"?parseInt(t):void 0;if(typeof r=="number")return up(r);if(typeof n=="string")return{code:Ae,message:AP[n]||"unknown_error"}}const eR=1e3,tR=300;class cH{constructor(t){this._finishedSpanBucketSize=t?.timeout||tR,this._finishedSpanBuckets=new Array(this._finishedSpanBucketSize).fill(void 0),this._lastCleanupTimestampInS=Math.floor(Date.now()/1e3),this._spansToBucketEntry=new WeakMap,this._sentSpans=new Map,this._debouncedFlush=FG(this.flush.bind(this),1,{maxWait:100})}export(t){const n=Math.floor(Date.now()/1e3);if(this._lastCleanupTimestampInS!==n){let i=0;this._finishedSpanBuckets.forEach((a,c)=>{a&&a.timestampInS<=n-this._finishedSpanBucketSize&&(i+=a.spans.size,this._finishedSpanBuckets[c]=void 0)}),i>0&&Rn&&x.log(`SpanExporter dropped ${i} spans because they were pending for more than ${this._finishedSpanBucketSize} seconds.`),this._lastCleanupTimestampInS=n}const r=n%this._finishedSpanBucketSize,o=this._finishedSpanBuckets[r]||{timestampInS:n,spans:new Set};this._finishedSpanBuckets[r]=o,o.spans.add(t),this._spansToBucketEntry.set(t,o);const s=mP(t);(!s||this._sentSpans.has(s))&&this._debouncedFlush()}flush(){const t=this._finishedSpanBuckets.flatMap(i=>i?Array.from(i.spans):[]);this._flushSentSpanCache();const n=this._maybeSend(t),r=n.size,o=t.length-r;Rn&&x.log(`SpanExporter exported ${r} spans, ${o} spans are waiting for their parent spans to finish`);const s=Date.now()+tR*1e3;for(const i of n){this._sentSpans.set(i.spanContext().spanId,s);const a=this._spansToBucketEntry.get(i);a&&a.spans.delete(i)}this._debouncedFlush.cancel()}clear(){this._finishedSpanBuckets=this._finishedSpanBuckets.fill(void 0),this._sentSpans.clear(),this._debouncedFlush.cancel()}_maybeSend(t){const n=oH(t),r=new Set,o=this._getCompletedRootNodes(n);for(const s of o){const i=s.span;r.add(i);const a=lH(i);if(s.parentNode&&this._sentSpans.has(s.parentNode.id)){const f=a.contexts?.trace?.data;f&&(f["sentry.parent_span_already_sent"]=!0)}const c=a.spans||[];for(const f of s.children)Op(f,c,r);a.spans=c.length>eR?c.sort((f,d)=>f.start_timestamp-d.start_timestamp).slice(0,eR):c;const l=mu(i.events);l&&(a.measurements=l),j1(a)}return r}_flushSentSpanCache(){const t=Date.now();for(const[n,r]of this._sentSpans.entries())r<=t&&this._sentSpans.delete(n)}_nodeIsCompletedRootNodeOrHasSentParent(t){return!!t.span&&(!t.parentNode||this._sentSpans.has(t.parentNode.id))}_getCompletedRootNodes(t){return t.filter(n=>this._nodeIsCompletedRootNodeOrHasSentParent(n))}}function uH(e){const t=e.attributes,n=t[Ge],r=t[Ee],o=t[Wt];return{origin:n,op:r,source:o}}function lH(e){const{op:t,description:n,data:r,origin:o="manual",source:s}=RP(e),i=xo(e),a=e.attributes[Go],c={[Wt]:s,[Go]:a,[Ee]:t,[Ge]:o,...r,...NP(e.attributes)},{links:l}=e,{traceId:f,spanId:d}=e.spanContext(),u=FE(e),_=gP(e),p={parent_span_id:u,span_id:d,trace_id:f,data:c,origin:o,op:t,status:ul(_),links:cl(l)},E=c[Q.ATTR_HTTP_RESPONSE_STATUS_CODE],T=typeof E=="number"?{response:{status_code:E}}:void 0;return{contexts:{trace:p,otel:{resource:e.resource.attributes},...T},spans:[],start_timestamp:mn(e.startTime),timestamp:mn(e.endTime),transaction:n,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:i.scope,capturedSpanIsolationScope:i.isolationScope,sampleRate:a,dynamicSamplingContext:Vt(e)},...s&&{transaction_info:{source:s}}}}function Op(e,t,n){const r=e.span;if(r&&n.add(r),!r){e.children.forEach(A=>{Op(A,t,n)});return}const s=r.spanContext().spanId,i=r.spanContext().traceId,a=FE(r),{attributes:c,startTime:l,endTime:f,links:d}=r,{op:u,description:_,data:p,origin:E="manual"}=RP(r),T={[Ge]:E,[Ee]:u,...NP(c),...p},h=gP(r),m={span_id:s,trace_id:i,data:T,description:_,parent_span_id:a,start_timestamp:mn(l),timestamp:mn(f)||void 0,status:ul(h),op:u,origin:E,measurements:mu(r.events),links:cl(d)};t.push(m),e.children.forEach(A=>{Op(A,t,n)})}function RP(e){const{op:t,source:n,origin:r}=uH(e),{op:o,description:s,source:i,data:a}=iP(e),c=t||o,l=n||i,f={...a,...dH(e)};return{op:c,description:s,source:l,origin:r,data:f}}function NP(e){const t={...e};return delete t[Go],delete t[HE],delete t[Vo],t}function dH(e){const t=e.attributes,n={};e.kind!==b.SpanKind.INTERNAL&&(n["otel.kind"]=b.SpanKind[e.kind]);const r=t[Q.SEMATTRS_HTTP_STATUS_CODE];r&&(n[Q.ATTR_HTTP_RESPONSE_STATUS_CODE]=r);const o=PB(e);return o.url&&(n.url=o.url),o["http.query"]&&(n["http.query"]=o["http.query"].slice(1)),o["http.fragment"]&&(n["http.fragment"]=o["http.fragment"].slice(1)),n}function fH(e,t){const n=b.trace.getSpan(t);let r=ns(t);n&&!n.spanContext().isRemote&&yE(n,e),n?.spanContext().isRemote&&e.setAttribute(HE,!0),t===b.ROOT_CONTEXT&&(r={scope:hE(),isolationScope:Qo()}),r&&HC(e,r.scope,r.isolationScope),tM(e),Te()?.emit("spanStart",e)}function _H(e){nM(e),Te()?.emit("spanEnd",e)}class pH{constructor(t){Ol("SentrySpanProcessor"),this._exporter=new cH(t)}async forceFlush(){this._exporter.flush()}async shutdown(){this._exporter.clear()}onStart(t,n){fH(t,n)}onEnd(t){_H(t),this._exporter.export(t)}}class EH{constructor(t){this._client=t,Ol("SentrySampler")}shouldSample(t,n,r,o,s,i){const a=this._client.getOptions(),c=SH(t),l=c?.spanContext();if(!Kt(a))return Ao({decision:void 0,context:t,spanAttributes:s});const f=s[Q.SEMATTRS_HTTP_METHOD]||s[Q.ATTR_HTTP_REQUEST_METHOD];if(o===b.SpanKind.CLIENT&&f&&(!c||l?.isRemote))return Ao({decision:void 0,context:t,spanAttributes:s});const d=c?TH(c,n,r):void 0;if(!(!c||l?.isRemote))return Ao({decision:d?Dt.RECORD_AND_SAMPLED:Dt.NOT_RECORD,context:t,spanAttributes:s});const{description:_,data:p,op:E}=sP(r,s,o),T={...p,...s};E&&(T[Ee]=E);const h={decision:!0};if(this._client.emit("beforeSampling",{spanAttributes:T,spanName:_,parentSampled:d,parentContext:l},h),!h.decision)return Ao({decision:void 0,context:t,spanAttributes:s});const{isolationScope:m}=ns(t)??{},A=l?.traceState?l.traceState.get(jE):void 0,g=A?gc(A):void 0,R=no(g?.sample_rand)??Math.random(),[O,C,I]=rM(a,{name:_,attributes:T,normalizedRequest:m?.getScopeData().sdkProcessingMetadata.normalizedRequest,parentSampled:d,parentSampleRate:no(g?.sample_rate)},R),L=`${f}`.toUpperCase();return L==="OPTIONS"||L==="HEAD"?(Rn&&x.log(`[Tracing] Not sampling span because HTTP method is '${L}' for ${r}`),Ao({decision:Dt.NOT_RECORD,context:t,spanAttributes:s,sampleRand:R,downstreamTraceSampleRate:0})):(!O&&d===void 0&&(Rn&&x.log("[Tracing] Discarding root span because its trace was not chosen to be sampled."),this._client.recordDroppedEvent("sample_rate","transaction")),{...Ao({decision:O?Dt.RECORD_AND_SAMPLED:Dt.NOT_RECORD,context:t,spanAttributes:s,sampleRand:R,downstreamTraceSampleRate:I?C:void 0}),attributes:{[Go]:I?C:void 0}})}toString(){return"SentrySampler"}}function TH(e,t,n){const r=e.spanContext();if(b.isSpanContextValid(r)&&r.traceId===t){if(r.isRemote){const s=Bo(e.spanContext());return Rn&&x.log(`[Tracing] Inheriting remote parent's sampled decision for ${n}: ${s}`),s}const o=Bo(r);return Rn&&x.log(`[Tracing] Inheriting parent's sampled decision for ${n}: ${o}`),o}}function Ao({decision:e,context:t,spanAttributes:n,sampleRand:r,downstreamTraceSampleRate:o}){let s=hH(t,n);return o!==void 0&&(s=s.set(DB,`${o}`)),r!==void 0&&(s=s.set(LB,`${r}`)),e==null?{decision:Dt.NOT_RECORD,traceState:s}:e===Dt.NOT_RECORD?{decision:e,traceState:s.set(qE,"1")}:{decision:e,traceState:s}}function hH(e,t){let o=b.trace.getSpan(e)?.spanContext()?.traceState||new Zo;const s=t[Q.SEMATTRS_HTTP_URL]||t[Q.ATTR_URL_FULL];return s&&typeof s=="string"&&(o=o.set(tP,s)),o}function SH(e){const t=b.trace.getSpan(e);return t&&b.isSpanContextValid(t.spanContext())?t:void 0}function bp(e,t){if(!e)return t;const n=Su(e),r=Su(t);if(!r)return e;const o={...n};return Object.entries(r).forEach(([s,i])=>{o[s]||(o[s]=i)}),FC(o)}function mH(e,t){const n=gH(e),r=t?.statusCode,o=YM(r);$o({category:"http",data:{status_code:r,...n},type:"http",level:o},{event:"response",request:e,response:t})}function AH(e,t){const n=NH(e),r=Te()?.getOptions().tracePropagationTargets,o=WE(n,r,t)?yM():void 0;if(!o)return;const{"sentry-trace":s,baggage:i}=o;if(s&&!e.getHeader("sentry-trace"))try{e.setHeader("sentry-trace",s),Ce&&x.log(yo,"Added sentry-trace header to outgoing request")}catch(a){Ce&&x.error(yo,"Failed to add sentry-trace header to outgoing request:",_u(a)?a.message:"Unknown error")}if(i){const a=bp(e.getHeader("baggage"),i);if(a)try{e.setHeader("baggage",a),Ce&&x.log(yo,"Added baggage header to outgoing request")}catch(c){Ce&&x.error(yo,"Failed to add baggage header to outgoing request:",_u(c)?c.message:"Unknown error")}}}function gH(e){try{const t=e.getHeader("host")||e.host,n=new URL(e.path,`${e.protocol}//${t}`),r=_l(n.toString()),o={url:pl(r),"http.method":e.method||"GET"};return r.search&&(o["http.query"]=r.search),r.hash&&(o["http.fragment"]=r.hash),o}catch{return{}}}function RH(e){return{method:e.method,protocol:e.protocol,host:e.host,hostname:e.host,path:e.path,headers:e.getHeaders()}}function NH(e){const t=e.getHeader("host")||e.host,n=e.protocol,r=e.path;return`${n}//${t}${r}`}class yP extends yt{constructor(t={}){super(yo,Ze,t),this._propagationDecisionMap=new ts(100),this._ignoreOutgoingRequestsMap=new WeakMap}init(){let t=!1;const n=(a=>{const c=a;this._onOutgoingRequestFinish(c.request,c.response)}),r=(a=>{const c=a;this._onOutgoingRequestFinish(c.request,void 0)}),o=(a=>{const c=a;this._onOutgoingRequestCreated(c.request)}),s=a=>(t||(t=!0,hn.subscribe("http.client.response.finish",n),hn.subscribe("http.client.request.error",r),this.getConfig().propagateTraceInOutgoingRequests&&hn.subscribe("http.client.request.created",o)),a),i=()=>{hn.unsubscribe("http.client.response.finish",n),hn.unsubscribe("http.client.request.error",r),hn.unsubscribe("http.client.request.created",o)};return[new dt("http",["*"],s,i),new dt("https",["*"],s,i)]}_onOutgoingRequestFinish(t,n){Ce&&x.log(yo,"Handling finished outgoing request");const r=this.getConfig().breadcrumbs,o=typeof r>"u"?!0:r,s=this._ignoreOutgoingRequestsMap.get(t)??this._shouldIgnoreOutgoingRequest(t);this._ignoreOutgoingRequestsMap.set(t,s),o&&!s&&mH(t,n)}_onOutgoingRequestCreated(t){const n=this._ignoreOutgoingRequestsMap.get(t)??this._shouldIgnoreOutgoingRequest(t);this._ignoreOutgoingRequestsMap.set(t,n),!n&&AH(t,this._propagationDecisionMap)}_shouldIgnoreOutgoingRequest(t){if(Nn(b.context.active()))return!0;const n=this.getConfig().ignoreOutgoingRequests;if(!n)return!1;const r=RH(t),o=KM(t);return n(o,r)}}const OP="Http",yH=Ne(`${OP}.sentry`,e=>new yP(e)),OH=(e={})=>{const t={sessions:e.trackIncomingRequestsAsSessions,sessionFlushingDelayMS:e.sessionFlushingDelayMS,ignoreRequestBody:e.ignoreIncomingRequestBody,maxRequestBodySize:e.maxIncomingRequestBodySize},n={ignoreIncomingRequests:e.ignoreIncomingRequests,ignoreStaticAssets:e.ignoreStaticAssets,ignoreStatusCodes:e.dropSpansForIncomingRequestStatusCodes},r={breadcrumbs:e.breadcrumbs,propagateTraceInOutgoingRequests:!0,ignoreOutgoingRequests:e.ignoreOutgoingRequests},o=qM(t),s=WM(n),i=e.spans??!1,a=e.disableIncomingRequestSpans??!1,c=i&&!a;return{name:OP,setup(l){c&&s.setup(l)},setupOnce(){o.setupOnce(),yH(r)},processEvent(l){return s.processEvent(l)}}},bl=hk(process.versions.node),Do=bl.major,Ip=bl.minor,Uc="sentry-trace",Md="baggage",nR=/baggage: (.*)\r\n/;class bP extends yt{constructor(t={}){super("@sentry/instrumentation-node-fetch",Ze,t),this._channelSubs=[],this._propagationDecisionMap=new ts(100),this._ignoreOutgoingRequestsMap=new WeakMap}init(){}disable(){super.disable(),this._channelSubs.forEach(t=>t.unsubscribe()),this._channelSubs=[]}enable(){super.enable(),this._channelSubs=this._channelSubs||[],!(this._channelSubs.length>0)&&(this._subscribeToChannel("undici:request:create",this._onRequestCreated.bind(this)),this._subscribeToChannel("undici:request:headers",this._onResponseHeaders.bind(this)))}_onRequestCreated({request:t}){if(!(this.getConfig().enabled!==!1))return;const o=this._shouldIgnoreOutgoingRequest(t);if(this._ignoreOutgoingRequestsMap.set(t,o),o)return;const s=Cp(t.origin,t.path),i=Te()?.getOptions().tracePropagationTargets,a=WE(s,i,this._propagationDecisionMap)?yM():void 0;if(!a)return;const{"sentry-trace":c,baggage:l}=a;if(Array.isArray(t.headers)){const f=t.headers;c&&!f.includes(Uc)&&f.push(Uc,c);const d=f.findIndex(u=>u===Md);if(l&&d===-1)f.push(Md,l);else if(l){const u=f[d+1],_=bp(u,l);_&&(f[d+1]=_)}}else{const f=t.headers;c&&!f.includes(`${Uc}:`)&&(t.headers+=`${Uc}: ${c}\r
`);const d=t.headers.match(nR)?.[1];if(l&&!d)t.headers+=`${Md}: ${l}\r
`;else if(l){const u=bp(d,l);u&&(t.headers=t.headers.replace(nR,`baggage: ${u}\r
`))}}}_onResponseHeaders({request:t,response:n}){const r=this.getConfig();if(!(r.enabled!==!1))return;const s=r.breadcrumbs,i=typeof s>"u"?!0:s,a=this._ignoreOutgoingRequestsMap.get(t);i&&!a&&bH(t,n)}_subscribeToChannel(t,n){const r=Do>18||Do===18&&Ip>=19;let o;if(r)ql.subscribe?.(t,n),o=()=>ql.unsubscribe?.(t,n);else{const s=ql.channel(t);s.subscribe(n),o=()=>s.unsubscribe(n)}this._channelSubs.push({name:t,unsubscribe:o})}_shouldIgnoreOutgoingRequest(t){if(Nn(b.context.active()))return!0;const n=Cp(t.origin,t.path),r=this.getConfig().ignoreOutgoingRequests;return typeof r!="function"||!n?!1:r(n)}}function bH(e,t){const n=IH(e),r=t.statusCode,o=YM(r);$o({category:"http",data:{status_code:r,...n},type:"http",level:o},{event:"response",request:e,response:t})}function IH(e){try{const t=Cp(e.origin,e.path),n=_l(t),r={url:pl(n),"http.method":e.method||"GET"};return n.search&&(r["http.query"]=n.search),n.hash&&(r["http.fragment"]=n.hash),r}catch{return{}}}function Cp(e,t="/"){try{return new URL(t,e).toString()}catch{const n=`${e}`;return n.endsWith("/")&&t.startsWith("/")?`${n}${t.slice(1)}`:!n.endsWith("/")&&!t.startsWith("/")?`${n}/${t.slice(1)}`:`${n}${t}`}}const CH="NodeFetch",MH=Ne(`${CH}.sentry`,bP,e=>e),PH=((e={})=>({name:"NodeFetch",setupOnce(){MH(e)}})),vH=PH,LH=Wo.promisify(de.readFile),DH=Wo.promisify(de.readdir),wH="Context",UH=((e={})=>{let t;const n={app:!0,os:!0,device:!0,culture:!0,cloudResource:!0,...e};async function r(s){t===void 0&&(t=o());const i=GH(await t);return s.contexts={...s.contexts,app:{...i.app,...s.contexts?.app},os:{...i.os,...s.contexts?.os},device:{...i.device,...s.contexts?.device},culture:{...i.culture,...s.contexts?.culture},cloud_resource:{...i.cloud_resource,...s.contexts?.cloud_resource}},s}async function o(){const s={};if(n.os&&(s.os=await VH()),n.app&&(s.app=$H()),n.device&&(s.device=BH(n.device)),n.culture){const i=xH();i&&(s.culture=i)}return n.cloudResource&&(s.cloud_resource=WH()),s}return{name:wH,processEvent(s){return r(s)}}}),kH=UH;function GH(e){if(e.app?.app_memory&&(e.app.app_memory=process.memoryUsage().rss),e.app?.free_memory&&typeof process.availableMemory=="function"){const t=process.availableMemory?.();t!=null&&(e.app.free_memory=t)}return e.device?.free_memory&&(e.device.free_memory=Lt.freemem()),e}async function VH(){const e=Lt.platform();switch(e){case"darwin":return jH();case"linux":return qH();default:return{name:HH[e]||e,version:Lt.release()}}}function xH(){try{if(typeof process.versions.icu!="string")return;const e=new Date(9e8);if(new Intl.DateTimeFormat("es",{month:"long"}).format(e)==="enero"){const n=Intl.DateTimeFormat().resolvedOptions();return{locale:n.locale,timezone:n.timeZone}}}catch{}}function $H(){const e=process.memoryUsage().rss,n={app_start_time:new Date(Date.now()-process.uptime()*1e3).toISOString(),app_memory:e};if(typeof process.availableMemory=="function"){const r=process.availableMemory?.();r!=null&&(n.free_memory=r)}return n}function BH(e){const t={};let n;try{n=Lt.uptime()}catch{}if(typeof n=="number"&&(t.boot_time=new Date(Date.now()-n*1e3).toISOString()),t.arch=Lt.arch(),(e===!0||e.memory)&&(t.memory_size=Lt.totalmem(),t.free_memory=Lt.freemem()),e===!0||e.cpu){const r=Lt.cpus(),o=r?.[0];o&&(t.processor_count=r.length,t.cpu_description=o.model,t.processor_frequency=o.speed)}return t}const HH={aix:"IBM AIX",freebsd:"FreeBSD",openbsd:"OpenBSD",sunos:"SunOS",win32:"Windows",ohos:"OpenHarmony",android:"Android"},FH=[{name:"fedora-release",distros:["Fedora"]},{name:"redhat-release",distros:["Red Hat Linux","Centos"]},{name:"redhat_version",distros:["Red Hat Linux"]},{name:"SuSE-release",distros:["SUSE Linux"]},{name:"lsb-release",distros:["Ubuntu Linux","Arch Linux"]},{name:"debian_version",distros:["Debian"]},{name:"debian_release",distros:["Debian"]},{name:"arch-release",distros:["Arch Linux"]},{name:"gentoo-release",distros:["Gentoo Linux"]},{name:"novell-release",distros:["SUSE Linux"]},{name:"alpine-release",distros:["Alpine Linux"]}],YH={alpine:e=>e,arch:e=>Tn(/distrib_release=(.*)/,e),centos:e=>Tn(/release ([^ ]+)/,e),debian:e=>e,fedora:e=>Tn(/release (..)/,e),mint:e=>Tn(/distrib_release=(.*)/,e),red:e=>Tn(/release ([^ ]+)/,e),suse:e=>Tn(/VERSION = (.*)\n/,e),ubuntu:e=>Tn(/distrib_release=(.*)/,e)};function Tn(e,t){const n=e.exec(t);return n?n[1]:void 0}async function jH(){const e={kernel_version:Lt.release(),name:"Mac OS X",version:`10.${Number(Lt.release().split(".")[0])-4}`};try{const t=await new Promise((n,r)=>{Tc.execFile("/usr/bin/sw_vers",(o,s)=>{if(o){r(o);return}n(s)})});e.name=Tn(/^ProductName:\s+(.*)$/m,t),e.version=Tn(/^ProductVersion:\s+(.*)$/m,t),e.build=Tn(/^BuildVersion:\s+(.*)$/m,t)}catch{}return e}function rR(e){return e.split(" ")[0].toLowerCase()}async function qH(){const e={kernel_version:Lt.release(),name:"Linux"};try{const t=await DH("/etc"),n=FH.find(a=>t.includes(a.name));if(!n)return e;const r=le.join("/etc",n.name),o=(await LH(r,{encoding:"utf-8"})).toLowerCase(),{distros:s}=n;e.name=s.find(a=>o.indexOf(rR(a))>=0)||s[0];const i=rR(e.name);e.version=YH[i]?.(o)}catch{}return e}function WH(){return process.env.VERCEL?{"cloud.provider":"vercel","cloud.region":process.env.VERCEL_REGION}:process.env.AWS_REGION?{"cloud.provider":"aws","cloud.region":process.env.AWS_REGION,"cloud.platform":process.env.AWS_EXECUTION_ENV}:process.env.GCP_PROJECT?{"cloud.provider":"gcp"}:process.env.ALIYUN_REGION_ID?{"cloud.provider":"alibaba_cloud","cloud.region":process.env.ALIYUN_REGION_ID}:process.env.WEBSITE_SITE_NAME&&process.env.REGION_NAME?{"cloud.provider":"azure","cloud.region":process.env.REGION_NAME}:process.env.IBM_CLOUD_REGION?{"cloud.provider":"ibm_cloud","cloud.region":process.env.IBM_CLOUD_REGION}:process.env.TENCENTCLOUD_REGION?{"cloud.provider":"tencent_cloud","cloud.region":process.env.TENCENTCLOUD_REGION,"cloud.account.id":process.env.TENCENTCLOUD_APPID,"cloud.availability_zone":process.env.TENCENTCLOUD_ZONE}:process.env.NETLIFY?{"cloud.provider":"netlify"}:process.env.FLY_REGION?{"cloud.provider":"fly.io","cloud.region":process.env.FLY_REGION}:process.env.DYNO?{"cloud.provider":"heroku"}:void 0}const Mp=new ts(10),IP=new ts(20),KH=7,zH="ContextLines",ZH=1e3,XH=1e4;function QH(e,t,n){const r=e.get(t);return r===void 0?(e.set(t,n),n):r}function JH(e){return!!(e.startsWith("node:")||e.endsWith(".min.js")||e.endsWith(".min.cjs")||e.endsWith(".min.mjs")||e.startsWith("data:"))}function eF(e){return e.lineno!==void 0&&e.lineno>XH||e.colno!==void 0&&e.colno>ZH}function tF(e,t){const n=Mp.get(e);if(n===void 0)return!1;for(let r=t[0];r<=t[1];r++)if(n[r]===void 0)return!1;return!0}function nF(e,t){if(!e.length)return[];let n=0;const r=e[0];if(typeof r!="number")return[];let o=sR(r,t);const s=[];for(;;){if(n===e.length-1){s.push(o);break}const i=e[n+1];if(typeof i!="number")break;i<=o[1]?o[1]=i+t:(s.push(o),o=sR(i,t)),n++}return s}function rF(e,t,n){return new Promise((r,o)=>{const s=de.createReadStream(e),i=MD.createInterface({input:s});function a(){s.destroy(),r()}let c=0,l=0;const f=t[l];if(f===void 0){a();return}let d=f[0],u=f[1];function _(p){IP.set(e,1),Ce&&x.error(`Failed to read file: ${e}. Error: ${p}`),i.close(),i.removeAllListeners(),a()}s.on("error",_),i.on("error",_),i.on("close",a),i.on("line",p=>{if(c++,!(c<d)&&(n[c]=dk(p,0),c>=u)){if(l===t.length-1){i.close(),i.removeAllListeners();return}l++;const E=t[l];if(E===void 0){i.close(),i.removeAllListeners();return}d=E[0],u=E[1]}})})}async function oF(e,t){const n={};if(t>0&&e.exception?.values){for(const s of e.exception.values)if(s.stacktrace?.frames?.length)for(let i=s.stacktrace.frames.length-1;i>=0;i--){const a=s.stacktrace.frames[i],c=a?.filename;if(!a||typeof c!="string"||typeof a.lineno!="number"||JH(c)||eF(a))continue;n[c]||(n[c]=[]),n[c].push(a.lineno)}}const r=Object.keys(n);if(r.length==0)return e;const o=[];for(const s of r){if(IP.get(s))continue;const i=n[s];if(!i)continue;i.sort((l,f)=>l-f);const a=nF(i,t);if(a.every(l=>tF(s,l)))continue;const c=QH(Mp,s,{});o.push(rF(s,a,c))}if(await Promise.all(o).catch(()=>{Ce&&x.log("Failed to read one or more source files and resolve context lines")}),t>0&&e.exception?.values)for(const s of e.exception.values)s.stacktrace?.frames&&s.stacktrace.frames.length>0&&sF(s.stacktrace.frames,t,Mp);return e}function sF(e,t,n){for(const r of e)if(r.filename&&r.context_line===void 0&&typeof r.lineno=="number"){const o=n.get(r.filename);if(o===void 0)continue;iF(r.lineno,r,t,o)}}function oR(e){delete e.pre_context,delete e.context_line,delete e.post_context}function iF(e,t,n,r){if(t.lineno===void 0||r===void 0){Ce&&x.error("Cannot resolve context for frame with no lineno or file contents");return}t.pre_context=[];for(let s=CP(e,n);s<e;s++){const i=r[s];if(i===void 0){oR(t),Ce&&x.error(`Could not find line ${s} in file ${t.filename}`);return}t.pre_context.push(i)}if(r[e]===void 0){oR(t),Ce&&x.error(`Could not find line ${e} in file ${t.filename}`);return}t.context_line=r[e];const o=MP(e,n);t.post_context=[];for(let s=e+1;s<=o;s++){const i=r[s];if(i===void 0)break;t.post_context.push(i)}}function CP(e,t){return Math.max(1,e-t)}function MP(e,t){return e+t}function sR(e,t){return[CP(e,t),MP(e,t)]}const aF=((e={})=>{const t=e.frameContextLines!==void 0?e.frameContextLines:KH;return{name:zH,processEvent(n){return oF(n,t)}}}),cF=aF;let kc;async function PP(){if(kc===void 0)try{kc=!!(await import("node:inspector")).url()}catch{kc=!1}return kc}const Gc="__SENTRY_ERROR_LOCAL_VARIABLES__";function uF(e,t,n){let r=0,o=5,s=0;return setInterval(()=>{s===0?r>e&&(o*=2,n(o),o>86400&&(o=86400),s=o):(s-=1,s===0&&t()),r=0},1e3).unref(),()=>{r+=1}}function iR(e){return e!==void 0&&(e.length===0||e==="?"||e==="<anonymous>")}function vP(e,t){return e===t||`Object.${e}`===t||e===`Object.${t}`||iR(e)&&iR(t)}const lF="LyohIEBzZW50cnkvbm9kZS1jb3JlIDEwLjI5LjAgKDM1MjlkNDYpIHwgaHR0cHM6Ly9naXRodWIuY29tL2dldHNlbnRyeS9zZW50cnktamF2YXNjcmlwdCAqLwppbXBvcnR7U2Vzc2lvbiBhcyBlfWZyb20ibm9kZTppbnNwZWN0b3IvcHJvbWlzZXMiO2ltcG9ydHt3b3JrZXJEYXRhIGFzIHR9ZnJvbSJub2RlOndvcmtlcl90aHJlYWRzIjtjb25zdCBuPWdsb2JhbFRoaXMsaT17fTtjb25zdCBvPSJfX1NFTlRSWV9FUlJPUl9MT0NBTF9WQVJJQUJMRVNfXyI7Y29uc3QgYT10O2Z1bmN0aW9uIHMoLi4uZSl7YS5kZWJ1ZyYmZnVuY3Rpb24oZSl7aWYoISgiY29uc29sZSJpbiBuKSlyZXR1cm4gZSgpO2NvbnN0IHQ9bi5jb25zb2xlLG89e30sYT1PYmplY3Qua2V5cyhpKTthLmZvckVhY2goZT0+e2NvbnN0IG49aVtlXTtvW2VdPXRbZV0sdFtlXT1ufSk7dHJ5e3JldHVybiBlKCl9ZmluYWxseXthLmZvckVhY2goZT0+e3RbZV09b1tlXX0pfX0oKCk9PmNvbnNvbGUubG9nKCJbTG9jYWxWYXJpYWJsZXMgV29ya2VyXSIsLi4uZSkpfWFzeW5jIGZ1bmN0aW9uIGMoZSx0LG4saSl7Y29uc3Qgbz1hd2FpdCBlLnBvc3QoIlJ1bnRpbWUuZ2V0UHJvcGVydGllcyIse29iamVjdElkOnQsb3duUHJvcGVydGllczohMH0pO2lbbl09by5yZXN1bHQuZmlsdGVyKGU9PiJsZW5ndGgiIT09ZS5uYW1lJiYhaXNOYU4ocGFyc2VJbnQoZS5uYW1lLDEwKSkpLnNvcnQoKGUsdCk9PnBhcnNlSW50KGUubmFtZSwxMCktcGFyc2VJbnQodC5uYW1lLDEwKSkubWFwKGU9PmUudmFsdWU/LnZhbHVlKX1hc3luYyBmdW5jdGlvbiByKGUsdCxuLGkpe2NvbnN0IG89YXdhaXQgZS5wb3N0KCJSdW50aW1lLmdldFByb3BlcnRpZXMiLHtvYmplY3RJZDp0LG93blByb3BlcnRpZXM6ITB9KTtpW25dPW8ucmVzdWx0Lm1hcChlPT5bZS5uYW1lLGUudmFsdWU/LnZhbHVlXSkucmVkdWNlKChlLFt0LG5dKT0+KGVbdF09bixlKSx7fSl9ZnVuY3Rpb24gdShlLHQpe2UudmFsdWUmJigidmFsdWUiaW4gZS52YWx1ZT92b2lkIDA9PT1lLnZhbHVlLnZhbHVlfHxudWxsPT09ZS52YWx1ZS52YWx1ZT90W2UubmFtZV09YDwke2UudmFsdWUudmFsdWV9PmA6dFtlLm5hbWVdPWUudmFsdWUudmFsdWU6ImRlc2NyaXB0aW9uImluIGUudmFsdWUmJiJmdW5jdGlvbiIhPT1lLnZhbHVlLnR5cGU/dFtlLm5hbWVdPWA8JHtlLnZhbHVlLmRlc2NyaXB0aW9ufT5gOiJ1bmRlZmluZWQiPT09ZS52YWx1ZS50eXBlJiYodFtlLm5hbWVdPSI8dW5kZWZpbmVkPiIpKX1hc3luYyBmdW5jdGlvbiBsKGUsdCl7Y29uc3Qgbj1hd2FpdCBlLnBvc3QoIlJ1bnRpbWUuZ2V0UHJvcGVydGllcyIse29iamVjdElkOnQsb3duUHJvcGVydGllczohMH0pLGk9e307Zm9yKGNvbnN0IHQgb2Ygbi5yZXN1bHQpaWYodC52YWx1ZT8ub2JqZWN0SWQmJiJBcnJheSI9PT10LnZhbHVlLmNsYXNzTmFtZSl7Y29uc3Qgbj10LnZhbHVlLm9iamVjdElkO2F3YWl0IGMoZSxuLHQubmFtZSxpKX1lbHNlIGlmKHQudmFsdWU/Lm9iamVjdElkJiYiT2JqZWN0Ij09PXQudmFsdWUuY2xhc3NOYW1lKXtjb25zdCBuPXQudmFsdWUub2JqZWN0SWQ7YXdhaXQgcihlLG4sdC5uYW1lLGkpfWVsc2UgdC52YWx1ZSYmdSh0LGkpO3JldHVybiBpfWxldCBmOyhhc3luYyBmdW5jdGlvbigpe2NvbnN0IHQ9bmV3IGU7dC5jb25uZWN0VG9NYWluVGhyZWFkKCkscygiQ29ubmVjdGVkIHRvIG1haW4gdGhyZWFkIik7bGV0IG49ITE7dC5vbigiRGVidWdnZXIucmVzdW1lZCIsKCk9PntuPSExfSksdC5vbigiRGVidWdnZXIucGF1c2VkIixlPT57bj0hMCxhc3luYyBmdW5jdGlvbihlLHtyZWFzb246dCxkYXRhOntvYmplY3RJZDpufSxjYWxsRnJhbWVzOml9KXtpZigiZXhjZXB0aW9uIiE9PXQmJiJwcm9taXNlUmVqZWN0aW9uIiE9PXQpcmV0dXJuO2lmKGY/LigpLG51bGw9PW4pcmV0dXJuO2NvbnN0IGE9W107Zm9yKGxldCB0PTA7dDxpLmxlbmd0aDt0Kyspe2NvbnN0e3Njb3BlQ2hhaW46bixmdW5jdGlvbk5hbWU6byx0aGlzOnN9PWlbdF0sYz1uLmZpbmQoZT0+ImxvY2FsIj09PWUudHlwZSkscj0iZ2xvYmFsIiE9PXMuY2xhc3NOYW1lJiZzLmNsYXNzTmFtZT9gJHtzLmNsYXNzTmFtZX0uJHtvfWA6bztpZih2b2lkIDA9PT1jPy5vYmplY3Qub2JqZWN0SWQpYVt0XT17ZnVuY3Rpb246cn07ZWxzZXtjb25zdCBuPWF3YWl0IGwoZSxjLm9iamVjdC5vYmplY3RJZCk7YVt0XT17ZnVuY3Rpb246cix2YXJzOm59fX1hd2FpdCBlLnBvc3QoIlJ1bnRpbWUuY2FsbEZ1bmN0aW9uT24iLHtmdW5jdGlvbkRlY2xhcmF0aW9uOmBmdW5jdGlvbigpIHsgdGhpcy4ke299ID0gdGhpcy4ke299IHx8ICR7SlNPTi5zdHJpbmdpZnkoYSl9OyB9YCxzaWxlbnQ6ITAsb2JqZWN0SWQ6bn0pLGF3YWl0IGUucG9zdCgiUnVudGltZS5yZWxlYXNlT2JqZWN0Iix7b2JqZWN0SWQ6bn0pfSh0LGUucGFyYW1zKS50aGVuKGFzeW5jKCk9PntuJiZhd2FpdCB0LnBvc3QoIkRlYnVnZ2VyLnJlc3VtZSIpfSxhc3luYyBlPT57biYmYXdhaXQgdC5wb3N0KCJEZWJ1Z2dlci5yZXN1bWUiKX0pfSksYXdhaXQgdC5wb3N0KCJEZWJ1Z2dlci5lbmFibGUiKTtjb25zdCBpPSExIT09YS5jYXB0dXJlQWxsRXhjZXB0aW9ucztpZihhd2FpdCB0LnBvc3QoIkRlYnVnZ2VyLnNldFBhdXNlT25FeGNlcHRpb25zIix7c3RhdGU6aT8iYWxsIjoidW5jYXVnaHQifSksaSl7Y29uc3QgZT1hLm1heEV4Y2VwdGlvbnNQZXJTZWNvbmR8fDUwO2Y9ZnVuY3Rpb24oZSx0LG4pe2xldCBpPTAsbz01LGE9MDtyZXR1cm4gc2V0SW50ZXJ2YWwoKCk9PnswPT09YT9pPmUmJihvKj0yLG4obyksbz44NjQwMCYmKG89ODY0MDApLGE9byk6KGEtPTEsMD09PWEmJnQoKSksaT0wfSwxZTMpLnVucmVmKCksKCk9PntpKz0xfX0oZSxhc3luYygpPT57cygiUmF0ZS1saW1pdCBsaWZ0ZWQuIiksYXdhaXQgdC5wb3N0KCJEZWJ1Z2dlci5zZXRQYXVzZU9uRXhjZXB0aW9ucyIse3N0YXRlOiJhbGwifSl9LGFzeW5jIGU9PntzKGBSYXRlLWxpbWl0IGV4Y2VlZGVkLiBEaXNhYmxpbmcgY2FwdHVyaW5nIG9mIGNhdWdodCBleGNlcHRpb25zIGZvciAke2V9IHNlY29uZHMuYCksYXdhaXQgdC5wb3N0KCJEZWJ1Z2dlci5zZXRQYXVzZU9uRXhjZXB0aW9ucyIse3N0YXRlOiJ1bmNhdWdodCJ9KX0pfX0pKCkuY2F0Y2goZT0+e3MoIkZhaWxlZCB0byBzdGFydCBkZWJ1Z2dlciIsZSl9KSxzZXRJbnRlcnZhbCgoKT0+e30sMWU0KTs=";function aR(...e){x.log("[LocalVariables]",...e)}const dF=((e={})=>{function t(s,i){const a=(s.stacktrace?.frames||[]).filter(c=>c.function!=="new Promise");for(let c=0;c<a.length;c++){const l=a.length-c-1,f=i[c],d=a[l];if(!d||!f)break;f.vars===void 0||d.in_app===!1&&e.includeOutOfAppFrames!==!0||!vP(d.function,f.function)||(d.vars=f.vars)}}function n(s,i){if(i.originalException&&typeof i.originalException=="object"&&Gc in i.originalException&&Array.isArray(i.originalException[Gc])){for(const a of s.exception?.values||[])t(a,i.originalException[Gc]);i.originalException[Gc]=void 0}return s}async function r(){const s=await import("node:inspector");s.url()||s.open(0)}function o(s){const i=new Ku.Worker(new URL(`data:application/javascript;base64,${lF}`),{workerData:s,execArgv:[],env:{...process.env,NODE_OPTIONS:void 0}});process.on("exit",()=>{i.terminate()}),i.once("error",a=>{aR("Worker error",a)}),i.once("exit",a=>{aR("Worker exit",a)}),i.unref()}return{name:"LocalVariablesAsync",async setup(s){if(!s.getOptions().includeLocalVariables)return;if(await PP()){x.warn("Local variables capture has been disabled because the debugger was already enabled");return}const a={...e,debug:x.isEnabled()};r().then(()=>{try{o(a)}catch(c){x.error("Failed to start worker",c)}},c=>{x.error("Failed to start inspector",c)})},processEvent(s,i){return n(s,i)}}});function LP(e){if(e!==void 0)return e.slice(-10).reduce((t,n)=>`${t},${n.function},${n.lineno},${n.colno}`,"")}function fF(e,t){if(t!==void 0)return LP(e(t,1))}function DP(e){let t=[],n=!1;function r(i){t=[],!n&&(n=!0,e(i))}t.push(r);function o(i){t.push(i)}function s(i){const a=t.pop()||r;try{a(i)}catch{r(i)}}return{add:o,next:s}}class KE{constructor(t){this._session=t}static async create(t){if(t)return t;const n=await import("node:inspector");return new KE(new n.Session)}configureAndConnect(t,n){this._session.connect(),this._session.on("Debugger.paused",r=>{t(r,()=>{this._session.post("Debugger.resume")})}),this._session.post("Debugger.enable"),this._session.post("Debugger.setPauseOnExceptions",{state:n?"all":"uncaught"})}setPauseOnExceptions(t){this._session.post("Debugger.setPauseOnExceptions",{state:t?"all":"uncaught"})}getLocalVariables(t,n){this._getProperties(t,r=>{const{add:o,next:s}=DP(n);for(const i of r)if(i.value?.objectId&&i.value.className==="Array"){const a=i.value.objectId;o(c=>this._unrollArray(a,i.name,c,s))}else if(i.value?.objectId&&i.value.className==="Object"){const a=i.value.objectId;o(c=>this._unrollObject(a,i.name,c,s))}else i.value&&o(a=>this._unrollOther(i,a,s));s({})})}_getProperties(t,n){this._session.post("Runtime.getProperties",{objectId:t,ownProperties:!0},(r,o)=>{n(r?[]:o.result)})}_unrollArray(t,n,r,o){this._getProperties(t,s=>{r[n]=s.filter(i=>i.name!=="length"&&!isNaN(parseInt(i.name,10))).sort((i,a)=>parseInt(i.name,10)-parseInt(a.name,10)).map(i=>i.value?.value),o(r)})}_unrollObject(t,n,r,o){this._getProperties(t,s=>{r[n]=s.map(i=>[i.name,i.value?.value]).reduce((i,[a,c])=>(i[a]=c,i),{}),o(r)})}_unrollOther(t,n,r){t.value&&("value"in t.value?t.value.value===void 0||t.value.value===null?n[t.name]=`<${t.value.value}>`:n[t.name]=t.value.value:"description"in t.value&&t.value.type!=="function"?n[t.name]=`<${t.value.description}>`:t.value.type==="undefined"&&(n[t.name]="<undefined>")),r(n)}}const _F="LocalVariables",pF=((e={},t)=>{const n=new ts(20);let r,o=!1;function s(l){const f=LP(l.stacktrace?.frames);if(f===void 0)return;const d=n.remove(f);if(d===void 0)return;const u=(l.stacktrace?.frames||[]).filter(_=>_.function!=="new Promise");for(let _=0;_<u.length;_++){const p=u.length-_-1,E=d[_],T=u[p];if(!T||!E)break;E.vars===void 0||T.in_app===!1&&e.includeOutOfAppFrames!==!0||!vP(T.function,E.function)||(T.vars=E.vars)}}function i(l){for(const f of l.exception?.values||[])s(f);return l}let a;async function c(){const f=Te()?.getOptions();if(!f?.includeLocalVariables)return;if(Do<18){x.log("The `LocalVariables` integration is only supported on Node >= v18.");return}if(await PP()){x.warn("Local variables capture has been disabled because the debugger was already enabled");return}try{const u=await KE.create(t),_=(E,{params:{reason:T,data:h,callFrames:m}},A)=>{if(T!=="exception"&&T!=="promiseRejection"){A();return}r?.();const g=fF(E,h.description);if(g==null){A();return}const{add:R,next:O}=DP(C=>{n.set(g,C),A()});for(let C=0;C<Math.min(m.length,5);C++){const{scopeChain:I,functionName:L,this:U}=m[C],q=I.find($=>$.type==="local"),H=U.className==="global"||!U.className?L:`${U.className}.${L}`;if(q?.object.objectId===void 0)R($=>{$[C]={function:H},O($)});else{const $=q.object.objectId;R(B=>u.getLocalVariables($,F=>{B[C]={function:H,vars:F},O(B)}))}}O([])},p=e.captureAllExceptions!==!1;if(u.configureAndConnect((E,T)=>_(f.stackParser,E,T),p),p){const E=e.maxExceptionsPerSecond||50;r=uF(E,()=>{x.log("Local variables rate-limit lifted."),u.setPauseOnExceptions(!0)},T=>{x.log(`Local variables rate-limit exceeded. Disabling capturing of caught exceptions for ${T} seconds.`),u.setPauseOnExceptions(!1)})}o=!0}catch(u){x.log("The `LocalVariables` integration failed to start.",u)}}return{name:_F,setupOnce(){a=c()},async processEvent(l){return await a,o?i(l):l},_getCachedFramesCount(){return n.size},_getFirstCachedFrame(){return n.values()[0]}}}),EF=pF,TF=(e={})=>bl.major<19?EF(e):dF(e);function zE(){try{return typeof module<"u"&&typeof module.exports<"u"}catch{return!1}}let cR;function hF(){return zE()?!1:Do>=21||Do===20&&Ip>=6||Do===18&&Ip>=19?!0:(cR||(cR=!0,sn(()=>{console.warn(`[Sentry] You are using Node.js v${process.versions.node} in ESM mode ("import syntax"). The Sentry Node.js SDK is not compatible with ESM in Node.js versions before 18.19.0 or before 20.6.0. Please either build your application with CommonJS ("require() syntax"), or upgrade your Node.js version.`)})),!1)}let Pd;const SF="Modules",mF=typeof __SENTRY_SERVER_MODULES__>"u"?{}:__SENTRY_SERVER_MODULES__,AF=(()=>({name:SF,processEvent(e){return e.modules={...e.modules,...uR()},e},getModules:uR})),gF=AF;function RF(){try{return require.cache?Object.keys(require.cache):[]}catch{return[]}}function NF(){return{...mF,...bF(),...zE()?yF():{}}}function yF(){const e=require.main?.paths||[],t=RF(),n={},r=new Set;return t.forEach(o=>{let s=o;const i=()=>{const a=s;if(s=le.dirname(a),!s||a===s||r.has(a))return;if(e.indexOf(s)<0)return i();const c=le.join(a,"package.json");if(r.add(a),!de.existsSync(c))return i();try{const l=JSON.parse(de.readFileSync(c,"utf8"));n[l.name]=l.version}catch{}};i()}),n}function uR(){return Pd||(Pd=NF()),Pd}function OF(){try{const e=le.join(process.cwd(),"package.json");return JSON.parse(de.readFileSync(e,"utf8"))}catch{return{}}}function bF(){const e=OF();return{...e.dependencies,...e.devDependencies}}const IF=2e3;function Pp(e){sn(()=>{console.error(e)});const t=Te();if(t===void 0){Ce&&x.warn("No NodeClient was defined, we are exiting the process now."),global.process.exit(1);return}const n=t.getOptions(),r=n?.shutdownTimeout&&n.shutdownTimeout>0?n.shutdownTimeout:IF;t.close(r).then(o=>{o||Ce&&x.warn("We reached the timeout for emptying the request buffer, still exiting now!"),global.process.exit(1)},o=>{Ce&&x.error(o)})}const CF="OnUncaughtException",MF=(e={})=>{const t={exitEvenIfOtherHandlersAreRegistered:!1,...e};return{name:CF,setup(n){global.process.on("uncaughtException",PF(n,t))}}};function PF(e,t){let r=!1,o=!1,s=!1,i;const a=e.getOptions();return Object.assign(c=>{let l=Pp;t.onFatalError?l=t.onFatalError:a.onFatalError&&(l=a.onFatalError);const d=global.process.listeners("uncaughtException").filter(_=>_.name!=="domainUncaughtExceptionClear"&&_.tag!=="sentry_tracingErrorCallback"&&_._errorHandler!==!0).length===0,u=t.exitEvenIfOtherHandlersAreRegistered||d;r?u&&(s?(Ce&&x.warn("uncaught exception after calling fatal error shutdown callback - this is bad! forcing shutdown"),Pp(c)):o||(o=!0,setTimeout(()=>{s||(s=!0,l(i,c))},2e3))):(i=c,r=!0,Te()===e&&xe(c,{originalException:c,captureContext:{level:"fatal"},mechanism:{handled:!1,type:"auto.node.onuncaughtexception"}}),!s&&u&&(s=!0,l(c)))},{_errorHandler:!0})}const vF="OnUnhandledRejection",LF=[{name:"AI_NoOutputGeneratedError"}],DF=((e={})=>{const t={mode:e.mode??"warn",ignore:[...LF,...e.ignore??[]]};return{name:vF,setup(n){global.process.on("unhandledRejection",VF(n,t))}}}),wF=DF;function UF(e){if(typeof e!="object"||e===null)return{name:"",message:String(e??"")};const t=e,n=typeof t.name=="string"?t.name:"",r=typeof t.message=="string"?t.message:String(e);return{name:n,message:r}}function kF(e,t){const n=e.name===void 0||vo(t.name,e.name,!0),r=e.message===void 0||vo(t.message,e.message);return n&&r}function GF(e,t){const n=UF(t);return e.some(r=>kF(r,n))}function VF(e,t){return function(r,o){if(Te()!==e||GF(t.ignore??[],r))return;const s=t.mode==="strict"?"fatal":"error",i=r&&typeof r=="object"?r._sentry_active_span:void 0;(i?c=>oM(i,c):c=>c())(()=>{xe(r,{originalException:o,captureContext:{extra:{unhandledPromiseRejection:!0},level:s},mechanism:{handled:!1,type:"auto.node.onunhandledrejection"}})}),xF(r,t.mode)}}function xF(e,t){const n="This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). The promise rejected with the reason:";t==="warn"?sn(()=>{console.warn(n),console.error(e&&typeof e=="object"&&"stack"in e?e.stack:e)}):t==="strict"&&(sn(()=>{console.warn(n)}),Pp(e))}const wP="Spotlight",$F=((e={})=>{const t={sidecarUrl:e.sidecarUrl||"http://localhost:8969/stream"};return{name:wP,setup(n){try{process.env.NODE_ENV&&process.env.NODE_ENV!=="development"&&x.warn("[Spotlight] It seems you're not in dev mode. Do you really want to have Spotlight enabled?")}catch{}HF(n,t)}}}),BF=$F;function HF(e,t){const n=FF(t.sidecarUrl);if(!n)return;let r=0;e.on("beforeEnvelope",o=>{if(r>3){x.warn("[Spotlight] Disabled Sentry -> Spotlight integration due to too many failed requests");return}const s=JC(o);sM(()=>{const i=su.request({method:"POST",path:n.pathname,hostname:n.hostname,port:n.port,headers:{"Content-Type":"application/x-sentry-envelope"}},a=>{a.statusCode&&a.statusCode>=200&&a.statusCode<400&&(r=0),a.on("data",()=>{}),a.on("end",()=>{}),a.setEncoding("utf8")});i.on("error",()=>{r++,x.warn("[Spotlight] Failed to send envelope to Spotlight Sidecar")}),i.write(s),i.end()})})}function FF(e){try{return new URL(`${e}`)}catch{x.warn(`[Spotlight] Invalid sidecar URL: ${e}`);return}}const YF="NodeSystemError";function jF(e){return!(e instanceof Error)||!("errno"in e)||typeof e.errno!="number"?!1:UD.getSystemErrorMap().has(e.errno)}const qF=(e={})=>({name:YF,processEvent:(t,n,r)=>{if(!jF(n.originalException))return t;const o=n.originalException,s={...o};!r.getOptions().sendDefaultPii&&e.includePaths!==!0&&(delete s.path,delete s.dest),t.contexts={...t.contexts,node_system_error:s};for(const i of t.exception?.values||[])i.value&&(o.path&&i.value.includes(o.path)&&(i.value=i.value.replace(`'${o.path}'`,"").trim()),o.dest&&i.value.includes(o.dest)&&(i.value=i.value.replace(`'${o.dest}'`,"").trim()));return t}}),WF="ChildProcess",KF=(e={})=>({name:WF,setup(){ou.channel("child_process").subscribe(t=>{t&&typeof t=="object"&&"process"in t&&zF(t.process,e)}),ou.channel("worker_threads").subscribe(t=>{t&&typeof t=="object"&&"worker"in t&&ZF(t.worker,e)})}});function zF(e,t){let n=!1,r;e.on("spawn",()=>{if(e.spawnfile==="/usr/bin/sw_vers"){n=!0;return}r={spawnfile:e.spawnfile},t.includeChildProcessArgs&&(r.spawnargs=e.spawnargs)}).on("exit",o=>{n||(n=!0,o!==null&&o!==0&&$o({category:"child_process",message:`Child process exited with code '${o}'`,level:o===0?"info":"warning",data:r}))}).on("error",o=>{n||(n=!0,$o({category:"child_process",message:`Child process errored with '${o.message}'`,level:"error",data:r}))})}function ZF(e,t){let n;e.on("online",()=>{n=e.threadId}).on("error",r=>{t.captureWorkerErrors!==!1?xe(r,{mechanism:{type:"auto.child_process.worker_thread",handled:!1,data:{threadId:String(n)}}}):$o({category:"worker_thread",message:`Worker thread errored with '${r.message}'`,level:"error",data:{threadId:n}})})}var vd={},sa={},ia={},lR;function UP(){if(lR)return ia;lR=1,Object.defineProperty(ia,"__esModule",{value:!0}),ia.AbstractAsyncHooksContextManager=void 0;const e=zu,t=["addListener","on","once","prependListener","prependOnceListener"];let n=class{bind(o,s){return s instanceof e.EventEmitter?this._bindEventEmitter(o,s):typeof s=="function"?this._bindFunction(o,s):s}_bindFunction(o,s){const i=this,a=function(...c){return i.with(o,()=>s.apply(this,c))};return Object.defineProperty(a,"length",{enumerable:!1,configurable:!0,writable:!1,value:s.length}),a}_bindEventEmitter(o,s){return this._getPatchMap(s)!==void 0||(this._createPatchMap(s),t.forEach(a=>{s[a]!==void 0&&(s[a]=this._patchAddListener(s,s[a],o))}),typeof s.removeListener=="function"&&(s.removeListener=this._patchRemoveListener(s,s.removeListener)),typeof s.off=="function"&&(s.off=this._patchRemoveListener(s,s.off)),typeof s.removeAllListeners=="function"&&(s.removeAllListeners=this._patchRemoveAllListeners(s,s.removeAllListeners))),s}_patchRemoveListener(o,s){const i=this;return function(a,c){const l=i._getPatchMap(o)?.[a];if(l===void 0)return s.call(this,a,c);const f=l.get(c);return s.call(this,a,f||c)}}_patchRemoveAllListeners(o,s){const i=this;return function(a){const c=i._getPatchMap(o);return c!==void 0&&(arguments.length===0?i._createPatchMap(o):c[a]!==void 0&&delete c[a]),s.apply(this,arguments)}}_patchAddListener(o,s,i){const a=this;return function(c,l){if(a._wrapped)return s.call(this,c,l);let f=a._getPatchMap(o);f===void 0&&(f=a._createPatchMap(o));let d=f[c];d===void 0&&(d=new WeakMap,f[c]=d);const u=a.bind(i,l);d.set(l,u),a._wrapped=!0;try{return s.call(this,c,u)}finally{a._wrapped=!1}}}_createPatchMap(o){const s=Object.create(null);return o[this._kOtListeners]=s,s}_getPatchMap(o){return o[this._kOtListeners]}_kOtListeners=Symbol("OtListeners");_wrapped=!1};return ia.AbstractAsyncHooksContextManager=n,ia}var dR;function XF(){if(dR)return sa;dR=1,Object.defineProperty(sa,"__esModule",{value:!0}),sa.AsyncHooksContextManager=void 0;const e=Me(),t=$I,n=UP();let r=class extends n.AbstractAsyncHooksContextManager{_asyncHook;_contexts=new Map;_stack=[];constructor(){super(),this._asyncHook=t.createHook({init:this._init.bind(this),before:this._before.bind(this),after:this._after.bind(this),destroy:this._destroy.bind(this),promiseResolve:this._destroy.bind(this)})}active(){return this._stack[this._stack.length-1]??e.ROOT_CONTEXT}with(s,i,a,...c){this._enterContext(s);try{return i.call(a,...c)}finally{this._exitContext()}}enable(){return this._asyncHook.enable(),this}disable(){return this._asyncHook.disable(),this._contexts.clear(),this._stack=[],this}_init(s,i){if(i==="TIMERWRAP")return;const a=this._stack[this._stack.length-1];a!==void 0&&this._contexts.set(s,a)}_destroy(s){this._contexts.delete(s)}_before(s){const i=this._contexts.get(s);i!==void 0&&this._enterContext(i)}_after(){this._exitContext()}_enterContext(s){this._stack.push(s)}_exitContext(){this._stack.pop()}};return sa.AsyncHooksContextManager=r,sa}var aa={},fR;function QF(){if(fR)return aa;fR=1,Object.defineProperty(aa,"__esModule",{value:!0}),aa.AsyncLocalStorageContextManager=void 0;const e=Me(),t=$I,n=UP();let r=class extends n.AbstractAsyncHooksContextManager{_asyncLocalStorage;constructor(){super(),this._asyncLocalStorage=new t.AsyncLocalStorage}active(){return this._asyncLocalStorage.getStore()??e.ROOT_CONTEXT}with(s,i,a,...c){const l=a==null?i:i.bind(a);return this._asyncLocalStorage.run(s,l,...c)}enable(){return this}disable(){return this._asyncLocalStorage.disable(),this}};return aa.AsyncLocalStorageContextManager=r,aa}var _R;function JF(){return _R||(_R=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncLocalStorageContextManager=e.AsyncHooksContextManager=void 0;var t=XF();Object.defineProperty(e,"AsyncHooksContextManager",{enumerable:!0,get:function(){return t.AsyncHooksContextManager}});var n=QF();Object.defineProperty(e,"AsyncLocalStorageContextManager",{enumerable:!0,get:function(){return n.AsyncLocalStorageContextManager}})})(vd)),vd}var eY=JF();const tY=rH(eY.AsyncLocalStorageContextManager);function nY(){b.diag.disable(),b.diag.setLogger({error:x.error,warn:x.warn,info:x.log,debug:x.log,verbose:x.log},b.DiagLogLevel.DEBUG)}const rY="ProcessSession",oY=()=>({name:rY,setupOnce(){z1(),process.on("beforeExit",()=>{je().getSession()?.status!=="ok"&&lM()})}}),fn=Symbol("AgentBaseInternalState");class sY extends su.Agent{constructor(t){super(t),this[fn]={}}isSecureEndpoint(t){if(t){if(typeof t.secureEndpoint=="boolean")return t.secureEndpoint;if(typeof t.protocol=="string")return t.protocol==="https:"}const{stack:n}=new Error;return typeof n!="string"?!1:n.split(`
`).some(r=>r.indexOf("(https.js:")!==-1||r.indexOf("node:https:")!==-1)}createSocket(t,n,r){const o={...n,secureEndpoint:this.isSecureEndpoint(n)};Promise.resolve().then(()=>this.connect(t,o)).then(s=>{if(s instanceof su.Agent)return s.addRequest(t,o);this[fn].currentSocket=s,super.createSocket(t,n,r)},r)}createConnection(){const t=this[fn].currentSocket;if(this[fn].currentSocket=void 0,!t)throw new Error("No socket was returned in the `connect()` function");return t}get defaultPort(){return this[fn].defaultPort??(this.protocol==="https:"?443:80)}set defaultPort(t){this[fn]&&(this[fn].defaultPort=t)}get protocol(){return this[fn].protocol??(this.isSecureEndpoint()?"https:":"http:")}set protocol(t){this[fn]&&(this[fn].protocol=t)}}function Vc(...e){x.log("[https-proxy-agent:parse-proxy-response]",...e)}function iY(e){return new Promise((t,n)=>{let r=0;const o=[];function s(){const f=e.read();f?l(f):e.once("readable",s)}function i(){e.removeListener("end",a),e.removeListener("error",c),e.removeListener("readable",s)}function a(){i(),Vc("onend"),n(new Error("Proxy connection ended before receiving CONNECT response"))}function c(f){i(),Vc("onerror %o",f),n(f)}function l(f){o.push(f),r+=f.length;const d=Buffer.concat(o,r),u=d.indexOf(`\r
\r
`);if(u===-1){Vc("have not received end of HTTP headers yet..."),s();return}const _=d.subarray(0,u).toString("ascii").split(`\r
`),p=_.shift();if(!p)return e.destroy(),n(new Error("No header received from proxy CONNECT response"));const E=p.split(" "),T=+(E[1]||0),h=E.slice(2).join(" "),m={};for(const A of _){if(!A)continue;const g=A.indexOf(":");if(g===-1)return e.destroy(),n(new Error(`Invalid header from proxy CONNECT response: "${A}"`));const R=A.slice(0,g).toLowerCase(),O=A.slice(g+1).trimStart(),C=m[R];typeof C=="string"?m[R]=[C,O]:Array.isArray(C)?C.push(O):m[R]=O}Vc("got proxy server response: %o %o",p,m),i(),t({connect:{statusCode:T,statusText:h,headers:m},buffered:d})}e.on("error",c),e.on("end",a),s()})}function ca(...e){x.log("[https-proxy-agent]",...e)}class kP extends sY{static __initStatic(){this.protocols=["http","https"]}constructor(t,n){super(n),this.options={},this.proxy=typeof t=="string"?new URL(t):t,this.proxyHeaders=n?.headers??{},ca("Creating new HttpsProxyAgent instance: %o",this.proxy.href);const r=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),o=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...n?pR(n,"headers"):null,host:r,port:o}}async connect(t,n){const{proxy:r}=this;if(!n.host)throw new TypeError('No "host" provided');let o;if(r.protocol==="https:"){ca("Creating `tls.Socket`: %o",this.connectOpts);const u=this.connectOpts.servername||this.connectOpts.host;o=tm.connect({...this.connectOpts,servername:u&&Ro.isIP(u)?void 0:u})}else ca("Creating `net.Socket`: %o",this.connectOpts),o=Ro.connect(this.connectOpts);const s=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders},i=Ro.isIPv6(n.host)?`[${n.host}]`:n.host;let a=`CONNECT ${i}:${n.port} HTTP/1.1\r
`;if(r.username||r.password){const u=`${decodeURIComponent(r.username)}:${decodeURIComponent(r.password)}`;s["Proxy-Authorization"]=`Basic ${Buffer.from(u).toString("base64")}`}s.Host=`${i}:${n.port}`,s["Proxy-Connection"]||(s["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(const u of Object.keys(s))a+=`${u}: ${s[u]}\r
`;const c=iY(o);o.write(`${a}\r
`);const{connect:l,buffered:f}=await c;if(t.emit("proxyConnect",l),this.emit("proxyConnect",l,t),l.statusCode===200){if(t.once("socket",aY),n.secureEndpoint){ca("Upgrading socket connection to TLS");const u=n.servername||n.host;return tm.connect({...pR(n,"host","path","port"),socket:o,servername:Ro.isIP(u)?void 0:u})}return o}o.destroy();const d=new Ro.Socket({writable:!1});return d.readable=!0,t.once("socket",u=>{ca("Replaying proxy buffer for failed request"),u.push(f),u.push(null)}),d}}kP.__initStatic();function aY(e){e.resume()}function pR(e,...t){const n={};let r;for(r in e)t.includes(r)||(n[r]=e[r]);return n}const cY=1024*32;function uY(e){return new LD.Readable({read(){this.push(e),this.push(null)}})}function lY(e){let t;try{t=new URL(e.url)}catch{return sn(()=>{console.warn("[@sentry/node]: Invalid dsn or tunnel option, will not send any events. The tunnel option must be a full URL when used.")}),_g(e,()=>Promise.resolve({}))}const n=t.protocol==="https:",r=dY(t,e.proxy||(n?process.env.https_proxy:void 0)||process.env.http_proxy),o=n?GD:su,s=e.keepAlive===void 0?!1:e.keepAlive,i=r?new kP(r):new o.Agent({keepAlive:s,maxSockets:30,timeout:2e3}),a=fY(e,e.httpModule??o,i);return _g(e,a)}function dY(e,t){const{no_proxy:n}=process.env;if(!n?.split(",").some(o=>e.host.endsWith(o)||e.hostname.endsWith(o)))return t}function fY(e,t,n){const{hostname:r,pathname:o,port:s,protocol:i,search:a}=new URL(e.url);return function(l){return new Promise((f,d)=>{sM(()=>{let u=uY(l.body);const _={...e.headers};l.body.length>cY&&(_["content-encoding"]="gzip",u=u.pipe(DD.createGzip()));const p=t.request({method:"POST",agent:n,headers:_,hostname:r,path:`${o}${a}`,port:s,protocol:i,ca:e.caCerts},E=>{E.on("data",()=>{}),E.on("end",()=>{}),E.setEncoding("utf8");const T=E.headers["retry-after"]??null,h=E.headers["x-sentry-rate-limits"]??null;f({statusCode:E.statusCode,headers:{"retry-after":T,"x-sentry-rate-limits":Array.isArray(h)?h[0]||null:h}})});p.on("error",d),u.pipe(p)})})}}const _Y=new Set(["false","f","n","no","off","0"]),pY=new Set(["true","t","y","yes","on","1"]);function vp(e,t){const n=String(e).toLowerCase();return _Y.has(n)?!1:pY.has(n)?!0:t?.strict?null:!!e}function ER(e){return e.replace(/^[A-Z]:/,"").replace(/\\/g,"/")}function EY(e=process.argv[1]?DV(process.argv[1]):process.cwd(),t=le.sep==="\\"){const n=t?ER(e):e;return r=>{if(!r)return;const o=t?ER(r):r;let{dir:s,base:i,ext:a}=le.posix.parse(o);(a===".js"||a===".mjs"||a===".cjs")&&(i=i.slice(0,a.length*-1));const c=decodeURIComponent(i);s||(s=".");const l=s.lastIndexOf("/node_modules");if(l>-1)return`${s.slice(l+14).replace(/\//g,".")}:${c}`;if(s.startsWith(n)){const f=s.slice(n.length+1).replace(/\//g,".");return f?`${f}:${c}`:c}return c}}function TY(e){if(process.env.SENTRY_RELEASE)return process.env.SENTRY_RELEASE;if(ye.SENTRY_RELEASE?.id)return ye.SENTRY_RELEASE.id;const t=process.env.GITHUB_SHA||process.env.CI_MERGE_REQUEST_SOURCE_BRANCH_SHA||process.env.CI_BUILD_REF||process.env.CI_COMMIT_SHA||process.env.BITBUCKET_COMMIT,n=process.env.APPVEYOR_PULL_REQUEST_HEAD_COMMIT||process.env.APPVEYOR_REPO_COMMIT||process.env.CODEBUILD_RESOLVED_SOURCE_VERSION||process.env.AWS_COMMIT_ID||process.env.BUILD_SOURCEVERSION||process.env.GIT_CLONE_COMMIT_HASH||process.env.BUDDY_EXECUTION_REVISION||process.env.BUILDKITE_COMMIT||process.env.CIRCLE_SHA1||process.env.CIRRUS_CHANGE_IN_REPO||process.env.CF_REVISION||process.env.CM_COMMIT||process.env.CF_PAGES_COMMIT_SHA||process.env.DRONE_COMMIT_SHA||process.env.FC_GIT_COMMIT_SHA||process.env.HEROKU_TEST_RUN_COMMIT_VERSION||process.env.HEROKU_SLUG_COMMIT||process.env.RAILWAY_GIT_COMMIT_SHA||process.env.RENDER_GIT_COMMIT||process.env.SEMAPHORE_GIT_SHA||process.env.TRAVIS_PULL_REQUEST_SHA||process.env.VERCEL_GIT_COMMIT_SHA||process.env.VERCEL_GITHUB_COMMIT_SHA||process.env.VERCEL_GITLAB_COMMIT_SHA||process.env.VERCEL_BITBUCKET_COMMIT_SHA||process.env.ZEIT_GITHUB_COMMIT_SHA||process.env.ZEIT_GITLAB_COMMIT_SHA||process.env.ZEIT_BITBUCKET_COMMIT_SHA,r=process.env.CI_COMMIT_ID||process.env.SOURCE_COMMIT||process.env.SOURCE_VERSION||process.env.GIT_COMMIT||process.env.COMMIT_REF||process.env.BUILD_VCS_NUMBER||process.env.CI_COMMIT_SHA;return t||n||r||e}const hY=vC(z$(EY())),SY=6e4;class mY extends kG{constructor(t){const n=t.includeServerName===!1?void 0:t.serverName||global.process.env.SENTRY_NAME||Lt.hostname(),r={...t,platform:"node",runtime:{name:"node",version:global.process.version},serverName:n};t.openTelemetryInstrumentations&&rl({instrumentations:t.openTelemetryInstrumentations}),vE(r,"node"),x.log(`Initializing Sentry: process: ${process.pid}, thread: ${tp.isMainThread?"main":`worker-${tp.threadId}`}.`),super(r),this.getOptions().enableLogs&&(this._logOnExitFlushListener=()=>{fM(this)},n&&this.on("beforeCaptureLog",o=>{o.attributes={...o.attributes,"server.address":n}}),process.on("beforeExit",this._logOnExitFlushListener))}get tracer(){if(this._tracer)return this._tracer;const t="@sentry/node",n=Ze,r=b.trace.getTracer(t,n);return this._tracer=r,r}async flush(t){return await this.traceProvider?.forceFlush(),this.getOptions().sendClientReports&&this._flushOutcomes(),super.flush(t)}async close(t){this._clientReportInterval&&clearInterval(this._clientReportInterval),this._clientReportOnExitFlushListener&&process.off("beforeExit",this._clientReportOnExitFlushListener),this._logOnExitFlushListener&&process.off("beforeExit",this._logOnExitFlushListener);const n=await super.close(t);return this.traceProvider&&await this.traceProvider.shutdown(),n}startClientReportTracking(){const t=this.getOptions();t.sendClientReports&&(this._clientReportOnExitFlushListener=()=>{this._flushOutcomes()},this._clientReportInterval=setInterval(()=>{Ce&&x.log("Flushing client reports based on interval."),this._flushOutcomes()},t.clientReportFlushInterval??SY).unref(),process.on("beforeExit",this._clientReportOnExitFlushListener))}_setupIntegrations(){VG(),super._setupIntegrations()}_getTraceInfoFromScope(t){return t?QB(this,t):[void 0,void 0]}}function AY(){if(hF()&&!ye._sentryEsmLoaderHookRegistered){ye._sentryEsmLoaderHookRegistered=!0;try{const{addHookMessagePort:e}=bC.createAddHookMessageChannel();kD.register("import-in-the-middle/hook.mjs",typeof document>"u"?require("url").pathToFileURL(__filename).href:jl&&jl.tagName.toUpperCase()==="SCRIPT"&&jl.src||new URL("worker.js",document.baseURI).href,{data:{addHookMessagePort:e,include:[]},transferList:[e]})}catch(e){x.warn("Failed to register 'import-in-the-middle' hook",e)}}}function GP(){return[rV(),JG(),TV(),yV(),qF(),xV(),OH(),vH(),MF(),wF(),cF(),TF(),kH(),KF(),oY(),gF()]}function gY(e={}){return RY(e,GP)}function RY(e={},t){const n=yY(e,t);n.debug===!0&&(Ce?x.enable():sn(()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")})),n.registerEsmLoaderHooks!==!1&&AY(),nH(),Ke().update(n.initialScope),n.spotlight&&!n.integrations.some(({name:s})=>s===wP)&&n.integrations.push(BF({sidecarUrl:typeof n.spotlight=="string"?n.spotlight:void 0})),vE(n,"node-core");const o=new mY(n);return Ke().setClient(o),o.init(),ye._sentryInjectLoaderHookRegister?.(),x.log(`SDK initialized from ${zE()?"CommonJS":"ESM"}`),o.startClientReportTracking(),IY(),xB(o),eH(o),o}function NY(){if(!Ce)return;const e=$B(),t=["SentryContextManager","SentryPropagator"];Kt()&&t.push("SentrySpanProcessor");for(const n of t)e.includes(n)||x.error(`You have to set up the ${n}. Without this, the OpenTelemetry & Sentry integration will not work properly.`);e.includes("SentrySampler")||x.warn("You have to set up the SentrySampler. Without this, the OpenTelemetry & Sentry integration may still work, but sample rates set for the Sentry SDK will not be respected. If you use a custom sampler, make sure to use `wrapSamplingDecision`.")}function yY(e,t){const n=OY(e.release);let r;if(e.spotlight===!1)r=!1;else if(typeof e.spotlight=="string")r=e.spotlight;else{const c=vp(process.env.SENTRY_SPOTLIGHT,{strict:!0}),l=c===null&&process.env.SENTRY_SPOTLIGHT?process.env.SENTRY_SPOTLIGHT:void 0;r=e.spotlight===!0?l??!0:c??l}const o=bY(e.tracesSampleRate),s={...e,dsn:e.dsn??process.env.SENTRY_DSN,environment:e.environment??process.env.SENTRY_ENVIRONMENT,sendClientReports:e.sendClientReports??!0,transport:e.transport??lY,stackParser:qU(e.stackParser||hY),release:n,tracesSampleRate:o,spotlight:r,debug:vp(e.debug??process.env.SENTRY_DEBUG)},i=e.integrations,a=e.defaultIntegrations??t(s);return{...s,integrations:rG({defaultIntegrations:a,integrations:i})}}function OY(e){if(e!==void 0)return e;const t=TY();if(t!==void 0)return t}function bY(e){if(e!==void 0)return e;const t=process.env.SENTRY_TRACES_SAMPLE_RATE;if(!t)return;const n=parseFloat(t);return isFinite(n)?n:void 0}function IY(){if(vp(process.env.SENTRY_USE_ENVIRONMENT)!==!1){const e=process.env.SENTRY_TRACE,t=process.env.SENTRY_BAGGAGE,n=WC(e,t);Ke().setPropagationContext(n)}}function Nt(e,t){e.setAttribute(Ge,t)}const ZE="Http",TR="@opentelemetry_sentry-patched/instrumentation-http",CY=Ne(`${ZE}.sentry`,e=>new yP(e)),MY=Ne(ZE,e=>{const t=new xU.HttpInstrumentation({...e,disableIncomingRequestInstrumentation:!0});try{t._diag=b.diag.createComponentLogger({namespace:TR}),t.instrumentationName=TR}catch{}return t});function PY(e,t={}){return typeof e.spans=="boolean"?e.spans:!(t.skipOpenTelemetrySetup||!Kt(t)&&bl.major>=22)}const vY=(e={})=>{const t=e.spans??!0,n=e.disableIncomingRequestSpans,r={sessions:e.trackIncomingRequestsAsSessions,sessionFlushingDelayMS:e.sessionFlushingDelayMS,ignoreRequestBody:e.ignoreIncomingRequestBody,maxRequestBodySize:e.maxIncomingRequestBodySize},o={ignoreIncomingRequests:e.ignoreIncomingRequests,ignoreStaticAssets:e.ignoreStaticAssets,ignoreStatusCodes:e.dropSpansForIncomingRequestStatusCodes,instrumentation:e.instrumentation,onSpanCreated:e.incomingRequestSpanHook},s=qM(r),i=WM(o),a=t&&!n;return{name:ZE,setup(c){const l=c.getOptions();a&&Kt(l)&&i.setup(c)},setupOnce(){const c=Te()?.getOptions()||{},l=PY(e,c);s.setupOnce();const f={breadcrumbs:e.breadcrumbs,propagateTraceInOutgoingRequests:!l,ignoreOutgoingRequests:e.ignoreOutgoingRequests};if(CY(f),l){const d=LY(e);MY(d)}},processEvent(c){return i.processEvent(c)}}};function LY(e={}){return{ignoreOutgoingRequestHook:n=>{const r=KM(n);if(!r)return!1;const o=e.ignoreOutgoingRequests;return!!o?.(r,n)},requireParentforOutgoingSpans:!1,requestHook:(n,r)=>{Nt(n,"auto.http.otel.http"),e.instrumentation?.requestHook?.(n,r)},responseHook:(n,r)=>{e.instrumentation?.responseHook?.(n,r)},applyCustomAttributesOnSpan:(n,r,o)=>{e.instrumentation?.applyCustomAttributesOnSpan?.(n,r,o)}}}var Ld={},ua={},Nr={},hR;function DY(){return hR||(hR=1,Object.defineProperty(Nr,"__esModule",{value:!0}),Nr.PACKAGE_NAME=Nr.PACKAGE_VERSION=void 0,Nr.PACKAGE_VERSION="0.19.0",Nr.PACKAGE_NAME="@opentelemetry/instrumentation-undici"),Nr}var SR;function wY(){if(SR)return ua;SR=1,Object.defineProperty(ua,"__esModule",{value:!0}),ua.UndiciInstrumentation=void 0;const e=xI,t=Zu,n=Le,r=Me(),o=ln,s=_t(),i=DY();class a extends n.InstrumentationBase{_recordFromReq=new WeakMap;constructor(l={}){super(i.PACKAGE_NAME,i.PACKAGE_VERSION,l)}init(){}disable(){super.disable(),this._channelSubs.forEach(l=>l.unsubscribe()),this._channelSubs.length=0}enable(){super.enable(),this._channelSubs=this._channelSubs||[],!(this._channelSubs.length>0)&&(this.subscribeToChannel("undici:request:create",this.onRequestCreated.bind(this)),this.subscribeToChannel("undici:client:sendHeaders",this.onRequestHeaders.bind(this)),this.subscribeToChannel("undici:request:headers",this.onResponseHeaders.bind(this)),this.subscribeToChannel("undici:request:trailers",this.onDone.bind(this)),this.subscribeToChannel("undici:request:error",this.onError.bind(this)))}_updateMetricInstruments(){this._httpClientDurationHistogram=this.meter.createHistogram(s.METRIC_HTTP_CLIENT_REQUEST_DURATION,{description:"Measures the duration of outbound HTTP requests.",unit:"s",valueType:r.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[.005,.01,.025,.05,.075,.1,.25,.5,.75,1,2.5,5,7.5,10]}})}subscribeToChannel(l,f){const[d,u]=process.version.replace("v","").split(".").map(E=>Number(E)),_=d>18||d===18&&u>=19;let p;if(_)e.subscribe?.(l,f),p=()=>e.unsubscribe?.(l,f);else{const E=e.channel(l);E.subscribe(f),p=()=>E.unsubscribe(f)}this._channelSubs.push({name:l,unsubscribe:p})}parseRequestHeaders(l){const f=new Map;if(Array.isArray(l.headers))for(let d=0;d<l.headers.length;d+=2){const u=l.headers[d],_=l.headers[d+1];typeof u=="string"&&f.set(u.toLowerCase(),_)}else if(typeof l.headers=="string"){const d=l.headers.split(`\r
`);for(const u of d){if(!u)continue;const _=u.indexOf(":");if(_===-1)continue;const p=u.substring(0,_).toLowerCase(),E=u.substring(_+1).trim(),T=f.get(p);T&&Array.isArray(T)?T.push(E):T?f.set(p,[T,E]):f.set(p,E)}}return f}onRequestCreated({request:l}){const f=this.getConfig(),d=f.enabled!==!1;if((0,n.safeExecuteInTheMiddle)(()=>!d||l.method==="CONNECT"||f.ignoreRequestHook?.(l),B=>B&&this._diag.error("caught ignoreRequestHook error: ",B),!0))return;const _=(0,o.hrTime)();let p;try{p=new t.URL(l.path,l.origin)}catch(B){this._diag.warn("could not determine url.full:",B);return}const E=p.protocol.replace(":",""),T=this.getRequestMethod(l.method),h={[s.ATTR_HTTP_REQUEST_METHOD]:T,[s.ATTR_HTTP_REQUEST_METHOD_ORIGINAL]:l.method,[s.ATTR_URL_FULL]:p.toString(),[s.ATTR_URL_PATH]:p.pathname,[s.ATTR_URL_QUERY]:p.search,[s.ATTR_URL_SCHEME]:E},m={https:"443",http:"80"},A=p.hostname,g=p.port||m[E];h[s.ATTR_SERVER_ADDRESS]=A,g&&!isNaN(Number(g))&&(h[s.ATTR_SERVER_PORT]=Number(g));const O=this.parseRequestHeaders(l).get("user-agent");if(O){const B=Array.isArray(O)?O[O.length-1]:O;h[s.ATTR_USER_AGENT_ORIGINAL]=B}const C=(0,n.safeExecuteInTheMiddle)(()=>f.startSpanHook?.(l),B=>B&&this._diag.error("caught startSpanHook error: ",B),!0);C&&Object.entries(C).forEach(([B,F])=>{h[B]=F});const I=r.context.active(),L=r.trace.getSpan(I);let U;f.requireParentforSpans&&(!L||!r.trace.isSpanContextValid(L.spanContext()))?U=r.trace.wrapSpanContext(r.INVALID_SPAN_CONTEXT):U=this.tracer.startSpan(T==="_OTHER"?"HTTP":T,{kind:r.SpanKind.CLIENT,attributes:h},I),(0,n.safeExecuteInTheMiddle)(()=>f.requestHook?.(U,l),B=>B&&this._diag.error("caught requestHook error: ",B),!0);const q=r.trace.setSpan(r.context.active(),U),H={};r.propagation.inject(q,H);const $=Object.entries(H);for(let B=0;B<$.length;B++){const[F,w]=$[B];typeof l.addHeader=="function"?l.addHeader(F,w):typeof l.headers=="string"?l.headers+=`${F}: ${w}\r
`:Array.isArray(l.headers)&&l.headers.push(F,w)}this._recordFromReq.set(l,{span:U,attributes:h,startTime:_})}onRequestHeaders({request:l,socket:f}){const d=this._recordFromReq.get(l);if(!d)return;const u=this.getConfig(),{span:_}=d,{remoteAddress:p,remotePort:E}=f,T={[s.ATTR_NETWORK_PEER_ADDRESS]:p,[s.ATTR_NETWORK_PEER_PORT]:E};if(u.headersToSpanAttributes?.requestHeaders){const h=new Set(u.headersToSpanAttributes.requestHeaders.map(A=>A.toLowerCase())),m=this.parseRequestHeaders(l);for(const[A,g]of m.entries())if(h.has(A)){const R=Array.isArray(g)?g.join(", "):g;T[`http.request.header.${A}`]=R}}_.setAttributes(T)}onResponseHeaders({request:l,response:f}){const d=this._recordFromReq.get(l);if(!d)return;const{span:u,attributes:_}=d,p={[s.ATTR_HTTP_RESPONSE_STATUS_CODE]:f.statusCode},E=this.getConfig();(0,n.safeExecuteInTheMiddle)(()=>E.responseHook?.(u,{request:l,response:f}),h=>h&&this._diag.error("caught responseHook error: ",h),!0);const T=new Set;E.headersToSpanAttributes?.responseHeaders&&E.headersToSpanAttributes?.responseHeaders.forEach(h=>T.add(h.toLowerCase()));for(let h=0;h<f.headers.length;h=h+2){const m=f.headers[h].toString().toLowerCase(),A=f.headers[h+1];if(T.has(m)&&(p[`http.response.header.${m}`]=A.toString()),m==="content-length"){const g=Number(A.toString());isNaN(g)||(p["http.response.header.content-length"]=g)}}u.setAttributes(p),u.setStatus({code:f.statusCode>=400?r.SpanStatusCode.ERROR:r.SpanStatusCode.UNSET}),d.attributes=Object.assign(_,p)}onDone({request:l}){const f=this._recordFromReq.get(l);if(!f)return;const{span:d,attributes:u,startTime:_}=f;d.end(),this._recordFromReq.delete(l),this.recordRequestDuration(u,_)}onError({request:l,error:f}){const d=this._recordFromReq.get(l);if(!d)return;const{span:u,attributes:_,startTime:p}=d;u.recordException(f),u.setStatus({code:r.SpanStatusCode.ERROR,message:f.message}),u.end(),this._recordFromReq.delete(l),_[s.ATTR_ERROR_TYPE]=f.message,this.recordRequestDuration(_,p)}recordRequestDuration(l,f){const d={};[s.ATTR_HTTP_RESPONSE_STATUS_CODE,s.ATTR_HTTP_REQUEST_METHOD,s.ATTR_SERVER_ADDRESS,s.ATTR_SERVER_PORT,s.ATTR_URL_SCHEME,s.ATTR_ERROR_TYPE].forEach(p=>{p in l&&(d[p]=l[p])});const _=(0,o.hrTimeToMilliseconds)((0,o.hrTimeDuration)(f,(0,o.hrTime)()))/1e3;this._httpClientDurationHistogram.record(_,d)}getRequestMethod(l){const f={CONNECT:!0,OPTIONS:!0,HEAD:!0,GET:!0,POST:!0,PUT:!0,PATCH:!0,DELETE:!0,TRACE:!0};return l.toUpperCase()in f?l.toUpperCase():"_OTHER"}}return ua.UndiciInstrumentation=a,ua}var mR;function UY(){return mR||(mR=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.UndiciInstrumentation=void 0;var t=wY();Object.defineProperty(e,"UndiciInstrumentation",{enumerable:!0,get:function(){return t.UndiciInstrumentation}})})(Ld)),Ld}var kY=UY();const VP="NodeFetch",GY=Ne(VP,kY.UndiciInstrumentation,e=>FY(e)),VY=Ne(`${VP}.sentry`,bP,e=>e),xY=((e={})=>({name:"NodeFetch",setupOnce(){HY(e,Te()?.getOptions())&&GY(e),VY(e)}})),$Y=xY;function BY(e,t="/"){const n=`${e}`;return n.endsWith("/")&&t.startsWith("/")?`${n}${t.slice(1)}`:!n.endsWith("/")&&!t.startsWith("/")?`${n}/${t.slice(1)}`:`${n}${t}`}function HY(e,t={}){return typeof e.spans=="boolean"?e.spans:!t.skipOpenTelemetrySetup&&Kt(t)}function FY(e={}){return{requireParentforSpans:!1,ignoreRequestHook:n=>{const r=BY(n.origin,n.path),o=e.ignoreOutgoingRequests;return!!(o&&r&&o(r))},startSpanHook:()=>({[Ge]:"auto.http.otel.node_fetch"}),requestHook:e.requestHook,responseHook:e.responseHook}}var Dd={},la={},wd={},AR;function XE(){return AR||(AR=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ExpressLayerType=void 0,(function(t){t.ROUTER="router",t.MIDDLEWARE="middleware",t.REQUEST_HANDLER="request_handler"})(e.ExpressLayerType||(e.ExpressLayerType={}))})(wd)),wd}var Ud={},gR;function QE(){return gR||(gR=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,(function(t){t.EXPRESS_TYPE="express.type",t.EXPRESS_NAME="express.name"})(e.AttributeNames||(e.AttributeNames={}))})(Ud)),Ud}var kd={},yr={},RR;function xP(){return RR||(RR=1,Object.defineProperty(yr,"__esModule",{value:!0}),yr._LAYERS_STORE_PROPERTY=yr.kLayerPatched=void 0,yr.kLayerPatched=Symbol("express-layer-patched"),yr._LAYERS_STORE_PROPERTY="__ot_middlewares"),yr}var NR;function YY(){return NR||(NR=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getActualMatchedRoute=e.getConstructedRoute=e.getLayerPath=e.asErrorAndMessage=e.isLayerIgnored=e.getLayerMetadata=e.getRouterPath=e.storeLayerPath=void 0;const t=XE(),n=QE(),r=xP(),o=(E,T)=>(Array.isArray(E[r._LAYERS_STORE_PROPERTY])===!1&&Object.defineProperty(E,r._LAYERS_STORE_PROPERTY,{enumerable:!1,value:[]}),T===void 0?{isLayerPathStored:!1}:(E[r._LAYERS_STORE_PROPERTY].push(T),{isLayerPathStored:!0}));e.storeLayerPath=o;const s=(E,T)=>{const h=T.handle?.stack?.[0];return h?.route?.path?`${E}${h.route.path}`:h?.handle?.stack?(0,e.getRouterPath)(E,h):E};e.getRouterPath=s;const i=(E,T,h)=>{if(T.name==="router"){const m=(0,e.getRouterPath)("",T),A=m||h||E||"/";return{attributes:{[n.AttributeNames.EXPRESS_NAME]:A,[n.AttributeNames.EXPRESS_TYPE]:t.ExpressLayerType.ROUTER},name:`router - ${A}`}}else return T.name==="bound dispatch"||T.name==="handle"?{attributes:{[n.AttributeNames.EXPRESS_NAME]:(E||h)??"request handler",[n.AttributeNames.EXPRESS_TYPE]:t.ExpressLayerType.REQUEST_HANDLER},name:`request handler${T.path?` - ${E||h}`:""}`}:{attributes:{[n.AttributeNames.EXPRESS_NAME]:T.name,[n.AttributeNames.EXPRESS_TYPE]:t.ExpressLayerType.MIDDLEWARE},name:`middleware - ${T.name}`}};e.getLayerMetadata=i;const a=(E,T)=>{if(typeof T=="string")return T===E;if(T instanceof RegExp)return T.test(E);if(typeof T=="function")return T(E);throw new TypeError("Pattern is in unsupported datatype")},c=(E,T,h)=>{if(Array.isArray(h?.ignoreLayersType)&&h?.ignoreLayersType?.includes(T))return!0;if(Array.isArray(h?.ignoreLayers)===!1)return!1;try{for(const m of h.ignoreLayers)if(a(E,m))return!0}catch{}return!1};e.isLayerIgnored=c;const l=E=>E instanceof Error?[E,E.message]:[String(E),String(E)];e.asErrorAndMessage=l;const f=E=>{const T=E[0];return Array.isArray(T)?T.map(h=>d(h)||"").join(","):d(T)};e.getLayerPath=f;const d=E=>{if(typeof E=="string")return E;if(E instanceof RegExp||typeof E=="number")return E.toString()};function u(E){const h=(Array.isArray(E[r._LAYERS_STORE_PROPERTY])?E[r._LAYERS_STORE_PROPERTY]:[]).filter(m=>m!=="/"&&m!=="/*");return h.length===1&&h[0]==="*"?"*":h.join("").replace(/\/{2,}/g,"/")}e.getConstructedRoute=u;function _(E){const T=Array.isArray(E[r._LAYERS_STORE_PROPERTY])?E[r._LAYERS_STORE_PROPERTY]:[];if(T.length===0)return;if(T.every(g=>g==="/"))return E.originalUrl==="/"?"/":void 0;const h=u(E);if(h==="*"||h.includes("/")&&(h.includes(",")||h.includes("\\")||h.includes("*")||h.includes("[")))return h;const m=h.startsWith("/")?h:`/${h}`;return m.length>0&&(E.originalUrl===m||E.originalUrl.startsWith(m)||p(m))?m:void 0}e.getActualMatchedRoute=_;function p(E){return E.includes(":")||E.includes("*")}})(kd)),kd}var Or={},yR;function jY(){return yR||(yR=1,Object.defineProperty(Or,"__esModule",{value:!0}),Or.PACKAGE_NAME=Or.PACKAGE_VERSION=void 0,Or.PACKAGE_VERSION="0.57.0",Or.PACKAGE_NAME="@opentelemetry/instrumentation-express"),Or}var OR;function qY(){if(OR)return la;OR=1,Object.defineProperty(la,"__esModule",{value:!0}),la.ExpressInstrumentation=void 0;const e=ln,t=Me(),n=XE(),r=QE(),o=YY(),s=jY(),i=Le,a=_t(),c=xP();class l extends i.InstrumentationBase{constructor(d={}){super(s.PACKAGE_NAME,s.PACKAGE_VERSION,d)}init(){return[new i.InstrumentationNodeModuleDefinition("express",[">=4.0.0 <6"],d=>{const u=typeof d?.Router?.prototype?.route=="function",_=u?d.Router.prototype:d.Router;return(0,i.isWrapped)(_.route)&&this._unwrap(_,"route"),this._wrap(_,"route",this._getRoutePatch()),(0,i.isWrapped)(_.use)&&this._unwrap(_,"use"),this._wrap(_,"use",this._getRouterUsePatch()),(0,i.isWrapped)(d.application.use)&&this._unwrap(d.application,"use"),this._wrap(d.application,"use",this._getAppUsePatch(u)),d},d=>{if(d===void 0)return;const _=typeof d?.Router?.prototype?.route=="function"?d.Router.prototype:d.Router;this._unwrap(_,"route"),this._unwrap(_,"use"),this._unwrap(d.application,"use")})]}_getRoutePatch(){const d=this;return function(u){return function(...p){const E=u.apply(this,p),T=this.stack[this.stack.length-1];return d._applyPatch(T,(0,o.getLayerPath)(p)),E}}}_getRouterUsePatch(){const d=this;return function(u){return function(...p){const E=u.apply(this,p),T=this.stack[this.stack.length-1];return d._applyPatch(T,(0,o.getLayerPath)(p)),E}}}_getAppUsePatch(d){const u=this;return function(_){return function(...E){const T=d?this.router:this._router,h=_.apply(this,E);if(T){const m=T.stack[T.stack.length-1];u._applyPatch(m,(0,o.getLayerPath)(E))}return h}}}_applyPatch(d,u){const _=this;d[c.kLayerPatched]!==!0&&(d[c.kLayerPatched]=!0,this._wrap(d,"handle",p=>{if(p.length===4)return p;const E=function(T,h){const{isLayerPathStored:m}=(0,o.storeLayerPath)(T,u),A=(0,o.getConstructedRoute)(T),g=(0,o.getActualMatchedRoute)(T),R={[a.ATTR_HTTP_ROUTE]:g},O=(0,o.getLayerMetadata)(A,d,u),C=O.attributes[r.AttributeNames.EXPRESS_TYPE],I=(0,e.getRPCMetadata)(t.context.active());if(I?.type===e.RPCType.HTTP&&(I.route=g),(0,o.isLayerIgnored)(O.name,C,_.getConfig()))return C===n.ExpressLayerType.MIDDLEWARE&&T[c._LAYERS_STORE_PROPERTY].pop(),p.apply(this,arguments);if(t.trace.getSpan(t.context.active())===void 0)return p.apply(this,arguments);const L=_._getSpanName({request:T,layerType:C,route:A},O.name),U=_.tracer.startSpan(L,{attributes:Object.assign(R,O.attributes)}),q=t.context.active();let H=t.trace.setSpan(q,U);const{requestHook:$}=_.getConfig();$&&(0,i.safeExecuteInTheMiddle)(()=>$(U,{request:T,layerType:C,route:A}),Y=>{Y&&t.diag.error("express instrumentation: request hook failed",Y)},!0);let B=!1;O.attributes[r.AttributeNames.EXPRESS_TYPE]===n.ExpressLayerType.ROUTER&&(U.end(),B=!0,H=q);const F=()=>{B===!1&&(B=!0,U.end())},w=Array.from(arguments),k=w.findIndex(Y=>typeof Y=="function");k>=0&&(arguments[k]=function(){const Y=arguments[0],oe=![void 0,null,"route","router"].includes(Y);if(!B&&oe){const[ne,M]=(0,o.asErrorAndMessage)(Y);U.recordException(ne),U.setStatus({code:t.SpanStatusCode.ERROR,message:M})}B===!1&&(B=!0,T.res?.removeListener("finish",F),U.end()),!(T.route&&oe)&&m&&T[c._LAYERS_STORE_PROPERTY].pop();const ae=w[k];return t.context.bind(q,ae).apply(this,arguments)});try{return t.context.bind(H,p).apply(this,arguments)}catch(Y){const[oe,ae]=(0,o.asErrorAndMessage)(Y);throw U.recordException(oe),U.setStatus({code:t.SpanStatusCode.ERROR,message:ae}),Y}finally{B||h.once("finish",F)}};for(const T in p)Object.defineProperty(E,T,{get(){return p[T]},set(h){p[T]=h}});return E}))}_getSpanName(d,u){const{spanNameHook:_}=this.getConfig();if(!(_ instanceof Function))return u;try{return _(d,u)??u}catch(p){return t.diag.error("express instrumentation: error calling span name rewrite hook",p),u}}}return la.ExpressInstrumentation=l,la}var bR;function WY(){return bR||(bR=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=e.ExpressLayerType=e.ExpressInstrumentation=void 0;var t=qY();Object.defineProperty(e,"ExpressInstrumentation",{enumerable:!0,get:function(){return t.ExpressInstrumentation}});var n=XE();Object.defineProperty(e,"ExpressLayerType",{enumerable:!0,get:function(){return n.ExpressLayerType}});var r=QE();Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return r.AttributeNames}})})(Dd)),Dd}var KY=WY();const so=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,$P="Express";function zY(e){Nt(e,"auto.http.otel.express");const t=Re(e).data,n=t["express.type"];n&&e.setAttribute(Ee,`${n}.express`);const r=t["express.name"];typeof r=="string"&&e.updateName(r)}function ZY(e,t){if(je()===Qo())return so&&x.warn("Isolation scope is still default isolation scope - skipping setting transactionName"),t;if(e.layerType==="request_handler"){const n=e.request,r=n.method?n.method.toUpperCase():"GET";je().setTransactionName(`${r} ${e.route}`)}return t}const XY=Ne($P,()=>new KY.ExpressInstrumentation({requestHook:e=>zY(e),spanNameHook:(e,t)=>ZY(e,t)})),QY=(()=>({name:$P,setupOnce(){XY()}})),JY=QY;var Gd,IR;function ej(){if(IR)return Gd;IR=1,Gd=e;function e(r,o,s){r instanceof RegExp&&(r=t(r,s)),o instanceof RegExp&&(o=t(o,s));var i=n(r,o,s);return i&&{start:i[0],end:i[1],pre:s.slice(0,i[0]),body:s.slice(i[0]+r.length,i[1]),post:s.slice(i[1]+o.length)}}function t(r,o){var s=o.match(r);return s?s[0]:null}e.range=n;function n(r,o,s){var i,a,c,l,f,d=s.indexOf(r),u=s.indexOf(o,d+1),_=d;if(d>=0&&u>0){if(r===o)return[d,u];for(i=[],c=s.length;_>=0&&!f;)_==d?(i.push(_),d=s.indexOf(r,_+1)):i.length==1?f=[i.pop(),u]:(a=i.pop(),a<c&&(c=a,l=u),u=s.indexOf(o,_+1)),_=d<u&&d>=0?d:u;i.length&&(f=[c,l])}return f}return Gd}var Vd,CR;function tj(){if(CR)return Vd;CR=1;var e=ej();Vd=f;var t="\0SLASH"+Math.random()+"\0",n="\0OPEN"+Math.random()+"\0",r="\0CLOSE"+Math.random()+"\0",o="\0COMMA"+Math.random()+"\0",s="\0PERIOD"+Math.random()+"\0";function i(T){return parseInt(T,10)==T?parseInt(T,10):T.charCodeAt(0)}function a(T){return T.split("\\\\").join(t).split("\\{").join(n).split("\\}").join(r).split("\\,").join(o).split("\\.").join(s)}function c(T){return T.split(t).join("\\").split(n).join("{").split(r).join("}").split(o).join(",").split(s).join(".")}function l(T){if(!T)return[""];var h=[],m=e("{","}",T);if(!m)return T.split(",");var A=m.pre,g=m.body,R=m.post,O=A.split(",");O[O.length-1]+="{"+g+"}";var C=l(R);return R.length&&(O[O.length-1]+=C.shift(),O.push.apply(O,C)),h.push.apply(h,O),h}function f(T){return T?(T.substr(0,2)==="{}"&&(T="\\{\\}"+T.substr(2)),E(a(T),!0).map(c)):[]}function d(T){return"{"+T+"}"}function u(T){return/^-?0\d/.test(T)}function _(T,h){return T<=h}function p(T,h){return T>=h}function E(T,h){var m=[],A=e("{","}",T);if(!A)return[T];var g=A.pre,R=A.post.length?E(A.post,!1):[""];if(/\$$/.test(A.pre))for(var O=0;O<R.length;O++){var C=g+"{"+A.body+"}"+R[O];m.push(C)}else{var I=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(A.body),L=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(A.body),U=I||L,q=A.body.indexOf(",")>=0;if(!U&&!q)return A.post.match(/,(?!,).*\}/)?(T=A.pre+"{"+A.body+r+A.post,E(T)):[T];var H;if(U)H=A.body.split(/\.\./);else if(H=l(A.body),H.length===1&&(H=E(H[0],!1).map(d),H.length===1))return R.map(function(K){return A.pre+H[0]+K});var $;if(U){var B=i(H[0]),F=i(H[1]),w=Math.max(H[0].length,H[1].length),k=H.length==3?Math.abs(i(H[2])):1,Y=_,oe=F<B;oe&&(k*=-1,Y=p);var ae=H.some(u);$=[];for(var ne=B;Y(ne,F);ne+=k){var M;if(L)M=String.fromCharCode(ne),M==="\\"&&(M="");else if(M=String(ne),ae){var P=w-M.length;if(P>0){var G=new Array(P+1).join("0");ne<0?M="-"+G+M.slice(1):M=G+M}}$.push(M)}}else{$=[];for(var V=0;V<H.length;V++)$.push.apply($,E(H[V],!1))}for(var V=0;V<$.length;V++)for(var O=0;O<R.length;O++){var C=g+$[V]+R[O];(!h||U||C)&&m.push(C)}}return m}return Vd}var nj=tj();const rj=Zp(nj),oj=1024*64,Mu=e=>{if(typeof e!="string")throw new TypeError("invalid pattern");if(e.length>oj)throw new TypeError("pattern is too long")},sj={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},da=e=>e.replace(/[[\]\\-]/g,"\\$&"),ij=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),MR=e=>e.join(""),aj=(e,t)=>{const n=t;if(e.charAt(n)!=="[")throw new Error("not in a brace expression");const r=[],o=[];let s=n+1,i=!1,a=!1,c=!1,l=!1,f=n,d="";e:for(;s<e.length;){const E=e.charAt(s);if((E==="!"||E==="^")&&s===n+1){l=!0,s++;continue}if(E==="]"&&i&&!c){f=s+1;break}if(i=!0,E==="\\"&&!c){c=!0,s++;continue}if(E==="["&&!c){for(const[T,[h,m,A]]of Object.entries(sj))if(e.startsWith(T,s)){if(d)return["$.",!1,e.length-n,!0];s+=T.length,A?o.push(h):r.push(h),a=a||m;continue e}}if(c=!1,d){E>d?r.push(da(d)+"-"+da(E)):E===d&&r.push(da(E)),d="",s++;continue}if(e.startsWith("-]",s+1)){r.push(da(E+"-")),s+=2;continue}if(e.startsWith("-",s+1)){d=E,s+=2;continue}r.push(da(E)),s++}if(f<s)return["",!1,0,!1];if(!r.length&&!o.length)return["$.",!1,e.length-n,!0];if(o.length===0&&r.length===1&&/^\\?.$/.test(r[0])&&!l){const E=r[0].length===2?r[0].slice(-1):r[0];return[ij(E),!1,f-n,!1]}const u="["+(l?"^":"")+MR(r)+"]",_="["+(l?"":"^")+MR(o)+"]";return[r.length&&o.length?"("+u+"|"+_+")":r.length?u:_,a,f-n,!0]},Ya=(e,{windowsPathsNoEscape:t=!1}={})=>t?e.replace(/\[([^\/\\])\]/g,"$1"):e.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),cj=new Set(["!","?","+","*","@"]),PR=e=>cj.has(e),uj="(?!(?:^|/)\\.\\.?(?:$|/))",xc="(?!\\.)",lj=new Set(["[","."]),dj=new Set(["..","."]),fj=new Set("().*{}+?[]^$\\!"),_j=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),JE="[^/]",vR=JE+"*?",LR=JE+"+?";class mt{type;#e;#t;#r=!1;#n=[];#o;#i;#c;#a=!1;#s;#u;#d=!1;constructor(t,n,r={}){this.type=t,t&&(this.#t=!0),this.#o=n,this.#e=this.#o?this.#o.#e:this,this.#s=this.#e===this?r:this.#e.#s,this.#c=this.#e===this?[]:this.#e.#c,t==="!"&&!this.#e.#a&&this.#c.push(this),this.#i=this.#o?this.#o.#n.length:0}get hasMagic(){if(this.#t!==void 0)return this.#t;for(const t of this.#n)if(typeof t!="string"&&(t.type||t.hasMagic))return this.#t=!0;return this.#t}toString(){return this.#u!==void 0?this.#u:this.type?this.#u=this.type+"("+this.#n.map(t=>String(t)).join("|")+")":this.#u=this.#n.map(t=>String(t)).join("")}#_(){if(this!==this.#e)throw new Error("should only call on root");if(this.#a)return this;this.toString(),this.#a=!0;let t;for(;t=this.#c.pop();){if(t.type!=="!")continue;let n=t,r=n.#o;for(;r;){for(let o=n.#i+1;!r.type&&o<r.#n.length;o++)for(const s of t.#n){if(typeof s=="string")throw new Error("string part in extglob AST??");s.copyIn(r.#n[o])}n=r,r=n.#o}}return this}push(...t){for(const n of t)if(n!==""){if(typeof n!="string"&&!(n instanceof mt&&n.#o===this))throw new Error("invalid part: "+n);this.#n.push(n)}}toJSON(){const t=this.type===null?this.#n.slice().map(n=>typeof n=="string"?n:n.toJSON()):[this.type,...this.#n.map(n=>n.toJSON())];return this.isStart()&&!this.type&&t.unshift([]),this.isEnd()&&(this===this.#e||this.#e.#a&&this.#o?.type==="!")&&t.push({}),t}isStart(){if(this.#e===this)return!0;if(!this.#o?.isStart())return!1;if(this.#i===0)return!0;const t=this.#o;for(let n=0;n<this.#i;n++){const r=t.#n[n];if(!(r instanceof mt&&r.type==="!"))return!1}return!0}isEnd(){if(this.#e===this||this.#o?.type==="!")return!0;if(!this.#o?.isEnd())return!1;if(!this.type)return this.#o?.isEnd();const t=this.#o?this.#o.#n.length:0;return this.#i===t-1}copyIn(t){typeof t=="string"?this.push(t):this.push(t.clone(this))}clone(t){const n=new mt(this.type,t);for(const r of this.#n)n.copyIn(r);return n}static#l(t,n,r,o){let s=!1,i=!1,a=-1,c=!1;if(n.type===null){let _=r,p="";for(;_<t.length;){const E=t.charAt(_++);if(s||E==="\\"){s=!s,p+=E;continue}if(i){_===a+1?(E==="^"||E==="!")&&(c=!0):E==="]"&&!(_===a+2&&c)&&(i=!1),p+=E;continue}else if(E==="["){i=!0,a=_,c=!1,p+=E;continue}if(!o.noext&&PR(E)&&t.charAt(_)==="("){n.push(p),p="";const T=new mt(E,n);_=mt.#l(t,T,_,o),n.push(T);continue}p+=E}return n.push(p),_}let l=r+1,f=new mt(null,n);const d=[];let u="";for(;l<t.length;){const _=t.charAt(l++);if(s||_==="\\"){s=!s,u+=_;continue}if(i){l===a+1?(_==="^"||_==="!")&&(c=!0):_==="]"&&!(l===a+2&&c)&&(i=!1),u+=_;continue}else if(_==="["){i=!0,a=l,c=!1,u+=_;continue}if(PR(_)&&t.charAt(l)==="("){f.push(u),u="";const p=new mt(_,f);f.push(p),l=mt.#l(t,p,l,o);continue}if(_==="|"){f.push(u),u="",d.push(f),f=new mt(null,n);continue}if(_===")")return u===""&&n.#n.length===0&&(n.#d=!0),f.push(u),u="",n.push(...d,f),l;u+=_}return n.type=null,n.#t=void 0,n.#n=[t.substring(r-1)],l}static fromGlob(t,n={}){const r=new mt(null,void 0,n);return mt.#l(t,r,0,n),r}toMMPattern(){if(this!==this.#e)return this.#e.toMMPattern();const t=this.toString(),[n,r,o,s]=this.toRegExpSource();if(!(o||this.#t||this.#s.nocase&&!this.#s.nocaseMagicOnly&&t.toUpperCase()!==t.toLowerCase()))return r;const a=(this.#s.nocase?"i":"")+(s?"u":"");return Object.assign(new RegExp(`^${n}$`,a),{_src:n,_glob:t})}get options(){return this.#s}toRegExpSource(t){const n=t??!!this.#s.dot;if(this.#e===this&&this.#_(),!this.type){const c=this.isStart()&&this.isEnd(),l=this.#n.map(_=>{const[p,E,T,h]=typeof _=="string"?mt.#p(_,this.#t,c):_.toRegExpSource(t);return this.#t=this.#t||T,this.#r=this.#r||h,p}).join("");let f="";if(this.isStart()&&typeof this.#n[0]=="string"&&!(this.#n.length===1&&dj.has(this.#n[0]))){const p=lj,E=n&&p.has(l.charAt(0))||l.startsWith("\\.")&&p.has(l.charAt(2))||l.startsWith("\\.\\.")&&p.has(l.charAt(4)),T=!n&&!t&&p.has(l.charAt(0));f=E?uj:T?xc:""}let d="";return this.isEnd()&&this.#e.#a&&this.#o?.type==="!"&&(d="(?:$|\\/)"),[f+l+d,Ya(l),this.#t=!!this.#t,this.#r]}const r=this.type==="*"||this.type==="+",o=this.type==="!"?"(?:(?!(?:":"(?:";let s=this.#f(n);if(this.isStart()&&this.isEnd()&&!s&&this.type!=="!"){const c=this.toString();return this.#n=[c],this.type=null,this.#t=void 0,[c,Ya(this.toString()),!1,!1]}let i=!r||t||n||!xc?"":this.#f(!0);i===s&&(i=""),i&&(s=`(?:${s})(?:${i})*?`);let a="";if(this.type==="!"&&this.#d)a=(this.isStart()&&!n?xc:"")+LR;else{const c=this.type==="!"?"))"+(this.isStart()&&!n&&!t?xc:"")+vR+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&i?")":this.type==="*"&&i?")?":`)${this.type}`;a=o+s+c}return[a,Ya(s),this.#t=!!this.#t,this.#r]}#f(t){return this.#n.map(n=>{if(typeof n=="string")throw new Error("string type in extglob ast??");const[r,o,s,i]=n.toRegExpSource(t);return this.#r=this.#r||i,r}).filter(n=>!(this.isStart()&&this.isEnd())||!!n).join("|")}static#p(t,n,r=!1){let o=!1,s="",i=!1;for(let a=0;a<t.length;a++){const c=t.charAt(a);if(o){o=!1,s+=(fj.has(c)?"\\":"")+c;continue}if(c==="\\"){a===t.length-1?s+="\\\\":o=!0;continue}if(c==="["){const[l,f,d,u]=aj(t,a);if(d){s+=l,i=i||f,a+=d-1,n=n||u;continue}}if(c==="*"){r&&t==="*"?s+=LR:s+=vR,n=!0;continue}if(c==="?"){s+=JE,n=!0;continue}s+=_j(c)}return[s,Ya(t),!!n,i]}}const pj=(e,{windowsPathsNoEscape:t=!1}={})=>t?e.replace(/[?*()[\]]/g,"[$&]"):e.replace(/[?*()[\]\\]/g,"\\$&"),ft=(e,t,n={})=>(Mu(t),!n.nocomment&&t.charAt(0)==="#"?!1:new Il(t,n).match(e)),Ej=/^\*+([^+@!?\*\[\(]*)$/,Tj=e=>t=>!t.startsWith(".")&&t.endsWith(e),hj=e=>t=>t.endsWith(e),Sj=e=>(e=e.toLowerCase(),t=>!t.startsWith(".")&&t.toLowerCase().endsWith(e)),mj=e=>(e=e.toLowerCase(),t=>t.toLowerCase().endsWith(e)),Aj=/^\*+\.\*+$/,gj=e=>!e.startsWith(".")&&e.includes("."),Rj=e=>e!=="."&&e!==".."&&e.includes("."),Nj=/^\.\*+$/,yj=e=>e!=="."&&e!==".."&&e.startsWith("."),Oj=/^\*+$/,bj=e=>e.length!==0&&!e.startsWith("."),Ij=e=>e.length!==0&&e!=="."&&e!=="..",Cj=/^\?+([^+@!?\*\[\(]*)?$/,Mj=([e,t=""])=>{const n=BP([e]);return t?(t=t.toLowerCase(),r=>n(r)&&r.toLowerCase().endsWith(t)):n},Pj=([e,t=""])=>{const n=HP([e]);return t?(t=t.toLowerCase(),r=>n(r)&&r.toLowerCase().endsWith(t)):n},vj=([e,t=""])=>{const n=HP([e]);return t?r=>n(r)&&r.endsWith(t):n},Lj=([e,t=""])=>{const n=BP([e]);return t?r=>n(r)&&r.endsWith(t):n},BP=([e])=>{const t=e.length;return n=>n.length===t&&!n.startsWith(".")},HP=([e])=>{const t=e.length;return n=>n.length===t&&n!=="."&&n!==".."},FP=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",DR={win32:{sep:"\\"},posix:{sep:"/"}},Dj=FP==="win32"?DR.win32.sep:DR.posix.sep;ft.sep=Dj;const $t=Symbol("globstar **");ft.GLOBSTAR=$t;const wj="[^/]",Uj=wj+"*?",kj="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",Gj="(?:(?!(?:\\/|^)\\.).)*?",Vj=(e,t={})=>n=>ft(n,e,t);ft.filter=Vj;const xt=(e,t={})=>Object.assign({},e,t),xj=e=>{if(!e||typeof e!="object"||!Object.keys(e).length)return ft;const t=ft;return Object.assign((r,o,s={})=>t(r,o,xt(e,s)),{Minimatch:class extends t.Minimatch{constructor(o,s={}){super(o,xt(e,s))}static defaults(o){return t.defaults(xt(e,o)).Minimatch}},AST:class extends t.AST{constructor(o,s,i={}){super(o,s,xt(e,i))}static fromGlob(o,s={}){return t.AST.fromGlob(o,xt(e,s))}},unescape:(r,o={})=>t.unescape(r,xt(e,o)),escape:(r,o={})=>t.escape(r,xt(e,o)),filter:(r,o={})=>t.filter(r,xt(e,o)),defaults:r=>t.defaults(xt(e,r)),makeRe:(r,o={})=>t.makeRe(r,xt(e,o)),braceExpand:(r,o={})=>t.braceExpand(r,xt(e,o)),match:(r,o,s={})=>t.match(r,o,xt(e,s)),sep:t.sep,GLOBSTAR:$t})};ft.defaults=xj;const YP=(e,t={})=>(Mu(e),t.nobrace||!/\{(?:(?!\{).)*\}/.test(e)?[e]:rj(e));ft.braceExpand=YP;const $j=(e,t={})=>new Il(e,t).makeRe();ft.makeRe=$j;const Bj=(e,t,n={})=>{const r=new Il(t,n);return e=e.filter(o=>r.match(o)),r.options.nonull&&!e.length&&e.push(t),e};ft.match=Bj;const wR=/[?*]|[+@!]\(.*?\)|\[|\]/,Hj=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");class Il{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(t,n={}){Mu(t),n=n||{},this.options=n,this.pattern=t,this.platform=n.platform||FP,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!n.windowsPathsNoEscape||n.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!n.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!n.nonegate,this.comment=!1,this.empty=!1,this.partial=!!n.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=n.windowsNoMagicRoot!==void 0?n.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const t of this.set)for(const n of t)if(typeof n!="string")return!0;return!1}debug(...t){}make(){const t=this.pattern,n=this.options;if(!n.nocomment&&t.charAt(0)==="#"){this.comment=!0;return}if(!t){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],n.debug&&(this.debug=(...s)=>console.error(...s)),this.debug(this.pattern,this.globSet);const r=this.globSet.map(s=>this.slashSplit(s));this.globParts=this.preprocess(r),this.debug(this.pattern,this.globParts);let o=this.globParts.map((s,i,a)=>{if(this.isWindows&&this.windowsNoMagicRoot){const c=s[0]===""&&s[1]===""&&(s[2]==="?"||!wR.test(s[2]))&&!wR.test(s[3]),l=/^[a-z]:/i.test(s[0]);if(c)return[...s.slice(0,4),...s.slice(4).map(f=>this.parse(f))];if(l)return[s[0],...s.slice(1).map(f=>this.parse(f))]}return s.map(c=>this.parse(c))});if(this.debug(this.pattern,o),this.set=o.filter(s=>s.indexOf(!1)===-1),this.isWindows)for(let s=0;s<this.set.length;s++){const i=this.set[s];i[0]===""&&i[1]===""&&this.globParts[s][2]==="?"&&typeof i[3]=="string"&&/^[a-z]:$/i.test(i[3])&&(i[2]="?")}this.debug(this.pattern,this.set)}preprocess(t){if(this.options.noglobstar)for(let r=0;r<t.length;r++)for(let o=0;o<t[r].length;o++)t[r][o]==="**"&&(t[r][o]="*");const{optimizationLevel:n=1}=this.options;return n>=2?(t=this.firstPhasePreProcess(t),t=this.secondPhasePreProcess(t)):n>=1?t=this.levelOneOptimize(t):t=this.adjascentGlobstarOptimize(t),t}adjascentGlobstarOptimize(t){return t.map(n=>{let r=-1;for(;(r=n.indexOf("**",r+1))!==-1;){let o=r;for(;n[o+1]==="**";)o++;o!==r&&n.splice(r,o-r)}return n})}levelOneOptimize(t){return t.map(n=>(n=n.reduce((r,o)=>{const s=r[r.length-1];return o==="**"&&s==="**"?r:o===".."&&s&&s!==".."&&s!=="."&&s!=="**"?(r.pop(),r):(r.push(o),r)},[]),n.length===0?[""]:n))}levelTwoFileOptimize(t){Array.isArray(t)||(t=this.slashSplit(t));let n=!1;do{if(n=!1,!this.preserveMultipleSlashes){for(let o=1;o<t.length-1;o++){const s=t[o];o===1&&s===""&&t[0]===""||(s==="."||s==="")&&(n=!0,t.splice(o,1),o--)}t[0]==="."&&t.length===2&&(t[1]==="."||t[1]==="")&&(n=!0,t.pop())}let r=0;for(;(r=t.indexOf("..",r+1))!==-1;){const o=t[r-1];o&&o!=="."&&o!==".."&&o!=="**"&&(n=!0,t.splice(r-1,2),r-=2)}}while(n);return t.length===0?[""]:t}firstPhasePreProcess(t){let n=!1;do{n=!1;for(let r of t){let o=-1;for(;(o=r.indexOf("**",o+1))!==-1;){let i=o;for(;r[i+1]==="**";)i++;i>o&&r.splice(o+1,i-o);let a=r[o+1];const c=r[o+2],l=r[o+3];if(a!==".."||!c||c==="."||c===".."||!l||l==="."||l==="..")continue;n=!0,r.splice(o,1);const f=r.slice(0);f[o]="**",t.push(f),o--}if(!this.preserveMultipleSlashes){for(let i=1;i<r.length-1;i++){const a=r[i];i===1&&a===""&&r[0]===""||(a==="."||a==="")&&(n=!0,r.splice(i,1),i--)}r[0]==="."&&r.length===2&&(r[1]==="."||r[1]==="")&&(n=!0,r.pop())}let s=0;for(;(s=r.indexOf("..",s+1))!==-1;){const i=r[s-1];if(i&&i!=="."&&i!==".."&&i!=="**"){n=!0;const c=s===1&&r[s+1]==="**"?["."]:[];r.splice(s-1,2,...c),r.length===0&&r.push(""),s-=2}}}}while(n);return t}secondPhasePreProcess(t){for(let n=0;n<t.length-1;n++)for(let r=n+1;r<t.length;r++){const o=this.partsMatch(t[n],t[r],!this.preserveMultipleSlashes);if(o){t[n]=[],t[r]=o;break}}return t.filter(n=>n.length)}partsMatch(t,n,r=!1){let o=0,s=0,i=[],a="";for(;o<t.length&&s<n.length;)if(t[o]===n[s])i.push(a==="b"?n[s]:t[o]),o++,s++;else if(r&&t[o]==="**"&&n[s]===t[o+1])i.push(t[o]),o++;else if(r&&n[s]==="**"&&t[o]===n[s+1])i.push(n[s]),s++;else if(t[o]==="*"&&n[s]&&(this.options.dot||!n[s].startsWith("."))&&n[s]!=="**"){if(a==="b")return!1;a="a",i.push(t[o]),o++,s++}else if(n[s]==="*"&&t[o]&&(this.options.dot||!t[o].startsWith("."))&&t[o]!=="**"){if(a==="a")return!1;a="b",i.push(n[s]),o++,s++}else return!1;return t.length===n.length&&i}parseNegate(){if(this.nonegate)return;const t=this.pattern;let n=!1,r=0;for(let o=0;o<t.length&&t.charAt(o)==="!";o++)n=!n,r++;r&&(this.pattern=t.slice(r)),this.negate=n}matchOne(t,n,r=!1){const o=this.options;if(this.isWindows){const E=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),T=!E&&t[0]===""&&t[1]===""&&t[2]==="?"&&/^[a-z]:$/i.test(t[3]),h=typeof n[0]=="string"&&/^[a-z]:$/i.test(n[0]),m=!h&&n[0]===""&&n[1]===""&&n[2]==="?"&&typeof n[3]=="string"&&/^[a-z]:$/i.test(n[3]),A=T?3:E?0:void 0,g=m?3:h?0:void 0;if(typeof A=="number"&&typeof g=="number"){const[R,O]=[t[A],n[g]];R.toLowerCase()===O.toLowerCase()&&(n[g]=R,g>A?n=n.slice(g):A>g&&(t=t.slice(A)))}}const{optimizationLevel:s=1}=this.options;s>=2&&(t=this.levelTwoFileOptimize(t)),this.debug("matchOne",this,{file:t,pattern:n}),this.debug("matchOne",t.length,n.length);for(var i=0,a=0,c=t.length,l=n.length;i<c&&a<l;i++,a++){this.debug("matchOne loop");var f=n[a],d=t[i];if(this.debug(n,f,d),f===!1)return!1;if(f===$t){this.debug("GLOBSTAR",[n,f,d]);var u=i,_=a+1;if(_===l){for(this.debug("** at the end");i<c;i++)if(t[i]==="."||t[i]===".."||!o.dot&&t[i].charAt(0)===".")return!1;return!0}for(;u<c;){var p=t[u];if(this.debug(`
globstar while`,t,u,n,_,p),this.matchOne(t.slice(u),n.slice(_),r))return this.debug("globstar found match!",u,c,p),!0;if(p==="."||p===".."||!o.dot&&p.charAt(0)==="."){this.debug("dot detected!",t,u,n,_);break}this.debug("globstar swallow a segment, and continue"),u++}return!!(r&&(this.debug(`
>>> no match, partial?`,t,u,n,_),u===c))}let E;if(typeof f=="string"?(E=d===f,this.debug("string match",f,d,E)):(E=f.test(d),this.debug("pattern match",f,d,E)),!E)return!1}if(i===c&&a===l)return!0;if(i===c)return r;if(a===l)return i===c-1&&t[i]==="";throw new Error("wtf?")}braceExpand(){return YP(this.pattern,this.options)}parse(t){Mu(t);const n=this.options;if(t==="**")return $t;if(t==="")return"";let r,o=null;(r=t.match(Oj))?o=n.dot?Ij:bj:(r=t.match(Ej))?o=(n.nocase?n.dot?mj:Sj:n.dot?hj:Tj)(r[1]):(r=t.match(Cj))?o=(n.nocase?n.dot?Pj:Mj:n.dot?vj:Lj)(r):(r=t.match(Aj))?o=n.dot?Rj:gj:(r=t.match(Nj))&&(o=yj);const s=mt.fromGlob(t,this.options).toMMPattern();return o&&typeof s=="object"&&Reflect.defineProperty(s,"test",{value:o}),s}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const t=this.set;if(!t.length)return this.regexp=!1,this.regexp;const n=this.options,r=n.noglobstar?Uj:n.dot?kj:Gj,o=new Set(n.nocase?["i"]:[]);let s=t.map(c=>{const l=c.map(f=>{if(f instanceof RegExp)for(const d of f.flags.split(""))o.add(d);return typeof f=="string"?Hj(f):f===$t?$t:f._src});return l.forEach((f,d)=>{const u=l[d+1],_=l[d-1];f!==$t||_===$t||(_===void 0?u!==void 0&&u!==$t?l[d+1]="(?:\\/|"+r+"\\/)?"+u:l[d]=r:u===void 0?l[d-1]=_+"(?:\\/|"+r+")?":u!==$t&&(l[d-1]=_+"(?:\\/|\\/"+r+"\\/)"+u,l[d+1]=$t))}),l.filter(f=>f!==$t).join("/")}).join("|");const[i,a]=t.length>1?["(?:",")"]:["",""];s="^"+i+s+a+"$",this.negate&&(s="^(?!"+s+").+$");try{this.regexp=new RegExp(s,[...o].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(t){return this.preserveMultipleSlashes?t.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(t)?["",...t.split(/\/+/)]:t.split(/\/+/)}match(t,n=this.partial){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return t==="";if(t==="/"&&n)return!0;const r=this.options;this.isWindows&&(t=t.split("\\").join("/"));const o=this.slashSplit(t);this.debug(this.pattern,"split",o);const s=this.set;this.debug(this.pattern,"set",s);let i=o[o.length-1];if(!i)for(let a=o.length-2;!i&&a>=0;a--)i=o[a];for(let a=0;a<s.length;a++){const c=s[a];let l=o;if(r.matchBase&&c.length===1&&(l=[i]),this.matchOne(l,c,n))return r.flipNegate?!0:!this.negate}return r.flipNegate?!1:this.negate}static defaults(t){return ft.defaults(t).Minimatch}}ft.AST=mt;ft.Minimatch=Il;ft.escape=pj;ft.unescape=Ya;const UR="@fastify/otel",Fj="0.8.0",Yj=">=4.0.0 <6",kR=["onRequest","preParsing","preValidation","preHandler","preSerialization","onSend","onResponse","onError"],Ve={HOOK_NAME:"hook.name",FASTIFY_TYPE:"fastify.type",HOOK_CALLBACK_NAME:"hook.callback.name",ROOT:"fastify.root"},Wn={ROUTE:"route-hook",INSTANCE:"hook",HANDLER:"request-handler"},In="anonymous",Et=Symbol("fastify otel instance"),Kn=Symbol("fastify otel request spans"),fa=Symbol("fastify otel request context"),GR=Symbol("fastify otel addhook original"),VR=Symbol("fastify otel setnotfound original"),$c=Symbol("fastify otel ignore path");class jj extends yt{constructor(t){if(super(UR,Fj,t),this.servername=t?.servername??process.env.OTEL_SERVICE_NAME??"fastify",this[$c]=null,this._logger=b.diag.createComponentLogger({namespace:UR}),t?.ignorePaths!=null||process.env.OTEL_FASTIFY_IGNORE_PATHS!=null){const n=t?.ignorePaths??process.env.OTEL_FASTIFY_IGNORE_PATHS;if((typeof n!="string"||n.length===0)&&typeof n!="function")throw new TypeError("ignorePaths must be a string or a function");const r=ft;this[$c]=o=>typeof n=="function"?n(o):r(o.url,n)}}enable(){if(this._handleInitialization===void 0&&this.getConfig().registerOnInitialization){const t=this.plugin();this._handleInitialization=n=>{n.fastify.register(t)},hn.subscribe("fastify.initialization",this._handleInitialization)}return super.enable()}disable(){return this._handleInitialization&&(hn.unsubscribe("fastify.initialization",this._handleInitialization),this._handleInitialization=void 0),super.disable()}init(){return[]}plugin(){const t=this;return n[Symbol.for("skip-override")]=!0,n[Symbol.for("fastify.display-name")]="@fastify/otel",n[Symbol.for("plugin-meta")]={fastify:Yj,name:"@fastify/otel"},n;function n(r,o,s){r.decorate(Et,t),r.decorate(GR,r.addHook),r.decorate(VR,r.setNotFoundHandler),r.decorateRequest("opentelemetry",function(){const u=this[fa];return{span:this[Kn],tracer:t.tracer,context:u,inject:(p,E)=>b.propagation.inject(u,p,E),extract:(p,E)=>b.propagation.extract(u,p,E)}}),r.decorateRequest(Kn,null),r.decorateRequest(fa,null),r.addHook("onRoute",function(d){if(t[$c]?.(d)===!0){t._logger.debug(`Ignoring route instrumentation ${d.method} ${d.url} because it matches the ignore path`);return}for(const u of kR)if(d[u]!=null){const _=d[u];if(typeof _=="function")d[u]=f(_,{[Q.ATTR_SERVICE_NAME]:r[Et].servername,[Ve.HOOK_NAME]:`${this.pluginName} - route -> ${u}`,[Ve.FASTIFY_TYPE]:Wn.ROUTE,[Q.ATTR_HTTP_ROUTE]:d.url,[Ve.HOOK_CALLBACK_NAME]:_.name?.length>0?_.name:In});else if(Array.isArray(_)){const p=[];for(const E of _)p.push(f(E,{[Q.ATTR_SERVICE_NAME]:r[Et].servername,[Ve.HOOK_NAME]:`${this.pluginName} - route -> ${u}`,[Ve.FASTIFY_TYPE]:Wn.ROUTE,[Q.ATTR_HTTP_ROUTE]:d.url,[Ve.HOOK_CALLBACK_NAME]:E.name?.length>0?E.name:In}));d[u]=p}}d.onSend!=null?d.onSend=Array.isArray(d.onSend)?[...d.onSend,i]:[d.onSend,i]:d.onSend=i,d.onError!=null?d.onError=Array.isArray(d.onError)?[...d.onError,a]:[d.onError,a]:d.onError=a,d.handler=f(d.handler,{[Q.ATTR_SERVICE_NAME]:r[Et].servername,[Ve.HOOK_NAME]:`${this.pluginName} - route-handler`,[Ve.FASTIFY_TYPE]:Wn.HANDLER,[Q.ATTR_HTTP_ROUTE]:d.url,[Ve.HOOK_CALLBACK_NAME]:d.handler.name.length>0?d.handler.name:In})}),r.addHook("onRequest",function(d,u,_){if(this[Et].isEnabled()===!1)return _();if(this[Et][$c]?.({url:d.url,method:d.method})===!0)return this[Et]._logger.debug(`Ignoring request ${d.method} ${d.url} because it matches the ignore path`),_();let p=b.context.active();b.trace.getSpan(p)==null&&(p=b.propagation.extract(p,d.headers));const E=tl(p);d.routeOptions.url!=null&&E?.type===Qr.HTTP&&(E.route=d.routeOptions.url);const T=this[Et].tracer.startSpan("request",{attributes:{[Q.ATTR_SERVICE_NAME]:r[Et].servername,[Ve.ROOT]:"@fastify/otel",[Q.ATTR_HTTP_ROUTE]:d.url,[Q.ATTR_HTTP_REQUEST_METHOD]:d.method}},p);d[fa]=b.trace.setSpan(p,T),d[Kn]=T,b.context.with(d[fa],()=>{_()})}),r.addHook("onResponse",function(d,u,_){const p=d[Kn];p!=null&&(p.setStatus({code:b.SpanStatusCode.OK,message:"OK"}),p.setAttributes({[Q.ATTR_HTTP_RESPONSE_STATUS_CODE]:404}),p.end()),d[Kn]=null,_()}),r.addHook=c,r.setNotFoundHandler=l,s();function i(d,u,_,p){const E=d[Kn];E!=null&&(u.statusCode<500&&E.setStatus({code:b.SpanStatusCode.OK,message:"OK"}),E.setAttributes({[Q.ATTR_HTTP_RESPONSE_STATUS_CODE]:u.statusCode}),E.end()),d[Kn]=null,p(null,_)}function a(d,u,_,p){const E=d[Kn];E!=null&&(E.setStatus({code:b.SpanStatusCode.ERROR,message:_.message}),E.recordException(_)),p()}function c(d,u){const _=this[GR];return kR.includes(d)?_.call(this,d,f(u,{[Q.ATTR_SERVICE_NAME]:r[Et].servername,[Ve.HOOK_NAME]:`${this.pluginName} - ${d}`,[Ve.FASTIFY_TYPE]:Wn.INSTANCE,[Ve.HOOK_CALLBACK_NAME]:u.name?.length>0?u.name:In})):_.call(this,d,u)}function l(d,u){const _=this[VR];typeof d=="function"?(u=f(d,{[Q.ATTR_SERVICE_NAME]:r[Et].servername,[Ve.HOOK_NAME]:`${this.pluginName} - not-found-handler`,[Ve.FASTIFY_TYPE]:Wn.INSTANCE,[Ve.HOOK_CALLBACK_NAME]:d.name?.length>0?d.name:In}),_.call(this,u)):(d.preValidation!=null&&(d.preValidation=f(d.preValidation,{[Q.ATTR_SERVICE_NAME]:r[Et].servername,[Ve.HOOK_NAME]:`${this.pluginName} - not-found-handler - preValidation`,[Ve.FASTIFY_TYPE]:Wn.INSTANCE,[Ve.HOOK_CALLBACK_NAME]:d.preValidation.name?.length>0?d.preValidation.name:In})),d.preHandler!=null&&(d.preHandler=f(d.preHandler,{[Q.ATTR_SERVICE_NAME]:r[Et].servername,[Ve.HOOK_NAME]:`${this.pluginName} - not-found-handler - preHandler`,[Ve.FASTIFY_TYPE]:Wn.INSTANCE,[Ve.HOOK_CALLBACK_NAME]:d.preHandler.name?.length>0?d.preHandler.name:In})),u=f(u,{[Q.ATTR_SERVICE_NAME]:r[Et].servername,[Ve.HOOK_NAME]:`${this.pluginName} - not-found-handler`,[Ve.FASTIFY_TYPE]:Wn.INSTANCE,[Ve.HOOK_CALLBACK_NAME]:u.name?.length>0?u.name:In}),_.call(this,d,u))}function f(d,u={}){return function(...p){const E=this[Et],[T]=p;if(E.isEnabled()===!1)return d.call(this,...p);const h=T[fa]??b.context.active(),m=E.tracer.startSpan(`handler - ${d.name?.length>0?d.name:this.pluginName??In}`,{attributes:u},h);return b.context.with(b.trace.setSpan(h,m),function(){try{const A=d.call(this,...p);return typeof A?.then=="function"?A.then(g=>(m.end(),g),g=>(m.setStatus({code:b.SpanStatusCode.ERROR,message:g.message}),m.recordException(g),m.end(),Promise.reject(g))):(m.end(),A)}catch(A){throw m.setStatus({code:b.SpanStatusCode.ERROR,message:A.message}),m.recordException(A),m.end(),A}},this)}}}}}var Zn;(function(e){const t="fastify.name";e.FASTIFY_NAME=t;const n="fastify.type";e.FASTIFY_TYPE=n;const r="hook.name";e.HOOK_NAME=r;const o="plugin.name";e.PLUGIN_NAME=o})(Zn||(Zn={}));var Pu;(function(e){const t="middleware";e.MIDDLEWARE=t;const n="request_handler";e.REQUEST_HANDLER=n})(Pu||(Pu={}));var vu;(function(e){const t="middleware";e.MIDDLEWARE=t;const n="request handler";e.REQUEST_HANDLER=n})(vu||(vu={}));const Lu=Symbol("opentelemetry.instrumentation.fastify.request_active_span");function xR(e,t,n,r={}){const o=t.startSpan(n,{attributes:r}),s=e[Lu]||[];return s.push(o),Object.defineProperty(e,Lu,{enumerable:!1,configurable:!0,value:s}),o}function xd(e,t){const n=e[Lu]||[];n.length&&(n.forEach(r=>{t&&(r.setStatus({code:b.SpanStatusCode.ERROR,message:t.message}),r.recordException(t)),r.end()}),delete e[Lu])}function qj(e,t,n){let r,o;try{o=e(),$R(o)&&o.then(s=>t(void 0,s),s=>t(s))}catch(s){r=s}finally{if(!$R(o)&&(t(r,o),r))throw r;return o}}function $R(e){return typeof e=="object"&&e&&typeof Object.getOwnPropertyDescriptor(e,"then")?.value=="function"||!1}const Wj="0.1.0",Kj="@sentry/instrumentation-fastify-v3",BR="anonymous",zj=new Set(["onTimeout","onRequest","preParsing","preValidation","preSerialization","preHandler","onSend","onResponse","onError"]);class Zj extends yt{constructor(t={}){super(Kj,Wj,t)}init(){return[new dt("fastify",[">=3.0.0 <4"],t=>this._patchConstructor(t))]}_hookOnRequest(){const t=this;return function(r,o,s){if(!t.isEnabled())return s();t._wrap(o,"send",t._patchSend());const i=r,a=tl(b.context.active()),c=i.routeOptions?i.routeOptions.url:r.routerPath;c&&a?.type===Qr.HTTP&&(a.route=c);const l=r.method||"GET";je().setTransactionName(`${l} ${c}`),s()}}_wrapHandler(t,n,r,o){const s=this;return this._diag.debug("Patching fastify route.handler function"),function(...i){if(!s.isEnabled())return r.apply(this,i);const a=r.name||t||BR,c=`${vu.MIDDLEWARE} - ${a}`,l=i[1],f=xR(l,s.tracer,c,{[Zn.FASTIFY_TYPE]:Pu.MIDDLEWARE,[Zn.PLUGIN_NAME]:t,[Zn.HOOK_NAME]:n}),d=o&&i[i.length-1];return d&&(i[i.length-1]=function(...u){xd(l),d.apply(this,u)}),b.context.with(b.trace.setSpan(b.context.active(),f),()=>qj(()=>r.apply(this,i),u=>{u instanceof Error&&(f.setStatus({code:b.SpanStatusCode.ERROR,message:u.message}),f.recordException(u)),o||xd(l)}))}}_wrapAddHook(){const t=this;return this._diag.debug("Patching fastify server.addHook function"),function(n){return function(...o){const s=o[0],i=o[1],a=this.pluginName;if(!zj.has(s))return n.apply(this,o);const c=typeof o[o.length-1]=="function"&&i.constructor.name!=="AsyncFunction";return n.apply(this,[s,t._wrapHandler(a,s,i,c)])}}}_patchConstructor(t){const n=this;function r(...o){const s=t.fastify.apply(this,o);return s.addHook("onRequest",n._hookOnRequest()),s.addHook("preHandler",n._hookPreHandler()),Xj(),n._wrap(s,"addHook",n._wrapAddHook()),s}return t.errorCodes!==void 0&&(r.errorCodes=t.errorCodes),r.fastify=r,r.default=r,r}_patchSend(){const t=this;return this._diag.debug("Patching fastify reply.send function"),function(r){return function(...s){const i=s[0];return t.isEnabled()?er(()=>r.apply(this,s),a=>{!a&&i instanceof Error&&(a=i),xd(this,a)}):r.apply(this,s)}}}_hookPreHandler(){const t=this;return this._diag.debug("Patching fastify preHandler function"),function(r,o,s){if(!t.isEnabled())return s();const i=r,a=i.routeOptions?.handler||i.context?.handler,c=a?.name.startsWith("bound ")?a.name.substring(6):a?.name,l=`${vu.REQUEST_HANDLER} - ${c||this.pluginName||BR}`,f={[Zn.PLUGIN_NAME]:this.pluginName,[Zn.FASTIFY_TYPE]:Pu.REQUEST_HANDLER,[Q.SEMATTRS_HTTP_ROUTE]:i.routeOptions?i.routeOptions.url:r.routerPath};c&&(f[Zn.FASTIFY_NAME]=c);const d=xR(o,t.tracer,l,f);jP(d);const{requestHook:u}=t.getConfig();return u&&er(()=>u(d,{request:r}),_=>{_&&t._diag.error("request hook failed",_)},!0),b.context.with(b.trace.setSpan(b.context.active(),d),()=>{s()})}}}function Xj(){const e=Te();e&&e.on("spanStart",t=>{jP(t)})}function jP(e){const t=Re(e).data,n=t["fastify.type"];if(t[Ee]||!n)return;e.setAttributes({[Ge]:"auto.http.otel.fastify",[Ee]:`${n}.fastify`});const r=t["fastify.name"]||t["plugin.name"]||t["hook.name"];if(typeof r=="string"){const o=r.replace(/^fastify -> /,"").replace(/^@fastify\/otel -> /,"");e.updateName(o)}}const Cl="Fastify",Qj=Ne(`${Cl}.v3`,()=>new Zj);function Jj(){const e=Te();if(e)return e.getIntegrationByName(Cl)}function HR(e,t,n,r){const o=Jj()?.getShouldHandleError()||qP;if(r==="diagnostics-channel"&&(this.diagnosticsChannelExists=!0),this.diagnosticsChannelExists&&r==="onError-hook"){so&&x.warn("Fastify error handler was already registered via diagnostics channel.","You can safely remove `setupFastifyErrorHandler` call and set `shouldHandleError` on the integration options.");return}o(e,t,n)&&xe(e,{mechanism:{handled:!1,type:"auto.function.fastify"}})}const eq=Ne(`${Cl}.v5`,()=>{const e=new jj,t=e.plugin();return ou.subscribe("fastify.initialization",n=>{const r=n.fastify;r?.register(t).after(o=>{o?so&&x.error("Failed to setup Fastify instrumentation",o):(rq(),r&&oq(r))})}),ou.subscribe("tracing:fastify.request.handler:error",n=>{const{error:r,request:o,reply:s}=n;HR.call(HR,r,o,s,"diagnostics-channel")}),e}),tq=(({shouldHandleError:e})=>{let t;return{name:Cl,setupOnce(){t=e||qP,Qj(),eq()},getShouldHandleError(){return t},setShouldHandleError(n){t=n}}}),nq=(e={})=>tq(e);function qP(e,t,n){const r=n.statusCode;return r>=500||r<=299}function WP(e){const t=Re(e),n=t.description,r=t.data,o=r["fastify.type"],s=o==="hook",i=o===n?.startsWith("handler -"),a=n==="request"||o==="request-handler";if(r[Ee]||!i&&!a&&!s)return;const c=s?"hook":i?"middleware":a?"request-handler":"<unknown>";e.setAttributes({[Ge]:"auto.http.otel.fastify",[Ee]:`${c}.fastify`});const l=r["fastify.name"]||r["plugin.name"]||r["hook.name"];if(typeof l=="string"){const f=l.replace(/^fastify -> /,"").replace(/^@fastify\/otel -> /,"");e.updateName(f)}}function rq(){const e=Te();e&&e.on("spanStart",t=>{WP(t)})}function oq(e){e.addHook("onRequest",async(t,n)=>{if(t.opentelemetry){const{span:s}=t.opentelemetry();s&&WP(s)}const r=t.routeOptions?.url,o=t.method||"GET";je().setTransactionName(`${o} ${r}`)})}var $d={},_a={},Bd={},FR;function KP(){return FR||(FR=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpanNames=e.TokenKind=e.AllowedOperationTypes=void 0,(function(t){t.QUERY="query",t.MUTATION="mutation",t.SUBSCRIPTION="subscription"})(e.AllowedOperationTypes||(e.AllowedOperationTypes={})),(function(t){t.SOF="<SOF>",t.EOF="<EOF>",t.BANG="!",t.DOLLAR="$",t.AMP="&",t.PAREN_L="(",t.PAREN_R=")",t.SPREAD="...",t.COLON=":",t.EQUALS="=",t.AT="@",t.BRACKET_L="[",t.BRACKET_R="]",t.BRACE_L="{",t.PIPE="|",t.BRACE_R="}",t.NAME="Name",t.INT="Int",t.FLOAT="Float",t.STRING="String",t.BLOCK_STRING="BlockString",t.COMMENT="Comment"})(e.TokenKind||(e.TokenKind={})),(function(t){t.EXECUTE="graphql.execute",t.PARSE="graphql.parse",t.RESOLVE="graphql.resolve",t.VALIDATE="graphql.validate",t.SCHEMA_VALIDATE="graphql.validateSchema",t.SCHEMA_PARSE="graphql.parseSchema"})(e.SpanNames||(e.SpanNames={}))})(Bd)),Bd}var Hd={},YR;function zP(){return YR||(YR=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,(function(t){t.SOURCE="graphql.source",t.FIELD_NAME="graphql.field.name",t.FIELD_PATH="graphql.field.path",t.FIELD_TYPE="graphql.field.type",t.OPERATION_TYPE="graphql.operation.type",t.OPERATION_NAME="graphql.operation.name",t.VARIABLES="graphql.variables.",t.ERROR_VALIDATION_NAME="graphql.validation.error"})(e.AttributeNames||(e.AttributeNames={}))})(Hd)),Hd}var br={},jR;function eT(){return jR||(jR=1,Object.defineProperty(br,"__esModule",{value:!0}),br.OTEL_GRAPHQL_DATA_SYMBOL=br.OTEL_PATCHED_SYMBOL=void 0,br.OTEL_PATCHED_SYMBOL=Symbol.for("opentelemetry.patched"),br.OTEL_GRAPHQL_DATA_SYMBOL=Symbol.for("opentelemetry.graphql_data")),br}var pa={},qR;function sq(){return qR||(qR=1,Object.defineProperty(pa,"__esModule",{value:!0}),pa.OPERATION_NOT_SUPPORTED=void 0,eT(),pa.OPERATION_NOT_SUPPORTED="Operation$operationName$not supported"),pa}var Fd={},WR;function iq(){return WR||(WR=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.wrapFieldResolver=e.wrapFields=e.getSourceFromLocation=e.getOperation=e.endSpan=e.addSpanSource=e.addInputVariableAttributes=e.isPromise=void 0;const t=Me(),n=KP(),r=zP(),o=eT(),s=Object.values(n.AllowedOperationTypes),i=w=>typeof w?.then=="function";e.isPromise=i;const a=w=>typeof w=="object"&&w!==null;function c(w,k,Y){Array.isArray(Y)?Y.forEach((oe,ae)=>{c(w,`${k}.${ae}`,oe)}):Y instanceof Object?Object.entries(Y).forEach(([oe,ae])=>{c(w,`${k}.${oe}`,ae)}):w.setAttribute(`${r.AttributeNames.VARIABLES}${String(k)}`,Y)}function l(w,k){Object.entries(k).forEach(([Y,oe])=>{c(w,Y,oe)})}e.addInputVariableAttributes=l;function f(w,k,Y,oe,ae){const ne=I(k,Y,oe,ae);w.setAttribute(r.AttributeNames.SOURCE,ne)}e.addSpanSource=f;function d(w,k,Y,oe,ae){let ne=T(Y,ae);if(ne)return{field:ne,spanAdded:!1};const P=k().flatResolveSpans?m(Y):h(Y,ae);return ne={span:u(w,k,Y,oe,ae,P)},E(Y,ae,ne),{field:ne,spanAdded:!0}}function u(w,k,Y,oe,ae,ne){const M={[r.AttributeNames.FIELD_NAME]:oe.fieldName,[r.AttributeNames.FIELD_PATH]:ae.join("."),[r.AttributeNames.FIELD_TYPE]:oe.returnType.toString()},P=w.startSpan(`${n.SpanNames.RESOLVE} ${M[r.AttributeNames.FIELD_PATH]}`,{attributes:M},ne?t.trace.setSpan(t.context.active(),ne):void 0),G=Y[o.OTEL_GRAPHQL_DATA_SYMBOL].source,V=oe.fieldNodes.find(K=>K.kind==="Field");return V&&f(P,G.loc,k().allowValues,V.loc?.start,V.loc?.end),P}function _(w,k){k&&w.recordException(k),w.end()}e.endSpan=_;function p(w,k){if(!(!w||!Array.isArray(w.definitions)))return k?w.definitions.filter(Y=>s.indexOf(Y?.operation)!==-1).find(Y=>k===Y?.name?.value):w.definitions.find(Y=>s.indexOf(Y?.operation)!==-1)}e.getOperation=p;function E(w,k,Y){return w[o.OTEL_GRAPHQL_DATA_SYMBOL].fields[k.join(".")]=Y}function T(w,k){return w[o.OTEL_GRAPHQL_DATA_SYMBOL].fields[k.join(".")]}function h(w,k){for(let Y=k.length-1;Y>0;Y--){const oe=T(w,k.slice(0,Y));if(oe)return oe.span}return m(w)}function m(w){return w[o.OTEL_GRAPHQL_DATA_SYMBOL].span}function A(w,k){const Y=[];let oe=k;for(;oe;){let ae=oe.key;w&&typeof ae=="number"&&(ae="*"),Y.push(String(ae)),oe=oe.prev}return Y.reverse()}function g(w){return O(`
`,w)}function R(w){return O(" ",w)}function O(w,k){let Y="";for(let oe=0;oe<k;oe++)Y+=w;return Y}const C=[n.TokenKind.FLOAT,n.TokenKind.STRING,n.TokenKind.INT,n.TokenKind.BLOCK_STRING];function I(w,k=!1,Y,oe){let ae="";if(w?.startToken){const ne=typeof Y=="number"?Y:w.start,M=typeof oe=="number"?oe:w.end;let P=w.startToken.next,G=1;for(;P;){if(P.start<ne){P=P.next,G=P?.line;continue}if(P.end>M){P=P.next,G=P?.line;continue}let V=P.value||P.kind,K="";!k&&C.indexOf(P.kind)>=0&&(V="*"),P.kind===n.TokenKind.STRING&&(V=`"${V}"`),P.kind===n.TokenKind.EOF&&(V=""),P.line>G?(ae+=g(P.line-G),G=P.line,K=R(P.column-1)):P.line===P.prev?.line&&(K=R(P.start-(P.prev?.end||0))),ae+=K+V,P&&(P=P.next)}}return ae}e.getSourceFromLocation=I;function L(w,k,Y){if(!w||w[o.OTEL_PATCHED_SYMBOL])return;const oe=w.getFields();w[o.OTEL_PATCHED_SYMBOL]=!0,Object.keys(oe).forEach(ae=>{const ne=oe[ae];if(ne&&(ne.resolve&&(ne.resolve=F(k,Y,ne.resolve)),ne.type)){const M=U(ne.type);for(const P of M)L(P,k,Y)}})}e.wrapFields=L;function U(w){return"ofType"in w?U(w.ofType):q(w)?w.getTypes():H(w)?[w]:[]}function q(w){return"getTypes"in w&&typeof w.getTypes=="function"}function H(w){return"getFields"in w&&typeof w.getFields=="function"}const $=(w,k,Y)=>{Y&&(w.recordException(k),w.setStatus({code:t.SpanStatusCode.ERROR,message:k.message}),w.end())},B=(w,k)=>{k&&w.end()};function F(w,k,Y,oe=!1){if(ae[o.OTEL_PATCHED_SYMBOL]||typeof Y!="function")return Y;function ae(ne,M,P,G){if(!Y)return;const V=k();if(V.ignoreTrivialResolveSpans&&oe&&(a(ne)||typeof ne=="function")&&typeof ne[G.fieldName]!="function")return Y.call(this,ne,M,P,G);if(!P[o.OTEL_GRAPHQL_DATA_SYMBOL])return Y.call(this,ne,M,P,G);const K=A(V.mergeItems,G&&G.path),X=K.filter(z=>typeof z=="string").length;let v,D=!1;if(V.depth>=0&&V.depth<X)v=h(P,K);else{const{field:z,spanAdded:j}=d(w,k,P,G,K);v=z.span,D=j}return t.context.with(t.trace.setSpan(t.context.active(),v),()=>{try{const z=Y.call(this,ne,M,P,G);return(0,e.isPromise)(z)?z.then(j=>(B(v,D),j),j=>{throw $(v,j,D),j}):(B(v,D),z)}catch(z){throw $(v,z,D),z}})}return ae[o.OTEL_PATCHED_SYMBOL]=!0,ae}e.wrapFieldResolver=F})(Fd)),Fd}var Ir={},KR;function aq(){return KR||(KR=1,Object.defineProperty(Ir,"__esModule",{value:!0}),Ir.PACKAGE_NAME=Ir.PACKAGE_VERSION=void 0,Ir.PACKAGE_VERSION="0.56.0",Ir.PACKAGE_NAME="@opentelemetry/instrumentation-graphql"),Ir}var zR;function cq(){if(zR)return _a;zR=1,Object.defineProperty(_a,"__esModule",{value:!0}),_a.GraphQLInstrumentation=void 0;const e=Me(),t=Le,n=KP(),r=zP(),o=eT(),s=sq(),i=iq(),a=aq(),c={mergeItems:!1,depth:-1,allowValues:!1,ignoreResolveSpans:!1},l=[">=14.0.0 <17"];class f extends t.InstrumentationBase{constructor(u={}){super(a.PACKAGE_NAME,a.PACKAGE_VERSION,{...c,...u})}setConfig(u={}){super.setConfig({...c,...u})}init(){const u=new t.InstrumentationNodeModuleDefinition("graphql",l);return u.files.push(this._addPatchingExecute()),u.files.push(this._addPatchingParser()),u.files.push(this._addPatchingValidate()),u}_addPatchingExecute(){return new t.InstrumentationNodeModuleFile("graphql/execution/execute.js",l,u=>((0,t.isWrapped)(u.execute)&&this._unwrap(u,"execute"),this._wrap(u,"execute",this._patchExecute(u.defaultFieldResolver)),u),u=>{u&&this._unwrap(u,"execute")})}_addPatchingParser(){return new t.InstrumentationNodeModuleFile("graphql/language/parser.js",l,u=>((0,t.isWrapped)(u.parse)&&this._unwrap(u,"parse"),this._wrap(u,"parse",this._patchParse()),u),u=>{u&&this._unwrap(u,"parse")})}_addPatchingValidate(){return new t.InstrumentationNodeModuleFile("graphql/validation/validate.js",l,u=>((0,t.isWrapped)(u.validate)&&this._unwrap(u,"validate"),this._wrap(u,"validate",this._patchValidate()),u),u=>{u&&this._unwrap(u,"validate")})}_patchExecute(u){const _=this;return function(E){return function(){let h;if(arguments.length>=2){const g=arguments;h=_._wrapExecuteArgs(g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],u)}else{const g=arguments[0];h=_._wrapExecuteArgs(g.schema,g.document,g.rootValue,g.contextValue,g.variableValues,g.operationName,g.fieldResolver,g.typeResolver,u)}const m=(0,i.getOperation)(h.document,h.operationName),A=_._createExecuteSpan(m,h);return h.contextValue[o.OTEL_GRAPHQL_DATA_SYMBOL]={source:h.document?h.document||h.document[o.OTEL_GRAPHQL_DATA_SYMBOL]:void 0,span:A,fields:{}},e.context.with(e.trace.setSpan(e.context.active(),A),()=>(0,t.safeExecuteInTheMiddle)(()=>E.apply(this,[h]),(g,R)=>{_._handleExecutionResult(A,g,R)}))}}}_handleExecutionResult(u,_,p){const E=this.getConfig();if(p===void 0||_){(0,i.endSpan)(u,_);return}if((0,i.isPromise)(p))p.then(T=>{if(typeof E.responseHook!="function"){(0,i.endSpan)(u);return}this._executeResponseHook(u,T)},T=>{(0,i.endSpan)(u,T)});else{if(typeof E.responseHook!="function"){(0,i.endSpan)(u);return}this._executeResponseHook(u,p)}}_executeResponseHook(u,_){const{responseHook:p}=this.getConfig();p&&(0,t.safeExecuteInTheMiddle)(()=>{p(u,_)},E=>{E&&this._diag.error("Error running response hook",E),(0,i.endSpan)(u,void 0)},!0)}_patchParse(){const u=this;return function(p){return function(T,h){return u._parse(this,p,T,h)}}}_patchValidate(){const u=this;return function(p){return function(T,h,m,A,g){return u._validate(this,p,T,h,m,g,A)}}}_parse(u,_,p,E){const T=this.getConfig(),h=this.tracer.startSpan(n.SpanNames.PARSE);return e.context.with(e.trace.setSpan(e.context.active(),h),()=>(0,t.safeExecuteInTheMiddle)(()=>_.call(u,p,E),(m,A)=>{A&&((0,i.getOperation)(A)?A.loc&&(0,i.addSpanSource)(h,A.loc,T.allowValues):h.updateName(n.SpanNames.SCHEMA_PARSE)),(0,i.endSpan)(h,m)}))}_validate(u,_,p,E,T,h,m){const A=this.tracer.startSpan(n.SpanNames.VALIDATE,{});return e.context.with(e.trace.setSpan(e.context.active(),A),()=>(0,t.safeExecuteInTheMiddle)(()=>_.call(u,p,E,T,m,h),(g,R)=>{E.loc||A.updateName(n.SpanNames.SCHEMA_VALIDATE),R&&R.length&&A.recordException({name:r.AttributeNames.ERROR_VALIDATION_NAME,message:JSON.stringify(R)}),(0,i.endSpan)(A,g)}))}_createExecuteSpan(u,_){const p=this.getConfig(),E=this.tracer.startSpan(n.SpanNames.EXECUTE,{});if(u){const{operation:T,name:h}=u;E.setAttribute(r.AttributeNames.OPERATION_TYPE,T);const m=h?.value;m?(E.setAttribute(r.AttributeNames.OPERATION_NAME,m),E.updateName(`${T} ${m}`)):E.updateName(T)}else{let T=" ";_.operationName&&(T=` "${_.operationName}" `),T=s.OPERATION_NOT_SUPPORTED.replace("$operationName$",T),E.setAttribute(r.AttributeNames.OPERATION_NAME,T)}return _.document?.loc&&(0,i.addSpanSource)(E,_.document.loc,p.allowValues),_.variableValues&&p.allowValues&&(0,i.addInputVariableAttributes)(E,_.variableValues),E}_wrapExecuteArgs(u,_,p,E,T,h,m,A,g){if(E||(E={}),E[o.OTEL_GRAPHQL_DATA_SYMBOL]||this.getConfig().ignoreResolveSpans)return{schema:u,document:_,rootValue:p,contextValue:E,variableValues:T,operationName:h,fieldResolver:m,typeResolver:A};const R=m==null,O=m??g;return m=(0,i.wrapFieldResolver)(this.tracer,()=>this.getConfig(),O,R),u&&((0,i.wrapFields)(u.getQueryType(),this.tracer,()=>this.getConfig()),(0,i.wrapFields)(u.getMutationType(),this.tracer,()=>this.getConfig())),{schema:u,document:_,rootValue:p,contextValue:E,variableValues:T,operationName:h,fieldResolver:m,typeResolver:A}}}return _a.GraphQLInstrumentation=f,_a}var ZR;function uq(){return ZR||(ZR=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.GraphQLInstrumentation=void 0;var t=cq();Object.defineProperty(e,"GraphQLInstrumentation",{enumerable:!0,get:function(){return t.GraphQLInstrumentation}})})($d)),$d}var lq=uq();const ZP="Graphql",dq=Ne(ZP,lq.GraphQLInstrumentation,e=>{const t=XP(e);return{...t,responseHook(n,r){Nt(n,"auto.graphql.otel.graphql"),r.errors?.length&&!Re(n).status&&n.setStatus({code:b.SpanStatusCode.ERROR});const s=Re(n).data,i=s["graphql.operation.type"],a=s["graphql.operation.name"];if(t.useOperationNameForRootSpan&&i){const c=Ft(n),f=Re(c).data[Fa]||[],d=a?`${i} ${a}`:`${i}`;Array.isArray(f)?(f.push(d),c.setAttribute(Fa,f)):typeof f=="string"?c.setAttribute(Fa,[f,d]):c.setAttribute(Fa,d),Re(c).data["original-description"]||c.setAttribute("original-description",Re(c).description),c.updateName(`${Re(c).data["original-description"]} (${pq(f)})`)}}}}),fq=((e={})=>({name:ZP,setupOnce(){dq(XP(e))}})),_q=fq;function XP(e){return{ignoreResolveSpans:!0,ignoreTrivialResolveSpans:!0,useOperationNameForRootSpan:!0,...e}}function pq(e){if(Array.isArray(e)){const t=e.slice().sort();return t.length<=5?t.join(", "):`${t.slice(0,5).join(", ")}, +${t.length-5}`}return`${e}`}var Yd={},Ea={},Ta={},XR;function Eq(){return XR||(XR=1,Object.defineProperty(Ta,"__esModule",{value:!0}),Ta.EVENT_LISTENERS_SET=void 0,Ta.EVENT_LISTENERS_SET=Symbol("opentelemetry.instrumentation.kafkajs.eventListenersSet")),Ta}var ha={},QR;function Tq(){return QR||(QR=1,Object.defineProperty(ha,"__esModule",{value:!0}),ha.bufferTextMapGetter=void 0,ha.bufferTextMapGetter={get(e,t){if(!e)return;const n=Object.keys(e);for(const r of n)if(r===t||r.toLowerCase()===t)return e[r]?.toString()},keys(e){return e?Object.keys(e):[]}}),ha}var Se={},JR;function hq(){return JR||(JR=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.METRIC_MESSAGING_PROCESS_DURATION=Se.METRIC_MESSAGING_CLIENT_SENT_MESSAGES=Se.METRIC_MESSAGING_CLIENT_OPERATION_DURATION=Se.METRIC_MESSAGING_CLIENT_CONSUMED_MESSAGES=Se.MESSAGING_SYSTEM_VALUE_KAFKA=Se.MESSAGING_OPERATION_TYPE_VALUE_SEND=Se.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE=Se.MESSAGING_OPERATION_TYPE_VALUE_PROCESS=Se.ATTR_MESSAGING_SYSTEM=Se.ATTR_MESSAGING_OPERATION_TYPE=Se.ATTR_MESSAGING_OPERATION_NAME=Se.ATTR_MESSAGING_KAFKA_OFFSET=Se.ATTR_MESSAGING_KAFKA_MESSAGE_TOMBSTONE=Se.ATTR_MESSAGING_KAFKA_MESSAGE_KEY=Se.ATTR_MESSAGING_DESTINATION_PARTITION_ID=Se.ATTR_MESSAGING_DESTINATION_NAME=Se.ATTR_MESSAGING_BATCH_MESSAGE_COUNT=void 0,Se.ATTR_MESSAGING_BATCH_MESSAGE_COUNT="messaging.batch.message_count",Se.ATTR_MESSAGING_DESTINATION_NAME="messaging.destination.name",Se.ATTR_MESSAGING_DESTINATION_PARTITION_ID="messaging.destination.partition.id",Se.ATTR_MESSAGING_KAFKA_MESSAGE_KEY="messaging.kafka.message.key",Se.ATTR_MESSAGING_KAFKA_MESSAGE_TOMBSTONE="messaging.kafka.message.tombstone",Se.ATTR_MESSAGING_KAFKA_OFFSET="messaging.kafka.offset",Se.ATTR_MESSAGING_OPERATION_NAME="messaging.operation.name",Se.ATTR_MESSAGING_OPERATION_TYPE="messaging.operation.type",Se.ATTR_MESSAGING_SYSTEM="messaging.system",Se.MESSAGING_OPERATION_TYPE_VALUE_PROCESS="process",Se.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE="receive",Se.MESSAGING_OPERATION_TYPE_VALUE_SEND="send",Se.MESSAGING_SYSTEM_VALUE_KAFKA="kafka",Se.METRIC_MESSAGING_CLIENT_CONSUMED_MESSAGES="messaging.client.consumed.messages",Se.METRIC_MESSAGING_CLIENT_OPERATION_DURATION="messaging.client.operation.duration",Se.METRIC_MESSAGING_CLIENT_SENT_MESSAGES="messaging.client.sent.messages",Se.METRIC_MESSAGING_PROCESS_DURATION="messaging.process.duration"),Se}var Cr={},eN;function Sq(){return eN||(eN=1,Object.defineProperty(Cr,"__esModule",{value:!0}),Cr.PACKAGE_NAME=Cr.PACKAGE_VERSION=void 0,Cr.PACKAGE_VERSION="0.18.0",Cr.PACKAGE_NAME="@opentelemetry/instrumentation-kafkajs"),Cr}var tN;function mq(){if(tN)return Ea;tN=1,Object.defineProperty(Ea,"__esModule",{value:!0}),Ea.KafkaJsInstrumentation=void 0;const e=Me(),t=Le,n=_t(),r=Eq(),o=Tq(),s=hq(),i=Sq();function a(d,u,_){return p=>{d.add(u,{..._,...p?{[n.ATTR_ERROR_TYPE]:p}:{}})}}function c(d,u,_){return p=>{d.record((Date.now()-u)/1e3,{..._,...p?{[n.ATTR_ERROR_TYPE]:p}:{}})}}const l=[.005,.01,.025,.05,.075,.1,.25,.5,.75,1,2.5,5,7.5,10];class f extends t.InstrumentationBase{constructor(u={}){super(i.PACKAGE_NAME,i.PACKAGE_VERSION,u)}_updateMetricInstruments(){this._clientDuration=this.meter.createHistogram(s.METRIC_MESSAGING_CLIENT_OPERATION_DURATION,{advice:{explicitBucketBoundaries:l}}),this._sentMessages=this.meter.createCounter(s.METRIC_MESSAGING_CLIENT_SENT_MESSAGES),this._consumedMessages=this.meter.createCounter(s.METRIC_MESSAGING_CLIENT_CONSUMED_MESSAGES),this._processDuration=this.meter.createHistogram(s.METRIC_MESSAGING_PROCESS_DURATION,{advice:{explicitBucketBoundaries:l}})}init(){const u=p=>{(0,t.isWrapped)(p?.Kafka?.prototype.producer)&&this._unwrap(p.Kafka.prototype,"producer"),(0,t.isWrapped)(p?.Kafka?.prototype.consumer)&&this._unwrap(p.Kafka.prototype,"consumer")};return new t.InstrumentationNodeModuleDefinition("kafkajs",[">=0.3.0 <3"],p=>(u(p),this._wrap(p?.Kafka?.prototype,"producer",this._getProducerPatch()),this._wrap(p?.Kafka?.prototype,"consumer",this._getConsumerPatch()),p),u)}_getConsumerPatch(){const u=this;return _=>function(...E){const T=_.apply(this,E);return(0,t.isWrapped)(T.run)&&u._unwrap(T,"run"),u._wrap(T,"run",u._getConsumerRunPatch()),u._setKafkaEventListeners(T),T}}_setKafkaEventListeners(u){u[r.EVENT_LISTENERS_SET]||(u.events?.REQUEST&&u.on(u.events.REQUEST,this._recordClientDurationMetric.bind(this)),u[r.EVENT_LISTENERS_SET]=!0)}_recordClientDurationMetric(u){const[_,p]=u.payload.broker.split(":");this._clientDuration.record(u.payload.duration/1e3,{[s.ATTR_MESSAGING_SYSTEM]:s.MESSAGING_SYSTEM_VALUE_KAFKA,[s.ATTR_MESSAGING_OPERATION_NAME]:`${u.payload.apiName}`,[n.ATTR_SERVER_ADDRESS]:_,[n.ATTR_SERVER_PORT]:Number.parseInt(p,10)})}_getProducerPatch(){const u=this;return _=>function(...E){const T=_.apply(this,E);return(0,t.isWrapped)(T.sendBatch)&&u._unwrap(T,"sendBatch"),u._wrap(T,"sendBatch",u._getSendBatchPatch()),(0,t.isWrapped)(T.send)&&u._unwrap(T,"send"),u._wrap(T,"send",u._getSendPatch()),(0,t.isWrapped)(T.transaction)&&u._unwrap(T,"transaction"),u._wrap(T,"transaction",u._getProducerTransactionPatch()),u._setKafkaEventListeners(T),T}}_getConsumerRunPatch(){const u=this;return _=>function(...E){const T=E[0];return T?.eachMessage&&((0,t.isWrapped)(T.eachMessage)&&u._unwrap(T,"eachMessage"),u._wrap(T,"eachMessage",u._getConsumerEachMessagePatch())),T?.eachBatch&&((0,t.isWrapped)(T.eachBatch)&&u._unwrap(T,"eachBatch"),u._wrap(T,"eachBatch",u._getConsumerEachBatchPatch())),_.call(this,T)}}_getConsumerEachMessagePatch(){const u=this;return _=>function(...E){const T=E[0],h=e.propagation.extract(e.ROOT_CONTEXT,T.message.headers,o.bufferTextMapGetter),m=u._startConsumerSpan({topic:T.topic,message:T.message,operationType:s.MESSAGING_OPERATION_TYPE_VALUE_PROCESS,ctx:h,attributes:{[s.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(T.partition)}}),A=[c(u._processDuration,Date.now(),{[s.ATTR_MESSAGING_SYSTEM]:s.MESSAGING_SYSTEM_VALUE_KAFKA,[s.ATTR_MESSAGING_OPERATION_NAME]:"process",[s.ATTR_MESSAGING_DESTINATION_NAME]:T.topic,[s.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(T.partition)}),a(u._consumedMessages,1,{[s.ATTR_MESSAGING_SYSTEM]:s.MESSAGING_SYSTEM_VALUE_KAFKA,[s.ATTR_MESSAGING_OPERATION_NAME]:"process",[s.ATTR_MESSAGING_DESTINATION_NAME]:T.topic,[s.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(T.partition)})],g=e.context.with(e.trace.setSpan(h,m),()=>_.apply(this,E));return u._endSpansOnPromise([m],A,g)}}_getConsumerEachBatchPatch(){return u=>{const _=this;return function(...E){const T=E[0],h=_._startConsumerSpan({topic:T.batch.topic,message:void 0,operationType:s.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE,ctx:e.ROOT_CONTEXT,attributes:{[s.ATTR_MESSAGING_BATCH_MESSAGE_COUNT]:T.batch.messages.length,[s.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(T.batch.partition)}});return e.context.with(e.trace.setSpan(e.context.active(),h),()=>{const m=Date.now(),A=[],g=[a(_._consumedMessages,T.batch.messages.length,{[s.ATTR_MESSAGING_SYSTEM]:s.MESSAGING_SYSTEM_VALUE_KAFKA,[s.ATTR_MESSAGING_OPERATION_NAME]:"process",[s.ATTR_MESSAGING_DESTINATION_NAME]:T.batch.topic,[s.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(T.batch.partition)})];T.batch.messages.forEach(O=>{const C=e.propagation.extract(e.ROOT_CONTEXT,O.headers,o.bufferTextMapGetter),I=e.trace.getSpan(C)?.spanContext();let L;I&&(L={context:I}),A.push(_._startConsumerSpan({topic:T.batch.topic,message:O,operationType:s.MESSAGING_OPERATION_TYPE_VALUE_PROCESS,link:L,attributes:{[s.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(T.batch.partition)}})),g.push(c(_._processDuration,m,{[s.ATTR_MESSAGING_SYSTEM]:s.MESSAGING_SYSTEM_VALUE_KAFKA,[s.ATTR_MESSAGING_OPERATION_NAME]:"process",[s.ATTR_MESSAGING_DESTINATION_NAME]:T.batch.topic,[s.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(T.batch.partition)}))});const R=u.apply(this,E);return A.unshift(h),_._endSpansOnPromise(A,g,R)})}}}_getProducerTransactionPatch(){const u=this;return _=>function(...E){const T=u.tracer.startSpan("transaction"),h=_.apply(this,E);return h.then(m=>{const A=m.send;m.send=function(...I){return e.context.with(e.trace.setSpan(e.context.active(),T),()=>u._getSendPatch()(A).apply(this,I).catch(U=>{throw T.setStatus({code:e.SpanStatusCode.ERROR,message:U?.message}),T.recordException(U),U}))};const g=m.sendBatch;m.sendBatch=function(...I){return e.context.with(e.trace.setSpan(e.context.active(),T),()=>u._getSendBatchPatch()(g).apply(this,I).catch(U=>{throw T.setStatus({code:e.SpanStatusCode.ERROR,message:U?.message}),T.recordException(U),U}))};const R=m.commit;m.commit=function(...I){const L=R.apply(this,I).then(()=>{T.setStatus({code:e.SpanStatusCode.OK})});return u._endSpansOnPromise([T],[],L)};const O=m.abort;m.abort=function(...I){const L=O.apply(this,I);return u._endSpansOnPromise([T],[],L)}}).catch(m=>{T.setStatus({code:e.SpanStatusCode.ERROR,message:m?.message}),T.recordException(m),T.end()}),h}}_getSendBatchPatch(){const u=this;return _=>function(...E){const h=E[0].topicMessages||[],m=[],A=[];h.forEach(R=>{R.messages.forEach(O=>{m.push(u._startProducerSpan(R.topic,O)),A.push(a(u._sentMessages,1,{[s.ATTR_MESSAGING_SYSTEM]:s.MESSAGING_SYSTEM_VALUE_KAFKA,[s.ATTR_MESSAGING_OPERATION_NAME]:"send",[s.ATTR_MESSAGING_DESTINATION_NAME]:R.topic,...O.partition!==void 0?{[s.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(O.partition)}:{}}))})});const g=_.apply(this,E);return u._endSpansOnPromise(m,A,g)}}_getSendPatch(){const u=this;return _=>function(...E){const T=E[0],h=T.messages.map(g=>u._startProducerSpan(T.topic,g)),m=T.messages.map(g=>a(u._sentMessages,1,{[s.ATTR_MESSAGING_SYSTEM]:s.MESSAGING_SYSTEM_VALUE_KAFKA,[s.ATTR_MESSAGING_OPERATION_NAME]:"send",[s.ATTR_MESSAGING_DESTINATION_NAME]:T.topic,...g.partition!==void 0?{[s.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(g.partition)}:{}})),A=_.apply(this,E);return u._endSpansOnPromise(h,m,A)}}_endSpansOnPromise(u,_,p){return Promise.resolve(p).then(E=>(_.forEach(T=>T()),E)).catch(E=>{let T,h=n.ERROR_TYPE_VALUE_OTHER;throw typeof E=="string"||E===void 0?T=E:typeof E=="object"&&Object.prototype.hasOwnProperty.call(E,"message")&&(T=E.message,h=E.constructor.name),_.forEach(m=>m(h)),u.forEach(m=>{m.setAttribute(n.ATTR_ERROR_TYPE,h),m.setStatus({code:e.SpanStatusCode.ERROR,message:T})}),E}).finally(()=>{u.forEach(E=>E.end())})}_startConsumerSpan({topic:u,message:_,operationType:p,ctx:E,link:T,attributes:h}){const m=p===s.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE?"poll":p,A=this.tracer.startSpan(`${m} ${u}`,{kind:p===s.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE?e.SpanKind.CLIENT:e.SpanKind.CONSUMER,attributes:{...h,[s.ATTR_MESSAGING_SYSTEM]:s.MESSAGING_SYSTEM_VALUE_KAFKA,[s.ATTR_MESSAGING_DESTINATION_NAME]:u,[s.ATTR_MESSAGING_OPERATION_TYPE]:p,[s.ATTR_MESSAGING_OPERATION_NAME]:m,[s.ATTR_MESSAGING_KAFKA_MESSAGE_KEY]:_?.key?String(_.key):void 0,[s.ATTR_MESSAGING_KAFKA_MESSAGE_TOMBSTONE]:_?.key&&_.value===null?!0:void 0,[s.ATTR_MESSAGING_KAFKA_OFFSET]:_?.offset},links:T?[T]:[]},E),{consumerHook:g}=this.getConfig();return g&&_&&(0,t.safeExecuteInTheMiddle)(()=>g(A,{topic:u,message:_}),R=>{R&&this._diag.error("consumerHook error",R)},!0),A}_startProducerSpan(u,_){const p=this.tracer.startSpan(`send ${u}`,{kind:e.SpanKind.PRODUCER,attributes:{[s.ATTR_MESSAGING_SYSTEM]:s.MESSAGING_SYSTEM_VALUE_KAFKA,[s.ATTR_MESSAGING_DESTINATION_NAME]:u,[s.ATTR_MESSAGING_KAFKA_MESSAGE_KEY]:_.key?String(_.key):void 0,[s.ATTR_MESSAGING_KAFKA_MESSAGE_TOMBSTONE]:_.key&&_.value===null?!0:void 0,[s.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:_.partition!==void 0?String(_.partition):void 0,[s.ATTR_MESSAGING_OPERATION_NAME]:"send",[s.ATTR_MESSAGING_OPERATION_TYPE]:s.MESSAGING_OPERATION_TYPE_VALUE_SEND}});_.headers=_.headers??{},e.propagation.inject(e.trace.setSpan(e.context.active(),p),_.headers);const{producerHook:E}=this.getConfig();return E&&(0,t.safeExecuteInTheMiddle)(()=>E(p,{topic:u,message:_}),T=>{T&&this._diag.error("producerHook error",T)},!0),p}}return Ea.KafkaJsInstrumentation=f,Ea}var nN;function Aq(){return nN||(nN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.KafkaJsInstrumentation=void 0;var t=mq();Object.defineProperty(e,"KafkaJsInstrumentation",{enumerable:!0,get:function(){return t.KafkaJsInstrumentation}})})(Yd)),Yd}var gq=Aq();const QP="Kafka",Rq=Ne(QP,()=>new gq.KafkaJsInstrumentation({consumerHook(e){Nt(e,"auto.kafkajs.otel.consumer")},producerHook(e){Nt(e,"auto.kafkajs.otel.producer")}})),Nq=(()=>({name:QP,setupOnce(){Rq()}})),yq=Nq;var jd={},Sa={},Mr={},rN;function Oq(){return rN||(rN=1,Object.defineProperty(Mr,"__esModule",{value:!0}),Mr.PACKAGE_NAME=Mr.PACKAGE_VERSION=void 0,Mr.PACKAGE_VERSION="0.53.0",Mr.PACKAGE_NAME="@opentelemetry/instrumentation-lru-memoizer"),Mr}var oN;function bq(){if(oN)return Sa;oN=1,Object.defineProperty(Sa,"__esModule",{value:!0}),Sa.LruMemoizerInstrumentation=void 0;const e=Me(),t=Le,n=Oq();class r extends t.InstrumentationBase{constructor(s={}){super(n.PACKAGE_NAME,n.PACKAGE_VERSION,s)}init(){return[new t.InstrumentationNodeModuleDefinition("lru-memoizer",[">=1.3 <3"],s=>{const i=function(){const a=s.apply(this,arguments);return function(){const c=[...arguments],l=c.pop(),f=typeof l=="function"?e.context.bind(e.context.active(),l):l;return c.push(f),a.apply(this,c)}};return i.sync=s.sync,i},void 0)]}}return Sa.LruMemoizerInstrumentation=r,Sa}var sN;function Iq(){return sN||(sN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.LruMemoizerInstrumentation=void 0;var t=bq();Object.defineProperty(e,"LruMemoizerInstrumentation",{enumerable:!0,get:function(){return t.LruMemoizerInstrumentation}})})(jd)),jd}var Cq=Iq();const JP="LruMemoizer",Mq=Ne(JP,()=>new Cq.LruMemoizerInstrumentation),Pq=(()=>({name:JP,setupOnce(){Mq()}})),vq=Pq;var qd={},ma={},Be={},iN;function Lq(){return iN||(iN=1,Object.defineProperty(Be,"__esModule",{value:!0}),Be.METRIC_DB_CLIENT_CONNECTIONS_USAGE=Be.DB_SYSTEM_VALUE_MONGODB=Be.ATTR_NET_PEER_PORT=Be.ATTR_NET_PEER_NAME=Be.ATTR_DB_SYSTEM=Be.ATTR_DB_STATEMENT=Be.ATTR_DB_OPERATION=Be.ATTR_DB_NAME=Be.ATTR_DB_MONGODB_COLLECTION=Be.ATTR_DB_CONNECTION_STRING=void 0,Be.ATTR_DB_CONNECTION_STRING="db.connection_string",Be.ATTR_DB_MONGODB_COLLECTION="db.mongodb.collection",Be.ATTR_DB_NAME="db.name",Be.ATTR_DB_OPERATION="db.operation",Be.ATTR_DB_STATEMENT="db.statement",Be.ATTR_DB_SYSTEM="db.system",Be.ATTR_NET_PEER_NAME="net.peer.name",Be.ATTR_NET_PEER_PORT="net.peer.port",Be.DB_SYSTEM_VALUE_MONGODB="mongodb",Be.METRIC_DB_CLIENT_CONNECTIONS_USAGE="db.client.connections.usage"),Be}var Wd={},aN;function Dq(){return aN||(aN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MongodbCommandType=void 0,(function(t){t.CREATE_INDEXES="createIndexes",t.FIND_AND_MODIFY="findAndModify",t.IS_MASTER="isMaster",t.COUNT="count",t.AGGREGATE="aggregate",t.UNKNOWN="unknown"})(e.MongodbCommandType||(e.MongodbCommandType={}))})(Wd)),Wd}var Pr={},cN;function wq(){return cN||(cN=1,Object.defineProperty(Pr,"__esModule",{value:!0}),Pr.PACKAGE_NAME=Pr.PACKAGE_VERSION=void 0,Pr.PACKAGE_VERSION="0.61.0",Pr.PACKAGE_NAME="@opentelemetry/instrumentation-mongodb"),Pr}var uN;function Uq(){if(uN)return ma;uN=1,Object.defineProperty(ma,"__esModule",{value:!0}),ma.MongoDBInstrumentation=void 0;const e=Me(),t=Le,n=Lq(),r=Dq(),o=wq(),s={requireParentSpan:!0};class i extends t.InstrumentationBase{constructor(c={}){super(o.PACKAGE_NAME,o.PACKAGE_VERSION,{...s,...c})}setConfig(c={}){super.setConfig({...s,...c})}_updateMetricInstruments(){this._connectionsUsage=this.meter.createUpDownCounter(n.METRIC_DB_CLIENT_CONNECTIONS_USAGE,{description:"The number of connections that are currently in state described by the state attribute.",unit:"{connection}"})}init(){const{v3PatchConnection:c,v3UnpatchConnection:l}=this._getV3ConnectionPatches(),{v4PatchConnect:f,v4UnpatchConnect:d}=this._getV4ConnectPatches(),{v4PatchConnectionCallback:u,v4PatchConnectionPromise:_,v4UnpatchConnection:p}=this._getV4ConnectionPatches(),{v4PatchConnectionPool:E,v4UnpatchConnectionPool:T}=this._getV4ConnectionPoolPatches(),{v4PatchSessions:h,v4UnpatchSessions:m}=this._getV4SessionsPatches();return[new t.InstrumentationNodeModuleDefinition("mongodb",[">=3.3.0 <4"],void 0,void 0,[new t.InstrumentationNodeModuleFile("mongodb/lib/core/wireprotocol/index.js",[">=3.3.0 <4"],c,l)]),new t.InstrumentationNodeModuleDefinition("mongodb",[">=4.0.0 <7"],void 0,void 0,[new t.InstrumentationNodeModuleFile("mongodb/lib/cmap/connection.js",[">=4.0.0 <6.4"],u,p),new t.InstrumentationNodeModuleFile("mongodb/lib/cmap/connection.js",[">=6.4.0 <7"],_,p),new t.InstrumentationNodeModuleFile("mongodb/lib/cmap/connection_pool.js",[">=4.0.0 <6.4"],E,T),new t.InstrumentationNodeModuleFile("mongodb/lib/cmap/connect.js",[">=4.0.0 <7"],f,d),new t.InstrumentationNodeModuleFile("mongodb/lib/sessions.js",[">=4.0.0 <7"],h,m)])]}_getV3ConnectionPatches(){return{v3PatchConnection:c=>((0,t.isWrapped)(c.insert)&&this._unwrap(c,"insert"),this._wrap(c,"insert",this._getV3PatchOperation("insert")),(0,t.isWrapped)(c.remove)&&this._unwrap(c,"remove"),this._wrap(c,"remove",this._getV3PatchOperation("remove")),(0,t.isWrapped)(c.update)&&this._unwrap(c,"update"),this._wrap(c,"update",this._getV3PatchOperation("update")),(0,t.isWrapped)(c.command)&&this._unwrap(c,"command"),this._wrap(c,"command",this._getV3PatchCommand()),(0,t.isWrapped)(c.query)&&this._unwrap(c,"query"),this._wrap(c,"query",this._getV3PatchFind()),(0,t.isWrapped)(c.getMore)&&this._unwrap(c,"getMore"),this._wrap(c,"getMore",this._getV3PatchCursor()),c),v3UnpatchConnection:c=>{c!==void 0&&(this._unwrap(c,"insert"),this._unwrap(c,"remove"),this._unwrap(c,"update"),this._unwrap(c,"command"),this._unwrap(c,"query"),this._unwrap(c,"getMore"))}}}_getV4SessionsPatches(){return{v4PatchSessions:c=>((0,t.isWrapped)(c.acquire)&&this._unwrap(c,"acquire"),this._wrap(c.ServerSessionPool.prototype,"acquire",this._getV4AcquireCommand()),(0,t.isWrapped)(c.release)&&this._unwrap(c,"release"),this._wrap(c.ServerSessionPool.prototype,"release",this._getV4ReleaseCommand()),c),v4UnpatchSessions:c=>{c!==void 0&&((0,t.isWrapped)(c.acquire)&&this._unwrap(c,"acquire"),(0,t.isWrapped)(c.release)&&this._unwrap(c,"release"))}}}_getV4AcquireCommand(){const c=this;return l=>function(){const d=this.sessions.length,u=l.call(this),_=this.sessions.length;return d===_?c._connectionsUsage.add(1,{state:"used","pool.name":c._poolName}):d-1===_&&(c._connectionsUsage.add(-1,{state:"idle","pool.name":c._poolName}),c._connectionsUsage.add(1,{state:"used","pool.name":c._poolName})),u}}_getV4ReleaseCommand(){const c=this;return l=>function(d){const u=l.call(this,d);return c._connectionsUsage.add(-1,{state:"used","pool.name":c._poolName}),c._connectionsUsage.add(1,{state:"idle","pool.name":c._poolName}),u}}_getV4ConnectionPoolPatches(){return{v4PatchConnectionPool:c=>{const l=c.ConnectionPool.prototype;return(0,t.isWrapped)(l.checkOut)&&this._unwrap(l,"checkOut"),this._wrap(l,"checkOut",this._getV4ConnectionPoolCheckOut()),c},v4UnpatchConnectionPool:c=>{c!==void 0&&this._unwrap(c.ConnectionPool.prototype,"checkOut")}}}_getV4ConnectPatches(){return{v4PatchConnect:c=>((0,t.isWrapped)(c.connect)&&this._unwrap(c,"connect"),this._wrap(c,"connect",this._getV4ConnectCommand()),c),v4UnpatchConnect:c=>{c!==void 0&&this._unwrap(c,"connect")}}}_getV4ConnectionPoolCheckOut(){return c=>function(f){const d=e.context.bind(e.context.active(),f);return c.call(this,d)}}_getV4ConnectCommand(){const c=this;return l=>function(d,u){if(l.length===1){const p=l.call(this,d);return p&&typeof p.then=="function"&&p.then(()=>c.setPoolName(d),()=>{}),p}const _=function(p,E){if(p||!E){u(p,E);return}c.setPoolName(d),u(p,E)};return l.call(this,d,_)}}_getV4ConnectionPatches(){return{v4PatchConnectionCallback:c=>((0,t.isWrapped)(c.Connection.prototype.command)&&this._unwrap(c.Connection.prototype,"command"),this._wrap(c.Connection.prototype,"command",this._getV4PatchCommandCallback()),c),v4PatchConnectionPromise:c=>((0,t.isWrapped)(c.Connection.prototype.command)&&this._unwrap(c.Connection.prototype,"command"),this._wrap(c.Connection.prototype,"command",this._getV4PatchCommandPromise()),c),v4UnpatchConnection:c=>{c!==void 0&&this._unwrap(c.Connection.prototype,"command")}}}_getV3PatchOperation(c){const l=this;return f=>function(u,_,p,E,T){const h=e.trace.getSpan(e.context.active()),m=l._checkSkipInstrumentation(h),A=typeof E=="function"?E:T;if(m||typeof A!="function"||typeof p!="object")return typeof E=="function"?f.call(this,u,_,p,E):f.call(this,u,_,p,E,T);const g=l.tracer.startSpan(`mongodb.${c}`,{kind:e.SpanKind.CLIENT});l._populateV3Attributes(g,_,u,p[0],c);const R=l._patchEnd(g,A);return typeof E=="function"?f.call(this,u,_,p,R):f.call(this,u,_,p,E,R)}}_getV3PatchCommand(){const c=this;return l=>function(d,u,_,p,E){const T=e.trace.getSpan(e.context.active()),h=c._checkSkipInstrumentation(T),m=typeof p=="function"?p:E;if(h||typeof m!="function"||typeof _!="object")return typeof p=="function"?l.call(this,d,u,_,p):l.call(this,d,u,_,p,E);const A=i._getCommandType(_),g=A===r.MongodbCommandType.UNKNOWN?"command":A,R=c.tracer.startSpan(`mongodb.${g}`,{kind:e.SpanKind.CLIENT}),O=A===r.MongodbCommandType.UNKNOWN?void 0:A;c._populateV3Attributes(R,u,d,_,O);const C=c._patchEnd(R,m);return typeof p=="function"?l.call(this,d,u,_,C):l.call(this,d,u,_,p,C)}}_getV4PatchCommandCallback(){const c=this;return l=>function(d,u,_,p){const E=e.trace.getSpan(e.context.active()),T=c._checkSkipInstrumentation(E),h=p,m=Object.keys(u)[0];if(typeof u!="object"||u.ismaster||u.hello)return l.call(this,d,u,_,p);let A;T||(A=c.tracer.startSpan(`mongodb.${m}`,{kind:e.SpanKind.CLIENT}),c._populateV4Attributes(A,this,d,u,m));const g=c._patchEnd(A,h,this.id,m);return l.call(this,d,u,_,g)}}_getV4PatchCommandPromise(){const c=this;return l=>function(...d){const[u,_]=d,p=e.trace.getSpan(e.context.active()),E=c._checkSkipInstrumentation(p),T=Object.keys(_)[0],h=()=>{};if(typeof _!="object"||_.ismaster||_.hello)return l.apply(this,d);let m;E||(m=c.tracer.startSpan(`mongodb.${T}`,{kind:e.SpanKind.CLIENT}),c._populateV4Attributes(m,this,u,_,T));const A=c._patchEnd(m,h,this.id,T),g=l.apply(this,d);return g.then(R=>A(null,R),R=>A(R)),g}}_getV3PatchFind(){const c=this;return l=>function(d,u,_,p,E,T){const h=e.trace.getSpan(e.context.active()),m=c._checkSkipInstrumentation(h),A=typeof E=="function"?E:T;if(m||typeof A!="function"||typeof _!="object")return typeof E=="function"?l.call(this,d,u,_,p,E):l.call(this,d,u,_,p,E,T);const g=c.tracer.startSpan("mongodb.find",{kind:e.SpanKind.CLIENT});c._populateV3Attributes(g,u,d,_,"find");const R=c._patchEnd(g,A);return typeof E=="function"?l.call(this,d,u,_,p,R):l.call(this,d,u,_,p,E,R)}}_getV3PatchCursor(){const c=this;return l=>function(d,u,_,p,E,T){const h=e.trace.getSpan(e.context.active()),m=c._checkSkipInstrumentation(h),A=typeof E=="function"?E:T;if(m||typeof A!="function")return typeof E=="function"?l.call(this,d,u,_,p,E):l.call(this,d,u,_,p,E,T);const g=c.tracer.startSpan("mongodb.getMore",{kind:e.SpanKind.CLIENT});c._populateV3Attributes(g,u,d,_.cmd,"getMore");const R=c._patchEnd(g,A);return typeof E=="function"?l.call(this,d,u,_,p,R):l.call(this,d,u,_,p,E,R)}}static _getCommandType(c){return c.createIndexes!==void 0?r.MongodbCommandType.CREATE_INDEXES:c.findandmodify!==void 0?r.MongodbCommandType.FIND_AND_MODIFY:c.ismaster!==void 0?r.MongodbCommandType.IS_MASTER:c.count!==void 0?r.MongodbCommandType.COUNT:c.aggregate!==void 0?r.MongodbCommandType.AGGREGATE:r.MongodbCommandType.UNKNOWN}_populateV4Attributes(c,l,f,d,u){let _,p;if(l){const T=typeof l.address=="string"?l.address.split(":"):"";T.length===2&&(_=T[0],p=T[1])}let E;d?.documents&&d.documents[0]?E=d.documents[0]:d?.cursors?E=d.cursors:E=d,this._addAllSpanAttributes(c,f.db,f.collection,_,p,E,u)}_populateV3Attributes(c,l,f,d,u){let _,p;if(f&&f.s&&(_=f.s.options?.host??f.s.host,p=(f.s.options?.port??f.s.port)?.toString(),_==null||p==null)){const m=f.description?.address;if(m){const A=m.split(":");_=A[0],p=A[1]}}const[E,T]=l.toString().split("."),h=d?.query??d?.q??d;this._addAllSpanAttributes(c,E,T,_,p,h,u)}_addAllSpanAttributes(c,l,f,d,u,_,p){if(c.setAttributes({[n.ATTR_DB_SYSTEM]:n.DB_SYSTEM_VALUE_MONGODB,[n.ATTR_DB_NAME]:l,[n.ATTR_DB_MONGODB_COLLECTION]:f,[n.ATTR_DB_OPERATION]:p,[n.ATTR_DB_CONNECTION_STRING]:`mongodb://${d}:${u}/${l}`}),d&&u){c.setAttribute(n.ATTR_NET_PEER_NAME,d);const h=parseInt(u,10);isNaN(h)||c.setAttribute(n.ATTR_NET_PEER_PORT,h)}if(!_)return;const{dbStatementSerializer:E}=this.getConfig(),T=typeof E=="function"?E:this._defaultDbStatementSerializer.bind(this);(0,t.safeExecuteInTheMiddle)(()=>{const h=T(_);c.setAttribute(n.ATTR_DB_STATEMENT,h)},h=>{h&&this._diag.error("Error running dbStatementSerializer hook",h)},!0)}_getDefaultDbStatementReplacer(){const c=new WeakSet;return(l,f)=>typeof f!="object"||!f?"?":c.has(f)?"[Circular]":(c.add(f),f)}_defaultDbStatementSerializer(c){const{enhancedDatabaseReporting:l}=this.getConfig();return l?JSON.stringify(c):JSON.stringify(c,this._getDefaultDbStatementReplacer())}_handleExecutionResult(c,l){const{responseHook:f}=this.getConfig();typeof f=="function"&&(0,t.safeExecuteInTheMiddle)(()=>{f(c,{data:l})},d=>{d&&this._diag.error("Error running response hook",d)},!0)}_patchEnd(c,l,f,d){const u=e.context.active(),_=this;return function(...E){const T=E[0];if(c){if(T instanceof Error)c?.setStatus({code:e.SpanStatusCode.ERROR,message:T.message});else{const h=E[1];_._handleExecutionResult(c,h)}c.end()}return e.context.with(u,()=>(d==="endSessions"&&_._connectionsUsage.add(-1,{state:"idle","pool.name":_._poolName}),l.apply(this,E)))}}setPoolName(c){const l=c.hostAddress?.host,f=c.hostAddress?.port,d=c.dbName,u=`mongodb://${l}:${f}/${d}`;this._poolName=u}_checkSkipInstrumentation(c){return this.getConfig().requireParentSpan===!0&&c===void 0}}return ma.MongoDBInstrumentation=i,ma}var Kd={},lN;function kq(){return lN||(lN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MongodbCommandType=void 0,(function(t){t.CREATE_INDEXES="createIndexes",t.FIND_AND_MODIFY="findAndModify",t.IS_MASTER="isMaster",t.COUNT="count",t.UNKNOWN="unknown"})(e.MongodbCommandType||(e.MongodbCommandType={}))})(Kd)),Kd}var dN;function Gq(){return dN||(dN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MongodbCommandType=e.MongoDBInstrumentation=void 0;var t=Uq();Object.defineProperty(e,"MongoDBInstrumentation",{enumerable:!0,get:function(){return t.MongoDBInstrumentation}});var n=kq();Object.defineProperty(e,"MongodbCommandType",{enumerable:!0,get:function(){return n.MongodbCommandType}})})(qd)),qd}var Vq=Gq();const ev="Mongo",xq=Ne(ev,()=>new Vq.MongoDBInstrumentation({dbStatementSerializer:$q,responseHook(e){Nt(e,"auto.db.otel.mongo")}}));function $q(e){const t=Lp(e);return JSON.stringify(t)}function Lp(e){if(Array.isArray(e))return e.map(t=>Lp(t));if(Bq(e)){const t={};return Object.entries(e).map(([n,r])=>[n,Lp(r)]).reduce((n,r)=>(Fq(r)&&(n[r[0]]=r[1]),n),t)}return"?"}function Bq(e){return typeof e=="object"&&e!==null&&!Hq(e)}function Hq(e){let t=!1;return typeof Buffer<"u"&&(t=Buffer.isBuffer(e)),t}function Fq(e){return Array.isArray(e)}const Yq=(()=>({name:ev,setupOnce(){xq()}})),jq=Yq;var zd={},Zd={},Cn={},Qe={},fN;function tv(){return fN||(fN=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.ATTR_NET_PEER_PORT=Qe.ATTR_NET_PEER_NAME=Qe.ATTR_DB_USER=Qe.ATTR_DB_SYSTEM=Qe.ATTR_DB_STATEMENT=Qe.ATTR_DB_OPERATION=Qe.ATTR_DB_NAME=Qe.ATTR_DB_MONGODB_COLLECTION=void 0,Qe.ATTR_DB_MONGODB_COLLECTION="db.mongodb.collection",Qe.ATTR_DB_NAME="db.name",Qe.ATTR_DB_OPERATION="db.operation",Qe.ATTR_DB_STATEMENT="db.statement",Qe.ATTR_DB_SYSTEM="db.system",Qe.ATTR_DB_USER="db.user",Qe.ATTR_NET_PEER_NAME="net.peer.name",Qe.ATTR_NET_PEER_PORT="net.peer.port"),Qe}var _N;function qq(){if(_N)return Cn;_N=1,Object.defineProperty(Cn,"__esModule",{value:!0}),Cn.handleCallbackResponse=Cn.handlePromiseResponse=Cn.getAttributesFromCollection=void 0;const e=Me(),t=Le,n=tv();function r(c){return{[n.ATTR_DB_MONGODB_COLLECTION]:c.name,[n.ATTR_DB_NAME]:c.conn.name,[n.ATTR_DB_USER]:c.conn.user,[n.ATTR_NET_PEER_NAME]:c.conn.host,[n.ATTR_NET_PEER_PORT]:c.conn.port}}Cn.getAttributesFromCollection=r;function o(c,l={}){c.recordException(l),c.setStatus({code:e.SpanStatusCode.ERROR,message:`${l.message} ${l.code?`
Mongoose Error Code: ${l.code}`:""}`})}function s(c,l,f,d=void 0){f&&(0,t.safeExecuteInTheMiddle)(()=>f(c,{moduleVersion:d,response:l}),u=>{u&&e.diag.error("mongoose instrumentation: responseHook error",u)},!0)}function i(c,l,f,d=void 0){return c instanceof Promise?c.then(u=>(s(l,u,f,d),u)).catch(u=>{throw o(l,u),u}).finally(()=>l.end()):(s(l,c,f,d),l.end(),c)}Cn.handlePromiseResponse=i;function a(c,l,f,d,u,_,p=void 0){let E=0;return u.length===2?E=1:u.length===3&&(E=2),u[E]=(T,h)=>(T?o(d,T):s(d,h,_,p),d.end(),c(T,h)),l.apply(f,u)}return Cn.handleCallbackResponse=a,Cn}var vr={},pN;function Wq(){return pN||(pN=1,Object.defineProperty(vr,"__esModule",{value:!0}),vr.PACKAGE_NAME=vr.PACKAGE_VERSION=void 0,vr.PACKAGE_VERSION="0.55.0",vr.PACKAGE_NAME="@opentelemetry/instrumentation-mongoose"),vr}var EN;function Kq(){return EN||(EN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MongooseInstrumentation=e._STORED_PARENT_SPAN=void 0;const t=Me(),n=ln,r=qq(),o=Le,s=Wq(),i=tv(),a=["deleteOne","deleteMany","find","findOne","estimatedDocumentCount","countDocuments","distinct","where","$where","findOneAndUpdate","findOneAndDelete","findOneAndReplace"],c=["remove","count","findOneAndRemove",...a],l=["count","findOneAndRemove",...a],f=[...a];function d(p){return p?p.startsWith("6.")||p.startsWith("5.")?c:p.startsWith("7.")?l:f:a}function u(p){return p&&(p.startsWith("5.")||p.startsWith("6."))||!1}e._STORED_PARENT_SPAN=Symbol("stored-parent-span");class _ extends o.InstrumentationBase{constructor(E={}){super(s.PACKAGE_NAME,s.PACKAGE_VERSION,E)}init(){return new o.InstrumentationNodeModuleDefinition("mongoose",[">=5.9.7 <9"],this.patch.bind(this),this.unpatch.bind(this))}patch(E,T){const h=E[Symbol.toStringTag]==="Module"?E.default:E;return this._wrap(h.Model.prototype,"save",this.patchOnModelMethods("save",T)),h.Model.prototype.$save=h.Model.prototype.save,u(T)&&this._wrap(h.Model.prototype,"remove",this.patchOnModelMethods("remove",T)),this._wrap(h.Query.prototype,"exec",this.patchQueryExec(T)),this._wrap(h.Aggregate.prototype,"exec",this.patchAggregateExec(T)),d(T).forEach(A=>{this._wrap(h.Query.prototype,A,this.patchAndCaptureSpanContext(A))}),this._wrap(h.Model,"aggregate",this.patchModelAggregate()),this._wrap(h.Model,"insertMany",this.patchModelStatic("insertMany",T)),this._wrap(h.Model,"bulkWrite",this.patchModelStatic("bulkWrite",T)),h}unpatch(E,T){const h=E[Symbol.toStringTag]==="Module"?E.default:E,m=d(T);this._unwrap(h.Model.prototype,"save"),h.Model.prototype.$save=h.Model.prototype.save,u(T)&&this._unwrap(h.Model.prototype,"remove"),this._unwrap(h.Query.prototype,"exec"),this._unwrap(h.Aggregate.prototype,"exec"),m.forEach(A=>{this._unwrap(h.Query.prototype,A)}),this._unwrap(h.Model,"aggregate"),this._unwrap(h.Model,"insertMany"),this._unwrap(h.Model,"bulkWrite")}patchAggregateExec(E){const T=this;return h=>function(A){if(T.getConfig().requireParentSpan&&t.trace.getSpan(t.context.active())===void 0)return h.apply(this,arguments);const g=this[e._STORED_PARENT_SPAN],R={},{dbStatementSerializer:O}=T.getConfig();O&&(R[i.ATTR_DB_STATEMENT]=O("aggregate",{options:this.options,aggregatePipeline:this._pipeline}));const C=T._startSpan(this._model.collection,this._model?.modelName,"aggregate",R,g);return T._handleResponse(C,h,this,arguments,A,E)}}patchQueryExec(E){const T=this;return h=>function(A){if(T.getConfig().requireParentSpan&&t.trace.getSpan(t.context.active())===void 0)return h.apply(this,arguments);const g=this[e._STORED_PARENT_SPAN],R={},{dbStatementSerializer:O}=T.getConfig();O&&(R[i.ATTR_DB_STATEMENT]=O(this.op,{condition:this._conditions,updates:this._update,options:this.options,fields:this._fields}));const C=T._startSpan(this.mongooseCollection,this.model.modelName,this.op,R,g);return T._handleResponse(C,h,this,arguments,A,E)}}patchOnModelMethods(E,T){const h=this;return m=>function(g,R){if(h.getConfig().requireParentSpan&&t.trace.getSpan(t.context.active())===void 0)return m.apply(this,arguments);const O={document:this};g&&!(g instanceof Function)&&(O.options=g);const C={},{dbStatementSerializer:I}=h.getConfig();I&&(C[i.ATTR_DB_STATEMENT]=I(E,O));const L=h._startSpan(this.constructor.collection,this.constructor.modelName,E,C);return g instanceof Function&&(R=g,g=void 0),h._handleResponse(L,m,this,arguments,R,T)}}patchModelStatic(E,T){const h=this;return m=>function(g,R,O){if(h.getConfig().requireParentSpan&&t.trace.getSpan(t.context.active())===void 0)return m.apply(this,arguments);typeof R=="function"&&(O=R,R=void 0);const C={};switch(E){case"insertMany":C.documents=g;break;case"bulkWrite":C.operations=g;break;default:C.document=g;break}R!==void 0&&(C.options=R);const I={},{dbStatementSerializer:L}=h.getConfig();L&&(I[i.ATTR_DB_STATEMENT]=L(E,C));const U=h._startSpan(this.collection,this.modelName,E,I);return h._handleResponse(U,m,this,arguments,O,T)}}patchModelAggregate(){const E=this;return T=>function(){const m=t.trace.getSpan(t.context.active()),A=E._callOriginalFunction(()=>T.apply(this,arguments));return A&&(A[e._STORED_PARENT_SPAN]=m),A}}patchAndCaptureSpanContext(E){const T=this;return h=>function(){return this[e._STORED_PARENT_SPAN]=t.trace.getSpan(t.context.active()),T._callOriginalFunction(()=>h.apply(this,arguments))}}_startSpan(E,T,h,m,A){return this.tracer.startSpan(`mongoose.${T}.${h}`,{kind:t.SpanKind.CLIENT,attributes:{...m,...(0,r.getAttributesFromCollection)(E),[i.ATTR_DB_OPERATION]:h,[i.ATTR_DB_SYSTEM]:"mongoose"}},A?t.trace.setSpan(t.context.active(),A):void 0)}_handleResponse(E,T,h,m,A,g=void 0){const R=this;if(A instanceof Function)return R._callOriginalFunction(()=>(0,r.handleCallbackResponse)(A,T,h,E,m,R.getConfig().responseHook,g));{const O=R._callOriginalFunction(()=>T.apply(h,m));return(0,r.handlePromiseResponse)(O,E,R.getConfig().responseHook,g)}}_callOriginalFunction(E){return this.getConfig().suppressInternalInstrumentation?t.context.with((0,n.suppressTracing)(t.context.active()),E):E()}}e.MongooseInstrumentation=_})(Zd)),Zd}var TN;function zq(){return TN||(TN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MongooseInstrumentation=void 0;var t=Kq();Object.defineProperty(e,"MongooseInstrumentation",{enumerable:!0,get:function(){return t.MongooseInstrumentation}})})(zd)),zd}var Zq=zq();const nv="Mongoose",Xq=Ne(nv,()=>new Zq.MongooseInstrumentation({responseHook(e){Nt(e,"auto.db.otel.mongoose")}})),Qq=(()=>({name:nv,setupOnce(){Xq()}})),Jq=Qq;var Xd={},Aa={},We={},hN;function rv(){return hN||(hN=1,Object.defineProperty(We,"__esModule",{value:!0}),We.METRIC_DB_CLIENT_CONNECTIONS_USAGE=We.DB_SYSTEM_VALUE_MYSQL=We.ATTR_NET_PEER_PORT=We.ATTR_NET_PEER_NAME=We.ATTR_DB_USER=We.ATTR_DB_SYSTEM=We.ATTR_DB_STATEMENT=We.ATTR_DB_NAME=We.ATTR_DB_CONNECTION_STRING=void 0,We.ATTR_DB_CONNECTION_STRING="db.connection_string",We.ATTR_DB_NAME="db.name",We.ATTR_DB_STATEMENT="db.statement",We.ATTR_DB_SYSTEM="db.system",We.ATTR_DB_USER="db.user",We.ATTR_NET_PEER_NAME="net.peer.name",We.ATTR_NET_PEER_PORT="net.peer.port",We.DB_SYSTEM_VALUE_MYSQL="mysql",We.METRIC_DB_CLIENT_CONNECTIONS_USAGE="db.client.connections.usage"),We}var Qd={},SN;function eW(){return SN||(SN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,(function(t){t.MYSQL_VALUES="db.mysql.values"})(e.AttributeNames||(e.AttributeNames={}))})(Qd)),Qd}var Tt={},mN;function tW(){if(mN)return Tt;mN=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.getPoolName=Tt.arrayStringifyHelper=Tt.getSpanName=Tt.getDbValues=Tt.getDbStatement=Tt.getConnectionAttributes=void 0;const e=rv();function t(l){const{host:f,port:d,database:u,user:_}=n(l),p=parseInt(d,10);return isNaN(p)?{[e.ATTR_NET_PEER_NAME]:f,[e.ATTR_DB_CONNECTION_STRING]:r(f,d,u),[e.ATTR_DB_NAME]:u,[e.ATTR_DB_USER]:_}:{[e.ATTR_NET_PEER_NAME]:f,[e.ATTR_NET_PEER_PORT]:p,[e.ATTR_DB_CONNECTION_STRING]:r(f,d,u),[e.ATTR_DB_NAME]:u,[e.ATTR_DB_USER]:_}}Tt.getConnectionAttributes=t;function n(l){const{host:f,port:d,database:u,user:_}=l&&l.connectionConfig||l||{};return{host:f,port:d,database:u,user:_}}function r(l,f,d){let u=`jdbc:mysql://${l||"localhost"}`;return typeof f=="number"&&(u+=`:${f}`),typeof d=="string"&&(u+=`/${d}`),u}function o(l){return typeof l=="string"?l:l.sql}Tt.getDbStatement=o;function s(l,f){return a(typeof l=="string"?f:f||l.values)}Tt.getDbValues=s;function i(l){const f=typeof l=="object"?l.sql:l,d=f?.indexOf(" ");return typeof d=="number"&&d!==-1?f?.substring(0,d):f}Tt.getSpanName=i;function a(l){return l?`[${l.toString()}]`:""}Tt.arrayStringifyHelper=a;function c(l){const f=l.config.connectionConfig;let d="";return d+=f.host?`host: '${f.host}', `:"",d+=f.port?`port: ${f.port}, `:"",d+=f.database?`database: '${f.database}', `:"",d+=f.user?`user: '${f.user}'`:"",f.user||(d=d.substring(0,d.length-2)),d.trim()}return Tt.getPoolName=c,Tt}var Lr={},AN;function nW(){return AN||(AN=1,Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.PACKAGE_NAME=Lr.PACKAGE_VERSION=void 0,Lr.PACKAGE_VERSION="0.54.0",Lr.PACKAGE_NAME="@opentelemetry/instrumentation-mysql"),Lr}var gN;function rW(){if(gN)return Aa;gN=1,Object.defineProperty(Aa,"__esModule",{value:!0}),Aa.MySQLInstrumentation=void 0;const e=Me(),t=Le,n=rv(),r=eW(),o=tW(),s=nW();class i extends t.InstrumentationBase{static COMMON_ATTRIBUTES={[n.ATTR_DB_SYSTEM]:n.DB_SYSTEM_VALUE_MYSQL};constructor(c={}){super(s.PACKAGE_NAME,s.PACKAGE_VERSION,c)}_updateMetricInstruments(){this._connectionsUsage=this.meter.createUpDownCounter(n.METRIC_DB_CLIENT_CONNECTIONS_USAGE,{description:"The number of connections that are currently in state described by the state attribute.",unit:"{connection}"})}init(){return[new t.InstrumentationNodeModuleDefinition("mysql",[">=2.0.0 <3"],c=>((0,t.isWrapped)(c.createConnection)&&this._unwrap(c,"createConnection"),this._wrap(c,"createConnection",this._patchCreateConnection()),(0,t.isWrapped)(c.createPool)&&this._unwrap(c,"createPool"),this._wrap(c,"createPool",this._patchCreatePool()),(0,t.isWrapped)(c.createPoolCluster)&&this._unwrap(c,"createPoolCluster"),this._wrap(c,"createPoolCluster",this._patchCreatePoolCluster()),c),c=>{c!==void 0&&(this._unwrap(c,"createConnection"),this._unwrap(c,"createPool"),this._unwrap(c,"createPoolCluster"))})]}_patchCreateConnection(){return c=>{const l=this;return function(d){const u=c(...arguments);return l._wrap(u,"query",l._patchQuery(u)),u}}}_patchCreatePool(){return c=>{const l=this;return function(d){const u=c(...arguments);return l._wrap(u,"query",l._patchQuery(u)),l._wrap(u,"getConnection",l._patchGetConnection(u)),l._wrap(u,"end",l._patchPoolEnd(u)),l._setPoolcallbacks(u,l,""),u}}}_patchPoolEnd(c){return l=>{const f=this;return function(u){const _=c._allConnections.length,p=c._freeConnections.length,E=_-p,T=(0,o.getPoolName)(c);f._connectionsUsage.add(-E,{state:"used",name:T}),f._connectionsUsage.add(-p,{state:"idle",name:T}),l.apply(c,arguments)}}}_patchCreatePoolCluster(){return c=>{const l=this;return function(d){const u=c(...arguments);return l._wrap(u,"getConnection",l._patchGetConnection(u)),l._wrap(u,"add",l._patchAdd(u)),u}}}_patchAdd(c){return l=>{const f=this;return function(u,_){if(!f._enabled)return f._unwrap(c,"add"),l.apply(c,arguments);l.apply(c,arguments);const p=c._nodes;if(p){const E=typeof u=="object"?"CLUSTER::"+c._lastId:String(u),T=p[E].pool;f._setPoolcallbacks(T,f,u)}}}}_patchGetConnection(c){return l=>{const f=this;return function(u,_,p){if(!f._enabled)return f._unwrap(c,"getConnection"),l.apply(c,arguments);if(arguments.length===1&&typeof u=="function"){const E=f._getConnectionCallbackPatchFn(u);return l.call(c,E)}if(arguments.length===2&&typeof _=="function"){const E=f._getConnectionCallbackPatchFn(_);return l.call(c,u,E)}if(arguments.length===3&&typeof p=="function"){const E=f._getConnectionCallbackPatchFn(p);return l.call(c,u,_,E)}return l.apply(c,arguments)}}}_getConnectionCallbackPatchFn(c){const l=this,f=e.context.active();return function(d,u){u&&((0,t.isWrapped)(u.query)||l._wrap(u,"query",l._patchQuery(u))),typeof c=="function"&&e.context.with(f,c,this,d,u)}}_patchQuery(c){return l=>{const f=this;return function(d,u,_){if(!f._enabled)return f._unwrap(c,"query"),l.apply(c,arguments);const p=f.tracer.startSpan((0,o.getSpanName)(d),{kind:e.SpanKind.CLIENT,attributes:{...i.COMMON_ATTRIBUTES,...(0,o.getConnectionAttributes)(c.config)}});if(p.setAttribute(n.ATTR_DB_STATEMENT,(0,o.getDbStatement)(d)),f.getConfig().enhancedDatabaseReporting){let h;Array.isArray(u)?h=u:arguments[2]&&(h=[u]),p.setAttribute(r.AttributeNames.MYSQL_VALUES,(0,o.getDbValues)(d,h))}const E=Array.from(arguments).findIndex(h=>typeof h=="function"),T=e.context.active();if(E===-1){const h=e.context.with(e.trace.setSpan(e.context.active(),p),()=>l.apply(c,arguments));return e.context.bind(T,h),h.on("error",m=>p.setStatus({code:e.SpanStatusCode.ERROR,message:m.message})).on("end",()=>{p.end()})}else return f._wrap(arguments,E,f._patchCallbackQuery(p,T)),e.context.with(e.trace.setSpan(e.context.active(),p),()=>l.apply(c,arguments))}}}_patchCallbackQuery(c,l){return f=>function(d,u,_){return d&&c.setStatus({code:e.SpanStatusCode.ERROR,message:d.message}),c.end(),e.context.with(l,()=>f(...arguments))}}_setPoolcallbacks(c,l,f){const d=f||(0,o.getPoolName)(c);c.on("connection",u=>{l._connectionsUsage.add(1,{state:"idle",name:d})}),c.on("acquire",u=>{l._connectionsUsage.add(-1,{state:"idle",name:d}),l._connectionsUsage.add(1,{state:"used",name:d})}),c.on("release",u=>{l._connectionsUsage.add(-1,{state:"used",name:d}),l._connectionsUsage.add(1,{state:"idle",name:d})})}}return Aa.MySQLInstrumentation=i,Aa}var RN;function oW(){return RN||(RN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MySQLInstrumentation=void 0;var t=rW();Object.defineProperty(e,"MySQLInstrumentation",{enumerable:!0,get:function(){return t.MySQLInstrumentation}})})(Xd)),Xd}var sW=oW();const ov="Mysql",iW=Ne(ov,()=>new sW.MySQLInstrumentation({})),aW=(()=>({name:ov,setupOnce(){iW()}})),cW=aW;var Jd={},ga={},Je={},NN;function sv(){return NN||(NN=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.DB_SYSTEM_VALUE_MYSQL=Je.ATTR_NET_PEER_PORT=Je.ATTR_NET_PEER_NAME=Je.ATTR_DB_USER=Je.ATTR_DB_SYSTEM=Je.ATTR_DB_STATEMENT=Je.ATTR_DB_NAME=Je.ATTR_DB_CONNECTION_STRING=void 0,Je.ATTR_DB_CONNECTION_STRING="db.connection_string",Je.ATTR_DB_NAME="db.name",Je.ATTR_DB_STATEMENT="db.statement",Je.ATTR_DB_SYSTEM="db.system",Je.ATTR_DB_USER="db.user",Je.ATTR_NET_PEER_NAME="net.peer.name",Je.ATTR_NET_PEER_PORT="net.peer.port",Je.DB_SYSTEM_VALUE_MYSQL="mysql"),Je}var Ra={},yN;function iv(){if(yN)return Ra;yN=1,Object.defineProperty(Ra,"__esModule",{value:!0}),Ra.addSqlCommenterComment=void 0;const e=Me(),t=ln;function n(s){const i=s.indexOf("--");if(i>=0)return!0;if(s.indexOf("/*")<0)return!1;const c=s.indexOf("*/");return i<c}function r(s){return encodeURIComponent(s).replace(/[!'()*]/g,i=>`%${i.charCodeAt(0).toString(16).toUpperCase()}`)}function o(s,i){if(typeof i!="string"||i.length===0||n(i))return i;const a=new t.W3CTraceContextPropagator,c={};a.inject(e.trace.setSpan(e.ROOT_CONTEXT,s),c,e.defaultTextMapSetter);const l=Object.keys(c).sort();if(l.length===0)return i;const f=l.map(d=>{const u=r(c[d]);return`${d}='${u}'`}).join(",");return`${i} /*${f}*/`}return Ra.addSqlCommenterComment=o,Ra}var Pt={},ON;function uW(){if(ON)return Pt;ON=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.getConnectionPrototypeToInstrument=Pt.once=Pt.getSpanName=Pt.getQueryText=Pt.getConnectionAttributes=void 0;const e=sv(),t=Le,n=_t();function r(u,_,p){const{host:E,port:T,database:h,user:m}=o(u),A={};_&t.SemconvStability.OLD&&(A[e.ATTR_DB_CONNECTION_STRING]=s(E,T,h),A[e.ATTR_DB_NAME]=h,A[e.ATTR_DB_USER]=m),_&t.SemconvStability.STABLE&&(A[n.ATTR_DB_NAMESPACE]=h);const g=parseInt(T,10);return p&t.SemconvStability.OLD&&(A[e.ATTR_NET_PEER_NAME]=E,isNaN(g)||(A[e.ATTR_NET_PEER_PORT]=g)),p&t.SemconvStability.STABLE&&(A[n.ATTR_SERVER_ADDRESS]=E,isNaN(g)||(A[n.ATTR_SERVER_PORT]=g)),A}Pt.getConnectionAttributes=r;function o(u){const{host:_,port:p,database:E,user:T}=u&&u.connectionConfig||u||{};return{host:_,port:p,database:E,user:T}}function s(u,_,p){let E=`jdbc:mysql://${u||"localhost"}`;return typeof _=="number"&&(E+=`:${_}`),typeof p=="string"&&(E+=`/${p}`),E}function i(u,_,p,E=!1,T=a){const[h,m]=typeof u=="string"?[u,p]:[u.sql,c(u)?p||u.values:p];try{return E?T(h):_&&m?_(h,m):h}catch{return"Could not determine the query due to an error in masking or formatting"}}Pt.getQueryText=i;function a(u){return u.replace(/\b\d+\b/g,"?").replace(/(["'])(?:(?=(\\?))\2.)*?\1/g,"?")}function c(u){return"values"in u}function l(u){const _=typeof u=="object"?u.sql:u,p=_?.indexOf(" ");return typeof p=="number"&&p!==-1?_?.substring(0,p):_}Pt.getSpanName=l;const f=u=>{let _=!1;return(...p)=>{if(!_)return _=!0,u(...p)}};Pt.once=f;function d(u){const _=u.prototype,p=Object.getPrototypeOf(_);return typeof p?.query=="function"&&typeof p?.execute=="function"?p:_}return Pt.getConnectionPrototypeToInstrument=d,Pt}var Dr={},bN;function lW(){return bN||(bN=1,Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.PACKAGE_NAME=Dr.PACKAGE_VERSION=void 0,Dr.PACKAGE_VERSION="0.55.0",Dr.PACKAGE_NAME="@opentelemetry/instrumentation-mysql2"),Dr}var IN;function dW(){if(IN)return ga;IN=1,Object.defineProperty(ga,"__esModule",{value:!0}),ga.MySQL2Instrumentation=void 0;const e=Me(),t=Le,n=sv(),r=iv(),o=uW(),s=lW(),i=_t(),a=[">=1.4.2 <4"];class c extends t.InstrumentationBase{_netSemconvStability;_dbSemconvStability;constructor(f={}){super(s.PACKAGE_NAME,s.PACKAGE_VERSION,f),this._setSemconvStabilityFromEnv()}_setSemconvStabilityFromEnv(){this._netSemconvStability=(0,t.semconvStabilityFromStr)("http",process.env.OTEL_SEMCONV_STABILITY_OPT_IN),this._dbSemconvStability=(0,t.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}init(){let f;function d(p){!f&&p.format&&(f=p.format)}const u=p=>{(0,t.isWrapped)(p.query)&&this._unwrap(p,"query"),this._wrap(p,"query",this._patchQuery(f,!1)),(0,t.isWrapped)(p.execute)&&this._unwrap(p,"execute"),this._wrap(p,"execute",this._patchQuery(f,!0))},_=p=>{this._unwrap(p,"query"),this._unwrap(p,"execute")};return[new t.InstrumentationNodeModuleDefinition("mysql2",a,p=>(d(p),p),()=>{},[new t.InstrumentationNodeModuleFile("mysql2/promise.js",a,p=>(d(p),p),()=>{}),new t.InstrumentationNodeModuleFile("mysql2/lib/connection.js",a,p=>{const E=(0,o.getConnectionPrototypeToInstrument)(p);return u(E),p},p=>{if(p===void 0)return;const E=(0,o.getConnectionPrototypeToInstrument)(p);_(E)})])]}_patchQuery(f,d){return u=>{const _=this;return function(p,E,T){let h;Array.isArray(E)?h=E:arguments[2]&&(h=[E]);const{maskStatement:m,maskStatementHook:A,responseHook:g}=_.getConfig(),R=(0,o.getConnectionAttributes)(this.config,_._dbSemconvStability,_._netSemconvStability),O=(0,o.getQueryText)(p,f,h,m,A);_._dbSemconvStability&t.SemconvStability.OLD&&(R[n.ATTR_DB_SYSTEM]=n.DB_SYSTEM_VALUE_MYSQL,R[n.ATTR_DB_STATEMENT]=O),_._dbSemconvStability&t.SemconvStability.STABLE&&(R[i.ATTR_DB_SYSTEM_NAME]=i.DB_SYSTEM_NAME_VALUE_MYSQL,R[i.ATTR_DB_QUERY_TEXT]=O);const C=_.tracer.startSpan((0,o.getSpanName)(p),{kind:e.SpanKind.CLIENT,attributes:R});!d&&_.getConfig().addSqlCommenterCommentToQueries&&(arguments[0]=p=typeof p=="string"?(0,r.addSqlCommenterComment)(C,p):Object.assign(p,{sql:(0,r.addSqlCommenterComment)(C,p.sql)}));const I=(0,o.once)((L,U)=>{L?C.setStatus({code:e.SpanStatusCode.ERROR,message:L.message}):typeof g=="function"&&(0,t.safeExecuteInTheMiddle)(()=>{g(C,{queryResults:U})},q=>{q&&_._diag.warn("Failed executing responseHook",q)},!0),C.end()});if(arguments.length===1){typeof p.onResult=="function"&&_._wrap(p,"onResult",_._patchCallbackQuery(I));const L=u.apply(this,arguments);return L.once("error",U=>{I(U)}).once("result",U=>{I(void 0,U)}),L}return typeof arguments[1]=="function"?_._wrap(arguments,1,_._patchCallbackQuery(I)):typeof arguments[2]=="function"&&_._wrap(arguments,2,_._patchCallbackQuery(I)),u.apply(this,arguments)}}}_patchCallbackQuery(f){return d=>function(u,_,p){return f(u,_),d(...arguments)}}}return ga.MySQL2Instrumentation=c,ga}var CN;function fW(){return CN||(CN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MySQL2Instrumentation=void 0;var t=dW();Object.defineProperty(e,"MySQL2Instrumentation",{enumerable:!0,get:function(){return t.MySQL2Instrumentation}})})(Jd)),Jd}var _W=fW();const av="Mysql2",pW=Ne(av,()=>new _W.MySQL2Instrumentation({responseHook(e){Nt(e,"auto.db.otel.mysql2")}})),EW=(()=>({name:av,setupOnce(){pW()}})),TW=EW;var ef={},Na={},ht={},MN;function hW(){return MN||(MN=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.DB_SYSTEM_VALUE_REDIS=ht.ATTR_NET_PEER_PORT=ht.ATTR_NET_PEER_NAME=ht.ATTR_DB_SYSTEM=ht.ATTR_DB_STATEMENT=ht.ATTR_DB_CONNECTION_STRING=void 0,ht.ATTR_DB_CONNECTION_STRING="db.connection_string",ht.ATTR_DB_STATEMENT="db.statement",ht.ATTR_DB_SYSTEM="db.system",ht.ATTR_NET_PEER_NAME="net.peer.name",ht.ATTR_NET_PEER_PORT="net.peer.port",ht.DB_SYSTEM_VALUE_REDIS="redis"),ht}var ya={},PN;function SW(){if(PN)return ya;PN=1,Object.defineProperty(ya,"__esModule",{value:!0}),ya.endSpan=void 0;const e=Me(),t=(n,r)=>{r&&(n.recordException(r),n.setStatus({code:e.SpanStatusCode.ERROR,message:r.message})),n.end()};return ya.endSpan=t,ya}var Oa={},vN;function tT(){if(vN)return Oa;vN=1,Object.defineProperty(Oa,"__esModule",{value:!0}),Oa.defaultDbStatementSerializer=void 0;const e=[{regex:/^ECHO/i,args:0},{regex:/^(LPUSH|MSET|PFA|PUBLISH|RPUSH|SADD|SET|SPUBLISH|XADD|ZADD)/i,args:1},{regex:/^(HSET|HMSET|LSET|LINSERT)/i,args:2},{regex:/^(ACL|BIT|B[LRZ]|CLIENT|CLUSTER|CONFIG|COMMAND|DECR|DEL|EVAL|EX|FUNCTION|GEO|GET|HINCR|HMGET|HSCAN|INCR|L[TRLM]|MEMORY|P[EFISTU]|RPOP|S[CDIMORSU]|XACK|X[CDGILPRT]|Z[CDILMPRS])/i,args:-1}],t=(n,r)=>{if(Array.isArray(r)&&r.length){const o=e.find(({regex:i})=>i.test(n))?.args??0,s=o>=0?r.slice(0,o):r;return r.length>s.length&&s.push(`[${r.length-o} other arguments]`),`${n} ${s.join(" ")}`}return n};return Oa.defaultDbStatementSerializer=t,Oa}var wr={},LN;function mW(){return LN||(LN=1,Object.defineProperty(wr,"__esModule",{value:!0}),wr.PACKAGE_NAME=wr.PACKAGE_VERSION=void 0,wr.PACKAGE_VERSION="0.56.0",wr.PACKAGE_NAME="@opentelemetry/instrumentation-ioredis"),wr}var DN;function AW(){if(DN)return Na;DN=1,Object.defineProperty(Na,"__esModule",{value:!0}),Na.IORedisInstrumentation=void 0;const e=Me(),t=Le,n=hW(),r=Le,o=SW(),s=tT(),i=mW(),a={requireParentSpan:!0};class c extends t.InstrumentationBase{constructor(f={}){super(i.PACKAGE_NAME,i.PACKAGE_VERSION,{...a,...f})}setConfig(f={}){super.setConfig({...a,...f})}init(){return[new t.InstrumentationNodeModuleDefinition("ioredis",[">=2.0.0 <6"],(f,d)=>{const u=f[Symbol.toStringTag]==="Module"?f.default:f;return(0,t.isWrapped)(u.prototype.sendCommand)&&this._unwrap(u.prototype,"sendCommand"),this._wrap(u.prototype,"sendCommand",this._patchSendCommand(d)),(0,t.isWrapped)(u.prototype.connect)&&this._unwrap(u.prototype,"connect"),this._wrap(u.prototype,"connect",this._patchConnection()),f},f=>{if(f===void 0)return;const d=f[Symbol.toStringTag]==="Module"?f.default:f;this._unwrap(d.prototype,"sendCommand"),this._unwrap(d.prototype,"connect")})]}_patchSendCommand(f){return d=>this._traceSendCommand(d,f)}_patchConnection(){return f=>this._traceConnection(f)}_traceSendCommand(f,d){const u=this;return function(_){if(arguments.length<1||typeof _!="object")return f.apply(this,arguments);const p=u.getConfig(),E=p.dbStatementSerializer||s.defaultDbStatementSerializer,T=e.trace.getSpan(e.context.active())===void 0;if(p.requireParentSpan===!0&&T)return f.apply(this,arguments);const h=u.tracer.startSpan(_.name,{kind:e.SpanKind.CLIENT,attributes:{[n.ATTR_DB_SYSTEM]:n.DB_SYSTEM_VALUE_REDIS,[n.ATTR_DB_STATEMENT]:E(_.name,_.args)}}),{requestHook:m}=p;m&&(0,r.safeExecuteInTheMiddle)(()=>m(h,{moduleVersion:d,cmdName:_.name,cmdArgs:_.args}),R=>{R&&e.diag.error("ioredis instrumentation: request hook failed",R)},!0);const{host:A,port:g}=this.options;h.setAttributes({[n.ATTR_NET_PEER_NAME]:A,[n.ATTR_NET_PEER_PORT]:g,[n.ATTR_DB_CONNECTION_STRING]:`redis://${A}:${g}`});try{const R=f.apply(this,arguments),O=_.resolve;_.resolve=function(I){(0,r.safeExecuteInTheMiddle)(()=>p.responseHook?.(h,_.name,_.args,I),L=>{L&&e.diag.error("ioredis instrumentation: response hook failed",L)},!0),(0,o.endSpan)(h,null),O(I)};const C=_.reject;return _.reject=function(I){(0,o.endSpan)(h,I),C(I)},R}catch(R){throw(0,o.endSpan)(h,R),R}}}_traceConnection(f){const d=this;return function(){const u=e.trace.getSpan(e.context.active())===void 0;if(d.getConfig().requireParentSpan===!0&&u)return f.apply(this,arguments);const _=d.tracer.startSpan("connect",{kind:e.SpanKind.CLIENT,attributes:{[n.ATTR_DB_SYSTEM]:n.DB_SYSTEM_VALUE_REDIS,[n.ATTR_DB_STATEMENT]:"connect"}}),{host:p,port:E}=this.options;_.setAttributes({[n.ATTR_NET_PEER_NAME]:p,[n.ATTR_NET_PEER_PORT]:E,[n.ATTR_DB_CONNECTION_STRING]:`redis://${p}:${E}`});try{const T=f.apply(this,arguments);return(0,o.endSpan)(_,null),T}catch(T){throw(0,o.endSpan)(_,T),T}}}}return Na.IORedisInstrumentation=c,Na}var wN;function gW(){return wN||(wN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.IORedisInstrumentation=void 0;var t=AW();Object.defineProperty(e,"IORedisInstrumentation",{enumerable:!0,get:function(){return t.IORedisInstrumentation}})})(ef)),ef}var RW=gW(),tf={},ba={},Ur={},UN;function nT(){return UN||(UN=1,Object.defineProperty(Ur,"__esModule",{value:!0}),Ur.PACKAGE_NAME=Ur.PACKAGE_VERSION=void 0,Ur.PACKAGE_VERSION="0.57.0",Ur.PACKAGE_NAME="@opentelemetry/instrumentation-redis"),Ur}var Ia={},Mn={},kN;function NW(){if(kN)return Mn;kN=1,Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.getTracedCreateStreamTrace=Mn.getTracedCreateClient=Mn.endSpan=void 0;const e=Me(),t=(o,s)=>{s&&o.setStatus({code:e.SpanStatusCode.ERROR,message:s.message}),o.end()};Mn.endSpan=t;const n=o=>function(){const i=o.apply(this,arguments);return e.context.bind(e.context.active(),i)};Mn.getTracedCreateClient=n;const r=o=>function(){return Object.prototype.hasOwnProperty.call(this,"stream")||Object.defineProperty(this,"stream",{get(){return this._patched_redis_stream},set(i){e.context.bind(e.context.active(),i),this._patched_redis_stream=i}}),o.apply(this,arguments)};return Mn.getTracedCreateStreamTrace=r,Mn}var ot={},GN;function rT(){return GN||(GN=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.DB_SYSTEM_VALUE_REDIS=ot.DB_SYSTEM_NAME_VALUE_REDIS=ot.ATTR_NET_PEER_PORT=ot.ATTR_NET_PEER_NAME=ot.ATTR_DB_SYSTEM=ot.ATTR_DB_STATEMENT=ot.ATTR_DB_CONNECTION_STRING=void 0,ot.ATTR_DB_CONNECTION_STRING="db.connection_string",ot.ATTR_DB_STATEMENT="db.statement",ot.ATTR_DB_SYSTEM="db.system",ot.ATTR_NET_PEER_NAME="net.peer.name",ot.ATTR_NET_PEER_PORT="net.peer.port",ot.DB_SYSTEM_NAME_VALUE_REDIS="redis",ot.DB_SYSTEM_VALUE_REDIS="redis"),ot}var VN;function yW(){if(VN)return Ia;VN=1,Object.defineProperty(Ia,"__esModule",{value:!0}),Ia.RedisInstrumentationV2_V3=void 0;const e=Le,t=NW(),n=nT(),r=Me(),o=_t(),s=rT(),i=tT();class a extends e.InstrumentationBase{static COMPONENT="redis";_semconvStability;constructor(l={}){super(n.PACKAGE_NAME,n.PACKAGE_VERSION,l),this._semconvStability=l.semconvStability?l.semconvStability:(0,e.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}setConfig(l={}){super.setConfig(l),this._semconvStability=l.semconvStability?l.semconvStability:(0,e.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}init(){return[new e.InstrumentationNodeModuleDefinition("redis",[">=2.6.0 <4"],l=>((0,e.isWrapped)(l.RedisClient.prototype.internal_send_command)&&this._unwrap(l.RedisClient.prototype,"internal_send_command"),this._wrap(l.RedisClient.prototype,"internal_send_command",this._getPatchInternalSendCommand()),(0,e.isWrapped)(l.RedisClient.prototype.create_stream)&&this._unwrap(l.RedisClient.prototype,"create_stream"),this._wrap(l.RedisClient.prototype,"create_stream",this._getPatchCreateStream()),(0,e.isWrapped)(l.createClient)&&this._unwrap(l,"createClient"),this._wrap(l,"createClient",this._getPatchCreateClient()),l),l=>{l!==void 0&&(this._unwrap(l.RedisClient.prototype,"internal_send_command"),this._unwrap(l.RedisClient.prototype,"create_stream"),this._unwrap(l,"createClient"))})]}_getPatchInternalSendCommand(){const l=this;return function(d){return function(_){if(arguments.length!==1||typeof _!="object")return d.apply(this,arguments);const p=l.getConfig(),E=r.trace.getSpan(r.context.active())===void 0;if(p.requireParentSpan===!0&&E)return d.apply(this,arguments);const T=p?.dbStatementSerializer||i.defaultDbStatementSerializer,h={};l._semconvStability&e.SemconvStability.OLD&&Object.assign(h,{[s.ATTR_DB_SYSTEM]:s.DB_SYSTEM_VALUE_REDIS,[s.ATTR_DB_STATEMENT]:T(_.command,_.args)}),l._semconvStability&e.SemconvStability.STABLE&&Object.assign(h,{[o.ATTR_DB_SYSTEM_NAME]:s.DB_SYSTEM_NAME_VALUE_REDIS,[o.ATTR_DB_OPERATION_NAME]:_.command,[o.ATTR_DB_QUERY_TEXT]:T(_.command,_.args)});const m=l.tracer.startSpan(`${a.COMPONENT}-${_.command}`,{kind:r.SpanKind.CLIENT,attributes:h});if(this.connection_options){const g={};l._semconvStability&e.SemconvStability.OLD&&Object.assign(g,{[s.ATTR_NET_PEER_NAME]:this.connection_options.host,[s.ATTR_NET_PEER_PORT]:this.connection_options.port}),l._semconvStability&e.SemconvStability.STABLE&&Object.assign(g,{[o.ATTR_SERVER_ADDRESS]:this.connection_options.host,[o.ATTR_SERVER_PORT]:this.connection_options.port}),m.setAttributes(g)}this.address&&l._semconvStability&e.SemconvStability.OLD&&m.setAttribute(s.ATTR_DB_CONNECTION_STRING,`redis://${this.address}`);const A=arguments[0].callback;if(A){const g=r.context.active();arguments[0].callback=function(O,C){if(p?.responseHook){const I=p.responseHook;(0,e.safeExecuteInTheMiddle)(()=>{I(m,_.command,_.args,C)},L=>{L&&l._diag.error("Error executing responseHook",L)},!0)}return(0,t.endSpan)(m,O),r.context.with(g,A,this,...arguments)}}try{return d.apply(this,arguments)}catch(g){throw(0,t.endSpan)(m,g),g}}}}_getPatchCreateClient(){return function(f){return(0,t.getTracedCreateClient)(f)}}_getPatchCreateStream(){return function(f){return(0,t.getTracedCreateStreamTrace)(f)}}}return Ia.RedisInstrumentationV2_V3=a,Ia}var Ca={},Ma={},xN;function OW(){if(xN)return Ma;xN=1,Object.defineProperty(Ma,"__esModule",{value:!0}),Ma.getClientAttributes=void 0;const e=_t(),t=rT(),n=Le;function r(s,i,a){const c={};return a&n.SemconvStability.OLD&&Object.assign(c,{[t.ATTR_DB_SYSTEM]:t.DB_SYSTEM_VALUE_REDIS,[t.ATTR_NET_PEER_NAME]:i?.socket?.host,[t.ATTR_NET_PEER_PORT]:i?.socket?.port,[t.ATTR_DB_CONNECTION_STRING]:o(s,i?.url)}),a&n.SemconvStability.STABLE&&Object.assign(c,{[e.ATTR_DB_SYSTEM_NAME]:t.DB_SYSTEM_NAME_VALUE_REDIS,[e.ATTR_SERVER_ADDRESS]:i?.socket?.host,[e.ATTR_SERVER_PORT]:i?.socket?.port}),c}Ma.getClientAttributes=r;function o(s,i){if(!(typeof i!="string"||!i))try{const a=new URL(i);return a.searchParams.delete("user_pwd"),a.username="",a.password="",a.href}catch(a){s.error("failed to sanitize redis connection url",a)}}return Ma}var $N;function bW(){if($N)return Ca;$N=1,Object.defineProperty(Ca,"__esModule",{value:!0}),Ca.RedisInstrumentationV4_V5=void 0;const e=Me(),t=Le,n=OW(),r=tT(),o=nT(),s=_t(),i=rT(),a=Symbol("opentelemetry.instrumentation.redis.open_spans"),c=Symbol("opentelemetry.instrumentation.redis.multi_command_options");class l extends t.InstrumentationBase{static COMPONENT="redis";_semconvStability;constructor(d={}){super(o.PACKAGE_NAME,o.PACKAGE_VERSION,d),this._semconvStability=d.semconvStability?d.semconvStability:(0,t.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}setConfig(d={}){super.setConfig(d),this._semconvStability=d.semconvStability?d.semconvStability:(0,t.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}init(){return[this._getInstrumentationNodeModuleDefinition("@redis/client"),this._getInstrumentationNodeModuleDefinition("@node-redis/client")]}_getInstrumentationNodeModuleDefinition(d){const u=new t.InstrumentationNodeModuleFile(`${d}/dist/lib/commander.js`,["^1.0.0"],(E,T)=>{const h=E.transformCommandArguments;if(!h)return this._diag.error("internal instrumentation error, missing transformCommandArguments function"),E;const m=T?.startsWith("1.0.")?"extendWithCommands":"attachCommands";return(0,t.isWrapped)(E?.[m])&&this._unwrap(E,m),this._wrap(E,m,this._getPatchExtendWithCommands(h)),E},E=>{(0,t.isWrapped)(E?.extendWithCommands)&&this._unwrap(E,"extendWithCommands"),(0,t.isWrapped)(E?.attachCommands)&&this._unwrap(E,"attachCommands")}),_=new t.InstrumentationNodeModuleFile(`${d}/dist/lib/client/multi-command.js`,["^1.0.0","^5.0.0"],E=>{const T=E?.default?.prototype;return(0,t.isWrapped)(T?.exec)&&this._unwrap(T,"exec"),this._wrap(T,"exec",this._getPatchMultiCommandsExec()),(0,t.isWrapped)(T?.addCommand)&&this._unwrap(T,"addCommand"),this._wrap(T,"addCommand",this._getPatchMultiCommandsAddCommand()),E},E=>{const T=E?.default?.prototype;(0,t.isWrapped)(T?.exec)&&this._unwrap(T,"exec"),(0,t.isWrapped)(T?.addCommand)&&this._unwrap(T,"addCommand")}),p=new t.InstrumentationNodeModuleFile(`${d}/dist/lib/client/index.js`,["^1.0.0","^5.0.0"],E=>{const T=E?.default?.prototype;return T?.multi&&((0,t.isWrapped)(T?.multi)&&this._unwrap(T,"multi"),this._wrap(T,"multi",this._getPatchRedisClientMulti())),T?.MULTI&&((0,t.isWrapped)(T?.MULTI)&&this._unwrap(T,"MULTI"),this._wrap(T,"MULTI",this._getPatchRedisClientMulti())),(0,t.isWrapped)(T?.sendCommand)&&this._unwrap(T,"sendCommand"),this._wrap(T,"sendCommand",this._getPatchRedisClientSendCommand()),this._wrap(T,"connect",this._getPatchedClientConnect()),E},E=>{const T=E?.default?.prototype;(0,t.isWrapped)(T?.multi)&&this._unwrap(T,"multi"),(0,t.isWrapped)(T?.MULTI)&&this._unwrap(T,"MULTI"),(0,t.isWrapped)(T?.sendCommand)&&this._unwrap(T,"sendCommand")});return new t.InstrumentationNodeModuleDefinition(d,["^1.0.0","^5.0.0"],E=>E,()=>{},[u,_,p])}_getPatchExtendWithCommands(d){const u=this;return function(p){return function(T){if(T?.BaseClass?.name!=="RedisClient")return p.apply(this,arguments);const h=T.executor;return T.executor=function(m,A){const g=d(m,A).args;return u._traceClientCommand(h,this,arguments,g)},p.apply(this,arguments)}}}_getPatchMultiCommandsExec(){const d=this;return function(_){return function(){const E=_.apply(this,arguments);return typeof E?.then!="function"?(d._diag.error("got non promise result when patching RedisClientMultiCommand.exec"),E):E.then(T=>{const h=this[a];return d._endSpansWithRedisReplies(h,T),T}).catch(T=>{const h=this[a];if(!h)d._diag.error("cannot find open spans to end for redis multi command");else{const m=T.constructor.name==="MultiErrorReply"?T.replies:new Array(h.length).fill(T);d._endSpansWithRedisReplies(h,m)}return Promise.reject(T)})}}}_getPatchMultiCommandsAddCommand(){const d=this;return function(_){return function(E){return d._traceClientCommand(_,this,arguments,E)}}}_getPatchRedisClientMulti(){return function(u){return function(){const p=u.apply(this,arguments);return p[c]=this.options,p}}}_getPatchRedisClientSendCommand(){const d=this;return function(_){return function(E){return d._traceClientCommand(_,this,arguments,E)}}}_getPatchedClientConnect(){const d=this;return function(_){return function(){const E=this.options,T=(0,n.getClientAttributes)(d._diag,E,d._semconvStability),h=d.tracer.startSpan(`${l.COMPONENT}-connect`,{kind:e.SpanKind.CLIENT,attributes:T});return e.context.with(e.trace.setSpan(e.context.active(),h),()=>_.apply(this)).then(A=>(h.end(),A)).catch(A=>(h.recordException(A),h.setStatus({code:e.SpanStatusCode.ERROR,message:A.message}),h.end(),Promise.reject(A)))}}}_traceClientCommand(d,u,_,p){if(e.trace.getSpan(e.context.active())===void 0&&this.getConfig().requireParentSpan)return d.apply(u,_);const T=u.options||u[c],h=p[0],m=p.slice(1),A=this.getConfig().dbStatementSerializer||r.defaultDbStatementSerializer,g=(0,n.getClientAttributes)(this._diag,T,this._semconvStability);this._semconvStability&t.SemconvStability.STABLE&&(g[s.ATTR_DB_OPERATION_NAME]=h);try{const C=A(h,m);C!=null&&(this._semconvStability&t.SemconvStability.OLD&&(g[i.ATTR_DB_STATEMENT]=C),this._semconvStability&t.SemconvStability.STABLE&&(g[s.ATTR_DB_QUERY_TEXT]=C))}catch(C){this._diag.error("dbStatementSerializer throw an exception",C,{commandName:h})}const R=this.tracer.startSpan(`${l.COMPONENT}-${h}`,{kind:e.SpanKind.CLIENT,attributes:g}),O=e.context.with(e.trace.setSpan(e.context.active(),R),()=>d.apply(u,_));if(typeof O?.then=="function")O.then(C=>{this._endSpanWithResponse(R,h,m,C,void 0)},C=>{this._endSpanWithResponse(R,h,m,null,C)});else{const C=O;C[a]=C[a]||[],C[a].push({span:R,commandName:h,commandArgs:m})}return O}_endSpansWithRedisReplies(d,u){if(!d)return this._diag.error("cannot find open spans to end for redis multi command");if(u.length!==d.length)return this._diag.error("number of multi command spans does not match response from redis");for(let _=0;_<d.length;_++){const{span:p,commandName:E,commandArgs:T}=d[_],h=u[_],[m,A]=h instanceof Error?[null,h]:[h,void 0];this._endSpanWithResponse(p,E,T,m,A)}}_endSpanWithResponse(d,u,_,p,E){const{responseHook:T}=this.getConfig();if(!E&&T)try{T(d,u,_,p)}catch(h){this._diag.error("responseHook throw an exception",h)}E&&(d.recordException(E),d.setStatus({code:e.SpanStatusCode.ERROR,message:E?.message})),d.end()}}return Ca.RedisInstrumentationV4_V5=l,Ca}var BN;function IW(){if(BN)return ba;BN=1,Object.defineProperty(ba,"__esModule",{value:!0}),ba.RedisInstrumentation=void 0;const e=Le,t=nT(),n=yW(),r=bW(),o={requireParentSpan:!1};class s extends e.InstrumentationBase{instrumentationV2_V3;instrumentationV4_V5;initialized=!1;constructor(a={}){const c={...o,...a};super(t.PACKAGE_NAME,t.PACKAGE_VERSION,c),this.instrumentationV2_V3=new n.RedisInstrumentationV2_V3(this.getConfig()),this.instrumentationV4_V5=new r.RedisInstrumentationV4_V5(this.getConfig()),this.initialized=!0}setConfig(a={}){const c={...o,...a};super.setConfig(c),this.initialized&&(this.instrumentationV2_V3.setConfig(c),this.instrumentationV4_V5.setConfig(c))}init(){}getModuleDefinitions(){return[...this.instrumentationV2_V3.getModuleDefinitions(),...this.instrumentationV4_V5.getModuleDefinitions()]}setTracerProvider(a){super.setTracerProvider(a),this.initialized&&(this.instrumentationV2_V3.setTracerProvider(a),this.instrumentationV4_V5.setTracerProvider(a))}enable(){super.enable(),this.initialized&&(this.instrumentationV2_V3.enable(),this.instrumentationV4_V5.enable())}disable(){super.disable(),this.initialized&&(this.instrumentationV2_V3.disable(),this.instrumentationV4_V5.disable())}}return ba.RedisInstrumentation=s,ba}var HN;function CW(){return HN||(HN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RedisInstrumentation=void 0;var t=IW();Object.defineProperty(e,"RedisInstrumentation",{enumerable:!0,get:function(){return t.RedisInstrumentation}})})(tf)),tf}var MW=CW();const PW=["get","set","setex"],cv=["get","mget"],vW=["set","setex"];function Du(e,t){return e.includes(t.toLowerCase())}function uv(e){return Du(cv,e)?"cache.get":Du(vW,e)?"cache.put":void 0}function LW(e,t){return t.some(n=>e.startsWith(n))}function DW(e,t){try{if(t.length===0)return;const n=o=>typeof o=="string"||typeof o=="number"||Buffer.isBuffer(o)?[o.toString()]:Array.isArray(o)?FN(o.map(s=>n(s))):["<unknown>"],r=t[0];return Du(PW,e)&&r!=null?n(r):FN(t.map(o=>n(o)))}catch{return}}function wW(e,t,n){if(!uv(e))return!1;for(const r of t)if(LW(r,n))return!0;return!1}function UW(e){const t=n=>{try{return Buffer.isBuffer(n)?n.byteLength:typeof n=="string"?n.length:typeof n=="number"?n.toString().length:n==null?0:JSON.stringify(n).length}catch{return}};return Array.isArray(e)?e.reduce((n,r)=>{const o=t(r);return typeof o=="number"?n!==void 0?n+o:o:n},0):t(e)}function FN(e){const t=[],n=r=>{r.forEach(o=>{Array.isArray(o)?n(o):t.push(o)})};return n(e),t}const Ml="Redis";let ja={};const lv=(e,t,n,r)=>{e.setAttribute(Ge,"auto.db.otel.redis");const o=DW(t,n),s=uv(t);if(!o||!s||!ja.cachePrefixes||!wW(t,o,ja.cachePrefixes))return;const i=Re(e).data["net.peer.name"],a=Re(e).data["net.peer.port"];a&&i&&e.setAttributes({"network.peer.address":i,"network.peer.port":a});const c=UW(r);c&&e.setAttribute(kk,c),Du(cv,t)&&c!==void 0&&e.setAttribute(wk,c>0),e.setAttributes({[Ee]:s,[Uk]:o});const l=o.join(", ");e.updateName(ja.maxCacheKeyLength?Eu(l,ja.maxCacheKeyLength):l)},kW=Ne(`${Ml}.IORedis`,()=>new RW.IORedisInstrumentation({responseHook:lv})),GW=Ne(`${Ml}.Redis`,()=>new MW.RedisInstrumentation({responseHook:lv})),VW=Object.assign(()=>{kW(),GW()},{id:Ml}),xW=((e={})=>({name:Ml,setupOnce(){ja=e,VW()}})),$W=xW;var nf={},Pa={},va={},YN;function BW(){return YN||(YN=1,Object.defineProperty(va,"__esModule",{value:!0}),va.EVENT_LISTENERS_SET=void 0,va.EVENT_LISTENERS_SET=Symbol("opentelemetry.instrumentation.pg.eventListenersSet")),va}var me={},rf={},jN;function dv(){return jN||(jN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,(function(t){t.PG_VALUES="db.postgresql.values",t.PG_PLAN="db.postgresql.plan",t.IDLE_TIMEOUT_MILLIS="db.postgresql.idle.timeout.millis",t.MAX_CLIENT="db.postgresql.max.client"})(e.AttributeNames||(e.AttributeNames={}))})(rf)),rf}var Pe={},qN;function fv(){return qN||(qN=1,Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.METRIC_DB_CLIENT_CONNECTION_PENDING_REQUESTS=Pe.METRIC_DB_CLIENT_CONNECTION_COUNT=Pe.DB_SYSTEM_VALUE_POSTGRESQL=Pe.DB_CLIENT_CONNECTION_STATE_VALUE_USED=Pe.DB_CLIENT_CONNECTION_STATE_VALUE_IDLE=Pe.ATTR_NET_PEER_PORT=Pe.ATTR_NET_PEER_NAME=Pe.ATTR_DB_USER=Pe.ATTR_DB_SYSTEM=Pe.ATTR_DB_STATEMENT=Pe.ATTR_DB_NAME=Pe.ATTR_DB_CONNECTION_STRING=Pe.ATTR_DB_CLIENT_CONNECTION_STATE=Pe.ATTR_DB_CLIENT_CONNECTION_POOL_NAME=void 0,Pe.ATTR_DB_CLIENT_CONNECTION_POOL_NAME="db.client.connection.pool.name",Pe.ATTR_DB_CLIENT_CONNECTION_STATE="db.client.connection.state",Pe.ATTR_DB_CONNECTION_STRING="db.connection_string",Pe.ATTR_DB_NAME="db.name",Pe.ATTR_DB_STATEMENT="db.statement",Pe.ATTR_DB_SYSTEM="db.system",Pe.ATTR_DB_USER="db.user",Pe.ATTR_NET_PEER_NAME="net.peer.name",Pe.ATTR_NET_PEER_PORT="net.peer.port",Pe.DB_CLIENT_CONNECTION_STATE_VALUE_IDLE="idle",Pe.DB_CLIENT_CONNECTION_STATE_VALUE_USED="used",Pe.DB_SYSTEM_VALUE_POSTGRESQL="postgresql",Pe.METRIC_DB_CLIENT_CONNECTION_COUNT="db.client.connection.count",Pe.METRIC_DB_CLIENT_CONNECTION_PENDING_REQUESTS="db.client.connection.pending_requests"),Pe}var of={},WN;function _v(){return WN||(WN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpanNames=void 0,(function(t){t.QUERY_PREFIX="pg.query",t.CONNECT="pg.connect",t.POOL_CONNECT="pg-pool.connect"})(e.SpanNames||(e.SpanNames={}))})(of)),of}var KN;function HW(){if(KN)return me;KN=1,Object.defineProperty(me,"__esModule",{value:!0}),me.sanitizedErrorMessage=me.isObjectWithTextString=me.getErrorMessage=me.patchClientConnectCallback=me.patchCallbackPGPool=me.updateCounter=me.getPoolName=me.patchCallback=me.handleExecutionResult=me.handleConfigQuery=me.shouldSkipInstrumentation=me.getSemanticAttributesFromPoolConnection=me.getSemanticAttributesFromConnection=me.getConnectionString=me.parseAndMaskConnectionString=me.parseNormalizedOperationName=me.getQuerySpanName=void 0;const e=Me(),t=dv(),n=_t(),r=fv(),o=Le,s=_v();function i(I,L){if(!L)return s.SpanNames.QUERY_PREFIX;const U=typeof L.name=="string"&&L.name?L.name:a(L.text);return`${s.SpanNames.QUERY_PREFIX}:${U}${I?` ${I}`:""}`}me.getQuerySpanName=i;function a(I){const L=I.indexOf(" ");let U=L===-1?I:I.slice(0,L);return U=U.toUpperCase(),U.endsWith(";")?U.slice(0,-1):U}me.parseNormalizedOperationName=a;function c(I){try{const L=new URL(I);return L.username="",L.password="",L.toString()}catch{return"postgresql://localhost:5432/"}}me.parseAndMaskConnectionString=c;function l(I){if("connectionString"in I&&I.connectionString)return c(I.connectionString);const L=I.host||"localhost",U=I.port||5432,q=I.database||"";return`postgresql://${L}:${U}/${q}`}me.getConnectionString=l;function f(I){if(Number.isInteger(I))return I}function d(I,L){let U={};return L&o.SemconvStability.OLD&&(U={...U,[r.ATTR_DB_SYSTEM]:r.DB_SYSTEM_VALUE_POSTGRESQL,[r.ATTR_DB_NAME]:I.database,[r.ATTR_DB_CONNECTION_STRING]:l(I),[r.ATTR_DB_USER]:I.user,[r.ATTR_NET_PEER_NAME]:I.host,[r.ATTR_NET_PEER_PORT]:f(I.port)}),L&o.SemconvStability.STABLE&&(U={...U,[n.ATTR_DB_SYSTEM_NAME]:n.DB_SYSTEM_NAME_VALUE_POSTGRESQL,[n.ATTR_DB_NAMESPACE]:I.namespace,[n.ATTR_SERVER_ADDRESS]:I.host,[n.ATTR_SERVER_PORT]:f(I.port)}),U}me.getSemanticAttributesFromConnection=d;function u(I,L){let U;try{U=I.connectionString?new URL(I.connectionString):void 0}catch{U=void 0}let q={[t.AttributeNames.IDLE_TIMEOUT_MILLIS]:I.idleTimeoutMillis,[t.AttributeNames.MAX_CLIENT]:I.maxClient};return L&o.SemconvStability.OLD&&(q={...q,[r.ATTR_DB_SYSTEM]:r.DB_SYSTEM_VALUE_POSTGRESQL,[r.ATTR_DB_NAME]:U?.pathname.slice(1)??I.database,[r.ATTR_DB_CONNECTION_STRING]:l(I),[r.ATTR_NET_PEER_NAME]:U?.hostname??I.host,[r.ATTR_NET_PEER_PORT]:Number(U?.port)||f(I.port),[r.ATTR_DB_USER]:U?.username??I.user}),L&o.SemconvStability.STABLE&&(q={...q,[n.ATTR_DB_SYSTEM_NAME]:n.DB_SYSTEM_NAME_VALUE_POSTGRESQL,[n.ATTR_DB_NAMESPACE]:I.namespace,[n.ATTR_SERVER_ADDRESS]:U?.hostname??I.host,[n.ATTR_SERVER_PORT]:Number(U?.port)||f(I.port)}),q}me.getSemanticAttributesFromPoolConnection=u;function _(I){return I.requireParentSpan===!0&&e.trace.getSpan(e.context.active())===void 0}me.shouldSkipInstrumentation=_;function p(I,L,U,q){const{connectionParameters:H}=this,$=H.database,B=i($,q),F=I.startSpan(B,{kind:e.SpanKind.CLIENT,attributes:d(H,U)});if(!q)return F;if(q.text&&(U&o.SemconvStability.OLD&&F.setAttribute(r.ATTR_DB_STATEMENT,q.text),U&o.SemconvStability.STABLE&&F.setAttribute(n.ATTR_DB_QUERY_TEXT,q.text)),L.enhancedDatabaseReporting&&Array.isArray(q.values))try{const w=q.values.map(k=>k==null?"null":k instanceof Buffer?k.toString():typeof k=="object"?typeof k.toPostgres=="function"?k.toPostgres():JSON.stringify(k):k.toString());F.setAttribute(t.AttributeNames.PG_VALUES,w)}catch(w){e.diag.error("failed to stringify ",q.values,w)}return typeof q.name=="string"&&F.setAttribute(t.AttributeNames.PG_PLAN,q.name),F}me.handleConfigQuery=p;function E(I,L,U){typeof I.responseHook=="function"&&(0,o.safeExecuteInTheMiddle)(()=>{I.responseHook(L,{data:U})},q=>{q&&e.diag.error("Error running response hook",q)},!0)}me.handleExecutionResult=E;function T(I,L,U,q,H){return function(B,F){B?(Object.prototype.hasOwnProperty.call(B,"code")&&(q[n.ATTR_ERROR_TYPE]=B.code),B instanceof Error&&L.recordException(C(B)),L.setStatus({code:e.SpanStatusCode.ERROR,message:B.message})):E(I,L,F),H(),L.end(),U.call(this,B,F)}}me.patchCallback=T;function h(I){let L="";return L+=(I?.host?`${I.host}`:"unknown_host")+":",L+=(I?.port?`${I.port}`:"unknown_port")+"/",L+=I?.database?`${I.database}`:"unknown_database",L.trim()}me.getPoolName=h;function m(I,L,U,q,H){const $=L.totalCount,B=L.waitingCount,F=L.idleCount,w=$-F;return U.add(w-H.used,{[r.ATTR_DB_CLIENT_CONNECTION_STATE]:r.DB_CLIENT_CONNECTION_STATE_VALUE_USED,[r.ATTR_DB_CLIENT_CONNECTION_POOL_NAME]:I}),U.add(F-H.idle,{[r.ATTR_DB_CLIENT_CONNECTION_STATE]:r.DB_CLIENT_CONNECTION_STATE_VALUE_IDLE,[r.ATTR_DB_CLIENT_CONNECTION_POOL_NAME]:I}),q.add(B-H.pending,{[r.ATTR_DB_CLIENT_CONNECTION_POOL_NAME]:I}),{used:w,idle:F,pending:B}}me.updateCounter=m;function A(I,L){return function(q,H,$){q&&(q instanceof Error&&I.recordException(C(q)),I.setStatus({code:e.SpanStatusCode.ERROR,message:q.message})),I.end(),L.call(this,q,H,$)}}me.patchCallbackPGPool=A;function g(I,L){return function(q){q&&(q instanceof Error&&I.recordException(C(q)),I.setStatus({code:e.SpanStatusCode.ERROR,message:q.message})),I.end(),L.apply(this,arguments)}}me.patchClientConnectCallback=g;function R(I){return typeof I=="object"&&I!==null&&"message"in I?String(I.message):void 0}me.getErrorMessage=R;function O(I){return typeof I=="object"&&typeof I?.text=="string"}me.isObjectWithTextString=O;function C(I){const L=I?.name??"PostgreSQLError",U=I?.code??"UNKNOWN";return`PostgreSQL error of type '${L}' occurred (code: ${U})`}return me.sanitizedErrorMessage=C,me}var kr={},zN;function FW(){return zN||(zN=1,Object.defineProperty(kr,"__esModule",{value:!0}),kr.PACKAGE_NAME=kr.PACKAGE_VERSION=void 0,kr.PACKAGE_VERSION="0.61.0",kr.PACKAGE_NAME="@opentelemetry/instrumentation-pg"),kr}var ZN;function YW(){if(ZN)return Pa;ZN=1,Object.defineProperty(Pa,"__esModule",{value:!0}),Pa.PgInstrumentation=void 0;const e=Le,t=Me(),n=BW(),r=HW(),o=iv(),s=FW(),i=_v(),a=ln,c=_t(),l=fv();function f(_){return _[Symbol.toStringTag]==="Module"?_.default:_}class d extends e.InstrumentationBase{_connectionsCounter={used:0,idle:0,pending:0};_semconvStability;constructor(p={}){super(s.PACKAGE_NAME,s.PACKAGE_VERSION,p),this._semconvStability=(0,e.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}_updateMetricInstruments(){this._operationDuration=this.meter.createHistogram(c.METRIC_DB_CLIENT_OPERATION_DURATION,{description:"Duration of database client operations.",unit:"s",valueType:t.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[.001,.005,.01,.05,.1,.5,1,5,10]}}),this._connectionsCounter={idle:0,pending:0,used:0},this._connectionsCount=this.meter.createUpDownCounter(l.METRIC_DB_CLIENT_CONNECTION_COUNT,{description:"The number of connections that are currently in state described by the state attribute.",unit:"{connection}"}),this._connectionPendingRequests=this.meter.createUpDownCounter(l.METRIC_DB_CLIENT_CONNECTION_PENDING_REQUESTS,{description:"The number of current pending requests for an open connection.",unit:"{connection}"})}init(){const p=[">=8.0.3 <9"],E=[">=2.0.0 <4"],T=new e.InstrumentationNodeModuleFile("pg/lib/native/client.js",p,this._patchPgClient.bind(this),this._unpatchPgClient.bind(this)),h=new e.InstrumentationNodeModuleFile("pg/lib/client.js",p,this._patchPgClient.bind(this),this._unpatchPgClient.bind(this)),m=new e.InstrumentationNodeModuleDefinition("pg",p,g=>{const R=f(g);return this._patchPgClient(R.Client),g},g=>{const R=f(g);return this._unpatchPgClient(R.Client),g},[h,T]),A=new e.InstrumentationNodeModuleDefinition("pg-pool",E,g=>{const R=f(g);return(0,e.isWrapped)(R.prototype.connect)&&this._unwrap(R.prototype,"connect"),this._wrap(R.prototype,"connect",this._getPoolConnectPatch()),R},g=>{const R=f(g);(0,e.isWrapped)(R.prototype.connect)&&this._unwrap(R.prototype,"connect")});return[m,A]}_patchPgClient(p){if(!p)return;const E=f(p);return(0,e.isWrapped)(E.prototype.query)&&this._unwrap(E.prototype,"query"),(0,e.isWrapped)(E.prototype.connect)&&this._unwrap(E.prototype,"connect"),this._wrap(E.prototype,"query",this._getClientQueryPatch()),this._wrap(E.prototype,"connect",this._getClientConnectPatch()),p}_unpatchPgClient(p){const E=f(p);return(0,e.isWrapped)(E.prototype.query)&&this._unwrap(E.prototype,"query"),(0,e.isWrapped)(E.prototype.connect)&&this._unwrap(E.prototype,"connect"),p}_getClientConnectPatch(){const p=this;return E=>function(h){if(r.shouldSkipInstrumentation(p.getConfig()))return E.call(this,h);const m=p.tracer.startSpan(i.SpanNames.CONNECT,{kind:t.SpanKind.CLIENT,attributes:r.getSemanticAttributesFromConnection(this,p._semconvStability)});if(h){const g=t.trace.getSpan(t.context.active());h=r.patchClientConnectCallback(m,h),g&&(h=t.context.bind(t.context.active(),h))}const A=t.context.with(t.trace.setSpan(t.context.active(),m),()=>E.call(this,h));return u(m,A)}}recordOperationDuration(p,E){const T={},h=[c.ATTR_DB_NAMESPACE,c.ATTR_ERROR_TYPE,c.ATTR_SERVER_PORT,c.ATTR_SERVER_ADDRESS,c.ATTR_DB_OPERATION_NAME];this._semconvStability&e.SemconvStability.OLD&&h.push(l.ATTR_DB_SYSTEM),this._semconvStability&e.SemconvStability.STABLE&&h.push(c.ATTR_DB_SYSTEM_NAME),h.forEach(A=>{A in p&&(T[A]=p[A])});const m=(0,a.hrTimeToMilliseconds)((0,a.hrTimeDuration)(E,(0,a.hrTime)()))/1e3;this._operationDuration.record(m,T)}_getClientQueryPatch(){const p=this;return E=>(this._diag.debug("Patching pg.Client.prototype.query"),function(...h){if(r.shouldSkipInstrumentation(p.getConfig()))return E.apply(this,h);const m=(0,a.hrTime)(),A=h[0],g=typeof A=="string",R=r.isObjectWithTextString(A),O=g?{text:A,values:Array.isArray(h[1])?h[1]:void 0}:R?A:void 0,C={[l.ATTR_DB_SYSTEM]:l.DB_SYSTEM_VALUE_POSTGRESQL,[c.ATTR_DB_NAMESPACE]:this.database,[c.ATTR_SERVER_PORT]:this.connectionParameters.port,[c.ATTR_SERVER_ADDRESS]:this.connectionParameters.host};O?.text&&(C[c.ATTR_DB_OPERATION_NAME]=r.parseNormalizedOperationName(O?.text));const I=()=>{p.recordOperationDuration(C,m)},L=p.getConfig(),U=r.handleConfigQuery.call(this,p.tracer,L,p._semconvStability,O);if(L.addSqlCommenterCommentToQueries&&(g?h[0]=(0,o.addSqlCommenterComment)(U,A):R&&!("name"in A)&&(h[0]={...A,text:(0,o.addSqlCommenterComment)(U,A.text)})),h.length>0){const $=t.trace.getSpan(t.context.active());if(typeof h[h.length-1]=="function")h[h.length-1]=r.patchCallback(L,U,h[h.length-1],C,I),$&&(h[h.length-1]=t.context.bind(t.context.active(),h[h.length-1]));else if(typeof O?.callback=="function"){let B=r.patchCallback(p.getConfig(),U,O.callback,C,I);$&&(B=t.context.bind(t.context.active(),B)),h[0].callback=B}}const{requestHook:q}=L;typeof q=="function"&&O&&(0,e.safeExecuteInTheMiddle)(()=>{const{database:$,host:B,port:F,user:w}=this.connectionParameters;q(U,{connection:{database:$,host:B,port:F,user:w},query:{text:O.text,values:O.values,name:O.name}})},$=>{$&&p._diag.error("Error running query hook",$)},!0);let H;try{H=E.apply(this,h)}catch($){throw $ instanceof Error&&U.recordException(r.sanitizedErrorMessage($)),U.setStatus({code:t.SpanStatusCode.ERROR,message:r.getErrorMessage($)}),U.end(),$}return H instanceof Promise?H.then($=>new Promise(B=>{r.handleExecutionResult(p.getConfig(),U,$),I(),U.end(),B($)})).catch($=>new Promise((B,F)=>{$ instanceof Error&&U.recordException(r.sanitizedErrorMessage($)),U.setStatus({code:t.SpanStatusCode.ERROR,message:$.message}),I(),U.end(),F($)})):H})}_setPoolConnectEventListeners(p){if(p[n.EVENT_LISTENERS_SET])return;const E=r.getPoolName(p.options);p.on("connect",()=>{this._connectionsCounter=r.updateCounter(E,p,this._connectionsCount,this._connectionPendingRequests,this._connectionsCounter)}),p.on("acquire",()=>{this._connectionsCounter=r.updateCounter(E,p,this._connectionsCount,this._connectionPendingRequests,this._connectionsCounter)}),p.on("remove",()=>{this._connectionsCounter=r.updateCounter(E,p,this._connectionsCount,this._connectionPendingRequests,this._connectionsCounter)}),p.on("release",()=>{this._connectionsCounter=r.updateCounter(E,p,this._connectionsCount,this._connectionPendingRequests,this._connectionsCounter)}),p[n.EVENT_LISTENERS_SET]=!0}_getPoolConnectPatch(){const p=this;return E=>function(h){if(r.shouldSkipInstrumentation(p.getConfig()))return E.call(this,h);const m=p.tracer.startSpan(i.SpanNames.POOL_CONNECT,{kind:t.SpanKind.CLIENT,attributes:r.getSemanticAttributesFromPoolConnection(this.options,p._semconvStability)});if(p._setPoolConnectEventListeners(this),h){const g=t.trace.getSpan(t.context.active());h=r.patchCallbackPGPool(m,h),g&&(h=t.context.bind(t.context.active(),h))}const A=t.context.with(t.trace.setSpan(t.context.active(),m),()=>E.call(this,h));return u(m,A)}}}Pa.PgInstrumentation=d;function u(_,p){if(!(p instanceof Promise))return p;const E=p;return t.context.bind(t.context.active(),E.then(T=>(_.end(),T)).catch(T=>(T instanceof Error&&_.recordException(r.sanitizedErrorMessage(T)),_.setStatus({code:t.SpanStatusCode.ERROR,message:r.getErrorMessage(T)}),_.end(),Promise.reject(T))))}return Pa}var XN;function jW(){return XN||(XN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=e.PgInstrumentation=void 0;var t=YW();Object.defineProperty(e,"PgInstrumentation",{enumerable:!0,get:function(){return t.PgInstrumentation}});var n=dv();Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return n.AttributeNames}})})(nf)),nf}var qW=jW();const pv="Postgres",WW=Ne(pv,()=>new qW.PgInstrumentation({requireParentSpan:!0,requestHook(e){Nt(e,"auto.db.otel.postgres")}})),KW=(()=>({name:pv,setupOnce(){WW()}})),zW=KW,oT="PostgresJs",QN=[">=3.0.0 <4"],ZW=Ne(oT,e=>new XW({requireParentSpan:e?.requireParentSpan??!0,requestHook:e?.requestHook}));class XW extends yt{constructor(t){super("sentry-postgres-js",Ze,t)}init(){const t=new dt("postgres",QN);return["src","cf/src","cjs/src"].forEach(n=>{t.files.push(new Bn(`postgres/${n}/connection.js`,["*"],this._patchConnection.bind(this),this._unwrap.bind(this))),t.files.push(new Bn(`postgres/${n}/query.js`,QN,this._patchQuery.bind(this),this._unwrap.bind(this)))}),[t]}_shouldCreateSpans(){const t=this.getConfig();return b.trace.getSpan(b.context.active())!==void 0||!t.requireParentSpan}_patchReject(t,n){return new Proxy(t,{apply:(r,o,s)=>{n.setStatus({code:Ae,message:s?.[0]?.message||"internal_error"});const i=Reflect.apply(r,o,s);return n.setAttribute(Q.ATTR_DB_RESPONSE_STATUS_CODE,s?.[0]?.code||"Unknown error"),n.setAttribute(Q.ATTR_ERROR_TYPE,s?.[0]?.name||"Unknown error"),n.end(),i}})}_patchResolve(t,n){return new Proxy(t,{apply:(r,o,s)=>{const i=Reflect.apply(r,o,s),a=s?.[0]?.command;return a&&n.setAttribute(Q.ATTR_DB_OPERATION_NAME,a),n.end(),i}})}_patchQuery(t){return t.Query.prototype.handle=new Proxy(t.Query.prototype.handle,{apply:async(n,r,o)=>{if(!this._shouldCreateSpans())return Reflect.apply(n,r,o);const s=this._sanitizeSqlQuery(r.strings?.[0]);return Vn({name:s||"postgresjs.query",op:"db"},i=>{const c=Ke().getScopeData().contexts.postgresjsConnection;Nt(i,"auto.db.otel.postgres");const{requestHook:l}=this.getConfig();l&&er(()=>l(i,s,c),_=>{_&&x.error(`Error in requestHook for ${oT} integration:`,_)});const f=c?.ATTR_DB_NAMESPACE||"<unknown database>",d=c?.ATTR_SERVER_ADDRESS||"<unknown host>",u=c?.ATTR_SERVER_PORT||"<unknown port>";i.setAttribute(Q.ATTR_DB_SYSTEM_NAME,"postgres"),i.setAttribute(Q.ATTR_DB_NAMESPACE,f),i.setAttribute(Q.ATTR_SERVER_ADDRESS,d),i.setAttribute(Q.ATTR_SERVER_PORT,u),i.setAttribute(Q.ATTR_DB_QUERY_TEXT,s),r.resolve=this._patchResolve(r.resolve,i),r.reject=this._patchReject(r.reject,i);try{return Reflect.apply(n,r,o)}catch(_){throw i.setStatus({code:Ae}),i.end(),_}})}}),t}_patchConnection(t){return new Proxy(t,{apply:(n,r,o)=>{const s=o[0]?.database||"<unknown database>",i=o[0]?.host?.[0]||"<unknown host>",a=o[0]?.port?.[0]||"<unknown port>";return Ke().setContext("postgresjsConnection",{ATTR_DB_NAMESPACE:s,ATTR_SERVER_ADDRESS:i,ATTR_SERVER_PORT:a}),Reflect.apply(n,r,o)}})}_sanitizeSqlQuery(t){return t?t.replace(/\s+/g," ").trim().substring(0,1024).replace(/--.*?(\r?\n|$)/g,"").replace(/\/\*[\s\S]*?\*\//g,"").replace(/;\s*$/,"").replace(/\b\d+\b/g,"?").replace(/\s+/g," ").replace(/\bIN\b\s*\(\s*\?(?:\s*,\s*\?)*\s*\)/g,"IN (?)"):"Unknown SQL Query"}}const QW=(()=>({name:oT,setupOnce(){ZW()}})),JW=QW;var eK=process.env.PRISMA_SHOW_ALL_TRACES==="true",tK="00-10-10-00";function nK(e){switch(e){case"client":return b.SpanKind.CLIENT;case"internal":default:return b.SpanKind.INTERNAL}}var rK=class{tracerProvider;ignoreSpanTypes;constructor({tracerProvider:e,ignoreSpanTypes:t}){this.tracerProvider=e,this.ignoreSpanTypes=t}isEnabled(){return!0}getTraceParent(e){const t=b.trace.getSpanContext(e??b.context.active());return t?`00-${t.traceId}-${t.spanId}-0${t.traceFlags}`:tK}dispatchEngineSpans(e){const t=this.tracerProvider.getTracer("prisma"),n=new Map,r=e.filter(o=>o.parentId===null);for(const o of r)Ev(t,o,e,n,this.ignoreSpanTypes)}getActiveContext(){return b.context.active()}runInChildSpan(e,t){if(typeof e=="string"&&(e={name:e}),e.internal&&!eK)return t();const n=this.tracerProvider.getTracer("prisma"),r=e.context??this.getActiveContext(),o=`prisma:client:${e.name}`;if(Tv(o,this.ignoreSpanTypes))return t();if(e.active===!1){const s=n.startSpan(o,e,r);return JN(s,t(s,r))}return n.startActiveSpan(o,e,s=>JN(s,t(s,r)))}};function Ev(e,t,n,r,o){if(Tv(t.name,o))return;const s={attributes:t.attributes,kind:nK(t.kind),startTime:t.startTime};e.startActiveSpan(t.name,s,i=>{r.set(t.id,i.spanContext().spanId),t.links&&i.addLinks(t.links.flatMap(c=>{const l=r.get(c);return l?{context:{spanId:l,traceId:i.spanContext().traceId,traceFlags:i.spanContext().traceFlags}}:[]}));const a=n.filter(c=>c.parentId===t.id);for(const c of a)Ev(e,c,n,r,o);i.end(t.endTime)})}function JN(e,t){return oK(t)?t.then(n=>(e.end(),n),n=>{throw e.end(),n}):(e.end(),t)}function oK(e){return e!=null&&typeof e.then=="function"}function Tv(e,t){return t.some(n=>typeof n=="string"?n===e:n.test(e))}var hv={name:"@prisma/instrumentation",version:"6.19.0"},Dp=hv.version,sK=Dp.split(".")[0],ey="PRISMA_INSTRUMENTATION",sf=`V${sK}_PRISMA_INSTRUMENTATION`,iK=hv.name,aK="@prisma/client",cK=class extends yt{tracerProvider;constructor(e={}){super(iK,Dp,e)}setTracerProvider(e){this.tracerProvider=e}init(){return[new dt(aK,[Dp])]}enable(){const e=this._config,t={helper:new rK({tracerProvider:this.tracerProvider??b.trace.getTracerProvider(),ignoreSpanTypes:e.ignoreSpanTypes??[]})};global[ey]=t,global[sf]=t}disable(){delete global[ey],delete global[sf]}isEnabled(){return!!global[sf]}};const Sv="Prisma";function uK(e){return!!e&&typeof e=="object"&&"dispatchEngineSpans"in e}function mv(){const e=globalThis.PRISMA_INSTRUMENTATION;return e&&typeof e=="object"&&"helper"in e?e.helper:void 0}class lK extends cK{constructor(){super()}enable(){super.enable();const t=mv();uK(t)&&(t.createEngineSpan=n=>{const r=b.trace.getTracer("prismaV5Compatibility"),o=r._idGenerator;if(!o){sn(()=>{console.warn("[Sentry] Could not find _idGenerator on tracer, skipping Prisma v5 compatibility - some Prisma spans may be missing!")});return}try{n.spans.forEach(s=>{const i=dK(s.kind),a=s.parent_span_id,c=s.span_id,l=s.trace_id,f=s.links?.map(u=>({context:{traceId:u.trace_id,spanId:u.span_id,traceFlags:b.TraceFlags.SAMPLED}})),d=b.trace.setSpanContext(b.context.active(),{traceId:l,spanId:a,traceFlags:b.TraceFlags.SAMPLED});b.context.with(d,()=>{const u={generateTraceId:()=>l,generateSpanId:()=>c};r._idGenerator=u,r.startSpan(s.name,{kind:i,links:f,startTime:s.start_time,attributes:s.attributes}).end(s.end_time),r._idGenerator=o})})}finally{r._idGenerator=o}})}}function dK(e){switch(e){case"client":return b.SpanKind.CLIENT;case"internal":default:return b.SpanKind.INTERNAL}}const fK=Ne(Sv,e=>new lK),_K=e=>({name:Sv,setupOnce(){fK()},setup(t){mv()&&t.on("spanStart",n=>{const r=Re(n);r.description?.startsWith("prisma:")&&n.setAttribute(Ge,"auto.db.otel.prisma"),r.description==="prisma:engine:db_query"&&r.data["db.query.text"]&&n.updateName(r.data["db.query.text"]),r.description==="prisma:engine:db_query"&&!r.data["db.system"]&&n.setAttribute("db.system","prisma")})}});var af={},La={},Gr={},ty;function pK(){return ty||(ty=1,Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.PACKAGE_NAME=Gr.PACKAGE_VERSION=void 0,Gr.PACKAGE_VERSION="0.55.0",Gr.PACKAGE_NAME="@opentelemetry/instrumentation-hapi"),Gr}var en={},ny;function Av(){return ny||(ny=1,Object.defineProperty(en,"__esModule",{value:!0}),en.HapiLifecycleMethodNames=en.HapiLayerType=en.handlerPatched=en.HapiComponentName=void 0,en.HapiComponentName="@hapi/hapi",en.handlerPatched=Symbol("hapi-handler-patched"),en.HapiLayerType={ROUTER:"router",PLUGIN:"plugin",EXT:"server.ext"},en.HapiLifecycleMethodNames=new Set(["onPreAuth","onCredentials","onPostAuth","onPreHandler","onPostHandler","onPreResponse","onRequest"])),en}var cf={},Da={},ry;function EK(){return ry||(ry=1,Object.defineProperty(Da,"__esModule",{value:!0}),Da.ATTR_HTTP_METHOD=void 0,Da.ATTR_HTTP_METHOD="http.method"),Da}var uf={},oy;function gv(){return oy||(oy=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,(function(t){t.HAPI_TYPE="hapi.type",t.PLUGIN_NAME="hapi.plugin.name",t.EXT_TYPE="server.ext.type"})(e.AttributeNames||(e.AttributeNames={}))})(uf)),uf}var sy;function TK(){return sy||(sy=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getPluginFromInput=e.getExtMetadata=e.getRouteMetadata=e.isPatchableExtMethod=e.isDirectExtInput=e.isLifecycleExtEventObj=e.isLifecycleExtType=e.getPluginName=void 0;const t=_t(),n=EK(),r=Av(),o=gv(),s=Le;function i(p){return p.name?p.name:p.pkg.name}e.getPluginName=i;const a=p=>typeof p=="string"&&r.HapiLifecycleMethodNames.has(p);e.isLifecycleExtType=a;const c=p=>{const E=p?.type;return E!==void 0&&(0,e.isLifecycleExtType)(E)};e.isLifecycleExtEventObj=c;const l=p=>Array.isArray(p)&&p.length<=3&&(0,e.isLifecycleExtType)(p[0])&&typeof p[1]=="function";e.isDirectExtInput=l;const f=p=>!Array.isArray(p);e.isPatchableExtMethod=f;const d=(p,E,T)=>{const h={[t.ATTR_HTTP_ROUTE]:p.path};E&s.SemconvStability.OLD&&(h[n.ATTR_HTTP_METHOD]=p.method),E&s.SemconvStability.STABLE&&(h[t.ATTR_HTTP_REQUEST_METHOD]=p.method);let m;return T?(h[o.AttributeNames.HAPI_TYPE]=r.HapiLayerType.PLUGIN,h[o.AttributeNames.PLUGIN_NAME]=T,m=`${T}: route - ${p.path}`):(h[o.AttributeNames.HAPI_TYPE]=r.HapiLayerType.ROUTER,m=`route - ${p.path}`),{attributes:h,name:m}};e.getRouteMetadata=d;const u=(p,E)=>E?{attributes:{[o.AttributeNames.EXT_TYPE]:p,[o.AttributeNames.HAPI_TYPE]:r.HapiLayerType.EXT,[o.AttributeNames.PLUGIN_NAME]:E},name:`${E}: ext - ${p}`}:{attributes:{[o.AttributeNames.EXT_TYPE]:p,[o.AttributeNames.HAPI_TYPE]:r.HapiLayerType.EXT},name:`ext - ${p}`};e.getExtMetadata=u;const _=p=>"plugin"in p?"plugin"in p.plugin?p.plugin.plugin:p.plugin:p;e.getPluginFromInput=_})(cf)),cf}var iy;function hK(){if(iy)return La;iy=1,Object.defineProperty(La,"__esModule",{value:!0}),La.HapiInstrumentation=void 0;const e=Me(),t=ln,n=Le,r=pK(),o=Av(),s=TK();class i extends n.InstrumentationBase{_semconvStability;constructor(c={}){super(r.PACKAGE_NAME,r.PACKAGE_VERSION,c),this._semconvStability=(0,n.semconvStabilityFromStr)("http",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}init(){return new n.InstrumentationNodeModuleDefinition(o.HapiComponentName,[">=17.0.0 <22"],c=>{const l=c[Symbol.toStringTag]==="Module"?c.default:c;return(0,n.isWrapped)(l.server)||this._wrap(l,"server",this._getServerPatch.bind(this)),(0,n.isWrapped)(l.Server)||this._wrap(l,"Server",this._getServerPatch.bind(this)),l},c=>{const l=c[Symbol.toStringTag]==="Module"?c.default:c;this._massUnwrap([l],["server","Server"])})}_getServerPatch(c){const l=this,f=this;return function(u){const _=c.apply(this,[u]);return f._wrap(_,"route",p=>l._getServerRoutePatch.bind(l)(p)),f._wrap(_,"ext",p=>l._getServerExtPatch.bind(l)(p)),f._wrap(_,"register",l._getServerRegisterPatch.bind(l)),_}}_getServerRegisterPatch(c){const l=this;return function(d,u){if(Array.isArray(d))for(const _ of d){const p=(0,s.getPluginFromInput)(_);l._wrapRegisterHandler(p)}else{const _=(0,s.getPluginFromInput)(d);l._wrapRegisterHandler(_)}return c.apply(this,[d,u])}}_getServerExtPatch(c,l){const f=this;return function(...u){if(Array.isArray(u[0])){const _=u[0];for(let p=0;p<_.length;p++){const E=_[p];if((0,s.isLifecycleExtType)(E.type)){const T=E,h=f._wrapExtMethods(T.method,E.type,l);T.method=h,_[p]=T}}return c.apply(this,u)}else if((0,s.isDirectExtInput)(u)){const _=u,p=_[1],E=f._wrapExtMethods(p,_[0],l);return c.apply(this,[_[0],E,_[2]])}else if((0,s.isLifecycleExtEventObj)(u[0])){const _=u[0],p=f._wrapExtMethods(_.method,_.type,l);return _.method=p,c.call(this,_)}return c.apply(this,u)}}_getServerRoutePatch(c,l){const f=this;return function(d){if(Array.isArray(d))for(let u=0;u<d.length;u++){const _=f._wrapRouteHandler.call(f,d[u],l);d[u]=_}else d=f._wrapRouteHandler.call(f,d,l);return c.apply(this,[d])}}_wrapRegisterHandler(c){const l=this,f=(0,s.getPluginName)(c),d=c.register,u=this,_=function(p,E){return u._wrap(p,"route",T=>l._getServerRoutePatch.bind(l)(T,f)),u._wrap(p,"ext",T=>l._getServerExtPatch.bind(l)(T,f)),d.call(this,p,E)};c.register=_}_wrapExtMethods(c,l,f){const d=this;if(c instanceof Array){for(let u=0;u<c.length;u++)c[u]=d._wrapExtMethods(c[u],l);return c}else if((0,s.isPatchableExtMethod)(c))return c[o.handlerPatched]===!0?c:(c[o.handlerPatched]=!0,async function(..._){if(e.trace.getSpan(e.context.active())===void 0)return await c.apply(this,_);const p=(0,s.getExtMetadata)(l,f),E=d.tracer.startSpan(p.name,{attributes:p.attributes});try{return await e.context.with(e.trace.setSpan(e.context.active(),E),c,void 0,..._)}catch(T){throw E.recordException(T),E.setStatus({code:e.SpanStatusCode.ERROR,message:T.message}),T}finally{E.end()}});return c}_wrapRouteHandler(c,l){const f=this;if(c[o.handlerPatched]===!0)return c;c[o.handlerPatched]=!0;const d=u=>async function(..._){if(e.trace.getSpan(e.context.active())===void 0)return await u.call(this,..._);const p=(0,t.getRPCMetadata)(e.context.active());p?.type===t.RPCType.HTTP&&(p.route=c.path);const E=(0,s.getRouteMetadata)(c,f._semconvStability,l),T=f.tracer.startSpan(E.name,{attributes:E.attributes});try{return await e.context.with(e.trace.setSpan(e.context.active(),T),()=>u.call(this,..._))}catch(h){throw T.recordException(h),T.setStatus({code:e.SpanStatusCode.ERROR,message:h.message}),h}finally{T.end()}};if(typeof c.handler=="function")c.handler=d(c.handler);else if(typeof c.options=="function"){const u=c.options;c.options=function(_){const p=u(_);return typeof p.handler=="function"&&(p.handler=d(p.handler)),p}}else typeof c.options?.handler=="function"&&(c.options.handler=d(c.options.handler));return c}}return La.HapiInstrumentation=i,La}var ay;function SK(){return ay||(ay=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=e.HapiInstrumentation=void 0;var t=hK();Object.defineProperty(e,"HapiInstrumentation",{enumerable:!0,get:function(){return t.HapiInstrumentation}});var n=gv();Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return n.AttributeNames}})})(af)),af}var mK=SK();const Rv="Hapi",AK=Ne(Rv,()=>new mK.HapiInstrumentation),gK=(()=>({name:Rv,setupOnce(){AK()}})),RK=gK,Oo={HONO_TYPE:"hono.type",HONO_NAME:"hono.name"},Bc={MIDDLEWARE:"middleware",REQUEST_HANDLER:"request_handler"},NK="@sentry/instrumentation-hono",yK="0.0.1";class OK extends yt{constructor(t={}){super(NK,yK,t)}init(){return[new dt("hono",[">=4.0.0 <5"],t=>this._patch(t))]}_patch(t){const n=this;class r extends t.Hono{constructor(...s){super(...s),n._wrap(this,"get",n._patchHandler()),n._wrap(this,"post",n._patchHandler()),n._wrap(this,"put",n._patchHandler()),n._wrap(this,"delete",n._patchHandler()),n._wrap(this,"options",n._patchHandler()),n._wrap(this,"patch",n._patchHandler()),n._wrap(this,"all",n._patchHandler()),n._wrap(this,"on",n._patchOnHandler()),n._wrap(this,"use",n._patchMiddlewareHandler())}}try{t.Hono=r}catch{return{...t,Hono:r}}return t}_patchHandler(){const t=this;return function(n){return function(...o){if(typeof o[0]=="string"){const s=o[0];if(o.length===1)return n.apply(this,[s]);const i=o.slice(1);return n.apply(this,[s,...i.map(a=>t._wrapHandler(a))])}return n.apply(this,o.map(s=>t._wrapHandler(s)))}}}_patchOnHandler(){const t=this;return function(n){return function(...o){const s=o.slice(2);return n.apply(this,[...o.slice(0,2),...s.map(i=>t._wrapHandler(i))])}}}_patchMiddlewareHandler(){const t=this;return function(n){return function(...o){if(typeof o[0]=="string"){const s=o[0];if(o.length===1)return n.apply(this,[s]);const i=o.slice(1);return n.apply(this,[s,...i.map(a=>t._wrapHandler(a))])}return n.apply(this,o.map(s=>t._wrapHandler(s)))}}}_wrapHandler(t){const n=this;return function(r,o){if(!n.isEnabled())return t.apply(this,[r,o]);const s=r.req.path,i=n.tracer.startSpan(s);return b.context.with(b.trace.setSpan(b.context.active(),i),()=>n._safeExecute(()=>{const a=t.apply(this,[r,o]);if(tr(a))return a.then(c=>{const l=n._determineHandlerType(c);return i.setAttributes({[Oo.HONO_TYPE]:l,[Oo.HONO_NAME]:l===Bc.REQUEST_HANDLER?s:t.name||"anonymous"}),n.getConfig().responseHook?.(i),c});{const c=n._determineHandlerType(a);return i.setAttributes({[Oo.HONO_TYPE]:c,[Oo.HONO_NAME]:c===Bc.REQUEST_HANDLER?s:t.name||"anonymous"}),n.getConfig().responseHook?.(i),a}},()=>i.end(),a=>{n._handleError(i,a),i.end()}))}}_safeExecute(t,n,r){try{const o=t();return tr(o)?o.then(()=>n(),s=>r(s)):n(),o}catch(o){throw r(o),o}}_determineHandlerType(t){return t===void 0?Bc.MIDDLEWARE:Bc.REQUEST_HANDLER}_handleError(t,n){n instanceof Error&&(t.setStatus({code:b.SpanStatusCode.ERROR,message:n.message}),t.recordException(n))}}const Nv="Hono";function bK(e){const t=Re(e).data,n=t[Oo.HONO_TYPE];if(t[Ee]||!n)return;e.setAttributes({[Ge]:"auto.http.otel.hono",[Ee]:`${n}.hono`});const r=t[Oo.HONO_NAME];if(typeof r=="string"&&e.updateName(r),je()===Qo()){so&&x.warn("Isolation scope is default isolation scope - skipping setting transactionName");return}const o=t[Q.ATTR_HTTP_ROUTE],s=t[Q.ATTR_HTTP_REQUEST_METHOD];typeof o=="string"&&typeof s=="string"&&je().setTransactionName(`${s} ${o}`)}const IK=Ne(Nv,()=>new OK({responseHook:e=>{bK(e)}})),CK=(()=>({name:Nv,setupOnce(){IK()}})),MK=CK;var lf={},wa={},df={},cy;function sT(){return cy||(cy=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.KoaLayerType=void 0,(function(t){t.ROUTER="router",t.MIDDLEWARE="middleware"})(e.KoaLayerType||(e.KoaLayerType={}))})(df)),df}var Vr={},uy;function PK(){return uy||(uy=1,Object.defineProperty(Vr,"__esModule",{value:!0}),Vr.PACKAGE_NAME=Vr.PACKAGE_VERSION=void 0,Vr.PACKAGE_VERSION="0.57.0",Vr.PACKAGE_NAME="@opentelemetry/instrumentation-koa"),Vr}var xr={},ff={},ly;function yv(){return ly||(ly=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,(function(t){t.KOA_TYPE="koa.type",t.KOA_NAME="koa.name"})(e.AttributeNames||(e.AttributeNames={}))})(ff)),ff}var dy;function vK(){if(dy)return xr;dy=1,Object.defineProperty(xr,"__esModule",{value:!0}),xr.isLayerIgnored=xr.getMiddlewareMetadata=void 0;const e=sT(),t=yv(),n=_t(),r=(s,i,a,c)=>a?{attributes:{[t.AttributeNames.KOA_NAME]:c?.toString(),[t.AttributeNames.KOA_TYPE]:e.KoaLayerType.ROUTER,[n.ATTR_HTTP_ROUTE]:c?.toString()},name:s._matchedRouteName||`router - ${c}`}:{attributes:{[t.AttributeNames.KOA_NAME]:i.name??"middleware",[t.AttributeNames.KOA_TYPE]:e.KoaLayerType.MIDDLEWARE},name:`middleware - ${i.name}`};xr.getMiddlewareMetadata=r;const o=(s,i)=>!!(Array.isArray(i?.ignoreLayersType)&&i?.ignoreLayersType?.includes(s));return xr.isLayerIgnored=o,xr}var Ua={},fy;function LK(){return fy||(fy=1,Object.defineProperty(Ua,"__esModule",{value:!0}),Ua.kLayerPatched=void 0,Ua.kLayerPatched=Symbol("koa-layer-patched")),Ua}var _y;function DK(){if(_y)return wa;_y=1,Object.defineProperty(wa,"__esModule",{value:!0}),wa.KoaInstrumentation=void 0;const e=Me(),t=Le,n=sT(),r=PK(),o=vK(),s=ln,i=LK();class a extends t.InstrumentationBase{constructor(l={}){super(r.PACKAGE_NAME,r.PACKAGE_VERSION,l)}init(){return new t.InstrumentationNodeModuleDefinition("koa",[">=2.0.0 <4"],l=>{const f=l[Symbol.toStringTag]==="Module"?l.default:l;return f==null?f:((0,t.isWrapped)(f.prototype.use)&&this._unwrap(f.prototype,"use"),this._wrap(f.prototype,"use",this._getKoaUsePatch.bind(this)),l)},l=>{const f=l[Symbol.toStringTag]==="Module"?l.default:l;(0,t.isWrapped)(f.prototype.use)&&this._unwrap(f.prototype,"use")})}_getKoaUsePatch(l){const f=this;return function(u){let _;return u.router?_=f._patchRouterDispatch(u):_=f._patchLayer(u,!1),l.apply(this,[_])}}_patchRouterDispatch(l){e.diag.debug("Patching @koa/router dispatch");const d=l.router?.stack??[];for(const u of d){const _=u.path,p=u.stack;for(let E=0;E<p.length;E++){const T=p[E];p[E]=this._patchLayer(T,!0,_)}}return l}_patchLayer(l,f,d){const u=f?n.KoaLayerType.ROUTER:n.KoaLayerType.MIDDLEWARE;return l[i.kLayerPatched]===!0||(0,o.isLayerIgnored)(u,this.getConfig())?l:l.constructor.name==="GeneratorFunction"||l.constructor.name==="AsyncGeneratorFunction"?(e.diag.debug("ignoring generator-based Koa middleware layer"),l):(l[i.kLayerPatched]=!0,e.diag.debug("patching Koa middleware layer"),async(_,p)=>{if(e.trace.getSpan(e.context.active())===void 0)return l(_,p);const T=(0,o.getMiddlewareMetadata)(_,l,f,d),h=this.tracer.startSpan(T.name,{attributes:T.attributes}),m=(0,s.getRPCMetadata)(e.context.active());m?.type===s.RPCType.HTTP&&_._matchedRoute&&(m.route=_._matchedRoute.toString());const{requestHook:A}=this.getConfig();A&&(0,t.safeExecuteInTheMiddle)(()=>A(h,{context:_,middlewareLayer:l,layerType:u}),R=>{R&&e.diag.error("koa instrumentation: request hook failed",R)},!0);const g=e.trace.setSpan(e.context.active(),h);return e.context.with(g,async()=>{try{return await l(_,p)}catch(R){throw h.recordException(R),R}finally{h.end()}})})}}return wa.KoaInstrumentation=a,wa}var py;function wK(){return py||(py=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.KoaLayerType=e.AttributeNames=e.KoaInstrumentation=void 0;var t=DK();Object.defineProperty(e,"KoaInstrumentation",{enumerable:!0,get:function(){return t.KoaInstrumentation}});var n=yv();Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return n.AttributeNames}});var r=sT();Object.defineProperty(e,"KoaLayerType",{enumerable:!0,get:function(){return r.KoaLayerType}})})(lf)),lf}var UK=wK();const Ov="Koa",kK=Ne(Ov,UK.KoaInstrumentation,(e={})=>({ignoreLayersType:e.ignoreLayersType,requestHook(t,n){Nt(t,"auto.http.otel.koa");const r=Re(t).data,o=r["koa.type"];o&&t.setAttribute(Ee,`${o}.koa`);const s=r["koa.name"];if(typeof s=="string"&&t.updateName(s||"< unknown >"),je()===Qo()){so&&x.warn("Isolation scope is default isolation scope - skipping setting transactionName");return}const i=r[Q.ATTR_HTTP_ROUTE],a=n.context?.request?.method?.toUpperCase()||"GET";i&&je().setTransactionName(`${a} ${i}`)}})),GK=((e={})=>({name:Ov,setupOnce(){kK(e)}})),VK=GK;var _f={},pf={},Ef={},Ey;function bv(){return Ey||(Ey=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectNames=e.ConnectTypes=e.AttributeNames=void 0,(function(t){t.CONNECT_TYPE="connect.type",t.CONNECT_NAME="connect.name"})(e.AttributeNames||(e.AttributeNames={})),(function(t){t.MIDDLEWARE="middleware",t.REQUEST_HANDLER="request_handler"})(e.ConnectTypes||(e.ConnectTypes={})),(function(t){t.MIDDLEWARE="middleware",t.REQUEST_HANDLER="request handler"})(e.ConnectNames||(e.ConnectNames={}))})(Ef)),Ef}var $r={},Ty;function xK(){return Ty||(Ty=1,Object.defineProperty($r,"__esModule",{value:!0}),$r.PACKAGE_NAME=$r.PACKAGE_VERSION=void 0,$r.PACKAGE_VERSION="0.52.0",$r.PACKAGE_NAME="@opentelemetry/instrumentation-connect"),$r}var Pn={},ka={},hy;function $K(){return hy||(hy=1,Object.defineProperty(ka,"__esModule",{value:!0}),ka._LAYERS_STORE_PROPERTY=void 0,ka._LAYERS_STORE_PROPERTY=Symbol("opentelemetry.instrumentation-connect.request-route-stack")),ka}var Sy;function BK(){if(Sy)return Pn;Sy=1,Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.generateRoute=Pn.replaceCurrentStackRoute=Pn.addNewStackLayer=void 0;const e=Me(),t=$K(),n=s=>{Array.isArray(s[t._LAYERS_STORE_PROPERTY])===!1&&Object.defineProperty(s,t._LAYERS_STORE_PROPERTY,{enumerable:!1,value:[]}),s[t._LAYERS_STORE_PROPERTY].push("/");const i=s[t._LAYERS_STORE_PROPERTY].length;return()=>{i===s[t._LAYERS_STORE_PROPERTY].length?s[t._LAYERS_STORE_PROPERTY].pop():e.diag.warn("Connect: Trying to pop the stack multiple time")}};Pn.addNewStackLayer=n;const r=(s,i)=>{i&&s[t._LAYERS_STORE_PROPERTY].splice(-1,1,i)};Pn.replaceCurrentStackRoute=r;const o=s=>s[t._LAYERS_STORE_PROPERTY].reduce((i,a)=>i.replace(/\/+$/,"")+a);return Pn.generateRoute=o,Pn}var my;function HK(){return my||(my=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectInstrumentation=e.ANONYMOUS_NAME=void 0;const t=Me(),n=ln,r=bv(),o=xK(),s=Le,i=_t(),a=BK();e.ANONYMOUS_NAME="anonymous";class c extends s.InstrumentationBase{constructor(f={}){super(o.PACKAGE_NAME,o.PACKAGE_VERSION,f)}init(){return[new s.InstrumentationNodeModuleDefinition("connect",[">=3.0.0 <4"],f=>this._patchConstructor(f))]}_patchApp(f){(0,s.isWrapped)(f.use)||this._wrap(f,"use",this._patchUse.bind(this)),(0,s.isWrapped)(f.handle)||this._wrap(f,"handle",this._patchHandle.bind(this))}_patchConstructor(f){const d=this;return function(...u){const _=f.apply(this,u);return d._patchApp(_),_}}_patchNext(f,d){return function(_){const p=f.apply(this,[_]);return d(),p}}_startSpan(f,d){let u,_,p;f?(u=r.ConnectTypes.REQUEST_HANDLER,p=r.ConnectNames.REQUEST_HANDLER,_=f):(u=r.ConnectTypes.MIDDLEWARE,p=r.ConnectNames.MIDDLEWARE,_=d.name||e.ANONYMOUS_NAME);const E=`${p} - ${_}`,T={attributes:{[i.ATTR_HTTP_ROUTE]:f.length>0?f:"/",[r.AttributeNames.CONNECT_TYPE]:u,[r.AttributeNames.CONNECT_NAME]:_}};return this.tracer.startSpan(E,T)}_patchMiddleware(f,d){const u=this,_=d.length===4;function p(){if(!u.isEnabled())return d.apply(this,arguments);const[E,T,h]=_?[1,2,3]:[0,1,2],m=arguments[E],A=arguments[T],g=arguments[h];(0,a.replaceCurrentStackRoute)(m,f);const R=(0,n.getRPCMetadata)(t.context.active());f&&R?.type===n.RPCType.HTTP&&(R.route=(0,a.generateRoute)(m));let O="";f?O=`request handler - ${f}`:O=`middleware - ${d.name||e.ANONYMOUS_NAME}`;const C=u._startSpan(f,d);u._diag.debug("start span",O);let I=!1;function L(){I?u._diag.debug(`span ${C.name} - already finished`):(I=!0,u._diag.debug(`finishing span ${C.name}`),C.end()),A.removeListener("close",L)}return A.addListener("close",L),arguments[h]=u._patchNext(g,L),d.apply(this,arguments)}return Object.defineProperty(p,"length",{value:d.length,writable:!1,configurable:!0}),p}_patchUse(f){const d=this;return function(...u){const _=u[u.length-1],p=u[u.length-2]||"";return u[u.length-1]=d._patchMiddleware(p,_),f.apply(this,u)}}_patchHandle(f){const d=this;return function(){const[u,_]=[0,2],p=arguments[u],E=arguments[_],T=(0,a.addNewStackLayer)(p);return typeof E=="function"&&(arguments[_]=d._patchOut(E,T)),f.apply(this,arguments)}}_patchOut(f,d){return function(..._){return d(),Reflect.apply(f,this,_)}}}e.ConnectInstrumentation=c})(pf)),pf}var Ay;function FK(){return Ay||(Ay=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectTypes=e.ConnectNames=e.AttributeNames=e.ANONYMOUS_NAME=e.ConnectInstrumentation=void 0;var t=HK();Object.defineProperty(e,"ConnectInstrumentation",{enumerable:!0,get:function(){return t.ConnectInstrumentation}}),Object.defineProperty(e,"ANONYMOUS_NAME",{enumerable:!0,get:function(){return t.ANONYMOUS_NAME}});var n=bv();Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return n.AttributeNames}}),Object.defineProperty(e,"ConnectNames",{enumerable:!0,get:function(){return n.ConnectNames}}),Object.defineProperty(e,"ConnectTypes",{enumerable:!0,get:function(){return n.ConnectTypes}})})(_f)),_f}var YK=FK();const Iv="Connect",jK=Ne(Iv,()=>new YK.ConnectInstrumentation),qK=(()=>({name:Iv,setupOnce(){jK()}})),WK=qK;var Tf={},hf={},et={},gy;function KK(){return gy||(gy=1,Object.defineProperty(et,"__esModule",{value:!0}),et.DB_SYSTEM_VALUE_MSSQL=et.ATTR_NET_PEER_PORT=et.ATTR_NET_PEER_NAME=et.ATTR_DB_USER=et.ATTR_DB_SYSTEM=et.ATTR_DB_STATEMENT=et.ATTR_DB_SQL_TABLE=et.ATTR_DB_NAME=void 0,et.ATTR_DB_NAME="db.name",et.ATTR_DB_SQL_TABLE="db.sql.table",et.ATTR_DB_STATEMENT="db.statement",et.ATTR_DB_SYSTEM="db.system",et.ATTR_DB_USER="db.user",et.ATTR_NET_PEER_NAME="net.peer.name",et.ATTR_NET_PEER_PORT="net.peer.port",et.DB_SYSTEM_VALUE_MSSQL="mssql"),et}var Br={},Ry;function zK(){if(Ry)return Br;Ry=1,Object.defineProperty(Br,"__esModule",{value:!0}),Br.once=Br.getSpanName=void 0;function e(n,r,o,s){return n==="execBulkLoad"&&s&&r?`${n} ${s} ${r}`:n==="callProcedure"?r?`${n} ${o} ${r}`:`${n} ${o}`:r?`${n} ${r}`:`${n}`}Br.getSpanName=e;const t=n=>{let r=!1;return(...o)=>{if(!r)return r=!0,n(...o)}};return Br.once=t,Br}var Hr={},Ny;function ZK(){return Ny||(Ny=1,Object.defineProperty(Hr,"__esModule",{value:!0}),Hr.PACKAGE_NAME=Hr.PACKAGE_VERSION=void 0,Hr.PACKAGE_VERSION="0.27.0",Hr.PACKAGE_NAME="@opentelemetry/instrumentation-tedious"),Hr}var yy;function XK(){return yy||(yy=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TediousInstrumentation=e.INJECTED_CTX=void 0;const t=Me(),n=zu,r=Le,o=KK(),s=zK(),i=ZK(),a=Symbol("opentelemetry.instrumentation-tedious.current-database");e.INJECTED_CTX=Symbol("opentelemetry.instrumentation-tedious.context-info-injected");const c=["callProcedure","execSql","execSqlBatch","execBulkLoad","prepare","execute"];function l(d){Object.defineProperty(this,a,{value:d,writable:!0})}class f extends r.InstrumentationBase{static COMPONENT="tedious";constructor(u={}){super(i.PACKAGE_NAME,i.PACKAGE_VERSION,u)}init(){return[new r.InstrumentationNodeModuleDefinition(f.COMPONENT,[">=1.11.0 <20"],u=>{const _=u.Connection.prototype;for(const p of c)(0,r.isWrapped)(_[p])&&this._unwrap(_,p),this._wrap(_,p,this._patchQuery(p,u));return(0,r.isWrapped)(_.connect)&&this._unwrap(_,"connect"),this._wrap(_,"connect",this._patchConnect),u},u=>{if(u===void 0)return;const _=u.Connection.prototype;for(const p of c)this._unwrap(_,p);this._unwrap(_,"connect")})]}_patchConnect(u){return function(){return l.call(this,this.config?.options?.database),this.removeListener("databaseChange",l),this.on("databaseChange",l),this.once("end",()=>{this.removeListener("databaseChange",l)}),u.apply(this,arguments)}}_buildTraceparent(u){const _=u.spanContext();return`00-${_.traceId}-${_.spanId}-0${Number(_.traceFlags||t.TraceFlags.NONE).toString(16)}`}_injectContextInfo(u,_,p){return new Promise(E=>{try{const T="set context_info @opentelemetry_traceparent",h=new _.Request(T,A=>{E()});Object.defineProperty(h,e.INJECTED_CTX,{value:!0});const m=Buffer.from(p,"utf8");h.addParameter("opentelemetry_traceparent",_.TYPES.VarBinary,m,{length:m.length}),u.execSql(h)}catch{E()}})}_shouldInjectFor(u){return u==="execSql"||u==="execSqlBatch"||u==="callProcedure"||u==="execute"}_patchQuery(u,_){return p=>{const E=this;function T(h){if(h?.[e.INJECTED_CTX])return p.apply(this,arguments);if(!(h instanceof n.EventEmitter))return E._diag.warn(`Unexpected invocation of patched ${u} method. Span not recorded`),p.apply(this,arguments);let m=0,A=0;const g=()=>A++,R=()=>m++,O=this[a],C=(B=>B.sqlTextOrProcedure==="sp_prepare"&&B.parametersByName?.stmt?.value?B.parametersByName.stmt.value:B.sqlTextOrProcedure)(h),I=E.tracer.startSpan((0,s.getSpanName)(u,O,C,h.table),{kind:t.SpanKind.CLIENT,attributes:{[o.ATTR_DB_SYSTEM]:o.DB_SYSTEM_VALUE_MSSQL,[o.ATTR_DB_NAME]:O,[o.ATTR_NET_PEER_PORT]:this.config?.options?.port,[o.ATTR_NET_PEER_NAME]:this.config?.server,[o.ATTR_DB_USER]:this.config?.userName??this.config?.authentication?.options?.userName,[o.ATTR_DB_STATEMENT]:C,[o.ATTR_DB_SQL_TABLE]:h.table}}),L=(0,s.once)(B=>{h.removeListener("done",g),h.removeListener("doneInProc",g),h.removeListener("doneProc",R),h.removeListener("error",L),this.removeListener("end",L),I.setAttribute("tedious.procedure_count",m),I.setAttribute("tedious.statement_count",A),B&&I.setStatus({code:t.SpanStatusCode.ERROR,message:B.message}),I.end()});h.on("done",g),h.on("doneInProc",g),h.on("doneProc",R),h.once("error",L),this.on("end",L),typeof h.callback=="function"?E._wrap(h,"callback",E._patchCallbackQuery(L)):E._diag.error("Expected request.callback to be a function");const U=()=>t.context.with(t.trace.setSpan(t.context.active(),I),p,this,...arguments);if(!(E.getConfig().enableTraceContextPropagation&&E._shouldInjectFor(u)))return U();const $=E._buildTraceparent(I);E._injectContextInfo(this,_,$).finally(U)}return Object.defineProperty(T,"length",{value:p.length,writable:!1}),T}}_patchCallbackQuery(u){return _=>function(p,E,T){return u(p),_.apply(this,arguments)}}}e.TediousInstrumentation=f})(hf)),hf}var Oy;function QK(){return Oy||(Oy=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TediousInstrumentation=void 0;var t=XK();Object.defineProperty(e,"TediousInstrumentation",{enumerable:!0,get:function(){return t.TediousInstrumentation}})})(Tf)),Tf}var JK=QK();const e2=new Set(["callProcedure","execSql","execSqlBatch","execBulkLoad","prepare","execute"]),Cv="Tedious",t2=Ne(Cv,()=>new JK.TediousInstrumentation({})),n2=(()=>{let e;return{name:Cv,setupOnce(){const t=t2();e=jM(t)},setup(t){e?.(()=>t.on("spanStart",n=>{const{description:r,data:o}=Re(n);if(!r||o["db.system"]!=="mssql")return;const s=r.split(" ")[0]||"";e2.has(s)&&n.setAttribute(Ge,"auto.db.otel.tedious")}))}}}),r2=n2;var Sf={},Ga={},Fr={},by;function o2(){return by||(by=1,Object.defineProperty(Fr,"__esModule",{value:!0}),Fr.PACKAGE_NAME=Fr.PACKAGE_VERSION=void 0,Fr.PACKAGE_VERSION="0.52.0",Fr.PACKAGE_NAME="@opentelemetry/instrumentation-generic-pool"),Fr}var Iy;function s2(){if(Iy)return Ga;Iy=1,Object.defineProperty(Ga,"__esModule",{value:!0}),Ga.GenericPoolInstrumentation=void 0;const e=Me(),t=Le,n=o2(),r="generic-pool";class o extends t.InstrumentationBase{_isDisabled=!1;constructor(i={}){super(n.PACKAGE_NAME,n.PACKAGE_VERSION,i)}init(){return[new t.InstrumentationNodeModuleDefinition(r,[">=3.0.0 <4"],i=>{const a=i.Pool;return(0,t.isWrapped)(a.prototype.acquire)&&this._unwrap(a.prototype,"acquire"),this._wrap(a.prototype,"acquire",this._acquirePatcher.bind(this)),i},i=>{const a=i.Pool;return this._unwrap(a.prototype,"acquire"),i}),new t.InstrumentationNodeModuleDefinition(r,[">=2.4.0 <3"],i=>{const a=i.Pool;return(0,t.isWrapped)(a.prototype.acquire)&&this._unwrap(a.prototype,"acquire"),this._wrap(a.prototype,"acquire",this._acquireWithCallbacksPatcher.bind(this)),i},i=>{const a=i.Pool;return this._unwrap(a.prototype,"acquire"),i}),new t.InstrumentationNodeModuleDefinition(r,[">=2.0.0 <2.4"],i=>(this._isDisabled=!1,(0,t.isWrapped)(i.Pool)&&this._unwrap(i,"Pool"),this._wrap(i,"Pool",this._poolWrapper.bind(this)),i),i=>(this._isDisabled=!0,i))]}_acquirePatcher(i){const a=this;return function(...l){const f=e.context.active(),d=a.tracer.startSpan("generic-pool.acquire",{},f);return e.context.with(e.trace.setSpan(f,d),()=>i.call(this,...l).then(u=>(d.end(),u),u=>{throw d.recordException(u),d.end(),u}))}}_poolWrapper(i){const a=this;return function(){const l=i.apply(this,arguments);return a._wrap(l,"acquire",a._acquireWithCallbacksPatcher.bind(a)),l}}_acquireWithCallbacksPatcher(i){const a=this;return function(l,f){if(a._isDisabled)return i.call(this,l,f);const d=e.context.active(),u=a.tracer.startSpan("generic-pool.acquire",{},d);return e.context.with(e.trace.setSpan(d,u),()=>{i.call(this,(_,p)=>{if(u.end(),l)return l(_,p)},f)})}}}return Ga.GenericPoolInstrumentation=o,Ga}var Cy;function i2(){return Cy||(Cy=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.GenericPoolInstrumentation=void 0;var t=s2();Object.defineProperty(e,"GenericPoolInstrumentation",{enumerable:!0,get:function(){return t.GenericPoolInstrumentation}})})(Sf)),Sf}var a2=i2();const Mv="GenericPool",c2=Ne(Mv,()=>new a2.GenericPoolInstrumentation({})),u2=(()=>{let e;return{name:Mv,setupOnce(){const t=c2();e=jM(t)},setup(t){e?.(()=>t.on("spanStart",n=>{const o=Re(n).description;(o==="generic-pool.aquire"||o==="generic-pool.acquire")&&n.setAttribute(Ge,"auto.db.otel.generic_pool")}))}}}),l2=u2;var mf={},Va={},tn={},My;function Pv(){return My||(My=1,Object.defineProperty(tn,"__esModule",{value:!0}),tn.ATTR_NET_PEER_PORT=tn.ATTR_NET_PEER_NAME=tn.ATTR_MESSAGING_SYSTEM=tn.ATTR_MESSAGING_OPERATION=void 0,tn.ATTR_MESSAGING_OPERATION="messaging.operation",tn.ATTR_MESSAGING_SYSTEM="messaging.system",tn.ATTR_NET_PEER_NAME="net.peer.name",tn.ATTR_NET_PEER_PORT="net.peer.port"),tn}var He={},Py;function vv(){return Py||(Py=1,Object.defineProperty(He,"__esModule",{value:!0}),He.ATTR_MESSAGING_CONVERSATION_ID=He.OLD_ATTR_MESSAGING_MESSAGE_ID=He.MESSAGING_DESTINATION_KIND_VALUE_TOPIC=He.ATTR_MESSAGING_URL=He.ATTR_MESSAGING_PROTOCOL_VERSION=He.ATTR_MESSAGING_PROTOCOL=He.MESSAGING_OPERATION_VALUE_PROCESS=He.ATTR_MESSAGING_RABBITMQ_ROUTING_KEY=He.ATTR_MESSAGING_DESTINATION_KIND=He.ATTR_MESSAGING_DESTINATION=void 0,He.ATTR_MESSAGING_DESTINATION="messaging.destination",He.ATTR_MESSAGING_DESTINATION_KIND="messaging.destination_kind",He.ATTR_MESSAGING_RABBITMQ_ROUTING_KEY="messaging.rabbitmq.routing_key",He.MESSAGING_OPERATION_VALUE_PROCESS="process",He.ATTR_MESSAGING_PROTOCOL="messaging.protocol",He.ATTR_MESSAGING_PROTOCOL_VERSION="messaging.protocol_version",He.ATTR_MESSAGING_URL="messaging.url",He.MESSAGING_DESTINATION_KIND_VALUE_TOPIC="topic",He.OLD_ATTR_MESSAGING_MESSAGE_ID="messaging.message_id",He.ATTR_MESSAGING_CONVERSATION_ID="messaging.conversation_id"),He}var Af={},vy;function Lv(){return vy||(vy=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_CONFIG=e.EndOperation=void 0,(function(t){t.AutoAck="auto ack",t.Ack="ack",t.AckAll="ackAll",t.Reject="reject",t.Nack="nack",t.NackAll="nackAll",t.ChannelClosed="channel closed",t.ChannelError="channel error",t.InstrumentationTimeout="instrumentation timeout"})(e.EndOperation||(e.EndOperation={})),e.DEFAULT_CONFIG={consumeTimeoutMs:1e3*60,useLinksForConsume:!1}})(Af)),Af}var Fe={},Ly;function d2(){if(Ly)return Fe;Ly=1,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.isConfirmChannelTracing=Fe.unmarkConfirmChannelTracing=Fe.markConfirmChannelTracing=Fe.getConnectionAttributesFromUrl=Fe.getConnectionAttributesFromServer=Fe.normalizeExchange=Fe.CONNECTION_ATTRIBUTES=Fe.CHANNEL_CONSUME_TIMEOUT_TIMER=Fe.CHANNEL_SPANS_NOT_ENDED=Fe.MESSAGE_STORED_SPAN=void 0;const e=Me(),t=Pv(),n=vv();Fe.MESSAGE_STORED_SPAN=Symbol("opentelemetry.amqplib.message.stored-span"),Fe.CHANNEL_SPANS_NOT_ENDED=Symbol("opentelemetry.amqplib.channel.spans-not-ended"),Fe.CHANNEL_CONSUME_TIMEOUT_TIMER=Symbol("opentelemetry.amqplib.channel.consumer-timeout-timer"),Fe.CONNECTION_ATTRIBUTES=Symbol("opentelemetry.amqplib.connection.attributes");const r=(0,e.createContextKey)("opentelemetry.amqplib.channel.is-confirm-channel"),o=E=>E!==""?E:"<default>";Fe.normalizeExchange=o;const s=E=>E.replace(/:[^:@/]*@/,":***@"),i=(E,T)=>E||(T==="AMQP"?5672:5671),a=E=>{const T=E||"amqp";return(T.endsWith(":")?T.substring(0,T.length-1):T).toUpperCase()},c=E=>E||"localhost",l=(E,T,h,m)=>h?{[T]:h}:(e.diag.error(`amqplib instrumentation: could not extract connection attribute ${m} from user supplied url`,{url:E}),{}),f=E=>{const T=E.serverProperties.product?.toLowerCase?.();return T?{[t.ATTR_MESSAGING_SYSTEM]:T}:{}};Fe.getConnectionAttributesFromServer=f;const d=E=>{const T={[n.ATTR_MESSAGING_PROTOCOL_VERSION]:"0.9.1"};if(E=E||"amqp://localhost",typeof E=="object"){const h=E,m=a(h?.protocol);Object.assign(T,{...l(E,n.ATTR_MESSAGING_PROTOCOL,m,"protocol")});const A=c(h?.hostname);Object.assign(T,{...l(E,t.ATTR_NET_PEER_NAME,A,"hostname")});const g=i(h.port,m);Object.assign(T,{...l(E,t.ATTR_NET_PEER_PORT,g,"port")})}else{const h=s(E);T[n.ATTR_MESSAGING_URL]=h;try{const m=new URL(h),A=a(m.protocol);Object.assign(T,{...l(h,n.ATTR_MESSAGING_PROTOCOL,A,"protocol")});const g=c(m.hostname);Object.assign(T,{...l(h,t.ATTR_NET_PEER_NAME,g,"hostname")});const R=i(m.port?parseInt(m.port):void 0,A);Object.assign(T,{...l(h,t.ATTR_NET_PEER_PORT,R,"port")})}catch(m){e.diag.error("amqplib instrumentation: error while extracting connection details from connection url",{censoredUrl:h,err:m})}}return T};Fe.getConnectionAttributesFromUrl=d;const u=E=>E.setValue(r,!0);Fe.markConfirmChannelTracing=u;const _=E=>E.deleteValue(r);Fe.unmarkConfirmChannelTracing=_;const p=E=>E.getValue(r)===!0;return Fe.isConfirmChannelTracing=p,Fe}var Yr={},Dy;function f2(){return Dy||(Dy=1,Object.defineProperty(Yr,"__esModule",{value:!0}),Yr.PACKAGE_NAME=Yr.PACKAGE_VERSION=void 0,Yr.PACKAGE_VERSION="0.55.0",Yr.PACKAGE_NAME="@opentelemetry/instrumentation-amqplib"),Yr}var wy;function _2(){if(wy)return Va;wy=1,Object.defineProperty(Va,"__esModule",{value:!0}),Va.AmqplibInstrumentation=void 0;const e=Me(),t=ln,n=Le,r=Pv(),o=vv(),s=Lv(),i=d2(),a=f2(),c=[">=0.5.5 <1"];class l extends n.InstrumentationBase{constructor(d={}){super(a.PACKAGE_NAME,a.PACKAGE_VERSION,{...s.DEFAULT_CONFIG,...d})}setConfig(d={}){super.setConfig({...s.DEFAULT_CONFIG,...d})}init(){const d=new n.InstrumentationNodeModuleFile("amqplib/lib/channel_model.js",c,this.patchChannelModel.bind(this),this.unpatchChannelModel.bind(this)),u=new n.InstrumentationNodeModuleFile("amqplib/lib/callback_model.js",c,this.patchChannelModel.bind(this),this.unpatchChannelModel.bind(this)),_=new n.InstrumentationNodeModuleFile("amqplib/lib/connect.js",c,this.patchConnect.bind(this),this.unpatchConnect.bind(this));return new n.InstrumentationNodeModuleDefinition("amqplib",c,void 0,void 0,[d,_,u])}patchConnect(d){return d=this.unpatchConnect(d),(0,n.isWrapped)(d.connect)||this._wrap(d,"connect",this.getConnectPatch.bind(this)),d}unpatchConnect(d){return(0,n.isWrapped)(d.connect)&&this._unwrap(d,"connect"),d}patchChannelModel(d,u){return(0,n.isWrapped)(d.Channel.prototype.publish)||this._wrap(d.Channel.prototype,"publish",this.getPublishPatch.bind(this,u)),(0,n.isWrapped)(d.Channel.prototype.consume)||this._wrap(d.Channel.prototype,"consume",this.getConsumePatch.bind(this,u)),(0,n.isWrapped)(d.Channel.prototype.ack)||this._wrap(d.Channel.prototype,"ack",this.getAckPatch.bind(this,!1,s.EndOperation.Ack)),(0,n.isWrapped)(d.Channel.prototype.nack)||this._wrap(d.Channel.prototype,"nack",this.getAckPatch.bind(this,!0,s.EndOperation.Nack)),(0,n.isWrapped)(d.Channel.prototype.reject)||this._wrap(d.Channel.prototype,"reject",this.getAckPatch.bind(this,!0,s.EndOperation.Reject)),(0,n.isWrapped)(d.Channel.prototype.ackAll)||this._wrap(d.Channel.prototype,"ackAll",this.getAckAllPatch.bind(this,!1,s.EndOperation.AckAll)),(0,n.isWrapped)(d.Channel.prototype.nackAll)||this._wrap(d.Channel.prototype,"nackAll",this.getAckAllPatch.bind(this,!0,s.EndOperation.NackAll)),(0,n.isWrapped)(d.Channel.prototype.emit)||this._wrap(d.Channel.prototype,"emit",this.getChannelEmitPatch.bind(this)),(0,n.isWrapped)(d.ConfirmChannel.prototype.publish)||this._wrap(d.ConfirmChannel.prototype,"publish",this.getConfirmedPublishPatch.bind(this,u)),d}unpatchChannelModel(d){return(0,n.isWrapped)(d.Channel.prototype.publish)&&this._unwrap(d.Channel.prototype,"publish"),(0,n.isWrapped)(d.Channel.prototype.consume)&&this._unwrap(d.Channel.prototype,"consume"),(0,n.isWrapped)(d.Channel.prototype.ack)&&this._unwrap(d.Channel.prototype,"ack"),(0,n.isWrapped)(d.Channel.prototype.nack)&&this._unwrap(d.Channel.prototype,"nack"),(0,n.isWrapped)(d.Channel.prototype.reject)&&this._unwrap(d.Channel.prototype,"reject"),(0,n.isWrapped)(d.Channel.prototype.ackAll)&&this._unwrap(d.Channel.prototype,"ackAll"),(0,n.isWrapped)(d.Channel.prototype.nackAll)&&this._unwrap(d.Channel.prototype,"nackAll"),(0,n.isWrapped)(d.Channel.prototype.emit)&&this._unwrap(d.Channel.prototype,"emit"),(0,n.isWrapped)(d.ConfirmChannel.prototype.publish)&&this._unwrap(d.ConfirmChannel.prototype,"publish"),d}getConnectPatch(d){return function(_,p,E){return d.call(this,_,p,function(T,h){if(T==null){const m=(0,i.getConnectionAttributesFromUrl)(_),A=(0,i.getConnectionAttributesFromServer)(h);h[i.CONNECTION_ATTRIBUTES]={...m,...A}}E.apply(this,arguments)})}}getChannelEmitPatch(d){const u=this;return function(p){if(p==="close"){u.endAllSpansOnChannel(this,!0,s.EndOperation.ChannelClosed,void 0);const E=this[i.CHANNEL_CONSUME_TIMEOUT_TIMER];E&&clearInterval(E),this[i.CHANNEL_CONSUME_TIMEOUT_TIMER]=void 0}else p==="error"&&u.endAllSpansOnChannel(this,!0,s.EndOperation.ChannelError,void 0);return d.apply(this,arguments)}}getAckAllPatch(d,u,_){const p=this;return function(T){return p.endAllSpansOnChannel(this,d,u,T),_.apply(this,arguments)}}getAckPatch(d,u,_){const p=this;return function(T,h,m){const A=this,g=u===s.EndOperation.Reject?h:m,R=A[i.CHANNEL_SPANS_NOT_ENDED]??[],O=R.findIndex(C=>C.msg===T);if(O<0)p.endConsumerSpan(T,d,u,g);else if(u!==s.EndOperation.Reject&&h){for(let C=0;C<=O;C++)p.endConsumerSpan(R[C].msg,d,u,g);R.splice(0,O+1)}else p.endConsumerSpan(T,d,u,g),R.splice(O,1);return _.apply(this,arguments)}}getConsumePatch(d,u){const _=this;return function(E,T,h){const m=this;if(!Object.prototype.hasOwnProperty.call(m,i.CHANNEL_SPANS_NOT_ENDED)){const{consumeTimeoutMs:g}=_.getConfig();if(g){const R=setInterval(()=>{_.checkConsumeTimeoutOnChannel(m)},g);R.unref(),m[i.CHANNEL_CONSUME_TIMEOUT_TIMER]=R}m[i.CHANNEL_SPANS_NOT_ENDED]=[]}const A=function(g){if(!g)return T.call(this,g);const R=g.properties.headers??{};let O=e.propagation.extract(e.ROOT_CONTEXT,R);const C=g.fields?.exchange;let I;if(_._config.useLinksForConsume){const H=O?e.trace.getSpan(O)?.spanContext():void 0;O=void 0,H&&(I=[{context:H}])}const L=_.tracer.startSpan(`${E} process`,{kind:e.SpanKind.CONSUMER,attributes:{...m?.connection?.[i.CONNECTION_ATTRIBUTES],[o.ATTR_MESSAGING_DESTINATION]:C,[o.ATTR_MESSAGING_DESTINATION_KIND]:o.MESSAGING_DESTINATION_KIND_VALUE_TOPIC,[o.ATTR_MESSAGING_RABBITMQ_ROUTING_KEY]:g.fields?.routingKey,[r.ATTR_MESSAGING_OPERATION]:o.MESSAGING_OPERATION_VALUE_PROCESS,[o.OLD_ATTR_MESSAGING_MESSAGE_ID]:g?.properties.messageId,[o.ATTR_MESSAGING_CONVERSATION_ID]:g?.properties.correlationId},links:I},O),{consumeHook:U}=_.getConfig();U&&(0,n.safeExecuteInTheMiddle)(()=>U(L,{moduleVersion:d,msg:g}),H=>{H&&e.diag.error("amqplib instrumentation: consumerHook error",H)},!0),h?.noAck||(m[i.CHANNEL_SPANS_NOT_ENDED].push({msg:g,timeOfConsume:(0,t.hrTime)()}),g[i.MESSAGE_STORED_SPAN]=L);const q=O||e.ROOT_CONTEXT;e.context.with(e.trace.setSpan(q,L),()=>{T.call(this,g)}),h?.noAck&&(_.callConsumeEndHook(L,g,!1,s.EndOperation.AutoAck),L.end())};return arguments[1]=A,u.apply(this,arguments)}}getConfirmedPublishPatch(d,u){const _=this;return function(E,T,h,m,A){const g=this,{span:R,modifiedOptions:O}=_.createPublishSpan(_,E,T,g,m),{publishHook:C}=_.getConfig();C&&(0,n.safeExecuteInTheMiddle)(()=>C(R,{moduleVersion:d,exchange:E,routingKey:T,content:h,options:O,isConfirmChannel:!0}),q=>{q&&e.diag.error("amqplib instrumentation: publishHook error",q)},!0);const I=function(q,H){try{A?.call(this,q,H)}finally{const{publishConfirmHook:$}=_.getConfig();$&&(0,n.safeExecuteInTheMiddle)(()=>$(R,{moduleVersion:d,exchange:E,routingKey:T,content:h,options:m,isConfirmChannel:!0,confirmError:q}),B=>{B&&e.diag.error("amqplib instrumentation: publishConfirmHook error",B)},!0),q&&R.setStatus({code:e.SpanStatusCode.ERROR,message:"message confirmation has been nack'ed"}),R.end()}},L=(0,i.markConfirmChannelTracing)(e.context.active()),U=[...arguments];return U[3]=O,U[4]=e.context.bind((0,i.unmarkConfirmChannelTracing)(e.trace.setSpan(L,R)),I),e.context.with(L,u.bind(this,...U))}}getPublishPatch(d,u){const _=this;return function(E,T,h,m){if((0,i.isConfirmChannelTracing)(e.context.active()))return u.apply(this,arguments);{const A=this,{span:g,modifiedOptions:R}=_.createPublishSpan(_,E,T,A,m),{publishHook:O}=_.getConfig();O&&(0,n.safeExecuteInTheMiddle)(()=>O(g,{moduleVersion:d,exchange:E,routingKey:T,content:h,options:R,isConfirmChannel:!1}),L=>{L&&e.diag.error("amqplib instrumentation: publishHook error",L)},!0);const C=[...arguments];C[3]=R;const I=u.apply(this,C);return g.end(),I}}}createPublishSpan(d,u,_,p,E){const T=(0,i.normalizeExchange)(u),h=d.tracer.startSpan(`publish ${T}`,{kind:e.SpanKind.PRODUCER,attributes:{...p.connection[i.CONNECTION_ATTRIBUTES],[o.ATTR_MESSAGING_DESTINATION]:u,[o.ATTR_MESSAGING_DESTINATION_KIND]:o.MESSAGING_DESTINATION_KIND_VALUE_TOPIC,[o.ATTR_MESSAGING_RABBITMQ_ROUTING_KEY]:_,[o.OLD_ATTR_MESSAGING_MESSAGE_ID]:E?.messageId,[o.ATTR_MESSAGING_CONVERSATION_ID]:E?.correlationId}}),m=E??{};return m.headers=m.headers??{},e.propagation.inject(e.trace.setSpan(e.context.active(),h),m.headers),{span:h,modifiedOptions:m}}endConsumerSpan(d,u,_,p){const E=d[i.MESSAGE_STORED_SPAN];E&&(u!==!1&&E.setStatus({code:e.SpanStatusCode.ERROR,message:_!==s.EndOperation.ChannelClosed&&_!==s.EndOperation.ChannelError?`${_} called on message${p===!0?" with requeue":p===!1?" without requeue":""}`:_}),this.callConsumeEndHook(E,d,u,_),E.end(),d[i.MESSAGE_STORED_SPAN]=void 0)}endAllSpansOnChannel(d,u,_,p){(d[i.CHANNEL_SPANS_NOT_ENDED]??[]).forEach(T=>{this.endConsumerSpan(T.msg,u,_,p)}),d[i.CHANNEL_SPANS_NOT_ENDED]=[]}callConsumeEndHook(d,u,_,p){const{consumeEndHook:E}=this.getConfig();E&&(0,n.safeExecuteInTheMiddle)(()=>E(d,{msg:u,rejected:_,endOperation:p}),T=>{T&&e.diag.error("amqplib instrumentation: consumerEndHook error",T)},!0)}checkConsumeTimeoutOnChannel(d){const u=(0,t.hrTime)(),_=d[i.CHANNEL_SPANS_NOT_ENDED]??[];let p;const{consumeTimeoutMs:E}=this.getConfig();for(p=0;p<_.length;p++){const T=_[p],h=(0,t.hrTimeDuration)(T.timeOfConsume,u);if((0,t.hrTimeToMilliseconds)(h)<E)break;this.endConsumerSpan(T.msg,null,s.EndOperation.InstrumentationTimeout,!0)}_.splice(0,p)}}return Va.AmqplibInstrumentation=l,Va}var Uy;function p2(){return Uy||(Uy=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EndOperation=e.DEFAULT_CONFIG=e.AmqplibInstrumentation=void 0;var t=_2();Object.defineProperty(e,"AmqplibInstrumentation",{enumerable:!0,get:function(){return t.AmqplibInstrumentation}});var n=Lv();Object.defineProperty(e,"DEFAULT_CONFIG",{enumerable:!0,get:function(){return n.DEFAULT_CONFIG}}),Object.defineProperty(e,"EndOperation",{enumerable:!0,get:function(){return n.EndOperation}})})(mf)),mf}var E2=p2();const Dv="Amqplib",T2={consumeEndHook:e=>{Nt(e,"auto.amqplib.otel.consumer")},publishHook:e=>{Nt(e,"auto.amqplib.otel.publisher")}},h2=Ne(Dv,()=>new E2.AmqplibInstrumentation(T2)),S2=(()=>({name:Dv,setupOnce(){h2()}})),m2=S2,iT="VercelAI",ky=["generateText","streamText","generateObject","streamObject","embed","embedMany"];function A2(e){if(typeof e!="object"||e===null)return!1;const t=e;return"type"in t&&"error"in t&&"toolName"in t&&"toolCallId"in t&&t.type==="tool-error"&&t.error instanceof Error}function g2(e){if(typeof e!="object"||e===null||!("content"in e))return;const t=e;if(Array.isArray(t.content)){for(const n of t.content)if(A2(n)){const r=gx(n.toolCallId);if(r){const o=r.spanContext();to(s=>{s.setContext("trace",{trace_id:o.traceId,span_id:o.spanId}),s.setTag("vercel.ai.tool.name",n.toolName),s.setTag("vercel.ai.tool.callId",n.toolCallId),s.setLevel("error"),xe(n.error,{mechanism:{type:"auto.vercelai.otel",handled:!1}})}),Rx(n.toolCallId)}else to(o=>{o.setTag("vercel.ai.tool.name",n.toolName),o.setTag("vercel.ai.tool.callId",n.toolCallId),o.setLevel("error"),xe(n.error,{mechanism:{type:"auto.vercelai.otel",handled:!1}})})}}}function R2(e,t,n,r){const o=e?.recordInputs!==void 0?e.recordInputs:t.recordInputs!==void 0?t.recordInputs:n===!0?!0:r,s=e?.recordOutputs!==void 0?e.recordOutputs:t.recordOutputs!==void 0?t.recordOutputs:n===!0?!0:r;return{recordInputs:o,recordOutputs:s}}class wu extends yt{__init(){this._isPatched=!1}__init2(){this._callbacks=[]}constructor(t={}){super("@sentry/instrumentation-vercel-ai",Ze,t),wu.prototype.__init.call(this),wu.prototype.__init2.call(this)}init(){return new dt("ai",[">=3.0.0 <6"],this._patch.bind(this))}callWhenPatched(t){this._isPatched?t():this._callbacks.push(t)}_patch(t){this._isPatched=!0,this._callbacks.forEach(r=>r()),this._callbacks=[];const n=r=>new Proxy(r,{apply:(o,s,i)=>{const a=i[0].experimental_telemetry||{},c=a.isEnabled,l=Te(),f=l?.getIntegrationByName(iT),d=f?.options,u=f?!!l?.getOptions().sendDefaultPii:!1,{recordInputs:_,recordOutputs:p}=R2(d,a,c,u);return i[0].experimental_telemetry={...a,isEnabled:c!==void 0?c:!0,recordInputs:_,recordOutputs:p},ro(()=>Reflect.apply(o,s,i),E=>{E&&typeof E=="object"&&an(E,"_sentry_active_span",ll())},()=>{},E=>{g2(E)})}});if(Object.prototype.toString.call(t)==="[object Module]"){for(const r of ky)t[r]=n(t[r]);return t}else{const r=ky.reduce((o,s)=>(o[s]=n(t[s]),o),{});return{...t,...r}}}}const N2=Ne(iT,()=>new wu({}));function y2(e){return!!e.getIntegrationByName("Modules")?.getModules?.()?.ai}const O2=((e={})=>{let t;return{name:iT,options:e,setupOnce(){t=N2()},afterAllSetup(n){e.force??y2(n)?wg(n):t?.callWhenPatched(()=>wg(n))}}}),b2=O2,I2=[">=4.0.0 <7"];class C2 extends yt{constructor(t={}){super("@sentry/instrumentation-openai",Ze,t)}init(){return new dt("openai",I2,this._patch.bind(this))}_patch(t){let n=t;return n=this._patchClient(n,"OpenAI"),n=this._patchClient(n,"AzureOpenAI"),n}_patchClient(t,n){const r=t[n];if(!r)return t;const o=this.getConfig(),s=function(...i){if(PE(gl))return Reflect.construct(r,i);const a=Reflect.construct(r,i),l=!!Te()?.getOptions().sendDefaultPii,f=o.recordInputs??l,d=o.recordOutputs??l;return Qx(a,{recordInputs:f,recordOutputs:d})};Object.setPrototypeOf(s,r),Object.setPrototypeOf(s.prototype,r.prototype);for(const i of Object.getOwnPropertyNames(r))if(!["length","name","prototype"].includes(i)){const a=Object.getOwnPropertyDescriptor(r,i);a&&Object.defineProperty(s,i,a)}try{t[n]=s}catch{Object.defineProperty(t,n,{value:s,writable:!0,configurable:!0,enumerable:!0})}if(t.default===r)try{t.default=s}catch{Object.defineProperty(t,"default",{value:s,writable:!0,configurable:!0,enumerable:!0})}return t}}const M2=Ne(gl,e=>new C2(e)),P2=((e={})=>({name:gl,setupOnce(){M2(e)}})),v2=P2,L2=[">=0.19.2 <1.0.0"];class D2 extends yt{constructor(t={}){super("@sentry/instrumentation-anthropic-ai",Ze,t)}init(){return new dt("@anthropic-ai/sdk",L2,this._patch.bind(this))}_patch(t){const n=t.Anthropic,r=this.getConfig(),o=function(...s){if(PE(Nl))return Reflect.construct(n,s);const i=Reflect.construct(n,s),c=!!Te()?.getOptions().sendDefaultPii,l=r.recordInputs??c,f=r.recordOutputs??c;return h$(i,{recordInputs:l,recordOutputs:f})};Object.setPrototypeOf(o,n),Object.setPrototypeOf(o.prototype,n.prototype);for(const s of Object.getOwnPropertyNames(n))if(!["length","name","prototype"].includes(s)){const i=Object.getOwnPropertyDescriptor(n,s);i&&Object.defineProperty(o,s,i)}try{t.Anthropic=o}catch{Object.defineProperty(t,"Anthropic",{value:o,writable:!0,configurable:!0,enumerable:!0})}if(t.default===n)try{t.default=o}catch{Object.defineProperty(t,"default",{value:o,writable:!0,configurable:!0,enumerable:!0})}return t}}const w2=Ne(Nl,e=>new D2(e)),U2=((e={})=>({name:Nl,options:e,setupOnce(){w2(e)}})),k2=U2,Gy=[">=0.10.0 <2"];class G2 extends yt{constructor(t={}){super("@sentry/instrumentation-google-genai",Ze,t)}init(){return new dt("@google/genai",Gy,n=>this._patch(n),n=>n,[new Bn("@google/genai/dist/node/index.cjs",Gy,n=>this._patch(n),n=>n)])}_patch(t){const n=t.GoogleGenAI,r=this.getConfig();if(typeof n!="function")return t;const o=function(...s){if(PE(yl))return Reflect.construct(n,s);const i=Reflect.construct(n,s),c=!!Te()?.getOptions().sendDefaultPii,l=r,f=l?.recordInputs??c,d=l?.recordOutputs??c;return P$(i,{recordInputs:f,recordOutputs:d})};Object.setPrototypeOf(o,n),Object.setPrototypeOf(o.prototype,n.prototype);for(const s of Object.getOwnPropertyNames(n))if(!["length","name","prototype"].includes(s)){const i=Object.getOwnPropertyDescriptor(n,s);i&&Object.defineProperty(o,s,i)}return q$(t,"GoogleGenAI",o),t}}const V2=Ne(yl,e=>new G2(e)),x2=((e={})=>({name:yl,setupOnce(){V2(e)}})),$2=x2,Hc=[">=0.1.0 <2.0.0"];function B2(e,t){return e?Array.isArray(e)?e.includes(t)?e:[...e,t]:typeof e=="object"?[e,t]:e:[t]}function H2(e,t,n){return new Proxy(e,{apply(r,o,s){let a=s[1];(!a||typeof a!="object"||Array.isArray(a))&&(a={},s[1]=a);const c=a.callbacks,l=B2(c,t);return a.callbacks=l,Reflect.apply(r,o,s)}})}class F2 extends yt{constructor(t={}){super("@sentry/instrumentation-langchain",Ze,t)}init(){const t=[],n=["@langchain/anthropic","@langchain/openai","@langchain/google-genai","@langchain/mistralai","@langchain/google-vertexai","@langchain/groq"];for(const r of n)t.push(new dt(r,Hc,this._patch.bind(this),o=>o,[new Bn(`${r}/dist/index.cjs`,Hc,this._patch.bind(this),o=>o)]));return t.push(new dt("langchain",Hc,this._patch.bind(this),r=>r,[new Bn("langchain/dist/chat_models/universal.cjs",Hc,this._patch.bind(this),r=>r)])),t}_patch(t){GG([gl,Nl,yl]);const r=!!Te()?.getOptions().sendDefaultPii,o=this.getConfig(),s=o?.recordInputs??r,i=o?.recordOutputs??r,a=V$({recordInputs:s,recordOutputs:i});return this._patchRunnableMethods(t,a),t}_patchRunnableMethods(t,n){const r=["ChatAnthropic","ChatOpenAI","ChatGoogleGenerativeAI","ChatMistralAI","ChatVertexAI","ChatGroq","ConfigurableModel"],o=t.universal_exports??t,s=Object.values(o).find(c=>typeof c=="function"&&r.includes(c.name));if(!s)return;const i=s.prototype,a=["invoke","stream","batch"];for(const c of a){const l=i[c];typeof l=="function"&&(i[c]=H2(l,n))}}}const Y2=Ne($M,e=>new F2(e)),j2=((e={})=>({name:$M,setupOnce(){Y2(e)}})),q2=j2,Vy=[">=0.0.0 <2.0.0"];class W2 extends yt{constructor(t={}){super("@sentry/instrumentation-langgraph",Ze,t)}init(){return new dt("@langchain/langgraph",Vy,this._patch.bind(this),n=>n,[new Bn("@langchain/langgraph/dist/index.cjs",Vy,this._patch.bind(this),n=>n)])}_patch(t){const r=!!Te()?.getOptions().sendDefaultPii,o=this.getConfig(),s=o.recordInputs??r,i=o.recordOutputs??r,a={recordInputs:s,recordOutputs:i};if(t.StateGraph&&typeof t.StateGraph=="function"){const c=t.StateGraph;c.prototype.compile=Y$(c.prototype.compile,a)}return t}}const K2=Ne(HM,e=>new W2(e)),z2=((e={})=>({name:HM,setupOnce(){K2(e)}})),Z2=z2;function X2(e,t,n,r,o){let i=()=>{};const a=o.firestoreSpanCreationHook;typeof a=="function"&&(i=f=>{er(()=>a(f),d=>{d&&b.diag.error(d?.message)},!0)});const c=new dt("@firebase/firestore",t,f=>xy(f,n,r,e,i)),l=["@firebase/firestore/dist/lite/index.node.cjs.js","@firebase/firestore/dist/lite/index.node.mjs.js","@firebase/firestore/dist/lite/index.rn.esm2017.js","@firebase/firestore/dist/lite/index.cjs.js"];for(const f of l)c.files.push(new Bn(f,t,d=>xy(d,n,r,e,i),d=>wv(d,r)));return c}function xy(e,t,n,r,o){return wv(e,n),t(e,"addDoc",Q2(r,o)),t(e,"getDocs",ez(r,o)),t(e,"setDoc",tz(r,o)),t(e,"deleteDoc",J2(r,o)),e}function wv(e,t){for(const n of["addDoc","getDocs","setDoc","deleteDoc"])ol(e[n])&&t(e,n);return e}function Q2(e,t){return function(r){return function(o,s){const i=vl(e,"addDoc",o);return t(i),Pl(i,()=>r(o,s))}}}function J2(e,t){return function(r){return function(o){const s=vl(e,"deleteDoc",o.parent||o);return t(s),Pl(s,()=>r(o))}}}function ez(e,t){return function(r){return function(o){const s=vl(e,"getDocs",o);return t(s),Pl(s,()=>r(o))}}}function tz(e,t){return function(r){return function(o,s,i){const a=vl(e,"setDoc",o.parent||o);return t(a),Pl(a,()=>typeof i<"u"?r(o,s,i):r(o,s))}}}function Pl(e,t){return b.context.with(b.trace.setSpan(b.context.active(),e),()=>er(()=>t(),n=>{n&&e.recordException(n),e.end()},!0))}function vl(e,t,n){const r=e.startSpan(`${t} ${n.path}`,{kind:b.SpanKind.CLIENT});return rz(r,n),r.setAttribute(Q.ATTR_DB_OPERATION_NAME,t),r}function nz(e){let t,n;if(typeof e.host=="string")if(e.host.startsWith("[")){if(e.host.endsWith("]"))t=e.host.replace(/^\[|\]$/g,"");else if(e.host.includes("]:")){const r=e.host.lastIndexOf(":");r!==-1&&(t=e.host.slice(1,r).replace(/^\[|\]$/g,""),n=e.host.slice(r+1))}}else if(Ro.isIPv6(e.host))t=e.host;else{const r=e.host.lastIndexOf(":");r!==-1?(t=e.host.slice(0,r),n=e.host.slice(r+1)):t=e.host}return{address:t,port:n?parseInt(n,10):void 0}}function rz(e,t){const n=t.firestore.app,r=n.options,s=(t.firestore.toJSON()||{}).settings||{},i={[Q.ATTR_DB_COLLECTION_NAME]:t.path,[Q.ATTR_DB_NAMESPACE]:n.name,[Q.ATTR_DB_SYSTEM_NAME]:"firebase.firestore","firebase.firestore.type":t.type,"firebase.firestore.options.projectId":r.projectId,"firebase.firestore.options.appId":r.appId,"firebase.firestore.options.messagingSenderId":r.messagingSenderId,"firebase.firestore.options.storageBucket":r.storageBucket},{address:a,port:c}=nz(s);a&&(i[Q.ATTR_SERVER_ADDRESS]=a),c&&(i[Q.ATTR_SERVER_PORT]=c),e.setAttributes(i)}function oz(e,t,n,r,o){let s=()=>{},i=()=>{};const a=o.functions?.errorHook,c=o.functions?.requestHook,l=o.functions?.responseHook;typeof l=="function"&&(i=(u,_)=>{er(()=>l(u,_),p=>{p&&b.diag.error(p?.message)},!0)}),typeof c=="function"&&(s=u=>{er(()=>c(u),_=>{_&&b.diag.error(_?.message)},!0)});const f=new dt("firebase-functions",t);return[{name:"firebase-functions/lib/v2/providers/https.js",triggerType:"function"},{name:"firebase-functions/lib/v2/providers/firestore.js",triggerType:"firestore"},{name:"firebase-functions/lib/v2/providers/scheduler.js",triggerType:"scheduler"},{name:"firebase-functions/lib/v2/storage.js",triggerType:"storage"}].forEach(({name:u,triggerType:_})=>{f.files.push(new Bn(u,t,p=>sz(p,n,r,e,{requestHook:s,responseHook:i,errorHook:a},_),p=>Uv(p,r)))}),f}function St(e,t,n){return function(o){return function(...s){const i=typeof s[0]=="function"?s[0]:s[1],a=typeof s[0]=="function"?void 0:s[0];if(!i)return o.call(this,...s);const c=async function(...l){const f=process.env.FUNCTION_TARGET||process.env.K_SERVICE||"unknown",d=e.startSpan(`firebase.function.${n}`,{kind:b.SpanKind.SERVER}),u={"faas.name":f,"faas.trigger":n,"faas.provider":"firebase"};return process.env.GCLOUD_PROJECT&&(u["cloud.project_id"]=process.env.GCLOUD_PROJECT),process.env.EVENTARC_CLOUD_EVENT_SOURCE&&(u["cloud.event_source"]=process.env.EVENTARC_CLOUD_EVENT_SOURCE),d.setAttributes(u),t?.requestHook?.(d),b.context.with(b.trace.setSpan(b.context.active(),d),async()=>{let _,p;try{p=await i.apply(this,l)}catch(E){_=E}if(t?.responseHook?.(d,_),_&&d.recordException(_),d.end(),_)throw await t?.errorHook?.(d,_),_;return p})};return a?o.call(this,a,c):o.call(this,c)}}}function sz(e,t,n,r,o,s){switch(Uv(e,n),s){case"function":t(e,"onRequest",St(r,o,"http.request")),t(e,"onCall",St(r,o,"http.call"));break;case"firestore":t(e,"onDocumentCreated",St(r,o,"firestore.document.created")),t(e,"onDocumentUpdated",St(r,o,"firestore.document.updated")),t(e,"onDocumentDeleted",St(r,o,"firestore.document.deleted")),t(e,"onDocumentWritten",St(r,o,"firestore.document.written")),t(e,"onDocumentCreatedWithAuthContext",St(r,o,"firestore.document.created")),t(e,"onDocumentUpdatedWithAuthContext",St(r,o,"firestore.document.updated")),t(e,"onDocumentDeletedWithAuthContext",St(r,o,"firestore.document.deleted")),t(e,"onDocumentWrittenWithAuthContext",St(r,o,"firestore.document.written"));break;case"scheduler":t(e,"onSchedule",St(r,o,"scheduler.scheduled"));break;case"storage":t(e,"onObjectFinalized",St(r,o,"storage.object.finalized")),t(e,"onObjectArchived",St(r,o,"storage.object.archived")),t(e,"onObjectDeleted",St(r,o,"storage.object.deleted")),t(e,"onObjectMetadataUpdated",St(r,o,"storage.object.metadataUpdated"));break}return e}function Uv(e,t){const n=["onSchedule","onRequest","onCall","onObjectFinalized","onObjectArchived","onObjectDeleted","onObjectMetadataUpdated","onDocumentCreated","onDocumentUpdated","onDocumentDeleted","onDocumentWritten","onDocumentCreatedWithAuthContext","onDocumentUpdatedWithAuthContext","onDocumentDeletedWithAuthContext","onDocumentWrittenWithAuthContext"];for(const r of n)ol(e[r])&&t(e,r);return e}const $y={},iz=[">=3.0.0 <5"],az=[">=6.0.0 <7"];class cz extends yt{constructor(t=$y){super("@sentry/instrumentation-firebase",Ze,t)}setConfig(t={}){super.setConfig({...$y,...t})}init(){const t=[];return t.push(X2(this.tracer,iz,this._wrap,this._unwrap,this.getConfig())),t.push(oz(this.tracer,az,this._wrap,this._unwrap,this.getConfig())),t}}const kv="Firebase",uz={firestoreSpanCreationHook:e=>{Nt(e,"auto.firebase.otel.firestore"),e.setAttribute(Ee,"db.query")},functions:{requestHook:e=>{Nt(e,"auto.firebase.otel.functions"),e.setAttribute(Ee,"http.request")},errorHook:async(e,t)=>{t&&(xe(t,{mechanism:{type:"auto.firebase.otel.functions",handled:!1}}),await W1(2e3))}}},lz=Ne(kv,()=>new cz(uz)),dz=(()=>({name:kv,setupOnce(){lz()}})),fz=dz;function _z(){return[JY(),nq(),_q(),MK(),jq(),Jq(),cW(),TW(),$W(),zW(),_K(),RK(),VK(),WK(),r2(),l2(),yq(),m2(),vq(),q2(),Z2(),b2(),v2(),k2(),$2(),JW(),fz()]}const gf=1e6;function pz(e,t={}){e.getOptions().debug&&nY();const n=Ez(e,t);e.traceProvider=n}function Ez(e,t={}){const n=new IB({sampler:new EH(e),resource:ZM().merge(zM({[Q.ATTR_SERVICE_NAME]:"node",[Q.SEMRESATTRS_SERVICE_NAMESPACE]:"sentry",[Q.ATTR_SERVICE_VERSION]:Ze})),forceFlushTimeoutMillis:500,spanProcessors:[new pH({timeout:Tz(e.getOptions().maxSpanWaitDuration)}),...t.spanProcessors||[]]});return b.trace.setGlobalTracerProvider(n),b.propagation.setGlobalPropagator(new BB),b.context.setGlobalContextManager(new tY),n}function Tz(e){if(e!=null){if(e>gf)return so&&x.warn(`\`maxSpanWaitDuration\` is too high, using the maximum value of ${gf}`),gf;if(e<=0||Number.isNaN(e)){so&&x.warn("`maxSpanWaitDuration` must be a positive number, using default value instead.");return}return e}}function hz(){return GP().filter(t=>t.name!=="Http"&&t.name!=="NodeFetch").concat(vY(),$Y())}function Sz(e){return[...hz(),...Kt(e)?_z():[]]}function mz(e={}){return Az(e,Sz)}function Az(e={},t){vE(e,"node");const n=gY({...e,defaultIntegrations:e.defaultIntegrations??t(e)});return n&&!e.skipOpenTelemetrySetup&&(pz(n,{spanProcessors:e.openTelemetrySpanProcessors}),NY()),n}function W(e,t,n){function r(a,c){if(a._zod||Object.defineProperty(a,"_zod",{value:{def:c,constr:i,traits:new Set},enumerable:!1}),a._zod.traits.has(e))return;a._zod.traits.add(e),t(a,c);const l=i.prototype,f=Object.keys(l);for(let d=0;d<f.length;d++){const u=f[d];u in a||(a[u]=l[u].bind(a))}}const o=n?.Parent??Object;class s extends o{}Object.defineProperty(s,"name",{value:e});function i(a){var c;const l=n?.Parent?new s:this;r(l,a),(c=l._zod).deferred??(c.deferred=[]);for(const f of l._zod.deferred)f();return l}return Object.defineProperty(i,"init",{value:r}),Object.defineProperty(i,Symbol.hasInstance,{value:a=>n?.Parent&&a instanceof n.Parent?!0:a?._zod?.traits?.has(e)}),Object.defineProperty(i,"name",{value:e}),i}class wo extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class Gv extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const Vv={};function io(e){return Vv}function gz(e){const t=Object.values(e).filter(r=>typeof r=="number");return Object.entries(e).filter(([r,o])=>t.indexOf(+r)===-1).map(([r,o])=>o)}function wp(e,t){return typeof t=="bigint"?t.toString():t}function aT(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function cT(e){return e==null}function uT(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function Rz(e,t){const n=(e.toString().split(".")[1]||"").length,r=t.toString();let o=(r.split(".")[1]||"").length;if(o===0&&/\d?e-\d?/.test(r)){const c=r.match(/\d?e-(\d?)/);c?.[1]&&(o=Number.parseInt(c[1]))}const s=n>o?n:o,i=Number.parseInt(e.toFixed(s).replace(".","")),a=Number.parseInt(t.toFixed(s).replace(".",""));return i%a/10**s}const By=Symbol("evaluating");function ke(e,t,n){let r;Object.defineProperty(e,t,{get(){if(r!==By)return r===void 0&&(r=By,r=n()),r},set(o){Object.defineProperty(e,t,{value:o})},configurable:!0})}function po(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function Eo(...e){const t={};for(const n of e){const r=Object.getOwnPropertyDescriptors(n);Object.assign(t,r)}return Object.defineProperties({},t)}function Hy(e){return JSON.stringify(e)}function Nz(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const xv="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function Uu(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const yz=aT(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function lc(e){if(Uu(e)===!1)return!1;const t=e.constructor;if(t===void 0||typeof t!="function")return!0;const n=t.prototype;return!(Uu(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}function $v(e){return lc(e)?{...e}:Array.isArray(e)?[...e]:e}const Oz=new Set(["string","number","symbol"]);function Ll(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function sr(e,t,n){const r=new e._zod.constr(t??e._zod.def);return(!t||n?.parent)&&(r._zod.parent=e),r}function fe(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function bz(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const Iz={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Cz(e,t){const n=e._zod.def,r=Eo(e._zod.def,{get shape(){const o={};for(const s in t){if(!(s in n.shape))throw new Error(`Unrecognized key: "${s}"`);t[s]&&(o[s]=n.shape[s])}return po(this,"shape",o),o},checks:[]});return sr(e,r)}function Mz(e,t){const n=e._zod.def,r=Eo(e._zod.def,{get shape(){const o={...e._zod.def.shape};for(const s in t){if(!(s in n.shape))throw new Error(`Unrecognized key: "${s}"`);t[s]&&delete o[s]}return po(this,"shape",o),o},checks:[]});return sr(e,r)}function Pz(e,t){if(!lc(t))throw new Error("Invalid input to extend: expected a plain object");const n=e._zod.def.checks;if(n&&n.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const o=Eo(e._zod.def,{get shape(){const s={...e._zod.def.shape,...t};return po(this,"shape",s),s},checks:[]});return sr(e,o)}function vz(e,t){if(!lc(t))throw new Error("Invalid input to safeExtend: expected a plain object");const n={...e._zod.def,get shape(){const r={...e._zod.def.shape,...t};return po(this,"shape",r),r},checks:e._zod.def.checks};return sr(e,n)}function Lz(e,t){const n=Eo(e._zod.def,{get shape(){const r={...e._zod.def.shape,...t._zod.def.shape};return po(this,"shape",r),r},get catchall(){return t._zod.def.catchall},checks:[]});return sr(e,n)}function Dz(e,t,n){const r=Eo(t._zod.def,{get shape(){const o=t._zod.def.shape,s={...o};if(n)for(const i in n){if(!(i in o))throw new Error(`Unrecognized key: "${i}"`);n[i]&&(s[i]=e?new e({type:"optional",innerType:o[i]}):o[i])}else for(const i in o)s[i]=e?new e({type:"optional",innerType:o[i]}):o[i];return po(this,"shape",s),s},checks:[]});return sr(t,r)}function wz(e,t,n){const r=Eo(t._zod.def,{get shape(){const o=t._zod.def.shape,s={...o};if(n)for(const i in n){if(!(i in s))throw new Error(`Unrecognized key: "${i}"`);n[i]&&(s[i]=new e({type:"nonoptional",innerType:o[i]}))}else for(const i in o)s[i]=new e({type:"nonoptional",innerType:o[i]});return po(this,"shape",s),s},checks:[]});return sr(t,r)}function bo(e,t=0){if(e.aborted===!0)return!0;for(let n=t;n<e.issues.length;n++)if(e.issues[n]?.continue!==!0)return!0;return!1}function Bv(e,t){return t.map(n=>{var r;return(r=n).path??(r.path=[]),n.path.unshift(e),n})}function Fc(e){return typeof e=="string"?e:e?.message}function ao(e,t,n){const r={...e,path:e.path??[]};if(!e.message){const o=Fc(e.inst?._zod.def?.error?.(e))??Fc(t?.error?.(e))??Fc(n.customError?.(e))??Fc(n.localeError?.(e))??"Invalid input";r.message=o}return delete r.inst,delete r.continue,t?.reportInput||delete r.input,r}function lT(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function dc(...e){const[t,n,r]=e;return typeof t=="string"?{message:t,code:"custom",input:n,inst:r}:{...t}}const Hv=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,wp,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},Fv=W("$ZodError",Hv),Yv=W("$ZodError",Hv,{Parent:Error});function Uz(e,t=n=>n.message){const n={},r=[];for(const o of e.issues)o.path.length>0?(n[o.path[0]]=n[o.path[0]]||[],n[o.path[0]].push(t(o))):r.push(t(o));return{formErrors:r,fieldErrors:n}}function kz(e,t=n=>n.message){const n={_errors:[]},r=o=>{for(const s of o.issues)if(s.code==="invalid_union"&&s.errors.length)s.errors.map(i=>r({issues:i}));else if(s.code==="invalid_key")r({issues:s.issues});else if(s.code==="invalid_element")r({issues:s.issues});else if(s.path.length===0)n._errors.push(t(s));else{let i=n,a=0;for(;a<s.path.length;){const c=s.path[a];a===s.path.length-1?(i[c]=i[c]||{_errors:[]},i[c]._errors.push(t(s))):i[c]=i[c]||{_errors:[]},i=i[c],a++}}};return r(e),n}const dT=e=>(t,n,r,o)=>{const s=r?Object.assign(r,{async:!1}):{async:!1},i=t._zod.run({value:n,issues:[]},s);if(i instanceof Promise)throw new wo;if(i.issues.length){const a=new(o?.Err??e)(i.issues.map(c=>ao(c,s,io())));throw xv(a,o?.callee),a}return i.value},fT=e=>async(t,n,r,o)=>{const s=r?Object.assign(r,{async:!0}):{async:!0};let i=t._zod.run({value:n,issues:[]},s);if(i instanceof Promise&&(i=await i),i.issues.length){const a=new(o?.Err??e)(i.issues.map(c=>ao(c,s,io())));throw xv(a,o?.callee),a}return i.value},Dl=e=>(t,n,r)=>{const o=r?{...r,async:!1}:{async:!1},s=t._zod.run({value:n,issues:[]},o);if(s instanceof Promise)throw new wo;return s.issues.length?{success:!1,error:new(e??Fv)(s.issues.map(i=>ao(i,o,io())))}:{success:!0,data:s.value}},Gz=Dl(Yv),wl=e=>async(t,n,r)=>{const o=r?Object.assign(r,{async:!0}):{async:!0};let s=t._zod.run({value:n,issues:[]},o);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new e(s.issues.map(i=>ao(i,o,io())))}:{success:!0,data:s.value}},Vz=wl(Yv),xz=e=>(t,n,r)=>{const o=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return dT(e)(t,n,o)},$z=e=>(t,n,r)=>dT(e)(t,n,r),Bz=e=>async(t,n,r)=>{const o=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return fT(e)(t,n,o)},Hz=e=>async(t,n,r)=>fT(e)(t,n,r),Fz=e=>(t,n,r)=>{const o=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return Dl(e)(t,n,o)},Yz=e=>(t,n,r)=>Dl(e)(t,n,r),jz=e=>async(t,n,r)=>{const o=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return wl(e)(t,n,o)},qz=e=>async(t,n,r)=>wl(e)(t,n,r),Wz=/^[cC][^\s-]{8,}$/,Kz=/^[0-9a-z]+$/,zz=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,Zz=/^[0-9a-vA-V]{20}$/,Xz=/^[A-Za-z0-9]{27}$/,Qz=/^[a-zA-Z0-9_-]{21}$/,Jz=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,e3=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Fy=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,t3=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,n3="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function r3(){return new RegExp(n3,"u")}const o3=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,s3=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,i3=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,a3=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,c3=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,jv=/^[A-Za-z0-9_-]*$/,u3=/^\+(?:[0-9]){6,14}[0-9]$/,qv="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",l3=new RegExp(`^${qv}$`);function Wv(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function d3(e){return new RegExp(`^${Wv(e)}$`)}function f3(e){const t=Wv({precision:e.precision}),n=["Z"];e.local&&n.push(""),e.offset&&n.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const r=`${t}(?:${n.join("|")})`;return new RegExp(`^${qv}T(?:${r})$`)}const _3=e=>{const t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},p3=/^-?\d+$/,E3=/^-?\d+(?:\.\d+)?/,T3=/^[^A-Z]*$/,h3=/^[^a-z]*$/,Ct=W("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),Kv={number:"number",bigint:"bigint",object:"date"},zv=W("$ZodCheckLessThan",(e,t)=>{Ct.init(e,t);const n=Kv[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,s=(t.inclusive?o.maximum:o.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<s&&(t.inclusive?o.maximum=t.value:o.exclusiveMaximum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value<=t.value:r.value<t.value)||r.issues.push({origin:n,code:"too_big",maximum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Zv=W("$ZodCheckGreaterThan",(e,t)=>{Ct.init(e,t);const n=Kv[typeof t.value];e._zod.onattach.push(r=>{const o=r._zod.bag,s=(t.inclusive?o.minimum:o.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>s&&(t.inclusive?o.minimum=t.value:o.exclusiveMinimum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value>=t.value:r.value>t.value)||r.issues.push({origin:n,code:"too_small",minimum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),S3=W("$ZodCheckMultipleOf",(e,t)=>{Ct.init(e,t),e._zod.onattach.push(n=>{var r;(r=n._zod.bag).multipleOf??(r.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%t.value===BigInt(0):Rz(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),m3=W("$ZodCheckNumberFormat",(e,t)=>{Ct.init(e,t),t.format=t.format||"float64";const n=t.format?.includes("int"),r=n?"int":"number",[o,s]=Iz[t.format];e._zod.onattach.push(i=>{const a=i._zod.bag;a.format=t.format,a.minimum=o,a.maximum=s,n&&(a.pattern=p3)}),e._zod.check=i=>{const a=i.value;if(n){if(!Number.isInteger(a)){i.issues.push({expected:r,format:t.format,code:"invalid_type",continue:!1,input:a,inst:e});return}if(!Number.isSafeInteger(a)){a>0?i.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort}):i.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort});return}}a<o&&i.issues.push({origin:"number",input:a,code:"too_small",minimum:o,inclusive:!0,inst:e,continue:!t.abort}),a>s&&i.issues.push({origin:"number",input:a,code:"too_big",maximum:s,inst:e})}}),A3=W("$ZodCheckMaxLength",(e,t)=>{var n;Ct.init(e,t),(n=e._zod.def).when??(n.when=r=>{const o=r.value;return!cT(o)&&o.length!==void 0}),e._zod.onattach.push(r=>{const o=r._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<o&&(r._zod.bag.maximum=t.maximum)}),e._zod.check=r=>{const o=r.value;if(o.length<=t.maximum)return;const i=lT(o);r.issues.push({origin:i,code:"too_big",maximum:t.maximum,inclusive:!0,input:o,inst:e,continue:!t.abort})}}),g3=W("$ZodCheckMinLength",(e,t)=>{var n;Ct.init(e,t),(n=e._zod.def).when??(n.when=r=>{const o=r.value;return!cT(o)&&o.length!==void 0}),e._zod.onattach.push(r=>{const o=r._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>o&&(r._zod.bag.minimum=t.minimum)}),e._zod.check=r=>{const o=r.value;if(o.length>=t.minimum)return;const i=lT(o);r.issues.push({origin:i,code:"too_small",minimum:t.minimum,inclusive:!0,input:o,inst:e,continue:!t.abort})}}),R3=W("$ZodCheckLengthEquals",(e,t)=>{var n;Ct.init(e,t),(n=e._zod.def).when??(n.when=r=>{const o=r.value;return!cT(o)&&o.length!==void 0}),e._zod.onattach.push(r=>{const o=r._zod.bag;o.minimum=t.length,o.maximum=t.length,o.length=t.length}),e._zod.check=r=>{const o=r.value,s=o.length;if(s===t.length)return;const i=lT(o),a=s>t.length;r.issues.push({origin:i,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:r.value,inst:e,continue:!t.abort})}}),Ul=W("$ZodCheckStringFormat",(e,t)=>{var n,r;Ct.init(e,t),e._zod.onattach.push(o=>{const s=o._zod.bag;s.format=t.format,t.pattern&&(s.patterns??(s.patterns=new Set),s.patterns.add(t.pattern))}),t.pattern?(n=e._zod).check??(n.check=o=>{t.pattern.lastIndex=0,!t.pattern.test(o.value)&&o.issues.push({origin:"string",code:"invalid_format",format:t.format,input:o.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(r=e._zod).check??(r.check=()=>{})}),N3=W("$ZodCheckRegex",(e,t)=>{Ul.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),y3=W("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=T3),Ul.init(e,t)}),O3=W("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=h3),Ul.init(e,t)}),b3=W("$ZodCheckIncludes",(e,t)=>{Ct.init(e,t);const n=Ll(t.includes),r=new RegExp(typeof t.position=="number"?`^.{${t.position}}${n}`:n);t.pattern=r,e._zod.onattach.push(o=>{const s=o._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),e._zod.check=o=>{o.value.includes(t.includes,t.position)||o.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:o.value,inst:e,continue:!t.abort})}}),I3=W("$ZodCheckStartsWith",(e,t)=>{Ct.init(e,t);const n=new RegExp(`^${Ll(t.prefix)}.*`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),C3=W("$ZodCheckEndsWith",(e,t)=>{Ct.init(e,t);const n=new RegExp(`.*${Ll(t.suffix)}$`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const o=r._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}}),M3=W("$ZodCheckOverwrite",(e,t)=>{Ct.init(e,t),e._zod.check=n=>{n.value=t.tx(n.value)}});class P3{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const r=t.split(`
`).filter(i=>i),o=Math.min(...r.map(i=>i.length-i.trimStart().length)),s=r.map(i=>i.slice(o)).map(i=>" ".repeat(this.indent*2)+i);for(const i of s)this.content.push(i)}compile(){const t=Function,n=this?.args,o=[...(this?.content??[""]).map(s=>`  ${s}`)];return new t(...n,o.join(`
`))}}const v3={major:4,minor:1,patch:13},Xe=W("$ZodType",(e,t)=>{var n;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=v3;const r=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&r.unshift(e);for(const o of r)for(const s of o._zod.onattach)s(e);if(r.length===0)(n=e._zod).deferred??(n.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const o=(i,a,c)=>{let l=bo(i),f;for(const d of a){if(d._zod.def.when){if(!d._zod.def.when(i))continue}else if(l)continue;const u=i.issues.length,_=d._zod.check(i);if(_ instanceof Promise&&c?.async===!1)throw new wo;if(f||_ instanceof Promise)f=(f??Promise.resolve()).then(async()=>{await _,i.issues.length!==u&&(l||(l=bo(i,u)))});else{if(i.issues.length===u)continue;l||(l=bo(i,u))}}return f?f.then(()=>i):i},s=(i,a,c)=>{if(bo(i))return i.aborted=!0,i;const l=o(a,r,c);if(l instanceof Promise){if(c.async===!1)throw new wo;return l.then(f=>e._zod.parse(f,c))}return e._zod.parse(l,c)};e._zod.run=(i,a)=>{if(a.skipChecks)return e._zod.parse(i,a);if(a.direction==="backward"){const l=e._zod.parse({value:i.value,issues:[]},{...a,skipChecks:!0});return l instanceof Promise?l.then(f=>s(f,i,a)):s(l,i,a)}const c=e._zod.parse(i,a);if(c instanceof Promise){if(a.async===!1)throw new wo;return c.then(l=>o(l,r,a))}return o(c,r,a)}}e["~standard"]={validate:o=>{try{const s=Gz(e,o);return s.success?{value:s.data}:{issues:s.error?.issues}}catch{return Vz(e,o).then(i=>i.success?{value:i.data}:{issues:i.error?.issues})}},vendor:"zod",version:1}}),_T=W("$ZodString",(e,t)=>{Xe.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??_3(e._zod.bag),e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=String(n.value)}catch{}return typeof n.value=="string"||n.issues.push({expected:"string",code:"invalid_type",input:n.value,inst:e}),n}}),$e=W("$ZodStringFormat",(e,t)=>{Ul.init(e,t),_T.init(e,t)}),L3=W("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=e3),$e.init(e,t)}),D3=W("$ZodUUID",(e,t)=>{if(t.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(r===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=Fy(r))}else t.pattern??(t.pattern=Fy());$e.init(e,t)}),w3=W("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=t3),$e.init(e,t)}),U3=W("$ZodURL",(e,t)=>{$e.init(e,t),e._zod.check=n=>{try{const r=n.value.trim(),o=new URL(r);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(o.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:t.hostname.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(o.protocol.endsWith(":")?o.protocol.slice(0,-1):o.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort})),t.normalize?n.value=o.href:n.value=r;return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:e,continue:!t.abort})}}}),k3=W("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=r3()),$e.init(e,t)}),G3=W("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=Qz),$e.init(e,t)}),V3=W("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=Wz),$e.init(e,t)}),x3=W("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=Kz),$e.init(e,t)}),$3=W("$ZodULID",(e,t)=>{t.pattern??(t.pattern=zz),$e.init(e,t)}),B3=W("$ZodXID",(e,t)=>{t.pattern??(t.pattern=Zz),$e.init(e,t)}),H3=W("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=Xz),$e.init(e,t)}),F3=W("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=f3(t)),$e.init(e,t)}),Y3=W("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=l3),$e.init(e,t)}),j3=W("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=d3(t)),$e.init(e,t)}),q3=W("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=Jz),$e.init(e,t)}),W3=W("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=o3),$e.init(e,t),e._zod.bag.format="ipv4"}),K3=W("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=s3),$e.init(e,t),e._zod.bag.format="ipv6",e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:e,continue:!t.abort})}}}),z3=W("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=i3),$e.init(e,t)}),Z3=W("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=a3),$e.init(e,t),e._zod.check=n=>{const r=n.value.split("/");try{if(r.length!==2)throw new Error;const[o,s]=r;if(!s)throw new Error;const i=Number(s);if(`${i}`!==s)throw new Error;if(i<0||i>128)throw new Error;new URL(`http://[${o}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:e,continue:!t.abort})}}});function Xv(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const X3=W("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=c3),$e.init(e,t),e._zod.bag.contentEncoding="base64",e._zod.check=n=>{Xv(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:e,continue:!t.abort})}});function Q3(e){if(!jv.test(e))return!1;const t=e.replace(/[-_]/g,r=>r==="-"?"+":"/"),n=t.padEnd(Math.ceil(t.length/4)*4,"=");return Xv(n)}const J3=W("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=jv),$e.init(e,t),e._zod.bag.contentEncoding="base64url",e._zod.check=n=>{Q3(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:e,continue:!t.abort})}}),eZ=W("$ZodE164",(e,t)=>{t.pattern??(t.pattern=u3),$e.init(e,t)});function tZ(e,t=null){try{const n=e.split(".");if(n.length!==3)return!1;const[r]=n;if(!r)return!1;const o=JSON.parse(atob(r));return!("typ"in o&&o?.typ!=="JWT"||!o.alg||t&&(!("alg"in o)||o.alg!==t))}catch{return!1}}const nZ=W("$ZodJWT",(e,t)=>{$e.init(e,t),e._zod.check=n=>{tZ(n.value,t.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:e,continue:!t.abort})}}),Qv=W("$ZodNumber",(e,t)=>{Xe.init(e,t),e._zod.pattern=e._zod.bag.pattern??E3,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}const o=n.value;if(typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o))return n;const s=typeof o=="number"?Number.isNaN(o)?"NaN":Number.isFinite(o)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:o,inst:e,...s?{received:s}:{}}),n}}),rZ=W("$ZodNumberFormat",(e,t)=>{m3.init(e,t),Qv.init(e,t)}),oZ=W("$ZodUnknown",(e,t)=>{Xe.init(e,t),e._zod.parse=n=>n}),sZ=W("$ZodNever",(e,t)=>{Xe.init(e,t),e._zod.parse=(n,r)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:e}),n)});function Yy(e,t,n){e.issues.length&&t.issues.push(...Bv(n,e.issues)),t.value[n]=e.value}const iZ=W("$ZodArray",(e,t)=>{Xe.init(e,t),e._zod.parse=(n,r)=>{const o=n.value;if(!Array.isArray(o))return n.issues.push({expected:"array",code:"invalid_type",input:o,inst:e}),n;n.value=Array(o.length);const s=[];for(let i=0;i<o.length;i++){const a=o[i],c=t.element._zod.run({value:a,issues:[]},r);c instanceof Promise?s.push(c.then(l=>Yy(l,n,i))):Yy(c,n,i)}return s.length?Promise.all(s).then(()=>n):n}});function ku(e,t,n,r){e.issues.length&&t.issues.push(...Bv(n,e.issues)),e.value===void 0?n in r&&(t.value[n]=void 0):t.value[n]=e.value}function Jv(e){const t=Object.keys(e.shape);for(const r of t)if(!e.shape?.[r]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${r}": expected a Zod schema`);const n=bz(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(n)}}function eL(e,t,n,r,o,s){const i=[],a=o.keySet,c=o.catchall._zod,l=c.def.type;for(const f in t){if(a.has(f))continue;if(l==="never"){i.push(f);continue}const d=c.run({value:t[f],issues:[]},r);d instanceof Promise?e.push(d.then(u=>ku(u,n,f,t))):ku(d,n,f,t)}return i.length&&n.issues.push({code:"unrecognized_keys",keys:i,input:t,inst:s}),e.length?Promise.all(e).then(()=>n):n}const aZ=W("$ZodObject",(e,t)=>{if(Xe.init(e,t),!Object.getOwnPropertyDescriptor(t,"shape")?.get){const a=t.shape;Object.defineProperty(t,"shape",{get:()=>{const c={...a};return Object.defineProperty(t,"shape",{value:c}),c}})}const r=aT(()=>Jv(t));ke(e._zod,"propValues",()=>{const a=t.shape,c={};for(const l in a){const f=a[l]._zod;if(f.values){c[l]??(c[l]=new Set);for(const d of f.values)c[l].add(d)}}return c});const o=Uu,s=t.catchall;let i;e._zod.parse=(a,c)=>{i??(i=r.value);const l=a.value;if(!o(l))return a.issues.push({expected:"object",code:"invalid_type",input:l,inst:e}),a;a.value={};const f=[],d=i.shape;for(const u of i.keys){const p=d[u]._zod.run({value:l[u],issues:[]},c);p instanceof Promise?f.push(p.then(E=>ku(E,a,u,l))):ku(p,a,u,l)}return s?eL(f,l,a,c,r.value,e):f.length?Promise.all(f).then(()=>a):a}}),cZ=W("$ZodObjectJIT",(e,t)=>{aZ.init(e,t);const n=e._zod.parse,r=aT(()=>Jv(t)),o=u=>{const _=new P3(["shape","payload","ctx"]),p=r.value,E=A=>{const g=Hy(A);return`shape[${g}]._zod.run({ value: input[${g}], issues: [] }, ctx)`};_.write("const input = payload.value;");const T=Object.create(null);let h=0;for(const A of p.keys)T[A]=`key_${h++}`;_.write("const newResult = {};");for(const A of p.keys){const g=T[A],R=Hy(A);_.write(`const ${g} = ${E(A)};`),_.write(`
        if (${g}.issues.length) {
          payload.issues = payload.issues.concat(${g}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${R}, ...iss.path] : [${R}]
          })));
        }
        
        
        if (${g}.value === undefined) {
          if (${R} in input) {
            newResult[${R}] = undefined;
          }
        } else {
          newResult[${R}] = ${g}.value;
        }
        
      `)}_.write("payload.value = newResult;"),_.write("return payload;");const m=_.compile();return(A,g)=>m(u,A,g)};let s;const i=Uu,a=!Vv.jitless,l=a&&yz.value,f=t.catchall;let d;e._zod.parse=(u,_)=>{d??(d=r.value);const p=u.value;return i(p)?a&&l&&_?.async===!1&&_.jitless!==!0?(s||(s=o(t.shape)),u=s(u,_),f?eL([],p,u,_,d,e):u):n(u,_):(u.issues.push({expected:"object",code:"invalid_type",input:p,inst:e}),u)}});function jy(e,t,n,r){for(const s of e)if(s.issues.length===0)return t.value=s.value,t;const o=e.filter(s=>!bo(s));return o.length===1?(t.value=o[0].value,o[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(s=>s.issues.map(i=>ao(i,r,io())))}),t)}const uZ=W("$ZodUnion",(e,t)=>{Xe.init(e,t),ke(e._zod,"optin",()=>t.options.some(o=>o._zod.optin==="optional")?"optional":void 0),ke(e._zod,"optout",()=>t.options.some(o=>o._zod.optout==="optional")?"optional":void 0),ke(e._zod,"values",()=>{if(t.options.every(o=>o._zod.values))return new Set(t.options.flatMap(o=>Array.from(o._zod.values)))}),ke(e._zod,"pattern",()=>{if(t.options.every(o=>o._zod.pattern)){const o=t.options.map(s=>s._zod.pattern);return new RegExp(`^(${o.map(s=>uT(s.source)).join("|")})$`)}});const n=t.options.length===1,r=t.options[0]._zod.run;e._zod.parse=(o,s)=>{if(n)return r(o,s);let i=!1;const a=[];for(const c of t.options){const l=c._zod.run({value:o.value,issues:[]},s);if(l instanceof Promise)a.push(l),i=!0;else{if(l.issues.length===0)return l;a.push(l)}}return i?Promise.all(a).then(c=>jy(c,o,e,s)):jy(a,o,e,s)}}),lZ=W("$ZodIntersection",(e,t)=>{Xe.init(e,t),e._zod.parse=(n,r)=>{const o=n.value,s=t.left._zod.run({value:o,issues:[]},r),i=t.right._zod.run({value:o,issues:[]},r);return s instanceof Promise||i instanceof Promise?Promise.all([s,i]).then(([c,l])=>qy(n,c,l)):qy(n,s,i)}});function Up(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(lc(e)&&lc(t)){const n=Object.keys(t),r=Object.keys(e).filter(s=>n.indexOf(s)!==-1),o={...e,...t};for(const s of r){const i=Up(e[s],t[s]);if(!i.valid)return{valid:!1,mergeErrorPath:[s,...i.mergeErrorPath]};o[s]=i.data}return{valid:!0,data:o}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let r=0;r<e.length;r++){const o=e[r],s=t[r],i=Up(o,s);if(!i.valid)return{valid:!1,mergeErrorPath:[r,...i.mergeErrorPath]};n.push(i.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function qy(e,t,n){if(t.issues.length&&e.issues.push(...t.issues),n.issues.length&&e.issues.push(...n.issues),bo(e))return e;const r=Up(t.value,n.value);if(!r.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(r.mergeErrorPath)}`);return e.value=r.data,e}const dZ=W("$ZodEnum",(e,t)=>{Xe.init(e,t);const n=gz(t.entries),r=new Set(n);e._zod.values=r,e._zod.pattern=new RegExp(`^(${n.filter(o=>Oz.has(typeof o)).map(o=>typeof o=="string"?Ll(o):o.toString()).join("|")})$`),e._zod.parse=(o,s)=>{const i=o.value;return r.has(i)||o.issues.push({code:"invalid_value",values:n,input:i,inst:e}),o}}),fZ=W("$ZodTransform",(e,t)=>{Xe.init(e,t),e._zod.parse=(n,r)=>{if(r.direction==="backward")throw new Gv(e.constructor.name);const o=t.transform(n.value,n);if(r.async)return(o instanceof Promise?o:Promise.resolve(o)).then(i=>(n.value=i,n));if(o instanceof Promise)throw new wo;return n.value=o,n}});function Wy(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const _Z=W("$ZodOptional",(e,t)=>{Xe.init(e,t),e._zod.optin="optional",e._zod.optout="optional",ke(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),ke(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${uT(n.source)})?$`):void 0}),e._zod.parse=(n,r)=>{if(t.innerType._zod.optin==="optional"){const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>Wy(s,n.value)):Wy(o,n.value)}return n.value===void 0?n:t.innerType._zod.run(n,r)}}),pZ=W("$ZodNullable",(e,t)=>{Xe.init(e,t),ke(e._zod,"optin",()=>t.innerType._zod.optin),ke(e._zod,"optout",()=>t.innerType._zod.optout),ke(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${uT(n.source)}|null)$`):void 0}),ke(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(n,r)=>n.value===null?n:t.innerType._zod.run(n,r)}),EZ=W("$ZodDefault",(e,t)=>{Xe.init(e,t),e._zod.optin="optional",ke(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{if(r.direction==="backward")return t.innerType._zod.run(n,r);if(n.value===void 0)return n.value=t.defaultValue,n;const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>Ky(s,t)):Ky(o,t)}});function Ky(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const TZ=W("$ZodPrefault",(e,t)=>{Xe.init(e,t),e._zod.optin="optional",ke(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>(r.direction==="backward"||n.value===void 0&&(n.value=t.defaultValue),t.innerType._zod.run(n,r))}),hZ=W("$ZodNonOptional",(e,t)=>{Xe.init(e,t),ke(e._zod,"values",()=>{const n=t.innerType._zod.values;return n?new Set([...n].filter(r=>r!==void 0)):void 0}),e._zod.parse=(n,r)=>{const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>zy(s,e)):zy(o,e)}});function zy(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const SZ=W("$ZodCatch",(e,t)=>{Xe.init(e,t),ke(e._zod,"optin",()=>t.innerType._zod.optin),ke(e._zod,"optout",()=>t.innerType._zod.optout),ke(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{if(r.direction==="backward")return t.innerType._zod.run(n,r);const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(s=>(n.value=s.value,s.issues.length&&(n.value=t.catchValue({...n,error:{issues:s.issues.map(i=>ao(i,r,io()))},input:n.value}),n.issues=[]),n)):(n.value=o.value,o.issues.length&&(n.value=t.catchValue({...n,error:{issues:o.issues.map(s=>ao(s,r,io()))},input:n.value}),n.issues=[]),n)}}),mZ=W("$ZodPipe",(e,t)=>{Xe.init(e,t),ke(e._zod,"values",()=>t.in._zod.values),ke(e._zod,"optin",()=>t.in._zod.optin),ke(e._zod,"optout",()=>t.out._zod.optout),ke(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(n,r)=>{if(r.direction==="backward"){const s=t.out._zod.run(n,r);return s instanceof Promise?s.then(i=>Yc(i,t.in,r)):Yc(s,t.in,r)}const o=t.in._zod.run(n,r);return o instanceof Promise?o.then(s=>Yc(s,t.out,r)):Yc(o,t.out,r)}});function Yc(e,t,n){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},n)}const AZ=W("$ZodReadonly",(e,t)=>{Xe.init(e,t),ke(e._zod,"propValues",()=>t.innerType._zod.propValues),ke(e._zod,"values",()=>t.innerType._zod.values),ke(e._zod,"optin",()=>t.innerType?._zod?.optin),ke(e._zod,"optout",()=>t.innerType?._zod?.optout),e._zod.parse=(n,r)=>{if(r.direction==="backward")return t.innerType._zod.run(n,r);const o=t.innerType._zod.run(n,r);return o instanceof Promise?o.then(Zy):Zy(o)}});function Zy(e){return e.value=Object.freeze(e.value),e}const gZ=W("$ZodCustom",(e,t)=>{Ct.init(e,t),Xe.init(e,t),e._zod.parse=(n,r)=>n,e._zod.check=n=>{const r=n.value,o=t.fn(r);if(o instanceof Promise)return o.then(s=>Xy(s,n,r,e));Xy(o,n,r,e)}});function Xy(e,t,n,r){if(!e){const o={code:"custom",input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(o.params=r._zod.def.params),t.issues.push(dc(o))}}var Qy;class RZ{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...n){const r=n[0];if(this._map.set(t,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,t)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const n=this._map.get(t);return n&&typeof n=="object"&&"id"in n&&this._idmap.delete(n.id),this._map.delete(t),this}get(t){const n=t._zod.parent;if(n){const r={...this.get(n)??{}};delete r.id;const o={...r,...this._map.get(t)};return Object.keys(o).length?o:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function NZ(){return new RZ}(Qy=globalThis).__zod_globalRegistry??(Qy.__zod_globalRegistry=NZ());const jc=globalThis.__zod_globalRegistry;function yZ(e,t){return new e({type:"string",...fe(t)})}function OZ(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...fe(t)})}function Jy(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...fe(t)})}function bZ(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...fe(t)})}function IZ(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...fe(t)})}function CZ(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...fe(t)})}function MZ(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...fe(t)})}function PZ(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...fe(t)})}function vZ(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...fe(t)})}function LZ(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...fe(t)})}function DZ(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...fe(t)})}function wZ(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...fe(t)})}function UZ(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...fe(t)})}function kZ(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...fe(t)})}function GZ(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...fe(t)})}function VZ(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...fe(t)})}function xZ(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...fe(t)})}function $Z(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...fe(t)})}function BZ(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...fe(t)})}function HZ(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...fe(t)})}function FZ(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...fe(t)})}function YZ(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...fe(t)})}function jZ(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...fe(t)})}function qZ(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...fe(t)})}function WZ(e,t){return new e({type:"string",format:"date",check:"string_format",...fe(t)})}function KZ(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...fe(t)})}function zZ(e,t){return new e({type:"string",format:"duration",check:"string_format",...fe(t)})}function ZZ(e,t){return new e({type:"number",checks:[],...fe(t)})}function XZ(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...fe(t)})}function QZ(e){return new e({type:"unknown"})}function JZ(e,t){return new e({type:"never",...fe(t)})}function eO(e,t){return new zv({check:"less_than",...fe(t),value:e,inclusive:!1})}function Rf(e,t){return new zv({check:"less_than",...fe(t),value:e,inclusive:!0})}function tO(e,t){return new Zv({check:"greater_than",...fe(t),value:e,inclusive:!1})}function Nf(e,t){return new Zv({check:"greater_than",...fe(t),value:e,inclusive:!0})}function nO(e,t){return new S3({check:"multiple_of",...fe(t),value:e})}function tL(e,t){return new A3({check:"max_length",...fe(t),maximum:e})}function Gu(e,t){return new g3({check:"min_length",...fe(t),minimum:e})}function nL(e,t){return new R3({check:"length_equals",...fe(t),length:e})}function e4(e,t){return new N3({check:"string_format",format:"regex",...fe(t),pattern:e})}function t4(e){return new y3({check:"string_format",format:"lowercase",...fe(e)})}function n4(e){return new O3({check:"string_format",format:"uppercase",...fe(e)})}function r4(e,t){return new b3({check:"string_format",format:"includes",...fe(t),includes:e})}function o4(e,t){return new I3({check:"string_format",format:"starts_with",...fe(t),prefix:e})}function s4(e,t){return new C3({check:"string_format",format:"ends_with",...fe(t),suffix:e})}function rs(e){return new M3({check:"overwrite",tx:e})}function i4(e){return rs(t=>t.normalize(e))}function a4(){return rs(e=>e.trim())}function c4(){return rs(e=>e.toLowerCase())}function u4(){return rs(e=>e.toUpperCase())}function l4(){return rs(e=>Nz(e))}function d4(e,t,n){return new e({type:"array",element:t,...fe(n)})}function f4(e,t,n){return new e({type:"custom",check:"custom",fn:t,...fe(n)})}function _4(e){const t=p4(n=>(n.addIssue=r=>{if(typeof r=="string")n.issues.push(dc(r,n.value,t._zod.def));else{const o=r;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=n.value),o.inst??(o.inst=t),o.continue??(o.continue=!t._zod.def.abort),n.issues.push(dc(o))}},e(n.value,n)));return t}function p4(e,t){const n=new Ct({check:"custom",...fe(t)});return n._zod.check=e,n}const E4=W("ZodISODateTime",(e,t)=>{F3.init(e,t),Ye.init(e,t)});function T4(e){return qZ(E4,e)}const h4=W("ZodISODate",(e,t)=>{Y3.init(e,t),Ye.init(e,t)});function S4(e){return WZ(h4,e)}const m4=W("ZodISOTime",(e,t)=>{j3.init(e,t),Ye.init(e,t)});function A4(e){return KZ(m4,e)}const g4=W("ZodISODuration",(e,t)=>{q3.init(e,t),Ye.init(e,t)});function R4(e){return zZ(g4,e)}const N4=(e,t)=>{Fv.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:n=>kz(e,n)},flatten:{value:n=>Uz(e,n)},addIssue:{value:n=>{e.issues.push(n),e.message=JSON.stringify(e.issues,wp,2)}},addIssues:{value:n=>{e.issues.push(...n),e.message=JSON.stringify(e.issues,wp,2)}},isEmpty:{get(){return e.issues.length===0}}})},zt=W("ZodError",N4,{Parent:Error}),y4=dT(zt),O4=fT(zt),b4=Dl(zt),I4=wl(zt),C4=xz(zt),M4=$z(zt),P4=Bz(zt),v4=Hz(zt),L4=Fz(zt),D4=Yz(zt),w4=jz(zt),U4=qz(zt),tt=W("ZodType",(e,t)=>(Xe.init(e,t),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...n)=>e.clone(Eo(t,{checks:[...t.checks??[],...n.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]})),e.clone=(n,r)=>sr(e,n,r),e.brand=()=>e,e.register=((n,r)=>(n.add(e,r),e)),e.parse=(n,r)=>y4(e,n,r,{callee:e.parse}),e.safeParse=(n,r)=>b4(e,n,r),e.parseAsync=async(n,r)=>O4(e,n,r,{callee:e.parseAsync}),e.safeParseAsync=async(n,r)=>I4(e,n,r),e.spa=e.safeParseAsync,e.encode=(n,r)=>C4(e,n,r),e.decode=(n,r)=>M4(e,n,r),e.encodeAsync=async(n,r)=>P4(e,n,r),e.decodeAsync=async(n,r)=>v4(e,n,r),e.safeEncode=(n,r)=>L4(e,n,r),e.safeDecode=(n,r)=>D4(e,n,r),e.safeEncodeAsync=async(n,r)=>w4(e,n,r),e.safeDecodeAsync=async(n,r)=>U4(e,n,r),e.refine=(n,r)=>e.check(y9(n,r)),e.superRefine=n=>e.check(O9(n)),e.overwrite=n=>e.check(rs(n)),e.optional=()=>iO(e),e.nullable=()=>aO(e),e.nullish=()=>iO(aO(e)),e.nonoptional=n=>h9(e,n),e.array=()=>kl(e),e.or=n=>a9([e,n]),e.and=n=>u9(e,n),e.transform=n=>cO(e,d9(n)),e.default=n=>p9(e,n),e.prefault=n=>T9(e,n),e.catch=n=>m9(e,n),e.pipe=n=>cO(e,n),e.readonly=()=>R9(e),e.describe=n=>{const r=e.clone();return jc.add(r,{description:n}),r},Object.defineProperty(e,"description",{get(){return jc.get(e)?.description},configurable:!0}),e.meta=(...n)=>{if(n.length===0)return jc.get(e);const r=e.clone();return jc.add(r,n[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),rL=W("_ZodString",(e,t)=>{_T.init(e,t),tt.init(e,t);const n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...r)=>e.check(e4(...r)),e.includes=(...r)=>e.check(r4(...r)),e.startsWith=(...r)=>e.check(o4(...r)),e.endsWith=(...r)=>e.check(s4(...r)),e.min=(...r)=>e.check(Gu(...r)),e.max=(...r)=>e.check(tL(...r)),e.length=(...r)=>e.check(nL(...r)),e.nonempty=(...r)=>e.check(Gu(1,...r)),e.lowercase=r=>e.check(t4(r)),e.uppercase=r=>e.check(n4(r)),e.trim=()=>e.check(a4()),e.normalize=(...r)=>e.check(i4(...r)),e.toLowerCase=()=>e.check(c4()),e.toUpperCase=()=>e.check(u4()),e.slugify=()=>e.check(l4())}),k4=W("ZodString",(e,t)=>{_T.init(e,t),rL.init(e,t),e.email=n=>e.check(OZ(G4,n)),e.url=n=>e.check(PZ(V4,n)),e.jwt=n=>e.check(jZ(J4,n)),e.emoji=n=>e.check(vZ(x4,n)),e.guid=n=>e.check(Jy(rO,n)),e.uuid=n=>e.check(bZ(qc,n)),e.uuidv4=n=>e.check(IZ(qc,n)),e.uuidv6=n=>e.check(CZ(qc,n)),e.uuidv7=n=>e.check(MZ(qc,n)),e.nanoid=n=>e.check(LZ($4,n)),e.guid=n=>e.check(Jy(rO,n)),e.cuid=n=>e.check(DZ(B4,n)),e.cuid2=n=>e.check(wZ(H4,n)),e.ulid=n=>e.check(UZ(F4,n)),e.base64=n=>e.check(HZ(Z4,n)),e.base64url=n=>e.check(FZ(X4,n)),e.xid=n=>e.check(kZ(Y4,n)),e.ksuid=n=>e.check(GZ(j4,n)),e.ipv4=n=>e.check(VZ(q4,n)),e.ipv6=n=>e.check(xZ(W4,n)),e.cidrv4=n=>e.check($Z(K4,n)),e.cidrv6=n=>e.check(BZ(z4,n)),e.e164=n=>e.check(YZ(Q4,n)),e.datetime=n=>e.check(T4(n)),e.date=n=>e.check(S4(n)),e.time=n=>e.check(A4(n)),e.duration=n=>e.check(R4(n))});function lt(e){return yZ(k4,e)}const Ye=W("ZodStringFormat",(e,t)=>{$e.init(e,t),rL.init(e,t)}),G4=W("ZodEmail",(e,t)=>{w3.init(e,t),Ye.init(e,t)}),rO=W("ZodGUID",(e,t)=>{L3.init(e,t),Ye.init(e,t)}),qc=W("ZodUUID",(e,t)=>{D3.init(e,t),Ye.init(e,t)}),V4=W("ZodURL",(e,t)=>{U3.init(e,t),Ye.init(e,t)}),x4=W("ZodEmoji",(e,t)=>{k3.init(e,t),Ye.init(e,t)}),$4=W("ZodNanoID",(e,t)=>{G3.init(e,t),Ye.init(e,t)}),B4=W("ZodCUID",(e,t)=>{V3.init(e,t),Ye.init(e,t)}),H4=W("ZodCUID2",(e,t)=>{x3.init(e,t),Ye.init(e,t)}),F4=W("ZodULID",(e,t)=>{$3.init(e,t),Ye.init(e,t)}),Y4=W("ZodXID",(e,t)=>{B3.init(e,t),Ye.init(e,t)}),j4=W("ZodKSUID",(e,t)=>{H3.init(e,t),Ye.init(e,t)}),q4=W("ZodIPv4",(e,t)=>{W3.init(e,t),Ye.init(e,t)}),W4=W("ZodIPv6",(e,t)=>{K3.init(e,t),Ye.init(e,t)}),K4=W("ZodCIDRv4",(e,t)=>{z3.init(e,t),Ye.init(e,t)}),z4=W("ZodCIDRv6",(e,t)=>{Z3.init(e,t),Ye.init(e,t)}),Z4=W("ZodBase64",(e,t)=>{X3.init(e,t),Ye.init(e,t)}),X4=W("ZodBase64URL",(e,t)=>{J3.init(e,t),Ye.init(e,t)}),Q4=W("ZodE164",(e,t)=>{eZ.init(e,t),Ye.init(e,t)}),J4=W("ZodJWT",(e,t)=>{nZ.init(e,t),Ye.init(e,t)}),oL=W("ZodNumber",(e,t)=>{Qv.init(e,t),tt.init(e,t),e.gt=(r,o)=>e.check(tO(r,o)),e.gte=(r,o)=>e.check(Nf(r,o)),e.min=(r,o)=>e.check(Nf(r,o)),e.lt=(r,o)=>e.check(eO(r,o)),e.lte=(r,o)=>e.check(Rf(r,o)),e.max=(r,o)=>e.check(Rf(r,o)),e.int=r=>e.check(oO(r)),e.safe=r=>e.check(oO(r)),e.positive=r=>e.check(tO(0,r)),e.nonnegative=r=>e.check(Nf(0,r)),e.negative=r=>e.check(eO(0,r)),e.nonpositive=r=>e.check(Rf(0,r)),e.multipleOf=(r,o)=>e.check(nO(r,o)),e.step=(r,o)=>e.check(nO(r,o)),e.finite=()=>e;const n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function Xa(e){return ZZ(oL,e)}const e9=W("ZodNumberFormat",(e,t)=>{rZ.init(e,t),oL.init(e,t)});function oO(e){return XZ(e9,e)}const t9=W("ZodUnknown",(e,t)=>{oZ.init(e,t),tt.init(e,t)});function sO(){return QZ(t9)}const n9=W("ZodNever",(e,t)=>{sZ.init(e,t),tt.init(e,t)});function r9(e){return JZ(n9,e)}const o9=W("ZodArray",(e,t)=>{iZ.init(e,t),tt.init(e,t),e.element=t.element,e.min=(n,r)=>e.check(Gu(n,r)),e.nonempty=n=>e.check(Gu(1,n)),e.max=(n,r)=>e.check(tL(n,r)),e.length=(n,r)=>e.check(nL(n,r)),e.unwrap=()=>e.element});function kl(e,t){return d4(o9,e,t)}const s9=W("ZodObject",(e,t)=>{cZ.init(e,t),tt.init(e,t),ke(e,"shape",()=>t.shape),e.keyof=()=>Vu(Object.keys(e._zod.def.shape)),e.catchall=n=>e.clone({...e._zod.def,catchall:n}),e.passthrough=()=>e.clone({...e._zod.def,catchall:sO()}),e.loose=()=>e.clone({...e._zod.def,catchall:sO()}),e.strict=()=>e.clone({...e._zod.def,catchall:r9()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=n=>Pz(e,n),e.safeExtend=n=>vz(e,n),e.merge=n=>Lz(e,n),e.pick=n=>Cz(e,n),e.omit=n=>Mz(e,n),e.partial=(...n)=>Dz(sL,e,n[0]),e.required=(...n)=>wz(iL,e,n[0])});function ir(e,t){const n={type:"object",shape:e??{},...fe(t)};return new s9(n)}const i9=W("ZodUnion",(e,t)=>{uZ.init(e,t),tt.init(e,t),e.options=t.options});function a9(e,t){return new i9({type:"union",options:e,...fe(t)})}const c9=W("ZodIntersection",(e,t)=>{lZ.init(e,t),tt.init(e,t)});function u9(e,t){return new c9({type:"intersection",left:e,right:t})}const kp=W("ZodEnum",(e,t)=>{dZ.init(e,t),tt.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const n=new Set(Object.keys(t.entries));e.extract=(r,o)=>{const s={};for(const i of r)if(n.has(i))s[i]=t.entries[i];else throw new Error(`Key ${i} not found in enum`);return new kp({...t,checks:[],...fe(o),entries:s})},e.exclude=(r,o)=>{const s={...t.entries};for(const i of r)if(n.has(i))delete s[i];else throw new Error(`Key ${i} not found in enum`);return new kp({...t,checks:[],...fe(o),entries:s})}});function Vu(e,t){const n=Array.isArray(e)?Object.fromEntries(e.map(r=>[r,r])):e;return new kp({type:"enum",entries:n,...fe(t)})}const l9=W("ZodTransform",(e,t)=>{fZ.init(e,t),tt.init(e,t),e._zod.parse=(n,r)=>{if(r.direction==="backward")throw new Gv(e.constructor.name);n.addIssue=s=>{if(typeof s=="string")n.issues.push(dc(s,n.value,t));else{const i=s;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=n.value),i.inst??(i.inst=e),n.issues.push(dc(i))}};const o=t.transform(n.value,n);return o instanceof Promise?o.then(s=>(n.value=s,n)):(n.value=o,n)}});function d9(e){return new l9({type:"transform",transform:e})}const sL=W("ZodOptional",(e,t)=>{_Z.init(e,t),tt.init(e,t),e.unwrap=()=>e._zod.def.innerType});function iO(e){return new sL({type:"optional",innerType:e})}const f9=W("ZodNullable",(e,t)=>{pZ.init(e,t),tt.init(e,t),e.unwrap=()=>e._zod.def.innerType});function aO(e){return new f9({type:"nullable",innerType:e})}const _9=W("ZodDefault",(e,t)=>{EZ.init(e,t),tt.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function p9(e,t){return new _9({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():$v(t)}})}const E9=W("ZodPrefault",(e,t)=>{TZ.init(e,t),tt.init(e,t),e.unwrap=()=>e._zod.def.innerType});function T9(e,t){return new E9({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():$v(t)}})}const iL=W("ZodNonOptional",(e,t)=>{hZ.init(e,t),tt.init(e,t),e.unwrap=()=>e._zod.def.innerType});function h9(e,t){return new iL({type:"nonoptional",innerType:e,...fe(t)})}const S9=W("ZodCatch",(e,t)=>{SZ.init(e,t),tt.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function m9(e,t){return new S9({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const A9=W("ZodPipe",(e,t)=>{mZ.init(e,t),tt.init(e,t),e.in=t.in,e.out=t.out});function cO(e,t){return new A9({type:"pipe",in:e,out:t})}const g9=W("ZodReadonly",(e,t)=>{AZ.init(e,t),tt.init(e,t),e.unwrap=()=>e._zod.def.innerType});function R9(e){return new g9({type:"readonly",innerType:e})}const N9=W("ZodCustom",(e,t)=>{gZ.init(e,t),tt.init(e,t)});function y9(e,t={}){return f4(N9,e,t)}function O9(e){return _4(e)}const b9=Vu(["ACTIVE","PAUSED","DELETED"]);ir({version:Xa().optional(),id:lt(),name:lt(),prompt:lt(),status:b9,rrule:lt().optional(),cwds:kl(lt()),created_at:Xa(),updated_at:Xa()});const I9={Dev:"dev",InternalAlpha:"internal-alpha",PublicBeta:"public-beta",Prod:"prod"},C9=Object.values(I9);C9.join(", ");function Ue(e){return e==null?!1:e.kind==="ssh"||e.kind==="brix"}const M9="codex.localEnvironmentConfigPath",P9="__none__",v9=["tool","run","debug","test"],L9=["darwin","linux","win32"],D9=ir({name:lt(),icon:Vu(v9).nullable().catch(null),command:lt(),platform:Vu(L9).optional()}),yf=ir({script:lt()}),w9=ir({script:lt(),darwin:yf.optional(),linux:yf.optional(),win32:yf.optional()}),U9=ir({version:Xa().int().min(1).default(1),name:lt(),setup:w9,actions:kl(D9).optional()});function Oe(e){return{type:"ok",value:e}}function xa(e){return{type:"error",error:{message:e instanceof Error?e.message:String(e)}}}const k9="https://17de4aef18bcd467f0a250b004f16737@o33249.ingest.us.sentry.io/4510507758977024",G9="codex-desktop@";function V9(e){return`${G9}${e}`}function x9(e){switch(e){case"dev":case"internal-alpha":case"public-beta":return!0;case"prod":return!1}}function $9(e){return x9(e)?1:0}var Of,uO;function B9(){return uO||(uO=1,Of=function(){}),Of}var bf,lO;function To(){if(lO)return bf;lO=1;var e=B9()();return bf=function(t){return t!==e&&t!==null},bf}var If,dO;function aL(){if(dO)return If;dO=1;var e=To(),t=Array.prototype.forEach,n=Object.create,r=function(o,s){var i;for(i in o)s[i]=o[i]};return If=function(o){var s=n(null);return t.call(arguments,function(i){e(i)&&r(Object(i),s)}),s},If}var Cf,fO;function H9(){return fO||(fO=1,Cf=function(){var e=Math.sign;return typeof e!="function"?!1:e(10)===1&&e(-20)===-1}),Cf}var Mf,_O;function F9(){return _O||(_O=1,Mf=function(e){return e=Number(e),isNaN(e)||e===0?e:e>0?1:-1}),Mf}var Pf,pO;function Y9(){return pO||(pO=1,Pf=H9()()?Math.sign:F9()),Pf}var vf,EO;function j9(){if(EO)return vf;EO=1;var e=Y9(),t=Math.abs,n=Math.floor;return vf=function(r){return isNaN(r)?0:(r=Number(r),r===0||!isFinite(r)?r:e(r)*n(t(r)))},vf}var Lf,TO;function ho(){if(TO)return Lf;TO=1;var e=j9(),t=Math.max;return Lf=function(n){return t(0,e(n))},Lf}var Df,hO;function cL(){if(hO)return Df;hO=1;var e=ho();return Df=function(t,n,r){var o;return isNaN(t)?(o=n,o>=0?r&&o?o-1:o:1):t===!1?!1:e(t)},Df}var wf,SO;function ar(){return SO||(SO=1,wf=function(e){if(typeof e!="function")throw new TypeError(e+" is not a function");return e}),wf}var Uf,mO;function os(){if(mO)return Uf;mO=1;var e=To();return Uf=function(t){if(!e(t))throw new TypeError("Cannot use null or undefined");return t},Uf}var kf,AO;function q9(){if(AO)return kf;AO=1;var e=ar(),t=os(),n=Function.prototype.bind,r=Function.prototype.call,o=Object.keys,s=Object.prototype.propertyIsEnumerable;return kf=function(i,a){return function(c,l){var f,d=arguments[2],u=arguments[3];return c=Object(t(c)),e(l),f=o(c),u&&f.sort(typeof u=="function"?n.call(u,c):void 0),typeof i!="function"&&(i=f[i]),r.call(i,f,function(_,p){return s.call(c,_)?r.call(l,d,c[_],_,c,p):a})}},kf}var Gf,gO;function Gl(){return gO||(gO=1,Gf=q9()("forEach")),Gf}var RO={},NO;function So(){return NO||(NO=1),RO}var Vf={exports:{}},xf,yO;function W9(){return yO||(yO=1,xf=function(){var e=Object.assign,t;return typeof e!="function"?!1:(t={foo:"raz"},e(t,{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}),xf}var $f,OO;function K9(){return OO||(OO=1,$f=function(){try{return Object.keys("primitive"),!0}catch{return!1}}),$f}var Bf,bO;function z9(){if(bO)return Bf;bO=1;var e=To(),t=Object.keys;return Bf=function(n){return t(e(n)?Object(n):n)},Bf}var Hf,IO;function Z9(){return IO||(IO=1,Hf=K9()()?Object.keys:z9()),Hf}var Ff,CO;function X9(){if(CO)return Ff;CO=1;var e=Z9(),t=os(),n=Math.max;return Ff=function(r,o){var s,i,a=n(arguments.length,2),c;for(r=Object(t(r)),c=function(l){try{r[l]=o[l]}catch(f){s||(s=f)}},i=1;i<a;++i)o=arguments[i],e(o).forEach(c);if(s!==void 0)throw s;return r},Ff}var Yf,MO;function uL(){return MO||(MO=1,Yf=W9()()?Object.assign:X9()),Yf}var jf,PO;function Q9(){if(PO)return jf;PO=1;var e=To(),t={function:!0,object:!0};return jf=function(n){return e(n)&&t[typeof n]||!1},jf}var vO;function J9(){return vO||(vO=1,(function(e){var t=uL(),n=Q9(),r=To(),o=Error.captureStackTrace;e.exports=function(s){var i=new Error(s),a=arguments[1],c=arguments[2];return r(c)||n(a)&&(c=a,a=null),r(c)&&t(i,c),r(a)&&(i.code=a),o&&o(i,e.exports),i}})(Vf)),Vf.exports}var Wc={exports:{}},qf,LO;function lL(){if(LO)return qf;LO=1;var e=os(),t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,o=Object.getOwnPropertySymbols;return qf=function(s,i){var a,c=Object(e(i));if(s=Object(e(s)),r(c).forEach(function(l){try{t(s,l,n(i,l))}catch(f){a=f}}),typeof o=="function"&&o(c).forEach(function(l){try{t(s,l,n(i,l))}catch(f){a=f}}),a!==void 0)throw a;return s},qf}var DO;function dL(){if(DO)return Wc.exports;DO=1;var e=ho(),t=function(i,a){return a},n,r,o,s;try{Object.defineProperty(t,"length",{configurable:!0,writable:!1,enumerable:!1,value:1})}catch{}return t.length===1?(n={configurable:!0,writable:!1,enumerable:!1},r=Object.defineProperty,Wc.exports=function(i,a){return a=e(a),i.length===a?i:(n.value=a,r(i,"length",n))}):(s=lL(),o=(function(){var i=[];return function(a){var c,l=0;if(i[a])return i[a];for(c=[];a--;)c.push("a"+(++l).toString(36));return new Function("fn","return function ("+c.join(", ")+") { return fn.apply(this, arguments); };")}})(),Wc.exports=function(i,a){var c;if(a=e(a),i.length===a)return i;c=o(a)(i);try{s(c,i)}catch{}return c}),Wc.exports}var Wf={exports:{}},Kf,wO;function fL(){if(wO)return Kf;wO=1;var e=void 0;return Kf=function(t){return t!==e&&t!==null},Kf}var zf,UO;function eX(){if(UO)return zf;UO=1;var e=fL(),t={object:!0,function:!0,undefined:!0};return zf=function(n){return e(n)?hasOwnProperty.call(t,typeof n):!1},zf}var Zf,kO;function tX(){if(kO)return Zf;kO=1;var e=eX();return Zf=function(t){if(!e(t))return!1;try{return t.constructor?t.constructor.prototype===t:!1}catch{return!1}},Zf}var Xf,GO;function nX(){if(GO)return Xf;GO=1;var e=tX();return Xf=function(t){if(typeof t!="function"||!hasOwnProperty.call(t,"length"))return!1;try{if(typeof t.length!="number"||typeof t.call!="function"||typeof t.apply!="function")return!1}catch{return!1}return!e(t)},Xf}var Qf,VO;function rX(){if(VO)return Qf;VO=1;var e=nX(),t=/^\s*class[\s{/}]/,n=Function.prototype.toString;return Qf=function(r){return!(!e(r)||t.test(n.call(r)))},Qf}var Jf,xO;function oX(){if(xO)return Jf;xO=1;var e="razdwatrzy";return Jf=function(){return typeof e.contains!="function"?!1:e.contains("dwa")===!0&&e.contains("foo")===!1},Jf}var e_,$O;function sX(){if($O)return e_;$O=1;var e=String.prototype.indexOf;return e_=function(t){return e.call(this,t,arguments[1])>-1},e_}var t_,BO;function iX(){return BO||(BO=1,t_=oX()()?String.prototype.contains:sX()),t_}var HO;function mo(){if(HO)return Wf.exports;HO=1;var e=fL(),t=rX(),n=uL(),r=aL(),o=iX(),s=Wf.exports=function(i,a){var c,l,f,d,u;return arguments.length<2||typeof i!="string"?(d=a,a=i,i=null):d=arguments[2],e(i)?(c=o.call(i,"c"),l=o.call(i,"e"),f=o.call(i,"w")):(c=f=!0,l=!1),u={value:a,configurable:c,enumerable:l,writable:f},d?n(r(d),u):u};return s.gs=function(i,a,c){var l,f,d,u;return typeof i!="string"?(d=c,c=a,a=i,i=null):d=arguments[3],e(a)?t(a)?e(c)?t(c)||(d=c,c=void 0):c=void 0:(d=a,a=c=void 0):a=void 0,e(i)?(l=o.call(i,"c"),f=o.call(i,"e")):(l=!0,f=!1),u={get:a,set:c,configurable:l,enumerable:f},d?n(r(d),u):u},Wf.exports}var Kc={exports:{}},FO;function aX(){return FO||(FO=1,(function(e,t){var n=mo(),r=ar(),o=Function.prototype.apply,s=Function.prototype.call,i=Object.create,a=Object.defineProperty,c=Object.defineProperties,l=Object.prototype.hasOwnProperty,f={configurable:!0,enumerable:!1,writable:!0},d,u,_,p,E,T,h;d=function(m,A){var g;return r(A),l.call(this,"__ee__")?g=this.__ee__:(g=f.value=i(null),a(this,"__ee__",f),f.value=null),g[m]?typeof g[m]=="object"?g[m].push(A):g[m]=[g[m],A]:g[m]=A,this},u=function(m,A){var g,R;return r(A),R=this,d.call(this,m,g=function(){_.call(R,m,g),o.call(A,this,arguments)}),g.__eeOnceListener__=A,this},_=function(m,A){var g,R,O,C;if(r(A),!l.call(this,"__ee__"))return this;if(g=this.__ee__,!g[m])return this;if(R=g[m],typeof R=="object")for(C=0;O=R[C];++C)(O===A||O.__eeOnceListener__===A)&&(R.length===2?g[m]=R[C?0:1]:R.splice(C,1));else(R===A||R.__eeOnceListener__===A)&&delete g[m];return this},p=function(m){var A,g,R,O,C;if(l.call(this,"__ee__")&&(O=this.__ee__[m],!!O))if(typeof O=="object"){for(g=arguments.length,C=new Array(g-1),A=1;A<g;++A)C[A-1]=arguments[A];for(O=O.slice(),A=0;R=O[A];++A)o.call(R,this,C)}else switch(arguments.length){case 1:s.call(O,this);break;case 2:s.call(O,this,arguments[1]);break;case 3:s.call(O,this,arguments[1],arguments[2]);break;default:for(g=arguments.length,C=new Array(g-1),A=1;A<g;++A)C[A-1]=arguments[A];o.call(O,this,C)}},E={on:d,once:u,off:_,emit:p},T={on:n(d),once:n(u),off:n(_),emit:n(p)},h=c({},T),e.exports=t=function(m){return m==null?i(h):c(Object(m),T)},t.methods=E})(Kc,Kc.exports)),Kc.exports}var n_,YO;function cX(){return YO||(YO=1,n_=function(){var e=Array.from,t,n;return typeof e!="function"?!1:(t=["raz","dwa"],n=e(t),!!(n&&n!==t&&n[1]==="dwa"))}),n_}var r_,jO;function uX(){return jO||(jO=1,r_=function(){return typeof globalThis!="object"||!globalThis?!1:globalThis.Array===Array}),r_}var o_,qO;function lX(){if(qO)return o_;qO=1;var e=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};return o_=(function(){if(this)return this;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return e()}try{return __global__||e()}finally{delete Object.prototype.__global__}})(),o_}var s_,WO;function Vl(){return WO||(WO=1,s_=uX()()?globalThis:lX()),s_}var i_,KO;function dX(){if(KO)return i_;KO=1;var e=Vl(),t={object:!0,symbol:!0};return i_=function(){var n=e.Symbol,r;if(typeof n!="function")return!1;r=n("test symbol");try{String(r)}catch{return!1}return!(!t[typeof n.iterator]||!t[typeof n.toPrimitive]||!t[typeof n.toStringTag])},i_}var a_,zO;function fX(){return zO||(zO=1,a_=function(e){return e?typeof e=="symbol"?!0:!e.constructor||e.constructor.name!=="Symbol"?!1:e[e.constructor.toStringTag]==="Symbol":!1}),a_}var c_,ZO;function _L(){if(ZO)return c_;ZO=1;var e=fX();return c_=function(t){if(!e(t))throw new TypeError(t+" is not a symbol");return t},c_}var u_,XO;function _X(){if(XO)return u_;XO=1;var e=mo(),t=Object.create,n=Object.defineProperty,r=Object.prototype,o=t(null);return u_=function(s){for(var i=0,a,c;o[s+(i||"")];)++i;return s+=i||"",o[s]=!0,a="@@"+s,n(r,a,e.gs(null,function(l){c||(c=!0,n(this,a,e(l)),c=!1)})),a},u_}var l_,QO;function pX(){if(QO)return l_;QO=1;var e=mo(),t=Vl().Symbol;return l_=function(n){return Object.defineProperties(n,{hasInstance:e("",t&&t.hasInstance||n("hasInstance")),isConcatSpreadable:e("",t&&t.isConcatSpreadable||n("isConcatSpreadable")),iterator:e("",t&&t.iterator||n("iterator")),match:e("",t&&t.match||n("match")),replace:e("",t&&t.replace||n("replace")),search:e("",t&&t.search||n("search")),species:e("",t&&t.species||n("species")),split:e("",t&&t.split||n("split")),toPrimitive:e("",t&&t.toPrimitive||n("toPrimitive")),toStringTag:e("",t&&t.toStringTag||n("toStringTag")),unscopables:e("",t&&t.unscopables||n("unscopables"))})},l_}var d_,JO;function EX(){if(JO)return d_;JO=1;var e=mo(),t=_L(),n=Object.create(null);return d_=function(r){return Object.defineProperties(r,{for:e(function(o){return n[o]?n[o]:n[o]=r(String(o))}),keyFor:e(function(o){var s;t(o);for(s in n)if(n[s]===o)return s})})},d_}var f_,eb;function TX(){if(eb)return f_;eb=1;var e=mo(),t=_L(),n=Vl().Symbol,r=_X(),o=pX(),s=EX(),i=Object.create,a=Object.defineProperties,c=Object.defineProperty,l,f,d;if(typeof n=="function")try{String(n()),d=!0}catch{}else n=null;return f=function(_){if(this instanceof f)throw new TypeError("Symbol is not a constructor");return l(_)},f_=l=function u(_){var p;if(this instanceof u)throw new TypeError("Symbol is not a constructor");return d?n(_):(p=i(f.prototype),_=_===void 0?"":String(_),a(p,{__description__:e("",_),__name__:e("",r(_))}))},o(l),s(l),a(f.prototype,{constructor:e(l),toString:e("",function(){return this.__name__})}),a(l.prototype,{toString:e(function(){return"Symbol ("+t(this).__description__+")"}),valueOf:e(function(){return t(this)})}),c(l.prototype,l.toPrimitive,e("",function(){var u=t(this);return typeof u=="symbol"?u:u.toString()})),c(l.prototype,l.toStringTag,e("c","Symbol")),c(f.prototype,l.toStringTag,e("c",l.prototype[l.toStringTag])),c(f.prototype,l.toPrimitive,e("c",l.prototype[l.toPrimitive])),f_}var __,tb;function hX(){return tb||(tb=1,__=dX()()?Vl().Symbol:TX()),__}var p_,nb;function SX(){if(nb)return p_;nb=1;var e=Object.prototype.toString,t=e.call((function(){return arguments})());return p_=function(n){return e.call(n)===t},p_}var E_,rb;function mX(){if(rb)return E_;rb=1;var e=Object.prototype.toString,t=RegExp.prototype.test.bind(/^[object [A-Za-z0-9]*Function]$/);return E_=function(n){return typeof n=="function"&&t(e.call(n))},E_}var T_,ob;function AX(){if(ob)return T_;ob=1;var e=Object.prototype.toString,t=e.call("");return T_=function(n){return typeof n=="string"||n&&typeof n=="object"&&(n instanceof String||e.call(n)===t)||!1},T_}var h_,sb;function gX(){if(sb)return h_;sb=1;var e=hX().iterator,t=SX(),n=mX(),r=ho(),o=ar(),s=os(),i=To(),a=AX(),c=Array.isArray,l=Function.prototype.call,f={configurable:!0,enumerable:!0,writable:!0,value:null},d=Object.defineProperty;return h_=function(u){var _=arguments[1],p=arguments[2],E,T,h,m,A,g,R,O,C,I;if(u=Object(s(u)),i(_)&&o(_),!this||this===Array||!n(this)){if(!_){if(t(u))return A=u.length,A!==1?Array.apply(null,u):(m=new Array(1),m[0]=u[0],m);if(c(u)){for(m=new Array(A=u.length),T=0;T<A;++T)m[T]=u[T];return m}}m=[]}else E=this;if(!c(u)){if((C=u[e])!==void 0){for(R=o(C).call(u),E&&(m=new E),O=R.next(),T=0;!O.done;)I=_?l.call(_,p,O.value,T):O.value,E?(f.value=I,d(m,T,f)):m[T]=I,O=R.next(),++T;A=T}else if(a(u)){for(A=u.length,E&&(m=new E),T=0,h=0;T<A;++T)I=u[T],T+1<A&&(g=I.charCodeAt(0),g>=55296&&g<=56319&&(I+=u[++T])),I=_?l.call(_,p,I,h):I,E?(f.value=I,d(m,h,f)):m[h]=I,++h;A=h}}if(A===void 0)for(A=r(u.length),E&&(m=new E(A)),T=0;T<A;++T)I=_?l.call(_,p,u[T],T):u[T],E?(f.value=I,d(m,T,f)):m[T]=I;return E&&(f.value=null,m.length=A),m},h_}var S_,ib;function pT(){return ib||(ib=1,S_=cX()()?Array.from:gX()),S_}var m_,ab;function RX(){if(ab)return m_;ab=1;var e=pT(),t=Array.isArray;return m_=function(n){return t(n)?n:e(n)},m_}var A_,cb;function NX(){if(cb)return A_;cb=1;var e=RX(),t=To(),n=ar(),r=Array.prototype.slice,o;return o=function(s){return this.map(function(i,a){return i?i(s[a]):s[a]}).concat(r.call(s,this.length))},A_=function(s){return s=e(s),s.forEach(function(i){t(i)&&n(i)}),o.bind(s)},A_}var g_,ub;function yX(){if(ub)return g_;ub=1;var e=ar();return g_=function(t){var n;return typeof t=="function"?{set:t,get:t}:(n={get:e(t.get)},t.set!==void 0?(n.set=e(t.set),t.delete&&(n.delete=e(t.delete)),t.clear&&(n.clear=e(t.clear)),n):(n.set=n.get,n))},g_}var R_,lb;function OX(){if(lb)return R_;lb=1;var e=J9(),t=dL(),n=mo(),r=aX().methods,o=NX(),s=yX(),i=Function.prototype.apply,a=Function.prototype.call,c=Object.create,l=Object.defineProperties,f=r.on,d=r.emit;return R_=function(u,_,p){var E=c(null),T,h,m,A,g,R,O,C,I,L,U,q,H,$,B;return _!==!1?h=_:isNaN(u.length)?h=1:h=u.length,p.normalizer&&(L=s(p.normalizer),m=L.get,A=L.set,g=L.delete,R=L.clear),p.resolvers!=null&&(B=o(p.resolvers)),m?$=t(function(F){var w,k,Y=arguments;if(B&&(Y=B(Y)),w=m(Y),w!==null&&hasOwnProperty.call(E,w))return U&&T.emit("get",w,Y,this),E[w];if(Y.length===1?k=a.call(u,this,Y[0]):k=i.call(u,this,Y),w===null){if(w=m(Y),w!==null)throw e("Circular invocation","CIRCULAR_INVOCATION");w=A(Y)}else if(hasOwnProperty.call(E,w))throw e("Circular invocation","CIRCULAR_INVOCATION");return E[w]=k,q&&T.emit("set",w,null,k),k},h):_===0?$=function(){var F;if(hasOwnProperty.call(E,"data"))return U&&T.emit("get","data",arguments,this),E.data;if(arguments.length?F=i.call(u,this,arguments):F=a.call(u,this),hasOwnProperty.call(E,"data"))throw e("Circular invocation","CIRCULAR_INVOCATION");return E.data=F,q&&T.emit("set","data",null,F),F}:$=function(F){var w,k=arguments,Y;if(B&&(k=B(arguments)),Y=String(k[0]),hasOwnProperty.call(E,Y))return U&&T.emit("get",Y,k,this),E[Y];if(k.length===1?w=a.call(u,this,k[0]):w=i.call(u,this,k),hasOwnProperty.call(E,Y))throw e("Circular invocation","CIRCULAR_INVOCATION");return E[Y]=w,q&&T.emit("set",Y,null,w),w},T={original:u,memoized:$,profileName:p.profileName,get:function(F){return B&&(F=B(F)),m?m(F):String(F[0])},has:function(F){return hasOwnProperty.call(E,F)},delete:function(F){var w;hasOwnProperty.call(E,F)&&(g&&g(F),w=E[F],delete E[F],H&&T.emit("delete",F,w))},clear:function(){var F=E;R&&R(),E=c(null),T.emit("clear",F)},on:function(F,w){return F==="get"?U=!0:F==="set"?q=!0:F==="delete"&&(H=!0),f.call(this,F,w)},emit:d,updateEnv:function(){u=T.original}},m?O=t(function(F){var w,k=arguments;B&&(k=B(k)),w=m(k),w!==null&&T.delete(w)},h):_===0?O=function(){return T.delete("data")}:O=function(F){return B&&(F=B(arguments)[0]),T.delete(F)},C=t(function(){var F,w=arguments;return _===0?E.data:(B&&(w=B(w)),m?F=m(w):F=String(w[0]),E[F])}),I=t(function(){var F,w=arguments;return _===0?T.has("data"):(B&&(w=B(w)),m?F=m(w):F=String(w[0]),F===null?!1:T.has(F))}),l($,{__memoized__:n(!0),delete:n(O),clear:n(T.clear),_get:n(C),_has:n(I)}),T},R_}var N_,db;function bX(){if(db)return N_;db=1;var e=ar(),t=Gl(),n=So(),r=OX(),o=cL();return N_=function s(i){var a,c,l;if(e(i),a=Object(arguments[1]),a.async&&a.promise)throw new Error("Options 'async' and 'promise' cannot be used together");return hasOwnProperty.call(i,"__memoized__")&&!a.force?i:(c=o(a.length,i.length,a.async&&n.async),l=r(i,c,a),t(n,function(f,d){a[d]&&f(a[d],l,a)}),s.__profiler__&&s.__profiler__(l),l.updateEnv(),l.memoized)},N_}var y_,fb;function IX(){return fb||(fb=1,y_=function(e){var t,n,r=e.length;if(!r)return"";for(t=String(e[n=0]);--r;)t+=""+e[++n];return t}),y_}var O_,_b;function CX(){return _b||(_b=1,O_=function(e){return e?function(t){for(var n=String(t[0]),r=0,o=e;--o;)n+=""+t[++r];return n}:function(){return""}}),O_}var b_,pb;function MX(){return pb||(pb=1,b_=function(){var e=Number.isNaN;return typeof e!="function"?!1:!e({})&&e(NaN)&&!e(34)}),b_}var I_,Eb;function PX(){return Eb||(Eb=1,I_=function(e){return e!==e}),I_}var C_,Tb;function vX(){return Tb||(Tb=1,C_=MX()()?Number.isNaN:PX()),C_}var M_,hb;function ET(){if(hb)return M_;hb=1;var e=vX(),t=ho(),n=os(),r=Array.prototype.indexOf,o=Object.prototype.hasOwnProperty,s=Math.abs,i=Math.floor;return M_=function(a){var c,l,f,d;if(!e(a))return r.apply(this,arguments);for(l=t(n(this).length),f=arguments[1],isNaN(f)?f=0:f>=0?f=i(f):f=t(this.length)-i(s(f)),c=f;c<l;++c)if(o.call(this,c)&&(d=this[c],e(d)))return c;return-1},M_}var P_,Sb;function LX(){if(Sb)return P_;Sb=1;var e=ET(),t=Object.create;return P_=function(){var n=0,r=[],o=t(null);return{get:function(s){var i=0,a=r,c,l=s.length;if(l===0)return a[l]||null;if(a=a[l]){for(;i<l-1;){if(c=e.call(a[0],s[i]),c===-1)return null;a=a[1][c],++i}return c=e.call(a[0],s[i]),c===-1?null:a[1][c]||null}return null},set:function(s){var i=0,a=r,c,l=s.length;if(l===0)a[l]=++n;else{for(a[l]||(a[l]=[[],[]]),a=a[l];i<l-1;)c=e.call(a[0],s[i]),c===-1&&(c=a[0].push(s[i])-1,a[1].push([[],[]])),a=a[1][c],++i;c=e.call(a[0],s[i]),c===-1&&(c=a[0].push(s[i])-1),a[1][c]=++n}return o[n]=s,n},delete:function(s){var i=0,a=r,c,l=o[s],f=l.length,d=[];if(f===0)delete a[f];else if(a=a[f]){for(;i<f-1;){if(c=e.call(a[0],l[i]),c===-1)return;d.push(a,c),a=a[1][c],++i}if(c=e.call(a[0],l[i]),c===-1)return;for(s=a[1][c],a[0].splice(c,1),a[1].splice(c,1);!a[0].length&&d.length;)c=d.pop(),a=d.pop(),a[0].splice(c,1),a[1].splice(c,1)}delete o[s]},clear:function(){r=[],o=t(null)}}},P_}var v_,mb;function DX(){if(mb)return v_;mb=1;var e=ET();return v_=function(){var t=0,n=[],r=[];return{get:function(o){var s=e.call(n,o[0]);return s===-1?null:r[s]},set:function(o){return n.push(o[0]),r.push(++t),t},delete:function(o){var s=e.call(r,o);s!==-1&&(n.splice(s,1),r.splice(s,1))},clear:function(){n=[],r=[]}}},v_}var L_,Ab;function wX(){if(Ab)return L_;Ab=1;var e=ET(),t=Object.create;return L_=function(n){var r=0,o=[[],[]],s=t(null);return{get:function(i){for(var a=0,c=o,l;a<n-1;){if(l=e.call(c[0],i[a]),l===-1)return null;c=c[1][l],++a}return l=e.call(c[0],i[a]),l===-1?null:c[1][l]||null},set:function(i){for(var a=0,c=o,l;a<n-1;)l=e.call(c[0],i[a]),l===-1&&(l=c[0].push(i[a])-1,c[1].push([[],[]])),c=c[1][l],++a;return l=e.call(c[0],i[a]),l===-1&&(l=c[0].push(i[a])-1),c[1][l]=++r,s[r]=i,r},delete:function(i){for(var a=0,c=o,l,f=[],d=s[i];a<n-1;){if(l=e.call(c[0],d[a]),l===-1)return;f.push(c,l),c=c[1][l],++a}if(l=e.call(c[0],d[a]),l!==-1){for(i=c[1][l],c[0].splice(l,1),c[1].splice(l,1);!c[0].length&&f.length;)l=f.pop(),c=f.pop(),c[0].splice(l,1),c[1].splice(l,1);delete s[i]}},clear:function(){o=[[],[]],s=t(null)}}},L_}var gb={},D_,Rb;function pL(){if(Rb)return D_;Rb=1;var e=ar(),t=Gl(),n=Function.prototype.call;return D_=function(r,o){var s={},i=arguments[2];return e(o),t(r,function(a,c,l,f){s[c]=n.call(o,i,a,c,l,f)}),s},D_}var w_,Nb;function TT(){if(Nb)return w_;Nb=1;var e=function(n){if(typeof n!="function")throw new TypeError(n+" is not a function");return n},t=function(n){var r=document.createTextNode(""),o,s,i=0;return new n(function(){var a;if(o)s&&(o=s.concat(o));else{if(!s)return;o=s}if(s=o,o=null,typeof s=="function"){a=s,s=null,a();return}for(r.data=i=++i%2;s;)a=s.shift(),s.length||(s=null),a()}).observe(r,{characterData:!0}),function(a){if(e(a),o){typeof o=="function"?o=[o,a]:o.push(a);return}o=a,r.data=i=++i%2}};return w_=(function(){if(typeof process=="object"&&process&&typeof process.nextTick=="function")return process.nextTick;if(typeof queueMicrotask=="function")return function(n){queueMicrotask(e(n))};if(typeof document=="object"&&document){if(typeof MutationObserver=="function")return t(MutationObserver);if(typeof WebKitMutationObserver=="function")return t(WebKitMutationObserver)}return typeof setImmediate=="function"?function(n){setImmediate(e(n))}:typeof setTimeout=="function"||typeof setTimeout=="object"?function(n){setTimeout(e(n),0)}:null})(),w_}var yb;function UX(){if(yb)return gb;yb=1;var e=pT(),t=pL(),n=lL(),r=dL(),o=TT(),s=Array.prototype.slice,i=Function.prototype.apply,a=Object.create;return So().async=function(c,l){var f=a(null),d=a(null),u=l.memoized,_=l.original,p,E,T;l.memoized=r(function(h){var m=arguments,A=m[m.length-1];return typeof A=="function"&&(p=A,m=s.call(m,0,-1)),u.apply(E=this,T=m)},u);try{n(l.memoized,u)}catch{}l.on("get",function(h){var m,A,g;if(p){if(f[h]){typeof f[h]=="function"?f[h]=[f[h],p]:f[h].push(p),p=null;return}m=p,A=E,g=T,p=E=T=null,o(function(){var R;hasOwnProperty.call(d,h)?(R=d[h],l.emit("getasync",h,g,A),i.call(m,R.context,R.args)):(p=m,E=A,T=g,u.apply(A,g))})}}),l.original=function(){var h,m,A,g;return p?(h=e(arguments),m=function R(O){var C,I,L=R.id;if(L==null){o(i.bind(R,this,arguments));return}if(delete R.id,C=f[L],delete f[L],!!C)return I=e(arguments),l.has(L)&&(O?l.delete(L):(d[L]={context:this,args:I},l.emit("setasync",L,typeof C=="function"?1:C.length))),typeof C=="function"?g=i.call(C,this,I):C.forEach(function(U){g=i.call(U,this,I)},this),g},A=p,p=E=T=null,h.push(m),g=i.call(_,this,h),m.cb=A,p=m,g):i.call(_,this,arguments)},l.on("set",function(h){if(!p){l.delete(h);return}f[h]?typeof f[h]=="function"?f[h]=[f[h],p.cb]:f[h].push(p.cb):f[h]=p.cb,delete p.cb,p.id=h,p=null}),l.on("delete",function(h){var m;hasOwnProperty.call(f,h)||d[h]&&(m=d[h],delete d[h],l.emit("deleteasync",h,s.call(m.args,1)))}),l.on("clear",function(){var h=d;d=a(null),l.emit("clearasync",t(h,function(m){return s.call(m.args,1)}))})},gb}var Ob={},U_,bb;function kX(){if(bb)return U_;bb=1;var e=Array.prototype.forEach,t=Object.create;return U_=function(n){var r=t(null);return e.call(arguments,function(o){r[o]=!0}),r},U_}var k_,Ib;function EL(){return Ib||(Ib=1,k_=function(e){return typeof e=="function"}),k_}var G_,Cb;function GX(){if(Cb)return G_;Cb=1;var e=EL();return G_=function(t){try{return t&&e(t.toString)?t.toString():String(t)}catch{throw new TypeError("Passed argument cannot be stringifed")}},G_}var V_,Mb;function VX(){if(Mb)return V_;Mb=1;var e=os(),t=GX();return V_=function(n){return t(e(n))},V_}var x_,Pb;function xX(){if(Pb)return x_;Pb=1;var e=EL();return x_=function(t){try{return t&&e(t.toString)?t.toString():String(t)}catch{return"<Non-coercible to string value>"}},x_}var $_,vb;function $X(){if(vb)return $_;vb=1;var e=xX(),t=/[\n\r\u2028\u2029]/g;return $_=function(n){var r=e(n);return r.length>100&&(r=r.slice(0,99)+""),r=r.replace(t,function(o){return JSON.stringify(o).slice(1,-1)}),r},$_}var zc={exports:{}},Lb;function TL(){if(Lb)return zc.exports;Lb=1,zc.exports=e,zc.exports.default=e;function e(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}return zc.exports}var Db;function BX(){if(Db)return Ob;Db=1;var e=pL(),t=kX(),n=VX(),r=$X(),o=TL(),s=TT(),i=Object.create,a=t("then","then:finally","done","done:finally");return So().promise=function(c,l){var f=i(null),d=i(null),u=i(null);if(c===!0)c=null;else if(c=n(c),!a[c])throw new TypeError("'"+r(c)+"' is not valid promise mode");l.on("set",function(_,p,E){var T=!1;if(!o(E)){d[_]=E,l.emit("setasync",_,1);return}f[_]=1,u[_]=E;var h=function(R){var O=f[_];if(T)throw new Error(`Memoizee error: Detected unordered then|done & finally resolution, which in turn makes proper detection of success/failure impossible (when in 'done:finally' mode)
Consider to rely on 'then' or 'done' mode instead.`);O&&(delete f[_],d[_]=R,l.emit("setasync",_,O))},m=function(){T=!0,f[_]&&(delete f[_],delete u[_],l.delete(_))},A=c;if(A||(A="then"),A==="then"){var g=function(){s(m)};E=E.then(function(R){s(h.bind(this,R))},g),typeof E.finally=="function"&&E.finally(g)}else if(A==="done"){if(typeof E.done!="function")throw new Error("Memoizee error: Retrieved promise does not implement 'done' in 'done' mode");E.done(h,m)}else if(A==="done:finally"){if(typeof E.done!="function")throw new Error("Memoizee error: Retrieved promise does not implement 'done' in 'done:finally' mode");if(typeof E.finally!="function")throw new Error("Memoizee error: Retrieved promise does not implement 'finally' in 'done:finally' mode");E.done(h),E.finally(m)}}),l.on("get",function(_,p,E){var T;if(f[_]){++f[_];return}T=u[_];var h=function(){l.emit("getasync",_,p,E)};o(T)?typeof T.done=="function"?T.done(h):T.then(function(){s(h)}):h()}),l.on("delete",function(_){if(delete u[_],f[_]){delete f[_];return}if(hasOwnProperty.call(d,_)){var p=d[_];delete d[_],l.emit("deleteasync",_,[p])}}),l.on("clear",function(){var _=d;d=i(null),f=i(null),u=i(null),l.emit("clearasync",e(_,function(p){return[p]}))})},Ob}var wb={},Ub;function HX(){if(Ub)return wb;Ub=1;var e=ar(),t=Gl(),n=So(),r=Function.prototype.apply;return n.dispose=function(o,s,i){var a;if(e(o),i.async&&n.async||i.promise&&n.promise){s.on("deleteasync",a=function(c,l){r.call(o,null,l)}),s.on("clearasync",function(c){t(c,function(l,f){a(f,l)})});return}s.on("delete",a=function(c,l){o(l)}),s.on("clear",function(c){t(c,function(l,f){a(f,l)})})},wb}var kb={},B_,Gb;function FX(){return Gb||(Gb=1,B_=2147483647),B_}var H_,Vb;function YX(){if(Vb)return H_;Vb=1;var e=ho(),t=FX();return H_=function(n){if(n=e(n),n>t)throw new TypeError(n+" exceeds maximum possible timeout");return n},H_}var xb;function jX(){if(xb)return kb;xb=1;var e=pT(),t=Gl(),n=TT(),r=TL(),o=YX(),s=So(),i=Function.prototype,a=Math.max,c=Math.min,l=Object.create;return s.maxAge=function(f,d,u){var _,p,E,T;f=o(f),f&&(_=l(null),p=u.async&&s.async||u.promise&&s.promise?"async":"",d.on("set"+p,function(h){_[h]=setTimeout(function(){d.delete(h)},f),typeof _[h].unref=="function"&&_[h].unref(),T&&(T[h]&&T[h]!=="nextTick"&&clearTimeout(T[h]),T[h]=setTimeout(function(){delete T[h]},E),typeof T[h].unref=="function"&&T[h].unref())}),d.on("delete"+p,function(h){clearTimeout(_[h]),delete _[h],T&&(T[h]!=="nextTick"&&clearTimeout(T[h]),delete T[h])}),u.preFetch&&(u.preFetch===!0||isNaN(u.preFetch)?E=.333:E=a(c(Number(u.preFetch),1),0),E&&(T={},E=(1-E)*f,d.on("get"+p,function(h,m,A){T[h]||(T[h]="nextTick",n(function(){var g;T[h]==="nextTick"&&(delete T[h],d.delete(h),u.async&&(m=e(m),m.push(i)),g=d.memoized.apply(A,m),u.promise&&r(g)&&(typeof g.done=="function"?g.done(i,i):g.then(i,i)))}))}))),d.on("clear"+p,function(){t(_,function(h){clearTimeout(h)}),_={},T&&(t(T,function(h){h!=="nextTick"&&clearTimeout(h)}),T={})}))},kb}var $b={},F_,Bb;function qX(){if(Bb)return F_;Bb=1;var e=ho(),t=Object.create,n=Object.prototype.hasOwnProperty;return F_=function(r){var o=0,s=1,i=t(null),a=t(null),c=0,l;return r=e(r),{hit:function(f){var d=a[f],u=++c;if(i[u]=f,a[f]=u,!d)return++o,o<=r?void 0:(f=i[s],l(f),f);if(delete i[d],s===d)for(;!n.call(i,++s););},delete:l=function(f){var d=a[f];if(d&&(delete i[d],delete a[f],--o,s===d)){if(!o){c=0,s=1;return}for(;!n.call(i,++s););}},clear:function(){o=0,s=1,i=t(null),a=t(null),c=0}}},F_}var Hb;function WX(){if(Hb)return $b;Hb=1;var e=ho(),t=qX(),n=So();return n.max=function(r,o,s){var i,a,c;r=e(r),r&&(a=t(r),i=s.async&&n.async||s.promise&&n.promise?"async":"",o.on("set"+i,c=function(l){l=a.hit(l),l!==void 0&&o.delete(l)}),o.on("get"+i,c),o.on("delete"+i,a.delete),o.on("clear"+i,a.clear))},$b}var Fb={},Yb;function KX(){if(Yb)return Fb;Yb=1;var e=mo(),t=So(),n=Object.create,r=Object.defineProperties;return t.refCounter=function(o,s,i){var a,c;a=n(null),c=i.async&&t.async||i.promise&&t.promise?"async":"",s.on("set"+c,function(l,f){a[l]=f||1}),s.on("get"+c,function(l){++a[l]}),s.on("delete"+c,function(l){delete a[l]}),s.on("clear"+c,function(){a={}}),r(s.memoized,{deleteRef:e(function(){var l=s.get(arguments);return l===null||!a[l]?null:--a[l]?!1:(s.delete(l),!0)}),getRefCount:e(function(){var l=s.get(arguments);return l===null||!a[l]?0:a[l]})})},Fb}var Y_,jb;function zX(){if(jb)return Y_;jb=1;var e=aL(),t=cL(),n=bX();return Y_=function(r){var o=e(arguments[1]),s;return o.normalizer||(s=o.length=t(o.length,r.length,o.async),s!==0&&(o.primitive?s===!1?o.normalizer=IX():s>1&&(o.normalizer=CX()(s)):s===!1?o.normalizer=LX()():s===1?o.normalizer=DX()():o.normalizer=wX()(s))),o.async&&UX(),o.promise&&BX(),o.dispose&&HX(),o.maxAge&&jX(),o.max&&WX(),o.refCounter&&KX(),n(r,o)},Y_}var ZX=zX();const xl=Zp(ZX);class XX{constructor(t){this.i=0,this.string=t,this.whitespace=` 	\r
`,this.quotes=`'"`,this.escapes="\\",this.escapedQuotes='"',this.ansiCQuotes=!0,this.localeQuotes=!0,this.debug=!1}readChar(){return this.string.charAt(this.i++)}processEscapes(t,n,r){if(!r&&!this.escapedQuotes.includes(n))return t;const o="["+this.escapes.replace(/(.)/g,"\\$1")+"]";if(!r&&this.escapedQuotes.includes(n)){const s=new RegExp(o+"("+o+"|\\"+n+")","g");return t.replace(s,"$1")}if(r){const s={"([\\\\'\"?])":a=>a,a:()=>"\x07",b:()=>"\b","e|E":()=>"\x1B",f:()=>"\f",n:()=>`
`,r:()=>"\r",t:()=>"	",v:()=>"\v","([0-7]{1,3})":a=>String.fromCharCode(parseInt(a,8)),"x([0-9a-fA-F]{1,2})":a=>String.fromCharCode(parseInt(a,16)),"u([0-9a-fA-F]{1,4})":a=>String.fromCharCode(parseInt(a,16)),"U([0-9a-fA-F]{1,8})":a=>String.fromCharCode(parseInt(a,16)),"c(.)":a=>a==="?"?"":a==="@"?"\0":String.fromCharCode(a.charCodeAt(0)&31)},i=new RegExp(o+"("+Object.keys(s).join("|")+")","g");return t.replace(i,function(a,c){for(const l in s){const f=new RegExp("^"+l+"$").exec(c);if(f!==null)return s[l].apply(null,f.slice(1))}})}}*[Symbol.iterator](){let t=!1,n=!1,r=!1,o=-2,s;for(this.debug&&console.log("full input:",">"+this.string+"<");;){const i=this.i,a=this.readChar();if(this.debug&&console.log("position:",i,"input:",">"+a+"<","accumulated:",s,"inQuote:",t,"inDollarQuote:",n,"lastDollar:",o,"escaped:",r),a===""){if(t)throw new Error("Got EOF while in a quoted string");if(r)throw new Error("Got EOF while in an escape sequence");s!==void 0&&(yield s);return}if(r){a===`
`||(t?s=(s||"")+r+a:s=(s||"")+a),r=!1;continue}if(this.escapes.includes(a)&&(!t||n!==!1||this.escapedQuotes.includes(t))){r=a;continue}if(t!==!1){if(a===t){s=this.processEscapes(s,t,n==="'"),t=!1,n=!1;continue}s=(s||"")+a;continue}if(this.quotes.includes(a)){t=a,o===i-1&&(a==="'"&&!this.ansiCQuotes||a==='"'&&!this.localeQuotes||(n=a)),s=s||"",n!==!1&&(s=s.slice(0,-1));continue}if(t===!1&&a==="$"&&(o=i),this.whitespace.includes(a)){s!==void 0&&(yield s),s=void 0;continue}s=(s||"")+a}}}function QX(e){return Array.from(new XX(e))}function Gt(e){return e===""?"''":/[^\w@%\-+=:,./]/.test(e)?("'"+e.replace(/('+)/g,`'"$1"'`)+"'").replace(/^''|''$/g,""):e}function JX(e){if(!Array.isArray(e))throw new TypeError("args should be an array");return e.map(Gt).join(" ")}function eQ(e){if(!e.startsWith("["))return{loggerName:null,message:e};const t=e.indexOf("]");if(t===-1)return{loggerName:null,message:e};if(e[t+1]!==" ")return{loggerName:null,message:e};const n=e.slice(1,t).trim();if(!n)return{loggerName:null,message:e};const r=e.slice(t+2);return{loggerName:n,message:r}}class hL{buffer=[];maxBufferSize=500;hasLoggedDroppedLogMessage=!1;push(t){if(this.buffer.length>=this.maxBufferSize){this.hasLoggedDroppedLogMessage||(this.hasLoggedDroppedLogMessage=!0,this.buffer.push({level:"warning",message:"Dropped buffered log message after maxBufferSize was reached",args:[]}));return}this.buffer.push(t)}createLogMethod(t){return(n,...r)=>{this.push({level:t,message:n,args:r})}}trace=this.createLogMethod("trace");debug=this.createLogMethod("debug");info=this.createLogMethod("info");warning=this.createLogMethod("warning");error=this.createLogMethod("error");log=(t,n,...r)=>{this.push({level:t,message:n,args:r})};flushTo(t){for(const n of this.buffer)t.log(n.level,n.message,...n.args);this.buffer.length=0}dispose(){this.buffer=[]}}let ru=new hL,qb=!1;function tQ(e){if(qb&&process.env.NODE_ENV!=="test")throw new Error("Logger already set");qb=!0,ru instanceof hL&&ru.flushTo(e),ru=e}function Ho(){return ru}function $l(e){const t=`[${e}] `,n=(o,s,...i)=>{Ho().log(o,`${t}${s}`,...i)},r=o=>(s,...i)=>{n(o,s,...i)};return{trace:r("trace"),debug:r("debug"),info:r("info"),warning:r("warning"),error:r("error"),log:(o,s,...i)=>{n(o,s,...i)},dispose:()=>{Ho().dispose()}}}function Ot(e){let t=null;return()=>(t||(t=$l(e)),t)}function SL(e){const t=Date.now(),n=$l(e),r=(o,...s)=>[`[${((Date.now()-t)/1e3).toFixed(3)}] ${o}`,...s];return{trace:(o,...s)=>{n.trace(...r(o,...s))},debug:(o,...s)=>{n.debug(...r(o,...s))},info:(o,...s)=>{n.info(...r(o,...s))},warning:(o,...s)=>{n.warning(...r(o,...s))},error:(o,...s)=>{n.error(...r(o,...s))},log:(o,s,...i)=>{n.log(o,...r(s,...i))},dispose:()=>{n.dispose()}}}var vn={},Wb;function nQ(){if(Wb)return vn;Wb=1;var e=vn&&vn.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(vn,"__esModule",{value:!0}),vn.RateLimit=vn.Sema=void 0;const t=e(zu);function n(d,u,_,p,E){for(let T=0;T<E;++T)_[T+p]=d[T+u],d[T+u]=void 0}function r(d){return d=d>>>0,d=d-1,d=d|d>>1,d=d|d>>2,d=d|d>>4,d=d|d>>8,d=d|d>>16,d+1}function o(d){return r(Math.min(Math.max(16,d),1073741824))}class s{constructor(u){this._capacity=o(u),this._length=0,this._front=0,this.arr=[]}push(u){const _=this._length;this.checkCapacity(_+1);const p=this._front+_&this._capacity-1;return this.arr[p]=u,this._length=_+1,_+1}pop(){const u=this._length;if(u===0)return;const _=this._front+u-1&this._capacity-1,p=this.arr[_];return this.arr[_]=void 0,this._length=u-1,p}shift(){const u=this._length;if(u===0)return;const _=this._front,p=this.arr[_];return this.arr[_]=void 0,this._front=_+1&this._capacity-1,this._length=u-1,p}get length(){return this._length}checkCapacity(u){this._capacity<u&&this.resizeTo(o(this._capacity*1.5+16))}resizeTo(u){const _=this._capacity;this._capacity=u;const p=this._front,E=this._length;if(p+E>_){const T=p+E&_-1;n(this.arr,0,this.arr,_,T)}}}class i extends t.default{}function a(d){return typeof d=="function"}function c(){return"1"}class l{constructor(u,{initFn:_=c,pauseFn:p,resumeFn:E,capacity:T=10}={}){if(a(p)!==a(E))throw new Error("pauseFn and resumeFn must be both set for pausing");this.nrTokens=u,this.free=new s(u),this.waiting=new s(T),this.releaseEmitter=new i,this.noTokens=_===c,this.pauseFn=p,this.resumeFn=E,this.paused=!1,this.releaseEmitter.on("release",h=>{const m=this.waiting.shift();m?m.resolve(h):(this.resumeFn&&this.paused&&(this.paused=!1,this.resumeFn()),this.free.push(h))});for(let h=0;h<u;h++)this.free.push(_())}tryAcquire(){return this.free.pop()}async acquire(){let u=this.tryAcquire();return u!==void 0?u:new Promise((_,p)=>{this.pauseFn&&!this.paused&&(this.paused=!0,this.pauseFn()),this.waiting.push({resolve:_,reject:p})})}release(u){this.releaseEmitter.emit("release",this.noTokens?"1":u)}drain(){const u=new Array(this.nrTokens);for(let _=0;_<this.nrTokens;_++)u[_]=this.acquire();return Promise.all(u)}nrWaiting(){return this.waiting.length}}vn.Sema=l;function f(d,{timeUnit:u=1e3,uniformDistribution:_=!1}={}){const p=new l(_?1:d),E=_?u/d:u;return async function(){await p.acquire(),setTimeout(()=>p.release(),E)}}return vn.RateLimit=f,vn}var mL=nQ();class AL{constructor(t,n=[],r=[],o){this.child=t,this.stdoutChunks=n,this.stderrChunks=r,this.promise=o.then(({code:s,signal:i})=>({type:"resolve",code:s,signal:i}),s=>({type:"reject",error:s}))}result=null;promise;check(){return this.wait().then(({stdout:t,stderr:n,code:r,signal:o})=>{if(r===0)return{stdout:t,stderr:n};throw new Error(`process exited with code ${r}, signal ${o}`)})}wait(){return this.promise.then(t=>{switch(t.type){case"resolve":{const{code:n,signal:r}=t;return{stdout:Buffer.concat(this.stdoutChunks).toString("utf8"),stderr:Buffer.concat(this.stderrChunks).toString("utf8"),code:n,signal:r}}case"reject":throw t.error}})}getStdout(){return Buffer.concat(this.stdoutChunks)}getStderr(){return Buffer.concat(this.stderrChunks)}getExitCode(){return this.result?.type==="resolve"?this.result.code:null}isDone(){return this.result!=null}kill(){this.child.kill()}}const rQ={startSpan:(e,t)=>t()};let gL=rQ;function oQ(e){gL=e}function sQ(){return gL}function hT(e,t){return sQ().startSpan(e,t)}let xu;function iQ(e){if(xu)throw new Error("shouldSpawnInsideWsl already set");xu=e}function aQ(){if(!xu){if(process.env.NODE_ENV==="test"||process.env.VITEST!=null)return!1;throw new Error("shouldSpawnInsideWsl not set")}return xu()}function cQ(){const e=Ho(),t=uQ(e);if(!t)return;if(fQ(t))return Gp(t);if(dQ(t))return Gp(_Q(t));const n=lQ(t,e);if(n)return n;e.warning(`[resolveCodexHomeFromWsl] Unable to translate Linux path "${t}" to a Windows path`)}function uQ(e){return RL(["/usr/bin/env","bash","-lc",'printf %s "${CODEX_HOME:-$HOME/.codex}"'],"readCodexHomePathFromWslEnv",e)}function lQ(e,t){const n=RL(["wslpath","-w",e],`resolveCodexHomeFromWsl:wslpath(${e})`,t);return n?Gp(n):void 0}function RL(e,t,n){try{const r=zp.spawnSync("wsl.exe",e,{encoding:"utf8",windowsHide:!0});if(r.error){n.debug(`[${t}] command error: ${String(r.error)}`);return}if(r.status!==0){n.debug(`[${t}] non-zero exit (${r.status}): ${r.stderr?.toString()??""}`);return}const o=r.stdout?.toString().trim();if(!o){n.warning(`[${t}] command returned empty output`);return}return o}catch(r){n.warning(`[${t}] unexpected error: ${String(r)}`);return}}function Gp(e){return e.replace(/\//g,"\\")}function dQ(e){return/^\/mnt\/[a-zA-Z]\//.test(e)?!0:/^\\{1,2}mnt\\[a-zA-Z]\\/.test(e)}function fQ(e){return!!(/^[a-zA-Z]:[\\/]/.test(e)||/^\\\\/.test(e))}function _Q(e){const t=e.match(/^\/mnt\/([a-zA-Z])\/(.*)$/);if(t){const o=t[1].toUpperCase(),s=t[2].replace(/\//g,"\\");return`${o}:\\${s}`}const n=e.match(/^\\{1,2}[Mm][Nn][Tt]\\([a-zA-Z])\\(.*)$/i);if(n){const o=n[1].toUpperCase(),s=n[2].replace(/[\\/]/g,"\\");return`${o}:\\${s}`}const r=e.match(/^C:\\mnt\\c(.*)$/i);return r?`C:\\${r[1].replace(/^([\\/])+/,"").replace(/[\\/]/g,"\\")}`:e.replace(/\//g,"\\")}function NL(e){if(/^(\\\\|\/\/)(wsl\$|wsl\.localhost)/i.test(e)){const r=e.replace(/^((\\\\|\/\/)(wsl\$|wsl\.localhost)[\\/]+)/i,"").split(/[\\/]/);r.shift();const o=r.join("/").replace(/\\/g,"/");return o.length===0?"/":o.startsWith("/")?o:`/${o}`}if(e.startsWith("/"))return e;const t=e.match(/^([a-zA-Z]):[\\/](.*)$/);if(t){const n=t[1].toLowerCase(),r=t[2].replace(/\\/g,"/");return`/mnt/${n}/${r}`}return e.replace(/\\/g,"/")}const yL=Ot("spawn-async");function OL(e){const t=e[0]??"process";return t==="git"&&e[1]?{op:"git.exec",name:`git ${e[1]}`}:{op:"process.exec",name:t}}function bL({args:e,cwd:t,env:n,signal:r,stdoutChunkHandler:o,stderrChunkHandler:s,onExitHandler:i}){if(aQ())return yL().info("Spawning process inside WSL"),pQ(e,t,n?EQ(n):void 0,r,o,s);const a=e[0],c=e.slice(1),l={cwd:t,env:{...process.env,...n},stdio:["ignore","pipe","pipe"]},f=zp.spawn(a,c,l),d=[],u=[],_=new Promise((E,T)=>{const h=IL(f,r);f.stdout?.on("data",m=>{d.push(m),o?.(m)}),f.stderr?.on("data",m=>{u.push(m),s?.(m)}),f.on("close",(m,A)=>{i?.(),h?.(),E({code:m,signal:A})}),f.on("error",m=>{i?.(),h?.(),T(m)})}),p=OL(e);return new AL(f,d,u,hT(p,()=>_))}function pQ(e,t,n,r,o,s){const i=t?NL(t):".",a=["RUST_LOG=warn"];n&&a.push(...TQ(n));const c=["-d","Ubuntu"];c.push("--cd",i),c.push("--exec","/usr/bin/env",...a,...e);const l={env:{...process.env},stdio:["ignore","pipe","pipe"]};yL().debug("Spawning process inside WSL: wsl.exe %s",c.join(" "));const f=zp.spawn("wsl.exe",c,l),d=[],u=[],_=new Promise((E,T)=>{const h=IL(f,r);f.stdout?.on("data",m=>{d.push(m),o?.(m)}),f.stderr?.on("data",m=>{u.push(m),s?.(m)}),f.on("close",(m,A)=>{h?.(),E({code:m,signal:A})}),f.on("error",m=>{h?.(),T(m)})}),p=OL(e);return new AL(f,d,u,hT(p,()=>_))}function IL(e,t){if(!t)return;const n=()=>{e.kill()};return t.addEventListener("abort",n),t.aborted&&n(),()=>{t.removeEventListener("abort",n)}}function EQ(e){const t={};for(const[n,r]of Object.entries(e))r!=null&&process.env[n]!==r&&(t[n]=r);return t}function TQ(e){const t=[];for(const[n,r]of Object.entries(e)){const o=hQ(r)?NL(r):r;t.push(`${n}=${o}`)}return t}function hQ(e){return e.includes(";")?!1:!!(/^(?:[a-zA-Z]:[\\/]|\\\\|\/\/)/.test(e)||/^(\\\\|\/\/)(wsl\$|wsl\.localhost)[\\/]/i.test(e))}const SQ=4,mQ=1e3,j_=new Map,q_=Ot("spawn-remote-async");function AQ(e){return j_.has(e)||j_.set(e,new mL.Sema(SQ)),j_.get(e)}class gQ{constructor(t,n){this.semaphore=t,this.timeout=n}releaseTimeout=null;released=!1;async acquire(){await this.semaphore.acquire(),this.releaseTimeout=setTimeout(()=>{this.release()},this.timeout)}release(){this.released||(this.released=!0,this.releaseTimeout&&clearTimeout(this.releaseTimeout),this.semaphore.release())}}async function cr({hostConfig:e,args:t,env:n,signal:r,timeoutMs:o,noConcurrencyLimit:s,stdoutChunkHandler:i,stderrChunkHandler:a}){const c=n?Object.entries(n).map(([p,E])=>`${p}=${E}`):[],l=[...e.terminal_command,"--",...c,...t];let f=null;if(!s){const p=AQ(e.id);f=new gQ(p,mQ),await f.acquire()}let d=!1,u=null;const _=bL({args:l,signal:r,stdoutChunkHandler:i,stderrChunkHandler:a,onExitHandler:()=>{d=!0,u&&clearTimeout(u),f&&f.release()}});return o!=null&&(u=setTimeout(()=>{_.kill()},o),d&&u&&(clearTimeout(u),u=null)),_}async function Ln({hostConfig:e,args:t,errorOnNonZeroExitCode:n=!0}){const r=crypto.randomUUID().slice(0,8);q_().debug(`[${r}] Spawning process with args: ${t.join(" ")}`);const o=await cr({hostConfig:e,args:t}),{stdout:s,stderr:i,code:a}=await o.wait();if(a!==0){if(q_().debug(`[${r}] Process errored with code ${a} stderr=${i}`),n)throw new Error(`Process errored with code ${a} stderr=${i}`)}else q_().debug(`[${r}] Process exited successfully with code ${a}`);return{stdout:s,stderr:i,code:a}}const RQ=6e4,NQ=60*RQ,ST=24*NQ;function yQ(e){const{preferWsl:t=!1}=e,n=Ho();if(t&&process.platform==="win32"){const r=cQ();if(r)return r;n.info("[resolveCodexHome] Falling back to host home directory because WSL CODEX_HOME could not be resolved")}return process.env.CODEX_HOME??BI.join(Lt.homedir(),".codex")}const OQ=xl(async e=>{const t=typeof e=="string"?IQ(e):e;return bQ(t)},{length:1,normalizer:([e])=>typeof e=="string"?e:e.id,promise:!0,maxAge:ST});async function bQ(e){const t=Ho(),r=["sh","-lc",Gt('if [ -n "$CODEX_HOME" ]; then printf "%s" "$CODEX_HOME"; else printf "%s" "$HOME/.codex"; fi')];let o,s=!1;const i=setTimeout(()=>{s=!0,o?.kill()},1e4);try{o=await cr({hostConfig:e,args:r});const{stdout:a,stderr:c,code:l}=await o.wait();if(clearTimeout(i),s)throw t.warning("[resolveRemoteSshCodexHome] timed out"),new Error("resolveRemoteSshCodexHome timed out");if(l!==0)throw new Error(`[resolveRemoteSshCodexHome] failed (${l}): ${c||a}`);return a.trim()}catch(a){throw clearTimeout(i),t.warning(`[resolveRemoteSshCodexHome] error: ${a instanceof Error?a.message:String(a)}`),a}}function IQ(e){return{id:e,display_name:e,kind:"ssh",codex_cli_command:[],terminal_command:QX(e)}}const ur={async readFile(e,t){if(Ue(t)){const{stdout:n}=await Ln({hostConfig:t,args:["cat",e]});return n}return de.promises.readFile(e,"utf-8")},async readFileBase64(e,t){if(Ue(t)){const{stdout:n}=await Ln({hostConfig:t,args:["base64",e]});return Buffer.from(n,"base64")}return de.promises.readFile(e,"base64")},async writeFile(e,t,n){if(Ue(n)){await Ln({hostConfig:n,args:["sh","-c",Gt(`cat > ${e} << "EOF"
${t}
EOF`)]});return}await de.promises.writeFile(e,t,"utf8")},async mkdir(e,t={},n){if(Ue(n)){const r=["mkdir"];t.recursive!==!1&&r.push("-p"),r.push(e),await Ln({hostConfig:n,args:r});return}await de.promises.mkdir(e,{recursive:t.recursive??!0})},async stat(e,t){if(!Ue(t))return de.promises.stat(e);const{stdout:n,code:r}=await Ln({hostConfig:t,args:["sh","-c",Gt('if [ -d "$1" ]; then echo "dir"; elif [ -f "$1" ]; then echo "file"; elif [ -L "$1" ]; then echo "link"; else exit 1; fi'),"sh",e],errorOnNonZeroExitCode:!1});if(r===1)throw new Error(`File not found: ${e}`);const o=n.trim();return{isDirectory:()=>o==="dir",isFile:()=>o==="file"||o==="link"}},async readdir(e,t){if(Ue(t)){const{stdout:n}=await Ln({hostConfig:t,args:["sh","-c",Gt('ls -A "$1"'),"sh",e]});return n.split(/\r?\n/).map(r=>r.trim()).filter(r=>r.length>0)}return de.promises.readdir(e)},async rm(e,t={},n){if(Ue(n)){const r=["rm"];t.recursive!==!1&&r.push("-r"),t.force!==!1&&r.push("-f"),r.push(e),await Ln({hostConfig:n,args:r});return}await de.promises.rm(e,{recursive:t.recursive??!0,force:t.force??!0})},async copyFile(e,t,n){if(Ue(n)){await Ln({hostConfig:n,args:["cp",e,t]});return}await de.promises.copyFile(e,t)},async cp(e,t,n={},r){if(Ue(r)){const o=["cp"];n.recursive&&o.push("-R"),o.push(e,t),await Ln({hostConfig:r,args:o});return}await de.promises.cp(e,t,{recursive:n.recursive??!1})}};function dn(e){return Ue(e)?le.posix:le}const CQ=["IN_PROGRESS","PENDING_REVIEW"],MQ=["IN_PROGRESS","PENDING_REVIEW","ACCEPTED","ARCHIVED"],CL=e=>`(${e.map(t=>`'${t}'`).join(", ")})`;CL(CQ);CL(MQ);var Vp=["MO","TU","WE","TH","FR","SA","SU"],At=(function(){function e(t,n){if(n===0)throw new Error("Can't create weekday with n == 0");this.weekday=t,this.n=n}return e.fromStr=function(t){return new e(Vp.indexOf(t))},e.prototype.nth=function(t){return this.n===t?this:new e(this.weekday,t)},e.prototype.equals=function(t){return this.weekday===t.weekday&&this.n===t.n},e.prototype.toString=function(){var t=Vp[this.weekday];return this.n&&(t=(this.n>0?"+":"")+String(this.n)+t),t},e.prototype.getJsWeekday=function(){return this.weekday===6?0:this.weekday+1},e})(),ze=function(e){return e!=null},En=function(e){return typeof e=="number"},Kb=function(e){return typeof e=="string"&&Vp.includes(e)},Ut=Array.isArray,On=function(e,t){t===void 0&&(t=e),arguments.length===1&&(t=e,e=0);for(var n=[],r=e;r<t;r++)n.push(r);return n},be=function(e,t){var n=0,r=[];if(Ut(e))for(;n<t;n++)r[n]=[].concat(e);else for(;n<t;n++)r[n]=e;return r},PQ=function(e){return Ut(e)?e:[e]};function go(e,t,n){n===void 0&&(n=" ");var r=String(e);return t=t>>0,r.length>t?String(r):(t=t-r.length,t>n.length&&(n+=be(n,t/n.length)),n.slice(0,t)+String(r))}var vQ=function(e,t,n){var r=e.split(t);return n?r.slice(0,n).concat([r.slice(n).join(t)]):r},Bt=function(e,t){var n=e%t;return n*t<0?n+t:n},W_=function(e,t){return{div:Math.floor(e/t),mod:Bt(e,t)}},Sn=function(e){return!ze(e)||e.length===0},rt=function(e){return!Sn(e)},we=function(e,t){return rt(e)&&e.indexOf(t)!==-1},co=function(e,t,n,r,o,s){return r===void 0&&(r=0),o===void 0&&(o=0),s===void 0&&(s=0),new Date(Date.UTC(e,t-1,n,r,o,s))},LQ=[31,28,31,30,31,30,31,31,30,31,30,31],ML=1e3*60*60*24,PL=9999,vL=co(1970,1,1),DQ=[6,0,1,2,3,4,5],Qa=function(e){return e%4===0&&e%100!==0||e%400===0},LL=function(e){return e instanceof Date},qa=function(e){return LL(e)&&!isNaN(e.getTime())},wQ=function(e,t){var n=e.getTime(),r=t.getTime(),o=n-r;return Math.round(o/ML)},xp=function(e){return wQ(e,vL)},DL=function(e){return new Date(vL.getTime()+e*ML)},UQ=function(e){var t=e.getUTCMonth();return t===1&&Qa(e.getUTCFullYear())?29:LQ[t]},Fo=function(e){return DQ[e.getUTCDay()]},zb=function(e,t){var n=co(e,t+1,1);return[Fo(n),UQ(n)]},wL=function(e,t){return t=t||e,new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()))},$p=function(e){var t=new Date(e.getTime());return t},Zb=function(e){for(var t=[],n=0;n<e.length;n++)t.push($p(e[n]));return t},fc=function(e){e.sort(function(t,n){return t.getTime()-n.getTime()})},mT=function(e,t){t===void 0&&(t=!0);var n=new Date(e);return[go(n.getUTCFullYear().toString(),4,"0"),go(n.getUTCMonth()+1,2,"0"),go(n.getUTCDate(),2,"0"),"T",go(n.getUTCHours(),2,"0"),go(n.getUTCMinutes(),2,"0"),go(n.getUTCSeconds(),2,"0"),t?"Z":""].join("")},AT=function(e){var t=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z?)?$/,n=t.exec(e);if(!n)throw new Error("Invalid UNTIL value: ".concat(e));return new Date(Date.UTC(parseInt(n[1],10),parseInt(n[2],10)-1,parseInt(n[3],10),parseInt(n[5],10)||0,parseInt(n[6],10)||0,parseInt(n[7],10)||0))},Xb=function(e,t){var n=e.toLocaleString("sv-SE",{timeZone:t});return n.replace(" ","T")+"Z"},kQ=function(e,t){var n=Intl.DateTimeFormat().resolvedOptions().timeZone,r=new Date(Xb(e,n)),o=new Date(Xb(e,t??"UTC")),s=o.getTime()-r.getTime();return new Date(e.getTime()-s)},Io=(function(){function e(t,n){this.minDate=null,this.maxDate=null,this._result=[],this.total=0,this.method=t,this.args=n,t==="between"?(this.maxDate=n.inc?n.before:new Date(n.before.getTime()-1),this.minDate=n.inc?n.after:new Date(n.after.getTime()+1)):t==="before"?this.maxDate=n.inc?n.dt:new Date(n.dt.getTime()-1):t==="after"&&(this.minDate=n.inc?n.dt:new Date(n.dt.getTime()+1))}return e.prototype.accept=function(t){++this.total;var n=this.minDate&&t<this.minDate,r=this.maxDate&&t>this.maxDate;if(this.method==="between"){if(n)return!0;if(r)return!1}else if(this.method==="before"){if(r)return!1}else if(this.method==="after")return n?!0:(this.add(t),!1);return this.add(t)},e.prototype.add=function(t){return this._result.push(t),!0},e.prototype.getValue=function(){var t=this._result;switch(this.method){case"all":case"between":return t;case"before":case"after":default:return t.length?t[t.length-1]:null}},e.prototype.clone=function(){return new e(this.method,this.args)},e})(),K_={exports:{}},Qb;function GQ(){return Qb||(Qb=1,(function(e){var t,n,r,o,s,i,a,c,l,f,d,u,_,p,E,T,h,m,A,g,R,O,C,I,L,U,q,H,$,B,F,w;(function(k){var Y=typeof np=="object"?np:typeof self=="object"?self:typeof this=="object"?this:{};k(oe(Y,oe(e.exports)));function oe(ae,ne){return ae!==Y&&(typeof Object.create=="function"?Object.defineProperty(ae,"__esModule",{value:!0}):ae.__esModule=!0),function(M,P){return ae[M]=ne?ne(M,P):P}}})(function(k){var Y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(M,P){M.__proto__=P}||function(M,P){for(var G in P)Object.prototype.hasOwnProperty.call(P,G)&&(M[G]=P[G])};t=function(M,P){if(typeof P!="function"&&P!==null)throw new TypeError("Class extends value "+String(P)+" is not a constructor or null");Y(M,P);function G(){this.constructor=M}M.prototype=P===null?Object.create(P):(G.prototype=P.prototype,new G)},n=Object.assign||function(M){for(var P,G=1,V=arguments.length;G<V;G++){P=arguments[G];for(var K in P)Object.prototype.hasOwnProperty.call(P,K)&&(M[K]=P[K])}return M},r=function(M,P){var G={};for(var V in M)Object.prototype.hasOwnProperty.call(M,V)&&P.indexOf(V)<0&&(G[V]=M[V]);if(M!=null&&typeof Object.getOwnPropertySymbols=="function")for(var K=0,V=Object.getOwnPropertySymbols(M);K<V.length;K++)P.indexOf(V[K])<0&&Object.prototype.propertyIsEnumerable.call(M,V[K])&&(G[V[K]]=M[V[K]]);return G},o=function(M,P,G,V){var K=arguments.length,X=K<3?P:V===null?V=Object.getOwnPropertyDescriptor(P,G):V,v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")X=Reflect.decorate(M,P,G,V);else for(var D=M.length-1;D>=0;D--)(v=M[D])&&(X=(K<3?v(X):K>3?v(P,G,X):v(P,G))||X);return K>3&&X&&Object.defineProperty(P,G,X),X},s=function(M,P){return function(G,V){P(G,V,M)}},i=function(M,P,G,V,K,X){function v(De){if(De!==void 0&&typeof De!="function")throw new TypeError("Function expected");return De}for(var D=V.kind,z=D==="getter"?"get":D==="setter"?"set":"value",j=!P&&M?V.static?M:M.prototype:null,ee=P||(j?Object.getOwnPropertyDescriptor(j,V.name):{}),te,_e=!1,se=G.length-1;se>=0;se--){var ce={};for(var he in V)ce[he]=he==="access"?{}:V[he];for(var he in V.access)ce.access[he]=V.access[he];ce.addInitializer=function(De){if(_e)throw new TypeError("Cannot add initializers after decoration has completed");X.push(v(De||null))};var ve=(0,G[se])(D==="accessor"?{get:ee.get,set:ee.set}:ee[z],ce);if(D==="accessor"){if(ve===void 0)continue;if(ve===null||typeof ve!="object")throw new TypeError("Object expected");(te=v(ve.get))&&(ee.get=te),(te=v(ve.set))&&(ee.set=te),(te=v(ve.init))&&K.unshift(te)}else(te=v(ve))&&(D==="field"?K.unshift(te):ee[z]=te)}j&&Object.defineProperty(j,V.name,ee),_e=!0},a=function(M,P,G){for(var V=arguments.length>2,K=0;K<P.length;K++)G=V?P[K].call(M,G):P[K].call(M);return V?G:void 0},c=function(M){return typeof M=="symbol"?M:"".concat(M)},l=function(M,P,G){return typeof P=="symbol"&&(P=P.description?"[".concat(P.description,"]"):""),Object.defineProperty(M,"name",{configurable:!0,value:G?"".concat(G," ",P):P})},f=function(M,P){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(M,P)},d=function(M,P,G,V){function K(X){return X instanceof G?X:new G(function(v){v(X)})}return new(G||(G=Promise))(function(X,v){function D(ee){try{j(V.next(ee))}catch(te){v(te)}}function z(ee){try{j(V.throw(ee))}catch(te){v(te)}}function j(ee){ee.done?X(ee.value):K(ee.value).then(D,z)}j((V=V.apply(M,P||[])).next())})},u=function(M,P){var G={label:0,sent:function(){if(X[0]&1)throw X[1];return X[1]},trys:[],ops:[]},V,K,X,v=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return v.next=D(0),v.throw=D(1),v.return=D(2),typeof Symbol=="function"&&(v[Symbol.iterator]=function(){return this}),v;function D(j){return function(ee){return z([j,ee])}}function z(j){if(V)throw new TypeError("Generator is already executing.");for(;v&&(v=0,j[0]&&(G=0)),G;)try{if(V=1,K&&(X=j[0]&2?K.return:j[0]?K.throw||((X=K.return)&&X.call(K),0):K.next)&&!(X=X.call(K,j[1])).done)return X;switch(K=0,X&&(j=[j[0]&2,X.value]),j[0]){case 0:case 1:X=j;break;case 4:return G.label++,{value:j[1],done:!1};case 5:G.label++,K=j[1],j=[0];continue;case 7:j=G.ops.pop(),G.trys.pop();continue;default:if(X=G.trys,!(X=X.length>0&&X[X.length-1])&&(j[0]===6||j[0]===2)){G=0;continue}if(j[0]===3&&(!X||j[1]>X[0]&&j[1]<X[3])){G.label=j[1];break}if(j[0]===6&&G.label<X[1]){G.label=X[1],X=j;break}if(X&&G.label<X[2]){G.label=X[2],G.ops.push(j);break}X[2]&&G.ops.pop(),G.trys.pop();continue}j=P.call(M,G)}catch(ee){j=[6,ee],K=0}finally{V=X=0}if(j[0]&5)throw j[1];return{value:j[0]?j[1]:void 0,done:!0}}},_=function(M,P){for(var G in M)G!=="default"&&!Object.prototype.hasOwnProperty.call(P,G)&&$(P,M,G)},$=Object.create?(function(M,P,G,V){V===void 0&&(V=G);var K=Object.getOwnPropertyDescriptor(P,G);(!K||("get"in K?!P.__esModule:K.writable||K.configurable))&&(K={enumerable:!0,get:function(){return P[G]}}),Object.defineProperty(M,V,K)}):(function(M,P,G,V){V===void 0&&(V=G),M[V]=P[G]}),p=function(M){var P=typeof Symbol=="function"&&Symbol.iterator,G=P&&M[P],V=0;if(G)return G.call(M);if(M&&typeof M.length=="number")return{next:function(){return M&&V>=M.length&&(M=void 0),{value:M&&M[V++],done:!M}}};throw new TypeError(P?"Object is not iterable.":"Symbol.iterator is not defined.")},E=function(M,P){var G=typeof Symbol=="function"&&M[Symbol.iterator];if(!G)return M;var V=G.call(M),K,X=[],v;try{for(;(P===void 0||P-- >0)&&!(K=V.next()).done;)X.push(K.value)}catch(D){v={error:D}}finally{try{K&&!K.done&&(G=V.return)&&G.call(V)}finally{if(v)throw v.error}}return X},T=function(){for(var M=[],P=0;P<arguments.length;P++)M=M.concat(E(arguments[P]));return M},h=function(){for(var M=0,P=0,G=arguments.length;P<G;P++)M+=arguments[P].length;for(var V=Array(M),K=0,P=0;P<G;P++)for(var X=arguments[P],v=0,D=X.length;v<D;v++,K++)V[K]=X[v];return V},m=function(M,P,G){if(G||arguments.length===2)for(var V=0,K=P.length,X;V<K;V++)(X||!(V in P))&&(X||(X=Array.prototype.slice.call(P,0,V)),X[V]=P[V]);return M.concat(X||Array.prototype.slice.call(P))},A=function(M){return this instanceof A?(this.v=M,this):new A(M)},g=function(M,P,G){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var V=G.apply(M,P||[]),K,X=[];return K=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),D("next"),D("throw"),D("return",v),K[Symbol.asyncIterator]=function(){return this},K;function v(se){return function(ce){return Promise.resolve(ce).then(se,te)}}function D(se,ce){V[se]&&(K[se]=function(he){return new Promise(function(ve,De){X.push([se,he,ve,De])>1||z(se,he)})},ce&&(K[se]=ce(K[se])))}function z(se,ce){try{j(V[se](ce))}catch(he){_e(X[0][3],he)}}function j(se){se.value instanceof A?Promise.resolve(se.value.v).then(ee,te):_e(X[0][2],se)}function ee(se){z("next",se)}function te(se){z("throw",se)}function _e(se,ce){se(ce),X.shift(),X.length&&z(X[0][0],X[0][1])}},R=function(M){var P,G;return P={},V("next"),V("throw",function(K){throw K}),V("return"),P[Symbol.iterator]=function(){return this},P;function V(K,X){P[K]=M[K]?function(v){return(G=!G)?{value:A(M[K](v)),done:!1}:X?X(v):v}:X}},O=function(M){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var P=M[Symbol.asyncIterator],G;return P?P.call(M):(M=typeof p=="function"?p(M):M[Symbol.iterator](),G={},V("next"),V("throw"),V("return"),G[Symbol.asyncIterator]=function(){return this},G);function V(X){G[X]=M[X]&&function(v){return new Promise(function(D,z){v=M[X](v),K(D,z,v.done,v.value)})}}function K(X,v,D,z){Promise.resolve(z).then(function(j){X({value:j,done:D})},v)}},C=function(M,P){return Object.defineProperty?Object.defineProperty(M,"raw",{value:P}):M.raw=P,M};var oe=Object.create?(function(M,P){Object.defineProperty(M,"default",{enumerable:!0,value:P})}):function(M,P){M.default=P},ae=function(M){return ae=Object.getOwnPropertyNames||function(P){var G=[];for(var V in P)Object.prototype.hasOwnProperty.call(P,V)&&(G[G.length]=V);return G},ae(M)};I=function(M){if(M&&M.__esModule)return M;var P={};if(M!=null)for(var G=ae(M),V=0;V<G.length;V++)G[V]!=="default"&&$(P,M,G[V]);return oe(P,M),P},L=function(M){return M&&M.__esModule?M:{default:M}},U=function(M,P,G,V){if(G==="a"&&!V)throw new TypeError("Private accessor was defined without a getter");if(typeof P=="function"?M!==P||!V:!P.has(M))throw new TypeError("Cannot read private member from an object whose class did not declare it");return G==="m"?V:G==="a"?V.call(M):V?V.value:P.get(M)},q=function(M,P,G,V,K){if(V==="m")throw new TypeError("Private method is not writable");if(V==="a"&&!K)throw new TypeError("Private accessor was defined without a setter");if(typeof P=="function"?M!==P||!K:!P.has(M))throw new TypeError("Cannot write private member to an object whose class did not declare it");return V==="a"?K.call(M,G):K?K.value=G:P.set(M,G),G},H=function(M,P){if(P===null||typeof P!="object"&&typeof P!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof M=="function"?P===M:M.has(P)},B=function(M,P,G){if(P!=null){if(typeof P!="object"&&typeof P!="function")throw new TypeError("Object expected.");var V,K;if(G){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");V=P[Symbol.asyncDispose]}if(V===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");V=P[Symbol.dispose],G&&(K=V)}if(typeof V!="function")throw new TypeError("Object not disposable.");K&&(V=function(){try{K.call(this)}catch(X){return Promise.reject(X)}}),M.stack.push({value:P,dispose:V,async:G})}else G&&M.stack.push({async:!0});return P};var ne=typeof SuppressedError=="function"?SuppressedError:function(M,P,G){var V=new Error(G);return V.name="SuppressedError",V.error=M,V.suppressed=P,V};F=function(M){function P(X){M.error=M.hasError?new ne(X,M.error,"An error was suppressed during disposal."):X,M.hasError=!0}var G,V=0;function K(){for(;G=M.stack.pop();)try{if(!G.async&&V===1)return V=0,M.stack.push(G),Promise.resolve().then(K);if(G.dispose){var X=G.dispose.call(G.value);if(G.async)return V|=2,Promise.resolve(X).then(K,function(v){return P(v),K()})}else V|=1}catch(v){P(v)}if(V===1)return M.hasError?Promise.reject(M.error):Promise.resolve();if(M.hasError)throw M.error}return K()},w=function(M,P){return typeof M=="string"&&/^\.\.?\//.test(M)?M.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(G,V,K,X,v){return V?P?".jsx":".js":K&&(!X||!v)?G:K+X+"."+v.toLowerCase()+"js"}):M},k("__extends",t),k("__assign",n),k("__rest",r),k("__decorate",o),k("__param",s),k("__esDecorate",i),k("__runInitializers",a),k("__propKey",c),k("__setFunctionName",l),k("__metadata",f),k("__awaiter",d),k("__generator",u),k("__exportStar",_),k("__createBinding",$),k("__values",p),k("__read",E),k("__spread",T),k("__spreadArrays",h),k("__spreadArray",m),k("__await",A),k("__asyncGenerator",g),k("__asyncDelegator",R),k("__asyncValues",O),k("__makeTemplateObject",C),k("__importStar",I),k("__importDefault",L),k("__classPrivateFieldGet",U),k("__classPrivateFieldSet",q),k("__classPrivateFieldIn",H),k("__addDisposableResource",B),k("__disposeResources",F),k("__rewriteRelativeImportExtension",w)})})(K_)),K_.exports}var VQ=GQ();const xQ=Zp(VQ),{__extends:gT,__assign:cn,__rest:j8,__decorate:q8,__param:W8,__esDecorate:K8,__runInitializers:z8,__propKey:Z8,__setFunctionName:X8,__metadata:Q8,__awaiter:J8,__generator:e7,__exportStar:t7,__createBinding:n7,__values:r7,__read:o7,__spread:s7,__spreadArrays:i7,__spreadArray:J,__await:a7,__asyncGenerator:c7,__asyncDelegator:u7,__asyncValues:l7,__makeTemplateObject:d7,__importStar:f7,__importDefault:_7,__classPrivateFieldGet:p7,__classPrivateFieldSet:E7,__classPrivateFieldIn:T7,__addDisposableResource:h7,__disposeResources:S7,__rewriteRelativeImportExtension:m7}=xQ;var Jb=(function(e){gT(t,e);function t(n,r,o){var s=e.call(this,n,r)||this;return s.iterator=o,s}return t.prototype.add=function(n){return this.iterator(n,this._result.length)?(this._result.push(n),!0):!1},t})(Io),$u={dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],tokens:{SKIP:/^[ \r\n\t]+|^\.$/,number:/^[1-9][0-9]*/,numberAsText:/^(one|two|three)/i,every:/^every/i,"day(s)":/^days?/i,"weekday(s)":/^weekdays?/i,"week(s)":/^weeks?/i,"hour(s)":/^hours?/i,"minute(s)":/^minutes?/i,"month(s)":/^months?/i,"year(s)":/^years?/i,on:/^(on|in)/i,at:/^(at)/i,the:/^the/i,first:/^first/i,second:/^second/i,third:/^third/i,nth:/^([1-9][0-9]*)(\.|th|nd|rd|st)/i,last:/^last/i,for:/^for/i,"time(s)":/^times?/i,until:/^(un)?til/i,monday:/^mo(n(day)?)?/i,tuesday:/^tu(e(s(day)?)?)?/i,wednesday:/^we(d(n(esday)?)?)?/i,thursday:/^th(u(r(sday)?)?)?/i,friday:/^fr(i(day)?)?/i,saturday:/^sa(t(urday)?)?/i,sunday:/^su(n(day)?)?/i,january:/^jan(uary)?/i,february:/^feb(ruary)?/i,march:/^mar(ch)?/i,april:/^apr(il)?/i,may:/^may/i,june:/^june?/i,july:/^july?/i,august:/^aug(ust)?/i,september:/^sep(t(ember)?)?/i,october:/^oct(ober)?/i,november:/^nov(ember)?/i,december:/^dec(ember)?/i,comma:/^(,\s*|(and|or)\s*)+/i}},eI=function(e,t){return e.indexOf(t)!==-1},$Q=function(e){return e.toString()},BQ=function(e,t,n){return"".concat(t," ").concat(n,", ").concat(e)},Yn=(function(){function e(t,n,r,o){if(n===void 0&&(n=$Q),r===void 0&&(r=$u),o===void 0&&(o=BQ),this.text=[],this.language=r||$u,this.gettext=n,this.dateFormatter=o,this.rrule=t,this.options=t.options,this.origOptions=t.origOptions,this.origOptions.bymonthday){var s=[].concat(this.options.bymonthday),i=[].concat(this.options.bynmonthday);s.sort(function(f,d){return f-d}),i.sort(function(f,d){return d-f}),this.bymonthday=s.concat(i),this.bymonthday.length||(this.bymonthday=null)}if(ze(this.origOptions.byweekday)){var a=Ut(this.origOptions.byweekday)?this.origOptions.byweekday:[this.origOptions.byweekday],c=String(a);this.byweekday={allWeeks:a.filter(function(f){return!f.n}),someWeeks:a.filter(function(f){return!!f.n}),isWeekdays:c.indexOf("MO")!==-1&&c.indexOf("TU")!==-1&&c.indexOf("WE")!==-1&&c.indexOf("TH")!==-1&&c.indexOf("FR")!==-1&&c.indexOf("SA")===-1&&c.indexOf("SU")===-1,isEveryDay:c.indexOf("MO")!==-1&&c.indexOf("TU")!==-1&&c.indexOf("WE")!==-1&&c.indexOf("TH")!==-1&&c.indexOf("FR")!==-1&&c.indexOf("SA")!==-1&&c.indexOf("SU")!==-1};var l=function(f,d){return f.weekday-d.weekday};this.byweekday.allWeeks.sort(l),this.byweekday.someWeeks.sort(l),this.byweekday.allWeeks.length||(this.byweekday.allWeeks=null),this.byweekday.someWeeks.length||(this.byweekday.someWeeks=null)}else this.byweekday=null}return e.isFullyConvertible=function(t){var n=!0;if(!(t.options.freq in e.IMPLEMENTED)||t.origOptions.until&&t.origOptions.count)return!1;for(var r in t.origOptions){if(eI(["dtstart","tzid","wkst","freq"],r))return!0;if(!eI(e.IMPLEMENTED[t.options.freq],r))return!1}return n},e.prototype.isFullyConvertible=function(){return e.isFullyConvertible(this.rrule)},e.prototype.toString=function(){var t=this.gettext;if(!(this.options.freq in e.IMPLEMENTED))return t("RRule error: Unable to fully convert this rrule to text");if(this.text=[t("every")],this[pe.FREQUENCIES[this.options.freq]](),this.options.until){this.add(t("until"));var n=this.options.until;this.add(this.dateFormatter(n.getUTCFullYear(),this.language.monthNames[n.getUTCMonth()],n.getUTCDate()))}else this.options.count&&this.add(t("for")).add(this.options.count.toString()).add(this.plural(this.options.count)?t("times"):t("time"));return this.isFullyConvertible()||this.add(t("(~ approximate)")),this.text.join("")},e.prototype.HOURLY=function(){var t=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("hours"):t("hour"))},e.prototype.MINUTELY=function(){var t=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("minutes"):t("minute"))},e.prototype.DAILY=function(){var t=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.byweekday&&this.byweekday.isWeekdays?this.add(this.plural(this.options.interval)?t("weekdays"):t("weekday")):this.add(this.plural(this.options.interval)?t("days"):t("day")),this.origOptions.bymonth&&(this.add(t("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday?this._byweekday():this.origOptions.byhour&&this._byhour()},e.prototype.WEEKLY=function(){var t=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()).add(this.plural(this.options.interval)?t("weeks"):t("week")),this.byweekday&&this.byweekday.isWeekdays?this.options.interval===1?this.add(this.plural(this.options.interval)?t("weekdays"):t("weekday")):this.add(t("on")).add(t("weekdays")):this.byweekday&&this.byweekday.isEveryDay?this.add(this.plural(this.options.interval)?t("days"):t("day")):(this.options.interval===1&&this.add(t("week")),this.origOptions.bymonth&&(this.add(t("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.origOptions.byhour&&this._byhour())},e.prototype.MONTHLY=function(){var t=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()).add(t("months")),this.plural(this.options.interval)&&this.add(t("in"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("months"):t("month"))),this.bymonthday?this._bymonthday():this.byweekday&&this.byweekday.isWeekdays?this.add(t("on")).add(t("weekdays")):this.byweekday&&this._byweekday()},e.prototype.YEARLY=function(){var t=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()),this.add(t("years"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("years"):t("year"))),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.options.byyearday&&this.add(t("on the")).add(this.list(this.options.byyearday,this.nth,t("and"))).add(t("day")),this.options.byweekno&&this.add(t("in")).add(this.plural(this.options.byweekno.length)?t("weeks"):t("week")).add(this.list(this.options.byweekno,void 0,t("and")))},e.prototype._bymonthday=function(){var t=this.gettext;this.byweekday&&this.byweekday.allWeeks?this.add(t("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext,t("or"))).add(t("the")).add(this.list(this.bymonthday,this.nth,t("or"))):this.add(t("on the")).add(this.list(this.bymonthday,this.nth,t("and")))},e.prototype._byweekday=function(){var t=this.gettext;this.byweekday.allWeeks&&!this.byweekday.isWeekdays&&this.add(t("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext)),this.byweekday.someWeeks&&(this.byweekday.allWeeks&&this.add(t("and")),this.add(t("on the")).add(this.list(this.byweekday.someWeeks,this.weekdaytext,t("and"))))},e.prototype._byhour=function(){var t=this.gettext;this.add(t("at")).add(this.list(this.origOptions.byhour,void 0,t("and")))},e.prototype._bymonth=function(){this.add(this.list(this.options.bymonth,this.monthtext,this.gettext("and")))},e.prototype.nth=function(t){t=parseInt(t.toString(),10);var n,r=this.gettext;if(t===-1)return r("last");var o=Math.abs(t);switch(o){case 1:case 21:case 31:n=o+r("st");break;case 2:case 22:n=o+r("nd");break;case 3:case 23:n=o+r("rd");break;default:n=o+r("th")}return t<0?n+" "+r("last"):n},e.prototype.monthtext=function(t){return this.language.monthNames[t-1]},e.prototype.weekdaytext=function(t){var n=En(t)?(t+1)%7:t.getJsWeekday();return(t.n?this.nth(t.n)+" ":"")+this.language.dayNames[n]},e.prototype.plural=function(t){return t%100!==1},e.prototype.add=function(t){return this.text.push(" "),this.text.push(t),this},e.prototype.list=function(t,n,r,o){var s=this;o===void 0&&(o=","),Ut(t)||(t=[t]);var i=function(c,l,f){for(var d="",u=0;u<c.length;u++)u!==0&&(u===c.length-1?d+=" "+f+" ":d+=l+" "),d+=c[u];return d};n=n||function(c){return c.toString()};var a=function(c){return n&&n.call(s,c)};return r?i(t.map(a),o,r):t.map(a).join(o+" ")},e})(),HQ=(function(){function e(t){this.done=!0,this.rules=t}return e.prototype.start=function(t){return this.text=t,this.done=!1,this.nextSymbol()},e.prototype.isDone=function(){return this.done&&this.symbol===null},e.prototype.nextSymbol=function(){var t,n;this.symbol=null,this.value=null;do{if(this.done)return!1;var r=void 0;t=null;for(var o in this.rules){r=this.rules[o];var s=r.exec(this.text);s&&(t===null||s[0].length>t[0].length)&&(t=s,n=o)}if(t!=null&&(this.text=this.text.substr(t[0].length),this.text===""&&(this.done=!0)),t==null){this.done=!0,this.symbol=null,this.value=null;return}}while(n==="SKIP");return this.symbol=n,this.value=t,!0},e.prototype.accept=function(t){if(this.symbol===t){if(this.value){var n=this.value;return this.nextSymbol(),n}return this.nextSymbol(),!0}return!1},e.prototype.acceptNumber=function(){return this.accept("number")},e.prototype.expect=function(t){if(this.accept(t))return!0;throw new Error("expected "+t+" but found "+this.symbol)},e})();function UL(e,t){t===void 0&&(t=$u);var n={},r=new HQ(t.tokens);if(!r.start(e))return null;return o(),n;function o(){r.expect("every");var u=r.acceptNumber();if(u&&(n.interval=parseInt(u[0],10)),r.isDone())throw new Error("Unexpected end");switch(r.symbol){case"day(s)":n.freq=pe.DAILY,r.nextSymbol()&&(i(),d());break;case"weekday(s)":n.freq=pe.WEEKLY,n.byweekday=[pe.MO,pe.TU,pe.WE,pe.TH,pe.FR],r.nextSymbol(),i(),d();break;case"week(s)":n.freq=pe.WEEKLY,r.nextSymbol()&&(s(),i(),d());break;case"hour(s)":n.freq=pe.HOURLY,r.nextSymbol()&&(s(),d());break;case"minute(s)":n.freq=pe.MINUTELY,r.nextSymbol()&&(s(),d());break;case"month(s)":n.freq=pe.MONTHLY,r.nextSymbol()&&(s(),d());break;case"year(s)":n.freq=pe.YEARLY,r.nextSymbol()&&(s(),d());break;case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":n.freq=pe.WEEKLY;var _=r.symbol.substr(0,2).toUpperCase();if(n.byweekday=[pe[_]],!r.nextSymbol())return;for(;r.accept("comma");){if(r.isDone())throw new Error("Unexpected end");var p=c();if(!p)throw new Error("Unexpected symbol "+r.symbol+", expected weekday");n.byweekday.push(pe[p]),r.nextSymbol()}i(),f(),d();break;case"january":case"february":case"march":case"april":case"may":case"june":case"july":case"august":case"september":case"october":case"november":case"december":if(n.freq=pe.YEARLY,n.bymonth=[a()],!r.nextSymbol())return;for(;r.accept("comma");){if(r.isDone())throw new Error("Unexpected end");var E=a();if(!E)throw new Error("Unexpected symbol "+r.symbol+", expected month");n.bymonth.push(E),r.nextSymbol()}s(),d();break;default:throw new Error("Unknown symbol")}}function s(){var u=r.accept("on"),_=r.accept("the");if(u||_)do{var p=l(),E=c(),T=a();if(p)E?(r.nextSymbol(),n.byweekday||(n.byweekday=[]),n.byweekday.push(pe[E].nth(p))):(n.bymonthday||(n.bymonthday=[]),n.bymonthday.push(p),r.accept("day(s)"));else if(E)r.nextSymbol(),n.byweekday||(n.byweekday=[]),n.byweekday.push(pe[E]);else if(r.symbol==="weekday(s)")r.nextSymbol(),n.byweekday||(n.byweekday=[pe.MO,pe.TU,pe.WE,pe.TH,pe.FR]);else if(r.symbol==="week(s)"){r.nextSymbol();var h=r.acceptNumber();if(!h)throw new Error("Unexpected symbol "+r.symbol+", expected week number");for(n.byweekno=[parseInt(h[0],10)];r.accept("comma");){if(h=r.acceptNumber(),!h)throw new Error("Unexpected symbol "+r.symbol+"; expected monthday");n.byweekno.push(parseInt(h[0],10))}}else if(T)r.nextSymbol(),n.bymonth||(n.bymonth=[]),n.bymonth.push(T);else return}while(r.accept("comma")||r.accept("the")||r.accept("on"))}function i(){var u=r.accept("at");if(u)do{var _=r.acceptNumber();if(!_)throw new Error("Unexpected symbol "+r.symbol+", expected hour");for(n.byhour=[parseInt(_[0],10)];r.accept("comma");){if(_=r.acceptNumber(),!_)throw new Error("Unexpected symbol "+r.symbol+"; expected hour");n.byhour.push(parseInt(_[0],10))}}while(r.accept("comma")||r.accept("at"))}function a(){switch(r.symbol){case"january":return 1;case"february":return 2;case"march":return 3;case"april":return 4;case"may":return 5;case"june":return 6;case"july":return 7;case"august":return 8;case"september":return 9;case"october":return 10;case"november":return 11;case"december":return 12;default:return!1}}function c(){switch(r.symbol){case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":return r.symbol.substr(0,2).toUpperCase();default:return!1}}function l(){switch(r.symbol){case"last":return r.nextSymbol(),-1;case"first":return r.nextSymbol(),1;case"second":return r.nextSymbol(),r.accept("last")?-2:2;case"third":return r.nextSymbol(),r.accept("last")?-3:3;case"nth":var u=parseInt(r.value[1],10);if(u<-366||u>366)throw new Error("Nth out of range: "+u);return r.nextSymbol(),r.accept("last")?-u:u;default:return!1}}function f(){r.accept("on"),r.accept("the");var u=l();if(u)for(n.bymonthday=[u],r.nextSymbol();r.accept("comma");){if(u=l(),!u)throw new Error("Unexpected symbol "+r.symbol+"; expected monthday");n.bymonthday.push(u),r.nextSymbol()}}function d(){if(r.symbol==="until"){var u=Date.parse(r.text);if(!u)throw new Error("Cannot parse until date:"+r.text);n.until=new Date(u)}else r.accept("for")&&(n.count=parseInt(r.value[0],10),r.expect("number"))}}var Ie;(function(e){e[e.YEARLY=0]="YEARLY",e[e.MONTHLY=1]="MONTHLY",e[e.WEEKLY=2]="WEEKLY",e[e.DAILY=3]="DAILY",e[e.HOURLY=4]="HOURLY",e[e.MINUTELY=5]="MINUTELY",e[e.SECONDLY=6]="SECONDLY"})(Ie||(Ie={}));function RT(e){return e<Ie.HOURLY}var FQ=function(e,t){return t===void 0&&(t=$u),new pe(UL(e,t)||void 0)},ss=["count","until","interval","byweekday","bymonthday","bymonth"];Yn.IMPLEMENTED=[];Yn.IMPLEMENTED[Ie.HOURLY]=ss;Yn.IMPLEMENTED[Ie.MINUTELY]=ss;Yn.IMPLEMENTED[Ie.DAILY]=["byhour"].concat(ss);Yn.IMPLEMENTED[Ie.WEEKLY]=ss;Yn.IMPLEMENTED[Ie.MONTHLY]=ss;Yn.IMPLEMENTED[Ie.YEARLY]=["byweekno","byyearday"].concat(ss);var YQ=function(e,t,n,r){return new Yn(e,t,n,r).toString()},jQ=Yn.isFullyConvertible,Bu=(function(){function e(t,n,r,o){this.hour=t,this.minute=n,this.second=r,this.millisecond=o||0}return e.prototype.getHours=function(){return this.hour},e.prototype.getMinutes=function(){return this.minute},e.prototype.getSeconds=function(){return this.second},e.prototype.getMilliseconds=function(){return this.millisecond},e.prototype.getTime=function(){return(this.hour*60*60+this.minute*60+this.second)*1e3+this.millisecond},e})(),qQ=(function(e){gT(t,e);function t(n,r,o,s,i,a,c){var l=e.call(this,s,i,a,c)||this;return l.year=n,l.month=r,l.day=o,l}return t.fromDate=function(n){return new this(n.getUTCFullYear(),n.getUTCMonth()+1,n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),n.valueOf()%1e3)},t.prototype.getWeekday=function(){return Fo(new Date(this.getTime()))},t.prototype.getTime=function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond)).getTime()},t.prototype.getDay=function(){return this.day},t.prototype.getMonth=function(){return this.month},t.prototype.getYear=function(){return this.year},t.prototype.addYears=function(n){this.year+=n},t.prototype.addMonths=function(n){if(this.month+=n,this.month>12){var r=Math.floor(this.month/12),o=Bt(this.month,12);this.month=o,this.year+=r,this.month===0&&(this.month=12,--this.year)}},t.prototype.addWeekly=function(n,r){r>this.getWeekday()?this.day+=-(this.getWeekday()+1+(6-r))+n*7:this.day+=-(this.getWeekday()-r)+n*7,this.fixDay()},t.prototype.addDaily=function(n){this.day+=n,this.fixDay()},t.prototype.addHours=function(n,r,o){for(r&&(this.hour+=Math.floor((23-this.hour)/n)*n);;){this.hour+=n;var s=W_(this.hour,24),i=s.div,a=s.mod;if(i&&(this.hour=a,this.addDaily(i)),Sn(o)||we(o,this.hour))break}},t.prototype.addMinutes=function(n,r,o,s){for(r&&(this.minute+=Math.floor((1439-(this.hour*60+this.minute))/n)*n);;){this.minute+=n;var i=W_(this.minute,60),a=i.div,c=i.mod;if(a&&(this.minute=c,this.addHours(a,!1,o)),(Sn(o)||we(o,this.hour))&&(Sn(s)||we(s,this.minute)))break}},t.prototype.addSeconds=function(n,r,o,s,i){for(r&&(this.second+=Math.floor((86399-(this.hour*3600+this.minute*60+this.second))/n)*n);;){this.second+=n;var a=W_(this.second,60),c=a.div,l=a.mod;if(c&&(this.second=l,this.addMinutes(c,!1,o,s)),(Sn(o)||we(o,this.hour))&&(Sn(s)||we(s,this.minute))&&(Sn(i)||we(i,this.second)))break}},t.prototype.fixDay=function(){if(!(this.day<=28)){var n=zb(this.year,this.month-1)[1];if(!(this.day<=n))for(;this.day>n;){if(this.day-=n,++this.month,this.month===13&&(this.month=1,++this.year,this.year>PL))return;n=zb(this.year,this.month-1)[1]}}},t.prototype.add=function(n,r){var o=n.freq,s=n.interval,i=n.wkst,a=n.byhour,c=n.byminute,l=n.bysecond;switch(o){case Ie.YEARLY:return this.addYears(s);case Ie.MONTHLY:return this.addMonths(s);case Ie.WEEKLY:return this.addWeekly(s,i);case Ie.DAILY:return this.addDaily(s);case Ie.HOURLY:return this.addHours(s,r,a);case Ie.MINUTELY:return this.addMinutes(s,r,a,c);case Ie.SECONDLY:return this.addSeconds(s,r,a,c,l)}},t})(Bu);function kL(e){for(var t=[],n=Object.keys(e),r=0,o=n;r<o.length;r++){var s=o[r];we(R5,s)||t.push(s),LL(e[s])&&!qa(e[s])&&t.push(s)}if(t.length)throw new Error("Invalid options: "+t.join(", "));return cn({},e)}function WQ(e){var t=cn(cn({},NT),kL(e));if(ze(t.byeaster)&&(t.freq=pe.YEARLY),!(ze(t.freq)&&pe.FREQUENCIES[t.freq]))throw new Error("Invalid frequency: ".concat(t.freq," ").concat(e.freq));if(t.dtstart||(t.dtstart=new Date(new Date().setMilliseconds(0))),ze(t.wkst)?En(t.wkst)||(t.wkst=t.wkst.weekday):t.wkst=pe.MO.weekday,ze(t.bysetpos)){En(t.bysetpos)&&(t.bysetpos=[t.bysetpos]);for(var n=0;n<t.bysetpos.length;n++){var r=t.bysetpos[n];if(r===0||!(r>=-366&&r<=366))throw new Error("bysetpos must be between 1 and 366, or between -366 and -1")}}if(!(t.byweekno||rt(t.byweekno)||rt(t.byyearday)||t.bymonthday||rt(t.bymonthday)||ze(t.byweekday)||ze(t.byeaster)))switch(t.freq){case pe.YEARLY:t.bymonth||(t.bymonth=t.dtstart.getUTCMonth()+1),t.bymonthday=t.dtstart.getUTCDate();break;case pe.MONTHLY:t.bymonthday=t.dtstart.getUTCDate();break;case pe.WEEKLY:t.byweekday=[Fo(t.dtstart)];break}if(ze(t.bymonth)&&!Ut(t.bymonth)&&(t.bymonth=[t.bymonth]),ze(t.byyearday)&&!Ut(t.byyearday)&&En(t.byyearday)&&(t.byyearday=[t.byyearday]),!ze(t.bymonthday))t.bymonthday=[],t.bynmonthday=[];else if(Ut(t.bymonthday)){for(var o=[],s=[],n=0;n<t.bymonthday.length;n++){var r=t.bymonthday[n];r>0?o.push(r):r<0&&s.push(r)}t.bymonthday=o,t.bynmonthday=s}else t.bymonthday<0?(t.bynmonthday=[t.bymonthday],t.bymonthday=[]):(t.bynmonthday=[],t.bymonthday=[t.bymonthday]);if(ze(t.byweekno)&&!Ut(t.byweekno)&&(t.byweekno=[t.byweekno]),!ze(t.byweekday))t.bynweekday=null;else if(En(t.byweekday))t.byweekday=[t.byweekday],t.bynweekday=null;else if(Kb(t.byweekday))t.byweekday=[At.fromStr(t.byweekday).weekday],t.bynweekday=null;else if(t.byweekday instanceof At)!t.byweekday.n||t.freq>pe.MONTHLY?(t.byweekday=[t.byweekday.weekday],t.bynweekday=null):(t.bynweekday=[[t.byweekday.weekday,t.byweekday.n]],t.byweekday=null);else{for(var i=[],a=[],n=0;n<t.byweekday.length;n++){var c=t.byweekday[n];if(En(c)){i.push(c);continue}else if(Kb(c)){i.push(At.fromStr(c).weekday);continue}!c.n||t.freq>pe.MONTHLY?i.push(c.weekday):a.push([c.weekday,c.n])}t.byweekday=rt(i)?i:null,t.bynweekday=rt(a)?a:null}return ze(t.byhour)?En(t.byhour)&&(t.byhour=[t.byhour]):t.byhour=t.freq<pe.HOURLY?[t.dtstart.getUTCHours()]:null,ze(t.byminute)?En(t.byminute)&&(t.byminute=[t.byminute]):t.byminute=t.freq<pe.MINUTELY?[t.dtstart.getUTCMinutes()]:null,ze(t.bysecond)?En(t.bysecond)&&(t.bysecond=[t.bysecond]):t.bysecond=t.freq<pe.SECONDLY?[t.dtstart.getUTCSeconds()]:null,{parsedOptions:t}}function KQ(e){var t=e.dtstart.getTime()%1e3;if(!RT(e.freq))return[];var n=[];return e.byhour.forEach(function(r){e.byminute.forEach(function(o){e.bysecond.forEach(function(s){n.push(new Bu(r,o,s,t))})})}),n}function Bp(e){var t=e.split(`
`).map(zQ).filter(function(n){return n!==null});return cn(cn({},t[0]),t[1])}function Hu(e){var t={},n=/DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\s]+)/i.exec(e);if(!n)return t;var r=n[1],o=n[2];return r&&(t.tzid=r),t.dtstart=AT(o),t}function zQ(e){if(e=e.replace(/^\s+|\s+$/,""),!e.length)return null;var t=/^([A-Z]+?)[:;]/.exec(e.toUpperCase());if(!t)return tI(e);var n=t[1];switch(n.toUpperCase()){case"RRULE":case"EXRULE":return tI(e);case"DTSTART":return Hu(e);default:throw new Error("Unsupported RFC prop ".concat(n," in ").concat(e))}}function tI(e){var t=e.replace(/^RRULE:/i,""),n=Hu(t),r=e.replace(/^(?:RRULE|EXRULE):/i,"").split(";");return r.forEach(function(o){var s=o.split("="),i=s[0],a=s[1];switch(i.toUpperCase()){case"FREQ":n.freq=Ie[a.toUpperCase()];break;case"WKST":n.wkst=nn[a.toUpperCase()];break;case"COUNT":case"INTERVAL":case"BYSETPOS":case"BYMONTH":case"BYMONTHDAY":case"BYYEARDAY":case"BYWEEKNO":case"BYHOUR":case"BYMINUTE":case"BYSECOND":var c=ZQ(a),l=i.toLowerCase();n[l]=c;break;case"BYWEEKDAY":case"BYDAY":n.byweekday=XQ(a);break;case"DTSTART":case"TZID":var f=Hu(e);n.tzid=f.tzid,n.dtstart=f.dtstart;break;case"UNTIL":n.until=AT(a);break;case"BYEASTER":n.byeaster=Number(a);break;default:throw new Error("Unknown RRULE property '"+i+"'")}}),n}function ZQ(e){if(e.indexOf(",")!==-1){var t=e.split(",");return t.map(nI)}return nI(e)}function nI(e){return/^[+-]?\d+$/.test(e)?Number(e):e}function XQ(e){var t=e.split(",");return t.map(function(n){if(n.length===2)return nn[n];var r=n.match(/^([+-]?\d{1,2})([A-Z]{2})$/);if(!r||r.length<3)throw new SyntaxError("Invalid weekday string: ".concat(n));var o=Number(r[1]),s=r[2],i=nn[s].weekday;return new At(i,o)})}var Fu=(function(){function e(t,n){if(isNaN(t.getTime()))throw new RangeError("Invalid date passed to DateWithZone");this.date=t,this.tzid=n}return Object.defineProperty(e.prototype,"isUTC",{get:function(){return!this.tzid||this.tzid.toUpperCase()==="UTC"},enumerable:!1,configurable:!0}),e.prototype.toString=function(){var t=mT(this.date.getTime(),this.isUTC);return this.isUTC?":".concat(t):";TZID=".concat(this.tzid,":").concat(t)},e.prototype.getTime=function(){return this.date.getTime()},e.prototype.rezonedDate=function(){return this.isUTC?this.date:kQ(this.date,this.tzid)},e})();function Hp(e){for(var t=[],n="",r=Object.keys(e),o=Object.keys(NT),s=0;s<r.length;s++)if(r[s]!=="tzid"&&we(o,r[s])){var i=r[s].toUpperCase(),a=e[r[s]],c="";if(!(!ze(a)||Ut(a)&&!a.length)){switch(i){case"FREQ":c=pe.FREQUENCIES[e.freq];break;case"WKST":En(a)?c=new At(a).toString():c=a.toString();break;case"BYWEEKDAY":i="BYDAY",c=PQ(a).map(function(_){return _ instanceof At?_:Ut(_)?new At(_[0],_[1]):new At(_)}).toString();break;case"DTSTART":n=QQ(a,e.tzid);break;case"UNTIL":c=mT(a,!e.tzid);break;default:if(Ut(a)){for(var l=[],f=0;f<a.length;f++)l[f]=String(a[f]);c=l.toString()}else c=String(a)}c&&t.push([i,c])}}var d=t.map(function(_){var p=_[0],E=_[1];return"".concat(p,"=").concat(E.toString())}).join(";"),u="";return d!==""&&(u="RRULE:".concat(d)),[n,u].filter(function(_){return!!_}).join(`
`)}function QQ(e,t){return e?"DTSTART"+new Fu(new Date(e),t).toString():""}function JQ(e,t){return Array.isArray(e)?!Array.isArray(t)||e.length!==t.length?!1:e.every(function(n,r){return n.getTime()===t[r].getTime()}):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():e===t}var e5=(function(){function e(){this.all=!1,this.before=[],this.after=[],this.between=[]}return e.prototype._cacheAdd=function(t,n,r){n&&(n=n instanceof Date?$p(n):Zb(n)),t==="all"?this.all=n:(r._value=n,this[t].push(r))},e.prototype._cacheGet=function(t,n){var r=!1,o=n?Object.keys(n):[],s=function(f){for(var d=0;d<o.length;d++){var u=o[d];if(!JQ(n[u],f[u]))return!0}return!1},i=this[t];if(t==="all")r=this.all;else if(Ut(i))for(var a=0;a<i.length;a++){var c=i[a];if(!(o.length&&s(c))){r=c._value;break}}if(!r&&this.all){for(var l=new Io(t,n),a=0;a<this.all.length&&l.accept(this.all[a]);a++);r=l.getValue(),this._cacheAdd(t,r,n)}return Ut(r)?Zb(r):r instanceof Date?$p(r):r},e})(),t5=J(J(J(J(J(J(J(J(J(J(J(J(J([],be(1,31),!0),be(2,28),!0),be(3,31),!0),be(4,30),!0),be(5,31),!0),be(6,30),!0),be(7,31),!0),be(8,31),!0),be(9,30),!0),be(10,31),!0),be(11,30),!0),be(12,31),!0),be(1,7),!0),n5=J(J(J(J(J(J(J(J(J(J(J(J(J([],be(1,31),!0),be(2,29),!0),be(3,31),!0),be(4,30),!0),be(5,31),!0),be(6,30),!0),be(7,31),!0),be(8,31),!0),be(9,30),!0),be(10,31),!0),be(11,30),!0),be(12,31),!0),be(1,7),!0),r5=On(1,29),o5=On(1,30),Xn=On(1,31),ct=On(1,32),s5=J(J(J(J(J(J(J(J(J(J(J(J(J([],ct,!0),o5,!0),ct,!0),Xn,!0),ct,!0),Xn,!0),ct,!0),ct,!0),Xn,!0),ct,!0),Xn,!0),ct,!0),ct.slice(0,7),!0),i5=J(J(J(J(J(J(J(J(J(J(J(J(J([],ct,!0),r5,!0),ct,!0),Xn,!0),ct,!0),Xn,!0),ct,!0),ct,!0),Xn,!0),ct,!0),Xn,!0),ct,!0),ct.slice(0,7),!0),a5=On(-28,0),c5=On(-29,0),Qn=On(-30,0),ut=On(-31,0),u5=J(J(J(J(J(J(J(J(J(J(J(J(J([],ut,!0),c5,!0),ut,!0),Qn,!0),ut,!0),Qn,!0),ut,!0),ut,!0),Qn,!0),ut,!0),Qn,!0),ut,!0),ut.slice(0,7),!0),l5=J(J(J(J(J(J(J(J(J(J(J(J(J([],ut,!0),a5,!0),ut,!0),Qn,!0),ut,!0),Qn,!0),ut,!0),ut,!0),Qn,!0),ut,!0),Qn,!0),ut,!0),ut.slice(0,7),!0),d5=[0,31,60,91,121,152,182,213,244,274,305,335,366],f5=[0,31,59,90,120,151,181,212,243,273,304,334,365],rI=(function(){for(var e=[],t=0;t<55;t++)e=e.concat(On(7));return e})();function _5(e,t){var n=co(e,1,1),r=Qa(e)?366:365,o=Qa(e+1)?366:365,s=xp(n),i=Fo(n),a=cn(cn({yearlen:r,nextyearlen:o,yearordinal:s,yearweekday:i},p5(e)),{wnomask:null});if(Sn(t.byweekno))return a;a.wnomask=be(0,r+7);var c,l,f=c=Bt(7-i+t.wkst,7);f>=4?(f=0,l=a.yearlen+Bt(i-t.wkst,7)):l=r-f;for(var d=Math.floor(l/7),u=Bt(l,7),_=Math.floor(d+u/4),p=0;p<t.byweekno.length;p++){var E=t.byweekno[p];if(E<0&&(E+=_+1),E>0&&E<=_){var T=void 0;E>1?(T=f+(E-1)*7,f!==c&&(T-=7-c)):T=f;for(var h=0;h<7&&(a.wnomask[T]=1,T++,a.wdaymask[T]!==t.wkst);h++);}}if(we(t.byweekno,1)){var T=f+_*7;if(f!==c&&(T-=7-c),T<r)for(var p=0;p<7&&(a.wnomask[T]=1,T+=1,a.wdaymask[T]!==t.wkst);p++);}if(f){var m=void 0;if(we(t.byweekno,-1))m=-1;else{var A=Fo(co(e-1,1,1)),g=Bt(7-A.valueOf()+t.wkst,7),R=Qa(e-1)?366:365,O=void 0;g>=4?(g=0,O=R+Bt(A-t.wkst,7)):O=r-f,m=Math.floor(52+Bt(O,7)/4)}if(we(t.byweekno,m))for(var T=0;T<f;T++)a.wnomask[T]=1}return a}function p5(e){var t=Qa(e)?366:365,n=co(e,1,1),r=Fo(n);return t===365?{mmask:t5,mdaymask:i5,nmdaymask:l5,wdaymask:rI.slice(r),mrange:f5}:{mmask:n5,mdaymask:s5,nmdaymask:u5,wdaymask:rI.slice(r),mrange:d5}}function E5(e,t,n,r,o,s){var i={lastyear:e,lastmonth:t,nwdaymask:[]},a=[];if(s.freq===pe.YEARLY)if(Sn(s.bymonth))a=[[0,n]];else for(var c=0;c<s.bymonth.length;c++)t=s.bymonth[c],a.push(r.slice(t-1,t+1));else s.freq===pe.MONTHLY&&(a=[r.slice(t-1,t+1)]);if(Sn(a))return i;i.nwdaymask=be(0,n);for(var c=0;c<a.length;c++)for(var l=a[c],f=l[0],d=l[1]-1,u=0;u<s.bynweekday.length;u++){var _=void 0,p=s.bynweekday[u],E=p[0],T=p[1];T<0?(_=d+(T+1)*7,_-=Bt(o[_]-E,7)):(_=f+(T-1)*7,_+=Bt(7-o[_]+E,7)),f<=_&&_<=d&&(i.nwdaymask[_]=1)}return i}function T5(e,t){t===void 0&&(t=0);var n=e%19,r=Math.floor(e/100),o=e%100,s=Math.floor(r/4),i=r%4,a=Math.floor((r+8)/25),c=Math.floor((r-a+1)/3),l=Math.floor(19*n+r-s-c+15)%30,f=Math.floor(o/4),d=o%4,u=Math.floor(32+2*i+2*f-l-d)%7,_=Math.floor((n+11*l+22*u)/451),p=Math.floor((l+u-7*_+114)/31),E=(l+u-7*_+114)%31+1,T=Date.UTC(e,p-1,E+t),h=Date.UTC(e,0,1);return[Math.ceil((T-h)/(1e3*60*60*24))]}var h5=(function(){function e(t){this.options=t}return e.prototype.rebuild=function(t,n){var r=this.options;if(t!==this.lastyear&&(this.yearinfo=_5(t,r)),rt(r.bynweekday)&&(n!==this.lastmonth||t!==this.lastyear)){var o=this.yearinfo,s=o.yearlen,i=o.mrange,a=o.wdaymask;this.monthinfo=E5(t,n,s,i,a,r)}ze(r.byeaster)&&(this.eastermask=T5(t,r.byeaster))},Object.defineProperty(e.prototype,"lastyear",{get:function(){return this.monthinfo?this.monthinfo.lastyear:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastmonth",{get:function(){return this.monthinfo?this.monthinfo.lastmonth:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yearlen",{get:function(){return this.yearinfo.yearlen},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yearordinal",{get:function(){return this.yearinfo.yearordinal},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mrange",{get:function(){return this.yearinfo.mrange},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wdaymask",{get:function(){return this.yearinfo.wdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mmask",{get:function(){return this.yearinfo.mmask},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wnomask",{get:function(){return this.yearinfo.wnomask},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nwdaymask",{get:function(){return this.monthinfo?this.monthinfo.nwdaymask:[]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextyearlen",{get:function(){return this.yearinfo.nextyearlen},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mdaymask",{get:function(){return this.yearinfo.mdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nmdaymask",{get:function(){return this.yearinfo.nmdaymask},enumerable:!1,configurable:!0}),e.prototype.ydayset=function(){return[On(this.yearlen),0,this.yearlen]},e.prototype.mdayset=function(t,n){for(var r=this.mrange[n-1],o=this.mrange[n],s=be(null,this.yearlen),i=r;i<o;i++)s[i]=i;return[s,r,o]},e.prototype.wdayset=function(t,n,r){for(var o=be(null,this.yearlen+7),s=xp(co(t,n,r))-this.yearordinal,i=s,a=0;a<7&&(o[s]=s,++s,this.wdaymask[s]!==this.options.wkst);a++);return[o,i,s]},e.prototype.ddayset=function(t,n,r){var o=be(null,this.yearlen),s=xp(co(t,n,r))-this.yearordinal;return o[s]=s,[o,s,s+1]},e.prototype.htimeset=function(t,n,r,o){var s=this,i=[];return this.options.byminute.forEach(function(a){i=i.concat(s.mtimeset(t,a,r,o))}),fc(i),i},e.prototype.mtimeset=function(t,n,r,o){var s=this.options.bysecond.map(function(i){return new Bu(t,n,i,o)});return fc(s),s},e.prototype.stimeset=function(t,n,r,o){return[new Bu(t,n,r,o)]},e.prototype.getdayset=function(t){switch(t){case Ie.YEARLY:return this.ydayset.bind(this);case Ie.MONTHLY:return this.mdayset.bind(this);case Ie.WEEKLY:return this.wdayset.bind(this);case Ie.DAILY:return this.ddayset.bind(this);default:return this.ddayset.bind(this)}},e.prototype.gettimeset=function(t){switch(t){case Ie.HOURLY:return this.htimeset.bind(this);case Ie.MINUTELY:return this.mtimeset.bind(this);case Ie.SECONDLY:return this.stimeset.bind(this)}},e})();function S5(e,t,n,r,o,s){for(var i=[],a=0;a<e.length;a++){var c=void 0,l=void 0,f=e[a];f<0?(c=Math.floor(f/t.length),l=Bt(f,t.length)):(c=Math.floor((f-1)/t.length),l=Bt(f-1,t.length));for(var d=[],u=n;u<r;u++){var _=s[u];ze(_)&&d.push(_)}var p=void 0;c<0?p=d.slice(c)[0]:p=d[c];var E=t[l],T=DL(o.yearordinal+p),h=wL(T,E);we(i,h)||i.push(h)}return fc(i),i}function GL(e,t){var n=t.dtstart,r=t.freq,o=t.interval,s=t.until,i=t.bysetpos,a=t.count;if(a===0||o===0)return Dn(e);var c=qQ.fromDate(n),l=new h5(t);l.rebuild(c.year,c.month);for(var f=g5(l,c,t);;){var d=l.getdayset(r)(c.year,c.month,c.day),u=d[0],_=d[1],p=d[2],E=A5(u,_,p,l,t);if(rt(i))for(var T=S5(i,f,_,p,l,u),h=0;h<T.length;h++){var m=T[h];if(s&&m>s)return Dn(e);if(m>=n){var A=oI(m,t);if(!e.accept(A)||a&&(--a,!a))return Dn(e)}}else for(var h=_;h<p;h++){var g=u[h];if(ze(g))for(var R=DL(l.yearordinal+g),O=0;O<f.length;O++){var C=f[O],m=wL(R,C);if(s&&m>s)return Dn(e);if(m>=n){var A=oI(m,t);if(!e.accept(A)||a&&(--a,!a))return Dn(e)}}}if(t.interval===0||(c.add(t,E),c.year>PL))return Dn(e);RT(r)||(f=l.gettimeset(r)(c.hour,c.minute,c.second,0)),l.rebuild(c.year,c.month)}}function m5(e,t,n){var r=n.bymonth,o=n.byweekno,s=n.byweekday,i=n.byeaster,a=n.bymonthday,c=n.bynmonthday,l=n.byyearday;return rt(r)&&!we(r,e.mmask[t])||rt(o)&&!e.wnomask[t]||rt(s)&&!we(s,e.wdaymask[t])||rt(e.nwdaymask)&&!e.nwdaymask[t]||i!==null&&!we(e.eastermask,t)||(rt(a)||rt(c))&&!we(a,e.mdaymask[t])&&!we(c,e.nmdaymask[t])||rt(l)&&(t<e.yearlen&&!we(l,t+1)&&!we(l,-e.yearlen+t)||t>=e.yearlen&&!we(l,t+1-e.yearlen)&&!we(l,-e.nextyearlen+t-e.yearlen))}function oI(e,t){return new Fu(e,t.tzid).rezonedDate()}function Dn(e){return e.getValue()}function A5(e,t,n,r,o){for(var s=!1,i=t;i<n;i++){var a=e[i];s=m5(r,a,o),s&&(e[a]=null)}return s}function g5(e,t,n){var r=n.freq,o=n.byhour,s=n.byminute,i=n.bysecond;return RT(r)?KQ(n):r>=pe.HOURLY&&rt(o)&&!we(o,t.hour)||r>=pe.MINUTELY&&rt(s)&&!we(s,t.minute)||r>=pe.SECONDLY&&rt(i)&&!we(i,t.second)?[]:e.gettimeset(r)(t.hour,t.minute,t.second,t.millisecond)}var nn={MO:new At(0),TU:new At(1),WE:new At(2),TH:new At(3),FR:new At(4),SA:new At(5),SU:new At(6)},NT={freq:Ie.YEARLY,dtstart:null,interval:1,wkst:nn.MO,count:null,until:null,tzid:null,bysetpos:null,bymonth:null,bymonthday:null,bynmonthday:null,byyearday:null,byweekno:null,byweekday:null,bynweekday:null,byhour:null,byminute:null,bysecond:null,byeaster:null},R5=Object.keys(NT),pe=(function(){function e(t,n){t===void 0&&(t={}),n===void 0&&(n=!1),this._cache=n?null:new e5,this.origOptions=kL(t);var r=WQ(t).parsedOptions;this.options=r}return e.parseText=function(t,n){return UL(t,n)},e.fromText=function(t,n){return FQ(t,n)},e.fromString=function(t){return new e(e.parseString(t)||void 0)},e.prototype._iter=function(t){return GL(t,this.options)},e.prototype._cacheGet=function(t,n){return this._cache?this._cache._cacheGet(t,n):!1},e.prototype._cacheAdd=function(t,n,r){if(this._cache)return this._cache._cacheAdd(t,n,r)},e.prototype.all=function(t){if(t)return this._iter(new Jb("all",{},t));var n=this._cacheGet("all");return n===!1&&(n=this._iter(new Io("all",{})),this._cacheAdd("all",n)),n},e.prototype.between=function(t,n,r,o){if(r===void 0&&(r=!1),!qa(t)||!qa(n))throw new Error("Invalid date passed in to RRule.between");var s={before:n,after:t,inc:r};if(o)return this._iter(new Jb("between",s,o));var i=this._cacheGet("between",s);return i===!1&&(i=this._iter(new Io("between",s)),this._cacheAdd("between",i,s)),i},e.prototype.before=function(t,n){if(n===void 0&&(n=!1),!qa(t))throw new Error("Invalid date passed in to RRule.before");var r={dt:t,inc:n},o=this._cacheGet("before",r);return o===!1&&(o=this._iter(new Io("before",r)),this._cacheAdd("before",o,r)),o},e.prototype.after=function(t,n){if(n===void 0&&(n=!1),!qa(t))throw new Error("Invalid date passed in to RRule.after");var r={dt:t,inc:n},o=this._cacheGet("after",r);return o===!1&&(o=this._iter(new Io("after",r)),this._cacheAdd("after",o,r)),o},e.prototype.count=function(){return this.all().length},e.prototype.toString=function(){return Hp(this.origOptions)},e.prototype.toText=function(t,n,r){return YQ(this,t,n,r)},e.prototype.isFullyConvertibleToText=function(){return jQ(this)},e.prototype.clone=function(){return new e(this.origOptions)},e.FREQUENCIES=["YEARLY","MONTHLY","WEEKLY","DAILY","HOURLY","MINUTELY","SECONDLY"],e.YEARLY=Ie.YEARLY,e.MONTHLY=Ie.MONTHLY,e.WEEKLY=Ie.WEEKLY,e.DAILY=Ie.DAILY,e.HOURLY=Ie.HOURLY,e.MINUTELY=Ie.MINUTELY,e.SECONDLY=Ie.SECONDLY,e.MO=nn.MO,e.TU=nn.TU,e.WE=nn.WE,e.TH=nn.TH,e.FR=nn.FR,e.SA=nn.SA,e.SU=nn.SU,e.parseString=Bp,e.optionsToString=Hp,e})();function N5(e,t,n,r,o,s){var i={},a=e.accept;function c(u,_){n.forEach(function(p){p.between(u,_,!0).forEach(function(E){i[Number(E)]=!0})})}o.forEach(function(u){var _=new Fu(u,s).rezonedDate();i[Number(_)]=!0}),e.accept=function(u){var _=Number(u);return isNaN(_)?a.call(this,u):!i[_]&&(c(new Date(_-1),new Date(_+1)),!i[_])?(i[_]=!0,a.call(this,u)):!0},e.method==="between"&&(c(e.args.after,e.args.before),e.accept=function(u){var _=Number(u);return i[_]?!0:(i[_]=!0,a.call(this,u))});for(var l=0;l<r.length;l++){var f=new Fu(r[l],s).rezonedDate();if(!e.accept(new Date(f.getTime())))break}t.forEach(function(u){GL(e,u.options)});var d=e._result;switch(fc(d),e.method){case"all":case"between":return d;case"before":return d.length&&d[d.length-1]||null;case"after":default:return d.length&&d[0]||null}}var sI={dtstart:null,cache:!1,unfold:!1,forceset:!1,compatible:!1,tzid:null};function y5(e,t){var n=[],r=[],o=[],s=[],i=Hu(e),a=i.dtstart,c=i.tzid,l=M5(e,t.unfold);return l.forEach(function(f){var d;if(f){var u=C5(f),_=u.name,p=u.parms,E=u.value;switch(_.toUpperCase()){case"RRULE":if(p.length)throw new Error("unsupported RRULE parm: ".concat(p.join(",")));n.push(Bp(f));break;case"RDATE":var T=(d=/RDATE(?:;TZID=([^:=]+))?/i.exec(f))!==null&&d!==void 0?d:[],h=T[1];h&&!c&&(c=h),r=r.concat(aI(E,p));break;case"EXRULE":if(p.length)throw new Error("unsupported EXRULE parm: ".concat(p.join(",")));o.push(Bp(E));break;case"EXDATE":s=s.concat(aI(E,p));break;case"DTSTART":break;default:throw new Error("unsupported property: "+_)}}}),{dtstart:a,tzid:c,rrulevals:n,rdatevals:r,exrulevals:o,exdatevals:s}}function O5(e,t){var n=y5(e,t),r=n.rrulevals,o=n.rdatevals,s=n.exrulevals,i=n.exdatevals,a=n.dtstart,c=n.tzid,l=t.cache===!1;if(t.compatible&&(t.forceset=!0,t.unfold=!0),t.forceset||r.length>1||o.length||s.length||i.length){var f=new v5(l);return f.dtstart(a),f.tzid(c||void 0),r.forEach(function(u){f.rrule(new pe(z_(u,a,c),l))}),o.forEach(function(u){f.rdate(u)}),s.forEach(function(u){f.exrule(new pe(z_(u,a,c),l))}),i.forEach(function(u){f.exdate(u)}),t.compatible&&t.dtstart&&f.rdate(a),f}var d=r[0]||{};return new pe(z_(d,d.dtstart||t.dtstart||a,d.tzid||t.tzid||c),l)}function iI(e,t){return t===void 0&&(t={}),O5(e,b5(t))}function z_(e,t,n){return cn(cn({},e),{dtstart:t,tzid:n})}function b5(e){var t=[],n=Object.keys(e),r=Object.keys(sI);if(n.forEach(function(o){we(r,o)||t.push(o)}),t.length)throw new Error("Invalid options: "+t.join(", "));return cn(cn({},sI),e)}function I5(e){if(e.indexOf(":")===-1)return{name:"RRULE",value:e};var t=vQ(e,":",1),n=t[0],r=t[1];return{name:n,value:r}}function C5(e){var t=I5(e),n=t.name,r=t.value,o=n.split(";");if(!o)throw new Error("empty property name");return{name:o[0].toUpperCase(),parms:o.slice(1),value:r}}function M5(e,t){if(t===void 0&&(t=!1),e=e&&e.trim(),!e)throw new Error("Invalid empty string");if(!t)return e.split(/\s/);for(var n=e.split(`
`),r=0;r<n.length;){var o=n[r]=n[r].replace(/\s+$/g,"");o?r>0&&o[0]===" "?(n[r-1]+=o.slice(1),n.splice(r,1)):r+=1:n.splice(r,1)}return n}function P5(e){e.forEach(function(t){if(!/(VALUE=DATE(-TIME)?)|(TZID=)/.test(t))throw new Error("unsupported RDATE/EXDATE parm: "+t)})}function aI(e,t){return P5(t),e.split(",").map(function(n){return AT(n)})}function cI(e){var t=this;return function(n){if(n!==void 0&&(t["_".concat(e)]=n),t["_".concat(e)]!==void 0)return t["_".concat(e)];for(var r=0;r<t._rrule.length;r++){var o=t._rrule[r].origOptions[e];if(o)return o}}}var v5=(function(e){gT(t,e);function t(n){n===void 0&&(n=!1);var r=e.call(this,{},n)||this;return r.dtstart=cI.apply(r,["dtstart"]),r.tzid=cI.apply(r,["tzid"]),r._rrule=[],r._rdate=[],r._exrule=[],r._exdate=[],r}return t.prototype._iter=function(n){return N5(n,this._rrule,this._exrule,this._rdate,this._exdate,this.tzid())},t.prototype.rrule=function(n){uI(n,this._rrule)},t.prototype.exrule=function(n){uI(n,this._exrule)},t.prototype.rdate=function(n){lI(n,this._rdate)},t.prototype.exdate=function(n){lI(n,this._exdate)},t.prototype.rrules=function(){return this._rrule.map(function(n){return iI(n.toString())})},t.prototype.exrules=function(){return this._exrule.map(function(n){return iI(n.toString())})},t.prototype.rdates=function(){return this._rdate.map(function(n){return new Date(n.getTime())})},t.prototype.exdates=function(){return this._exdate.map(function(n){return new Date(n.getTime())})},t.prototype.valueOf=function(){var n=[];return!this._rrule.length&&this._dtstart&&(n=n.concat(Hp({dtstart:this._dtstart}))),this._rrule.forEach(function(r){n=n.concat(r.toString().split(`
`))}),this._exrule.forEach(function(r){n=n.concat(r.toString().split(`
`).map(function(o){return o.replace(/^RRULE:/,"EXRULE:")}).filter(function(o){return!/^DTSTART/.test(o)}))}),this._rdate.length&&n.push(dI("RDATE",this._rdate,this.tzid())),this._exdate.length&&n.push(dI("EXDATE",this._exdate,this.tzid())),n},t.prototype.toString=function(){return this.valueOf().join(`
`)},t.prototype.clone=function(){var n=new t(!!this._cache);return this._rrule.forEach(function(r){return n.rrule(r.clone())}),this._exrule.forEach(function(r){return n.exrule(r.clone())}),this._rdate.forEach(function(r){return n.rdate(new Date(r.getTime()))}),this._exdate.forEach(function(r){return n.exdate(new Date(r.getTime()))}),n},t})(pe);function uI(e,t){if(!(e instanceof pe))throw new TypeError(String(e)+" is not RRule instance");we(t.map(String),String(e))||t.push(e)}function lI(e,t){if(!(e instanceof Date))throw new TypeError(String(e)+" is not Date instance");we(t.map(Number),Number(e))||(t.push(e),fc(t))}function dI(e,t,n){var r=!n||n.toUpperCase()==="UTC",o=r?"".concat(e,":"):"".concat(e,";TZID=").concat(n,":"),s=t.map(function(i){return mT(i.valueOf(),r)}).join(",");return"".concat(o).concat(s)}/*!
 * Copyright (c) Squirrel Chat et al., All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */function L5(e,t){let n=e.slice(0,t).split(/\r\n|\n|\r/g);return[n.length,n.pop().length+1]}function D5(e,t,n){let r=e.split(/\r\n|\n|\r/g),o="",s=(Math.log10(t+1)|0)+1;for(let i=t-1;i<=t+1;i++){let a=r[i-1];a&&(o+=i.toString().padEnd(s," "),o+=":  ",o+=a,o+=`
`,i===t&&(o+=" ".repeat(s+n+2),o+=`^
`))}return o}class ge extends Error{line;column;codeblock;constructor(t,n){const[r,o]=L5(n.toml,n.ptr),s=D5(n.toml,r,o);super(`Invalid TOML document: ${t}

${s}`,n),this.line=r,this.column=o,this.codeblock=s}}/*!
 * Copyright (c) Squirrel Chat et al., All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */function w5(e,t){let n=0;for(;e[t-++n]==="\\";);return--n&&n%2}function Yu(e,t=0,n=e.length){let r=e.indexOf(`
`,t);return e[r-1]==="\r"&&r--,r<=n?r:-1}function yT(e,t){for(let n=t;n<e.length;n++){let r=e[n];if(r===`
`)return n;if(r==="\r"&&e[n+1]===`
`)return n+1;if(r<" "&&r!=="	"||r==="")throw new ge("control characters are not allowed in comments",{toml:e,ptr:t})}return e.length}function $n(e,t,n,r){let o;for(;(o=e[t])===" "||o==="	"||!n&&(o===`
`||o==="\r"&&e[t+1]===`
`);)t++;return r||o!=="#"?t:$n(e,yT(e,t),n)}function fI(e,t,n,r,o=!1){if(!r)return t=Yu(e,t),t<0?e.length:t;for(let s=t;s<e.length;s++){let i=e[s];if(i==="#")s=Yu(e,s);else{if(i===n)return s+1;if(i===r||o&&(i===`
`||i==="\r"&&e[s+1]===`
`))return s}}throw new ge("cannot find end of structure",{toml:e,ptr:t})}function VL(e,t){let n=e[t],r=n===e[t+1]&&e[t+1]===e[t+2]?e.slice(t,t+3):n;t+=r.length-1;do t=e.indexOf(r,++t);while(t>-1&&n!=="'"&&w5(e,t));return t>-1&&(t+=r.length,r.length>1&&(e[t]===n&&t++,e[t]===n&&t++)),t}/*!
 * Copyright (c) Squirrel Chat et al., All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */let U5=/^(\d{4}-\d{2}-\d{2})?[T ]?(?:(\d{2}):\d{2}:\d{2}(?:\.\d+)?)?(Z|[-+]\d{2}:\d{2})?$/i;class Co extends Date{#e=!1;#t=!1;#r=null;constructor(t){let n=!0,r=!0,o="Z";if(typeof t=="string"){let s=t.match(U5);s?(s[1]||(n=!1,t=`0000-01-01T${t}`),r=!!s[2],r&&t[10]===" "&&(t=t.replace(" ","T")),s[2]&&+s[2]>23?t="":(o=s[3]||null,t=t.toUpperCase(),!o&&r&&(t+="Z"))):t=""}super(t),isNaN(this.getTime())||(this.#e=n,this.#t=r,this.#r=o)}isDateTime(){return this.#e&&this.#t}isLocal(){return!this.#e||!this.#t||!this.#r}isDate(){return this.#e&&!this.#t}isTime(){return this.#t&&!this.#e}isValid(){return this.#e||this.#t}toISOString(){let t=super.toISOString();if(this.isDate())return t.slice(0,10);if(this.isTime())return t.slice(11,23);if(this.#r===null)return t.slice(0,-1);if(this.#r==="Z")return t;let n=+this.#r.slice(1,3)*60+ +this.#r.slice(4,6);return n=this.#r[0]==="-"?n:-n,new Date(this.getTime()-n*6e4).toISOString().slice(0,-1)+this.#r}static wrapAsOffsetDateTime(t,n="Z"){let r=new Co(t);return r.#r=n,r}static wrapAsLocalDateTime(t){let n=new Co(t);return n.#r=null,n}static wrapAsLocalDate(t){let n=new Co(t);return n.#t=!1,n.#r=null,n}static wrapAsLocalTime(t){let n=new Co(t);return n.#e=!1,n.#r=null,n}}/*!
 * Copyright (c) Squirrel Chat et al., All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */let k5=/^((0x[0-9a-fA-F](_?[0-9a-fA-F])*)|(([+-]|0[ob])?\d(_?\d)*))$/,G5=/^[+-]?\d(_?\d)*(\.\d(_?\d)*)?([eE][+-]?\d(_?\d)*)?$/,V5=/^[+-]?0[0-9_]/,x5=/^[0-9a-f]{4,8}$/i,_I={b:"\b",t:"	",n:`
`,f:"\f",r:"\r",'"':'"',"\\":"\\"};function xL(e,t=0,n=e.length){let r=e[t]==="'",o=e[t++]===e[t]&&e[t]===e[t+1];o&&(n-=2,e[t+=2]==="\r"&&t++,e[t]===`
`&&t++);let s=0,i,a="",c=t;for(;t<n-1;){let l=e[t++];if(l===`
`||l==="\r"&&e[t]===`
`){if(!o)throw new ge("newlines are not allowed in strings",{toml:e,ptr:t-1})}else if(l<" "&&l!=="	"||l==="")throw new ge("control characters are not allowed in strings",{toml:e,ptr:t-1});if(i){if(i=!1,l==="u"||l==="U"){let f=e.slice(t,t+=l==="u"?4:8);if(!x5.test(f))throw new ge("invalid unicode escape",{toml:e,ptr:s});try{a+=String.fromCodePoint(parseInt(f,16))}catch{throw new ge("invalid unicode escape",{toml:e,ptr:s})}}else if(o&&(l===`
`||l===" "||l==="	"||l==="\r")){if(t=$n(e,t-1,!0),e[t]!==`
`&&e[t]!=="\r")throw new ge("invalid escape: only line-ending whitespace may be escaped",{toml:e,ptr:s});t=$n(e,t)}else if(l in _I)a+=_I[l];else throw new ge("unrecognized escape sequence",{toml:e,ptr:s});c=t}else!r&&l==="\\"&&(s=t-1,i=!0,a+=e.slice(c,s))}return a+e.slice(c,n-1)}function $5(e,t,n,r){if(e==="true")return!0;if(e==="false")return!1;if(e==="-inf")return-1/0;if(e==="inf"||e==="+inf")return 1/0;if(e==="nan"||e==="+nan"||e==="-nan")return NaN;if(e==="-0")return r?0n:0;let o=k5.test(e);if(o||G5.test(e)){if(V5.test(e))throw new ge("leading zeroes are not allowed",{toml:t,ptr:n});e=e.replace(/_/g,"");let i=+e;if(isNaN(i))throw new ge("invalid number",{toml:t,ptr:n});if(o){if((o=!Number.isSafeInteger(i))&&!r)throw new ge("integer value cannot be represented losslessly",{toml:t,ptr:n});(o||r===!0)&&(i=BigInt(e))}return i}const s=new Co(e);if(!s.isValid())throw new ge("invalid value",{toml:t,ptr:n});return s}/*!
 * Copyright (c) Squirrel Chat et al., All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */function B5(e,t,n,r){let o=e.slice(t,n),s=o.indexOf("#");s>-1&&(yT(e,s),o=o.slice(0,s));let i=o.trimEnd();if(!r){let a=o.indexOf(`
`,i.length);if(a>-1)throw new ge("newlines are not allowed in inline tables",{toml:e,ptr:t+a})}return[i,s]}function OT(e,t,n,r,o){if(r===0)throw new ge("document contains excessively nested structures. aborting.",{toml:e,ptr:t});let s=e[t];if(s==="["||s==="{"){let[c,l]=s==="["?Y5(e,t,r,o):F5(e,t,r,o),f=n?fI(e,l,",",n):l;if(l-f&&n==="}"){let d=Yu(e,l,f);if(d>-1)throw new ge("newlines are not allowed in inline tables",{toml:e,ptr:d})}return[c,f]}let i;if(s==='"'||s==="'"){i=VL(e,t);let c=xL(e,t,i);if(n){if(i=$n(e,i,n!=="]"),e[i]&&e[i]!==","&&e[i]!==n&&e[i]!==`
`&&e[i]!=="\r")throw new ge("unexpected character encountered",{toml:e,ptr:i});i+=+(e[i]===",")}return[c,i]}i=fI(e,t,",",n);let a=B5(e,t,i-+(e[i-1]===","),n==="]");if(!a[0])throw new ge("incomplete key-value declaration: no value specified",{toml:e,ptr:t});return n&&a[1]>-1&&(i=$n(e,t+a[1]),i+=+(e[i]===",")),[$5(a[0],e,t,o),i]}/*!
 * Copyright (c) Squirrel Chat et al., All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */let H5=/^[a-zA-Z0-9-_]+[ \t]*$/;function Fp(e,t,n="="){let r=t-1,o=[],s=e.indexOf(n,t);if(s<0)throw new ge("incomplete key-value: cannot find end of key",{toml:e,ptr:t});do{let i=e[t=++r];if(i!==" "&&i!=="	")if(i==='"'||i==="'"){if(i===e[t+1]&&i===e[t+2])throw new ge("multiline strings are not allowed in keys",{toml:e,ptr:t});let a=VL(e,t);if(a<0)throw new ge("unfinished string encountered",{toml:e,ptr:t});r=e.indexOf(".",a);let c=e.slice(a,r<0||r>s?s:r),l=Yu(c);if(l>-1)throw new ge("newlines are not allowed in keys",{toml:e,ptr:t+r+l});if(c.trimStart())throw new ge("found extra tokens after the string part",{toml:e,ptr:a});if(s<a&&(s=e.indexOf(n,a),s<0))throw new ge("incomplete key-value: cannot find end of key",{toml:e,ptr:t});o.push(xL(e,t,a))}else{r=e.indexOf(".",t);let a=e.slice(t,r<0||r>s?s:r);if(!H5.test(a))throw new ge("only letter, numbers, dashes and underscores are allowed in keys",{toml:e,ptr:t});o.push(a.trimEnd())}}while(r+1&&r<s);return[o,$n(e,s+1,!0,!0)]}function F5(e,t,n,r){let o={},s=new Set,i,a=0;for(t++;(i=e[t++])!=="}"&&i;){let c={toml:e,ptr:t-1};if(i===`
`)throw new ge("newlines are not allowed in inline tables",c);if(i==="#")throw new ge("inline tables cannot contain comments",c);if(i===",")throw new ge("expected key-value, found comma",c);if(i!==" "&&i!=="	"){let l,f=o,d=!1,[u,_]=Fp(e,t-1);for(let T=0;T<u.length;T++){if(T&&(f=d?f[l]:f[l]={}),l=u[T],(d=Object.hasOwn(f,l))&&(typeof f[l]!="object"||s.has(f[l])))throw new ge("trying to redefine an already defined value",{toml:e,ptr:t});!d&&l==="__proto__"&&Object.defineProperty(f,l,{enumerable:!0,configurable:!0,writable:!0})}if(d)throw new ge("trying to redefine an already defined value",{toml:e,ptr:t});let[p,E]=OT(e,_,"}",n-1,r);s.add(p),f[l]=p,t=E,a=e[t-1]===","?t-1:0}}if(a)throw new ge("trailing commas are not allowed in inline tables",{toml:e,ptr:a});if(!i)throw new ge("unfinished table encountered",{toml:e,ptr:t});return[o,t]}function Y5(e,t,n,r){let o=[],s;for(t++;(s=e[t++])!=="]"&&s;){if(s===",")throw new ge("expected value, found comma",{toml:e,ptr:t-1});if(s==="#")t=yT(e,t);else if(s!==" "&&s!=="	"&&s!==`
`&&s!=="\r"){let i=OT(e,t-1,"]",n-1,r);o.push(i[0]),t=i[1]}}if(!s)throw new ge("unfinished array encountered",{toml:e,ptr:t});return[o,t]}/*!
 * Copyright (c) Squirrel Chat et al., All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */function pI(e,t,n,r){let o=t,s=n,i,a=!1,c;for(let l=0;l<e.length;l++){if(l){if(o=a?o[i]:o[i]={},s=(c=s[i]).c,r===0&&(c.t===1||c.t===2))return null;if(c.t===2){let f=o.length-1;o=o[f],s=s[f].c}}if(i=e[l],(a=Object.hasOwn(o,i))&&s[i]?.t===0&&s[i]?.d)return null;a||(i==="__proto__"&&(Object.defineProperty(o,i,{enumerable:!0,configurable:!0,writable:!0}),Object.defineProperty(s,i,{enumerable:!0,configurable:!0,writable:!0})),s[i]={t:l<e.length-1&&r===2?3:r,d:!1,i:0,c:{}})}if(c=s[i],c.t!==r&&!(r===1&&c.t===3)||(r===2&&(c.d||(c.d=!0,o[i]=[]),o[i].push(o={}),c.c[c.i++]=c={t:1,d:!1,i:0,c:{}}),c.d))return null;if(c.d=!0,r===1)o=a?o[i]:o[i]={};else if(r===0&&a)return null;return[i,o,c.c]}function j5(e,{maxDepth:t=1e3,integersAsBigInt:n}={}){let r={},o={},s=r,i=o;for(let a=$n(e,0);a<e.length;){if(e[a]==="["){let c=e[++a]==="[",l=Fp(e,a+=+c,"]");if(c){if(e[l[1]-1]!=="]")throw new ge("expected end of table declaration",{toml:e,ptr:l[1]-1});l[1]++}let f=pI(l[0],r,o,c?2:1);if(!f)throw new ge("trying to redefine an already defined table or value",{toml:e,ptr:a});i=f[2],s=f[1],a=l[1]}else{let c=Fp(e,a),l=pI(c[0],s,i,0);if(!l)throw new ge("trying to redefine an already defined table or value",{toml:e,ptr:a});let f=OT(e,c[1],void 0,t,n);l[1][l[0]]=f[0],a=f[1]}if(a=$n(e,a,!0),e[a]&&e[a]!==`
`&&e[a]!=="\r")throw new ge("each key-value declaration must be followed by an end-of-line",{toml:e,ptr:a});a=$n(e,a)}return r}function q5(e,t,n){const r=eQ(t),o={message:r.message,status:W5(e),source:n.source,service:n.source,env:n.env,date:Date.now(),logger:{name:r.loggerName??"app"},"codex.app_session_id":n.codexAppSessionId,usr:n.userInfo};return K5(o,n.buildInfo),o}function W5(e){switch(e){case"trace":case"debug":return"debug";case"info":return"info";case"warning":return"warn";case"error":return"error"}}function K5(e,t){Z_(e,"build_number",t.buildNumber),Z_(e,"version",t.version),Z_(e,"app_version",t.version)}function Z_(e,t,n){n!=null&&(e[t]=n)}const z5=5e3,Z5=50,X5=64e3;class Q5{onFlush;flushIntervalMs;maxBatchSize;maxBatchBytes;buffer=[];bufferBytes=0;flushTimeout=null;constructor(t){this.onFlush=t.onFlush,this.flushIntervalMs=t.flushIntervalMs??z5,this.maxBatchSize=t.maxBatchSize??Z5,this.maxBatchBytes=t.maxBatchBytes??X5}enqueue(t){if(this.buffer.push(t),this.bufferBytes+=t.length,this.buffer.length>=this.maxBatchSize||this.bufferBytes>=this.maxBatchBytes){this.flush();return}this.scheduleFlush()}flushNow(){this.flush()}scheduleFlush(){this.flushTimeout==null&&(this.flushTimeout=setTimeout(()=>{this.flush()},this.flushIntervalMs))}flush(){if(this.buffer.length===0){this.clearFlushTimeout();return}const t=this.buffer.splice(0,this.buffer.length);this.bufferBytes=0,this.clearFlushTimeout(),this.onFlush(t)}clearFlushTimeout(){this.flushTimeout!=null&&(clearTimeout(this.flushTimeout),this.flushTimeout=null)}}const J5="https://chat.openai.com/ces/v1/telemetry/intake",e6="dummy-token",t6="browser",n6=2e3,r6=3e4,o6=5;class s6{options;reportFailure;batcher;queue=[];inFlightSend=null;retryTimeout=null;retryAttempts=0;disabled=!1;reportedDisabledReason=!1;fetchImpl;userInfo=null;constructor(t){this.options=t,this.reportFailure=t.reportFailure,this.fetchImpl=t.fetchImpl??fetch,this.batcher=new Q5({onFlush:n=>this.enqueueBatch(n)})}setUserInfo(t){this.userInfo=t}log(t,n){const r=q5(t,n,{buildInfo:this.options.buildInfo,userInfo:this.userInfo,codexAppSessionId:this.options.codexAppSessionId,source:this.options.source,env:this.options.env});this.batcher.enqueue(JSON.stringify(r))}flushNow(){this.batcher.flushNow(),this.drainQueue()}enqueueBatch(t){this.disabled||t.length!==0&&(this.queue.push({requestId:nc.randomUUID(),events:t}),this.drainQueue())}async drainQueue(){if(this.disabled){this.queue.length=0;return}if(this.inFlightSend!=null||this.retryTimeout!=null)return;const t=this.queue[0];if(t==null)return;const n=t.events.join(`
`);this.inFlightSend=(async()=>{try{await this.send(n,t.requestId),this.queue.shift(),this.retryAttempts=0}catch{if(this.disabled){this.queue.length=0;return}this.scheduleRetry()}finally{this.inFlightSend=null,this.drainQueue()}})()}scheduleRetry(){if(this.retryTimeout!=null)return;if(this.retryAttempts>=o6){this.queue.shift(),this.retryAttempts=0,this.drainQueue();return}this.retryAttempts+=1;const t=Math.min(r6,n6*Math.pow(2,this.retryAttempts-1));this.retryTimeout=setTimeout(()=>{this.retryTimeout=null,this.drainQueue()},t)}disableWithFailure(t){this.disabled=!0,!this.reportedDisabledReason&&(this.reportedDisabledReason=!0,this.reportFailure(t))}async send(t,n){const r=i6(n),o=await this.fetchImpl(r,{method:"POST",headers:{"content-type":"text/plain","x-request-id":n},body:Buffer.from(t)});if(!o.ok){const s=await o.text();if(o.status>=400&&o.status<500)return(o.status===401||o.status===403)&&this.disableWithFailure({type:"disabled",reason:"invalid_client_token",status:o.status,body:s}),o.status;throw new Error(`[datadog] non-2xx response (${o.status})`)}return o.status}}function i6(e){const n=`/api/v2/logs?${new URLSearchParams({ddsource:"browser","dd-api-key":e6,"dd-evp-origin":t6,"dd-request-id":e}).toString()}`;return`${J5}?ddforward=${encodeURIComponent(n)}`}function X_(e,t){let n=null,r=null;const o=((...s)=>{r=s,n&&clearTimeout(n),n=setTimeout(()=>{n=null;const i=r;r=null,i&&e(...i)},t)});return o.cancel=()=>{n&&(clearTimeout(n),n=null),r=null},o}function a6(e){const t=(n,r,o)=>{const s=typeof n=="string"?new Error(n):n;try{e(s,r,o)}catch{}};return{report:t,reportNonFatal:(n,r)=>t(n,"non-fatal",r),reportFatal:(n,r)=>t(n,"fatal",r)}}async function c6(e,t){let n;try{const o=await ur.readFile(e,t);n=j5(o),n=u6(n)}catch(o){return{configPath:e,cwdRelativeToGitRoot:e,type:"error",error:new Error(`Failed to parse environment config at ${e}: ${String(o)}`)}}const r=U9.safeParse(n);return r.success?{configPath:e,cwdRelativeToGitRoot:await _6(e,t),type:"success",environment:d6(r.data)}:{configPath:e,cwdRelativeToGitRoot:e,type:"error",error:new Error(`Invalid environment config at ${e}: ${r.error.toString()}`)}}function u6(e){return!$L(e)||!Array.isArray(e.actions)?e:{...e,actions:e.actions.filter(t=>l6(t))}}function l6(e){return!$L(e)||typeof e.name!="string"||typeof e.command!="string"?!1:e.name.trim().length>0&&e.command.trim().length>0}function $L(e){return typeof e=="object"&&e!=null&&!Array.isArray(e)}function d6(e){return{...e,name:e.name.trim(),setup:f6(e.setup),actions:e.actions?e.actions.map(t=>({...t,name:t.name.trim(),command:t.command.trim()})):void 0}}function f6(e){return{...e,script:e.script.trim(),darwin:e.darwin?{script:e.darwin.script.trim()}:void 0,linux:e.linux?{script:e.linux.script.trim()}:void 0,win32:e.win32?{script:e.win32.script.trim()}:void 0}}async function _6(e,t){const n=dn(t),r=await p6(e,t);let o=r;for(;o!==n.dirname(o)&&!await BL(o,t);)o=n.dirname(o);const s=n.relative(o,r);return s===""?".":s}async function BL(e,t){const n=dn(t);try{const r=await ur.stat(n.join(e,".git"),t);return r.isDirectory()||r.isFile()}catch{return!1}}async function p6(e,t){const n=dn(t);let r=n.dirname(e);for(;r!==n.dirname(r);){if(await E6(r,t))return r;if(await BL(r,t))return r;r=n.dirname(r)}return e}async function E6(e,t){const n=dn(t);try{const r=await ur.stat(n.join(e,".codex"),t);return r.isDirectory()||r.isFile()}catch{return!1}}const jr=Ot("git");async function re(e,t,n,r={}){const{env:o,signal:s,timeoutMs:i,onStdoutRaw:a,onStderrRaw:c,maxOutputBytes:l,trim:f=!0,allowedNonZeroExitCodes:d}=r,u={GIT_TERMINAL_PROMPT:"0",...o},_=T6(e,t,n),p=JX(_);if(s&&s.aborted)return{command:p,success:!1,code:null,stdout:"",stderr:"git process aborted"};let E=!1,T=!1,h,m=0;const A=crypto.randomUUID().slice(0,8);let g,R="",O="",C=null;const I=(H,$)=>{m+=$.length,l!=null&&m>l&&h==null&&(h={stream:H,limitBytes:l},jr().warning(`[${A}] output limit exceeded: ${H} ${m} > ${l}`),g.kill()),H==="stdout"?a?.($):c?.($)},L=Date.now();try{Ue(n)?(jr().debug(`[${A}] Running remote git command: ${p}`),g=await cr({hostConfig:n,args:_,env:u,stdoutChunkHandler:H=>I("stdout",H),stderrChunkHandler:H=>I("stderr",H)})):(jr().debug(`[${A}] Running local git command (cwd: ${e}): ${p}`),g=bL({args:_,cwd:e,env:{...process.env,...u},stdoutChunkHandler:H=>I("stdout",H),stderrChunkHandler:H=>I("stderr",H)}))}catch(H){jr().warning(`[${A}] failed to start git process: ${H}`);const $=H instanceof Error?H.message:"Failed to start git process";return{command:p,success:!1,code:null,stdout:"",stderr:$}}const U=()=>{jr().debug(`[${A}] Aborted: ${p}`),T=!0,g.kill()};s&&(s.addEventListener("abort",U),s.aborted&&U());const q=i!=null?setTimeout(()=>{E=!0,g.kill()},i):null;try{const{stdout:H,stderr:$,code:B}=await g.wait();if(R=f?H.trim():H,O=f?$.trim():$,C=B,q&&clearTimeout(q),s&&s.removeEventListener("abort",U),T)return{command:p,success:!1,code:C,stdout:R,stderr:O?`${O}
git process aborted`:"git process aborted",outputLimitExceeded:h,process:g};const F=h==null&&C!=null&&(C===0||Array.isArray(d)&&d.includes(C));return F||jr().warning(`[${A}] encountered an error running git command code=${C} stderr=${O}`),{command:p,success:F,code:C,stdout:R,stderr:E?`${O}git process timed out after ${i}ms`:O,outputLimitExceeded:h,process:g}}catch(H){q&&clearTimeout(q),s&&s.removeEventListener("abort",U);const $=H instanceof Error?H.message:String(H);return{command:p,success:!1,code:C,stdout:g?.getStdout().toString("utf8")??R,stderr:g?.getStderr().toString("utf8")??($?`${O}${$}`:O),outputLimitExceeded:h,process:g}}finally{jr().debug(`[${A}] completed ${((Date.now()-L)/1e3).toFixed(3)}s (${C}): ${p}`)}}function T6(e,t,n){return Ue(n)?["git","--no-optional-locks","-C",e,...t]:["git","--no-optional-locks",...t]}async function HL(e,t=null){const n=dn(t),{success:r,stdout:o}=await re(e,["rev-parse","--git-dir"],t,{allowedNonZeroExitCodes:[128]});return!r||!o?null:n.isAbsolute(o)?o:n.resolve(e,o)}async function h6(e,t){if(t)try{const n=ND.join(t,YL);if((await de.promises.stat(n)).isFile())return!0}catch{}return S6(e)}async function S6(e){try{const t=await de.promises.stat(e);return t.birthtimeMs>0?t.birthtimeMs<m6:!0}catch{return!1}}async function FL(e,t=null){try{const n=dn(t),r=await HL(e,t);if(!r)return{success:!1,error:new Error("Failed to resolve worktree git directory")};const o=n.join(r,YL);return await ur.writeFile(o,"",t),{success:!0}}catch(n){return{success:!1,error:n instanceof Error?n:new Error("Failed to mark worktree")}}}const YL="codex-managed",m6=new Date("2026-01-29T00:00:00").getTime(),rn=5*1024*1024,Ja="origin",A6=["-c","diff.mnemonicPrefix=false","-c","diff.noprefix=false","-c","core.quotePath=false"],g6=["diff","--no-ext-diff","--no-textconv","--color=never","--src-prefix=a/","--dst-prefix=b/"];function nr(e){return e?.outputLimitExceeded?{type:"diff-too-large",limitBytes:e.outputLimitExceeded.limitBytes}:{type:"unknown"}}async function on(e,t,n,r={}){return re(e,[...A6,...g6,...r.binary?["--binary"]:[],...t],n,{...r,maxOutputBytes:r.maxOutputBytes??rn})}const R6=8;async function jL(e,t,n,r){if(!t.success)return{success:!1,error:{type:"unknown"}};const o=new AbortController,s=()=>{o.abort()};r?.addEventListener("abort",s),r?.aborted&&s();const i=t.paths,a=[],c=Array.from({length:i.length},()=>{});let l=0,f=0,d=0,u=!1,_=null;const p=g=>{u||(u=!0,_=g,o.abort())},E=g=>{const R=g.trim();if(R.length===0||u)return;const O=a.length>0?`
`:"",C=Buffer.byteLength(`${O}${R}`,"utf8");if(l+C>rn){p({type:"diff-too-large",limitBytes:rn});return}l+=C,a.push(g)},T=()=>{if(!u)for(;d<c.length;){const g=c[d];if(g===void 0)return;if(d+=1,!(g==null||g.trim().length===0)&&(E(g),u))return}},h=()=>{if(u||f>=i.length)return null;const g=i[f],R=f;return f+=1,{index:R,path:g}},m=async()=>{if(u)return;const g=h();if(g==null)return;const R=await on(e,["--no-index","--","/dev/null",g.path],n,{trim:!1,allowedNonZeroExitCodes:[0,1],signal:o.signal});if(R.outputLimitExceeded){p(nr(R));return}if(!R.success){p(nr(R));return}c[g.index]=R.stdout.trim().length>0?R.stdout:null,T(),await m()},A=Math.min(R6,i.length);try{await Promise.all(Array.from({length:A},()=>m()))}finally{r?.removeEventListener("abort",s)}return _?{success:!1,error:_}:{success:!0,sections:a}}async function Yp(e,t,n,{includePaths:r}={}){const o=await t.getWorktreeRepository(e,n);if(!o)return{type:"error",error:{type:"unknown"}};const s=await o.getUntrackedPaths(r),i=await jL(e,s,n);return i.success?{type:"success",unifiedDiff:i.sections.length>0?i.sections.map(c=>N6(c)).join(`
`):""}:{type:"error",error:i.error}}function N6(e){return e.replace(/[\r\n]+$/,"")}async function Bl(e,t,n){const{success:r,stdout:o}=await re(e,["rev-parse","--git-dir"],t,{signal:n});return!r||!o?null:le.isAbsolute(o)?o:le.join(e,o)}const y6=Ot("git");async function bT(e,t,n){if(!Ue(t)&&!de.existsSync(e))throw new Error(`ENOENT: path does not exist: ${e}`);const{success:r,stdout:o,stderr:s,code:i}=await re(e,["rev-parse","--show-toplevel"],t,{allowedNonZeroExitCodes:[128],signal:n});if(r&&o)return o;if(i===128&&s.toLowerCase().includes("not a git repository"))return null;throw y6().debug(`[getGitRoot] failed to resolve git root: ${s||o||"Unknown error"}`),new Error(`Failed to resolve git root: ${s||o||"Unknown error"}`)}const Q_=Ot("git");async function qL(e,t,n){const r=await Bl(e,t,n);if(!r)return{type:"error",error:{type:"unknown"}};let o=null;try{o=await de.promises.mkdtemp(le.join(qo.tmpdir(),"codex-git-index"));const s=le.join(r,"index"),i=le.join(o,"index");await de.promises.copyFile(s,i).catch(f=>{if(f.code!=="ENOENT")throw f});const a={GIT_INDEX_FILE:i},c=await re(e,["add","-u"],t,{env:a,signal:n});if(!c.success)return Q_().warning(`Failed to stage uncommitted diff in ${e}: ${c.stderr||c.stdout}`),{type:"error",error:{type:"unknown"}};const l=await on(e,["--cached"],t,{trim:!1,allowedNonZeroExitCodes:[0,1],env:a,signal:n});return l.outputLimitExceeded||!l.success?(Q_().warning(`Failed to collect uncommitted diff in ${e}: ${l.stderr||l.stdout}`),{type:"error",error:nr(l)}):{type:"success",unifiedDiff:l.stdout}}catch(s){return Q_().error(`failed to collect tracked uncommitted diff: ${String(s)}`),{type:"error",error:{type:"unknown"}}}finally{o&&await de.promises.rm(o,{recursive:!0,force:!0})}}async function O6(e,t,n,r){const o=await bT(e,n,r),[s,i]=await Promise.all([qL(e,n,r),o?Yp(o,t,n):Promise.resolve({type:"error",error:{type:"unknown"}})]);return s.type!=="success"||i.type!=="success"?{type:"error",error:{type:"unknown"}}:{type:"success",unifiedDiff:b6([s.unifiedDiff,i.unifiedDiff])}}function b6(e){const t=e.map(r=>I6(r)).filter(r=>r.length>0);if(t.length===0)return"";const n=t.join(`
`);return n.endsWith(`
`)?n:`${n}
`}function I6(e){return e.replace(/[\r\n]+$/,"")}async function Yo(e,t,n){const{success:r,stdout:o}=await re(e,["rev-parse","--abbrev-ref","HEAD"],t,{signal:n});if(r&&o&&o!=="HEAD")return o;const s=await re(e,["symbolic-ref","--quiet","--short","HEAD"],t,{signal:n});return s.success&&s.stdout?s.stdout:null}async function WL(e,t=Ja,n,r){const o=await re(e,["symbolic-ref","--quiet",`refs/remotes/${t}/HEAD`],n,{signal:r});if(o.success&&o.stdout){const a=o.stdout.split("/");return a[a.length-1]??null}const s=await re(e,["remote","show",t],n,{timeoutMs:1e4,signal:r});if(!s.success||!s.stdout)return null;const i=/HEAD branch:\s*(.+)/.exec(s.stdout);return i?i[1].trim():null}async function KL(e,t,n,r,o){const s=await re(e,["rev-list","--left-right","--count",`${t}...${n}`],r,{allowedNonZeroExitCodes:[128,1],signal:o});if(!s.success||!s.stdout)return null;const i=C6(s.stdout);if(!i)return null;let a="equal";return i.leftAhead>0&&i.rightAhead>0?a="diverged":i.leftAhead>0?a="left-ahead":i.rightAhead>0&&(a="right-ahead"),{leftAhead:i.leftAhead,rightAhead:i.rightAhead,state:a}}function C6(e){const t=e.trim();if(!t)return null;const n=t.split(/\s+/);if(n.length<2)return null;const r=Number.parseInt(n[0]??"",10),o=Number.parseInt(n[1]??"",10);return!Number.isFinite(r)||!Number.isFinite(o)?null:{leftAhead:r,rightAhead:o}}async function M6(e,t,n,r){const o=await re(e,["rev-parse","--abbrev-ref","--symbolic-full-name",`${t}@{u}`],n,{allowedNonZeroExitCodes:[128,1],signal:r});return o.success&&o.stdout?o.stdout:null}async function P6(e,t,n,r,o){const s=async f=>{const d=await M6(e,f,r,o);return d&&(await KL(e,f,d,r,o))?.state==="right-ahead"?d:f},i=async()=>t.type==="branch"?s(t.branchName):await Yo(e,r,o)??await WL(e,Ja,r,o)??"HEAD",a=async()=>{if(t.type!=="working-tree")return null;const f=await O6(e,n,r,o);return f.type==="error"?null:f.unifiedDiff},[c,l]=await Promise.all([i(),a()]);return{startingRef:c,startingDiff:l}}function v6(e){return e?.id??"local"}const jp=Ot("git"),L6=3,EI=new Map;function D6(e){const t=v6(e),n=EI.get(t);if(n)return n;const r=new mL.Sema(L6);return EI.set(t,r),r}async function ju(e,t,n=!1,r){const o=D6(t);await o.acquire(),jp().debug(`Deleting worktree force: ${n} at ${e}`);try{const s=["worktree","remove"];n&&s.push("--force"),s.push(e),((await re(e,s,t,{signal:r})).success||n)&&await w6(e)}finally{o.release()}}async function w6(e){try{await de.promises.rm(e,{recursive:!0,force:!0})}catch(t){jp().warning(`Failed to remove directory ${e}: ${String(t)}`)}try{const t=le.dirname(e);if(t===e)return;(await de.promises.readdir(t)).length===0&&await de.promises.rm(t,{recursive:!0,force:!0})}catch(t){jp().warning(`Failed to remove parent of ${e}: ${String(t)}`)}}function U6(e,t){return[e,t].filter(r=>r.length>0).join(`
`)}function Jn({command:e,stdout:t,stderr:n,fallbackOutput:r=t||n||"An unknown error occurred"}){const o=U6(t,n)||r;return{command:e,output:o}}async function zL(e,t,n,{preferWslPaths:r=!1,convertWindowsPathToWslPath:o=void 0}={}){const s=Ue(n),i=s?le.posix.join(e,"index"):le.join(e,"index");if(s){const c=`cp ${Gt(t)} ${Gt(i)}`;await(await cr({hostConfig:n,args:[`sh -lc ${Gt(c)}`]})).check()}else await de.promises.copyFile(t,i);let a=i;return r&&o&&(a=o(i)),a}async function IT(e,t,n,r){const{success:o,stdout:s}=await re(e,["rev-parse","--git-path",t],n,{signal:r});if(!o||!s)return null;if(le.isAbsolute(s))return s;if(s.startsWith(".git/"))return le.join(e,s);const i=await Bl(e,n,r);return i?le.join(i,s):null}async function CT(e,t){return IT(e,"index",t)}function qu(e){return e.split(/[/\\]+/).join("/")}function ZL(e,t,n){const r=k6(t,n),o=G6(e,r);return o?qu(o):n}function k6(e,t){return le.isAbsolute(t)?t:le.resolve(e,t)}function G6(e,t){const n=le.relative(e,t);return n===""||n.startsWith("..")||le.isAbsolute(n)?null:n}function V6(e,t){const n=new Set,r=new Set,o=new Set;let s=null;const i=[e,t].filter(Boolean).join(`
`),a=(F,w)=>{const k=(w??"").trim();if(!k)return;const Y=k.charAt(0),oe=k.charAt(k.length-1);let ae=k;(Y==="'"||Y==='"')&&oe===Y&&k.length>=2&&(ae=k.slice(1,-1)),ae&&F.add(ae)},c=(F,w)=>{for(const k of w)if(F[k])return F[k]},l=/^(?:Applied patch(?: to)?\s+(?:(["'])(?<qpath>.+?)\1|(?<path>.+?))\s+cleanly\.?)$/i,f=/^(?:Applied patch(?: to)?\s+(?:(["'])(?<qpath>.+?)\1|(?<path>.+?))\s+with conflicts\.?)$/i,d=/^(?:Applying patch\s+(?:(["'])(?<qpath>.+?)\1|(?<path>.+?))\s+with\s+\d+\s+rejects?\.{0,3})$/i,u=/^(?:Checking patch\s+(?:(["'])(?<qpath>.+?)\1|(?<path>.+?))\.\.\.)$/i,_=/^(?:Performing three-way merge|Falling back to three-way merge)\.\.\.$/i,p=/^Failed to perform three-way merge\.\.\.$/i,E=/^Falling back to direct application\.\.\.$/i,T=/^U\s+(?<path>.+)$/,h=/^error:\s+patch failed:\s+(?<path>.+?)(?::\d+)?(?:\s|$)/i,m=/^error:\s+(?<path>.+?):\s+patch does not apply$/i,A=/^(?:error: )?repository lacks the necessary blob to (?:perform|fall back on) 3-?way merge\.?$/i,g=/^error:\s+(?<path>.+?):\s+does not match index\b/i,R=/^error:\s+(?<path>.+?):\s+does not exist in index\b/i,O=/^error:\s+(?<path>.+?)\s+already exists in (?:the )?working directory\b/i,C=/^error:\s+patch failed:\s+(?<path>.+?)\s+File exists/i,I=/^error:\s+path\s+(?<path>.+?)\s+has been renamed\/deleted/i,L=/^error:\s+cannot apply binary patch to\s+['"]?(?<path>.+?)['"]?\s+without full index line$/i,U=/^error:\s+binary patch does not apply to\s+['"]?(?<path>.+?)['"]?$/i,q=/^error:\s+binary patch to\s+['"]?(?<path>.+?)['"]?\s+creates incorrect result\b/i,H=/^error:\s+cannot read the current contents of\s+['"]?(?<path>.+?)['"]?$/i,$=/^Skipped patch\s+['"]?(?<path>.+?)['"]\.$/i,B=/^warning:\s*Cannot merge binary files:\s+(?<path>.+?)\s+\(ours\s+vs\.\s+theirs\)/i;for(const F of i.split(/\r?\n/)){const w=F.trim();if(!w)continue;let k;if(k=w.match(l)){const Y=c(k.groups??{},["qpath","path"]);a(n,Y),s=Y??s,o.delete(Y??""),r.delete(Y??"");continue}if(k=w.match(f)){const Y=c(k.groups??{},["qpath","path"]);a(o,Y),s=Y??s,n.delete(Y??""),r.delete(Y??"");continue}if(k=w.match(d)){const Y=c(k.groups??{},["qpath","path"]);a(o,Y),s=Y??s,n.delete(Y??""),r.delete(Y??"");continue}if(k=w.match(T)){a(o,k.groups?.path),s=k.groups?.path??s,n.delete(k.groups?.path??""),r.delete(k.groups?.path??"");continue}if(k=w.match(u)){s=c(k.groups??{},["qpath","path"])??s;continue}if((k=w.match(h))||(k=w.match(m))){a(r,k.groups?.path),s=k.groups?.path??s;continue}if(!(_.test(w)||E.test(w))){if(p.test(w)){s&&(a(r,s),n.delete(s),o.delete(s));continue}if(A.test(w)){s&&(a(r,s),n.delete(s),o.delete(s));continue}if((k=w.match(g))||(k=w.match(R))||(k=w.match(O))||(k=w.match(C))||(k=w.match(I))||(k=w.match(L))||(k=w.match(U))||(k=w.match(q))||(k=w.match(H))||(k=w.match($))){a(r,k.groups?.path),s=k.groups?.path??s,n.delete(k.groups?.path??""),o.delete(k.groups?.path??"");continue}if(k=w.match(B)){a(o,k.groups?.path),s=k.groups?.path??s,n.delete(k.groups?.path??""),r.delete(k.groups?.path??"");continue}}}for(const F of o)n.delete(F),r.delete(F);for(const F of n)r.delete(F);return{appliedPaths:Array.from(n).sort(),skippedPaths:Array.from(r).sort(),conflictedPaths:Array.from(o).sort()}}function XL(e){const t=new Set,n=/^diff --git a\/(.*?) b\/(.*)$/gm;let r;for(;(r=n.exec(e))!=null;){const[o,s,i]=r;s&&s!=="/dev/null"&&t.add(s),i&&i!=="/dev/null"&&t.add(i)}return Array.from(t)}async function QL(e,t,n,{preferWslPaths:r=!1,convertWindowsPathToWslPath:o,convertWslPathToWindowsPath:s,signal:i}={}){const{cwd:a,env:c,diff:l,revert:f,target:d="unstaged",allowBinary:u}=e,_=$l("applyPatch"),E=(await t.getWorktreeRepository(a,n))?.root;if(!E)throw new Error(`${a} is not a git repository`);if(i?.aborted)return{status:"error",appliedPaths:[],skippedPaths:[],conflictedPaths:[]};const T=await $6({hostConfig:n,signal:i});let h=dn(n).join(T,"patch.diff");await B6(h,l,{hostConfig:n,signal:i}),r&&o&&(h=o(h));try{let m=c;if(f&&d==="unstaged"){const U=await CT(E,n);if(!U)_.warning(`[applyPatch] Unable to resolve git index path for ${E}; applying without temp index`);else{const q=await zL(T,U,n,{preferWslPaths:r,convertWindowsPathToWslPath:o});m={...c,GIT_INDEX_FILE:q},await x6(E,l,n,{preferWslPaths:r,convertWslPathToWindowsPath:s,env:{...c,GIT_INDEX_FILE:q},signal:i})}}const A=["apply"];f&&A.push("-R"),u&&A.push("--binary"),A.push("--3way"),d==="staged"?A.push("--cached"):d==="staged-and-unstaged"&&A.push("--index"),A.push(h);const{code:g,stdout:R,stderr:O}=await re(E,A,n,{env:m,signal:i,allowedNonZeroExitCodes:[1]}),{appliedPaths:C,skippedPaths:I,conflictedPaths:L}=V6(R,O);return _.debug("ApplyPatch result metadata",{revert:f,target:d,code:g,stdoutLength:R.length,stderrLength:O.length,appliedCount:C.length,skippedCount:I.length,conflictedCount:L.length}),{status:i?.aborted||g==null?"error":g===0?"success":g===1?"partial-success":"error",appliedPaths:C,skippedPaths:I,conflictedPaths:L,execOutput:Jn({command:A.join(" "),stdout:R,stderr:O})}}finally{await H6(T,{hostConfig:n})}}async function x6(e,t,n,{preferWslPaths:r,convertWslPathToWindowsPath:o,env:s,signal:i}){const a=XL(t);if(a.length===0)return;const c=[],l=dn(n);if(await Promise.all(a.map(async f=>{const d=ZL(e,e,f);let u=l.join(e,d);r&&o&&(u=o(u)),await F6(u,{hostConfig:n,signal:i})&&c.push(d)})),c.length!==0){if(i?.aborted)throw new Error("Apply patch canceled");await re(e,["--no-optional-locks","add","--",...c],n,{env:s,signal:i})}}async function Hl(e,t,{input:n,signal:r,timeoutMs:o=1e4}={}){if(!Ue(e))throw new Error("runSshCommand requires a remote host config");const s=`sh -lc ${Gt(t)}`,[i,...a]=e.terminal_command;if(!i)throw new Error("remote host config missing terminal command");const c=[...a,"-o","BatchMode=yes","-o","ConnectTimeout=10",s],l=Tc.spawn(i,c,{stdio:["pipe","pipe","pipe"]});n!=null&&l.stdin?.write(n),l.stdin?.end();let f=!1;const d=setTimeout(()=>{f=!0,l.kill()},o),u=()=>{l.kill()};r&&r.addEventListener("abort",u);const _=[],p=[];l.stdout?.on("data",m=>_.push(m)),l.stderr?.on("data",m=>p.push(m));const{code:E}=await new Promise(m=>{l.on("close",A=>m({code:A})),l.on("error",()=>m({code:null}))});clearTimeout(d),r&&r.removeEventListener("abort",u);const T=Buffer.concat(_).toString("utf8"),h=Buffer.concat(p).toString("utf8");return f?{code:null,stdout:T,stderr:`${h}ssh command timed out`}:{code:E,stdout:T,stderr:h}}async function $6({hostConfig:e,signal:t}){if(!Ue(e))return de.promises.mkdtemp(BI.join(qo.tmpdir(),"codex-apply-"));const{code:n,stdout:r,stderr:o}=await Hl(e,'mktemp -d "${TMPDIR:-/tmp}/codex-apply-XXXXXX"',{signal:t});if(n!==0||!r.trim())throw new Error(`failed to create remote temp dir: ${o||r}`.trim());return r.trim()}async function B6(e,t,{hostConfig:n,signal:r}){if(!Ue(n)){await de.promises.writeFile(e,t);return}const o=`cat > ${Gt(e)}`,{code:s,stderr:i}=await Hl(n,o,{input:t,signal:r});if(s!==0)throw new Error(`failed to write remote file: ${i}`)}async function H6(e,{hostConfig:t}){if(!Ue(t)){await de.promises.rm(e,{recursive:!0,force:!0});return}await Hl(t,`rm -rf ${Gt(e)}`)}async function F6(e,{hostConfig:t,signal:n}){if(!Ue(t))try{return await de.promises.access(e),!0}catch{return!1}const{code:r}=await Hl(t,`test -e ${Gt(e)}`,{signal:n});return r===0}const Wa=Ot("git");async function Y6(e,t,n,r,o,s){try{const i=await j6(e,t,n,r,o,s);if(!i.success)try{Wa().debug(`Deleting worktree ${t} due to failure`),await ju(t,o,!0)}catch(a){Wa().warning(`Failed to cleanup worktree ${t}: ${String(a)}`)}return i}catch(i){try{Wa().debug(`Deleting worktree ${t} due to unknown error`),await ju(t,o,!0)}catch(a){Wa().warning(`Failed to cleanup worktree ${t}: ${String(a)}`)}return{success:!1,error:q6(i)}}}async function j6(e,t,n,r,o,s){const i=s?.onLog,a=s?.signal;if(a&&a.aborted)return{success:!1,error:new Error("Operation canceled")};const{startingRef:c,startingDiff:l}=await P6(e,n,r,o,a);if(a&&a.aborted)return{success:!1,error:new Error("Operation canceled")};const f=["worktree","add","--detach",t,c];Wa().debug(`Git ${e} ${f.join(" ")}`);const d=await re(e,f,o,{onStdoutRaw:i?_=>i("stdout",_):void 0,onStderrRaw:i?_=>i("stderr",_):void 0,signal:a});if(!d.success)return{success:!1,error:new Error(`git worktree add failed: ${d.stderr||d.stdout}`)};if(a&&a.aborted)return{success:!1,error:new Error("Operation canceled")};const u=await FL(t,o);if(!u.success)return u;if(l){i?.("info",wn.Buffer.from(`[info] Applying working tree diff to new worktree
`,"utf8"));const _=await QL({cwd:t,diff:l,revert:!1},r,o,{signal:a});if(_.status!=="success"){const p=`git apply failed: applied:${_.appliedPaths.length} skipped:${_.skippedPaths.length} conflicted:${_.conflictedPaths.length}`;return i?.("info",wn.Buffer.from(`${p}
`,"utf8")),{success:!1,error:new Error(p)}}}return{success:!0}}function q6(e){return e instanceof Error?e:new Error(String(e))}function JL(){return le.join(yQ({}),"worktrees")}const TI=Ot("git");async function W6(e,t,n,r,o=JL()){const i=(await t.getWorktreeRepository(n,r))?.root;if(!i)return TI().error(`[createWorktreePath] failed to resolve git root for workspace ${n}`),{success:!1};let a=le.join,c=le.relative,l=o;if(Ue(r)){const E=await OQ(r);if(!E)return TI().error(`[createWorktreePath] failed to resolve remote codex home for ${r.display_name??r.id}`),{success:!1};a=le.posix.join,c=le.posix.relative,l=a(E,"worktrees")}const f=nc.randomUUID().split("-")[0].slice(0,4),d=le.basename(e),u=a(l,f,d),_=c(i,n),p=a(u,_);return{success:!0,worktreeGitRoot:u,worktreeWorkspaceRoot:p}}async function eD(e,t,n){const r=await re(e,["remote"],t,{signal:n});if(!r.success||!r.stdout)return[];const o=r.stdout.split(`
`).map(s=>s.trim()).filter(s=>s.length>0);return o.includes(Ja)&&o.length>1?[Ja,...o.filter(s=>s!==Ja)]:o}async function ec(e,t,n){const r=await eD(e,t,n);if(r.length===0)return null;for(const o of r){const s=await WL(e,o,t,n);if(s)return{remote:o,branch:s}}return null}async function MT(e,t,n,r){const o=await re(e,["rev-parse",`${t}^{tree}`],n,{allowedNonZeroExitCodes:[128],signal:r});if(!o.success||!o.stdout)throw new Error(o.stderr||o.stdout||"Failed to resolve tree");return o.stdout}const Zc=Ot("git");async function K6(e,t,n,r){const o=z6(t.environment.setup,process.platform);if(!o||o.length===0)return null;const s=Date.now();if(r&&r.aborted)return{cwd:e,scriptPath:t.configPath,status:"failed",startedAt:s,finishedAt:Date.now(),error:"Setup script canceled",log:""};let i=null;try{const a=le.join(e,t.cwdRelativeToGitRoot);Ho().debug(`[local-environment] invoking setup script (cwd: ${a})`),i=await de.promises.mkdtemp(le.join(qo.tmpdir(),"codex-local-environment-"));const c=le.join(i,`${nc.randomUUID()}-setup_script.sh`),l=le.join(i,`${nc.randomUUID()}-setup_exit_code.txt`),f=o.replace(/\r\n/g,`
`);await de.promises.writeFile(c,f,{mode:448});const d=`bash -xeo pipefail ${JSON.stringify(c)}; echo $? > ${JSON.stringify(l)}`,u=Tc.spawn("bash",["-lc",d],{stdio:["ignore","pipe","pipe"],cwd:a}),_=new Array,p=new em.StringDecoder("utf8"),E=new em.StringDecoder("utf8");let T="",h="";const m=(I,L,U)=>{n?.(U,I);const B=((U==="stdout"?T:h)+(U==="stdout"?p:E).write(I)).split(/\r?\n/),F=B.pop()??"";U==="stdout"?T=F:h=F;for(const w of B)w&&(_.push(w),L(`[${U}] ${w}`))},A=()=>{const I=(L,U)=>{const $=(L==="stdout"?T:h)+(L==="stdout"?p:E).end();L==="stdout"?T="":h="";for(const B of $.split(/\r?\n/))B&&(_.push(B),U(`[${L}] ${B}`))};I("stdout",L=>Zc().info(L)),I("stderr",L=>Zc().error(L))};u.stdout?.on("data",I=>m(I,L=>Zc().info(L),"stdout")),u.stderr?.on("data",I=>m(I,L=>Zc().error(L),"stderr"));const g=async()=>{try{const I=await de.promises.readFile(l,"utf8"),L=Number.parseInt(I.trim(),10);return Number.isNaN(L)?null:L}catch{return null}},R=async()=>{i!=null&&await de.promises.rm(i,{recursive:!0,force:!0})};let O=!1;const C=()=>{O=!0,u.kill()};return r&&r.addEventListener("abort",C),new Promise(I=>{u.once("error",L=>{r&&r.removeEventListener("abort",C),(async()=>(A(),await R(),I({scriptPath:c,cwd:a,status:"failed",startedAt:s,finishedAt:Date.now(),error:L?.message??"Failed to run setup script",log:_.join(`
`)})))()}),u.once("close",L=>{r&&r.removeEventListener("abort",C),(async()=>{const q=await g()??L;A(),await R();let H,$;O?(H="failed",$="Setup script canceled"):q===0?H="succeeded":(H="failed",$=`worktree_init.sh exited with code ${q??"unknown"}`),I({scriptPath:c,cwd:a,status:H,startedAt:s,finishedAt:Date.now(),error:$,log:_.join(`
`)})})()})})}catch(a){return i!=null&&await de.promises.rm(i,{recursive:!0,force:!0}),{cwd:e,scriptPath:t.configPath,status:"failed",startedAt:s,finishedAt:Date.now(),error:String(a),log:""}}}function z6(e,t){if(t==="darwin"){const n=e.darwin?.script;if(n&&n.length>0)return n}if(t==="linux"){const n=e.linux?.script;if(n&&n.length>0)return n}if(t==="win32"){const n=e.win32?.script;if(n&&n.length>0)return n}return e.script}async function tD(e,t,n,r,o,s){const a=["config",r==="local"?"--local":"--worktree",t,n],c=await re(e,a,o,{signal:s});return c.success||r!=="worktree"?c.success:!c.stderr.toLowerCase().includes("worktreeconfig")||!(await re(e,["config","extensions.worktreeConfig","true"],o,{signal:s})).success?!1:(await re(e,a,o,{signal:s})).success}async function Z6(e,t,n,r="worktree",o){return tD(e,M9,t,r,n,o)}const qp=Ot("syncedBranchConfig"),nD="codex-synced-branch.json",X6=ir({branch:lt(),lastSyncedTreeRef:lt()});async function rD(e,t,n){const r=await Bl(e,t,n);return r?le.join(r,nD):null}function Q6(e){try{const t=X6.safeParse(JSON.parse(e));return t.success?t.data:(qp().warning(`Invalid synced branch config: ${t.error.message??"unknown error"}`),null)}catch(t){return qp().warning(`Failed to parse synced branch config: ${String(t)}`),null}}async function Fl(e,t,n){const r=await rD(e,t,n);if(!r)return null;try{const o=await ur.readFile(r,t);return Q6(o)}catch(o){return o.code==="ENOENT"||qp().debug(`Failed to read synced branch config at ${r}: ${String(o)}`),null}}async function J6(e,t,n,r){const o=await rD(e,n,r);if(!o)throw new Error("No git repository found for synced branch config");const s=`${JSON.stringify(t,null,2)}
`;await ur.writeFile(o,s,n)}async function eJ(e,t,n,r,o){await J6(e,{branch:t,lastSyncedTreeRef:n},r,o)}async function tJ(e,t,n){return IT(e,nD,t,n)}function nJ(e){return e.startsWith("refs/")?e:`refs/heads/${e}`}async function rJ({gitManager:e,workspaceRoot:t,startingState:n,localEnvironmentConfigPath:r,hostConfig:o,signal:s,onLog:i}){if(s?.aborted)return{success:!1,error:new Error("Request canceled")};const c=(await e.getWorktreeRepository(t,o))?.root;if(!c)return{success:!1,error:new Error("Not a git repository")};if(s?.aborted)return{success:!1,error:new Error("Request canceled")};const[l,f]=await Promise.all([oJ(c,n,o,s),ec(c,o,s)]),d=f?.branch??null,u=l!=null&&l!==d,_=await W6(c,e,t,o);if(!_.success)return{success:!1,error:new Error("Failed to compute worktree path")};if(s?.aborted)return{success:!1,error:new Error("Request canceled")};const{worktreeGitRoot:p,worktreeWorkspaceRoot:E}=_,T=await Y6(c,p,n,e,o,{onLog:i,signal:s});if(!T.success)return{success:!1,error:T.error};if(s?.aborted)return{success:!1,error:new Error("Request canceled")};if(u&&l){const R=nJ(l),O=await MT(c,R,o,s);await eJ(p,R,O,o,s)}if(i?.("info",wn.Buffer.from(`Worktree created at ${E}
`,"utf8")),await Z6(E,r??P9,o,"worktree",s)||i?.("stderr",wn.Buffer.from(`Failed to store selected environment in git config
`,"utf8")),r==null)return i?.("info",wn.Buffer.from(`No local environment selected
`,"utf8")),{success:!0,worktreeGitRoot:p,worktreeWorkspaceRoot:E,setupResult:null};const A=await c6(r,o);if(A.type==="error")return i?.("stderr",wn.Buffer.from(`${A.error.message}
`,"utf8")),{success:!1,error:A.error};i?.("info",wn.Buffer.from(`Running setup script ${A.configPath}
`,"utf8"));const g=await K6(p,A,(R,O)=>{i?.(R,O)},s);return s?.aborted?{success:!1,error:new Error("Request canceled")}:g?.status==="failed"?(i?.("stderr",wn.Buffer.from(`${g.error??"Setup script failed"}
`,"utf8")),{success:!1,error:new Error(g.error??"Setup script failed")}):(g?.status==="succeeded"&&i?.("info",wn.Buffer.from(`Setup script completed
`,"utf8")),{success:!0,worktreeGitRoot:p,worktreeWorkspaceRoot:E,setupResult:g??null})}async function oJ(e,t,n,r){return t.type==="branch"?t.branchName:Yo(e,n,r)}async function sJ(e,t,n){if(!Ue(t)&&!de.existsSync(e))throw new Error(`ENOENT: path does not exist: ${e}`);const{success:r,stdout:o,stderr:s,code:i}=await re(e,["rev-parse","--git-common-dir"],t,{signal:n});if(r&&o){const a=dn(t),c=a.isAbsolute(o)?o:a.resolve(e,o);return c}if(i===128&&s.toLowerCase().includes("not a git repository"))return null;throw new Error(`Failed to resolve git common dir: ${s||o||"Unknown error"}`)}async function iJ(e,t,n){const r=await re(e,["status","--porcelain=v1","-z"],t,{trim:!1,signal:n});if(!r.success)return{type:"error"};let o=0,s=0,i=0;const a=r.stdout;let c=0;for(;c<a.length&&!(c+1>=a.length);){const l=a[c],f=a[c+1];l==="?"&&f==="?"?i+=1:(l!==" "&&(o+=1),f!==" "&&(s+=1));const d=a.indexOf("\0",c);if(d===-1)break;if(c=d+1,l==="R"||l==="C"||f==="R"||f==="C"){const u=a.indexOf("\0",c);if(u===-1)break;c=u+1}}return{type:"success",stagedCount:o,unstagedCount:s,untrackedCount:i}}async function oD(e,t,n,r){const o=t.trim();if(!o)return null;const s=async T=>(await re(e,["rev-parse","--verify","--quiet",T],n,{signal:r})).success,i=[],a=new Set,c=async T=>{const h=T?.trim();!h||a.has(h)||await s(h)&&(i.push(h),a.add(h))},l=await re(e,["for-each-ref","--format=%(upstream:short)",`refs/heads/${o}`],n,{signal:r}),f=l.success?l.stdout.trim():null;await c(f),await c(o);const d=await re(e,["remote"],n,{signal:r});if(d.success&&d.stdout){const T=d.stdout.split(`
`).map(C=>C.trim()).filter(C=>C.length>0),h=new Set(T),m=o.indexOf("/"),A=m>0?o.slice(0,m):null,g=A!=null&&h.has(A),R=g&&m+1<o.length?o.slice(m+1):null,O=[];for(const C of T){if(g&&C===A){R&&O.push(c(`refs/remotes/${C}/${R}`));continue}O.push(c(`${C}/${o}`),c(`refs/remotes/${C}/${o}`))}await Promise.all(O)}const u=i[0];if(!u)return null;const{success:_,stdout:p}=await re(e,["merge-base","HEAD",u],n,{signal:r});if(!_||!p)return null;const E=p.trim();return E.length>0?E:null}async function aJ(e,t,n){const r=await on(e,[],t,{trim:!1,allowedNonZeroExitCodes:[0,1],signal:n});return r.outputLimitExceeded||!r.success?{type:"error",error:nr(r)}:{type:"success",unifiedDiff:r.stdout}}function sD(e,t,n){const r=qu(le.relative(e,t));return n.map(o=>{const s=qu(o),a=r.length>0&&(s===r||s.startsWith(`${r}/`))?e:t;return ZL(e,a,o)})}async function cJ(e,t,n,r,o){const i=(await t.getWorktreeRepository(e,n))?.root;if(!i)return{stagedChanges:{type:"error",error:{type:"unknown"}},unstagedChanges:{type:"error",error:{type:"unknown"}}};const a=o==null?null:sD(i,e,o);if(a!=null){if(a.length===0)return{stagedChanges:{type:"success",unifiedDiff:""},unstagedChanges:{type:"success",unifiedDiff:""}};const[f,d]=await Promise.all([on(i,["--cached","--",...a],n,{trim:!1,allowedNonZeroExitCodes:[0,1],signal:r}),on(i,["--",...a],n,{trim:!1,allowedNonZeroExitCodes:[0,1],signal:r})]);return{stagedChanges:J_(f),unstagedChanges:J_(d)}}const[c,l]=await Promise.all([on(i,["--cached"],n,{trim:!1,allowedNonZeroExitCodes:[0,1],signal:r}),aJ(i,n,r)]);return{stagedChanges:J_(c),unstagedChanges:l}}function J_(e){return e.outputLimitExceeded||!e.success?{type:"error",error:nr(e)}:{type:"success",unifiedDiff:e.stdout}}async function uJ(e,t,n,r,o){const s=await bT(e,n,r);if(!s)return{untrackedChanges:{type:"error",error:{type:"unknown"}}};const i=o==null?null:sD(s,e,o);return i!=null&&i.length===0?{untrackedChanges:{type:"success",unifiedDiff:""}}:i==null?{untrackedChanges:await Yp(s,t,n)}:{untrackedChanges:await Yp(s,t,n,{includePaths:i})}}async function lJ({cwd:e},t,n){const r=String(e).trim();if(!r)throw new Error("Workspace root is required");const o=await re(r,["init"],n);if(!o.success)throw new Error(o.stderr||o.stdout||"Failed to run git init");return t.invalidateStableMetadata(),{success:!0}}async function iD(e,t,n,r){const o=await re(e,["config","--get",...t],n,{signal:r});return o.success&&o.stdout?o.stdout:null}async function dJ(e,t,n,r,o){const a=await re(e,["config",n==="local"?"--local":"--worktree","--get",t],r,{signal:o});return a.success&&a.stdout?a.stdout:null}async function fJ(e,t,{includePaths:n,signal:r}={}){const o=["ls-files","--others","--exclude-standard","-z"];n&&n.length>0&&o.push("--",...n);const s=await re(e,o,t,{trim:!1,signal:r});return s.success?{success:!0,paths:s.stdout.split("\0").map(a=>a.trim()).filter(a=>a.length>0)??[],gitRoot:e}:{success:!1,paths:[],gitRoot:e}}class _J{constructor(t,n){this.root=t,this.hostConfig=n}async getConfigValue(t,n){return iD(this.root,[t],this.hostConfig,n)}async getConfigValueForScope(t,n,r){return dJ(this.root,t,n,this.hostConfig,r)}async setConfigValueForScope(t,n,r,o){return tD(this.root,t,n,r,this.hostConfig,o)}getUntrackedPaths=xl(async t=>fJ(this.root,this.hostConfig,{includePaths:t}),{primitive:!0,promise:!0,maxAge:1e4})}class pJ{constructor(t,n){this.commonDir=t,this.hostConfig=n}worktreesByRoot=new Map;getCommonDir(){return this.commonDir}getRepository(t){const n=this.worktreesByRoot.get(t);if(n)return n;const r=new _J(t,this.hostConfig);return this.worktreesByRoot.set(t,r),r}getOriginUrl=xl(async t=>await iD(this.commonDir,["remote.origin.url"],this.hostConfig,t),{length:0,promise:!0,maxAge:ST})}function hI(e){return e?.id??"local"}class EJ{reposByKey=new Map;async getRepoRepository(t,n){const r=await this.getStableMetadata(t,n);return r?this.getOrCreateRepo(r.commonDir,n):null}async getWorktreeRepository(t,n){const[r,o]=await Promise.all([this.getRepoRepository(t,n),this.getStableMetadata(t,n)]);return!r||!o?null:r.getRepository(o.root)}getRepoKey(t,n){return`${hI(n)}|${t}`}getOrCreateRepo(t,n){const r=this.getRepoKey(t,n),o=this.reposByKey.get(r);if(o)return o;const s=new pJ(t,n);return this.reposByKey.set(r,s),s}invalidateStableMetadata(){this.getStableMetadataMemoized.clear()}getStableMetadataMemoized=xl(async(t,n)=>{const r=await bT(t,n);if(!r)return null;const o=await sJ(r,n);return o?{root:r,commonDir:o}:null},{promise:!0,maxAge:ST,normalizer:([t,n])=>`${hI(n)}|${t}`});async getStableMetadata(t,n){return this.getStableMetadataMemoized(t,n)}}async function TJ(e,t){const n=[];for(const r of e)if(r)try{(await ur.stat(r,t)).isDirectory()&&n.push(r)}catch{continue}return n}async function Wp(e,t,n,{parentSha:r,message:o="Codex changes",coAuthor:s="Codex",signal:i}={}){const a=["commit-tree",t];r&&a.push("-p",r),a.push("-m",o),s&&a.push("-m",`Co-authored-by: ${s}`);const c=await re(e,a,n,{signal:i});return!c.success||!c.stdout?{success:!1,error:c}:{success:!0,commitSha:c.stdout}}const SI=1024;async function hJ({gitRoot:e,env:t,signal:n,hostConfig:r,untrackedPathsPromise:o}){if(!o)return re(e,["add","-A"],r,{env:t,signal:n});const s=await o;if(!s.success)return re(e,["add","-A"],r,{env:t,signal:n});const i=await re(e,["add","-u"],r,{env:t,signal:n});if(!i.success||s.paths.length===0)return i;for(const a of SJ(s.paths))if(!(await re(e,["add","--",...a],r,{env:t,signal:n})).success)return re(e,["add","-A"],r,{env:t,signal:n});return i}function SJ(e){const t=[];for(let n=0;n<e.length;n+=SI)t.push(e.slice(n,n+SI));return t}const mJ="GIT_INDEX_FILE";async function aD(e,t,n){const r=await AJ(n);try{const o=await zL(r,e,n),s={[mJ]:o};return await t(s)}finally{await gJ(r,n)}}async function AJ(e){if(!Ue(e))return de.promises.mkdtemp(le.join(qo.tmpdir(),"codex-index-"));const t=await cr({hostConfig:e,args:["sh","-lc",'mktemp -d "${TMPDIR:-/tmp}/codex-index-XXXXXX"'],timeoutMs:1e4}),{code:n,stdout:r,stderr:o}=await t.wait();if(n!==0||!r.trim()){const s=n==null?`${o}ssh command timed out`:o||r;throw new Error(`failed to create remote temp dir: ${s}`.trim())}return r.trim()}async function gJ(e,t){if(!Ue(t)){await de.promises.rm(e,{recursive:!0,force:!0});return}await(await cr({hostConfig:t,args:["sh","-lc",`rm -rf ${Gt(e)}`],timeoutMs:1e4})).wait()}async function _c(e,t){const n=t?.hostConfig??null,r=await CT(e,n);if(!r)throw new Error("Failed to resolve git index path");return aD(r,async o=>{const s=await hJ({gitRoot:e,env:o,signal:t?.signal,hostConfig:n,untrackedPathsPromise:t?.untrackedPathsPromise});if(!s.success)throw new Error(s.stderr||s.stdout||"Failed to stage working tree snapshot");const i=await re(e,["write-tree"],n,{env:o,signal:t?.signal}),a=i.success?i.stdout.trim():null;if(a){if(!yc(a))throw new Error(`Unexpected tree SHA: ${a}`)}else throw new Error("Failed to write working tree snapshot");return a},n)}function yc(e){return/^[0-9a-f]{7,40}$/i.test(e)}const cD=Ot("worktree-snapshot"),RJ="refs/codex/snapshots";async function NJ(e,t,n,r,o){const s=await e.getStableMetadata(t,n);if(!s)throw new Error(`Not in a git repository: ${t}`);const i=vT(s.root),a=PT(i),c=await _c(s.root,{hostConfig:n,signal:o}),l=await re(s.root,["rev-parse","HEAD"],n,{allowedNonZeroExitCodes:[128],signal:o}),f=l.success&&l.stdout?l.stdout.trim():null;let d=f;if(f){if((await MT(s.root,f,n,o)).trim()!==c){const p=await Wp(s.root,c,n,{parentSha:f,message:mI(r),signal:o});if(!p.success)throw new Error("Failed to create synthetic commit");d=p.commitSha.trim()}}else{const _=await Wp(s.root,c,n,{message:mI(r),signal:o});if(!_.success)throw new Error("Failed to create synthetic commit");d=_.commitSha.trim()}if(!d)throw new Error("Failed to compute snapshot commit");if(!(await re(s.root,["update-ref",a,d],n,{env:{GIT_TERMINAL_PROMPT:"0"},signal:o})).success)throw new Error("Failed to update ref");return cD().debug(`[worktree-snapshot] ${a} -> ${d} (${s.root})`),{snapshotRef:a,worktreeId:i,repoRoot:s.root,commonDir:s.commonDir,commitSha:d}}async function yJ(e,t,n,r,o){const s=n,i=vT(s),a=PT(i),c=await TJ(t,r);if(c.length===0)throw new Error("No candidate workspace roots exist on disk");const l=(await Promise.all(c.map(async d=>{try{return await e.getStableMetadata(d,r)}catch{return null}}))).filter(d=>!!d);if(l.length===0)throw new Error("No candidate workspace roots are valid git repositories");const f=await Promise.all(l.map(async d=>{const u=await re(d.root,["show-ref","--verify","--hash",a],r,{allowedNonZeroExitCodes:[128,1],env:{GIT_TERMINAL_PROMPT:"0"},signal:o});return{metadata:d,showRefResult:u}}));for(const{metadata:d,showRefResult:u}of f)if(!(u.code===128||u.code===1)){if(!u.success||!u.stdout)throw new Error(u.stderr||u.stdout||"Failed to resolve snapshot ref");return{snapshotRef:a,worktreeId:i,repoRoot:d.root,commonDir:d.commonDir,exists:!0,commitSha:u.stdout.trim()}}return{snapshotRef:a,worktreeId:i,exists:!1,commitSha:null}}async function OJ(e,t,n,r){const o=vT(t),s=PT(o),i=await re(e,["worktree","add","--detach",t,s],n,{env:{GIT_TERMINAL_PROMPT:"0"},signal:r});if(!i.success)throw new Error(i.stderr||i.stdout||"Failed to restore worktree");const a=await FL(t,n);if(!a.success){try{await ju(t,n,!0)}catch{await de.promises.rm(t,{recursive:!0,force:!0})}throw new Error(a.error.message)}return cD().debug(`[worktree-restore] restored ${t} from ${s}`),!0}function PT(e){return`${RJ}/${e}`}function vT(e){return nc.createHash("sha1").update(e).digest("hex")}function mI(e){return`Codex worktree snapshot: ${e}`}const bJ=ir({state:lt().optional(),number:Xa().optional(),url:lt().optional()});kl(bJ);Wo.promisify(Tc.execFile);const AI={error:0,warning:1,info:2,debug:3,trace:4};function IJ(e,t){return AI[e]<=AI[t]}Wo.promisify(Tc.execFile);ir({title:lt(),body:lt()});async function CJ({root:e,diff:t,gitManager:n,hostConfig:r,signal:o,logger:s}){const i=await CT(e,r);return i?aD(i,a=>gI(e,t,n,r,o,s,a),r):(s&&s.warning(`Unable to resolve git index path for ${e}`),gI(e,t,n,r,o,s))}async function gI(e,t,n,r,o,s,i){return(await MJ(e,t,r,o,i)).success||s&&s.error(`Failed to stage target worktree changes in ${e}`),QL({cwd:e,diff:t,allowBinary:!0,revert:!1,env:i},n,r,{signal:o})}async function MJ(e,t,n,r,o){const s=XL(t);if(s.length===0)return{success:!0,command:"git add",stdout:"",stderr:""};const i=await PJ(e,s,n);return i.length===0?{success:!0,command:"git add",stdout:"",stderr:""}:re(e,["add","--",...i],n,{env:o,signal:r})}async function PJ(e,t,n){const r=dn(n),o=[];return await Promise.all(t.map(async s=>{const i=r.join(e,s);try{await ur.stat(i,n),o.push(s)}catch{return}})),o}async function vJ({sourceHeadRef:e,sourceTreeRef:t,destinationRoot:n,destinationHeadRef:r,gitManager:o,hostConfig:s,signal:i}){const a=SL("applyChanges"),c=await LJ(n,e,r,s,i);if(!c)return{status:"command-error"};const l=await on(n,[c,t],s,{binary:!0,trim:!1,allowedNonZeroExitCodes:[0,1],signal:i});if(l.outputLimitExceeded||!l.success)return{status:"command-error",execOutput:Jn(l)};const f=l.stdout;if(!f)return{status:"success"};const d=await CJ({root:n,diff:f,gitManager:o,hostConfig:s,signal:i,logger:a});return d.status==="error"?{status:"command-error",execOutput:d.execOutput}:d.status==="partial-success"?{status:"partial-success",appliedPaths:d.appliedPaths,skippedPaths:d.skippedPaths,conflictedPaths:d.conflictedPaths}:{status:"success"}}async function LJ(e,t,n,r,o){const s=await re(e,["merge-base",t,n],r,{allowedNonZeroExitCodes:[1],signal:o});if(!s.success||!s.stdout)return null;const i=s.stdout.trim();return i?i:null}function DJ(...e){const t=[];let n=0;const r=o=>{const s=o.trim();if(s.length===0)return!0;const i=t.length>0?`
`:"",a=Buffer.byteLength(`${i}${s}`,"utf8");return n+a>rn?!1:(n+=a,t.push(s),!0)};for(const o of e)for(const s of o)if(!r(s))return{type:"error",error:{type:"diff-too-large",limitBytes:rn}};return{type:"success",sections:t}}async function wJ(e,t,n,r,o,s){if(!n||n.trim().length===0)return{type:"error",error:{type:"unknown"}};const i=await on(t,[n],o,{trim:!1,allowedNonZeroExitCodes:[0,1],signal:s});if(i.outputLimitExceeded||!i.success)return{type:"error",error:nr(i)};if(!r.success)return{type:"error",error:{type:"unknown"}};const a=await jL(e,r,o,s);if(!a.success)return{type:"error",error:a.error};const c=DJ([i.stdout],a.sections);return c.type==="error"?{type:"error",error:c.error}:{type:"success",unifiedDiff:c.sections.join(`
`)}}function jo(e){return e.startsWith("refs/heads/")?e.slice(11):e}async function UJ(e,t,n,r){const o=await e.getWorktreeRepository(t,n),s=o?.root;if(!s)return{gitRoot:null,branch:null,baseBranch:null,baseBranchRemote:null,branchChanges:{type:"error",error:{type:"unknown"}}};const[i,a]=await Promise.all([Yo(s,n,r),ec(s,n,r)]);let c=i;if(!c){const T=await Fl(t,n,r);c=T?jo(T.branch):null}if(!a)return{gitRoot:s,branch:c,baseBranch:null,baseBranchRemote:null,branchChanges:{type:"error",error:{type:"unknown"}}};const{branch:l,remote:f}=a,d=l,u=d.includes("/")?d:`${f}/${d}`,_=await oD(s,u,n,r);if(!_)return{gitRoot:s,branch:c,baseBranch:d,baseBranchRemote:f,branchChanges:{type:"error",error:{type:"unknown"}}};const p=await o.getUntrackedPaths(),E=await wJ(s,t,_,p,n,r);return{gitRoot:s,branch:c,baseBranch:d,baseBranchRemote:f,branchChanges:E}}const kJ=/^\d{6}-\d{4}-[0-9a-f]{8}$/i,GJ=/^[0-9a-f]{4}$/i;async function VJ(){const e=JL();let t=[];try{t=await de.promises.readdir(e,{withFileTypes:!0})}catch{return[]}const n=t.filter(i=>i.isDirectory()),r=await Promise.all(n.map(async i=>{const a=le.join(e,i.name);try{const c=await de.promises.readdir(a,{withFileTypes:!0});return{parentName:i.name,parentPath:a,worktreeEntries:c}}catch{return null}})),o=[];for(const i of r){if(!i)continue;const a=GJ.test(i.parentName);for(const c of i.worktreeEntries){if(!c.isDirectory()||!a&&!kJ.test(c.name))continue;const l=le.join(i.parentPath,c.name),f=l;f&&o.push(HL(l).then(async d=>await h6(l,d)?{dir:f,gitDir:d}:null))}}return(await Promise.all(o)).filter(i=>i!=null)}const xJ=Ot("git");async function $J(e,t,n){const r=await Bl(e,t,n);if(!r)return{lastModified:0};const o=le.join(r,"index");try{return{lastModified:(await de.promises.stat(o)).mtimeMs}}catch(s){return s.code==="ENOENT"?{lastModified:0}:(xJ().error(`Failed to read index info for ${o}: ${String(s)}`),{lastModified:0})}}async function RI(e,t,n,r){const{success:o,stdout:s}=await re(e,["for-each-ref",`--count=${t}`,"--sort=-committerdate","refs/heads","--format=%(refname:short)"],n,{signal:r});return!o||!s?[]:s.split(`
`).map(i=>i.trim()).filter(i=>i.length>0)}async function BJ(e,t,n){const r=await re(e,["config","--file",".gitmodules","--get-regexp","path"],t,{allowedNonZeroExitCodes:[1],signal:n});if(!r.success||!r.stdout)return[];const o=r.stdout.split(`
`).map(s=>s.trim()).filter(s=>s.length>0).map(s=>{const i=s.split(/\s+/),a=i[i.length-1]??"";return qu(a)}).filter(s=>s.length>0);return Array.from(new Set(o))}async function HJ(e,t,n){return{trackedChanges:await qL(e,t,n)}}async function uD(e,t,n){const r=await re(e,["worktree","list","--porcelain"],t,{signal:n});if(!r.success)throw new Error(r.stderr||r.stdout||"Failed to list worktrees for repository");return FJ(r.stdout??"")}function FJ(e){const t=[];let n=null;const r=e.split(/\r?\n/);for(const o of r){const s=o.trim();if(s.length===0){n&&(t.push(n),n=null);continue}if(s.startsWith("worktree ")){n&&t.push(n);const i=s.slice(9).trim();if(!i){n=null;continue}n={root:i,prunable:!1,locked:!1,headRef:{sha:"",type:"detached"}};continue}if(n){if(s.startsWith("HEAD ")){const i=s.slice(5).trim();n.headRef={sha:i,type:"detached"};continue}if(s.startsWith("branch ")){const i=s.slice(7).trim();i.startsWith("refs/heads/")?n.headRef={sha:n.headRef.sha,type:"branch",string:i.slice(11)}:n.headRef={sha:n.headRef.sha,type:"branch",string:i};continue}if(s==="detached"){n.headRef={sha:n.headRef.sha,type:"detached"};continue}if(s.startsWith("prunable")){n.prunable=!0;continue}s.startsWith("locked")&&(n.locked=!0)}}return n&&t.push(n),t}const YJ=new RegExp("(?<=\\n)"),jJ=/^0+$/,Wu=3e4;async function qJ(e,{cwd:t,oid:n,path:r,fallbackToDisk:o},s,i){const a=Ue(s);try{const c=await e.getStableMetadata(t,s);if(!c)return{type:"error",error:{type:"unknown"}};const l=String(c.root),d=dn(s).join(l,r);if(!WJ(n))return o?yI(d,s):{type:"error",error:{type:"not-found"}};const u=await zJ(l,n,s,i,a);return u.type==="success"?u:o&&u.error.type==="not-found"?yI(d,s):u}catch(c){return c.code==="ENOENT"?{type:"error",error:{type:"not-found"}}:{type:"error",error:{type:"unknown"}}}}function lD(e){return e.includes("No such file")||e.includes("cannot open")||e.includes("not found")}function Kp(e){const t=e.split(YJ);return t.length===1&&t[0]===""?[]:(t.at(-1)===""&&t.pop(),t)}function WJ(e){return e?!jJ.test(e):!1}function NI(e){return e.code===128?"not-found":"unknown"}async function KJ(e,t){if(Ue(t)){const{stdout:r,stderr:o,code:s}=await cr({hostConfig:t,args:["wc","-c",e],timeoutMs:Wu}).then(c=>c.wait());if(s!==0){if(lD(o)){const c=new Error(`File not found: ${e}`);throw c.code="ENOENT",c}throw new Error(`Failed to stat remote file: ${e}`)}const i=r.trim().split(/\s+/)[0],a=Number.parseInt(i??"",10);if(Number.isNaN(a))throw new Error(`Failed to parse file size for ${e}`);return a}return(await kI.stat(e)).size}async function yI(e,t){if(await KJ(e,t)>rn)return{type:"error",error:{type:"too-large",limitBytes:rn}};if(Ue(t)){const{stdout:o,stderr:s,code:i}=await cr({hostConfig:t,args:["cat",e],timeoutMs:Wu}).then(a=>a.wait());return i!==0?lD(s)?{type:"error",error:{type:"not-found"}}:{type:"error",error:{type:"unknown"}}:{type:"success",lines:Kp(o)}}const r=await kI.readFile(e,"utf8");return{type:"success",lines:Kp(r)}}async function zJ(e,t,n,r,o){const s=await re(e,["cat-file","-s",t],n,{signal:r,timeoutMs:o?Wu:void 0});if(!s.success)return{type:"error",error:{type:NI(s)}};const i=Number.parseInt(s.stdout,10);if(!Number.isNaN(i)&&i>rn)return{type:"error",error:{type:"too-large",limitBytes:rn}};const a=await re(e,["cat-file","-p",t],n,{maxOutputBytes:rn,signal:r,timeoutMs:o?Wu:void 0,trim:!1});return a.outputLimitExceeded?{type:"error",error:{type:"too-large",limitBytes:rn}}:a.success?{type:"success",lines:Kp(a.stdout)}:{type:"error",error:{type:NI(a)}}}async function LT(e,t,n,r){const o=await re(e,["rev-parse",t],n,{allowedNonZeroExitCodes:[128],signal:r}),s=o.success?o.stdout.trim():null;if(s&&!yc(s))throw new Error(`Unexpected ${t} SHA: ${s}`);return s?s:null}async function dD(e,t,n){const r=await LT(e,"HEAD",t,n);if(r&&!yc(r))throw new Error(`Unexpected HEAD SHA: ${r}`);return r?r:null}async function fD(e,t,n,r){const o=await LT(e,`${t}^{tree}`,n,r);if(o&&!yc(o))throw new Error(`Unexpected ${t} SHA: ${o}`);return o?o:null}const OI=1024;async function ZJ({gitRoot:e,targetRoot:t,branchName:n,headCommitSha:r,treeSha:o,targetCurrentBranch:s,hostConfig:i,signal:a}){const c=SL("syncedBranch.overwrite"),l=t?await dD(t,i,a):null,f=await fD(e,r,i,a);if(!f)return{status:"command-error"};const u=o&&o!==f&&(!t||!(!s||s===n));let _;if(u){const h=await Wp(e,o,i,{parentSha:r,signal:a});if(!h.success)return{status:"command-error",execOutput:Jn({command:"git commit-tree",stdout:"",stderr:h.error.stderr,fallbackOutput:h.error.stderr||h.error.stdout||"Failed to create synthetic commit"})};_=h.commitSha}else _=r;const[p,E]=await Promise.all([e&&_!==r?await re(e,["reset","--hard",_],i,{signal:a}):null,t?await re(t,["update-ref",s?`refs/heads/${s}`:"HEAD",_],i,{signal:a}):e?await re(e,["branch","-f",n,_],i,{signal:a}):null]),T=E&&!E.success?E:p?.success===!1?p:null;if(T){const h=T.stderr||T.stdout||"Failed to reset branch";return{status:"command-error",execOutput:Jn({command:T.command,stdout:T.stdout,stderr:T.stderr,fallbackOutput:h})}}if(t){const h=await re(t,["reset","--mixed","HEAD"],i,{signal:a});if(!h.success){const g=h.stderr||h.stdout||"Failed to reset index";return{status:"command-error",execOutput:Jn({command:h.command,stdout:h.stdout,stderr:h.stderr,fallbackOutput:g})}}const m=o?o:f;l&&await QJ({gitRoot:t,baseRef:l,treeToRestore:m,hostConfig:i,signal:a,logger:c});const A=await re(t,["restore","--source",m,"--worktree","--","."],i,{signal:a});if(!A.success){const g=A.stderr||A.stdout||"Failed to restore working tree";return{status:"command-error",execOutput:Jn({command:A.command,stdout:A.stdout,stderr:A.stderr,fallbackOutput:g})}}}return c.info("Synced branch applied to branch checkout"),{status:"success"}}async function XJ(e,t,n,r){let o=null;for(const s of JJ(t)){const i=await re(e,["clean","-fd","--",...s],n,{signal:r});if(!i.success){o=i;break}}return o}async function QJ({gitRoot:e,baseRef:t,treeToRestore:n,hostConfig:r,signal:o,logger:s}){const i=await re(e,["diff","--name-only","--diff-filter=D","--no-renames",t,n],r,{allowedNonZeroExitCodes:[1],signal:o});if(!i.success){s.warning("Failed to compute deleted paths before cleaning untracked files.");return}const a=i.stdout.length>0?i.stdout.split(`
`).map(l=>l.trim()).filter(l=>l.length>0):[];if(a.length===0)return;await XJ(e,a,r,o)&&s.warning("Failed to clean untracked files for deleted paths before restore.")}function JJ(e){const t=[];for(let n=0;n<e.length;n+=OI)t.push(e.slice(n,n+OI));return t}async function _D(e,t,n,r){return(await uD(e,n,r)).find(s=>s.headRef.type!=="branch"?!1:s.headRef.string===t)?.root??null}const e8=Ot("git");async function t8(e,t,n,r){const s=(await t.getWorktreeRepository(e,n))?.root;if(!s)return{gitRoot:null,branch:null,base:null,unsyncedChanges:{type:"error",error:{type:"unknown"}},branchChanges:{type:"error",error:{type:"unknown"}}};const i=await Fl(e,n,r);if(!i)return{gitRoot:s,branch:null,base:null,unsyncedChanges:{type:"error",error:{type:"unknown"}},branchChanges:{type:"error",error:{type:"unknown"}}};try{const a=jo(i.branch),[c,l,f,d]=await Promise.all([MT(s,i.lastSyncedTreeRef,n,r),_c(s,{hostConfig:n,signal:r}),fD(s,i.branch,n,r),_D(s,a,n,r)]),_=(d?await _c(d,{hostConfig:n,signal:r}):null)??f,[p,E]=await Promise.all([on(s,[c,l],n,{trim:!1,allowedNonZeroExitCodes:[0,1],signal:r}),_?on(s,[c,_],n,{trim:!1,allowedNonZeroExitCodes:[0,1],signal:r}):Promise.resolve(null)]),T=E?E.outputLimitExceeded||!E.success?{type:"error",error:nr(E)}:{type:"success",unifiedDiff:E.stdout}:{type:"error",error:{type:"unknown"}};return p.outputLimitExceeded||!p.success?{gitRoot:s,branch:a,base:i.lastSyncedTreeRef,unsyncedChanges:{type:"error",error:nr(p)},branchChanges:T}:{gitRoot:s,branch:a,base:i.lastSyncedTreeRef,unsyncedChanges:{type:"success",unifiedDiff:p.stdout},branchChanges:T}}catch(a){return e8().warning(`failed to collect synced branch changes: ${String(a)}`),{gitRoot:s,branch:jo(i.branch),base:i.lastSyncedTreeRef,unsyncedChanges:{type:"error",error:{type:"unknown"}},branchChanges:{type:"error",error:{type:"unknown"}}}}}async function n8(e,t,n){const r=await re(e,["ls-files","-u"],t,{signal:n});return r.success?r.stdout.trim().length>0:!1}async function r8(e,t,n){const r=await Fl(e,t,n);if(!r)return{branch:null,base:null,hasConflicts:!1};const o=await n8(e,t,n);return{branch:jo(r.branch),base:r.lastSyncedTreeRef,hasConflicts:o}}const pD={filesChanged:0,linesAdded:0,linesRemoved:0};async function bI(e,t,n,r,o){const s=await on(e,["--numstat",t,n],r,{allowedNonZeroExitCodes:[0,1],signal:o});return!s.success||!s.stdout?pD:o8(s.stdout)}function o8(e){const t=e.trim();if(!t)return pD;let n=0,r=0,o=0;for(const s of t.split(/\r?\n/)){const i=s.trim();if(!i)continue;const[a,c,...l]=i.split("	");!a||!c||l.length===0||(n+=1,r+=II(a),o+=II(c))}return{filesChanged:n,linesAdded:r,linesRemoved:o}}function II(e){if(e==="-")return 0;const t=Number.parseInt(e,10);return Number.isFinite(t)?t:0}async function s8(e,t,n,r){const o=await LT(e,t,n,r);if(o&&!yc(o))throw new Error(`Unexpected ${t} SHA: ${o}`);return o?o:null}const i8=Ot("git");async function a8(e,t,n,r,o){const i=(await t.getStableMetadata(e,n))?.root??null;if(!i)throw new Error("Unable to resolve git root for synced branch status.");const a=await Fl(e,n,o);if(!a)throw new Error("No synced branch config found for the current worktree.");const c=jo(a.branch);try{const l=jo(a.branch);let f=null;r==="worktree-to-local"&&(f=_c(i,{hostConfig:n,signal:o}));const[d,u,_,p,E]=await Promise.all([_D(i,l,n,o),dD(i,n,o),f??Promise.resolve(null),s8(i,a.branch,n,o),Yo(i,n,o)]);if(E)throw new Error("Worktree has a branch checked out.");if(u){if(!p)throw new Error("Unable to resolve synced branch head SHA.")}else throw new Error("Unable to resolve worktree head state.");let T=null;r==="local-to-worktree"&&(T=d?_c(d,{hostConfig:n,signal:o}):Promise.resolve(c));const h=KL(i,p,u,n,o),[m,A]=await Promise.all([h,T??Promise.resolve(null)]);let g;if(r==="worktree-to-local"){if(!_)throw new Error("Unable to resolve worktree working tree ref.");g={...await bI(i,u,_,n,o),leftRef:u,rightRef:_,commitsAhead:m?.rightAhead??0}}else{if(!A)throw new Error("Unable to resolve branch working tree ref.");g={...d?await bI(d,p,A,n,o):{filesChanged:0,linesAdded:0,linesRemoved:0},leftRef:p,rightRef:A,commitsAhead:m?.leftAhead??0}}return{branch:a.branch,direction:r,worktreeSnapshot:{root:i,headCommitSha:u,workingTreeRef:_??void 0},branchSnapshot:d?{checkedOut:!0,snapshot:{root:d,headCommitSha:p,workingTreeRef:A??void 0}}:{checkedOut:!1,headCommitSha:p},diffStats:g}}catch(l){throw i8().warning(`failed to collect synced branch status: ${String(l)}`),l}}class c8{constructor(t){this.emit=t}}async function u8(e,t){return IT(e,"HEAD",t)}class l8{constructor(t){this.options=t,this.emitHeadChangedDebounced=X_(()=>{const n={type:"git-repo-changed",changeType:"head",commonDir:this.options.commonDir,root:this.options.root};this.options.emit({type:"worker-event",event:n})},500),this.emitRemoteRefsChangedDebounced=X_(()=>{const n={type:"git-repo-changed",changeType:"remote-refs",commonDir:this.options.commonDir,root:this.options.root};this.options.emit({type:"worker-event",event:n})},500),this.emitSyncedBranchChangedDebounced=X_(()=>{const n={type:"git-repo-changed",changeType:"synced-branch",commonDir:this.options.commonDir,root:this.options.root};this.options.emit({type:"worker-event",event:n})},500)}logger=$l("git-repo-watcher");watchers=[];emitHeadChangedDebounced;emitRemoteRefsChangedDebounced;emitSyncedBranchChangedDebounced;async start(){this.logger.info(`Starting git repo watcher for ${this.options.root}`);const t=await u8(this.options.root,this.options.hostConfig),n=await tJ(this.options.root,this.options.hostConfig);await this.tryWatch(t,this.emitHeadChangedDebounced),await this.tryWatch(le.join(this.options.commonDir,"FETCH_HEAD"),this.emitRemoteRefsChangedDebounced),await this.tryWatch(le.join(this.options.commonDir,"packed-refs"),this.emitRemoteRefsChangedDebounced),await this.tryWatch(n,this.emitSyncedBranchChangedDebounced)}dispose(){this.watchers.forEach(t=>{t.close()}),this.watchers.length=0}async tryWatch(t,n){if(t)try{const r=le.dirname(t),o=le.basename(t);let s=await CI(t);const i=de.watch(r,(a,c)=>{c&&c!==o||CI(t).then(l=>{a!=="rename"&&l===s||(s=l,this.logger.debug(`Git repo changed: ${t}`),n())})});this.watchers.push(i)}catch(r){this.logger.warning("Failed to watch git path",{path:t,error:r})}}}async function CI(e){try{return(await de.promises.stat(e)).mtimeMs}catch{return null}}const d8=Ot("git");class f8 extends c8{constructor(t,n){super(t),this.gitManager=n}watchesByKey=new Map;inFlightRequests=new Map;canceledRequests=new Set;uncancelableRequestIds=new Set;worktreeDeletePromises=new Map;async handleRequest(t){const n=new AbortController,r=t.params.hostConfig??null,o=t.method!=="delete-worktree"&&t.method!=="invalidate-stable-metadata"&&t.method!=="git-init-repo";if(o){if(this.inFlightRequests.set(t.id,n),this.canceledRequests.has(t.id)){this.canceledRequests.delete(t.id),n.abort(),this.inFlightRequests.delete(t.id);return}}else this.uncancelableRequestIds.add(t.id),this.canceledRequests.delete(t.id);let s;try{switch(t.method){case"stable-metadata":{s=await this.handleResolveStableMetadata(t.params,{hostConfig:r});break}case"current-branch":{const a=await Yo(t.params.root,r,n.signal);s=Oe({branch:a});break}case"upstream-branch":{const a=await this.handleUpstreamBranch(t.params,{hostConfig:r,signal:n.signal});s=Oe(a);break}case"branch-ahead-count":{const a=await this.handleBranchAheadCount(t.params,{hostConfig:r,signal:n.signal});s=Oe(a);break}case"default-branch":{s=await this.handleDefaultBranch(t.params,{hostConfig:r,signal:n.signal});break}case"base-branch":{s=await this.handleBaseBranch(t.params,{hostConfig:r,signal:n.signal});break}case"recent-branches":{s=await this.handleRecentBranches(t.params,{hostConfig:r,signal:n.signal});break}case"branch-changes":{const a=await UJ(this.gitManager,t.params.cwd,r,n.signal);s=Oe(a);break}case"status-summary":{const a=await iJ(String(t.params.cwd),r,n.signal);s=Oe(a);break}case"staged-and-unstaged-changes":{const a=await cJ(String(t.params.cwd),this.gitManager,r,n.signal,t.params.paths);s=Oe(a);break}case"untracked-changes":{const a=await uJ(String(t.params.cwd),this.gitManager,r,n.signal,t.params.paths);s=Oe(a);break}case"synced-branch":{const a=await r8(t.params.cwd,r,n.signal);s=Oe(a);break}case"synced-branch-changes":{const a=await t8(t.params.cwd,this.gitManager,r);s=Oe(a);break}case"synced-branch-state":{const a=await a8(t.params.cwd,this.gitManager,r,t.params.direction,n.signal);s=Oe(a);break}case"overwrite-repo":{const a=await ZJ({...t.params,hostConfig:r,signal:n.signal});s=Oe(a);break}case"invalidate-stable-metadata":{this.gitManager.invalidateStableMetadata(),s=Oe({success:!0});break}case"git-init-repo":{s=Oe(await lJ(t.params,this.gitManager,r));break}case"tracked-uncommitted-changes":{const a=await HJ(t.params.cwd,r,n.signal);s=Oe(a);break}case"submodule-paths":{const a=await BJ(t.params.root,r,n.signal);s=Oe({paths:a});break}case"cat-file":{const a=await qJ(this.gitManager,{cwd:t.params.cwd,oid:t.params.oid,path:t.params.path,fallbackToDisk:t.params.fallbackToDisk},r,n.signal);s=Oe(a);break}case"index-info":{const a=await $J(t.params.cwd,r,n.signal);s=Oe(a);break}case"config-value":{const a=await this.gitManager.getWorktreeRepository(t.params.root,r),c=a?await a.getConfigValueForScope(t.params.key,t.params.scope,n.signal):null;s=Oe({value:c});break}case"set-config-value":{const a=await this.gitManager.getWorktreeRepository(t.params.root,r),c=a?await a.setConfigValueForScope(t.params.key,t.params.value,t.params.scope,n.signal):!1;s=Oe({success:c});break}case"create-worktree":{s=await this.handleCreateWorktree(t.params,{hostConfig:r,signal:n.signal});break}case"codex-worktree":{try{const a=await VJ();s=Oe({worktrees:a})}catch(a){const c=a instanceof Error?a.message:String(a);s=xa(c)}break}case"list-worktrees":{const a=await uD(t.params.cwd,r,n.signal);s=Oe({worktrees:a});break}case"worktree-snapshot-ref":{const a=await yJ(this.gitManager,t.params.candidateRoots,t.params.worktreePath,r,n.signal);s=Oe(a);break}case"restore-worktree":{const a=await OJ(t.params.repoRoot,t.params.worktreePath,r,n.signal);s=Oe({success:a});break}case"delete-worktree":{const a=await this.scheduleWorktreeDelete(t.params);s=Oe({success:a});break}case"apply-changes":{const a=await vJ({...t.params,gitManager:this.gitManager,hostConfig:r,signal:n.signal});s=Oe(a);break}case"commit":{const a=String(t.params.cwd),l=(await this.gitManager.getStableMetadata(t.params.cwd,r))?.root??a;if(t.params.includeUnstaged){const _=await re(l,["add","-A"],r,{signal:n.signal});if(!_.success){const p=_.stderr||_.stdout||"Failed to stage changes";s=Oe({status:"error",error:p,execOutput:Jn({command:_.command,stdout:_.stdout,stderr:_.stderr,fallbackOutput:p})});break}}const f=await re(l,["commit","-m",t.params.message],r,{signal:n.signal});if(!f.success){const _=f.stderr||f.stdout||"Failed to commit changes";s=Oe({status:"error",error:_,execOutput:Jn({command:f.command,stdout:f.stdout,stderr:f.stderr,fallbackOutput:_})});break}const d=await re(l,["rev-parse","HEAD"],r,{signal:n.signal}),u=d.success?d.stdout:null;s=Oe({status:"success",commitSha:u});break}}}catch(a){s=xa(a)}finally{o?this.inFlightRequests.delete(t.id):this.uncancelableRequestIds.delete(t.id),this.canceledRequests.delete(t.id)}if(o&&n.signal.aborted)return;const i={id:t.id,method:t.method,result:s};this.emit({type:"worker-response",response:i})}async deleteWorktreeWithLimit(t){try{await NJ(this.gitManager,t.worktree,t.hostConfig,t.reason)}catch(n){const r=n instanceof Error?n.message:String(n);d8().warning(`[worktree-snapshot] failed to snapshot worktree ${t.worktree}: ${r}`)}return await ju(t.worktree,t.hostConfig,t.force??!1),!0}async scheduleWorktreeDelete(t){const r=`${t.hostConfig?.id??"local"}|${t.worktree}`,o=this.worktreeDeletePromises.get(r);if(o)return o;const s=this.deleteWorktreeWithLimit(t);this.worktreeDeletePromises.set(r,s);try{return await s}finally{this.worktreeDeletePromises.delete(r)}}async handleResolveStableMetadata(t,{hostConfig:n}){const r=await this.gitManager.getStableMetadata(t.cwd,n);if(!r)return xa("Not a git repository");const o={commonDir:r.commonDir,root:r.root};return await this.ensureWatching(o,n),Oe(o)}async handleUpstreamBranch(t,{hostConfig:n,signal:r}){const o=await Yo(t.root,n,r),s=await re(t.root,["rev-parse","--abbrev-ref","--symbolic-full-name","@{u}"],n,{signal:r,allowedNonZeroExitCodes:[128,1]}),i=s.success&&s.stdout?s.stdout:null;return i?{branch:o,upstream:{branch:i}}:{branch:o,upstream:null}}async handleBranchAheadCount(t,{hostConfig:n,signal:r}){const o=await ec(t.root,n,r),s=o?.branch??null;let i=o?.remote??null;i||(i=(await eD(t.root,n,r))[0]??null);const a=await re(t.root,["rev-parse","--abbrev-ref","--symbolic-full-name","@{u}"],n,{signal:r,allowedNonZeroExitCodes:[128,1]}),c=a.success&&a.stdout?a.stdout:null,l=async()=>{if(!c)return 0;const T=await re(t.root,["rev-list","--count",`${c}..HEAD`],n,{allowedNonZeroExitCodes:[128,1],signal:r});if(T.success&&T.stdout){const h=Number.parseInt(T.stdout,10);return Number.isNaN(h)?0:h}return 0},f=async()=>{if(!i)return null;const T=await re(t.root,["rev-list","--count","HEAD","--not",`--remotes=${i}`],n,{allowedNonZeroExitCodes:[128,1],signal:r});if(T.success&&T.stdout){const h=Number.parseInt(T.stdout,10);return Number.isNaN(h)?null:h}return null},d=async()=>{if(!s)return 0;const T=s.includes("/")?s:i?`${i}/${s}`:s,h=await oD(t.root,T,n,r);if(h){const m=await re(t.root,["rev-list","--count",`${h}..HEAD`],n,{allowedNonZeroExitCodes:[128,1],signal:r});if(m.success&&m.stdout){const A=Number.parseInt(m.stdout,10);return Number.isNaN(A)?0:A}}return 0},[u,_,p]=await Promise.all([l(),f(),d()]);let E=p;return _!=null?E=_:c!=null&&(E=u),{commitsAhead:E}}async handleDefaultBranch(t,{hostConfig:n,signal:r}){let s=(await ec(t.root,n,r))?.branch??null;return s||(s=(await RI(t.root,10,n,r)).find(a=>a==="main"||a==="master")??null),Oe({branch:s})}async handleBaseBranch(t,{hostConfig:n,signal:r}){const o=await ec(t.root,n,r);return Oe({local:o?.branch??null,remote:o?.remote??null})}async handleRecentBranches(t,{hostConfig:n,signal:r}){const o=Math.max(1,Math.min(t.limit??10,100)),s=await RI(t.root,o,n,r);return Oe({branches:s})}async handleCreateWorktree(t,{hostConfig:n,signal:r}){const o=this.emit.bind(this),s=t.streamId;if(!await this.gitManager.getRepoRepository(t.cwd,n))return xa("Not a git repository (not repo repository)");const a=await rJ({gitManager:this.gitManager,workspaceRoot:t.cwd,startingState:t.startingState,localEnvironmentConfigPath:t.localEnvironmentConfigPath,hostConfig:n,signal:r,onLog:(c,l)=>{r.aborted||o({type:"worker-event",event:{type:"create-worktree-stream",streamId:s,stream:c,data:l}})}});return a.success?Oe({worktreeGitRoot:a.worktreeGitRoot,worktreeWorkspaceRoot:a.worktreeWorkspaceRoot}):xa(a.error.message)}getWatchKey(t,n){return`${n?.id??"local"}|${t}`}async ensureWatching(t,n){const r=this.getWatchKey(t.root,n);if(this.watchesByKey.get(r))return;const s=new l8({commonDir:t.commonDir,root:t.root,hostConfig:n,emit:this.emit});this.watchesByKey.set(r,s),await s.start()}handleCancel(t){if(this.uncancelableRequestIds.has(t))return;const n=this.inFlightRequests.get(t);if(!n){this.canceledRequests.add(t);return}this.inFlightRequests.delete(t),n.abort()}}function _8(e,t,n){switch(e){case"git":return new f8(n,t)}}function p8(){const e=process.platform,t=process.env,n=qo.homedir();if(e==="darwin")return le.join(n,"Library","Logs","com.openai.codex");if(e==="win32"){const r=t.LOCALAPPDATA??le.join(n,"AppData","Local");return le.join(r,"Codex","Logs")}if(e==="linux"){const r=t.XDG_STATE_HOME??le.join(n,".local","state");return le.join(r,"codex","logs")}return le.join(n,".codex","logs")}const MI=10*1024*1024,PI=5,vI=1e4,E8=1024*1024,T8=15;function tc(e){return e.toString().padStart(2,"0")}function LI(e,t){const n=t.getUTCFullYear().toString(),r=tc(t.getUTCMonth()+1),o=tc(t.getUTCDate());return le.join(e,n,r,o)}function ep(e,t,n,r){return e>0?e:(n(new Error(`[file-logger] invalid ${r}`),{[r]:e}),t)}function DI(e,t,n,r,o){return`codex-desktop-${e}-${t}-t${n}-i${r}-${tc(o.getUTCHours())}${tc(o.getUTCMinutes())}${tc(o.getUTCSeconds())}`}let wI=0;function h8(){return wI+=1,wI}function S8(e,t,n,r){try{const o=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate())),s=new Date(o);s.setUTCDate(s.getUTCDate()-(n-1));for(const i of de.readdirSync(e)){if(!/^\d{4}$/.test(i))continue;const a=Number(i);if(!Number.isFinite(a))continue;const c=le.join(e,i);for(const l of de.readdirSync(c)){if(!/^\d{2}$/.test(l))continue;const f=Number(l);if(!Number.isFinite(f)||f<1||f>12)continue;const d=le.join(c,l);for(const u of de.readdirSync(d)){if(!/^\d{2}$/.test(u))continue;const _=Number(u);if(!Number.isFinite(_)||_<1||_>31)continue;new Date(Date.UTC(a,f-1,_))<s&&de.rmSync(le.join(d,u),{recursive:!0,force:!0})}de.readdirSync(d).length===0&&de.rmSync(d,{recursive:!0,force:!0})}de.readdirSync(c).length===0&&de.rmSync(c,{recursive:!0,force:!0})}}catch(o){r(new Error("[file-logger] failed to prune old logs"),{rootDir:e,retentionDays:n,error:o instanceof Error?o.message:String(o)})}}function m8(e,t={}){const n=(A,g)=>e.nonFatalReporter.reportNonFatal(A,{kind:"file-based-logger",extra:g}),r=e.rootDir??p8(),o=t.processId??process.pid,s=t.threadId??Ku.threadId??0,i=t.instanceId??h8(),a=e.appSessionId,c=t.now??(()=>new Date),l=e.maxSegmentBytes??MI,f=e.maxSegments??PI,d=e.pendingLineLimit??vI,u=e.highWaterMarkBytes??E8,_=T8,p=t.createStream??((A,g)=>de.createWriteStream(A,{flags:"w",highWaterMark:g})),E=ep(f,PI,n,"maxSegments"),T=ep(l,MI,n,"maxSegmentBytes"),h=ep(d,vI,n,"pendingLineLimit"),m={logLine:()=>{}};try{const A=c();let g=LI(r,A);de.mkdirSync(g,{recursive:!0}),S8(r,A,_,n);let R=DI(a,o,s,i,A);const O=ne=>le.join(g,`${R}-${ne}.log`);let C=!1;const I=ne=>{C=!0,n(new Error("[file-logger] stream error"),{error:ne instanceof Error?ne.message:String(ne),rootDir:r,appSessionId:a,processId:o,threadId:s,instanceId:i})},L=ne=>(ne.on("error",M=>{I(M)}),ne);let U=0,q=0,H=L(p(O(U),u)),$=[],B=0,F=!1,w=0;const k=()=>{const ne=c(),M=LI(r,ne);M!==g&&(g=M,de.mkdirSync(g,{recursive:!0}),R=DI(a,o,s,i,ne),H.end(),U=0,q=0,w=0,H=L(p(O(U),u)))},Y=()=>{H.end(),U=(U+1)%E,q=0,H=L(p(O(U),u))},oe=()=>{if(w===0)return;const ne=`[file-logger] dropped ${w} lines due to backpressure
`;$.push({text:ne,bytes:Buffer.byteLength(ne)}),w=0},ae=()=>{if(C){$=[],B=0,w=0;return}if(F)return;F=!0;let ne=!1;try{for(;!(B>=$.length&&(oe(),B>=$.length));){const M=$[B];q+M.bytes>T&&Y();const P=H.write(M.text);if(q+=M.bytes,B+=1,!P){ne=!0,H.once("drain",()=>{F=!1,ae()});return}}$=[],B=0}catch(M){n(new Error("[file-logger] write failed"),{error:M instanceof Error?M.message:String(M),rootDir:r,appSessionId:a,processId:o,threadId:s,instanceId:i,maxSegments:E,maxSegmentBytes:T,pendingLineLimit:h}),$=[],B=0}finally{F&&!ne&&(F=!1)}};return{logLine:ne=>{if(!C)try{!F&&$.length===0&&k();const M=`${ne}
`;if($.length-B>=h){w+=1;return}$.push({text:M,bytes:Buffer.byteLength(M)}),ae()}catch(M){n(new Error("[file-logger] logLine threw"),{error:M instanceof Error?M.message:String(M),rootDir:r,appSessionId:a,processId:o,threadId:s,instanceId:i})}}}}catch{return n(new Error("[file-logger] failed to initialize"),{rootDir:r,appSessionId:a,processId:o,threadId:s,instanceId:i}),m}}const A8={colors:!1,depth:8,maxArrayLength:100};function g8(...e){return Wo.formatWithOptions(A8,...e)}function R8(e,t){switch(e){case"error":console.error(t);break;case"warning":console.warn(t);break;case"info":console.info(t);break;case"debug":console.debug(t);break;case"trace":console.log(t);break}}function N8(e,t,n,r){const o=m8({appSessionId:n,nonFatalReporter:e}),s=c=>{const l=new Date().toISOString();o.logLine(`${l} ${c}`)},i=c=>(l,...f)=>{if(!IJ(c,r))return;const d=g8(l,...f);R8(c,d),s(`${c} ${d}`),t.log(c,d)},a={trace:i("trace"),debug:i("debug"),info:i("info"),warning:i("warning"),error:i("error")};tQ({trace:a.trace,debug:a.debug,info:a.info,warning:a.warning,error:a.error,log:(c,l,...f)=>{a[c](l,...f)},dispose:()=>{}}),iQ(()=>!1)}const y8="app:///";function O8(e,t){b8(e,t)}function b8(e,t){const n=$9(e.buildFlavor),r=V9(e.appVersion);mz({dsn:k9,environment:e.buildFlavor,release:r,dist:e.buildNumber??void 0,tracesSampleRate:n,integrations:o=>[...o,kV({root:t,prefix:y8})]}),q1("codex_app_session_id",e.codexAppSessionId),oQ({startSpan:(o,s)=>Jo(o,s)})}function I8(e,t,n){if(e==null){lg(null);return}lg({id:t??void 0,email:n??void 0,auth_method:e})}const{workerId:pc,sentryInitOptions:Mo,sentryRewriteFramesRoot:C8,maxLogLevel:M8}=Ku.workerData;O8(Mo,C8);const ED=a6((e,t,n)=>{xe(e,{level:t==="fatal"?"fatal":"error",tags:n.tags,extra:n.extra})}),TD=new s6({source:"codex-desktop",env:Mo.buildFlavor,codexAppSessionId:Mo.codexAppSessionId,buildInfo:{version:Mo.appVersion,buildNumber:Mo.buildNumber},reportFailure:e=>{ED.reportNonFatal("Datadog log sink failure",{kind:"datadog-log-sink-failure",tags:{failureType:e.type,reason:e.reason,workerId:pc},extra:{failure:e}})}});N8(ED,TD,Mo.codexAppSessionId,M8);const DT=Ku.parentPort;if(!DT)throw new Error("worker-entry must be run in a worker thread");const P8=new EJ,UI=_8(pc,P8,e=>{const t={...e,workerId:pc};DT.postMessage(t)});DT.on("message",e=>{if(e.type==="worker-sentry-user-update"){I8(e.authMethod,e.userId,e.email);const t=e.authMethod==null?null:{id:e.userId??void 0,email:e.email??void 0,authMethod:e.authMethod};TD.setUserInfo(t);return}else if(e.workerId!==pc)return;switch(e.type){case"worker-request":{hT({op:"codex.worker.request",name:`${pc}.${e.request.method}`},()=>UI.handleRequest(e.request));return}case"worker-request-cancel":{UI.handleCancel(e.id);return}}});
//# sourceMappingURL=worker.js.map
