"use strict";var hk=Object.create;var qg=Object.defineProperty;var Ek=Object.getOwnPropertyDescriptor;var Tk=Object.getOwnPropertyNames;var Sk=Object.getPrototypeOf,mk=Object.prototype.hasOwnProperty;var gk=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Tk(t))!mk.call(e,s)&&s!==n&&qg(e,s,{get:()=>t[s],enumerable:!(r=Ek(t,s))||r.enumerable});return e};var Qd=(e,t,n)=>(n=e!=null?hk(Sk(e)):{},gk(t||!e||!e.__esModule?qg(n,"default",{value:e,enumerable:!0}):n,e));const Jl=require("node:worker_threads"),Mn=require("path"),ri=require("node:os"),he=require("node:path"),Hr=require("events"),iu=require("child_process"),me=require("node:fs"),ou=require("node:child_process"),Yg=require("node:string_decoder"),au=require("net"),GE=require("buffer"),Sr=require("stream"),ed=require("http"),VE=require("https"),sM=require("tty"),Gr=require("util"),cu=require("os"),Ak=require("dns"),iM=require("tls"),Wi=require("url"),$E=require("crypto"),Rk=require("zlib"),uu=require("fs"),xi=require("node:crypto"),cr=require("node:buffer"),Pi=require("node:process"),yk=require("assert"),lu=require("node:util"),Nk=require("node:net"),oM=require("node:fs/promises"),Ok=require("perf_hooks"),aM=require("module"),qh=require("worker_threads"),$n=require("node:diagnostics_channel"),bk=require("node:events"),cM=require("diagnostics_channel"),uM=require("async_hooks"),Ik=require("node:readline"),Ck=require("node:http"),vk=require("node:https"),Pk=require("node:stream"),Mk=require("node:zlib"),wk=require("node:tls");var Jd=typeof document<"u"?document.currentScript:null;function wn(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const n in e)if(n!=="default"){const r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:()=>e[n]})}}return t.default=e,Object.freeze(t)}const Gs=wn(Mn),jt=wn(ri),lM=wn(he),Lk=wn(lu),gi=wn(Nk),Dk=wn(aM),ll=wn($n),ef=wn(cM),dl=wn(Ck),Uk=wn(vk),Wg=wn(wk);var bn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function td(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function dM(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var n=function r(){var s=!1;try{s=this instanceof r}catch{}return s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var s=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:function(){return e[r]}})}),n}var tf={},Zr={},aa={},ca={},Jn={},Xr={},Qr={},ua={},Kg;function kk(){return Kg||(Kg=1,Object.defineProperty(ua,"__esModule",{value:!0}),ua._globalThis=void 0,ua._globalThis=typeof globalThis=="object"?globalThis:bn),ua}var zg;function xk(){return zg||(zg=1,(function(e){var t=Qr&&Qr.__createBinding||(Object.create?(function(r,s,i,o){o===void 0&&(o=i),Object.defineProperty(r,o,{enumerable:!0,get:function(){return s[i]}})}):(function(r,s,i,o){o===void 0&&(o=i),r[o]=s[i]})),n=Qr&&Qr.__exportStar||function(r,s){for(var i in r)i!=="default"&&!Object.prototype.hasOwnProperty.call(s,i)&&t(s,r,i)};Object.defineProperty(e,"__esModule",{value:!0}),n(kk(),e)})(Qr)),Qr}var Zg;function Bk(){return Zg||(Zg=1,(function(e){var t=Xr&&Xr.__createBinding||(Object.create?(function(r,s,i,o){o===void 0&&(o=i),Object.defineProperty(r,o,{enumerable:!0,get:function(){return s[i]}})}):(function(r,s,i,o){o===void 0&&(o=i),r[o]=s[i]})),n=Xr&&Xr.__exportStar||function(r,s){for(var i in r)i!=="default"&&!Object.prototype.hasOwnProperty.call(s,i)&&t(s,r,i)};Object.defineProperty(e,"__esModule",{value:!0}),n(xk(),e)})(Xr)),Xr}var la={},Xg;function fM(){return Xg||(Xg=1,Object.defineProperty(la,"__esModule",{value:!0}),la.VERSION=void 0,la.VERSION="1.9.0"),la}var Jr={},Qg;function Gk(){if(Qg)return Jr;Qg=1,Object.defineProperty(Jr,"__esModule",{value:!0}),Jr.isCompatible=Jr._makeCompatibilityCheck=void 0;const e=fM(),t=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function n(r){const s=new Set([r]),i=new Set,o=r.match(t);if(!o)return()=>!1;const c={major:+o[1],minor:+o[2],patch:+o[3],prerelease:o[4]};if(c.prerelease!=null)return function(d){return d===r};function a(f){return i.add(f),!1}function l(f){return s.add(f),!0}return function(d){if(s.has(d))return!0;if(i.has(d))return!1;const u=d.match(t);if(!u)return a(d);const _={major:+u[1],minor:+u[2],patch:+u[3],prerelease:u[4]};return _.prerelease!=null||c.major!==_.major?a(d):c.major===0?c.minor===_.minor&&c.patch<=_.patch?l(d):a(d):c.minor<=_.minor?l(d):a(d)}}return Jr._makeCompatibilityCheck=n,Jr.isCompatible=n(e.VERSION),Jr}var Jg;function Ki(){if(Jg)return Jn;Jg=1,Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.unregisterGlobal=Jn.getGlobal=Jn.registerGlobal=void 0;const e=Bk(),t=fM(),n=Gk(),r=t.VERSION.split(".")[0],s=Symbol.for(`opentelemetry.js.api.${r}`),i=e._globalThis;function o(l,f,d,u=!1){var _;const p=i[s]=(_=i[s])!==null&&_!==void 0?_:{version:t.VERSION};if(!u&&p[l]){const h=new Error(`@opentelemetry/api: Attempted duplicate registration of API: ${l}`);return d.error(h.stack||h.message),!1}if(p.version!==t.VERSION){const h=new Error(`@opentelemetry/api: Registration of version v${p.version} for ${l} does not match previously registered API v${t.VERSION}`);return d.error(h.stack||h.message),!1}return p[l]=f,d.debug(`@opentelemetry/api: Registered a global for ${l} v${t.VERSION}.`),!0}Jn.registerGlobal=o;function c(l){var f,d;const u=(f=i[s])===null||f===void 0?void 0:f.version;if(!(!u||!(0,n.isCompatible)(u)))return(d=i[s])===null||d===void 0?void 0:d[l]}Jn.getGlobal=c;function a(l,f){f.debug(`@opentelemetry/api: Unregistering a global for ${l} v${t.VERSION}.`);const d=i[s];d&&delete d[l]}return Jn.unregisterGlobal=a,Jn}var eA;function Vk(){if(eA)return ca;eA=1,Object.defineProperty(ca,"__esModule",{value:!0}),ca.DiagComponentLogger=void 0;const e=Ki();class t{constructor(s){this._namespace=s.namespace||"DiagComponentLogger"}debug(...s){return n("debug",this._namespace,s)}error(...s){return n("error",this._namespace,s)}info(...s){return n("info",this._namespace,s)}warn(...s){return n("warn",this._namespace,s)}verbose(...s){return n("verbose",this._namespace,s)}}ca.DiagComponentLogger=t;function n(r,s,i){const o=(0,e.getGlobal)("diag");if(o)return i.unshift(s),o[r](...i)}return ca}var da={},nf={},tA;function HE(){return tA||(tA=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DiagLogLevel=void 0,(function(t){t[t.NONE=0]="NONE",t[t.ERROR=30]="ERROR",t[t.WARN=50]="WARN",t[t.INFO=60]="INFO",t[t.DEBUG=70]="DEBUG",t[t.VERBOSE=80]="VERBOSE",t[t.ALL=9999]="ALL"})(e.DiagLogLevel||(e.DiagLogLevel={}))})(nf)),nf}var nA;function $k(){if(nA)return da;nA=1,Object.defineProperty(da,"__esModule",{value:!0}),da.createLogLevelDiagLogger=void 0;const e=HE();function t(n,r){n<e.DiagLogLevel.NONE?n=e.DiagLogLevel.NONE:n>e.DiagLogLevel.ALL&&(n=e.DiagLogLevel.ALL),r=r||{};function s(i,o){const c=r[i];return typeof c=="function"&&n>=o?c.bind(r):function(){}}return{error:s("error",e.DiagLogLevel.ERROR),warn:s("warn",e.DiagLogLevel.WARN),info:s("info",e.DiagLogLevel.INFO),debug:s("debug",e.DiagLogLevel.DEBUG),verbose:s("verbose",e.DiagLogLevel.VERBOSE)}}return da.createLogLevelDiagLogger=t,da}var rA;function zi(){if(rA)return aa;rA=1,Object.defineProperty(aa,"__esModule",{value:!0}),aa.DiagAPI=void 0;const e=Vk(),t=$k(),n=HE(),r=Ki(),s="diag";class i{constructor(){function c(f){return function(...d){const u=(0,r.getGlobal)("diag");if(u)return u[f](...d)}}const a=this,l=(f,d={logLevel:n.DiagLogLevel.INFO})=>{var u,_,p;if(f===a){const T=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return a.error((u=T.stack)!==null&&u!==void 0?u:T.message),!1}typeof d=="number"&&(d={logLevel:d});const h=(0,r.getGlobal)("diag"),E=(0,t.createLogLevelDiagLogger)((_=d.logLevel)!==null&&_!==void 0?_:n.DiagLogLevel.INFO,f);if(h&&!d.suppressOverrideMessage){const T=(p=new Error().stack)!==null&&p!==void 0?p:"<failed to generate stacktrace>";h.warn(`Current logger will be overwritten from ${T}`),E.warn(`Current logger will overwrite one already registered from ${T}`)}return(0,r.registerGlobal)("diag",E,a,!0)};a.setLogger=l,a.disable=()=>{(0,r.unregisterGlobal)(s,a)},a.createComponentLogger=f=>new e.DiagComponentLogger(f),a.verbose=c("verbose"),a.debug=c("debug"),a.info=c("info"),a.warn=c("warn"),a.error=c("error")}static instance(){return this._instance||(this._instance=new i),this._instance}}return aa.DiagAPI=i,aa}var fa={},sA;function Hk(){if(sA)return fa;sA=1,Object.defineProperty(fa,"__esModule",{value:!0}),fa.BaggageImpl=void 0;class e{constructor(n){this._entries=n?new Map(n):new Map}getEntry(n){const r=this._entries.get(n);if(r)return Object.assign({},r)}getAllEntries(){return Array.from(this._entries.entries()).map(([n,r])=>[n,r])}setEntry(n,r){const s=new e(this._entries);return s._entries.set(n,r),s}removeEntry(n){const r=new e(this._entries);return r._entries.delete(n),r}removeEntries(...n){const r=new e(this._entries);for(const s of n)r._entries.delete(s);return r}clear(){return new e}}return fa.BaggageImpl=e,fa}var _a={},iA;function Fk(){return iA||(iA=1,Object.defineProperty(_a,"__esModule",{value:!0}),_a.baggageEntryMetadataSymbol=void 0,_a.baggageEntryMetadataSymbol=Symbol("BaggageEntryMetadata")),_a}var oA;function _M(){if(oA)return Zr;oA=1,Object.defineProperty(Zr,"__esModule",{value:!0}),Zr.baggageEntryMetadataFromString=Zr.createBaggage=void 0;const e=zi(),t=Hk(),n=Fk(),r=e.DiagAPI.instance();function s(o={}){return new t.BaggageImpl(new Map(Object.entries(o)))}Zr.createBaggage=s;function i(o){return typeof o!="string"&&(r.error(`Cannot create baggage metadata from unknown type: ${typeof o}`),o=""),{__TYPE__:n.baggageEntryMetadataSymbol,toString(){return o}}}return Zr.baggageEntryMetadataFromString=i,Zr}var es={},aA;function nd(){if(aA)return es;aA=1,Object.defineProperty(es,"__esModule",{value:!0}),es.ROOT_CONTEXT=es.createContextKey=void 0;function e(n){return Symbol.for(n)}es.createContextKey=e;class t{constructor(r){const s=this;s._currentContext=r?new Map(r):new Map,s.getValue=i=>s._currentContext.get(i),s.setValue=(i,o)=>{const c=new t(s._currentContext);return c._currentContext.set(i,o),c},s.deleteValue=i=>{const o=new t(s._currentContext);return o._currentContext.delete(i),o}}}return es.ROOT_CONTEXT=new t,es}var pa={},cA;function jk(){if(cA)return pa;cA=1,Object.defineProperty(pa,"__esModule",{value:!0}),pa.DiagConsoleLogger=void 0;const e=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}];class t{constructor(){function r(s){return function(...i){if(console){let o=console[s];if(typeof o!="function"&&(o=console.log),typeof o=="function")return o.apply(console,i)}}}for(let s=0;s<e.length;s++)this[e[s].n]=r(e[s].c)}}return pa.DiagConsoleLogger=t,pa}var rf={},uA;function pM(){return uA||(uA=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createNoopMeter=e.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC=e.NOOP_OBSERVABLE_GAUGE_METRIC=e.NOOP_OBSERVABLE_COUNTER_METRIC=e.NOOP_UP_DOWN_COUNTER_METRIC=e.NOOP_HISTOGRAM_METRIC=e.NOOP_GAUGE_METRIC=e.NOOP_COUNTER_METRIC=e.NOOP_METER=e.NoopObservableUpDownCounterMetric=e.NoopObservableGaugeMetric=e.NoopObservableCounterMetric=e.NoopObservableMetric=e.NoopHistogramMetric=e.NoopGaugeMetric=e.NoopUpDownCounterMetric=e.NoopCounterMetric=e.NoopMetric=e.NoopMeter=void 0;class t{constructor(){}createGauge(_,p){return e.NOOP_GAUGE_METRIC}createHistogram(_,p){return e.NOOP_HISTOGRAM_METRIC}createCounter(_,p){return e.NOOP_COUNTER_METRIC}createUpDownCounter(_,p){return e.NOOP_UP_DOWN_COUNTER_METRIC}createObservableGauge(_,p){return e.NOOP_OBSERVABLE_GAUGE_METRIC}createObservableCounter(_,p){return e.NOOP_OBSERVABLE_COUNTER_METRIC}createObservableUpDownCounter(_,p){return e.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC}addBatchObservableCallback(_,p){}removeBatchObservableCallback(_){}}e.NoopMeter=t;class n{}e.NoopMetric=n;class r extends n{add(_,p){}}e.NoopCounterMetric=r;class s extends n{add(_,p){}}e.NoopUpDownCounterMetric=s;class i extends n{record(_,p){}}e.NoopGaugeMetric=i;class o extends n{record(_,p){}}e.NoopHistogramMetric=o;class c{addCallback(_){}removeCallback(_){}}e.NoopObservableMetric=c;class a extends c{}e.NoopObservableCounterMetric=a;class l extends c{}e.NoopObservableGaugeMetric=l;class f extends c{}e.NoopObservableUpDownCounterMetric=f,e.NOOP_METER=new t,e.NOOP_COUNTER_METRIC=new r,e.NOOP_GAUGE_METRIC=new i,e.NOOP_HISTOGRAM_METRIC=new o,e.NOOP_UP_DOWN_COUNTER_METRIC=new s,e.NOOP_OBSERVABLE_COUNTER_METRIC=new a,e.NOOP_OBSERVABLE_GAUGE_METRIC=new l,e.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC=new f;function d(){return e.NOOP_METER}e.createNoopMeter=d})(rf)),rf}var sf={},lA;function qk(){return lA||(lA=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ValueType=void 0,(function(t){t[t.INT=0]="INT",t[t.DOUBLE=1]="DOUBLE"})(e.ValueType||(e.ValueType={}))})(sf)),sf}var ts={},dA;function hM(){return dA||(dA=1,Object.defineProperty(ts,"__esModule",{value:!0}),ts.defaultTextMapSetter=ts.defaultTextMapGetter=void 0,ts.defaultTextMapGetter={get(e,t){if(e!=null)return e[t]},keys(e){return e==null?[]:Object.keys(e)}},ts.defaultTextMapSetter={set(e,t,n){e!=null&&(e[t]=n)}}),ts}var ha={},Ea={},Ta={},Sa={},fA;function Yk(){if(fA)return Sa;fA=1,Object.defineProperty(Sa,"__esModule",{value:!0}),Sa.NoopContextManager=void 0;const e=nd();let t=class{active(){return e.ROOT_CONTEXT}with(r,s,i,...o){return s.call(i,...o)}bind(r,s){return s}enable(){return this}disable(){return this}};return Sa.NoopContextManager=t,Sa}var _A;function rd(){if(_A)return Ta;_A=1,Object.defineProperty(Ta,"__esModule",{value:!0}),Ta.ContextAPI=void 0;const e=Yk(),t=Ki(),n=zi(),r="context",s=new e.NoopContextManager;class i{constructor(){}static getInstance(){return this._instance||(this._instance=new i),this._instance}setGlobalContextManager(c){return(0,t.registerGlobal)(r,c,n.DiagAPI.instance())}active(){return this._getContextManager().active()}with(c,a,l,...f){return this._getContextManager().with(c,a,l,...f)}bind(c,a){return this._getContextManager().bind(c,a)}_getContextManager(){return(0,t.getGlobal)(r)||s}disable(){this._getContextManager().disable(),(0,t.unregisterGlobal)(r,n.DiagAPI.instance())}}return Ta.ContextAPI=i,Ta}var Rt={},ma={},of={},af={},pA;function EM(){return pA||(pA=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TraceFlags=void 0,(function(t){t[t.NONE=0]="NONE",t[t.SAMPLED=1]="SAMPLED"})(e.TraceFlags||(e.TraceFlags={}))})(af)),af}var hA;function FE(){return hA||(hA=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.INVALID_SPAN_CONTEXT=e.INVALID_TRACEID=e.INVALID_SPANID=void 0;const t=EM();e.INVALID_SPANID="0000000000000000",e.INVALID_TRACEID="00000000000000000000000000000000",e.INVALID_SPAN_CONTEXT={traceId:e.INVALID_TRACEID,spanId:e.INVALID_SPANID,traceFlags:t.TraceFlags.NONE}})(of)),of}var EA;function jE(){if(EA)return ma;EA=1,Object.defineProperty(ma,"__esModule",{value:!0}),ma.NonRecordingSpan=void 0;const e=FE();let t=class{constructor(r=e.INVALID_SPAN_CONTEXT){this._spanContext=r}spanContext(){return this._spanContext}setAttribute(r,s){return this}setAttributes(r){return this}addEvent(r,s){return this}addLink(r){return this}addLinks(r){return this}setStatus(r){return this}updateName(r){return this}end(r){}isRecording(){return!1}recordException(r,s){}};return ma.NonRecordingSpan=t,ma}var TA;function TM(){if(TA)return Rt;TA=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.getSpanContext=Rt.setSpanContext=Rt.deleteSpan=Rt.setSpan=Rt.getActiveSpan=Rt.getSpan=void 0;const e=nd(),t=jE(),n=rd(),r=(0,e.createContextKey)("OpenTelemetry Context Key SPAN");function s(f){return f.getValue(r)||void 0}Rt.getSpan=s;function i(){return s(n.ContextAPI.getInstance().active())}Rt.getActiveSpan=i;function o(f,d){return f.setValue(r,d)}Rt.setSpan=o;function c(f){return f.deleteValue(r)}Rt.deleteSpan=c;function a(f,d){return o(f,new t.NonRecordingSpan(d))}Rt.setSpanContext=a;function l(f){var d;return(d=s(f))===null||d===void 0?void 0:d.spanContext()}return Rt.getSpanContext=l,Rt}var En={},SA;function qE(){if(SA)return En;SA=1,Object.defineProperty(En,"__esModule",{value:!0}),En.wrapSpanContext=En.isSpanContextValid=En.isValidSpanId=En.isValidTraceId=void 0;const e=FE(),t=jE(),n=/^([0-9a-f]{32})$/i,r=/^[0-9a-f]{16}$/i;function s(a){return n.test(a)&&a!==e.INVALID_TRACEID}En.isValidTraceId=s;function i(a){return r.test(a)&&a!==e.INVALID_SPANID}En.isValidSpanId=i;function o(a){return s(a.traceId)&&i(a.spanId)}En.isSpanContextValid=o;function c(a){return new t.NonRecordingSpan(a)}return En.wrapSpanContext=c,En}var mA;function SM(){if(mA)return Ea;mA=1,Object.defineProperty(Ea,"__esModule",{value:!0}),Ea.NoopTracer=void 0;const e=rd(),t=TM(),n=jE(),r=qE(),s=e.ContextAPI.getInstance();let i=class{startSpan(a,l,f=s.active()){if(!!l?.root)return new n.NonRecordingSpan;const u=f&&(0,t.getSpanContext)(f);return o(u)&&(0,r.isSpanContextValid)(u)?new n.NonRecordingSpan(u):new n.NonRecordingSpan}startActiveSpan(a,l,f,d){let u,_,p;if(arguments.length<2)return;arguments.length===2?p=l:arguments.length===3?(u=l,p=f):(u=l,_=f,p=d);const h=_??s.active(),E=this.startSpan(a,u,h),T=(0,t.setSpan)(h,E);return s.with(T,p,void 0,E)}};Ea.NoopTracer=i;function o(c){return typeof c=="object"&&typeof c.spanId=="string"&&typeof c.traceId=="string"&&typeof c.traceFlags=="number"}return Ea}var gA;function mM(){if(gA)return ha;gA=1,Object.defineProperty(ha,"__esModule",{value:!0}),ha.ProxyTracer=void 0;const e=SM(),t=new e.NoopTracer;let n=class{constructor(s,i,o,c){this._provider=s,this.name=i,this.version=o,this.options=c}startSpan(s,i,o){return this._getTracer().startSpan(s,i,o)}startActiveSpan(s,i,o,c){const a=this._getTracer();return Reflect.apply(a.startActiveSpan,a,arguments)}_getTracer(){if(this._delegate)return this._delegate;const s=this._provider.getDelegateTracer(this.name,this.version,this.options);return s?(this._delegate=s,this._delegate):t}};return ha.ProxyTracer=n,ha}var ga={},Aa={},AA;function Wk(){if(AA)return Aa;AA=1,Object.defineProperty(Aa,"__esModule",{value:!0}),Aa.NoopTracerProvider=void 0;const e=SM();let t=class{getTracer(r,s,i){return new e.NoopTracer}};return Aa.NoopTracerProvider=t,Aa}var RA;function gM(){if(RA)return ga;RA=1,Object.defineProperty(ga,"__esModule",{value:!0}),ga.ProxyTracerProvider=void 0;const e=mM(),t=Wk(),n=new t.NoopTracerProvider;let r=class{getTracer(i,o,c){var a;return(a=this.getDelegateTracer(i,o,c))!==null&&a!==void 0?a:new e.ProxyTracer(this,i,o,c)}getDelegate(){var i;return(i=this._delegate)!==null&&i!==void 0?i:n}setDelegate(i){this._delegate=i}getDelegateTracer(i,o,c){var a;return(a=this._delegate)===null||a===void 0?void 0:a.getTracer(i,o,c)}};return ga.ProxyTracerProvider=r,ga}var cf={},yA;function Kk(){return yA||(yA=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SamplingDecision=void 0,(function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(e.SamplingDecision||(e.SamplingDecision={}))})(cf)),cf}var uf={},NA;function zk(){return NA||(NA=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpanKind=void 0,(function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"})(e.SpanKind||(e.SpanKind={}))})(uf)),uf}var lf={},OA;function Zk(){return OA||(OA=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpanStatusCode=void 0,(function(t){t[t.UNSET=0]="UNSET",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR"})(e.SpanStatusCode||(e.SpanStatusCode={}))})(lf)),lf}var Ra={},ya={},ns={},bA;function Xk(){if(bA)return ns;bA=1,Object.defineProperty(ns,"__esModule",{value:!0}),ns.validateValue=ns.validateKey=void 0;const e="[_0-9a-z-*/]",t=`[a-z]${e}{0,255}`,n=`[a-z0-9]${e}{0,240}@[a-z]${e}{0,13}`,r=new RegExp(`^(?:${t}|${n})$`),s=/^[ -~]{0,255}[!-~]$/,i=/,|=/;function o(a){return r.test(a)}ns.validateKey=o;function c(a){return s.test(a)&&!i.test(a)}return ns.validateValue=c,ns}var IA;function Qk(){if(IA)return ya;IA=1,Object.defineProperty(ya,"__esModule",{value:!0}),ya.TraceStateImpl=void 0;const e=Xk(),t=32,n=512,r=",",s="=";class i{constructor(c){this._internalState=new Map,c&&this._parse(c)}set(c,a){const l=this._clone();return l._internalState.has(c)&&l._internalState.delete(c),l._internalState.set(c,a),l}unset(c){const a=this._clone();return a._internalState.delete(c),a}get(c){return this._internalState.get(c)}serialize(){return this._keys().reduce((c,a)=>(c.push(a+s+this.get(a)),c),[]).join(r)}_parse(c){c.length>n||(this._internalState=c.split(r).reverse().reduce((a,l)=>{const f=l.trim(),d=f.indexOf(s);if(d!==-1){const u=f.slice(0,d),_=f.slice(d+1,l.length);(0,e.validateKey)(u)&&(0,e.validateValue)(_)&&a.set(u,_)}return a},new Map),this._internalState.size>t&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,t))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){const c=new i;return c._internalState=new Map(this._internalState),c}}return ya.TraceStateImpl=i,ya}var CA;function Jk(){if(CA)return Ra;CA=1,Object.defineProperty(Ra,"__esModule",{value:!0}),Ra.createTraceState=void 0;const e=Qk();function t(n){return new e.TraceStateImpl(n)}return Ra.createTraceState=t,Ra}var Na={},vA;function e1(){if(vA)return Na;vA=1,Object.defineProperty(Na,"__esModule",{value:!0}),Na.context=void 0;const e=rd();return Na.context=e.ContextAPI.getInstance(),Na}var Oa={},PA;function t1(){if(PA)return Oa;PA=1,Object.defineProperty(Oa,"__esModule",{value:!0}),Oa.diag=void 0;const e=zi();return Oa.diag=e.DiagAPI.instance(),Oa}var ba={},Ia={},rs={},MA;function n1(){if(MA)return rs;MA=1,Object.defineProperty(rs,"__esModule",{value:!0}),rs.NOOP_METER_PROVIDER=rs.NoopMeterProvider=void 0;const e=pM();let t=class{getMeter(r,s,i){return e.NOOP_METER}};return rs.NoopMeterProvider=t,rs.NOOP_METER_PROVIDER=new t,rs}var wA;function r1(){if(wA)return Ia;wA=1,Object.defineProperty(Ia,"__esModule",{value:!0}),Ia.MetricsAPI=void 0;const e=n1(),t=Ki(),n=zi(),r="metrics";class s{constructor(){}static getInstance(){return this._instance||(this._instance=new s),this._instance}setGlobalMeterProvider(o){return(0,t.registerGlobal)(r,o,n.DiagAPI.instance())}getMeterProvider(){return(0,t.getGlobal)(r)||e.NOOP_METER_PROVIDER}getMeter(o,c,a){return this.getMeterProvider().getMeter(o,c,a)}disable(){(0,t.unregisterGlobal)(r,n.DiagAPI.instance())}}return Ia.MetricsAPI=s,Ia}var LA;function s1(){if(LA)return ba;LA=1,Object.defineProperty(ba,"__esModule",{value:!0}),ba.metrics=void 0;const e=r1();return ba.metrics=e.MetricsAPI.getInstance(),ba}var Ca={},va={},Pa={},DA;function i1(){if(DA)return Pa;DA=1,Object.defineProperty(Pa,"__esModule",{value:!0}),Pa.NoopTextMapPropagator=void 0;let e=class{inject(n,r){}extract(n,r){return n}fields(){return[]}};return Pa.NoopTextMapPropagator=e,Pa}var Tn={},UA;function o1(){if(UA)return Tn;UA=1,Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.deleteBaggage=Tn.setBaggage=Tn.getActiveBaggage=Tn.getBaggage=void 0;const e=rd(),n=(0,nd().createContextKey)("OpenTelemetry Baggage Key");function r(c){return c.getValue(n)||void 0}Tn.getBaggage=r;function s(){return r(e.ContextAPI.getInstance().active())}Tn.getActiveBaggage=s;function i(c,a){return c.setValue(n,a)}Tn.setBaggage=i;function o(c){return c.deleteValue(n)}return Tn.deleteBaggage=o,Tn}var kA;function a1(){if(kA)return va;kA=1,Object.defineProperty(va,"__esModule",{value:!0}),va.PropagationAPI=void 0;const e=Ki(),t=i1(),n=hM(),r=o1(),s=_M(),i=zi(),o="propagation",c=new t.NoopTextMapPropagator;class a{constructor(){this.createBaggage=s.createBaggage,this.getBaggage=r.getBaggage,this.getActiveBaggage=r.getActiveBaggage,this.setBaggage=r.setBaggage,this.deleteBaggage=r.deleteBaggage}static getInstance(){return this._instance||(this._instance=new a),this._instance}setGlobalPropagator(f){return(0,e.registerGlobal)(o,f,i.DiagAPI.instance())}inject(f,d,u=n.defaultTextMapSetter){return this._getGlobalPropagator().inject(f,d,u)}extract(f,d,u=n.defaultTextMapGetter){return this._getGlobalPropagator().extract(f,d,u)}fields(){return this._getGlobalPropagator().fields()}disable(){(0,e.unregisterGlobal)(o,i.DiagAPI.instance())}_getGlobalPropagator(){return(0,e.getGlobal)(o)||c}}return va.PropagationAPI=a,va}var xA;function c1(){if(xA)return Ca;xA=1,Object.defineProperty(Ca,"__esModule",{value:!0}),Ca.propagation=void 0;const e=a1();return Ca.propagation=e.PropagationAPI.getInstance(),Ca}var Ma={},wa={},BA;function u1(){if(BA)return wa;BA=1,Object.defineProperty(wa,"__esModule",{value:!0}),wa.TraceAPI=void 0;const e=Ki(),t=gM(),n=qE(),r=TM(),s=zi(),i="trace";class o{constructor(){this._proxyTracerProvider=new t.ProxyTracerProvider,this.wrapSpanContext=n.wrapSpanContext,this.isSpanContextValid=n.isSpanContextValid,this.deleteSpan=r.deleteSpan,this.getSpan=r.getSpan,this.getActiveSpan=r.getActiveSpan,this.getSpanContext=r.getSpanContext,this.setSpan=r.setSpan,this.setSpanContext=r.setSpanContext}static getInstance(){return this._instance||(this._instance=new o),this._instance}setGlobalTracerProvider(a){const l=(0,e.registerGlobal)(i,this._proxyTracerProvider,s.DiagAPI.instance());return l&&this._proxyTracerProvider.setDelegate(a),l}getTracerProvider(){return(0,e.getGlobal)(i)||this._proxyTracerProvider}getTracer(a,l){return this.getTracerProvider().getTracer(a,l)}disable(){(0,e.unregisterGlobal)(i,s.DiagAPI.instance()),this._proxyTracerProvider=new t.ProxyTracerProvider}}return wa.TraceAPI=o,wa}var GA;function l1(){if(GA)return Ma;GA=1,Object.defineProperty(Ma,"__esModule",{value:!0}),Ma.trace=void 0;const e=u1();return Ma.trace=e.TraceAPI.getInstance(),Ma}var VA;function Ue(){return VA||(VA=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.trace=e.propagation=e.metrics=e.diag=e.context=e.INVALID_SPAN_CONTEXT=e.INVALID_TRACEID=e.INVALID_SPANID=e.isValidSpanId=e.isValidTraceId=e.isSpanContextValid=e.createTraceState=e.TraceFlags=e.SpanStatusCode=e.SpanKind=e.SamplingDecision=e.ProxyTracerProvider=e.ProxyTracer=e.defaultTextMapSetter=e.defaultTextMapGetter=e.ValueType=e.createNoopMeter=e.DiagLogLevel=e.DiagConsoleLogger=e.ROOT_CONTEXT=e.createContextKey=e.baggageEntryMetadataFromString=void 0;var t=_M();Object.defineProperty(e,"baggageEntryMetadataFromString",{enumerable:!0,get:function(){return t.baggageEntryMetadataFromString}});var n=nd();Object.defineProperty(e,"createContextKey",{enumerable:!0,get:function(){return n.createContextKey}}),Object.defineProperty(e,"ROOT_CONTEXT",{enumerable:!0,get:function(){return n.ROOT_CONTEXT}});var r=jk();Object.defineProperty(e,"DiagConsoleLogger",{enumerable:!0,get:function(){return r.DiagConsoleLogger}});var s=HE();Object.defineProperty(e,"DiagLogLevel",{enumerable:!0,get:function(){return s.DiagLogLevel}});var i=pM();Object.defineProperty(e,"createNoopMeter",{enumerable:!0,get:function(){return i.createNoopMeter}});var o=qk();Object.defineProperty(e,"ValueType",{enumerable:!0,get:function(){return o.ValueType}});var c=hM();Object.defineProperty(e,"defaultTextMapGetter",{enumerable:!0,get:function(){return c.defaultTextMapGetter}}),Object.defineProperty(e,"defaultTextMapSetter",{enumerable:!0,get:function(){return c.defaultTextMapSetter}});var a=mM();Object.defineProperty(e,"ProxyTracer",{enumerable:!0,get:function(){return a.ProxyTracer}});var l=gM();Object.defineProperty(e,"ProxyTracerProvider",{enumerable:!0,get:function(){return l.ProxyTracerProvider}});var f=Kk();Object.defineProperty(e,"SamplingDecision",{enumerable:!0,get:function(){return f.SamplingDecision}});var d=zk();Object.defineProperty(e,"SpanKind",{enumerable:!0,get:function(){return d.SpanKind}});var u=Zk();Object.defineProperty(e,"SpanStatusCode",{enumerable:!0,get:function(){return u.SpanStatusCode}});var _=EM();Object.defineProperty(e,"TraceFlags",{enumerable:!0,get:function(){return _.TraceFlags}});var p=Jk();Object.defineProperty(e,"createTraceState",{enumerable:!0,get:function(){return p.createTraceState}});var h=qE();Object.defineProperty(e,"isSpanContextValid",{enumerable:!0,get:function(){return h.isSpanContextValid}}),Object.defineProperty(e,"isValidTraceId",{enumerable:!0,get:function(){return h.isValidTraceId}}),Object.defineProperty(e,"isValidSpanId",{enumerable:!0,get:function(){return h.isValidSpanId}});var E=FE();Object.defineProperty(e,"INVALID_SPANID",{enumerable:!0,get:function(){return E.INVALID_SPANID}}),Object.defineProperty(e,"INVALID_TRACEID",{enumerable:!0,get:function(){return E.INVALID_TRACEID}}),Object.defineProperty(e,"INVALID_SPAN_CONTEXT",{enumerable:!0,get:function(){return E.INVALID_SPAN_CONTEXT}});const T=e1();Object.defineProperty(e,"context",{enumerable:!0,get:function(){return T.context}});const S=t1();Object.defineProperty(e,"diag",{enumerable:!0,get:function(){return S.diag}});const m=s1();Object.defineProperty(e,"metrics",{enumerable:!0,get:function(){return m.metrics}});const g=c1();Object.defineProperty(e,"propagation",{enumerable:!0,get:function(){return g.propagation}});const y=l1();Object.defineProperty(e,"trace",{enumerable:!0,get:function(){return y.trace}}),e.default={context:T.context,diag:S.diag,metrics:m.metrics,propagation:g.propagation,trace:y.trace}})(tf)),tf}var D=Ue(),df={},La={};const YE=D.createContextKey("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function qs(e){return e.setValue(YE,!0)}function d1(e){return e.deleteValue(YE)}function Kn(e){return e.getValue(YE)===!0}const f1="=",Yh=";",fl=",",ff="baggage",_1=180,p1=4096,h1=8192;function E1(e){return e.reduce((t,n)=>{const r=`${t}${t!==""?fl:""}${n}`;return r.length>h1?t:r},"")}function T1(e){return e.getAllEntries().map(([t,n])=>{let r=`${encodeURIComponent(t)}=${encodeURIComponent(n.value)}`;return n.metadata!==void 0&&(r+=Yh+n.metadata.toString()),r})}function AM(e){const t=e.split(Yh);if(t.length<=0)return;const n=t.shift();if(!n)return;const r=n.indexOf(f1);if(r<=0)return;const s=decodeURIComponent(n.substring(0,r).trim()),i=decodeURIComponent(n.substring(r+1).trim());let o;return t.length>0&&(o=D.baggageEntryMetadataFromString(t.join(Yh))),{key:s,value:i,metadata:o}}function S1(e){const t={};return typeof e=="string"&&e.length>0&&e.split(fl).forEach(n=>{const r=AM(n);r!==void 0&&r.value.length>0&&(t[r.key]=r.value)}),t}class RM{inject(t,n,r){const s=D.propagation.getBaggage(t);if(!s||Kn(t))return;const i=T1(s).filter(c=>c.length<=p1).slice(0,_1),o=E1(i);o.length>0&&r.set(n,ff,o)}extract(t,n,r){const s=r.get(n,ff),i=Array.isArray(s)?s.join(fl):s;if(!i)return t;const o={};return i.length===0||(i.split(fl).forEach(a=>{const l=AM(a);if(l){const f={value:l.value};l.metadata&&(f.metadata=l.metadata),o[l.key]=f}}),Object.entries(o).length===0)?t:D.propagation.setBaggage(t,D.propagation.createBaggage(o))}fields(){return[ff]}}class m1{_monotonicClock;_epochMillis;_performanceMillis;constructor(t,n){this._monotonicClock=n,this._epochMillis=t.now(),this._performanceMillis=n.now()}now(){const t=this._monotonicClock.now()-this._performanceMillis;return this._epochMillis+t}}function xc(e){const t={};if(typeof e!="object"||e==null)return t;for(const n in e){if(!Object.prototype.hasOwnProperty.call(e,n))continue;if(!g1(n)){D.diag.warn(`Invalid attribute key: ${n}`);continue}const r=e[n];if(!WE(r)){D.diag.warn(`Invalid attribute value set for key: ${n}`);continue}Array.isArray(r)?t[n]=r.slice():t[n]=r}return t}function g1(e){return typeof e=="string"&&e!==""}function WE(e){return e==null?!0:Array.isArray(e)?A1(e):yM(typeof e)}function A1(e){let t;for(const n of e){if(n==null)continue;const r=typeof n;if(r!==t){if(!t){if(yM(r)){t=r;continue}return!1}return!1}}return!0}function yM(e){switch(e){case"number":case"boolean":case"string":return!0}return!1}function NM(){return e=>{D.diag.error(R1(e))}}function R1(e){return typeof e=="string"?e:JSON.stringify(y1(e))}function y1(e){const t={};let n=e;for(;n!==null;)Object.getOwnPropertyNames(n).forEach(r=>{if(t[r])return;const s=n[r];s&&(t[r]=String(s))}),n=Object.getPrototypeOf(n);return t}let OM=NM();function N1(e){OM=e}function KE(e){try{OM(e)}catch{}}function xt(e){const t=process.env[e];if(t==null||t.trim()==="")return;const n=Number(t);if(isNaN(n)){D.diag.warn(`Unknown value ${Gr.inspect(t)} for ${e}, expected a number, using defaults`);return}return n}function zE(e){const t=process.env[e];if(!(t==null||t.trim()===""))return t}function O1(e){const t=process.env[e]?.trim().toLowerCase();return t==null||t===""?!1:t==="true"?!0:(t==="false"||D.diag.warn(`Unknown value ${Gr.inspect(t)} for ${e}, expected 'true' or 'false', falling back to 'false' (default)`),!1)}function b1(e){return zE(e)?.split(",").map(t=>t.trim()).filter(t=>t!=="")}const I1=typeof globalThis=="object"?globalThis:global,Hs=Ok.performance,C1="2.2.0";var ss={},is={},R={},Da={},$A;function bM(){if($A)return Da;$A=1,Object.defineProperty(Da,"__esModule",{value:!0}),Da.createConstMap=void 0;function e(t){let n={};const r=t.length;for(let s=0;s<r;s++){const i=t[s];i&&(n[String(i).toUpperCase().replace(/[-.]/g,"_")]=i)}return n}return Da.createConstMap=e,Da}var HA;function v1(){if(HA)return R;HA=1,Object.defineProperty(R,"__esModule",{value:!0}),R.SEMATTRS_NET_HOST_CARRIER_ICC=R.SEMATTRS_NET_HOST_CARRIER_MNC=R.SEMATTRS_NET_HOST_CARRIER_MCC=R.SEMATTRS_NET_HOST_CARRIER_NAME=R.SEMATTRS_NET_HOST_CONNECTION_SUBTYPE=R.SEMATTRS_NET_HOST_CONNECTION_TYPE=R.SEMATTRS_NET_HOST_NAME=R.SEMATTRS_NET_HOST_PORT=R.SEMATTRS_NET_HOST_IP=R.SEMATTRS_NET_PEER_NAME=R.SEMATTRS_NET_PEER_PORT=R.SEMATTRS_NET_PEER_IP=R.SEMATTRS_NET_TRANSPORT=R.SEMATTRS_FAAS_INVOKED_REGION=R.SEMATTRS_FAAS_INVOKED_PROVIDER=R.SEMATTRS_FAAS_INVOKED_NAME=R.SEMATTRS_FAAS_COLDSTART=R.SEMATTRS_FAAS_CRON=R.SEMATTRS_FAAS_TIME=R.SEMATTRS_FAAS_DOCUMENT_NAME=R.SEMATTRS_FAAS_DOCUMENT_TIME=R.SEMATTRS_FAAS_DOCUMENT_OPERATION=R.SEMATTRS_FAAS_DOCUMENT_COLLECTION=R.SEMATTRS_FAAS_EXECUTION=R.SEMATTRS_FAAS_TRIGGER=R.SEMATTRS_EXCEPTION_ESCAPED=R.SEMATTRS_EXCEPTION_STACKTRACE=R.SEMATTRS_EXCEPTION_MESSAGE=R.SEMATTRS_EXCEPTION_TYPE=R.SEMATTRS_DB_SQL_TABLE=R.SEMATTRS_DB_MONGODB_COLLECTION=R.SEMATTRS_DB_REDIS_DATABASE_INDEX=R.SEMATTRS_DB_HBASE_NAMESPACE=R.SEMATTRS_DB_CASSANDRA_COORDINATOR_DC=R.SEMATTRS_DB_CASSANDRA_COORDINATOR_ID=R.SEMATTRS_DB_CASSANDRA_SPECULATIVE_EXECUTION_COUNT=R.SEMATTRS_DB_CASSANDRA_IDEMPOTENCE=R.SEMATTRS_DB_CASSANDRA_TABLE=R.SEMATTRS_DB_CASSANDRA_CONSISTENCY_LEVEL=R.SEMATTRS_DB_CASSANDRA_PAGE_SIZE=R.SEMATTRS_DB_CASSANDRA_KEYSPACE=R.SEMATTRS_DB_MSSQL_INSTANCE_NAME=R.SEMATTRS_DB_OPERATION=R.SEMATTRS_DB_STATEMENT=R.SEMATTRS_DB_NAME=R.SEMATTRS_DB_JDBC_DRIVER_CLASSNAME=R.SEMATTRS_DB_USER=R.SEMATTRS_DB_CONNECTION_STRING=R.SEMATTRS_DB_SYSTEM=R.SEMATTRS_AWS_LAMBDA_INVOKED_ARN=void 0,R.SEMATTRS_MESSAGING_DESTINATION_KIND=R.SEMATTRS_MESSAGING_DESTINATION=R.SEMATTRS_MESSAGING_SYSTEM=R.SEMATTRS_AWS_DYNAMODB_GLOBAL_SECONDARY_INDEX_UPDATES=R.SEMATTRS_AWS_DYNAMODB_ATTRIBUTE_DEFINITIONS=R.SEMATTRS_AWS_DYNAMODB_SCANNED_COUNT=R.SEMATTRS_AWS_DYNAMODB_COUNT=R.SEMATTRS_AWS_DYNAMODB_TOTAL_SEGMENTS=R.SEMATTRS_AWS_DYNAMODB_SEGMENT=R.SEMATTRS_AWS_DYNAMODB_SCAN_FORWARD=R.SEMATTRS_AWS_DYNAMODB_TABLE_COUNT=R.SEMATTRS_AWS_DYNAMODB_EXCLUSIVE_START_TABLE=R.SEMATTRS_AWS_DYNAMODB_LOCAL_SECONDARY_INDEXES=R.SEMATTRS_AWS_DYNAMODB_GLOBAL_SECONDARY_INDEXES=R.SEMATTRS_AWS_DYNAMODB_SELECT=R.SEMATTRS_AWS_DYNAMODB_INDEX_NAME=R.SEMATTRS_AWS_DYNAMODB_ATTRIBUTES_TO_GET=R.SEMATTRS_AWS_DYNAMODB_LIMIT=R.SEMATTRS_AWS_DYNAMODB_PROJECTION=R.SEMATTRS_AWS_DYNAMODB_CONSISTENT_READ=R.SEMATTRS_AWS_DYNAMODB_PROVISIONED_WRITE_CAPACITY=R.SEMATTRS_AWS_DYNAMODB_PROVISIONED_READ_CAPACITY=R.SEMATTRS_AWS_DYNAMODB_ITEM_COLLECTION_METRICS=R.SEMATTRS_AWS_DYNAMODB_CONSUMED_CAPACITY=R.SEMATTRS_AWS_DYNAMODB_TABLE_NAMES=R.SEMATTRS_HTTP_CLIENT_IP=R.SEMATTRS_HTTP_ROUTE=R.SEMATTRS_HTTP_SERVER_NAME=R.SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED=R.SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH=R.SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED=R.SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH=R.SEMATTRS_HTTP_USER_AGENT=R.SEMATTRS_HTTP_FLAVOR=R.SEMATTRS_HTTP_STATUS_CODE=R.SEMATTRS_HTTP_SCHEME=R.SEMATTRS_HTTP_HOST=R.SEMATTRS_HTTP_TARGET=R.SEMATTRS_HTTP_URL=R.SEMATTRS_HTTP_METHOD=R.SEMATTRS_CODE_LINENO=R.SEMATTRS_CODE_FILEPATH=R.SEMATTRS_CODE_NAMESPACE=R.SEMATTRS_CODE_FUNCTION=R.SEMATTRS_THREAD_NAME=R.SEMATTRS_THREAD_ID=R.SEMATTRS_ENDUSER_SCOPE=R.SEMATTRS_ENDUSER_ROLE=R.SEMATTRS_ENDUSER_ID=R.SEMATTRS_PEER_SERVICE=void 0,R.DBSYSTEMVALUES_FILEMAKER=R.DBSYSTEMVALUES_DERBY=R.DBSYSTEMVALUES_FIREBIRD=R.DBSYSTEMVALUES_ADABAS=R.DBSYSTEMVALUES_CACHE=R.DBSYSTEMVALUES_EDB=R.DBSYSTEMVALUES_FIRSTSQL=R.DBSYSTEMVALUES_INGRES=R.DBSYSTEMVALUES_HANADB=R.DBSYSTEMVALUES_MAXDB=R.DBSYSTEMVALUES_PROGRESS=R.DBSYSTEMVALUES_HSQLDB=R.DBSYSTEMVALUES_CLOUDSCAPE=R.DBSYSTEMVALUES_HIVE=R.DBSYSTEMVALUES_REDSHIFT=R.DBSYSTEMVALUES_POSTGRESQL=R.DBSYSTEMVALUES_DB2=R.DBSYSTEMVALUES_ORACLE=R.DBSYSTEMVALUES_MYSQL=R.DBSYSTEMVALUES_MSSQL=R.DBSYSTEMVALUES_OTHER_SQL=R.SemanticAttributes=R.SEMATTRS_MESSAGE_UNCOMPRESSED_SIZE=R.SEMATTRS_MESSAGE_COMPRESSED_SIZE=R.SEMATTRS_MESSAGE_ID=R.SEMATTRS_MESSAGE_TYPE=R.SEMATTRS_RPC_JSONRPC_ERROR_MESSAGE=R.SEMATTRS_RPC_JSONRPC_ERROR_CODE=R.SEMATTRS_RPC_JSONRPC_REQUEST_ID=R.SEMATTRS_RPC_JSONRPC_VERSION=R.SEMATTRS_RPC_GRPC_STATUS_CODE=R.SEMATTRS_RPC_METHOD=R.SEMATTRS_RPC_SERVICE=R.SEMATTRS_RPC_SYSTEM=R.SEMATTRS_MESSAGING_KAFKA_TOMBSTONE=R.SEMATTRS_MESSAGING_KAFKA_PARTITION=R.SEMATTRS_MESSAGING_KAFKA_CLIENT_ID=R.SEMATTRS_MESSAGING_KAFKA_CONSUMER_GROUP=R.SEMATTRS_MESSAGING_KAFKA_MESSAGE_KEY=R.SEMATTRS_MESSAGING_RABBITMQ_ROUTING_KEY=R.SEMATTRS_MESSAGING_CONSUMER_ID=R.SEMATTRS_MESSAGING_OPERATION=R.SEMATTRS_MESSAGING_MESSAGE_PAYLOAD_COMPRESSED_SIZE_BYTES=R.SEMATTRS_MESSAGING_MESSAGE_PAYLOAD_SIZE_BYTES=R.SEMATTRS_MESSAGING_CONVERSATION_ID=R.SEMATTRS_MESSAGING_MESSAGE_ID=R.SEMATTRS_MESSAGING_URL=R.SEMATTRS_MESSAGING_PROTOCOL_VERSION=R.SEMATTRS_MESSAGING_PROTOCOL=R.SEMATTRS_MESSAGING_TEMP_DESTINATION=void 0,R.FAASINVOKEDPROVIDERVALUES_ALIBABA_CLOUD=R.FaasDocumentOperationValues=R.FAASDOCUMENTOPERATIONVALUES_DELETE=R.FAASDOCUMENTOPERATIONVALUES_EDIT=R.FAASDOCUMENTOPERATIONVALUES_INSERT=R.FaasTriggerValues=R.FAASTRIGGERVALUES_OTHER=R.FAASTRIGGERVALUES_TIMER=R.FAASTRIGGERVALUES_PUBSUB=R.FAASTRIGGERVALUES_HTTP=R.FAASTRIGGERVALUES_DATASOURCE=R.DbCassandraConsistencyLevelValues=R.DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_SERIAL=R.DBCASSANDRACONSISTENCYLEVELVALUES_SERIAL=R.DBCASSANDRACONSISTENCYLEVELVALUES_ANY=R.DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_ONE=R.DBCASSANDRACONSISTENCYLEVELVALUES_THREE=R.DBCASSANDRACONSISTENCYLEVELVALUES_TWO=R.DBCASSANDRACONSISTENCYLEVELVALUES_ONE=R.DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_QUORUM=R.DBCASSANDRACONSISTENCYLEVELVALUES_QUORUM=R.DBCASSANDRACONSISTENCYLEVELVALUES_EACH_QUORUM=R.DBCASSANDRACONSISTENCYLEVELVALUES_ALL=R.DbSystemValues=R.DBSYSTEMVALUES_COCKROACHDB=R.DBSYSTEMVALUES_MEMCACHED=R.DBSYSTEMVALUES_ELASTICSEARCH=R.DBSYSTEMVALUES_GEODE=R.DBSYSTEMVALUES_NEO4J=R.DBSYSTEMVALUES_DYNAMODB=R.DBSYSTEMVALUES_COSMOSDB=R.DBSYSTEMVALUES_COUCHDB=R.DBSYSTEMVALUES_COUCHBASE=R.DBSYSTEMVALUES_REDIS=R.DBSYSTEMVALUES_MONGODB=R.DBSYSTEMVALUES_HBASE=R.DBSYSTEMVALUES_CASSANDRA=R.DBSYSTEMVALUES_COLDFUSION=R.DBSYSTEMVALUES_H2=R.DBSYSTEMVALUES_VERTICA=R.DBSYSTEMVALUES_TERADATA=R.DBSYSTEMVALUES_SYBASE=R.DBSYSTEMVALUES_SQLITE=R.DBSYSTEMVALUES_POINTBASE=R.DBSYSTEMVALUES_PERVASIVE=R.DBSYSTEMVALUES_NETEZZA=R.DBSYSTEMVALUES_MARIADB=R.DBSYSTEMVALUES_INTERBASE=R.DBSYSTEMVALUES_INSTANTDB=R.DBSYSTEMVALUES_INFORMIX=void 0,R.MESSAGINGOPERATIONVALUES_RECEIVE=R.MessagingDestinationKindValues=R.MESSAGINGDESTINATIONKINDVALUES_TOPIC=R.MESSAGINGDESTINATIONKINDVALUES_QUEUE=R.HttpFlavorValues=R.HTTPFLAVORVALUES_QUIC=R.HTTPFLAVORVALUES_SPDY=R.HTTPFLAVORVALUES_HTTP_2_0=R.HTTPFLAVORVALUES_HTTP_1_1=R.HTTPFLAVORVALUES_HTTP_1_0=R.NetHostConnectionSubtypeValues=R.NETHOSTCONNECTIONSUBTYPEVALUES_LTE_CA=R.NETHOSTCONNECTIONSUBTYPEVALUES_NRNSA=R.NETHOSTCONNECTIONSUBTYPEVALUES_NR=R.NETHOSTCONNECTIONSUBTYPEVALUES_IWLAN=R.NETHOSTCONNECTIONSUBTYPEVALUES_TD_SCDMA=R.NETHOSTCONNECTIONSUBTYPEVALUES_GSM=R.NETHOSTCONNECTIONSUBTYPEVALUES_HSPAP=R.NETHOSTCONNECTIONSUBTYPEVALUES_EHRPD=R.NETHOSTCONNECTIONSUBTYPEVALUES_LTE=R.NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_B=R.NETHOSTCONNECTIONSUBTYPEVALUES_IDEN=R.NETHOSTCONNECTIONSUBTYPEVALUES_HSPA=R.NETHOSTCONNECTIONSUBTYPEVALUES_HSUPA=R.NETHOSTCONNECTIONSUBTYPEVALUES_HSDPA=R.NETHOSTCONNECTIONSUBTYPEVALUES_CDMA2000_1XRTT=R.NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_A=R.NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_0=R.NETHOSTCONNECTIONSUBTYPEVALUES_CDMA=R.NETHOSTCONNECTIONSUBTYPEVALUES_UMTS=R.NETHOSTCONNECTIONSUBTYPEVALUES_EDGE=R.NETHOSTCONNECTIONSUBTYPEVALUES_GPRS=R.NetHostConnectionTypeValues=R.NETHOSTCONNECTIONTYPEVALUES_UNKNOWN=R.NETHOSTCONNECTIONTYPEVALUES_UNAVAILABLE=R.NETHOSTCONNECTIONTYPEVALUES_CELL=R.NETHOSTCONNECTIONTYPEVALUES_WIRED=R.NETHOSTCONNECTIONTYPEVALUES_WIFI=R.NetTransportValues=R.NETTRANSPORTVALUES_OTHER=R.NETTRANSPORTVALUES_INPROC=R.NETTRANSPORTVALUES_PIPE=R.NETTRANSPORTVALUES_UNIX=R.NETTRANSPORTVALUES_IP=R.NETTRANSPORTVALUES_IP_UDP=R.NETTRANSPORTVALUES_IP_TCP=R.FaasInvokedProviderValues=R.FAASINVOKEDPROVIDERVALUES_GCP=R.FAASINVOKEDPROVIDERVALUES_AZURE=R.FAASINVOKEDPROVIDERVALUES_AWS=void 0,R.MessageTypeValues=R.MESSAGETYPEVALUES_RECEIVED=R.MESSAGETYPEVALUES_SENT=R.RpcGrpcStatusCodeValues=R.RPCGRPCSTATUSCODEVALUES_UNAUTHENTICATED=R.RPCGRPCSTATUSCODEVALUES_DATA_LOSS=R.RPCGRPCSTATUSCODEVALUES_UNAVAILABLE=R.RPCGRPCSTATUSCODEVALUES_INTERNAL=R.RPCGRPCSTATUSCODEVALUES_UNIMPLEMENTED=R.RPCGRPCSTATUSCODEVALUES_OUT_OF_RANGE=R.RPCGRPCSTATUSCODEVALUES_ABORTED=R.RPCGRPCSTATUSCODEVALUES_FAILED_PRECONDITION=R.RPCGRPCSTATUSCODEVALUES_RESOURCE_EXHAUSTED=R.RPCGRPCSTATUSCODEVALUES_PERMISSION_DENIED=R.RPCGRPCSTATUSCODEVALUES_ALREADY_EXISTS=R.RPCGRPCSTATUSCODEVALUES_NOT_FOUND=R.RPCGRPCSTATUSCODEVALUES_DEADLINE_EXCEEDED=R.RPCGRPCSTATUSCODEVALUES_INVALID_ARGUMENT=R.RPCGRPCSTATUSCODEVALUES_UNKNOWN=R.RPCGRPCSTATUSCODEVALUES_CANCELLED=R.RPCGRPCSTATUSCODEVALUES_OK=R.MessagingOperationValues=R.MESSAGINGOPERATIONVALUES_PROCESS=void 0;const e=bM(),t="aws.lambda.invoked_arn",n="db.system",r="db.connection_string",s="db.user",i="db.jdbc.driver_classname",o="db.name",c="db.statement",a="db.operation",l="db.mssql.instance_name",f="db.cassandra.keyspace",d="db.cassandra.page_size",u="db.cassandra.consistency_level",_="db.cassandra.table",p="db.cassandra.idempotence",h="db.cassandra.speculative_execution_count",E="db.cassandra.coordinator.id",T="db.cassandra.coordinator.dc",S="db.hbase.namespace",m="db.redis.database_index",g="db.mongodb.collection",y="db.sql.table",A="exception.type",N="exception.message",O="exception.stacktrace",b="exception.escaped",C="faas.trigger",w="faas.execution",k="faas.document.collection",U="faas.document.operation",M="faas.document.time",F="faas.document.name",v="faas.time",L="faas.cron",H="faas.coldstart",te="faas.invoked_name",ce="faas.invoked_provider",ee="faas.invoked_region",x="net.transport",B="net.peer.ip",j="net.peer.port",q="net.peer.name",z="net.host.ip",J="net.host.port",G="net.host.name",V="net.host.connection.type",X="net.host.connection.subtype",K="net.host.carrier.name",se="net.host.carrier.mcc",ae="net.host.carrier.mnc",_e="net.host.carrier.icc",de="peer.service",fe="enduser.id",$="enduser.role",W="enduser.scope",re="thread.id",le="thread.name",ie="code.function",Ae="code.namespace",Ke="code.filepath",Fe="code.lineno",dn="http.method",Rr="http.url",yr="http.target",Nr="http.host",fn="http.scheme",_n="http.status_code",qe="http.flavor",Ce="http.user_agent",it="http.request_content_length",Zt="http.request_content_length_uncompressed",pn="http.response_content_length",Or="http.response_content_length_uncompressed",Xt="http.server_name",hn="http.route",br="http.client_ip",Xn="aws.dynamodb.table_names",Ir="aws.dynamodb.consumed_capacity",Qn="aws.dynamodb.item_collection_metrics",zr="aws.dynamodb.provisioned_read_capacity",ao="aws.dynamodb.provisioned_write_capacity",co="aws.dynamodb.consistent_read",uo="aws.dynamodb.projection",lo="aws.dynamodb.limit",fo="aws.dynamodb.attributes_to_get",_o="aws.dynamodb.index_name",po="aws.dynamodb.select",ho="aws.dynamodb.global_secondary_indexes",Eo="aws.dynamodb.local_secondary_indexes",To="aws.dynamodb.exclusive_start_table",So="aws.dynamodb.table_count",mo="aws.dynamodb.scan_forward",go="aws.dynamodb.segment",Ao="aws.dynamodb.total_segments",Ro="aws.dynamodb.count",yo="aws.dynamodb.scanned_count",No="aws.dynamodb.attribute_definitions",Oo="aws.dynamodb.global_secondary_index_updates",bo="messaging.system",Io="messaging.destination",Co="messaging.destination_kind",vo="messaging.temp_destination",Po="messaging.protocol",Mo="messaging.protocol_version",wo="messaging.url",Lo="messaging.message_id",Do="messaging.conversation_id",Uo="messaging.message_payload_size_bytes",ko="messaging.message_payload_compressed_size_bytes",xo="messaging.operation",Bo="messaging.consumer_id",Go="messaging.rabbitmq.routing_key",Vo="messaging.kafka.message_key",$o="messaging.kafka.consumer_group",Ho="messaging.kafka.client_id",Fo="messaging.kafka.partition",jo="messaging.kafka.tombstone",qo="rpc.system",Yo="rpc.service",Wo="rpc.method",Ko="rpc.grpc.status_code",zo="rpc.jsonrpc.version",Zo="rpc.jsonrpc.request_id",Xo="rpc.jsonrpc.error_code",Qo="rpc.jsonrpc.error_message",Jo="message.type",ea="message.id",ta="message.compressed_size",na="message.uncompressed_size";R.SEMATTRS_AWS_LAMBDA_INVOKED_ARN=t,R.SEMATTRS_DB_SYSTEM=n,R.SEMATTRS_DB_CONNECTION_STRING=r,R.SEMATTRS_DB_USER=s,R.SEMATTRS_DB_JDBC_DRIVER_CLASSNAME=i,R.SEMATTRS_DB_NAME=o,R.SEMATTRS_DB_STATEMENT=c,R.SEMATTRS_DB_OPERATION=a,R.SEMATTRS_DB_MSSQL_INSTANCE_NAME=l,R.SEMATTRS_DB_CASSANDRA_KEYSPACE=f,R.SEMATTRS_DB_CASSANDRA_PAGE_SIZE=d,R.SEMATTRS_DB_CASSANDRA_CONSISTENCY_LEVEL=u,R.SEMATTRS_DB_CASSANDRA_TABLE=_,R.SEMATTRS_DB_CASSANDRA_IDEMPOTENCE=p,R.SEMATTRS_DB_CASSANDRA_SPECULATIVE_EXECUTION_COUNT=h,R.SEMATTRS_DB_CASSANDRA_COORDINATOR_ID=E,R.SEMATTRS_DB_CASSANDRA_COORDINATOR_DC=T,R.SEMATTRS_DB_HBASE_NAMESPACE=S,R.SEMATTRS_DB_REDIS_DATABASE_INDEX=m,R.SEMATTRS_DB_MONGODB_COLLECTION=g,R.SEMATTRS_DB_SQL_TABLE=y,R.SEMATTRS_EXCEPTION_TYPE=A,R.SEMATTRS_EXCEPTION_MESSAGE=N,R.SEMATTRS_EXCEPTION_STACKTRACE=O,R.SEMATTRS_EXCEPTION_ESCAPED=b,R.SEMATTRS_FAAS_TRIGGER=C,R.SEMATTRS_FAAS_EXECUTION=w,R.SEMATTRS_FAAS_DOCUMENT_COLLECTION=k,R.SEMATTRS_FAAS_DOCUMENT_OPERATION=U,R.SEMATTRS_FAAS_DOCUMENT_TIME=M,R.SEMATTRS_FAAS_DOCUMENT_NAME=F,R.SEMATTRS_FAAS_TIME=v,R.SEMATTRS_FAAS_CRON=L,R.SEMATTRS_FAAS_COLDSTART=H,R.SEMATTRS_FAAS_INVOKED_NAME=te,R.SEMATTRS_FAAS_INVOKED_PROVIDER=ce,R.SEMATTRS_FAAS_INVOKED_REGION=ee,R.SEMATTRS_NET_TRANSPORT=x,R.SEMATTRS_NET_PEER_IP=B,R.SEMATTRS_NET_PEER_PORT=j,R.SEMATTRS_NET_PEER_NAME=q,R.SEMATTRS_NET_HOST_IP=z,R.SEMATTRS_NET_HOST_PORT=J,R.SEMATTRS_NET_HOST_NAME=G,R.SEMATTRS_NET_HOST_CONNECTION_TYPE=V,R.SEMATTRS_NET_HOST_CONNECTION_SUBTYPE=X,R.SEMATTRS_NET_HOST_CARRIER_NAME=K,R.SEMATTRS_NET_HOST_CARRIER_MCC=se,R.SEMATTRS_NET_HOST_CARRIER_MNC=ae,R.SEMATTRS_NET_HOST_CARRIER_ICC=_e,R.SEMATTRS_PEER_SERVICE=de,R.SEMATTRS_ENDUSER_ID=fe,R.SEMATTRS_ENDUSER_ROLE=$,R.SEMATTRS_ENDUSER_SCOPE=W,R.SEMATTRS_THREAD_ID=re,R.SEMATTRS_THREAD_NAME=le,R.SEMATTRS_CODE_FUNCTION=ie,R.SEMATTRS_CODE_NAMESPACE=Ae,R.SEMATTRS_CODE_FILEPATH=Ke,R.SEMATTRS_CODE_LINENO=Fe,R.SEMATTRS_HTTP_METHOD=dn,R.SEMATTRS_HTTP_URL=Rr,R.SEMATTRS_HTTP_TARGET=yr,R.SEMATTRS_HTTP_HOST=Nr,R.SEMATTRS_HTTP_SCHEME=fn,R.SEMATTRS_HTTP_STATUS_CODE=_n,R.SEMATTRS_HTTP_FLAVOR=qe,R.SEMATTRS_HTTP_USER_AGENT=Ce,R.SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH=it,R.SEMATTRS_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED=Zt,R.SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH=pn,R.SEMATTRS_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED=Or,R.SEMATTRS_HTTP_SERVER_NAME=Xt,R.SEMATTRS_HTTP_ROUTE=hn,R.SEMATTRS_HTTP_CLIENT_IP=br,R.SEMATTRS_AWS_DYNAMODB_TABLE_NAMES=Xn,R.SEMATTRS_AWS_DYNAMODB_CONSUMED_CAPACITY=Ir,R.SEMATTRS_AWS_DYNAMODB_ITEM_COLLECTION_METRICS=Qn,R.SEMATTRS_AWS_DYNAMODB_PROVISIONED_READ_CAPACITY=zr,R.SEMATTRS_AWS_DYNAMODB_PROVISIONED_WRITE_CAPACITY=ao,R.SEMATTRS_AWS_DYNAMODB_CONSISTENT_READ=co,R.SEMATTRS_AWS_DYNAMODB_PROJECTION=uo,R.SEMATTRS_AWS_DYNAMODB_LIMIT=lo,R.SEMATTRS_AWS_DYNAMODB_ATTRIBUTES_TO_GET=fo,R.SEMATTRS_AWS_DYNAMODB_INDEX_NAME=_o,R.SEMATTRS_AWS_DYNAMODB_SELECT=po,R.SEMATTRS_AWS_DYNAMODB_GLOBAL_SECONDARY_INDEXES=ho,R.SEMATTRS_AWS_DYNAMODB_LOCAL_SECONDARY_INDEXES=Eo,R.SEMATTRS_AWS_DYNAMODB_EXCLUSIVE_START_TABLE=To,R.SEMATTRS_AWS_DYNAMODB_TABLE_COUNT=So,R.SEMATTRS_AWS_DYNAMODB_SCAN_FORWARD=mo,R.SEMATTRS_AWS_DYNAMODB_SEGMENT=go,R.SEMATTRS_AWS_DYNAMODB_TOTAL_SEGMENTS=Ao,R.SEMATTRS_AWS_DYNAMODB_COUNT=Ro,R.SEMATTRS_AWS_DYNAMODB_SCANNED_COUNT=yo,R.SEMATTRS_AWS_DYNAMODB_ATTRIBUTE_DEFINITIONS=No,R.SEMATTRS_AWS_DYNAMODB_GLOBAL_SECONDARY_INDEX_UPDATES=Oo,R.SEMATTRS_MESSAGING_SYSTEM=bo,R.SEMATTRS_MESSAGING_DESTINATION=Io,R.SEMATTRS_MESSAGING_DESTINATION_KIND=Co,R.SEMATTRS_MESSAGING_TEMP_DESTINATION=vo,R.SEMATTRS_MESSAGING_PROTOCOL=Po,R.SEMATTRS_MESSAGING_PROTOCOL_VERSION=Mo,R.SEMATTRS_MESSAGING_URL=wo,R.SEMATTRS_MESSAGING_MESSAGE_ID=Lo,R.SEMATTRS_MESSAGING_CONVERSATION_ID=Do,R.SEMATTRS_MESSAGING_MESSAGE_PAYLOAD_SIZE_BYTES=Uo,R.SEMATTRS_MESSAGING_MESSAGE_PAYLOAD_COMPRESSED_SIZE_BYTES=ko,R.SEMATTRS_MESSAGING_OPERATION=xo,R.SEMATTRS_MESSAGING_CONSUMER_ID=Bo,R.SEMATTRS_MESSAGING_RABBITMQ_ROUTING_KEY=Go,R.SEMATTRS_MESSAGING_KAFKA_MESSAGE_KEY=Vo,R.SEMATTRS_MESSAGING_KAFKA_CONSUMER_GROUP=$o,R.SEMATTRS_MESSAGING_KAFKA_CLIENT_ID=Ho,R.SEMATTRS_MESSAGING_KAFKA_PARTITION=Fo,R.SEMATTRS_MESSAGING_KAFKA_TOMBSTONE=jo,R.SEMATTRS_RPC_SYSTEM=qo,R.SEMATTRS_RPC_SERVICE=Yo,R.SEMATTRS_RPC_METHOD=Wo,R.SEMATTRS_RPC_GRPC_STATUS_CODE=Ko,R.SEMATTRS_RPC_JSONRPC_VERSION=zo,R.SEMATTRS_RPC_JSONRPC_REQUEST_ID=Zo,R.SEMATTRS_RPC_JSONRPC_ERROR_CODE=Xo,R.SEMATTRS_RPC_JSONRPC_ERROR_MESSAGE=Qo,R.SEMATTRS_MESSAGE_TYPE=Jo,R.SEMATTRS_MESSAGE_ID=ea,R.SEMATTRS_MESSAGE_COMPRESSED_SIZE=ta,R.SEMATTRS_MESSAGE_UNCOMPRESSED_SIZE=na,R.SemanticAttributes=(0,e.createConstMap)([t,n,r,s,i,o,c,a,l,f,d,u,_,p,h,E,T,S,m,g,y,A,N,O,b,C,w,k,U,M,F,v,L,H,te,ce,ee,x,B,j,q,z,J,G,V,X,K,se,ae,_e,de,fe,$,W,re,le,ie,Ae,Ke,Fe,dn,Rr,yr,Nr,fn,_n,qe,Ce,it,Zt,pn,Or,Xt,hn,br,Xn,Ir,Qn,zr,ao,co,uo,lo,fo,_o,po,ho,Eo,To,So,mo,go,Ao,Ro,yo,No,Oo,bo,Io,Co,vo,Po,Mo,wo,Lo,Do,Uo,ko,xo,Bo,Go,Vo,$o,Ho,Fo,jo,qo,Yo,Wo,Ko,zo,Zo,Xo,Qo,Jo,ea,ta,na]);const ra="other_sql",sa="mssql",ia="mysql",oa="oracle",bS="db2",IS="postgresql",CS="redshift",vS="hive",PS="cloudscape",MS="hsqldb",wS="progress",LS="maxdb",DS="hanadb",US="ingres",kS="firstsql",xS="edb",BS="cache",GS="adabas",VS="firebird",$S="derby",HS="filemaker",FS="informix",jS="instantdb",qS="interbase",YS="mariadb",WS="netezza",KS="pervasive",zS="pointbase",ZS="sqlite",XS="sybase",QS="teradata",JS="vertica",em="h2",tm="coldfusion",nm="cassandra",rm="hbase",sm="mongodb",im="redis",om="couchbase",am="couchdb",cm="cosmosdb",um="dynamodb",lm="neo4j",dm="geode",fm="elasticsearch",_m="memcached",pm="cockroachdb";R.DBSYSTEMVALUES_OTHER_SQL=ra,R.DBSYSTEMVALUES_MSSQL=sa,R.DBSYSTEMVALUES_MYSQL=ia,R.DBSYSTEMVALUES_ORACLE=oa,R.DBSYSTEMVALUES_DB2=bS,R.DBSYSTEMVALUES_POSTGRESQL=IS,R.DBSYSTEMVALUES_REDSHIFT=CS,R.DBSYSTEMVALUES_HIVE=vS,R.DBSYSTEMVALUES_CLOUDSCAPE=PS,R.DBSYSTEMVALUES_HSQLDB=MS,R.DBSYSTEMVALUES_PROGRESS=wS,R.DBSYSTEMVALUES_MAXDB=LS,R.DBSYSTEMVALUES_HANADB=DS,R.DBSYSTEMVALUES_INGRES=US,R.DBSYSTEMVALUES_FIRSTSQL=kS,R.DBSYSTEMVALUES_EDB=xS,R.DBSYSTEMVALUES_CACHE=BS,R.DBSYSTEMVALUES_ADABAS=GS,R.DBSYSTEMVALUES_FIREBIRD=VS,R.DBSYSTEMVALUES_DERBY=$S,R.DBSYSTEMVALUES_FILEMAKER=HS,R.DBSYSTEMVALUES_INFORMIX=FS,R.DBSYSTEMVALUES_INSTANTDB=jS,R.DBSYSTEMVALUES_INTERBASE=qS,R.DBSYSTEMVALUES_MARIADB=YS,R.DBSYSTEMVALUES_NETEZZA=WS,R.DBSYSTEMVALUES_PERVASIVE=KS,R.DBSYSTEMVALUES_POINTBASE=zS,R.DBSYSTEMVALUES_SQLITE=ZS,R.DBSYSTEMVALUES_SYBASE=XS,R.DBSYSTEMVALUES_TERADATA=QS,R.DBSYSTEMVALUES_VERTICA=JS,R.DBSYSTEMVALUES_H2=em,R.DBSYSTEMVALUES_COLDFUSION=tm,R.DBSYSTEMVALUES_CASSANDRA=nm,R.DBSYSTEMVALUES_HBASE=rm,R.DBSYSTEMVALUES_MONGODB=sm,R.DBSYSTEMVALUES_REDIS=im,R.DBSYSTEMVALUES_COUCHBASE=om,R.DBSYSTEMVALUES_COUCHDB=am,R.DBSYSTEMVALUES_COSMOSDB=cm,R.DBSYSTEMVALUES_DYNAMODB=um,R.DBSYSTEMVALUES_NEO4J=lm,R.DBSYSTEMVALUES_GEODE=dm,R.DBSYSTEMVALUES_ELASTICSEARCH=fm,R.DBSYSTEMVALUES_MEMCACHED=_m,R.DBSYSTEMVALUES_COCKROACHDB=pm,R.DbSystemValues=(0,e.createConstMap)([ra,sa,ia,oa,bS,IS,CS,vS,PS,MS,wS,LS,DS,US,kS,xS,BS,GS,VS,$S,HS,FS,jS,qS,YS,WS,KS,zS,ZS,XS,QS,JS,em,tm,nm,rm,sm,im,om,am,cm,um,lm,dm,fm,_m,pm]);const hm="all",Em="each_quorum",Tm="quorum",Sm="local_quorum",mm="one",gm="two",Am="three",Rm="local_one",ym="any",Nm="serial",Om="local_serial";R.DBCASSANDRACONSISTENCYLEVELVALUES_ALL=hm,R.DBCASSANDRACONSISTENCYLEVELVALUES_EACH_QUORUM=Em,R.DBCASSANDRACONSISTENCYLEVELVALUES_QUORUM=Tm,R.DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_QUORUM=Sm,R.DBCASSANDRACONSISTENCYLEVELVALUES_ONE=mm,R.DBCASSANDRACONSISTENCYLEVELVALUES_TWO=gm,R.DBCASSANDRACONSISTENCYLEVELVALUES_THREE=Am,R.DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_ONE=Rm,R.DBCASSANDRACONSISTENCYLEVELVALUES_ANY=ym,R.DBCASSANDRACONSISTENCYLEVELVALUES_SERIAL=Nm,R.DBCASSANDRACONSISTENCYLEVELVALUES_LOCAL_SERIAL=Om,R.DbCassandraConsistencyLevelValues=(0,e.createConstMap)([hm,Em,Tm,Sm,mm,gm,Am,Rm,ym,Nm,Om]);const bm="datasource",Im="http",Cm="pubsub",vm="timer",Pm="other";R.FAASTRIGGERVALUES_DATASOURCE=bm,R.FAASTRIGGERVALUES_HTTP=Im,R.FAASTRIGGERVALUES_PUBSUB=Cm,R.FAASTRIGGERVALUES_TIMER=vm,R.FAASTRIGGERVALUES_OTHER=Pm,R.FaasTriggerValues=(0,e.createConstMap)([bm,Im,Cm,vm,Pm]);const Mm="insert",wm="edit",Lm="delete";R.FAASDOCUMENTOPERATIONVALUES_INSERT=Mm,R.FAASDOCUMENTOPERATIONVALUES_EDIT=wm,R.FAASDOCUMENTOPERATIONVALUES_DELETE=Lm,R.FaasDocumentOperationValues=(0,e.createConstMap)([Mm,wm,Lm]);const Dm="alibaba_cloud",Um="aws",km="azure",xm="gcp";R.FAASINVOKEDPROVIDERVALUES_ALIBABA_CLOUD=Dm,R.FAASINVOKEDPROVIDERVALUES_AWS=Um,R.FAASINVOKEDPROVIDERVALUES_AZURE=km,R.FAASINVOKEDPROVIDERVALUES_GCP=xm,R.FaasInvokedProviderValues=(0,e.createConstMap)([Dm,Um,km,xm]);const Bm="ip_tcp",Gm="ip_udp",Vm="ip",$m="unix",Hm="pipe",Fm="inproc",jm="other";R.NETTRANSPORTVALUES_IP_TCP=Bm,R.NETTRANSPORTVALUES_IP_UDP=Gm,R.NETTRANSPORTVALUES_IP=Vm,R.NETTRANSPORTVALUES_UNIX=$m,R.NETTRANSPORTVALUES_PIPE=Hm,R.NETTRANSPORTVALUES_INPROC=Fm,R.NETTRANSPORTVALUES_OTHER=jm,R.NetTransportValues=(0,e.createConstMap)([Bm,Gm,Vm,$m,Hm,Fm,jm]);const qm="wifi",Ym="wired",Wm="cell",Km="unavailable",zm="unknown";R.NETHOSTCONNECTIONTYPEVALUES_WIFI=qm,R.NETHOSTCONNECTIONTYPEVALUES_WIRED=Ym,R.NETHOSTCONNECTIONTYPEVALUES_CELL=Wm,R.NETHOSTCONNECTIONTYPEVALUES_UNAVAILABLE=Km,R.NETHOSTCONNECTIONTYPEVALUES_UNKNOWN=zm,R.NetHostConnectionTypeValues=(0,e.createConstMap)([qm,Ym,Wm,Km,zm]);const Zm="gprs",Xm="edge",Qm="umts",Jm="cdma",eg="evdo_0",tg="evdo_a",ng="cdma2000_1xrtt",rg="hsdpa",sg="hsupa",ig="hspa",og="iden",ag="evdo_b",cg="lte",ug="ehrpd",lg="hspap",dg="gsm",fg="td_scdma",_g="iwlan",pg="nr",hg="nrnsa",Eg="lte_ca";R.NETHOSTCONNECTIONSUBTYPEVALUES_GPRS=Zm,R.NETHOSTCONNECTIONSUBTYPEVALUES_EDGE=Xm,R.NETHOSTCONNECTIONSUBTYPEVALUES_UMTS=Qm,R.NETHOSTCONNECTIONSUBTYPEVALUES_CDMA=Jm,R.NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_0=eg,R.NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_A=tg,R.NETHOSTCONNECTIONSUBTYPEVALUES_CDMA2000_1XRTT=ng,R.NETHOSTCONNECTIONSUBTYPEVALUES_HSDPA=rg,R.NETHOSTCONNECTIONSUBTYPEVALUES_HSUPA=sg,R.NETHOSTCONNECTIONSUBTYPEVALUES_HSPA=ig,R.NETHOSTCONNECTIONSUBTYPEVALUES_IDEN=og,R.NETHOSTCONNECTIONSUBTYPEVALUES_EVDO_B=ag,R.NETHOSTCONNECTIONSUBTYPEVALUES_LTE=cg,R.NETHOSTCONNECTIONSUBTYPEVALUES_EHRPD=ug,R.NETHOSTCONNECTIONSUBTYPEVALUES_HSPAP=lg,R.NETHOSTCONNECTIONSUBTYPEVALUES_GSM=dg,R.NETHOSTCONNECTIONSUBTYPEVALUES_TD_SCDMA=fg,R.NETHOSTCONNECTIONSUBTYPEVALUES_IWLAN=_g,R.NETHOSTCONNECTIONSUBTYPEVALUES_NR=pg,R.NETHOSTCONNECTIONSUBTYPEVALUES_NRNSA=hg,R.NETHOSTCONNECTIONSUBTYPEVALUES_LTE_CA=Eg,R.NetHostConnectionSubtypeValues=(0,e.createConstMap)([Zm,Xm,Qm,Jm,eg,tg,ng,rg,sg,ig,og,ag,cg,ug,lg,dg,fg,_g,pg,hg,Eg]);const Tg="1.0",Sg="1.1",mg="2.0",gg="SPDY",Ag="QUIC";R.HTTPFLAVORVALUES_HTTP_1_0=Tg,R.HTTPFLAVORVALUES_HTTP_1_1=Sg,R.HTTPFLAVORVALUES_HTTP_2_0=mg,R.HTTPFLAVORVALUES_SPDY=gg,R.HTTPFLAVORVALUES_QUIC=Ag,R.HttpFlavorValues={HTTP_1_0:Tg,HTTP_1_1:Sg,HTTP_2_0:mg,SPDY:gg,QUIC:Ag};const Rg="queue",yg="topic";R.MESSAGINGDESTINATIONKINDVALUES_QUEUE=Rg,R.MESSAGINGDESTINATIONKINDVALUES_TOPIC=yg,R.MessagingDestinationKindValues=(0,e.createConstMap)([Rg,yg]);const Ng="receive",Og="process";R.MESSAGINGOPERATIONVALUES_RECEIVE=Ng,R.MESSAGINGOPERATIONVALUES_PROCESS=Og,R.MessagingOperationValues=(0,e.createConstMap)([Ng,Og]);const bg=0,Ig=1,Cg=2,vg=3,Pg=4,Mg=5,wg=6,Lg=7,Dg=8,Ug=9,kg=10,xg=11,Bg=12,Gg=13,Vg=14,$g=15,Hg=16;R.RPCGRPCSTATUSCODEVALUES_OK=bg,R.RPCGRPCSTATUSCODEVALUES_CANCELLED=Ig,R.RPCGRPCSTATUSCODEVALUES_UNKNOWN=Cg,R.RPCGRPCSTATUSCODEVALUES_INVALID_ARGUMENT=vg,R.RPCGRPCSTATUSCODEVALUES_DEADLINE_EXCEEDED=Pg,R.RPCGRPCSTATUSCODEVALUES_NOT_FOUND=Mg,R.RPCGRPCSTATUSCODEVALUES_ALREADY_EXISTS=wg,R.RPCGRPCSTATUSCODEVALUES_PERMISSION_DENIED=Lg,R.RPCGRPCSTATUSCODEVALUES_RESOURCE_EXHAUSTED=Dg,R.RPCGRPCSTATUSCODEVALUES_FAILED_PRECONDITION=Ug,R.RPCGRPCSTATUSCODEVALUES_ABORTED=kg,R.RPCGRPCSTATUSCODEVALUES_OUT_OF_RANGE=xg,R.RPCGRPCSTATUSCODEVALUES_UNIMPLEMENTED=Bg,R.RPCGRPCSTATUSCODEVALUES_INTERNAL=Gg,R.RPCGRPCSTATUSCODEVALUES_UNAVAILABLE=Vg,R.RPCGRPCSTATUSCODEVALUES_DATA_LOSS=$g,R.RPCGRPCSTATUSCODEVALUES_UNAUTHENTICATED=Hg,R.RpcGrpcStatusCodeValues={OK:bg,CANCELLED:Ig,UNKNOWN:Cg,INVALID_ARGUMENT:vg,DEADLINE_EXCEEDED:Pg,NOT_FOUND:Mg,ALREADY_EXISTS:wg,PERMISSION_DENIED:Lg,RESOURCE_EXHAUSTED:Dg,FAILED_PRECONDITION:Ug,ABORTED:kg,OUT_OF_RANGE:xg,UNIMPLEMENTED:Bg,INTERNAL:Gg,UNAVAILABLE:Vg,DATA_LOSS:$g,UNAUTHENTICATED:Hg};const Fg="SENT",jg="RECEIVED";return R.MESSAGETYPEVALUES_SENT=Fg,R.MESSAGETYPEVALUES_RECEIVED=jg,R.MessageTypeValues=(0,e.createConstMap)([Fg,jg]),R}var FA;function P1(){return FA||(FA=1,(function(e){var t=is&&is.__createBinding||(Object.create?(function(r,s,i,o){o===void 0&&(o=i);var c=Object.getOwnPropertyDescriptor(s,i);(!c||("get"in c?!s.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return s[i]}}),Object.defineProperty(r,o,c)}):(function(r,s,i,o){o===void 0&&(o=i),r[o]=s[i]})),n=is&&is.__exportStar||function(r,s){for(var i in r)i!=="default"&&!Object.prototype.hasOwnProperty.call(s,i)&&t(s,r,i)};Object.defineProperty(e,"__esModule",{value:!0}),n(v1(),e)})(is)),is}var os={},I={},jA;function M1(){if(jA)return I;jA=1,Object.defineProperty(I,"__esModule",{value:!0}),I.SEMRESATTRS_K8S_STATEFULSET_NAME=I.SEMRESATTRS_K8S_STATEFULSET_UID=I.SEMRESATTRS_K8S_DEPLOYMENT_NAME=I.SEMRESATTRS_K8S_DEPLOYMENT_UID=I.SEMRESATTRS_K8S_REPLICASET_NAME=I.SEMRESATTRS_K8S_REPLICASET_UID=I.SEMRESATTRS_K8S_CONTAINER_NAME=I.SEMRESATTRS_K8S_POD_NAME=I.SEMRESATTRS_K8S_POD_UID=I.SEMRESATTRS_K8S_NAMESPACE_NAME=I.SEMRESATTRS_K8S_NODE_UID=I.SEMRESATTRS_K8S_NODE_NAME=I.SEMRESATTRS_K8S_CLUSTER_NAME=I.SEMRESATTRS_HOST_IMAGE_VERSION=I.SEMRESATTRS_HOST_IMAGE_ID=I.SEMRESATTRS_HOST_IMAGE_NAME=I.SEMRESATTRS_HOST_ARCH=I.SEMRESATTRS_HOST_TYPE=I.SEMRESATTRS_HOST_NAME=I.SEMRESATTRS_HOST_ID=I.SEMRESATTRS_FAAS_MAX_MEMORY=I.SEMRESATTRS_FAAS_INSTANCE=I.SEMRESATTRS_FAAS_VERSION=I.SEMRESATTRS_FAAS_ID=I.SEMRESATTRS_FAAS_NAME=I.SEMRESATTRS_DEVICE_MODEL_NAME=I.SEMRESATTRS_DEVICE_MODEL_IDENTIFIER=I.SEMRESATTRS_DEVICE_ID=I.SEMRESATTRS_DEPLOYMENT_ENVIRONMENT=I.SEMRESATTRS_CONTAINER_IMAGE_TAG=I.SEMRESATTRS_CONTAINER_IMAGE_NAME=I.SEMRESATTRS_CONTAINER_RUNTIME=I.SEMRESATTRS_CONTAINER_ID=I.SEMRESATTRS_CONTAINER_NAME=I.SEMRESATTRS_AWS_LOG_STREAM_ARNS=I.SEMRESATTRS_AWS_LOG_STREAM_NAMES=I.SEMRESATTRS_AWS_LOG_GROUP_ARNS=I.SEMRESATTRS_AWS_LOG_GROUP_NAMES=I.SEMRESATTRS_AWS_EKS_CLUSTER_ARN=I.SEMRESATTRS_AWS_ECS_TASK_REVISION=I.SEMRESATTRS_AWS_ECS_TASK_FAMILY=I.SEMRESATTRS_AWS_ECS_TASK_ARN=I.SEMRESATTRS_AWS_ECS_LAUNCHTYPE=I.SEMRESATTRS_AWS_ECS_CLUSTER_ARN=I.SEMRESATTRS_AWS_ECS_CONTAINER_ARN=I.SEMRESATTRS_CLOUD_PLATFORM=I.SEMRESATTRS_CLOUD_AVAILABILITY_ZONE=I.SEMRESATTRS_CLOUD_REGION=I.SEMRESATTRS_CLOUD_ACCOUNT_ID=I.SEMRESATTRS_CLOUD_PROVIDER=void 0,I.CLOUDPLATFORMVALUES_GCP_COMPUTE_ENGINE=I.CLOUDPLATFORMVALUES_AZURE_APP_SERVICE=I.CLOUDPLATFORMVALUES_AZURE_FUNCTIONS=I.CLOUDPLATFORMVALUES_AZURE_AKS=I.CLOUDPLATFORMVALUES_AZURE_CONTAINER_INSTANCES=I.CLOUDPLATFORMVALUES_AZURE_VM=I.CLOUDPLATFORMVALUES_AWS_ELASTIC_BEANSTALK=I.CLOUDPLATFORMVALUES_AWS_LAMBDA=I.CLOUDPLATFORMVALUES_AWS_EKS=I.CLOUDPLATFORMVALUES_AWS_ECS=I.CLOUDPLATFORMVALUES_AWS_EC2=I.CLOUDPLATFORMVALUES_ALIBABA_CLOUD_FC=I.CLOUDPLATFORMVALUES_ALIBABA_CLOUD_ECS=I.CloudProviderValues=I.CLOUDPROVIDERVALUES_GCP=I.CLOUDPROVIDERVALUES_AZURE=I.CLOUDPROVIDERVALUES_AWS=I.CLOUDPROVIDERVALUES_ALIBABA_CLOUD=I.SemanticResourceAttributes=I.SEMRESATTRS_WEBENGINE_DESCRIPTION=I.SEMRESATTRS_WEBENGINE_VERSION=I.SEMRESATTRS_WEBENGINE_NAME=I.SEMRESATTRS_TELEMETRY_AUTO_VERSION=I.SEMRESATTRS_TELEMETRY_SDK_VERSION=I.SEMRESATTRS_TELEMETRY_SDK_LANGUAGE=I.SEMRESATTRS_TELEMETRY_SDK_NAME=I.SEMRESATTRS_SERVICE_VERSION=I.SEMRESATTRS_SERVICE_INSTANCE_ID=I.SEMRESATTRS_SERVICE_NAMESPACE=I.SEMRESATTRS_SERVICE_NAME=I.SEMRESATTRS_PROCESS_RUNTIME_DESCRIPTION=I.SEMRESATTRS_PROCESS_RUNTIME_VERSION=I.SEMRESATTRS_PROCESS_RUNTIME_NAME=I.SEMRESATTRS_PROCESS_OWNER=I.SEMRESATTRS_PROCESS_COMMAND_ARGS=I.SEMRESATTRS_PROCESS_COMMAND_LINE=I.SEMRESATTRS_PROCESS_COMMAND=I.SEMRESATTRS_PROCESS_EXECUTABLE_PATH=I.SEMRESATTRS_PROCESS_EXECUTABLE_NAME=I.SEMRESATTRS_PROCESS_PID=I.SEMRESATTRS_OS_VERSION=I.SEMRESATTRS_OS_NAME=I.SEMRESATTRS_OS_DESCRIPTION=I.SEMRESATTRS_OS_TYPE=I.SEMRESATTRS_K8S_CRONJOB_NAME=I.SEMRESATTRS_K8S_CRONJOB_UID=I.SEMRESATTRS_K8S_JOB_NAME=I.SEMRESATTRS_K8S_JOB_UID=I.SEMRESATTRS_K8S_DAEMONSET_NAME=I.SEMRESATTRS_K8S_DAEMONSET_UID=void 0,I.TelemetrySdkLanguageValues=I.TELEMETRYSDKLANGUAGEVALUES_WEBJS=I.TELEMETRYSDKLANGUAGEVALUES_RUBY=I.TELEMETRYSDKLANGUAGEVALUES_PYTHON=I.TELEMETRYSDKLANGUAGEVALUES_PHP=I.TELEMETRYSDKLANGUAGEVALUES_NODEJS=I.TELEMETRYSDKLANGUAGEVALUES_JAVA=I.TELEMETRYSDKLANGUAGEVALUES_GO=I.TELEMETRYSDKLANGUAGEVALUES_ERLANG=I.TELEMETRYSDKLANGUAGEVALUES_DOTNET=I.TELEMETRYSDKLANGUAGEVALUES_CPP=I.OsTypeValues=I.OSTYPEVALUES_Z_OS=I.OSTYPEVALUES_SOLARIS=I.OSTYPEVALUES_AIX=I.OSTYPEVALUES_HPUX=I.OSTYPEVALUES_DRAGONFLYBSD=I.OSTYPEVALUES_OPENBSD=I.OSTYPEVALUES_NETBSD=I.OSTYPEVALUES_FREEBSD=I.OSTYPEVALUES_DARWIN=I.OSTYPEVALUES_LINUX=I.OSTYPEVALUES_WINDOWS=I.HostArchValues=I.HOSTARCHVALUES_X86=I.HOSTARCHVALUES_PPC64=I.HOSTARCHVALUES_PPC32=I.HOSTARCHVALUES_IA64=I.HOSTARCHVALUES_ARM64=I.HOSTARCHVALUES_ARM32=I.HOSTARCHVALUES_AMD64=I.AwsEcsLaunchtypeValues=I.AWSECSLAUNCHTYPEVALUES_FARGATE=I.AWSECSLAUNCHTYPEVALUES_EC2=I.CloudPlatformValues=I.CLOUDPLATFORMVALUES_GCP_APP_ENGINE=I.CLOUDPLATFORMVALUES_GCP_CLOUD_FUNCTIONS=I.CLOUDPLATFORMVALUES_GCP_KUBERNETES_ENGINE=I.CLOUDPLATFORMVALUES_GCP_CLOUD_RUN=void 0;const e=bM(),t="cloud.provider",n="cloud.account.id",r="cloud.region",s="cloud.availability_zone",i="cloud.platform",o="aws.ecs.container.arn",c="aws.ecs.cluster.arn",a="aws.ecs.launchtype",l="aws.ecs.task.arn",f="aws.ecs.task.family",d="aws.ecs.task.revision",u="aws.eks.cluster.arn",_="aws.log.group.names",p="aws.log.group.arns",h="aws.log.stream.names",E="aws.log.stream.arns",T="container.name",S="container.id",m="container.runtime",g="container.image.name",y="container.image.tag",A="deployment.environment",N="device.id",O="device.model.identifier",b="device.model.name",C="faas.name",w="faas.id",k="faas.version",U="faas.instance",M="faas.max_memory",F="host.id",v="host.name",L="host.type",H="host.arch",te="host.image.name",ce="host.image.id",ee="host.image.version",x="k8s.cluster.name",B="k8s.node.name",j="k8s.node.uid",q="k8s.namespace.name",z="k8s.pod.uid",J="k8s.pod.name",G="k8s.container.name",V="k8s.replicaset.uid",X="k8s.replicaset.name",K="k8s.deployment.uid",se="k8s.deployment.name",ae="k8s.statefulset.uid",_e="k8s.statefulset.name",de="k8s.daemonset.uid",fe="k8s.daemonset.name",$="k8s.job.uid",W="k8s.job.name",re="k8s.cronjob.uid",le="k8s.cronjob.name",ie="os.type",Ae="os.description",Ke="os.name",Fe="os.version",dn="process.pid",Rr="process.executable.name",yr="process.executable.path",Nr="process.command",fn="process.command_line",_n="process.command_args",qe="process.owner",Ce="process.runtime.name",it="process.runtime.version",Zt="process.runtime.description",pn="service.name",Or="service.namespace",Xt="service.instance.id",hn="service.version",br="telemetry.sdk.name",Xn="telemetry.sdk.language",Ir="telemetry.sdk.version",Qn="telemetry.auto.version",zr="webengine.name",ao="webengine.version",co="webengine.description";I.SEMRESATTRS_CLOUD_PROVIDER=t,I.SEMRESATTRS_CLOUD_ACCOUNT_ID=n,I.SEMRESATTRS_CLOUD_REGION=r,I.SEMRESATTRS_CLOUD_AVAILABILITY_ZONE=s,I.SEMRESATTRS_CLOUD_PLATFORM=i,I.SEMRESATTRS_AWS_ECS_CONTAINER_ARN=o,I.SEMRESATTRS_AWS_ECS_CLUSTER_ARN=c,I.SEMRESATTRS_AWS_ECS_LAUNCHTYPE=a,I.SEMRESATTRS_AWS_ECS_TASK_ARN=l,I.SEMRESATTRS_AWS_ECS_TASK_FAMILY=f,I.SEMRESATTRS_AWS_ECS_TASK_REVISION=d,I.SEMRESATTRS_AWS_EKS_CLUSTER_ARN=u,I.SEMRESATTRS_AWS_LOG_GROUP_NAMES=_,I.SEMRESATTRS_AWS_LOG_GROUP_ARNS=p,I.SEMRESATTRS_AWS_LOG_STREAM_NAMES=h,I.SEMRESATTRS_AWS_LOG_STREAM_ARNS=E,I.SEMRESATTRS_CONTAINER_NAME=T,I.SEMRESATTRS_CONTAINER_ID=S,I.SEMRESATTRS_CONTAINER_RUNTIME=m,I.SEMRESATTRS_CONTAINER_IMAGE_NAME=g,I.SEMRESATTRS_CONTAINER_IMAGE_TAG=y,I.SEMRESATTRS_DEPLOYMENT_ENVIRONMENT=A,I.SEMRESATTRS_DEVICE_ID=N,I.SEMRESATTRS_DEVICE_MODEL_IDENTIFIER=O,I.SEMRESATTRS_DEVICE_MODEL_NAME=b,I.SEMRESATTRS_FAAS_NAME=C,I.SEMRESATTRS_FAAS_ID=w,I.SEMRESATTRS_FAAS_VERSION=k,I.SEMRESATTRS_FAAS_INSTANCE=U,I.SEMRESATTRS_FAAS_MAX_MEMORY=M,I.SEMRESATTRS_HOST_ID=F,I.SEMRESATTRS_HOST_NAME=v,I.SEMRESATTRS_HOST_TYPE=L,I.SEMRESATTRS_HOST_ARCH=H,I.SEMRESATTRS_HOST_IMAGE_NAME=te,I.SEMRESATTRS_HOST_IMAGE_ID=ce,I.SEMRESATTRS_HOST_IMAGE_VERSION=ee,I.SEMRESATTRS_K8S_CLUSTER_NAME=x,I.SEMRESATTRS_K8S_NODE_NAME=B,I.SEMRESATTRS_K8S_NODE_UID=j,I.SEMRESATTRS_K8S_NAMESPACE_NAME=q,I.SEMRESATTRS_K8S_POD_UID=z,I.SEMRESATTRS_K8S_POD_NAME=J,I.SEMRESATTRS_K8S_CONTAINER_NAME=G,I.SEMRESATTRS_K8S_REPLICASET_UID=V,I.SEMRESATTRS_K8S_REPLICASET_NAME=X,I.SEMRESATTRS_K8S_DEPLOYMENT_UID=K,I.SEMRESATTRS_K8S_DEPLOYMENT_NAME=se,I.SEMRESATTRS_K8S_STATEFULSET_UID=ae,I.SEMRESATTRS_K8S_STATEFULSET_NAME=_e,I.SEMRESATTRS_K8S_DAEMONSET_UID=de,I.SEMRESATTRS_K8S_DAEMONSET_NAME=fe,I.SEMRESATTRS_K8S_JOB_UID=$,I.SEMRESATTRS_K8S_JOB_NAME=W,I.SEMRESATTRS_K8S_CRONJOB_UID=re,I.SEMRESATTRS_K8S_CRONJOB_NAME=le,I.SEMRESATTRS_OS_TYPE=ie,I.SEMRESATTRS_OS_DESCRIPTION=Ae,I.SEMRESATTRS_OS_NAME=Ke,I.SEMRESATTRS_OS_VERSION=Fe,I.SEMRESATTRS_PROCESS_PID=dn,I.SEMRESATTRS_PROCESS_EXECUTABLE_NAME=Rr,I.SEMRESATTRS_PROCESS_EXECUTABLE_PATH=yr,I.SEMRESATTRS_PROCESS_COMMAND=Nr,I.SEMRESATTRS_PROCESS_COMMAND_LINE=fn,I.SEMRESATTRS_PROCESS_COMMAND_ARGS=_n,I.SEMRESATTRS_PROCESS_OWNER=qe,I.SEMRESATTRS_PROCESS_RUNTIME_NAME=Ce,I.SEMRESATTRS_PROCESS_RUNTIME_VERSION=it,I.SEMRESATTRS_PROCESS_RUNTIME_DESCRIPTION=Zt,I.SEMRESATTRS_SERVICE_NAME=pn,I.SEMRESATTRS_SERVICE_NAMESPACE=Or,I.SEMRESATTRS_SERVICE_INSTANCE_ID=Xt,I.SEMRESATTRS_SERVICE_VERSION=hn,I.SEMRESATTRS_TELEMETRY_SDK_NAME=br,I.SEMRESATTRS_TELEMETRY_SDK_LANGUAGE=Xn,I.SEMRESATTRS_TELEMETRY_SDK_VERSION=Ir,I.SEMRESATTRS_TELEMETRY_AUTO_VERSION=Qn,I.SEMRESATTRS_WEBENGINE_NAME=zr,I.SEMRESATTRS_WEBENGINE_VERSION=ao,I.SEMRESATTRS_WEBENGINE_DESCRIPTION=co,I.SemanticResourceAttributes=(0,e.createConstMap)([t,n,r,s,i,o,c,a,l,f,d,u,_,p,h,E,T,S,m,g,y,A,N,O,b,C,w,k,U,M,F,v,L,H,te,ce,ee,x,B,j,q,z,J,G,V,X,K,se,ae,_e,de,fe,$,W,re,le,ie,Ae,Ke,Fe,dn,Rr,yr,Nr,fn,_n,qe,Ce,it,Zt,pn,Or,Xt,hn,br,Xn,Ir,Qn,zr,ao,co]);const uo="alibaba_cloud",lo="aws",fo="azure",_o="gcp";I.CLOUDPROVIDERVALUES_ALIBABA_CLOUD=uo,I.CLOUDPROVIDERVALUES_AWS=lo,I.CLOUDPROVIDERVALUES_AZURE=fo,I.CLOUDPROVIDERVALUES_GCP=_o,I.CloudProviderValues=(0,e.createConstMap)([uo,lo,fo,_o]);const po="alibaba_cloud_ecs",ho="alibaba_cloud_fc",Eo="aws_ec2",To="aws_ecs",So="aws_eks",mo="aws_lambda",go="aws_elastic_beanstalk",Ao="azure_vm",Ro="azure_container_instances",yo="azure_aks",No="azure_functions",Oo="azure_app_service",bo="gcp_compute_engine",Io="gcp_cloud_run",Co="gcp_kubernetes_engine",vo="gcp_cloud_functions",Po="gcp_app_engine";I.CLOUDPLATFORMVALUES_ALIBABA_CLOUD_ECS=po,I.CLOUDPLATFORMVALUES_ALIBABA_CLOUD_FC=ho,I.CLOUDPLATFORMVALUES_AWS_EC2=Eo,I.CLOUDPLATFORMVALUES_AWS_ECS=To,I.CLOUDPLATFORMVALUES_AWS_EKS=So,I.CLOUDPLATFORMVALUES_AWS_LAMBDA=mo,I.CLOUDPLATFORMVALUES_AWS_ELASTIC_BEANSTALK=go,I.CLOUDPLATFORMVALUES_AZURE_VM=Ao,I.CLOUDPLATFORMVALUES_AZURE_CONTAINER_INSTANCES=Ro,I.CLOUDPLATFORMVALUES_AZURE_AKS=yo,I.CLOUDPLATFORMVALUES_AZURE_FUNCTIONS=No,I.CLOUDPLATFORMVALUES_AZURE_APP_SERVICE=Oo,I.CLOUDPLATFORMVALUES_GCP_COMPUTE_ENGINE=bo,I.CLOUDPLATFORMVALUES_GCP_CLOUD_RUN=Io,I.CLOUDPLATFORMVALUES_GCP_KUBERNETES_ENGINE=Co,I.CLOUDPLATFORMVALUES_GCP_CLOUD_FUNCTIONS=vo,I.CLOUDPLATFORMVALUES_GCP_APP_ENGINE=Po,I.CloudPlatformValues=(0,e.createConstMap)([po,ho,Eo,To,So,mo,go,Ao,Ro,yo,No,Oo,bo,Io,Co,vo,Po]);const Mo="ec2",wo="fargate";I.AWSECSLAUNCHTYPEVALUES_EC2=Mo,I.AWSECSLAUNCHTYPEVALUES_FARGATE=wo,I.AwsEcsLaunchtypeValues=(0,e.createConstMap)([Mo,wo]);const Lo="amd64",Do="arm32",Uo="arm64",ko="ia64",xo="ppc32",Bo="ppc64",Go="x86";I.HOSTARCHVALUES_AMD64=Lo,I.HOSTARCHVALUES_ARM32=Do,I.HOSTARCHVALUES_ARM64=Uo,I.HOSTARCHVALUES_IA64=ko,I.HOSTARCHVALUES_PPC32=xo,I.HOSTARCHVALUES_PPC64=Bo,I.HOSTARCHVALUES_X86=Go,I.HostArchValues=(0,e.createConstMap)([Lo,Do,Uo,ko,xo,Bo,Go]);const Vo="windows",$o="linux",Ho="darwin",Fo="freebsd",jo="netbsd",qo="openbsd",Yo="dragonflybsd",Wo="hpux",Ko="aix",zo="solaris",Zo="z_os";I.OSTYPEVALUES_WINDOWS=Vo,I.OSTYPEVALUES_LINUX=$o,I.OSTYPEVALUES_DARWIN=Ho,I.OSTYPEVALUES_FREEBSD=Fo,I.OSTYPEVALUES_NETBSD=jo,I.OSTYPEVALUES_OPENBSD=qo,I.OSTYPEVALUES_DRAGONFLYBSD=Yo,I.OSTYPEVALUES_HPUX=Wo,I.OSTYPEVALUES_AIX=Ko,I.OSTYPEVALUES_SOLARIS=zo,I.OSTYPEVALUES_Z_OS=Zo,I.OsTypeValues=(0,e.createConstMap)([Vo,$o,Ho,Fo,jo,qo,Yo,Wo,Ko,zo,Zo]);const Xo="cpp",Qo="dotnet",Jo="erlang",ea="go",ta="java",na="nodejs",ra="php",sa="python",ia="ruby",oa="webjs";return I.TELEMETRYSDKLANGUAGEVALUES_CPP=Xo,I.TELEMETRYSDKLANGUAGEVALUES_DOTNET=Qo,I.TELEMETRYSDKLANGUAGEVALUES_ERLANG=Jo,I.TELEMETRYSDKLANGUAGEVALUES_GO=ea,I.TELEMETRYSDKLANGUAGEVALUES_JAVA=ta,I.TELEMETRYSDKLANGUAGEVALUES_NODEJS=na,I.TELEMETRYSDKLANGUAGEVALUES_PHP=ra,I.TELEMETRYSDKLANGUAGEVALUES_PYTHON=sa,I.TELEMETRYSDKLANGUAGEVALUES_RUBY=ia,I.TELEMETRYSDKLANGUAGEVALUES_WEBJS=oa,I.TelemetrySdkLanguageValues=(0,e.createConstMap)([Xo,Qo,Jo,ea,ta,na,ra,sa,ia,oa]),I}var qA;function w1(){return qA||(qA=1,(function(e){var t=os&&os.__createBinding||(Object.create?(function(r,s,i,o){o===void 0&&(o=i);var c=Object.getOwnPropertyDescriptor(s,i);(!c||("get"in c?!s.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return s[i]}}),Object.defineProperty(r,o,c)}):(function(r,s,i,o){o===void 0&&(o=i),r[o]=s[i]})),n=os&&os.__exportStar||function(r,s){for(var i in r)i!=="default"&&!Object.prototype.hasOwnProperty.call(s,i)&&t(s,r,i)};Object.defineProperty(e,"__esModule",{value:!0}),n(M1(),e)})(os)),os}var P={},YA;function L1(){if(YA)return P;YA=1,Object.defineProperty(P,"__esModule",{value:!0}),P.ATTR_EXCEPTION_TYPE=P.ATTR_EXCEPTION_STACKTRACE=P.ATTR_EXCEPTION_MESSAGE=P.ATTR_EXCEPTION_ESCAPED=P.ERROR_TYPE_VALUE_OTHER=P.ATTR_ERROR_TYPE=P.DOTNET_GC_HEAP_GENERATION_VALUE_POH=P.DOTNET_GC_HEAP_GENERATION_VALUE_LOH=P.DOTNET_GC_HEAP_GENERATION_VALUE_GEN2=P.DOTNET_GC_HEAP_GENERATION_VALUE_GEN1=P.DOTNET_GC_HEAP_GENERATION_VALUE_GEN0=P.ATTR_DOTNET_GC_HEAP_GENERATION=P.DB_SYSTEM_NAME_VALUE_POSTGRESQL=P.DB_SYSTEM_NAME_VALUE_MYSQL=P.DB_SYSTEM_NAME_VALUE_MICROSOFT_SQL_SERVER=P.DB_SYSTEM_NAME_VALUE_MARIADB=P.ATTR_DB_SYSTEM_NAME=P.ATTR_DB_STORED_PROCEDURE_NAME=P.ATTR_DB_RESPONSE_STATUS_CODE=P.ATTR_DB_QUERY_TEXT=P.ATTR_DB_QUERY_SUMMARY=P.ATTR_DB_OPERATION_NAME=P.ATTR_DB_OPERATION_BATCH_SIZE=P.ATTR_DB_NAMESPACE=P.ATTR_DB_COLLECTION_NAME=P.ATTR_CODE_STACKTRACE=P.ATTR_CODE_LINE_NUMBER=P.ATTR_CODE_FUNCTION_NAME=P.ATTR_CODE_FILE_PATH=P.ATTR_CODE_COLUMN_NUMBER=P.ATTR_CLIENT_PORT=P.ATTR_CLIENT_ADDRESS=P.ATTR_ASPNETCORE_USER_IS_AUTHENTICATED=P.ASPNETCORE_ROUTING_MATCH_STATUS_VALUE_SUCCESS=P.ASPNETCORE_ROUTING_MATCH_STATUS_VALUE_FAILURE=P.ATTR_ASPNETCORE_ROUTING_MATCH_STATUS=P.ATTR_ASPNETCORE_ROUTING_IS_FALLBACK=P.ATTR_ASPNETCORE_REQUEST_IS_UNHANDLED=P.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_REQUEST_CANCELED=P.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_GLOBAL_LIMITER=P.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_ENDPOINT_LIMITER=P.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_ACQUIRED=P.ATTR_ASPNETCORE_RATE_LIMITING_RESULT=P.ATTR_ASPNETCORE_RATE_LIMITING_POLICY=P.ATTR_ASPNETCORE_DIAGNOSTICS_HANDLER_TYPE=P.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_UNHANDLED=P.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_SKIPPED=P.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_HANDLED=P.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_ABORTED=P.ATTR_ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT=void 0,P.OTEL_STATUS_CODE_VALUE_ERROR=P.ATTR_OTEL_STATUS_CODE=P.ATTR_OTEL_SCOPE_VERSION=P.ATTR_OTEL_SCOPE_NAME=P.NETWORK_TYPE_VALUE_IPV6=P.NETWORK_TYPE_VALUE_IPV4=P.ATTR_NETWORK_TYPE=P.NETWORK_TRANSPORT_VALUE_UNIX=P.NETWORK_TRANSPORT_VALUE_UDP=P.NETWORK_TRANSPORT_VALUE_TCP=P.NETWORK_TRANSPORT_VALUE_QUIC=P.NETWORK_TRANSPORT_VALUE_PIPE=P.ATTR_NETWORK_TRANSPORT=P.ATTR_NETWORK_PROTOCOL_VERSION=P.ATTR_NETWORK_PROTOCOL_NAME=P.ATTR_NETWORK_PEER_PORT=P.ATTR_NETWORK_PEER_ADDRESS=P.ATTR_NETWORK_LOCAL_PORT=P.ATTR_NETWORK_LOCAL_ADDRESS=P.JVM_THREAD_STATE_VALUE_WAITING=P.JVM_THREAD_STATE_VALUE_TIMED_WAITING=P.JVM_THREAD_STATE_VALUE_TERMINATED=P.JVM_THREAD_STATE_VALUE_RUNNABLE=P.JVM_THREAD_STATE_VALUE_NEW=P.JVM_THREAD_STATE_VALUE_BLOCKED=P.ATTR_JVM_THREAD_STATE=P.ATTR_JVM_THREAD_DAEMON=P.JVM_MEMORY_TYPE_VALUE_NON_HEAP=P.JVM_MEMORY_TYPE_VALUE_HEAP=P.ATTR_JVM_MEMORY_TYPE=P.ATTR_JVM_MEMORY_POOL_NAME=P.ATTR_JVM_GC_NAME=P.ATTR_JVM_GC_ACTION=P.ATTR_HTTP_ROUTE=P.ATTR_HTTP_RESPONSE_STATUS_CODE=P.ATTR_HTTP_RESPONSE_HEADER=P.ATTR_HTTP_REQUEST_RESEND_COUNT=P.ATTR_HTTP_REQUEST_METHOD_ORIGINAL=P.HTTP_REQUEST_METHOD_VALUE_TRACE=P.HTTP_REQUEST_METHOD_VALUE_PUT=P.HTTP_REQUEST_METHOD_VALUE_POST=P.HTTP_REQUEST_METHOD_VALUE_PATCH=P.HTTP_REQUEST_METHOD_VALUE_OPTIONS=P.HTTP_REQUEST_METHOD_VALUE_HEAD=P.HTTP_REQUEST_METHOD_VALUE_GET=P.HTTP_REQUEST_METHOD_VALUE_DELETE=P.HTTP_REQUEST_METHOD_VALUE_CONNECT=P.HTTP_REQUEST_METHOD_VALUE_OTHER=P.ATTR_HTTP_REQUEST_METHOD=P.ATTR_HTTP_REQUEST_HEADER=void 0,P.ATTR_USER_AGENT_ORIGINAL=P.ATTR_URL_SCHEME=P.ATTR_URL_QUERY=P.ATTR_URL_PATH=P.ATTR_URL_FULL=P.ATTR_URL_FRAGMENT=P.ATTR_TELEMETRY_SDK_VERSION=P.ATTR_TELEMETRY_SDK_NAME=P.TELEMETRY_SDK_LANGUAGE_VALUE_WEBJS=P.TELEMETRY_SDK_LANGUAGE_VALUE_SWIFT=P.TELEMETRY_SDK_LANGUAGE_VALUE_RUST=P.TELEMETRY_SDK_LANGUAGE_VALUE_RUBY=P.TELEMETRY_SDK_LANGUAGE_VALUE_PYTHON=P.TELEMETRY_SDK_LANGUAGE_VALUE_PHP=P.TELEMETRY_SDK_LANGUAGE_VALUE_NODEJS=P.TELEMETRY_SDK_LANGUAGE_VALUE_JAVA=P.TELEMETRY_SDK_LANGUAGE_VALUE_GO=P.TELEMETRY_SDK_LANGUAGE_VALUE_ERLANG=P.TELEMETRY_SDK_LANGUAGE_VALUE_DOTNET=P.TELEMETRY_SDK_LANGUAGE_VALUE_CPP=P.ATTR_TELEMETRY_SDK_LANGUAGE=P.SIGNALR_TRANSPORT_VALUE_WEB_SOCKETS=P.SIGNALR_TRANSPORT_VALUE_SERVER_SENT_EVENTS=P.SIGNALR_TRANSPORT_VALUE_LONG_POLLING=P.ATTR_SIGNALR_TRANSPORT=P.SIGNALR_CONNECTION_STATUS_VALUE_TIMEOUT=P.SIGNALR_CONNECTION_STATUS_VALUE_NORMAL_CLOSURE=P.SIGNALR_CONNECTION_STATUS_VALUE_APP_SHUTDOWN=P.ATTR_SIGNALR_CONNECTION_STATUS=P.ATTR_SERVICE_VERSION=P.ATTR_SERVICE_NAME=P.ATTR_SERVER_PORT=P.ATTR_SERVER_ADDRESS=P.ATTR_OTEL_STATUS_DESCRIPTION=P.OTEL_STATUS_CODE_VALUE_OK=void 0,P.ATTR_ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT="aspnetcore.diagnostics.exception.result",P.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_ABORTED="aborted",P.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_HANDLED="handled",P.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_SKIPPED="skipped",P.ASPNETCORE_DIAGNOSTICS_EXCEPTION_RESULT_VALUE_UNHANDLED="unhandled",P.ATTR_ASPNETCORE_DIAGNOSTICS_HANDLER_TYPE="aspnetcore.diagnostics.handler.type",P.ATTR_ASPNETCORE_RATE_LIMITING_POLICY="aspnetcore.rate_limiting.policy",P.ATTR_ASPNETCORE_RATE_LIMITING_RESULT="aspnetcore.rate_limiting.result",P.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_ACQUIRED="acquired",P.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_ENDPOINT_LIMITER="endpoint_limiter",P.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_GLOBAL_LIMITER="global_limiter",P.ASPNETCORE_RATE_LIMITING_RESULT_VALUE_REQUEST_CANCELED="request_canceled",P.ATTR_ASPNETCORE_REQUEST_IS_UNHANDLED="aspnetcore.request.is_unhandled",P.ATTR_ASPNETCORE_ROUTING_IS_FALLBACK="aspnetcore.routing.is_fallback",P.ATTR_ASPNETCORE_ROUTING_MATCH_STATUS="aspnetcore.routing.match_status",P.ASPNETCORE_ROUTING_MATCH_STATUS_VALUE_FAILURE="failure",P.ASPNETCORE_ROUTING_MATCH_STATUS_VALUE_SUCCESS="success",P.ATTR_ASPNETCORE_USER_IS_AUTHENTICATED="aspnetcore.user.is_authenticated",P.ATTR_CLIENT_ADDRESS="client.address",P.ATTR_CLIENT_PORT="client.port",P.ATTR_CODE_COLUMN_NUMBER="code.column.number",P.ATTR_CODE_FILE_PATH="code.file.path",P.ATTR_CODE_FUNCTION_NAME="code.function.name",P.ATTR_CODE_LINE_NUMBER="code.line.number",P.ATTR_CODE_STACKTRACE="code.stacktrace",P.ATTR_DB_COLLECTION_NAME="db.collection.name",P.ATTR_DB_NAMESPACE="db.namespace",P.ATTR_DB_OPERATION_BATCH_SIZE="db.operation.batch.size",P.ATTR_DB_OPERATION_NAME="db.operation.name",P.ATTR_DB_QUERY_SUMMARY="db.query.summary",P.ATTR_DB_QUERY_TEXT="db.query.text",P.ATTR_DB_RESPONSE_STATUS_CODE="db.response.status_code",P.ATTR_DB_STORED_PROCEDURE_NAME="db.stored_procedure.name",P.ATTR_DB_SYSTEM_NAME="db.system.name",P.DB_SYSTEM_NAME_VALUE_MARIADB="mariadb",P.DB_SYSTEM_NAME_VALUE_MICROSOFT_SQL_SERVER="microsoft.sql_server",P.DB_SYSTEM_NAME_VALUE_MYSQL="mysql",P.DB_SYSTEM_NAME_VALUE_POSTGRESQL="postgresql",P.ATTR_DOTNET_GC_HEAP_GENERATION="dotnet.gc.heap.generation",P.DOTNET_GC_HEAP_GENERATION_VALUE_GEN0="gen0",P.DOTNET_GC_HEAP_GENERATION_VALUE_GEN1="gen1",P.DOTNET_GC_HEAP_GENERATION_VALUE_GEN2="gen2",P.DOTNET_GC_HEAP_GENERATION_VALUE_LOH="loh",P.DOTNET_GC_HEAP_GENERATION_VALUE_POH="poh",P.ATTR_ERROR_TYPE="error.type",P.ERROR_TYPE_VALUE_OTHER="_OTHER",P.ATTR_EXCEPTION_ESCAPED="exception.escaped",P.ATTR_EXCEPTION_MESSAGE="exception.message",P.ATTR_EXCEPTION_STACKTRACE="exception.stacktrace",P.ATTR_EXCEPTION_TYPE="exception.type";const e=n=>`http.request.header.${n}`;P.ATTR_HTTP_REQUEST_HEADER=e,P.ATTR_HTTP_REQUEST_METHOD="http.request.method",P.HTTP_REQUEST_METHOD_VALUE_OTHER="_OTHER",P.HTTP_REQUEST_METHOD_VALUE_CONNECT="CONNECT",P.HTTP_REQUEST_METHOD_VALUE_DELETE="DELETE",P.HTTP_REQUEST_METHOD_VALUE_GET="GET",P.HTTP_REQUEST_METHOD_VALUE_HEAD="HEAD",P.HTTP_REQUEST_METHOD_VALUE_OPTIONS="OPTIONS",P.HTTP_REQUEST_METHOD_VALUE_PATCH="PATCH",P.HTTP_REQUEST_METHOD_VALUE_POST="POST",P.HTTP_REQUEST_METHOD_VALUE_PUT="PUT",P.HTTP_REQUEST_METHOD_VALUE_TRACE="TRACE",P.ATTR_HTTP_REQUEST_METHOD_ORIGINAL="http.request.method_original",P.ATTR_HTTP_REQUEST_RESEND_COUNT="http.request.resend_count";const t=n=>`http.response.header.${n}`;return P.ATTR_HTTP_RESPONSE_HEADER=t,P.ATTR_HTTP_RESPONSE_STATUS_CODE="http.response.status_code",P.ATTR_HTTP_ROUTE="http.route",P.ATTR_JVM_GC_ACTION="jvm.gc.action",P.ATTR_JVM_GC_NAME="jvm.gc.name",P.ATTR_JVM_MEMORY_POOL_NAME="jvm.memory.pool.name",P.ATTR_JVM_MEMORY_TYPE="jvm.memory.type",P.JVM_MEMORY_TYPE_VALUE_HEAP="heap",P.JVM_MEMORY_TYPE_VALUE_NON_HEAP="non_heap",P.ATTR_JVM_THREAD_DAEMON="jvm.thread.daemon",P.ATTR_JVM_THREAD_STATE="jvm.thread.state",P.JVM_THREAD_STATE_VALUE_BLOCKED="blocked",P.JVM_THREAD_STATE_VALUE_NEW="new",P.JVM_THREAD_STATE_VALUE_RUNNABLE="runnable",P.JVM_THREAD_STATE_VALUE_TERMINATED="terminated",P.JVM_THREAD_STATE_VALUE_TIMED_WAITING="timed_waiting",P.JVM_THREAD_STATE_VALUE_WAITING="waiting",P.ATTR_NETWORK_LOCAL_ADDRESS="network.local.address",P.ATTR_NETWORK_LOCAL_PORT="network.local.port",P.ATTR_NETWORK_PEER_ADDRESS="network.peer.address",P.ATTR_NETWORK_PEER_PORT="network.peer.port",P.ATTR_NETWORK_PROTOCOL_NAME="network.protocol.name",P.ATTR_NETWORK_PROTOCOL_VERSION="network.protocol.version",P.ATTR_NETWORK_TRANSPORT="network.transport",P.NETWORK_TRANSPORT_VALUE_PIPE="pipe",P.NETWORK_TRANSPORT_VALUE_QUIC="quic",P.NETWORK_TRANSPORT_VALUE_TCP="tcp",P.NETWORK_TRANSPORT_VALUE_UDP="udp",P.NETWORK_TRANSPORT_VALUE_UNIX="unix",P.ATTR_NETWORK_TYPE="network.type",P.NETWORK_TYPE_VALUE_IPV4="ipv4",P.NETWORK_TYPE_VALUE_IPV6="ipv6",P.ATTR_OTEL_SCOPE_NAME="otel.scope.name",P.ATTR_OTEL_SCOPE_VERSION="otel.scope.version",P.ATTR_OTEL_STATUS_CODE="otel.status_code",P.OTEL_STATUS_CODE_VALUE_ERROR="ERROR",P.OTEL_STATUS_CODE_VALUE_OK="OK",P.ATTR_OTEL_STATUS_DESCRIPTION="otel.status_description",P.ATTR_SERVER_ADDRESS="server.address",P.ATTR_SERVER_PORT="server.port",P.ATTR_SERVICE_NAME="service.name",P.ATTR_SERVICE_VERSION="service.version",P.ATTR_SIGNALR_CONNECTION_STATUS="signalr.connection.status",P.SIGNALR_CONNECTION_STATUS_VALUE_APP_SHUTDOWN="app_shutdown",P.SIGNALR_CONNECTION_STATUS_VALUE_NORMAL_CLOSURE="normal_closure",P.SIGNALR_CONNECTION_STATUS_VALUE_TIMEOUT="timeout",P.ATTR_SIGNALR_TRANSPORT="signalr.transport",P.SIGNALR_TRANSPORT_VALUE_LONG_POLLING="long_polling",P.SIGNALR_TRANSPORT_VALUE_SERVER_SENT_EVENTS="server_sent_events",P.SIGNALR_TRANSPORT_VALUE_WEB_SOCKETS="web_sockets",P.ATTR_TELEMETRY_SDK_LANGUAGE="telemetry.sdk.language",P.TELEMETRY_SDK_LANGUAGE_VALUE_CPP="cpp",P.TELEMETRY_SDK_LANGUAGE_VALUE_DOTNET="dotnet",P.TELEMETRY_SDK_LANGUAGE_VALUE_ERLANG="erlang",P.TELEMETRY_SDK_LANGUAGE_VALUE_GO="go",P.TELEMETRY_SDK_LANGUAGE_VALUE_JAVA="java",P.TELEMETRY_SDK_LANGUAGE_VALUE_NODEJS="nodejs",P.TELEMETRY_SDK_LANGUAGE_VALUE_PHP="php",P.TELEMETRY_SDK_LANGUAGE_VALUE_PYTHON="python",P.TELEMETRY_SDK_LANGUAGE_VALUE_RUBY="ruby",P.TELEMETRY_SDK_LANGUAGE_VALUE_RUST="rust",P.TELEMETRY_SDK_LANGUAGE_VALUE_SWIFT="swift",P.TELEMETRY_SDK_LANGUAGE_VALUE_WEBJS="webjs",P.ATTR_TELEMETRY_SDK_NAME="telemetry.sdk.name",P.ATTR_TELEMETRY_SDK_VERSION="telemetry.sdk.version",P.ATTR_URL_FRAGMENT="url.fragment",P.ATTR_URL_FULL="url.full",P.ATTR_URL_PATH="url.path",P.ATTR_URL_QUERY="url.query",P.ATTR_URL_SCHEME="url.scheme",P.ATTR_USER_AGENT_ORIGINAL="user_agent.original",P}var Q={},WA;function D1(){return WA||(WA=1,Object.defineProperty(Q,"__esModule",{value:!0}),Q.METRIC_SIGNALR_SERVER_ACTIVE_CONNECTIONS=Q.METRIC_KESTREL_UPGRADED_CONNECTIONS=Q.METRIC_KESTREL_TLS_HANDSHAKE_DURATION=Q.METRIC_KESTREL_REJECTED_CONNECTIONS=Q.METRIC_KESTREL_QUEUED_REQUESTS=Q.METRIC_KESTREL_QUEUED_CONNECTIONS=Q.METRIC_KESTREL_CONNECTION_DURATION=Q.METRIC_KESTREL_ACTIVE_TLS_HANDSHAKES=Q.METRIC_KESTREL_ACTIVE_CONNECTIONS=Q.METRIC_JVM_THREAD_COUNT=Q.METRIC_JVM_MEMORY_USED_AFTER_LAST_GC=Q.METRIC_JVM_MEMORY_USED=Q.METRIC_JVM_MEMORY_LIMIT=Q.METRIC_JVM_MEMORY_COMMITTED=Q.METRIC_JVM_GC_DURATION=Q.METRIC_JVM_CPU_TIME=Q.METRIC_JVM_CPU_RECENT_UTILIZATION=Q.METRIC_JVM_CPU_COUNT=Q.METRIC_JVM_CLASS_UNLOADED=Q.METRIC_JVM_CLASS_LOADED=Q.METRIC_JVM_CLASS_COUNT=Q.METRIC_HTTP_SERVER_REQUEST_DURATION=Q.METRIC_HTTP_CLIENT_REQUEST_DURATION=Q.METRIC_DOTNET_TIMER_COUNT=Q.METRIC_DOTNET_THREAD_POOL_WORK_ITEM_COUNT=Q.METRIC_DOTNET_THREAD_POOL_THREAD_COUNT=Q.METRIC_DOTNET_THREAD_POOL_QUEUE_LENGTH=Q.METRIC_DOTNET_PROCESS_MEMORY_WORKING_SET=Q.METRIC_DOTNET_PROCESS_CPU_TIME=Q.METRIC_DOTNET_PROCESS_CPU_COUNT=Q.METRIC_DOTNET_MONITOR_LOCK_CONTENTIONS=Q.METRIC_DOTNET_JIT_COMPILED_METHODS=Q.METRIC_DOTNET_JIT_COMPILED_IL_SIZE=Q.METRIC_DOTNET_JIT_COMPILATION_TIME=Q.METRIC_DOTNET_GC_PAUSE_TIME=Q.METRIC_DOTNET_GC_LAST_COLLECTION_MEMORY_COMMITTED_SIZE=Q.METRIC_DOTNET_GC_LAST_COLLECTION_HEAP_SIZE=Q.METRIC_DOTNET_GC_LAST_COLLECTION_HEAP_FRAGMENTATION_SIZE=Q.METRIC_DOTNET_GC_HEAP_TOTAL_ALLOCATED=Q.METRIC_DOTNET_GC_COLLECTIONS=Q.METRIC_DOTNET_EXCEPTIONS=Q.METRIC_DOTNET_ASSEMBLY_COUNT=Q.METRIC_DB_CLIENT_OPERATION_DURATION=Q.METRIC_ASPNETCORE_ROUTING_MATCH_ATTEMPTS=Q.METRIC_ASPNETCORE_RATE_LIMITING_REQUESTS=Q.METRIC_ASPNETCORE_RATE_LIMITING_REQUEST_LEASE_DURATION=Q.METRIC_ASPNETCORE_RATE_LIMITING_REQUEST_TIME_IN_QUEUE=Q.METRIC_ASPNETCORE_RATE_LIMITING_QUEUED_REQUESTS=Q.METRIC_ASPNETCORE_RATE_LIMITING_ACTIVE_REQUEST_LEASES=Q.METRIC_ASPNETCORE_DIAGNOSTICS_EXCEPTIONS=void 0,Q.METRIC_SIGNALR_SERVER_CONNECTION_DURATION=void 0,Q.METRIC_ASPNETCORE_DIAGNOSTICS_EXCEPTIONS="aspnetcore.diagnostics.exceptions",Q.METRIC_ASPNETCORE_RATE_LIMITING_ACTIVE_REQUEST_LEASES="aspnetcore.rate_limiting.active_request_leases",Q.METRIC_ASPNETCORE_RATE_LIMITING_QUEUED_REQUESTS="aspnetcore.rate_limiting.queued_requests",Q.METRIC_ASPNETCORE_RATE_LIMITING_REQUEST_TIME_IN_QUEUE="aspnetcore.rate_limiting.request.time_in_queue",Q.METRIC_ASPNETCORE_RATE_LIMITING_REQUEST_LEASE_DURATION="aspnetcore.rate_limiting.request_lease.duration",Q.METRIC_ASPNETCORE_RATE_LIMITING_REQUESTS="aspnetcore.rate_limiting.requests",Q.METRIC_ASPNETCORE_ROUTING_MATCH_ATTEMPTS="aspnetcore.routing.match_attempts",Q.METRIC_DB_CLIENT_OPERATION_DURATION="db.client.operation.duration",Q.METRIC_DOTNET_ASSEMBLY_COUNT="dotnet.assembly.count",Q.METRIC_DOTNET_EXCEPTIONS="dotnet.exceptions",Q.METRIC_DOTNET_GC_COLLECTIONS="dotnet.gc.collections",Q.METRIC_DOTNET_GC_HEAP_TOTAL_ALLOCATED="dotnet.gc.heap.total_allocated",Q.METRIC_DOTNET_GC_LAST_COLLECTION_HEAP_FRAGMENTATION_SIZE="dotnet.gc.last_collection.heap.fragmentation.size",Q.METRIC_DOTNET_GC_LAST_COLLECTION_HEAP_SIZE="dotnet.gc.last_collection.heap.size",Q.METRIC_DOTNET_GC_LAST_COLLECTION_MEMORY_COMMITTED_SIZE="dotnet.gc.last_collection.memory.committed_size",Q.METRIC_DOTNET_GC_PAUSE_TIME="dotnet.gc.pause.time",Q.METRIC_DOTNET_JIT_COMPILATION_TIME="dotnet.jit.compilation.time",Q.METRIC_DOTNET_JIT_COMPILED_IL_SIZE="dotnet.jit.compiled_il.size",Q.METRIC_DOTNET_JIT_COMPILED_METHODS="dotnet.jit.compiled_methods",Q.METRIC_DOTNET_MONITOR_LOCK_CONTENTIONS="dotnet.monitor.lock_contentions",Q.METRIC_DOTNET_PROCESS_CPU_COUNT="dotnet.process.cpu.count",Q.METRIC_DOTNET_PROCESS_CPU_TIME="dotnet.process.cpu.time",Q.METRIC_DOTNET_PROCESS_MEMORY_WORKING_SET="dotnet.process.memory.working_set",Q.METRIC_DOTNET_THREAD_POOL_QUEUE_LENGTH="dotnet.thread_pool.queue.length",Q.METRIC_DOTNET_THREAD_POOL_THREAD_COUNT="dotnet.thread_pool.thread.count",Q.METRIC_DOTNET_THREAD_POOL_WORK_ITEM_COUNT="dotnet.thread_pool.work_item.count",Q.METRIC_DOTNET_TIMER_COUNT="dotnet.timer.count",Q.METRIC_HTTP_CLIENT_REQUEST_DURATION="http.client.request.duration",Q.METRIC_HTTP_SERVER_REQUEST_DURATION="http.server.request.duration",Q.METRIC_JVM_CLASS_COUNT="jvm.class.count",Q.METRIC_JVM_CLASS_LOADED="jvm.class.loaded",Q.METRIC_JVM_CLASS_UNLOADED="jvm.class.unloaded",Q.METRIC_JVM_CPU_COUNT="jvm.cpu.count",Q.METRIC_JVM_CPU_RECENT_UTILIZATION="jvm.cpu.recent_utilization",Q.METRIC_JVM_CPU_TIME="jvm.cpu.time",Q.METRIC_JVM_GC_DURATION="jvm.gc.duration",Q.METRIC_JVM_MEMORY_COMMITTED="jvm.memory.committed",Q.METRIC_JVM_MEMORY_LIMIT="jvm.memory.limit",Q.METRIC_JVM_MEMORY_USED="jvm.memory.used",Q.METRIC_JVM_MEMORY_USED_AFTER_LAST_GC="jvm.memory.used_after_last_gc",Q.METRIC_JVM_THREAD_COUNT="jvm.thread.count",Q.METRIC_KESTREL_ACTIVE_CONNECTIONS="kestrel.active_connections",Q.METRIC_KESTREL_ACTIVE_TLS_HANDSHAKES="kestrel.active_tls_handshakes",Q.METRIC_KESTREL_CONNECTION_DURATION="kestrel.connection.duration",Q.METRIC_KESTREL_QUEUED_CONNECTIONS="kestrel.queued_connections",Q.METRIC_KESTREL_QUEUED_REQUESTS="kestrel.queued_requests",Q.METRIC_KESTREL_REJECTED_CONNECTIONS="kestrel.rejected_connections",Q.METRIC_KESTREL_TLS_HANDSHAKE_DURATION="kestrel.tls_handshake.duration",Q.METRIC_KESTREL_UPGRADED_CONNECTIONS="kestrel.upgraded_connections",Q.METRIC_SIGNALR_SERVER_ACTIVE_CONNECTIONS="signalr.server.active_connections",Q.METRIC_SIGNALR_SERVER_CONNECTION_DURATION="signalr.server.connection.duration"),Q}var Ua={},KA;function U1(){return KA||(KA=1,Object.defineProperty(Ua,"__esModule",{value:!0}),Ua.EVENT_EXCEPTION=void 0,Ua.EVENT_EXCEPTION="exception"),Ua}var zA;function gt(){return zA||(zA=1,(function(e){var t=ss&&ss.__createBinding||(Object.create?(function(r,s,i,o){o===void 0&&(o=i);var c=Object.getOwnPropertyDescriptor(s,i);(!c||("get"in c?!s.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return s[i]}}),Object.defineProperty(r,o,c)}):(function(r,s,i,o){o===void 0&&(o=i),r[o]=s[i]})),n=ss&&ss.__exportStar||function(r,s){for(var i in r)i!=="default"&&!Object.prototype.hasOwnProperty.call(s,i)&&t(s,r,i)};Object.defineProperty(e,"__esModule",{value:!0}),n(P1(),e),n(w1(),e),n(L1(),e),n(D1(),e),n(U1(),e)})(ss)),ss}var ne=gt();const k1="process.runtime.name",tl={[ne.ATTR_TELEMETRY_SDK_NAME]:"opentelemetry",[k1]:"node",[ne.ATTR_TELEMETRY_SDK_LANGUAGE]:ne.TELEMETRY_SDK_LANGUAGE_VALUE_NODEJS,[ne.ATTR_TELEMETRY_SDK_VERSION]:C1},IM=9,x1=6,B1=Math.pow(10,x1),_l=Math.pow(10,IM);function dr(e){const t=e/1e3,n=Math.trunc(t),r=Math.round(e%1e3*B1);return[n,r]}function sd(){let e=Hs.timeOrigin;if(typeof e!="number"){const t=Hs;e=t.timing&&t.timing.fetchStart}return e}function ZE(e){const t=dr(sd()),n=dr(typeof e=="number"?e:Hs.now());return XE(t,n)}function G1(e){if(id(e))return e;if(typeof e=="number")return e<sd()?ZE(e):dr(e);if(e instanceof Date)return dr(e.getTime());throw TypeError("Invalid input type")}function CM(e,t){let n=t[0]-e[0],r=t[1]-e[1];return r<0&&(n-=1,r+=_l),[n,r]}function V1(e){const t=IM,n=`${"0".repeat(t)}${e[1]}Z`,r=n.substring(n.length-t-1);return new Date(e[0]*1e3).toISOString().replace("000Z",r)}function $1(e){return e[0]*_l+e[1]}function H1(e){return e[0]*1e3+e[1]/1e6}function F1(e){return e[0]*1e6+e[1]/1e3}function id(e){return Array.isArray(e)&&e.length===2&&typeof e[0]=="number"&&typeof e[1]=="number"}function Wh(e){return id(e)||typeof e=="number"||e instanceof Date}function XE(e,t){const n=[e[0]+t[0],e[1]+t[1]];return n[1]>=_l&&(n[1]-=_l,n[0]+=1),n}function j1(e){typeof e!="number"&&e.unref()}var Kh;(function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAILED=1]="FAILED"})(Kh||(Kh={}));class q1{_propagators;_fields;constructor(t={}){this._propagators=t.propagators??[],this._fields=Array.from(new Set(this._propagators.map(n=>typeof n.fields=="function"?n.fields():[]).reduce((n,r)=>n.concat(r),[])))}inject(t,n,r){for(const s of this._propagators)try{s.inject(t,n,r)}catch(i){D.diag.warn(`Failed to inject with ${s.constructor.name}. Err: ${i.message}`)}}extract(t,n,r){return this._propagators.reduce((s,i)=>{try{return i.extract(s,n,r)}catch(o){D.diag.warn(`Failed to extract with ${i.constructor.name}. Err: ${o.message}`)}return s},t)}fields(){return this._fields.slice()}}const zh="[_0-9a-z-*/]",Y1=`[a-z]${zh}{0,255}`,W1=`[a-z0-9]${zh}{0,240}@[a-z]${zh}{0,13}`,K1=new RegExp(`^(?:${Y1}|${W1})$`),z1=/^[ -~]{0,255}[!-~]$/,Z1=/,|=/;function X1(e){return K1.test(e)}function Q1(e){return z1.test(e)&&!Z1.test(e)}const ZA=32,J1=512,XA=",",QA="=";class Zi{_internalState=new Map;constructor(t){t&&this._parse(t)}set(t,n){const r=this._clone();return r._internalState.has(t)&&r._internalState.delete(t),r._internalState.set(t,n),r}unset(t){const n=this._clone();return n._internalState.delete(t),n}get(t){return this._internalState.get(t)}serialize(){return this._keys().reduce((t,n)=>(t.push(n+QA+this.get(n)),t),[]).join(XA)}_parse(t){t.length>J1||(this._internalState=t.split(XA).reverse().reduce((n,r)=>{const s=r.trim(),i=s.indexOf(QA);if(i!==-1){const o=s.slice(0,i),c=s.slice(i+1,r.length);X1(o)&&Q1(c)&&n.set(o,c)}return n},new Map),this._internalState.size>ZA&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,ZA))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){const t=new Zi;return t._internalState=new Map(this._internalState),t}}const nl="traceparent",rl="tracestate",ex="00",tx="(?!ff)[\\da-f]{2}",nx="(?![0]{32})[\\da-f]{32}",rx="(?![0]{16})[\\da-f]{16}",sx="[\\da-f]{2}",ix=new RegExp(`^\\s?(${tx})-(${nx})-(${rx})-(${sx})(-.*)?\\s?$`);function vM(e){const t=ix.exec(e);return!t||t[1]==="00"&&t[5]?null:{traceId:t[2],spanId:t[3],traceFlags:parseInt(t[4],16)}}class ox{inject(t,n,r){const s=D.trace.getSpanContext(t);if(!s||Kn(t)||!D.isSpanContextValid(s))return;const i=`${ex}-${s.traceId}-${s.spanId}-0${Number(s.traceFlags||D.TraceFlags.NONE).toString(16)}`;r.set(n,nl,i),s.traceState&&r.set(n,rl,s.traceState.serialize())}extract(t,n,r){const s=r.get(n,nl);if(!s)return t;const i=Array.isArray(s)?s[0]:s;if(typeof i!="string")return t;const o=vM(i);if(!o)return t;o.isRemote=!0;const c=r.get(n,rl);if(c){const a=Array.isArray(c)?c.join(","):c;o.traceState=new Zi(typeof a=="string"?a:void 0)}return D.trace.setSpanContext(t,o)}fields(){return[nl,rl]}}const QE=D.createContextKey("OpenTelemetry SDK Context Key RPC_METADATA");var Ys;(function(e){e.HTTP="http"})(Ys||(Ys={}));function PM(e,t){return e.setValue(QE,t)}function ax(e){return e.deleteValue(QE)}function od(e){return e.getValue(QE)}const cx="[object Object]",ux="[object Null]",lx="[object Undefined]",dx=Function.prototype,MM=dx.toString,fx=MM.call(Object),_x=Object.getPrototypeOf,wM=Object.prototype,LM=wM.hasOwnProperty,Vs=Symbol?Symbol.toStringTag:void 0,DM=wM.toString;function JA(e){if(!px(e)||hx(e)!==cx)return!1;const t=_x(e);if(t===null)return!0;const n=LM.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&MM.call(n)===fx}function px(e){return e!=null&&typeof e=="object"}function hx(e){return e==null?e===void 0?lx:ux:Vs&&Vs in Object(e)?Ex(e):Tx(e)}function Ex(e){const t=LM.call(e,Vs),n=e[Vs];let r=!1;try{e[Vs]=void 0,r=!0}catch{}const s=DM.call(e);return r&&(t?e[Vs]=n:delete e[Vs]),s}function Tx(e){return DM.call(e)}const Sx=20;function UM(...e){let t=e.shift();const n=new WeakMap;for(;e.length>0;)t=kM(t,e.shift(),0,n);return t}function _f(e){return pl(e)?e.slice():e}function kM(e,t,n=0,r){let s;if(!(n>Sx)){if(n++,sl(e)||sl(t)||xM(t))s=_f(t);else if(pl(e)){if(s=e.slice(),pl(t))for(let i=0,o=t.length;i<o;i++)s.push(_f(t[i]));else if(ka(t)){const i=Object.keys(t);for(let o=0,c=i.length;o<c;o++){const a=i[o];s[a]=_f(t[a])}}}else if(ka(e))if(ka(t)){if(!mx(e,t))return t;s=Object.assign({},e);const i=Object.keys(t);for(let o=0,c=i.length;o<c;o++){const a=i[o],l=t[a];if(sl(l))typeof l>"u"?delete s[a]:s[a]=l;else{const f=s[a],d=l;if(eR(e,a,r)||eR(t,a,r))delete s[a];else{if(ka(f)&&ka(d)){const u=r.get(f)||[],_=r.get(d)||[];u.push({obj:e,key:a}),_.push({obj:t,key:a}),r.set(f,u),r.set(d,_)}s[a]=kM(s[a],l,n,r)}}}}else s=t;return s}}function eR(e,t,n){const r=n.get(e[t])||[];for(let s=0,i=r.length;s<i;s++){const o=r[s];if(o.key===t&&o.obj===e)return!0}return!1}function pl(e){return Array.isArray(e)}function xM(e){return typeof e=="function"}function ka(e){return!sl(e)&&!pl(e)&&!xM(e)&&typeof e=="object"}function sl(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e>"u"||e instanceof Date||e instanceof RegExp||e===null}function mx(e,t){return!(!JA(e)||!JA(t))}class ad extends Error{constructor(t){super(t),Object.setPrototypeOf(this,ad.prototype)}}function gx(e,t){let n;const r=new Promise(function(i,o){n=setTimeout(function(){o(new ad("Operation timed out."))},t)});return Promise.race([e,r]).then(s=>(clearTimeout(n),s),s=>{throw clearTimeout(n),s})}function BM(e,t){return typeof t=="string"?e===t:!!e.match(t)}function Ax(e,t){if(!t)return!1;for(const n of t)if(BM(e,n))return!0;return!1}class Rx{_promise;_resolve;_reject;constructor(){this._promise=new Promise((t,n)=>{this._resolve=t,this._reject=n})}get promise(){return this._promise}resolve(t){this._resolve(t)}reject(t){this._reject(t)}}class yx{_callback;_that;_isCalled=!1;_deferred=new Rx;constructor(t,n){this._callback=t,this._that=n}get isCalled(){return this._isCalled}get promise(){return this._deferred.promise}call(...t){if(!this._isCalled){this._isCalled=!0;try{Promise.resolve(this._callback.call(this._that,...t)).then(n=>this._deferred.resolve(n),n=>this._deferred.reject(n))}catch(n){this._deferred.reject(n)}}return this._deferred.promise}}const tR={ALL:D.DiagLogLevel.ALL,VERBOSE:D.DiagLogLevel.VERBOSE,DEBUG:D.DiagLogLevel.DEBUG,INFO:D.DiagLogLevel.INFO,WARN:D.DiagLogLevel.WARN,ERROR:D.DiagLogLevel.ERROR,NONE:D.DiagLogLevel.NONE};function Nx(e){if(e==null)return;const t=tR[e.toUpperCase()];return t??(D.diag.warn(`Unknown log level "${e}", expected one of ${Object.keys(tR)}, using default`),D.DiagLogLevel.INFO)}function Ox(e,t){return new Promise(n=>{D.context.with(qs(D.context.active()),()=>{e.export(t,r=>{n(r)})})})}const bx={_export:Ox},Ix=Object.freeze(Object.defineProperty({__proto__:null,AnchoredClock:m1,BindOnceFuture:yx,CompositePropagator:q1,get ExportResultCode(){return Kh},get RPCType(){return Ys},SDK_INFO:tl,TRACE_PARENT_HEADER:nl,TRACE_STATE_HEADER:rl,TimeoutError:ad,TraceState:Zi,W3CBaggagePropagator:RM,W3CTraceContextPropagator:ox,_globalThis:I1,addHrTimes:XE,callWithTimeout:gx,deleteRPCMetadata:ax,diagLogLevelFromString:Nx,getBooleanFromEnv:O1,getNumberFromEnv:xt,getRPCMetadata:od,getStringFromEnv:zE,getStringListFromEnv:b1,getTimeOrigin:sd,globalErrorHandler:KE,hrTime:ZE,hrTimeDuration:CM,hrTimeToMicroseconds:F1,hrTimeToMilliseconds:H1,hrTimeToNanoseconds:$1,hrTimeToTimeStamp:V1,internal:bx,isAttributeValue:WE,isTimeInput:Wh,isTimeInputHrTime:id,isTracingSuppressed:Kn,isUrlIgnored:Ax,loggingErrorHandler:NM,merge:UM,millisToHrTime:dr,otperformance:Hs,parseKeyPairsIntoRecord:S1,parseTraceParent:vM,sanitizeAttributes:xc,setGlobalErrorHandler:N1,setRPCMetadata:PM,suppressTracing:qs,timeInputToHrTime:G1,unrefTimer:j1,unsuppressTracing:d1,urlMatches:BM},Symbol.toStringTag,{value:"Module"})),Ln=dM(Ix);var xa={},nR;function Cx(){return nR||(nR=1,Object.defineProperty(xa,"__esModule",{value:!0}),xa.VERSION=void 0,xa.VERSION="0.208.0"),xa}class GM{emit(t){}}const vx=new GM;class Px{getLogger(t,n,r){return new GM}}const VM=new Px;class Mx{constructor(t,n,r,s){this._provider=t,this.name=n,this.version=r,this.options=s}emit(t){this._getLogger().emit(t)}_getLogger(){if(this._delegate)return this._delegate;const t=this._provider._getDelegateLogger(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):vx}}class rR{getLogger(t,n,r){var s;return(s=this._getDelegateLogger(t,n,r))!==null&&s!==void 0?s:new Mx(this,t,n,r)}_getDelegate(){var t;return(t=this._delegate)!==null&&t!==void 0?t:VM}_setDelegate(t){this._delegate=t}_getDelegateLogger(t,n,r){var s;return(s=this._delegate)===null||s===void 0?void 0:s.getLogger(t,n,r)}}const wx=typeof globalThis=="object"?globalThis:global,Au=Symbol.for("io.opentelemetry.js.api.logs"),Ba=wx;function Lx(e,t,n){return r=>r===e?t:n}const sR=1;class JE{constructor(){this._proxyLoggerProvider=new rR}static getInstance(){return this._instance||(this._instance=new JE),this._instance}setGlobalLoggerProvider(t){return Ba[Au]?this.getLoggerProvider():(Ba[Au]=Lx(sR,t,VM),this._proxyLoggerProvider._setDelegate(t),t)}getLoggerProvider(){var t,n;return(n=(t=Ba[Au])===null||t===void 0?void 0:t.call(Ba,sR))!==null&&n!==void 0?n:this._proxyLoggerProvider}getLogger(t,n,r){return this.getLoggerProvider().getLogger(t,n,r)}disable(){delete Ba[Au],this._proxyLoggerProvider=new rR}}const $M=JE.getInstance();function Dx(e,t,n,r){for(let s=0,i=e.length;s<i;s++){const o=e[s];t&&o.setTracerProvider(t),n&&o.setMeterProvider(n),r&&o.setLoggerProvider&&o.setLoggerProvider(r),o.getConfig().enabled||o.enable()}}function Ux(e){e.forEach(t=>t.disable())}function cd(e){const t=e.tracerProvider||D.trace.getTracerProvider(),n=e.meterProvider||D.metrics.getMeterProvider(),r=e.loggerProvider||$M.getLoggerProvider(),s=e.instrumentations?.flat()??[];return Dx(s,t,n,r),()=>{Ux(s)}}const HM=/^(?:v)?(?<version>(?<major>0|[1-9]\d*)\.(?<minor>0|[1-9]\d*)\.(?<patch>0|[1-9]\d*))(?:-(?<prerelease>(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+(?<build>[0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/,kx=/^(?<op><|>|=|==|<=|>=|~|\^|~>)?\s*(?:v)?(?<version>(?<major>x|X|\*|0|[1-9]\d*)(?:\.(?<minor>x|X|\*|0|[1-9]\d*))?(?:\.(?<patch>x|X|\*|0|[1-9]\d*))?)(?:-(?<prerelease>(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+(?<build>[0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/,xx={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]};function Bx(e,t,n){if(!Gx(e))return D.diag.error(`Invalid version: ${e}`),!1;if(!t)return!0;t=t.replace(/([<>=~^]+)\s+/g,"$1");const r=Fx(e);if(!r)return!1;const s=[],i=FM(r,t,s,n);return i&&!n?.includePrerelease?$x(r,s):i}function Gx(e){return typeof e=="string"&&HM.test(e)}function FM(e,t,n,r){if(t.includes("||")){const s=t.trim().split("||");for(const i of s)if(pf(e,i,n,r))return!0;return!1}else if(t.includes(" - "))t=lB(t,r);else if(t.includes(" ")){const s=t.trim().replace(/\s{2,}/g," ").split(" ");for(const i of s)if(!pf(e,i,n,r))return!1;return!0}return pf(e,t,n,r)}function pf(e,t,n,r){if(t=Hx(t,r),t.includes(" "))return FM(e,t,n,r);{const s=jx(t);return n.push(s),Vx(e,s)}}function Vx(e,t){if(t.invalid)return!1;if(!t.version||Zh(t.version))return!0;let n=oR(e.versionSegments||[],t.versionSegments||[]);if(n===0){const r=e.prereleaseSegments||[],s=t.prereleaseSegments||[];!r.length&&!s.length?n=0:!r.length&&s.length?n=1:r.length&&!s.length?n=-1:n=oR(r,s)}return xx[t.op]?.includes(n)}function $x(e,t){return e.prerelease?t.some(n=>n.prerelease&&n.version===e.version):!0}function Hx(e,t){return e=e.trim(),e=cB(e,t),e=aB(e),e=uB(e,t),e=e.trim(),e}function Mt(e){return!e||e.toLowerCase()==="x"||e==="*"}function Fx(e){const t=e.match(HM);if(!t){D.diag.error(`Invalid version: ${e}`);return}const n=t.groups.version,r=t.groups.prerelease,s=t.groups.build,i=n.split("."),o=r?.split(".");return{op:void 0,version:n,versionSegments:i,versionSegmentCount:i.length,prerelease:r,prereleaseSegments:o,prereleaseSegmentCount:o?o.length:0,build:s}}function jx(e){if(!e)return{};const t=e.match(kx);if(!t)return D.diag.error(`Invalid range: ${e}`),{invalid:!0};let n=t.groups.op;const r=t.groups.version,s=t.groups.prerelease,i=t.groups.build,o=r.split("."),c=s?.split(".");return n==="=="&&(n="="),{op:n||"=",version:r,versionSegments:o,versionSegmentCount:o.length,prerelease:s,prereleaseSegments:c,prereleaseSegmentCount:c?c.length:0,build:i}}function Zh(e){return e==="*"||e==="x"||e==="X"}function iR(e){const t=parseInt(e,10);return isNaN(t)?e:t}function qx(e,t){if(typeof e==typeof t){if(typeof e=="number")return[e,t];if(typeof e=="string")return[e,t];throw new Error("Version segments can only be strings or numbers")}else return[String(e),String(t)]}function Yx(e,t){if(Zh(e)||Zh(t))return 0;const[n,r]=qx(iR(e),iR(t));return n>r?1:n<r?-1:0}function oR(e,t){for(let n=0;n<Math.max(e.length,t.length);n++){const r=Yx(e[n]||"0",t[n]||"0");if(r!==0)return r}return 0}const jM="[a-zA-Z0-9-]",qM="0|[1-9]\\d*",Wx=`\\d*[a-zA-Z-]${jM}*`,Kx="((?:<|>)?=?)",aR=`(?:${qM}|${Wx})`,zx=`(?:-(${aR}(?:\\.${aR})*))`,cR=`${jM}+`,Zx=`(?:\\+(${cR}(?:\\.${cR})*))`,hf=`${qM}|x|X|\\*`,Yc=`[v=\\s]*(${hf})(?:\\.(${hf})(?:\\.(${hf})(?:${zx})?${Zx}?)?)?`,Xx=`^${Kx}\\s*${Yc}$`,Qx=new RegExp(Xx),Jx=`^\\s*(${Yc})\\s+-\\s+(${Yc})\\s*$`,eB=new RegExp(Jx),tB="(?:~>?)",nB=`^${tB}${Yc}$`,rB=new RegExp(nB),sB="(?:\\^)",iB=`^${sB}${Yc}$`,oB=new RegExp(iB);function aB(e){const t=rB;return e.replace(t,(n,r,s,i,o)=>{let c;return Mt(r)?c="":Mt(s)?c=`>=${r}.0.0 <${+r+1}.0.0-0`:Mt(i)?c=`>=${r}.${s}.0 <${r}.${+s+1}.0-0`:o?c=`>=${r}.${s}.${i}-${o} <${r}.${+s+1}.0-0`:c=`>=${r}.${s}.${i} <${r}.${+s+1}.0-0`,c})}function cB(e,t){const n=oB,r=t?.includePrerelease?"-0":"";return e.replace(n,(s,i,o,c,a)=>{let l;return Mt(i)?l="":Mt(o)?l=`>=${i}.0.0${r} <${+i+1}.0.0-0`:Mt(c)?i==="0"?l=`>=${i}.${o}.0${r} <${i}.${+o+1}.0-0`:l=`>=${i}.${o}.0${r} <${+i+1}.0.0-0`:a?i==="0"?o==="0"?l=`>=${i}.${o}.${c}-${a} <${i}.${o}.${+c+1}-0`:l=`>=${i}.${o}.${c}-${a} <${i}.${+o+1}.0-0`:l=`>=${i}.${o}.${c}-${a} <${+i+1}.0.0-0`:i==="0"?o==="0"?l=`>=${i}.${o}.${c}${r} <${i}.${o}.${+c+1}-0`:l=`>=${i}.${o}.${c}${r} <${i}.${+o+1}.0-0`:l=`>=${i}.${o}.${c} <${+i+1}.0.0-0`,l})}function uB(e,t){const n=Qx;return e.replace(n,(r,s,i,o,c,a)=>{const l=Mt(i),f=l||Mt(o),d=f||Mt(c),u=d;return s==="="&&u&&(s=""),a=t?.includePrerelease?"-0":"",l?s===">"||s==="<"?r="<0.0.0-0":r="*":s&&u?(f&&(o=0),c=0,s===">"?(s=">=",f?(i=+i+1,o=0,c=0):(o=+o+1,c=0)):s==="<="&&(s="<",f?i=+i+1:o=+o+1),s==="<"&&(a="-0"),r=`${s+i}.${o}.${c}${a}`):f?r=`>=${i}.0.0${a} <${+i+1}.0.0-0`:d&&(r=`>=${i}.${o}.0${a} <${i}.${+o+1}.0-0`),r})}function lB(e,t){const n=eB;return e.replace(n,(r,s,i,o,c,a,l,f,d,u,_,p)=>(Mt(i)?s="":Mt(o)?s=`>=${i}.0.0${t?.includePrerelease?"-0":""}`:Mt(c)?s=`>=${i}.${o}.0${t?.includePrerelease?"-0":""}`:a?s=`>=${s}`:s=`>=${s}${t?.includePrerelease?"-0":""}`,Mt(d)?f="":Mt(u)?f=`<${+d+1}.0.0-0`:Mt(_)?f=`<${d}.${+u+1}.0-0`:p?f=`<=${d}.${u}.${_}-${p}`:t?.includePrerelease?f=`<${d}.${u}.${+_+1}-0`:f=`<=${f}`,`${s} ${f}`.trim()))}let Yt=console.error.bind(console);function Ga(e,t,n){const r=!!e[t]&&Object.prototype.propertyIsEnumerable.call(e,t);Object.defineProperty(e,t,{configurable:!0,enumerable:r,writable:!0,value:n})}const hl=(e,t,n)=>{if(!e||!e[t]){Yt("no original function "+String(t)+" to wrap");return}if(!n){Yt("no wrapper function"),Yt(new Error().stack);return}const r=e[t];if(typeof r!="function"||typeof n!="function"){Yt("original object and wrapper must be functions");return}const s=n(r,t);return Ga(s,"__original",r),Ga(s,"__unwrap",()=>{e[t]===s&&Ga(e,t,r)}),Ga(s,"__wrapped",!0),Ga(e,t,s),s},dB=(e,t,n)=>{if(e)Array.isArray(e)||(e=[e]);else{Yt("must provide one or more modules to patch"),Yt(new Error().stack);return}if(!(t&&Array.isArray(t))){Yt("must provide one or more functions to wrap on modules");return}e.forEach(r=>{t.forEach(s=>{hl(r,s,n)})})},eT=(e,t)=>{if(!e||!e[t]){Yt("no function to unwrap."),Yt(new Error().stack);return}const n=e[t];if(!n.__unwrap)Yt("no original to unwrap to -- has "+String(t)+" already been unwrapped?");else{n.__unwrap();return}},fB=(e,t)=>{if(e)Array.isArray(e)||(e=[e]);else{Yt("must provide one or more modules to patch"),Yt(new Error().stack);return}if(!(t&&Array.isArray(t))){Yt("must provide one or more functions to unwrap on modules");return}e.forEach(n=>{t.forEach(r=>{eT(n,r)})})};class _B{instrumentationName;instrumentationVersion;_config={};_tracer;_meter;_logger;_diag;constructor(t,n,r){this.instrumentationName=t,this.instrumentationVersion=n,this.setConfig(r),this._diag=D.diag.createComponentLogger({namespace:t}),this._tracer=D.trace.getTracer(t,n),this._meter=D.metrics.getMeter(t,n),this._logger=$M.getLogger(t,n),this._updateMetricInstruments()}_wrap=hl;_unwrap=eT;_massWrap=dB;_massUnwrap=fB;get meter(){return this._meter}setMeterProvider(t){this._meter=t.getMeter(this.instrumentationName,this.instrumentationVersion),this._updateMetricInstruments()}get logger(){return this._logger}setLoggerProvider(t){this._logger=t.getLogger(this.instrumentationName,this.instrumentationVersion)}getModuleDefinitions(){const t=this.init()??[];return Array.isArray(t)?t:[t]}_updateMetricInstruments(){}getConfig(){return this._config}setConfig(t){this._config={enabled:!0,...t}}setTracerProvider(t){this._tracer=t.getTracer(this.instrumentationName,this.instrumentationVersion)}get tracer(){return this._tracer}_runSpanCustomizationHook(t,n,r,s){if(t)try{t(r,s)}catch(i){this._diag.error("Error running span customization hook due to exception in handler",{triggerName:n},i)}}}var Ru={exports:{}},yu={exports:{}},Nu={exports:{}},Ef,uR;function pB(){if(uR)return Ef;uR=1;var e=1e3,t=e*60,n=t*60,r=n*24,s=r*7,i=r*365.25;Ef=function(f,d){d=d||{};var u=typeof f;if(u==="string"&&f.length>0)return o(f);if(u==="number"&&isFinite(f))return d.long?a(f):c(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))};function o(f){if(f=String(f),!(f.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(d){var u=parseFloat(d[1]),_=(d[2]||"ms").toLowerCase();switch(_){case"years":case"year":case"yrs":case"yr":case"y":return u*i;case"weeks":case"week":case"w":return u*s;case"days":case"day":case"d":return u*r;case"hours":case"hour":case"hrs":case"hr":case"h":return u*n;case"minutes":case"minute":case"mins":case"min":case"m":return u*t;case"seconds":case"second":case"secs":case"sec":case"s":return u*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return u;default:return}}}}function c(f){var d=Math.abs(f);return d>=r?Math.round(f/r)+"d":d>=n?Math.round(f/n)+"h":d>=t?Math.round(f/t)+"m":d>=e?Math.round(f/e)+"s":f+"ms"}function a(f){var d=Math.abs(f);return d>=r?l(f,d,r,"day"):d>=n?l(f,d,n,"hour"):d>=t?l(f,d,t,"minute"):d>=e?l(f,d,e,"second"):f+" ms"}function l(f,d,u,_){var p=d>=u*1.5;return Math.round(f/u)+" "+_+(p?"s":"")}return Ef}var Tf,lR;function YM(){if(lR)return Tf;lR=1;function e(t){r.debug=r,r.default=r,r.coerce=l,r.disable=c,r.enable=i,r.enabled=a,r.humanize=pB(),r.destroy=f,Object.keys(t).forEach(d=>{r[d]=t[d]}),r.names=[],r.skips=[],r.formatters={};function n(d){let u=0;for(let _=0;_<d.length;_++)u=(u<<5)-u+d.charCodeAt(_),u|=0;return r.colors[Math.abs(u)%r.colors.length]}r.selectColor=n;function r(d){let u,_=null,p,h;function E(...T){if(!E.enabled)return;const S=E,m=Number(new Date),g=m-(u||m);S.diff=g,S.prev=u,S.curr=m,u=m,T[0]=r.coerce(T[0]),typeof T[0]!="string"&&T.unshift("%O");let y=0;T[0]=T[0].replace(/%([a-zA-Z%])/g,(N,O)=>{if(N==="%%")return"%";y++;const b=r.formatters[O];if(typeof b=="function"){const C=T[y];N=b.call(S,C),T.splice(y,1),y--}return N}),r.formatArgs.call(S,T),(S.log||r.log).apply(S,T)}return E.namespace=d,E.useColors=r.useColors(),E.color=r.selectColor(d),E.extend=s,E.destroy=r.destroy,Object.defineProperty(E,"enabled",{enumerable:!0,configurable:!1,get:()=>_!==null?_:(p!==r.namespaces&&(p=r.namespaces,h=r.enabled(d)),h),set:T=>{_=T}}),typeof r.init=="function"&&r.init(E),E}function s(d,u){const _=r(this.namespace+(typeof u>"u"?":":u)+d);return _.log=this.log,_}function i(d){r.save(d),r.namespaces=d,r.names=[],r.skips=[];const u=(typeof d=="string"?d:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const _ of u)_[0]==="-"?r.skips.push(_.slice(1)):r.names.push(_)}function o(d,u){let _=0,p=0,h=-1,E=0;for(;_<d.length;)if(p<u.length&&(u[p]===d[_]||u[p]==="*"))u[p]==="*"?(h=p,E=_,p++):(_++,p++);else if(h!==-1)p=h+1,E++,_=E;else return!1;for(;p<u.length&&u[p]==="*";)p++;return p===u.length}function c(){const d=[...r.names,...r.skips.map(u=>"-"+u)].join(",");return r.enable(""),d}function a(d){for(const u of r.skips)if(o(d,u))return!1;for(const u of r.names)if(o(d,u))return!0;return!1}function l(d){return d instanceof Error?d.stack||d.message:d}function f(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}return Tf=e,Tf}var dR;function hB(){return dR||(dR=1,(function(e,t){t.formatArgs=r,t.save=s,t.load=i,t.useColors=n,t.storage=o(),t.destroy=(()=>{let a=!1;return()=>{a||(a=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let a;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(a=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(a[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(a){if(a[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+a[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;a.splice(1,0,l,"color: inherit");let f=0,d=0;a[0].replace(/%[a-zA-Z%]/g,u=>{u!=="%%"&&(f++,u==="%c"&&(d=f))}),a.splice(d,0,l)}t.log=console.debug||console.log||(()=>{});function s(a){try{a?t.storage.setItem("debug",a):t.storage.removeItem("debug")}catch{}}function i(){let a;try{a=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch{}return!a&&typeof process<"u"&&"env"in process&&(a=process.env.DEBUG),a}function o(){try{return localStorage}catch{}}e.exports=YM()(t);const{formatters:c}=e.exports;c.j=function(a){try{return JSON.stringify(a)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}})(Nu,Nu.exports)),Nu.exports}var Ou={exports:{}},Sf,fR;function EB(){return fR||(fR=1,Sf=(e,t=process.argv)=>{const n=e.startsWith("-")?"":e.length===1?"-":"--",r=t.indexOf(n+e),s=t.indexOf("--");return r!==-1&&(s===-1||r<s)}),Sf}var mf,_R;function TB(){if(_R)return mf;_R=1;const e=cu,t=sM,n=EB(),{env:r}=process;let s;n("no-color")||n("no-colors")||n("color=false")||n("color=never")?s=0:(n("color")||n("colors")||n("color=true")||n("color=always"))&&(s=1);function i(){if("FORCE_COLOR"in r)return r.FORCE_COLOR==="true"?1:r.FORCE_COLOR==="false"?0:r.FORCE_COLOR.length===0?1:Math.min(Number.parseInt(r.FORCE_COLOR,10),3)}function o(l){return l===0?!1:{level:l,hasBasic:!0,has256:l>=2,has16m:l>=3}}function c(l,{streamIsTTY:f,sniffFlags:d=!0}={}){const u=i();u!==void 0&&(s=u);const _=d?s:u;if(_===0)return 0;if(d){if(n("color=16m")||n("color=full")||n("color=truecolor"))return 3;if(n("color=256"))return 2}if(l&&!f&&_===void 0)return 0;const p=_||0;if(r.TERM==="dumb")return p;if(process.platform==="win32"){const h=e.release().split(".");return Number(h[0])>=10&&Number(h[2])>=10586?Number(h[2])>=14931?3:2:1}if("CI"in r)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE","DRONE"].some(h=>h in r)||r.CI_NAME==="codeship"?1:p;if("TEAMCITY_VERSION"in r)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(r.TEAMCITY_VERSION)?1:0;if(r.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in r){const h=Number.parseInt((r.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(r.TERM_PROGRAM){case"iTerm.app":return h>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(r.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(r.TERM)||"COLORTERM"in r?1:p}function a(l,f={}){const d=c(l,{streamIsTTY:l&&l.isTTY,...f});return o(d)}return mf={supportsColor:a,stdout:a({isTTY:t.isatty(1)}),stderr:a({isTTY:t.isatty(2)})},mf}var pR;function SB(){return pR||(pR=1,(function(e,t){const n=sM,r=Gr;t.init=f,t.log=c,t.formatArgs=i,t.save=a,t.load=l,t.useColors=s,t.destroy=r.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),t.colors=[6,2,3,4,5,1];try{const u=TB();u&&(u.stderr||u).level>=2&&(t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}t.inspectOpts=Object.keys(process.env).filter(u=>/^debug_/i.test(u)).reduce((u,_)=>{const p=_.substring(6).toLowerCase().replace(/_([a-z])/g,(E,T)=>T.toUpperCase());let h=process.env[_];return/^(yes|on|true|enabled)$/i.test(h)?h=!0:/^(no|off|false|disabled)$/i.test(h)?h=!1:h==="null"?h=null:h=Number(h),u[p]=h,u},{});function s(){return"colors"in t.inspectOpts?!!t.inspectOpts.colors:n.isatty(process.stderr.fd)}function i(u){const{namespace:_,useColors:p}=this;if(p){const h=this.color,E="\x1B[3"+(h<8?h:"8;5;"+h),T=`  ${E};1m${_} \x1B[0m`;u[0]=T+u[0].split(`
`).join(`
`+T),u.push(E+"m+"+e.exports.humanize(this.diff)+"\x1B[0m")}else u[0]=o()+_+" "+u[0]}function o(){return t.inspectOpts.hideDate?"":new Date().toISOString()+" "}function c(...u){return process.stderr.write(r.formatWithOptions(t.inspectOpts,...u)+`
`)}function a(u){u?process.env.DEBUG=u:delete process.env.DEBUG}function l(){return process.env.DEBUG}function f(u){u.inspectOpts={};const _=Object.keys(t.inspectOpts);for(let p=0;p<_.length;p++)u.inspectOpts[_[p]]=t.inspectOpts[_[p]]}e.exports=YM()(t);const{formatters:d}=e.exports;d.o=function(u){return this.inspectOpts.colors=this.useColors,r.inspect(u,this.inspectOpts).split(`
`).map(_=>_.trim()).join(" ")},d.O=function(u){return this.inspectOpts.colors=this.useColors,r.inspect(u,this.inspectOpts)}})(Ou,Ou.exports)),Ou.exports}var hR;function WM(){return hR||(hR=1,typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?yu.exports=hB():yu.exports=SB()),yu.exports}var gf,ER;function KM(){if(ER)return gf;ER=1;var e=Mn.sep;return gf=function(t){var n=t.split(e),r=n.lastIndexOf("node_modules");if(r!==-1&&n[r+1]){for(var s=n[r+1][0]==="@",i=s?n[r+1]+"/"+n[r+2]:n[r+1],o=s?3:2,c="",a=r+o-1,l=0;l<=a;l++)l===a?c+=n[l]:c+=n[l]+e;for(var f="",d=n.length-1,u=r+o;u<=d;u++)u===d?f+=n[u]:f+=n[u]+e;return{name:i,basedir:c,path:f}}},gf}var TR;function mB(){if(TR)return Ru.exports;TR=1;const e=Mn,t=aM,n=WM()("require-in-the-middle"),r=KM();Ru.exports=a,Ru.exports.Hook=a;let s,i;if(t.isBuiltin)i=t.isBuiltin;else if(t.builtinModules)i=f=>f.startsWith("node:")?!0:(s===void 0&&(s=new Set(t.builtinModules)),s.has(f));else throw new Error("'require-in-the-middle' requires Node.js >=v9.3.0 or >=v8.10.0");const o=/([/\\]index)?(\.js)?$/;class c{constructor(){this._localCache=new Map,this._kRitmExports=Symbol("RitmExports")}has(d,u){if(this._localCache.has(d))return!0;if(u)return!1;{const _=require.cache[d];return!!(_&&this._kRitmExports in _)}}get(d,u){const _=this._localCache.get(d);if(_!==void 0)return _;if(!u){const p=require.cache[d];return p&&p[this._kRitmExports]}}set(d,u,_){_?this._localCache.set(d,u):d in require.cache?require.cache[d][this._kRitmExports]=u:(n('non-core module is unexpectedly not in require.cache: "%s"',d),this._localCache.set(d,u))}}function a(f,d,u){if(!(this instanceof a))return new a(f,d,u);if(typeof f=="function"?(u=f,f=null,d=null):typeof d=="function"&&(u=d,d=null),typeof t._resolveFilename!="function"){console.error("Error: Expected Module._resolveFilename to be a function (was: %s) - aborting!",typeof t._resolveFilename),console.error("Please report this error as an issue related to Node.js %s at https://github.com/nodejs/require-in-the-middle/issues",process.version);return}this._cache=new c,this._unhooked=!1,this._origRequire=t.prototype.require;const _=this,p=new Set,h=d?d.internals===!0:!1,E=Array.isArray(f);n("registering require hook"),this._require=t.prototype.require=function(S){return _._unhooked===!0?(n("ignoring require call - module is soft-unhooked"),_._origRequire.apply(this,arguments)):T.call(this,arguments,!1)},typeof process.getBuiltinModule=="function"&&(this._origGetBuiltinModule=process.getBuiltinModule,this._getBuiltinModule=process.getBuiltinModule=function(S){return _._unhooked===!0?(n("ignoring process.getBuiltinModule call - module is soft-unhooked"),_._origGetBuiltinModule.apply(this,arguments)):T.call(this,arguments,!0)});function T(S,m){const g=S[0],y=i(g);let A;if(y){if(A=g,g.startsWith("node:")){const k=g.slice(5);i(k)&&(A=k)}}else{if(m)return n("call to process.getBuiltinModule with unknown built-in id"),_._origGetBuiltinModule.apply(this,S);try{A=t._resolveFilename(g,this)}catch(k){return n('Module._resolveFilename("%s") threw %j, calling original Module.require',g,k.message),_._origRequire.apply(this,S)}}let N,O;if(n("processing %s module require('%s'): %s",y===!0?"core":"non-core",g,A),_._cache.has(A,y)===!0)return n("returning already patched cached module: %s",A),_._cache.get(A,y);const b=p.has(A);b===!1&&p.add(A);const C=m?_._origGetBuiltinModule.apply(this,S):_._origRequire.apply(this,S);if(b===!0)return n("module is in the process of being patched already - ignoring: %s",A),C;if(p.delete(A),y===!0){if(E===!0&&f.includes(A)===!1)return n("ignoring core module not on whitelist: %s",A),C;N=A}else if(E===!0&&f.includes(A)){const k=e.parse(A);N=k.name,O=k.dir}else{const k=r(A);if(k===void 0)return n("could not parse filename: %s",A),C;N=k.name,O=k.basedir;const U=l(k);n("resolved filename to module: %s (id: %s, resolved: %s, basedir: %s)",N,g,U,O);let M=!1;if(E){if(!g.startsWith(".")&&f.includes(g)&&(N=g,M=!0),!f.includes(N)&&!f.includes(U))return C;f.includes(U)&&U!==N&&(N=U,M=!0)}if(!M){let F;try{F=require.resolve(N,{paths:[O]})}catch{return n("could not resolve module: %s",N),_._cache.set(A,C,y),C}if(F!==A)if(h===!0)N=N+e.sep+e.relative(O,A),n("preparing to process require of internal file: %s",N);else return n("ignoring require of non-main module file: %s",F),_._cache.set(A,C,y),C}}_._cache.set(A,C,y),n("calling require hook: %s",N);const w=u(C,N,O);return _._cache.set(A,w,y),n("returning module: %s",N),w}}a.prototype.unhook=function(){this._unhooked=!0,this._require===t.prototype.require?(t.prototype.require=this._origRequire,n("require unhook successful")):n("require unhook unsuccessful"),process.getBuiltinModule!==void 0&&(this._getBuiltinModule===process.getBuiltinModule?(process.getBuiltinModule=this._origGetBuiltinModule,n("process.getBuiltinModule unhook successful")):n("process.getBuiltinModule unhook unsuccessful"))};function l(f){const d=e.sep!=="/"?f.path.split(e.sep).join("/"):f.path;return e.posix.join(f.name,d).replace(o,"")}return Ru.exports}var zM=mB();const El="/";class SR{hooks=[];children=new Map}class gB{_trie=new SR;_counter=0;insert(t){let n=this._trie;for(const r of t.moduleName.split(El)){let s=n.children.get(r);s||(s=new SR,n.children.set(r,s)),n=s}n.hooks.push({hook:t,insertedId:this._counter++})}search(t,{maintainInsertionOrder:n,fullOnly:r}={}){let s=this._trie;const i=[];let o=!0;for(const c of t.split(El)){const a=s.children.get(c);if(!a){o=!1;break}r||i.push(...a.hooks),s=a}return r&&o&&i.push(...s.hooks),i.length===0?[]:i.length===1?[i[0].hook]:(n&&i.sort((c,a)=>c.insertedId-a.insertedId),i.map(({hook:c})=>c))}}const AB=["afterEach","after","beforeEach","before","describe","it"].every(e=>typeof global[e]=="function");class Tl{_moduleNameTrie=new gB;static _instance;constructor(){this._initialize()}_initialize(){new zM.Hook(null,{internals:!0},(t,n,r)=>{const s=RB(n),i=this._moduleNameTrie.search(s,{maintainInsertionOrder:!0,fullOnly:r===void 0});for(const{onRequire:o}of i)t=o(t,n,r);return t})}register(t,n){const r={moduleName:t,onRequire:n};return this._moduleNameTrie.insert(r),r}static getInstance(){return AB?new Tl:this._instance=this._instance??new Tl}}function RB(e){return Gs.sep!==El?e.split(Gs.sep).join(El):e}var as={exports:{}},Cr={},mR;function yB(){if(mR)return Cr;mR=1;const e=[],t=new WeakMap,n=new WeakMap,r=new Map,s=[],i={set(f,d,u){return t.get(f)[d](u)},get(f,d){if(d===Symbol.toStringTag)return"Module";const u=n.get(f)[d];if(typeof u=="function")return u()},defineProperty(f,d,u){if(!("value"in u))throw new Error("Getters/setters are not supported for exports property descriptors.");return t.get(f)[d](u.value)}};function o(f,d,u,_,p){r.set(f,p),t.set(d,u),n.set(d,_);const h=new Proxy(d,i);e.forEach(E=>E(f,h)),s.push([f,h])}let c=!1;function a(){return c}function l(f){c=f}return Cr.register=o,Cr.importHooks=e,Cr.specifiers=r,Cr.toHook=s,Cr.getExperimentalPatchInternals=a,Cr.setExperimentalPatchInternals=l,Cr}var gR;function NB(){if(gR)return as.exports;gR=1;const e=Mn,t=KM(),{fileURLToPath:n}=Wi,{MessageChannel:r}=qh,{importHooks:s,specifiers:i,toHook:o,getExperimentalPatchInternals:c}=yB();function a(p){s.push(p),o.forEach(([h,E])=>p(h,E))}function l(p){const h=s.indexOf(p);h>-1&&s.splice(h,1)}function f(p,h,E,T){const S=p(h,E,T);S&&S!==h&&(h.default=S)}let d;function u(){const{port1:p,port2:h}=new r;let E=0,T;d=y=>{E++,p.postMessage(y)},p.on("message",()=>{E--,T&&E<=0&&T()}).unref();function S(){const y=setInterval(()=>{},1e3),A=new Promise(N=>{T=N}).then(()=>{clearInterval(y)});return E===0&&T(),A}const m=h;return{registerOptions:{data:{addHookMessagePort:m,include:[]},transferList:[m]},addHookMessagePort:m,waitForAllMessagesAcknowledged:S}}function _(p,h,E){if(!(this instanceof _))return new _(p,h,E);typeof p=="function"?(E=p,p=null,h=null):typeof h=="function"&&(E=h,h=null);const T=h?h.internals===!0:!1;d&&Array.isArray(p)&&d(p),this._iitmHook=(S,m)=>{const g=S,y=S.startsWith("node:");let A;if(y)S=S.replace(/^node:/,"");else{if(S.startsWith("file://"))try{S=n(S)}catch{}const N=t(S);N&&(S=N.name,A=N.basedir)}if(p){for(const N of p)if(N===S){if(A){if(T)S=S+e.sep+e.relative(A,n(g));else if(!c()&&!A.endsWith(i.get(g)))continue}f(E,m,S,A)}}else f(E,m,S,A)},a(this._iitmHook)}return _.prototype.unhook=function(){l(this._iitmHook)},as.exports=_,as.exports.Hook=_,as.exports.addHook=a,as.exports.removeHook=l,as.exports.createAddHookMessageChannel=u,as.exports}var ZM=NB();function Vr(e,t,n){let r,s;try{s=e()}catch(i){r=i}finally{if(t(r,s),r&&!n)throw r;return s}}async function OB(e,t,n){let r,s;try{s=await e()}catch(i){r=i}finally{if(await t(r,s),r&&!n)throw r;return s}}function ud(e){return typeof e=="function"&&typeof e.__original=="function"&&typeof e.__unwrap=="function"&&e.__wrapped===!0}class Ut extends _B{_modules;_hooks=[];_requireInTheMiddleSingleton=Tl.getInstance();_enabled=!1;constructor(t,n,r){super(t,n,r);let s=this.init();s&&!Array.isArray(s)&&(s=[s]),this._modules=s||[],this._config.enabled&&this.enable()}_wrap=(t,n,r)=>{if(ud(t[n])&&this._unwrap(t,n),Gr.types.isProxy(t)){const s=hl(Object.assign({},t),n,r);return Object.defineProperty(t,n,{value:s}),s}else return hl(t,n,r)};_unwrap=(t,n)=>Gr.types.isProxy(t)?Object.defineProperty(t,n,{value:t[n]}):eT(t,n);_massWrap=(t,n,r)=>{if(t)Array.isArray(t)||(t=[t]);else{D.diag.error("must provide one or more modules to patch");return}if(!(n&&Array.isArray(n))){D.diag.error("must provide one or more functions to wrap on modules");return}t.forEach(s=>{n.forEach(i=>{this._wrap(s,i,r)})})};_massUnwrap=(t,n)=>{if(t)Array.isArray(t)||(t=[t]);else{D.diag.error("must provide one or more modules to patch");return}if(!(n&&Array.isArray(n))){D.diag.error("must provide one or more functions to wrap on modules");return}t.forEach(r=>{n.forEach(s=>{this._unwrap(r,s)})})};_warnOnPreloadedModules(){this._modules.forEach(t=>{const{name:n}=t;try{const r=require.resolve(n);require.cache[r]&&this._diag.warn(`Module ${n} has been loaded before ${this.instrumentationName} so it might not work, please initialize it before requiring ${n}`)}catch{}})}_extractPackageVersion(t){try{const n=uu.readFileSync(Gs.join(t,"package.json"),{encoding:"utf8"}),r=JSON.parse(n).version;return typeof r=="string"?r:void 0}catch{D.diag.warn("Failed extracting version",t)}}_onRequire(t,n,r,s){if(!s)return typeof t.patch=="function"&&(t.moduleExports=n,this._enabled)?(this._diag.debug("Applying instrumentation patch for nodejs core module on require hook",{module:t.name}),t.patch(n)):n;const i=this._extractPackageVersion(s);if(t.moduleVersion=i,t.name===r)return AR(t.supportedVersions,i,t.includePrerelease)&&typeof t.patch=="function"&&(t.moduleExports=n,this._enabled)?(this._diag.debug("Applying instrumentation patch for module on require hook",{module:t.name,version:t.moduleVersion,baseDir:s}),t.patch(n,t.moduleVersion)):n;const o=t.files??[],c=Gs.normalize(r);return o.filter(l=>l.name===c).filter(l=>AR(l.supportedVersions,i,t.includePrerelease)).reduce((l,f)=>(f.moduleExports=l,this._enabled?(this._diag.debug("Applying instrumentation patch for nodejs module file on require hook",{module:t.name,version:t.moduleVersion,fileName:f.name,baseDir:s}),f.patch(l,t.moduleVersion)):l),n)}enable(){if(!this._enabled){if(this._enabled=!0,this._hooks.length>0){for(const t of this._modules){typeof t.patch=="function"&&t.moduleExports&&(this._diag.debug("Applying instrumentation patch for nodejs module on instrumentation enabled",{module:t.name,version:t.moduleVersion}),t.patch(t.moduleExports,t.moduleVersion));for(const n of t.files)n.moduleExports&&(this._diag.debug("Applying instrumentation patch for nodejs module file on instrumentation enabled",{module:t.name,version:t.moduleVersion,fileName:n.name}),n.patch(n.moduleExports,t.moduleVersion))}return}this._warnOnPreloadedModules();for(const t of this._modules){const n=(o,c,a)=>{if(!a&&Gs.isAbsolute(c)){const l=Gs.parse(c);c=l.name,a=l.dir}return this._onRequire(t,o,c,a)},r=(o,c,a)=>this._onRequire(t,o,c,a),s=Gs.isAbsolute(t.name)?new zM.Hook([t.name],{internals:!0},r):this._requireInTheMiddleSingleton.register(t.name,r);this._hooks.push(s);const i=new ZM.Hook([t.name],{internals:!1},n);this._hooks.push(i)}}}disable(){if(this._enabled){this._enabled=!1;for(const t of this._modules){typeof t.unpatch=="function"&&t.moduleExports&&(this._diag.debug("Removing instrumentation patch for nodejs module on instrumentation disabled",{module:t.name,version:t.moduleVersion}),t.unpatch(t.moduleExports,t.moduleVersion));for(const n of t.files)n.moduleExports&&(this._diag.debug("Removing instrumentation patch for nodejs module file on instrumentation disabled",{module:t.name,version:t.moduleVersion,fileName:n.name}),n.unpatch(n.moduleExports,t.moduleVersion))}}}isEnabled(){return this._enabled}}function AR(e,t,n){return typeof t>"u"?e.includes("*"):e.some(r=>Bx(t,r,{includePrerelease:n}))}class St{name;supportedVersions;patch;unpatch;files;constructor(t,n,r,s,i){this.name=t,this.supportedVersions=n,this.patch=r,this.unpatch=s,this.files=i||[]}}class Er{supportedVersions;patch;unpatch;name;constructor(t,n,r,s){this.supportedVersions=n,this.patch=r,this.unpatch=s,this.name=Mn.normalize(t)}}var Mi;(function(e){e[e.STABLE=1]="STABLE",e[e.OLD=2]="OLD",e[e.DUPLICATE=3]="DUPLICATE"})(Mi||(Mi={}));function bB(e,t){let n=Mi.OLD;const r=t?.split(",").map(s=>s.trim()).filter(s=>s!=="");for(const s of r??[])if(s.toLowerCase()===e+"/dup"){n=Mi.DUPLICATE;break}else s.toLowerCase()===e&&(n=Mi.STABLE);return n}const IB=Object.freeze(Object.defineProperty({__proto__:null,InstrumentationBase:Ut,InstrumentationNodeModuleDefinition:St,InstrumentationNodeModuleFile:Er,get SemconvStability(){return Mi},isWrapped:ud,registerInstrumentations:cd,safeExecuteInTheMiddle:Vr,safeExecuteInTheMiddleAsync:OB,semconvStabilityFromStr:bB},Symbol.toStringTag,{value:"Module"})),Be=dM(IB);var Af={},pe={},RR;function CB(){return RR||(RR=1,Object.defineProperty(pe,"__esModule",{value:!0}),pe.HTTP_FLAVOR_VALUE_HTTP_1_1=pe.NET_TRANSPORT_VALUE_IP_UDP=pe.NET_TRANSPORT_VALUE_IP_TCP=pe.ATTR_NET_TRANSPORT=pe.ATTR_NET_PEER_PORT=pe.ATTR_NET_PEER_NAME=pe.ATTR_NET_PEER_IP=pe.ATTR_NET_HOST_PORT=pe.ATTR_NET_HOST_NAME=pe.ATTR_NET_HOST_IP=pe.ATTR_HTTP_USER_AGENT=pe.ATTR_HTTP_URL=pe.ATTR_HTTP_TARGET=pe.ATTR_HTTP_STATUS_CODE=pe.ATTR_HTTP_SERVER_NAME=pe.ATTR_HTTP_SCHEME=pe.ATTR_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED=pe.ATTR_HTTP_RESPONSE_CONTENT_LENGTH=pe.ATTR_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED=pe.ATTR_HTTP_REQUEST_CONTENT_LENGTH=pe.ATTR_HTTP_METHOD=pe.ATTR_HTTP_HOST=pe.ATTR_HTTP_FLAVOR=pe.ATTR_HTTP_CLIENT_IP=pe.USER_AGENT_SYNTHETIC_TYPE_VALUE_TEST=pe.USER_AGENT_SYNTHETIC_TYPE_VALUE_BOT=pe.ATTR_USER_AGENT_SYNTHETIC_TYPE=void 0,pe.ATTR_USER_AGENT_SYNTHETIC_TYPE="user_agent.synthetic.type",pe.USER_AGENT_SYNTHETIC_TYPE_VALUE_BOT="bot",pe.USER_AGENT_SYNTHETIC_TYPE_VALUE_TEST="test",pe.ATTR_HTTP_CLIENT_IP="http.client_ip",pe.ATTR_HTTP_FLAVOR="http.flavor",pe.ATTR_HTTP_HOST="http.host",pe.ATTR_HTTP_METHOD="http.method",pe.ATTR_HTTP_REQUEST_CONTENT_LENGTH="http.request_content_length",pe.ATTR_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED="http.request_content_length_uncompressed",pe.ATTR_HTTP_RESPONSE_CONTENT_LENGTH="http.response_content_length",pe.ATTR_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED="http.response_content_length_uncompressed",pe.ATTR_HTTP_SCHEME="http.scheme",pe.ATTR_HTTP_SERVER_NAME="http.server_name",pe.ATTR_HTTP_STATUS_CODE="http.status_code",pe.ATTR_HTTP_TARGET="http.target",pe.ATTR_HTTP_URL="http.url",pe.ATTR_HTTP_USER_AGENT="http.user_agent",pe.ATTR_NET_HOST_IP="net.host.ip",pe.ATTR_NET_HOST_NAME="net.host.name",pe.ATTR_NET_HOST_PORT="net.host.port",pe.ATTR_NET_PEER_IP="net.peer.ip",pe.ATTR_NET_PEER_NAME="net.peer.name",pe.ATTR_NET_PEER_PORT="net.peer.port",pe.ATTR_NET_TRANSPORT="net.transport",pe.NET_TRANSPORT_VALUE_IP_TCP="ip_tcp",pe.NET_TRANSPORT_VALUE_IP_UDP="ip_udp",pe.HTTP_FLAVOR_VALUE_HTTP_1_1="1.1"),pe}var Rf={},yR;function vB(){return yR||(yR=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,(function(t){t.HTTP_ERROR_NAME="http.error_name",t.HTTP_ERROR_MESSAGE="http.error_message",t.HTTP_STATUS_TEXT="http.status_text"})(e.AttributeNames||(e.AttributeNames={}))})(Rf)),Rf}var Sn={},NR;function OR(){return NR||(NR=1,Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.DEFAULT_QUERY_STRINGS_TO_REDACT=Sn.STR_REDACTED=Sn.SYNTHETIC_BOT_NAMES=Sn.SYNTHETIC_TEST_NAMES=void 0,Sn.SYNTHETIC_TEST_NAMES=["alwayson"],Sn.SYNTHETIC_BOT_NAMES=["googlebot","bingbot"],Sn.STR_REDACTED="REDACTED",Sn.DEFAULT_QUERY_STRINGS_TO_REDACT=["sig","Signature","AWSAccessKeyId","X-Goog-Signature"]),Sn}var yf,bR;function PB(){if(bR)return yf;bR=1;var e=Gr;function t(n,r){Error.captureStackTrace(this,t),this.name=this.constructor.name,this.message=n,this.input=r}return e.inherits(t,Error),yf=t,yf}var Nf,IR;function MB(){if(IR)return Nf;IR=1;function e(s){return s===34||s===40||s===41||s===44||s===47||s>=58&&s<=64||s>=91&&s<=93||s===123||s===125}function t(s){return s===33||s>=35&&s<=39||s===42||s===43||s===45||s===46||s>=48&&s<=57||s>=65&&s<=90||s>=94&&s<=122||s===124||s===126}function n(s){return s>=32&&s<=126}function r(s){return s>=128&&s<=255}return Nf={isDelimiter:e,isTokenChar:t,isExtended:r,isPrint:n},Nf}var Of,CR;function wB(){if(CR)return Of;CR=1;var e=Gr,t=PB(),n=MB(),r=n.isDelimiter,s=n.isTokenChar,i=n.isExtended,o=n.isPrint;function c(f){return f.replace(/\\(.)/g,"$1")}function a(f,d){return e.format("Unexpected character '%s' at index %d",f.charAt(d),d)}function l(f){for(var d=!1,u=!1,_=!1,p={},h=[],E=-1,T=-1,S,m,g=0;g<f.length;g++)if(m=f.charCodeAt(g),S===void 0){if(g!==0&&E===-1&&(m===32||m===9))continue;if(s(m))E===-1&&(E=g);else if(m===61&&E!==-1)S=f.slice(E,g).toLowerCase(),E=-1;else throw new t(a(f,g),f)}else if(u&&(m===9||o(m)||i(m)))u=!1;else if(s(m)){if(T!==-1)throw new t(a(f,g),f);E===-1&&(E=g)}else if(r(m)||i(m))if(_)m===34?(_=!1,T=g):m===92?(E===-1&&(E=g),u=d=!0):E===-1&&(E=g);else if(m===34&&f.charCodeAt(g-1)===61)_=!0;else if((m===44||m===59)&&(E!==-1||T!==-1))E!==-1?(T===-1&&(T=g),p[S]=d?c(f.slice(E,T)):f.slice(E,T)):p[S]="",m===44&&(h.push(p),p={}),S=void 0,E=T=-1;else throw new t(a(f,g),f);else if(m===32||m===9){if(T!==-1)continue;if(_)E===-1&&(E=g);else if(E!==-1)T=g;else throw new t(a(f,g),f)}else throw new t(a(f,g),f);if(S===void 0||_||E===-1&&T===-1||m===32||m===9)throw new t("Unexpected end of input",f);return E!==-1?(T===-1&&(T=g),p[S]=d?c(f.slice(E,T)):f.slice(E,T)):p[S]="",h.push(p),h}return Of=l,Of}var vR;function LB(){return vR||(vR=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.headerCapture=e.getIncomingStableRequestMetricAttributesOnResponse=e.getIncomingRequestMetricAttributesOnResponse=e.getIncomingRequestAttributesOnResponse=e.getIncomingRequestMetricAttributes=e.getIncomingRequestAttributes=e.getRemoteClientAddress=e.getOutgoingStableRequestMetricAttributesOnResponse=e.getOutgoingRequestMetricAttributesOnResponse=e.getOutgoingRequestAttributesOnResponse=e.setAttributesFromHttpKind=e.getOutgoingRequestMetricAttributes=e.getOutgoingRequestAttributes=e.extractHostnameAndPort=e.isValidOptionsType=e.getRequestInfo=e.isCompressed=e.setResponseContentLengthAttribute=e.setRequestContentLengthAttribute=e.setSpanWithError=e.satisfiesPattern=e.parseResponseStatus=e.getAbsoluteUrl=void 0;const t=Ue(),n=gt(),r=CB(),s=Ln,i=Be,o=Wi,c=vB(),a=OR(),l=OR(),f=wB(),d=(G,V,X="http:",K=Array.from(l.DEFAULT_QUERY_STRINGS_TO_REDACT))=>{const se=G||{},ae=se.protocol||X,_e=(se.port||"").toString();let de=se.path||"/",fe=se.host||se.hostname||V.host||"localhost";if(fe.indexOf(":")===-1&&_e&&_e!=="80"&&_e!=="443"&&(fe+=`:${_e}`),de.includes("?")){const W=o.parse(de),re=W.pathname||"",le=W.query||"",ie=new URLSearchParams(le),Ae=K||[];for(const Fe of Ae)ie.has(Fe)&&ie.get(Fe)!==""&&ie.set(Fe,l.STR_REDACTED);const Ke=ie.toString();de=`${re}?${Ke}`}const $=se.auth?`${l.STR_REDACTED}:${l.STR_REDACTED}@`:"";return`${ae}//${$}${fe}${de}`};e.getAbsoluteUrl=d;const u=(G,V)=>{const X=G===t.SpanKind.CLIENT?400:500;return V&&V>=100&&V<X?t.SpanStatusCode.UNSET:t.SpanStatusCode.ERROR};e.parseResponseStatus=u;const _=(G,V)=>{if(typeof V=="string")return V===G;if(V instanceof RegExp)return V.test(G);if(typeof V=="function")return V(G);throw new TypeError("Pattern is in unsupported datatype")};e.satisfiesPattern=_;const p=(G,V,X)=>{const K=V.message;X&i.SemconvStability.OLD&&(G.setAttribute(c.AttributeNames.HTTP_ERROR_NAME,V.name),G.setAttribute(c.AttributeNames.HTTP_ERROR_MESSAGE,K)),X&i.SemconvStability.STABLE&&G.setAttribute(n.ATTR_ERROR_TYPE,V.name),G.setStatus({code:t.SpanStatusCode.ERROR,message:K}),G.recordException(V)};e.setSpanWithError=p;const h=(G,V)=>{const X=T(G.headers);X!==null&&((0,e.isCompressed)(G.headers)?V[r.ATTR_HTTP_REQUEST_CONTENT_LENGTH]=X:V[r.ATTR_HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED]=X)};e.setRequestContentLengthAttribute=h;const E=(G,V)=>{const X=T(G.headers);X!==null&&((0,e.isCompressed)(G.headers)?V[r.ATTR_HTTP_RESPONSE_CONTENT_LENGTH]=X:V[r.ATTR_HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED]=X)};e.setResponseContentLengthAttribute=E;function T(G){const V=G["content-length"];if(V===void 0)return null;const X=parseInt(V,10);return isNaN(X)?null:X}const S=G=>{const V=G["content-encoding"];return!!V&&V!=="identity"};e.isCompressed=S;function m(G){const{hostname:V,pathname:X,port:K,username:se,password:ae,search:_e,protocol:de,hash:fe,href:$,origin:W,host:re}=new URL(G),le={protocol:de,hostname:V&&V[0]==="["?V.slice(1,-1):V,hash:fe,search:_e,pathname:X,path:`${X||""}${_e||""}`,href:$,origin:W,host:re};return K!==""&&(le.port=Number(K)),(se||ae)&&(le.auth=`${decodeURIComponent(se)}:${decodeURIComponent(ae)}`),le}const g=(G,V,X)=>{let K,se,ae,_e=!1;if(typeof V=="string"){try{const fe=m(V);ae=fe,K=fe.pathname||"/"}catch(fe){_e=!0,G.verbose("Unable to parse URL provided to HTTP request, using fallback to determine path. Original error:",fe),ae={path:V},K=ae.path||"/"}se=`${ae.protocol||"http:"}//${ae.host}`,X!==void 0&&Object.assign(ae,X)}else if(V instanceof o.URL)ae={protocol:V.protocol,hostname:typeof V.hostname=="string"&&V.hostname.startsWith("[")?V.hostname.slice(1,-1):V.hostname,path:`${V.pathname||""}${V.search||""}`},V.port!==""&&(ae.port=Number(V.port)),(V.username||V.password)&&(ae.auth=`${V.username}:${V.password}`),K=V.pathname,se=V.origin,X!==void 0&&Object.assign(ae,X);else{ae=Object.assign({protocol:V.host?"http:":void 0},V);const fe=ae.host||(ae.port!=null?`${ae.hostname}${ae.port}`:ae.hostname);if(se=`${ae.protocol||"http:"}//${fe}`,K=V.pathname,!K&&ae.path)try{K=new URL(ae.path,se).pathname||"/"}catch{K="/"}}const de=ae.method?ae.method.toUpperCase():"GET";return{origin:se,pathname:K,method:de,optionsParsed:ae,invalidUrl:_e}};e.getRequestInfo=g;const y=G=>{if(!G)return!1;const V=typeof G;return V==="string"||V==="object"&&!Array.isArray(G)};e.isValidOptionsType=y;const A=G=>{if(G.hostname&&G.port)return{hostname:G.hostname,port:G.port};const V=G.host?.match(/^([^:/ ]+)(:\d{1,5})?/)||null,X=G.hostname||(V===null?"localhost":V[1]);let K=G.port;return K||(V&&V[2]?K=V[2].substring(1):K=G.protocol==="https:"?"443":"80"),{hostname:X,port:K}};e.extractHostnameAndPort=A;const N=(G,V,X,K)=>{const se=V.hostname,ae=V.port,_e=G.method??"GET",de=z(_e),fe=G.headers||{},$=fe["user-agent"],W=(0,e.getAbsoluteUrl)(G,fe,`${V.component}:`,V.redactedQueryParams),re={[r.ATTR_HTTP_URL]:W,[r.ATTR_HTTP_METHOD]:_e,[r.ATTR_HTTP_TARGET]:G.path||"/",[r.ATTR_NET_PEER_NAME]:se,[r.ATTR_HTTP_HOST]:fe.host??`${se}:${ae}`},le={[n.ATTR_HTTP_REQUEST_METHOD]:de,[n.ATTR_SERVER_ADDRESS]:se,[n.ATTR_SERVER_PORT]:Number(ae),[n.ATTR_URL_FULL]:W,[n.ATTR_USER_AGENT_ORIGINAL]:$};switch(_e!==de&&(le[n.ATTR_HTTP_REQUEST_METHOD_ORIGINAL]=_e),K&&$&&(le[r.ATTR_USER_AGENT_SYNTHETIC_TYPE]=C($)),$!==void 0&&(re[r.ATTR_HTTP_USER_AGENT]=$),X){case i.SemconvStability.STABLE:return Object.assign(le,V.hookAttributes);case i.SemconvStability.OLD:return Object.assign(re,V.hookAttributes)}return Object.assign(re,le,V.hookAttributes)};e.getOutgoingRequestAttributes=N;const O=G=>{const V={};return V[r.ATTR_HTTP_METHOD]=G[r.ATTR_HTTP_METHOD],V[r.ATTR_NET_PEER_NAME]=G[r.ATTR_NET_PEER_NAME],V};e.getOutgoingRequestMetricAttributes=O;const b=(G,V)=>{G&&(V[r.ATTR_HTTP_FLAVOR]=G,G.toUpperCase()!=="QUIC"?V[r.ATTR_NET_TRANSPORT]=r.NET_TRANSPORT_VALUE_IP_TCP:V[r.ATTR_NET_TRANSPORT]=r.NET_TRANSPORT_VALUE_IP_UDP)};e.setAttributesFromHttpKind=b;const C=G=>{const V=String(G).toLowerCase();for(const X of a.SYNTHETIC_TEST_NAMES)if(V.includes(X))return r.USER_AGENT_SYNTHETIC_TYPE_VALUE_TEST;for(const X of a.SYNTHETIC_BOT_NAMES)if(V.includes(X))return r.USER_AGENT_SYNTHETIC_TYPE_VALUE_BOT},w=(G,V)=>{const{statusCode:X,statusMessage:K,httpVersion:se,socket:ae}=G,_e={},de={};if(X!=null&&(de[n.ATTR_HTTP_RESPONSE_STATUS_CODE]=X),ae){const{remoteAddress:fe,remotePort:$}=ae;_e[r.ATTR_NET_PEER_IP]=fe,_e[r.ATTR_NET_PEER_PORT]=$,de[n.ATTR_NETWORK_PEER_ADDRESS]=fe,de[n.ATTR_NETWORK_PEER_PORT]=$,de[n.ATTR_NETWORK_PROTOCOL_VERSION]=G.httpVersion}switch((0,e.setResponseContentLengthAttribute)(G,_e),X&&(_e[r.ATTR_HTTP_STATUS_CODE]=X,_e[c.AttributeNames.HTTP_STATUS_TEXT]=(K||"").toUpperCase()),(0,e.setAttributesFromHttpKind)(se,_e),V){case i.SemconvStability.STABLE:return de;case i.SemconvStability.OLD:return _e}return Object.assign(_e,de)};e.getOutgoingRequestAttributesOnResponse=w;const k=G=>{const V={};return V[r.ATTR_NET_PEER_PORT]=G[r.ATTR_NET_PEER_PORT],V[r.ATTR_HTTP_STATUS_CODE]=G[r.ATTR_HTTP_STATUS_CODE],V[r.ATTR_HTTP_FLAVOR]=G[r.ATTR_HTTP_FLAVOR],V};e.getOutgoingRequestMetricAttributesOnResponse=k;const U=G=>{const V={};return G[n.ATTR_NETWORK_PROTOCOL_VERSION]&&(V[n.ATTR_NETWORK_PROTOCOL_VERSION]=G[n.ATTR_NETWORK_PROTOCOL_VERSION]),G[n.ATTR_HTTP_RESPONSE_STATUS_CODE]&&(V[n.ATTR_HTTP_RESPONSE_STATUS_CODE]=G[n.ATTR_HTTP_RESPONSE_STATUS_CODE]),V};e.getOutgoingStableRequestMetricAttributesOnResponse=U;function M(G,V){const X=G.split(":");if(X.length===1)return V==="http"?{host:X[0],port:"80"}:V==="https"?{host:X[0],port:"443"}:{host:X[0]};if(X.length===2)return{host:X[0],port:X[1]};if(X[0].startsWith("[")){if(X[X.length-1].endsWith("]")){if(V==="http")return{host:G,port:"80"};if(V==="https")return{host:G,port:"443"}}else if(X[X.length-2].endsWith("]"))return{host:X.slice(0,-1).join(":"),port:X[X.length-1]}}return{host:G}}function F(G,V){const X=G.headers.forwarded;if(X){for(const ae of J(X))if(ae.host)return M(ae.host,ae.proto)}const K=G.headers["x-forwarded-host"];if(typeof K=="string")return typeof G.headers["x-forwarded-proto"]=="string"?M(K,G.headers["x-forwarded-proto"]):Array.isArray(G.headers["x-forwarded-proto"])?M(K,G.headers["x-forwarded-proto"][0]):M(K);if(Array.isArray(K)&&typeof K[0]=="string"&&K[0].length>0)return typeof G.headers["x-forwarded-proto"]=="string"?M(K[0],G.headers["x-forwarded-proto"]):Array.isArray(G.headers["x-forwarded-proto"])?M(K[0],G.headers["x-forwarded-proto"][0]):M(K[0]);const se=G.headers.host;return typeof se=="string"&&se.length>0?M(se,V):null}function v(G){const V=G.headers.forwarded;if(V){for(const se of J(V))if(se.for)return L(se.for)}const X=G.headers["x-forwarded-for"];if(X){let se;if(typeof X=="string"?se=X:Array.isArray(X)&&(se=X[0]),typeof se=="string")return se=se.split(",")[0].trim(),L(se)}const K=G.socket.remoteAddress;return K||null}e.getRemoteClientAddress=v;function L(G){try{const{hostname:V}=new URL(`http://${G}`);return V.startsWith("[")&&V.endsWith("]")?V.slice(1,-1):V}catch{return G}}function H(G,V,X){try{if(V.headers.host)return new URL(V.url??"/",`${G}://${V.headers.host}`);{const K=new URL(V.url??"/",`${G}://localhost`);return{pathname:K.pathname,search:K.search,toString:function(){return K.pathname+K.search}}}}catch(K){return X.verbose("Unable to get URL from request",K),{}}}const te=(G,V,X)=>{const K=G.headers,se=K["user-agent"],ae=K["x-forwarded-for"],_e=G.httpVersion,de=K.host,fe=de?.replace(/^(.*)(:[0-9]{1,5})/,"$1")||"localhost",$=G.method,W=z($),re=F(G,V.component),le=V.serverName,ie=v(G),Ae={[n.ATTR_HTTP_REQUEST_METHOD]:W,[n.ATTR_URL_SCHEME]:V.component,[n.ATTR_SERVER_ADDRESS]:re?.host,[n.ATTR_NETWORK_PEER_ADDRESS]:G.socket.remoteAddress,[n.ATTR_NETWORK_PEER_PORT]:G.socket.remotePort,[n.ATTR_NETWORK_PROTOCOL_VERSION]:G.httpVersion,[n.ATTR_USER_AGENT_ORIGINAL]:se},Ke=H(V.component,G,X);Ke?.pathname!=null&&(Ae[n.ATTR_URL_PATH]=Ke.pathname),Ke.search&&(Ae[n.ATTR_URL_QUERY]=Ke.search.slice(1)),ie!=null&&(Ae[n.ATTR_CLIENT_ADDRESS]=ie),re?.port!=null&&(Ae[n.ATTR_SERVER_PORT]=Number(re.port)),$!==W&&(Ae[n.ATTR_HTTP_REQUEST_METHOD_ORIGINAL]=$),V.enableSyntheticSourceDetection&&se&&(Ae[r.ATTR_USER_AGENT_SYNTHETIC_TYPE]=C(se));const Fe={[r.ATTR_HTTP_URL]:Ke.toString(),[r.ATTR_HTTP_HOST]:de,[r.ATTR_NET_HOST_NAME]:fe,[r.ATTR_HTTP_METHOD]:$,[r.ATTR_HTTP_SCHEME]:V.component};switch(typeof ae=="string"&&(Fe[r.ATTR_HTTP_CLIENT_IP]=ae.split(",")[0]),typeof le=="string"&&(Fe[r.ATTR_HTTP_SERVER_NAME]=le),Ke?.pathname&&(Fe[r.ATTR_HTTP_TARGET]=Ke?.pathname+Ke?.search||"/"),se!==void 0&&(Fe[r.ATTR_HTTP_USER_AGENT]=se),(0,e.setRequestContentLengthAttribute)(G,Fe),(0,e.setAttributesFromHttpKind)(_e,Fe),V.semconvStability){case i.SemconvStability.STABLE:return Object.assign(Ae,V.hookAttributes);case i.SemconvStability.OLD:return Object.assign(Fe,V.hookAttributes)}return Object.assign(Fe,Ae,V.hookAttributes)};e.getIncomingRequestAttributes=te;const ce=G=>{const V={};return V[r.ATTR_HTTP_SCHEME]=G[r.ATTR_HTTP_SCHEME],V[r.ATTR_HTTP_METHOD]=G[r.ATTR_HTTP_METHOD],V[r.ATTR_NET_HOST_NAME]=G[r.ATTR_NET_HOST_NAME],V[r.ATTR_HTTP_FLAVOR]=G[r.ATTR_HTTP_FLAVOR],V};e.getIncomingRequestMetricAttributes=ce;const ee=(G,V,X)=>{const{socket:K}=G,{statusCode:se,statusMessage:ae}=V,_e={[n.ATTR_HTTP_RESPONSE_STATUS_CODE]:se},de=(0,s.getRPCMetadata)(t.context.active()),fe={};if(K){const{localAddress:$,localPort:W,remoteAddress:re,remotePort:le}=K;fe[r.ATTR_NET_HOST_IP]=$,fe[r.ATTR_NET_HOST_PORT]=W,fe[r.ATTR_NET_PEER_IP]=re,fe[r.ATTR_NET_PEER_PORT]=le}switch(fe[r.ATTR_HTTP_STATUS_CODE]=se,fe[c.AttributeNames.HTTP_STATUS_TEXT]=(ae||"").toUpperCase(),de?.type===s.RPCType.HTTP&&de.route!==void 0&&(fe[n.ATTR_HTTP_ROUTE]=de.route,_e[n.ATTR_HTTP_ROUTE]=de.route),X){case i.SemconvStability.STABLE:return _e;case i.SemconvStability.OLD:return fe}return Object.assign(fe,_e)};e.getIncomingRequestAttributesOnResponse=ee;const x=G=>{const V={};return V[r.ATTR_HTTP_STATUS_CODE]=G[r.ATTR_HTTP_STATUS_CODE],V[r.ATTR_NET_HOST_PORT]=G[r.ATTR_NET_HOST_PORT],G[n.ATTR_HTTP_ROUTE]!==void 0&&(V[n.ATTR_HTTP_ROUTE]=G[n.ATTR_HTTP_ROUTE]),V};e.getIncomingRequestMetricAttributesOnResponse=x;const B=G=>{const V={};return G[n.ATTR_HTTP_ROUTE]!==void 0&&(V[n.ATTR_HTTP_ROUTE]=G[n.ATTR_HTTP_ROUTE]),G[n.ATTR_HTTP_RESPONSE_STATUS_CODE]&&(V[n.ATTR_HTTP_RESPONSE_STATUS_CODE]=G[n.ATTR_HTTP_RESPONSE_STATUS_CODE]),V};e.getIncomingStableRequestMetricAttributesOnResponse=B;function j(G,V){const X=new Map;for(let K=0,se=V.length;K<se;K++){const ae=V[K].toLowerCase();X.set(ae,ae.replace(/-/g,"_"))}return(K,se)=>{for(const ae of X.keys()){const _e=se(ae);if(_e===void 0)continue;const de=X.get(ae),fe=`http.${G}.header.${de}`;typeof _e=="string"?K.setAttribute(fe,[_e]):Array.isArray(_e)?K.setAttribute(fe,_e):K.setAttribute(fe,[_e])}}}e.headerCapture=j;const q=new Set(["GET","HEAD","POST","PUT","DELETE","CONNECT","OPTIONS","TRACE","PATCH"]);function z(G){if(G==null)return"GET";const V=G.toUpperCase();return q.has(V)?V:"_OTHER"}function J(G){try{return f(G)}catch{return[]}}})(Af)),Af}var PR;function DB(){if(PR)return La;PR=1,Object.defineProperty(La,"__esModule",{value:!0}),La.HttpInstrumentation=void 0;const e=Ue(),t=Ln,n=Wi,r=Cx(),s=Be,i=Hr,o=gt(),c=LB();class a extends s.InstrumentationBase{_spanNotEnded=new WeakSet;_headerCapture;_semconvStability=s.SemconvStability.OLD;constructor(f={}){super("@opentelemetry/instrumentation-http",r.VERSION,f),this._headerCapture=this._createHeaderCapture(),this._semconvStability=(0,s.semconvStabilityFromStr)("http",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}_updateMetricInstruments(){this._oldHttpServerDurationHistogram=this.meter.createHistogram("http.server.duration",{description:"Measures the duration of inbound HTTP requests.",unit:"ms",valueType:e.ValueType.DOUBLE}),this._oldHttpClientDurationHistogram=this.meter.createHistogram("http.client.duration",{description:"Measures the duration of outbound HTTP requests.",unit:"ms",valueType:e.ValueType.DOUBLE}),this._stableHttpServerDurationHistogram=this.meter.createHistogram(o.METRIC_HTTP_SERVER_REQUEST_DURATION,{description:"Duration of HTTP server requests.",unit:"s",valueType:e.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[.005,.01,.025,.05,.075,.1,.25,.5,.75,1,2.5,5,7.5,10]}}),this._stableHttpClientDurationHistogram=this.meter.createHistogram(o.METRIC_HTTP_CLIENT_REQUEST_DURATION,{description:"Duration of HTTP client requests.",unit:"s",valueType:e.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[.005,.01,.025,.05,.075,.1,.25,.5,.75,1,2.5,5,7.5,10]}})}_recordServerDuration(f,d,u){this._semconvStability&s.SemconvStability.OLD&&this._oldHttpServerDurationHistogram.record(f,d),this._semconvStability&s.SemconvStability.STABLE&&this._stableHttpServerDurationHistogram.record(f/1e3,u)}_recordClientDuration(f,d,u){this._semconvStability&s.SemconvStability.OLD&&this._oldHttpClientDurationHistogram.record(f,d),this._semconvStability&s.SemconvStability.STABLE&&this._stableHttpClientDurationHistogram.record(f/1e3,u)}setConfig(f={}){super.setConfig(f),this._headerCapture=this._createHeaderCapture()}init(){return[this._getHttpsInstrumentation(),this._getHttpInstrumentation()]}_getHttpInstrumentation(){return new s.InstrumentationNodeModuleDefinition("http",["*"],f=>{const d=f[Symbol.toStringTag]==="Module";if(!this.getConfig().disableOutgoingRequestInstrumentation){const u=this._wrap(f,"request",this._getPatchOutgoingRequestFunction("http")),_=this._wrap(f,"get",this._getPatchOutgoingGetFunction(u));d&&(f.default.request=u,f.default.get=_)}return this.getConfig().disableIncomingRequestInstrumentation||this._wrap(f.Server.prototype,"emit",this._getPatchIncomingRequestFunction("http")),f},f=>{f!==void 0&&(this.getConfig().disableOutgoingRequestInstrumentation||(this._unwrap(f,"request"),this._unwrap(f,"get")),this.getConfig().disableIncomingRequestInstrumentation||this._unwrap(f.Server.prototype,"emit"))})}_getHttpsInstrumentation(){return new s.InstrumentationNodeModuleDefinition("https",["*"],f=>{const d=f[Symbol.toStringTag]==="Module";if(!this.getConfig().disableOutgoingRequestInstrumentation){const u=this._wrap(f,"request",this._getPatchHttpsOutgoingRequestFunction("https")),_=this._wrap(f,"get",this._getPatchHttpsOutgoingGetFunction(u));d&&(f.default.request=u,f.default.get=_)}return this.getConfig().disableIncomingRequestInstrumentation||this._wrap(f.Server.prototype,"emit",this._getPatchIncomingRequestFunction("https")),f},f=>{f!==void 0&&(this.getConfig().disableOutgoingRequestInstrumentation||(this._unwrap(f,"request"),this._unwrap(f,"get")),this.getConfig().disableIncomingRequestInstrumentation||this._unwrap(f.Server.prototype,"emit"))})}_getPatchIncomingRequestFunction(f){return d=>this._incomingRequestFunction(f,d)}_getPatchOutgoingRequestFunction(f){return d=>this._outgoingRequestFunction(f,d)}_getPatchOutgoingGetFunction(f){return d=>function(_,...p){const h=f(_,...p);return h.end(),h}}_getPatchHttpsOutgoingRequestFunction(f){return d=>{const u=this;return function(p,...h){return f==="https"&&typeof p=="object"&&p?.constructor?.name!=="URL"&&(p=Object.assign({},p),u._setDefaultOptions(p)),u._getPatchOutgoingRequestFunction(f)(d)(p,...h)}}}_setDefaultOptions(f){f.protocol=f.protocol||"https:",f.port=f.port||443}_getPatchHttpsOutgoingGetFunction(f){return d=>{const u=this;return function(p,...h){return u._getPatchOutgoingGetFunction(f)(d)(p,...h)}}}_traceClientRequest(f,d,u,_,p){this.getConfig().requestHook&&this._callRequestHook(d,f);let h=!1;return f.prependListener("response",E=>{this._diag.debug("outgoingRequest on response()"),f.listenerCount("response")<=1&&E.resume();const T=(0,c.getOutgoingRequestAttributesOnResponse)(E,this._semconvStability);d.setAttributes(T),_=Object.assign(_,(0,c.getOutgoingRequestMetricAttributesOnResponse)(T)),p=Object.assign(p,(0,c.getOutgoingStableRequestMetricAttributesOnResponse)(T)),this.getConfig().responseHook&&this._callResponseHook(d,E),this._headerCapture.client.captureRequestHeaders(d,m=>f.getHeader(m)),this._headerCapture.client.captureResponseHeaders(d,m=>E.headers[m]),e.context.bind(e.context.active(),E);const S=()=>{if(this._diag.debug("outgoingRequest on end()"),h)return;h=!0;let m;E.aborted&&!E.complete?m={code:e.SpanStatusCode.ERROR}:m={code:(0,c.parseResponseStatus)(e.SpanKind.CLIENT,E.statusCode)},d.setStatus(m),this.getConfig().applyCustomAttributesOnSpan&&(0,s.safeExecuteInTheMiddle)(()=>this.getConfig().applyCustomAttributesOnSpan(d,f,E),()=>{},!0),this._closeHttpSpan(d,e.SpanKind.CLIENT,u,_,p)};E.on("end",S),E.on(i.errorMonitor,m=>{this._diag.debug("outgoingRequest on error()",m),!h&&(h=!0,this._onOutgoingRequestError(d,_,p,u,m))})}),f.on("close",()=>{this._diag.debug("outgoingRequest on request close()"),!(f.aborted||h)&&(h=!0,this._closeHttpSpan(d,e.SpanKind.CLIENT,u,_,p))}),f.on(i.errorMonitor,E=>{this._diag.debug("outgoingRequest on request error()",E),!h&&(h=!0,this._onOutgoingRequestError(d,_,p,u,E))}),this._diag.debug("http.ClientRequest return request"),f}_incomingRequestFunction(f,d){const u=this;return function(p,...h){if(p!=="request")return d.apply(this,[p,...h]);const E=h[0],T=h[1],S=E.method||"GET";if(u._diag.debug(`${f} instrumentation incomingRequest`),(0,s.safeExecuteInTheMiddle)(()=>u.getConfig().ignoreIncomingRequestHook?.(E),k=>{k!=null&&u._diag.error("caught ignoreIncomingRequestHook error: ",k)},!0))return e.context.with((0,t.suppressTracing)(e.context.active()),()=>(e.context.bind(e.context.active(),E),e.context.bind(e.context.active(),T),d.apply(this,[p,...h])));const m=E.headers,g=(0,c.getIncomingRequestAttributes)(E,{component:f,serverName:u.getConfig().serverName,hookAttributes:u._callStartSpanHook(E,u.getConfig().startIncomingSpanHook),semconvStability:u._semconvStability,enableSyntheticSourceDetection:u.getConfig().enableSyntheticSourceDetection||!1},u._diag),y={kind:e.SpanKind.SERVER,attributes:g},A=(0,t.hrTime)(),N=(0,c.getIncomingRequestMetricAttributes)(g),O={[o.ATTR_HTTP_REQUEST_METHOD]:g[o.ATTR_HTTP_REQUEST_METHOD],[o.ATTR_URL_SCHEME]:g[o.ATTR_URL_SCHEME]};g[o.ATTR_NETWORK_PROTOCOL_VERSION]&&(O[o.ATTR_NETWORK_PROTOCOL_VERSION]=g[o.ATTR_NETWORK_PROTOCOL_VERSION]);const b=e.propagation.extract(e.ROOT_CONTEXT,m),C=u._startHttpSpan(S,y,b),w={type:t.RPCType.HTTP,span:C};return e.context.with((0,t.setRPCMetadata)(e.trace.setSpan(b,C),w),()=>{e.context.bind(e.context.active(),E),e.context.bind(e.context.active(),T),u.getConfig().requestHook&&u._callRequestHook(C,E),u.getConfig().responseHook&&u._callResponseHook(C,T),u._headerCapture.server.captureRequestHeaders(C,U=>E.headers[U]);let k=!1;return T.on("close",()=>{k||u._onServerResponseFinish(E,T,C,N,O,A)}),T.on(i.errorMonitor,U=>{k=!0,u._onServerResponseError(C,N,O,A,U)}),(0,s.safeExecuteInTheMiddle)(()=>d.apply(this,[p,...h]),U=>{if(U)throw u._onServerResponseError(C,N,O,A,U),U})})}}_outgoingRequestFunction(f,d){const u=this;return function(p,...h){if(!(0,c.isValidOptionsType)(p))return d.apply(this,[p,...h]);const E=typeof h[0]=="object"&&(typeof p=="string"||p instanceof n.URL)?h.shift():void 0,{method:T,invalidUrl:S,optionsParsed:m}=(0,c.getRequestInfo)(u._diag,p,E);if((0,s.safeExecuteInTheMiddle)(()=>u.getConfig().ignoreOutgoingRequestHook?.(m),M=>{M!=null&&u._diag.error("caught ignoreOutgoingRequestHook error: ",M)},!0))return d.apply(this,[m,...h]);const{hostname:g,port:y}=(0,c.extractHostnameAndPort)(m),A=(0,c.getOutgoingRequestAttributes)(m,{component:f,port:y,hostname:g,hookAttributes:u._callStartSpanHook(m,u.getConfig().startOutgoingSpanHook),redactedQueryParams:u.getConfig().redactedQueryParams},u._semconvStability,u.getConfig().enableSyntheticSourceDetection||!1),N=(0,t.hrTime)(),O=(0,c.getOutgoingRequestMetricAttributes)(A),b={[o.ATTR_HTTP_REQUEST_METHOD]:A[o.ATTR_HTTP_REQUEST_METHOD],[o.ATTR_SERVER_ADDRESS]:A[o.ATTR_SERVER_ADDRESS],[o.ATTR_SERVER_PORT]:A[o.ATTR_SERVER_PORT]};A[o.ATTR_HTTP_RESPONSE_STATUS_CODE]&&(b[o.ATTR_HTTP_RESPONSE_STATUS_CODE]=A[o.ATTR_HTTP_RESPONSE_STATUS_CODE]),A[o.ATTR_NETWORK_PROTOCOL_VERSION]&&(b[o.ATTR_NETWORK_PROTOCOL_VERSION]=A[o.ATTR_NETWORK_PROTOCOL_VERSION]);const C={kind:e.SpanKind.CLIENT,attributes:A},w=u._startHttpSpan(T,C),k=e.context.active(),U=e.trace.setSpan(k,w);return m.headers?m.headers=Object.assign({},m.headers):m.headers={},e.propagation.inject(U,m.headers),e.context.with(U,()=>{const M=h[h.length-1];typeof M=="function"&&(h[h.length-1]=e.context.bind(k,M));const F=(0,s.safeExecuteInTheMiddle)(()=>S?d.apply(this,[p,...h]):d.apply(this,[m,...h]),v=>{if(v)throw u._onOutgoingRequestError(w,O,b,N,v),v});return u._diag.debug(`${f} instrumentation outgoingRequest`),e.context.bind(k,F),u._traceClientRequest(F,w,N,O,b)})}}_onServerResponseFinish(f,d,u,_,p,h){const E=(0,c.getIncomingRequestAttributesOnResponse)(f,d,this._semconvStability);_=Object.assign(_,(0,c.getIncomingRequestMetricAttributesOnResponse)(E)),p=Object.assign(p,(0,c.getIncomingStableRequestMetricAttributesOnResponse)(E)),this._headerCapture.server.captureResponseHeaders(u,S=>d.getHeader(S)),u.setAttributes(E).setStatus({code:(0,c.parseResponseStatus)(e.SpanKind.SERVER,d.statusCode)});const T=E[o.ATTR_HTTP_ROUTE];T&&u.updateName(`${f.method||"GET"} ${T}`),this.getConfig().applyCustomAttributesOnSpan&&(0,s.safeExecuteInTheMiddle)(()=>this.getConfig().applyCustomAttributesOnSpan(u,f,d),()=>{},!0),this._closeHttpSpan(u,e.SpanKind.SERVER,h,_,p)}_onOutgoingRequestError(f,d,u,_,p){(0,c.setSpanWithError)(f,p,this._semconvStability),u[o.ATTR_ERROR_TYPE]=p.name,this._closeHttpSpan(f,e.SpanKind.CLIENT,_,d,u)}_onServerResponseError(f,d,u,_,p){(0,c.setSpanWithError)(f,p,this._semconvStability),u[o.ATTR_ERROR_TYPE]=p.name,this._closeHttpSpan(f,e.SpanKind.SERVER,_,d,u)}_startHttpSpan(f,d,u=e.context.active()){const _=d.kind===e.SpanKind.CLIENT?this.getConfig().requireParentforOutgoingSpans:this.getConfig().requireParentforIncomingSpans;let p;const h=e.trace.getSpan(u);return _===!0&&(!h||!e.trace.isSpanContextValid(h.spanContext()))?p=e.trace.wrapSpanContext(e.INVALID_SPAN_CONTEXT):_===!0&&h?.spanContext().isRemote?p=h:p=this.tracer.startSpan(f,d,u),this._spanNotEnded.add(p),p}_closeHttpSpan(f,d,u,_,p){if(!this._spanNotEnded.has(f))return;f.end(),this._spanNotEnded.delete(f);const h=(0,t.hrTimeToMilliseconds)((0,t.hrTimeDuration)(u,(0,t.hrTime)()));d===e.SpanKind.SERVER?this._recordServerDuration(h,_,p):d===e.SpanKind.CLIENT&&this._recordClientDuration(h,_,p)}_callResponseHook(f,d){(0,s.safeExecuteInTheMiddle)(()=>this.getConfig().responseHook(f,d),()=>{},!0)}_callRequestHook(f,d){(0,s.safeExecuteInTheMiddle)(()=>this.getConfig().requestHook(f,d),()=>{},!0)}_callStartSpanHook(f,d){if(typeof d=="function")return(0,s.safeExecuteInTheMiddle)(()=>d(f),()=>{},!0)}_createHeaderCapture(){const f=this.getConfig();return{client:{captureRequestHeaders:(0,c.headerCapture)("request",f.headersToSpanAttributes?.client?.requestHeaders??[]),captureResponseHeaders:(0,c.headerCapture)("response",f.headersToSpanAttributes?.client?.responseHeaders??[])},server:{captureRequestHeaders:(0,c.headerCapture)("request",f.headersToSpanAttributes?.server?.requestHeaders??[]),captureResponseHeaders:(0,c.headerCapture)("response",f.headersToSpanAttributes?.server?.responseHeaders??[])}}}}return La.HttpInstrumentation=a,La}var MR;function UB(){return MR||(MR=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.HttpInstrumentation=void 0;var t=DB();Object.defineProperty(e,"HttpInstrumentation",{enumerable:!0,get:function(){return t.HttpInstrumentation}})})(df)),df}var kB=UB();const Te=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,Me=globalThis,at="10.29.0";function mr(){return du(Me),Me}function du(e){const t=e.__SENTRY__=e.__SENTRY__||{};return t.version=t.version||at,t[at]=t[at]||{}}function Xi(e,t,n=Me){const r=n.__SENTRY__=n.__SENTRY__||{},s=r[at]=r[at]||{};return s[e]||(s[e]=t())}const XM=["debug","info","warn","error","log","assert","trace"],xB="Sentry Logger ",Sl={};function Cn(e){if(!("console"in Me))return e();const t=Me.console,n={},r=Object.keys(Sl);r.forEach(s=>{const i=Sl[s];n[s]=t[s],t[s]=i});try{return e()}finally{r.forEach(s=>{t[s]=n[s]})}}function BB(){nT().enabled=!0}function GB(){nT().enabled=!1}function QM(){return nT().enabled}function VB(...e){tT("log",...e)}function $B(...e){tT("warn",...e)}function HB(...e){tT("error",...e)}function tT(e,...t){Te&&QM()&&Cn(()=>{Me.console[e](`${xB}[${e}]:`,...t)})}function nT(){return Te?Xi("loggerSettings",()=>({enabled:!1})):{enabled:!1}}const Y={enable:BB,disable:GB,isEnabled:QM,log:VB,warn:$B,error:HB},JM=50,ew="?",wR=/\(error: (.*)\)/,LR=/captureMessage|captureException/;function tw(...e){const t=e.sort((n,r)=>n[0]-r[0]).map(n=>n[1]);return(n,r=0,s=0)=>{const i=[],o=n.split(`
`);for(let c=r;c<o.length;c++){let a=o[c];a.length>1024&&(a=a.slice(0,1024));const l=wR.test(a)?a.replace(wR,"$1"):a;if(!l.match(/\S*Error: /)){for(const f of t){const d=f(l);if(d){i.push(d);break}}if(i.length>=JM+s)break}}return jB(i.slice(s))}}function FB(e){return Array.isArray(e)?tw(...e):e}function jB(e){if(!e.length)return[];const t=Array.from(e);return/sentryWrapped/.test(bu(t).function||"")&&t.pop(),t.reverse(),LR.test(bu(t).function||"")&&(t.pop(),LR.test(bu(t).function||"")&&t.pop()),t.slice(0,JM).map(n=>({...n,filename:n.filename||bu(t).filename,function:n.function||ew}))}function bu(e){return e[e.length-1]||{}}const bf="<anonymous>";function nw(e){try{return!e||typeof e!="function"?bf:e.name||bf}catch{return bf}}function rw(e){return"__v_isVNode"in e&&e.__v_isVNode?"[VueVNode]":"[VueViewModel]"}const il={},DR={};function rT(e,t){il[e]=il[e]||[],il[e].push(t)}function sT(e,t){if(!DR[e]){DR[e]=!0;try{t()}catch(n){Te&&Y.error(`Error while instrumenting ${e}`,n)}}}function iT(e,t){const n=e&&il[e];if(n)for(const r of n)try{r(t)}catch(s){Te&&Y.error(`Error while triggering instrumentation handler.
Type: ${e}
Name: ${nw(r)}
Error:`,s)}}let If=null;function qB(e){const t="error";rT(t,e),sT(t,YB)}function YB(){If=Me.onerror,Me.onerror=function(e,t,n,r,s){return iT("error",{column:r,error:s,line:n,msg:e,url:t}),If?If.apply(this,arguments):!1},Me.onerror.__SENTRY_INSTRUMENTED__=!0}let Cf=null;function WB(e){const t="unhandledrejection";rT(t,e),sT(t,KB)}function KB(){Cf=Me.onunhandledrejection,Me.onunhandledrejection=function(e){return iT("unhandledrejection",e),Cf?Cf.apply(this,arguments):!0},Me.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}const sw=Object.prototype.toString;function ml(e){switch(sw.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return Ws(e,Error)}}function ld(e,t){return sw.call(e)===`[object ${t}]`}function zB(e){return ld(e,"ErrorEvent")}function gl(e){return ld(e,"String")}function oT(e){return typeof e=="object"&&e!==null&&"__sentry_template_string__"in e&&"__sentry_template_values__"in e}function iw(e){return e===null||oT(e)||typeof e!="object"&&typeof e!="function"}function Wc(e){return ld(e,"Object")}function ZB(e){return typeof Event<"u"&&Ws(e,Event)}function XB(e){return typeof Element<"u"&&Ws(e,Element)}function QB(e){return ld(e,"RegExp")}function $r(e){return!!(e?.then&&typeof e.then=="function")}function JB(e){return Wc(e)&&"nativeEvent"in e&&"preventDefault"in e&&"stopPropagation"in e}function Ws(e,t){try{return e instanceof t}catch{return!1}}function ow(e){return!!(typeof e=="object"&&e!==null&&(e.__isVue||e._isVue||e.__v_isVNode))}const eG=Me,tG=80;function nG(e,t={}){if(!e)return"<unknown>";try{let n=e;const r=5,s=[];let i=0,o=0;const c=" > ",a=c.length;let l;const f=Array.isArray(t)?t:t.keyAttrs,d=!Array.isArray(t)&&t.maxStringLength||tG;for(;n&&i++<r&&(l=rG(n,f),!(l==="html"||i>1&&o+s.length*a+l.length>=d));)s.push(l),o+=l.length,n=n.parentNode;return s.reverse().join(c)}catch{return"<unknown>"}}function rG(e,t){const n=e,r=[];if(!n?.tagName)return"";if(eG.HTMLElement&&n instanceof HTMLElement&&n.dataset){if(n.dataset.sentryComponent)return n.dataset.sentryComponent;if(n.dataset.sentryElement)return n.dataset.sentryElement}r.push(n.tagName.toLowerCase());const s=t?.length?t.filter(o=>n.getAttribute(o)).map(o=>[o,n.getAttribute(o)]):null;if(s?.length)s.forEach(o=>{r.push(`[${o[0]}="${o[1]}"]`)});else{n.id&&r.push(`#${n.id}`);const o=n.className;if(o&&gl(o)){const c=o.split(/\s+/);for(const a of c)r.push(`.${a}`)}}const i=["aria-label","type","name","title","alt"];for(const o of i){const c=n.getAttribute(o);c&&r.push(`[${o}="${c}"]`)}return r.join("")}function sG(e,t,n){if(!(t in e))return;const r=e[t];if(typeof r!="function")return;const s=n(r);typeof s=="function"&&iG(s,r);try{e[t]=s}catch{Te&&Y.log(`Failed to replace method "${t}" in object`,e)}}function vn(e,t,n){try{Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0})}catch{Te&&Y.log(`Failed to add non-enumerable property "${t}" to object`,e)}}function iG(e,t){try{const n=t.prototype||{};e.prototype=t.prototype=n,vn(e,"__sentry_original__",t)}catch{}}function oG(e){return e.__sentry_original__}function aw(e){if(ml(e))return{message:e.message,name:e.name,stack:e.stack,...kR(e)};if(ZB(e)){const t={type:e.type,target:UR(e.target),currentTarget:UR(e.currentTarget),...kR(e)};return typeof CustomEvent<"u"&&Ws(e,CustomEvent)&&(t.detail=e.detail),t}else return e}function UR(e){try{return XB(e)?nG(e):Object.prototype.toString.call(e)}catch{return"<unknown>"}}function kR(e){if(typeof e=="object"&&e!==null){const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}else return{}}function aG(e){const t=Object.keys(aw(e));return t.sort(),t[0]?t.join(", "):"[object has no keys]"}function Al(e,t=0){return typeof e!="string"||t===0||e.length<=t?e:`${e.slice(0,t)}...`}function cG(e,t){let n=e;const r=n.length;if(r<=150)return n;t>r&&(t=r);let s=Math.max(t-60,0);s<5&&(s=0);let i=Math.min(s+140,r);return i>r-5&&(i=r),i===r&&(s=Math.max(i-140,0)),n=n.slice(s,i),s>0&&(n=`'{snip} ${n}`),i<r&&(n+=" {snip}"),n}function uG(e,t){if(!Array.isArray(e))return"";const n=[];for(let r=0;r<e.length;r++){const s=e[r];try{ow(s)?n.push(rw(s)):n.push(String(s))}catch{n.push("[value cannot be serialized]")}}return n.join(t)}function wi(e,t,n=!1){return gl(e)?QB(t)?t.test(e):gl(t)?n?e===t:e.includes(t):!1:!1}function fu(e,t=[],n=!1){return t.some(r=>wi(e,r,n))}function lG(){const e=Me;return e.crypto||e.msCrypto}let vf;function dG(){return Math.random()*16}function nn(e=lG()){try{if(e?.randomUUID)return e.randomUUID().replace(/-/g,"")}catch{}return vf||(vf="10000000100040008000"+1e11),vf.replace(/[018]/g,t=>(t^(dG()&15)>>t/4).toString(16))}function cw(e){return e.exception?.values?.[0]}function Ai(e){const{message:t,event_id:n}=e;if(t)return t;const r=cw(e);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||n||"<unknown>":n||"<unknown>"}function fG(e,t,n){const r=e.exception=e.exception||{},s=r.values=r.values||[],i=s[0]=s[0]||{};i.value||(i.value=""),i.type||(i.type="Error")}function aT(e,t){const n=cw(e);if(!n)return;const r={type:"generic",handled:!0},s=n.mechanism;if(n.mechanism={...r,...s,...t},t&&"data"in t){const i={...s?.data,...t.data};n.mechanism.data=i}}const _G=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/;function Pf(e){return parseInt(e||"",10)}function pG(e){const t=e.match(_G)||[],n=Pf(t[1]),r=Pf(t[2]),s=Pf(t[3]);return{buildmetadata:t[5],major:isNaN(n)?void 0:n,minor:isNaN(r)?void 0:r,patch:isNaN(s)?void 0:s,prerelease:t[4]}}function xR(e){if(hG(e))return!0;try{vn(e,"__sentry_captured__",!0)}catch{}return!1}function hG(e){try{return e.__sentry_captured__}catch{}}const uw=1e3;function _u(){return Date.now()/uw}function EG(){const{performance:e}=Me;if(!e?.now||!e.timeOrigin)return _u;const t=e.timeOrigin;return()=>(t+e.now())/uw}let BR;function Kc(){return(BR??(BR=EG()))()}function TG(e){const t=Kc(),n={sid:nn(),init:!0,timestamp:t,started:t,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>mG(n)};return e&&Bi(n,e),n}function Bi(e,t={}){if(t.user&&(!e.ipAddress&&t.user.ip_address&&(e.ipAddress=t.user.ip_address),!e.did&&!t.did&&(e.did=t.user.id||t.user.email||t.user.username)),e.timestamp=t.timestamp||Kc(),t.abnormal_mechanism&&(e.abnormal_mechanism=t.abnormal_mechanism),t.ignoreDuration&&(e.ignoreDuration=t.ignoreDuration),t.sid&&(e.sid=t.sid.length===32?t.sid:nn()),t.init!==void 0&&(e.init=t.init),!e.did&&t.did&&(e.did=`${t.did}`),typeof t.started=="number"&&(e.started=t.started),e.ignoreDuration)e.duration=void 0;else if(typeof t.duration=="number")e.duration=t.duration;else{const n=e.timestamp-e.started;e.duration=n>=0?n:0}t.release&&(e.release=t.release),t.environment&&(e.environment=t.environment),!e.ipAddress&&t.ipAddress&&(e.ipAddress=t.ipAddress),!e.userAgent&&t.userAgent&&(e.userAgent=t.userAgent),typeof t.errors=="number"&&(e.errors=t.errors),t.status&&(e.status=t.status)}function SG(e,t){let n={};e.status==="ok"&&(n={status:"exited"}),Bi(e,n)}function mG(e){return{sid:`${e.sid}`,init:e.init,started:new Date(e.started*1e3).toISOString(),timestamp:new Date(e.timestamp*1e3).toISOString(),status:e.status,errors:e.errors,did:typeof e.did=="number"||typeof e.did=="string"?`${e.did}`:void 0,duration:e.duration,abnormal_mechanism:e.abnormal_mechanism,attrs:{release:e.release,environment:e.environment,ip_address:e.ipAddress,user_agent:e.userAgent}}}function pu(e,t,n=2){if(!t||typeof t!="object"||n<=0)return t;if(e&&Object.keys(t).length===0)return e;const r={...e};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=pu(r[s],t[s],n-1));return r}function Ks(){return nn()}function si(){return nn().substring(16)}const Xh="_sentrySpan";function zc(e,t){t?vn(e,Xh,t):delete e[Xh]}function Rl(e){return e[Xh]}const gG=100;class jn{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._attributes={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:Ks(),sampleRand:Math.random()}}clone(){const t=new jn;return t._breadcrumbs=[...this._breadcrumbs],t._tags={...this._tags},t._attributes={...this._attributes},t._extra={...this._extra},t._contexts={...this._contexts},this._contexts.flags&&(t._contexts.flags={values:[...this._contexts.flags.values]}),t._user=this._user,t._level=this._level,t._session=this._session,t._transactionName=this._transactionName,t._fingerprint=this._fingerprint,t._eventProcessors=[...this._eventProcessors],t._attachments=[...this._attachments],t._sdkProcessingMetadata={...this._sdkProcessingMetadata},t._propagationContext={...this._propagationContext},t._client=this._client,t._lastEventId=this._lastEventId,zc(t,Rl(this)),t}setClient(t){this._client=t}setLastEventId(t){this._lastEventId=t}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(t){this._scopeListeners.push(t)}addEventProcessor(t){return this._eventProcessors.push(t),this}setUser(t){return this._user=t||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&Bi(this._session,{user:t}),this._notifyScopeListeners(),this}getUser(){return this._user}setTags(t){return this._tags={...this._tags,...t},this._notifyScopeListeners(),this}setTag(t,n){return this.setTags({[t]:n})}setAttributes(t){return this._attributes={...this._attributes,...t},this._notifyScopeListeners(),this}setAttribute(t,n){return this.setAttributes({[t]:n})}removeAttribute(t){return t in this._attributes&&(delete this._attributes[t],this._notifyScopeListeners()),this}setExtras(t){return this._extra={...this._extra,...t},this._notifyScopeListeners(),this}setExtra(t,n){return this._extra={...this._extra,[t]:n},this._notifyScopeListeners(),this}setFingerprint(t){return this._fingerprint=t,this._notifyScopeListeners(),this}setLevel(t){return this._level=t,this._notifyScopeListeners(),this}setTransactionName(t){return this._transactionName=t,this._notifyScopeListeners(),this}setContext(t,n){return n===null?delete this._contexts[t]:this._contexts[t]=n,this._notifyScopeListeners(),this}setSession(t){return t?this._session=t:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(t){if(!t)return this;const n=typeof t=="function"?t(this):t,r=n instanceof jn?n.getScopeData():Wc(n)?t:void 0,{tags:s,attributes:i,extra:o,user:c,contexts:a,level:l,fingerprint:f=[],propagationContext:d}=r||{};return this._tags={...this._tags,...s},this._attributes={...this._attributes,...i},this._extra={...this._extra,...o},this._contexts={...this._contexts,...a},c&&Object.keys(c).length&&(this._user=c),l&&(this._level=l),f.length&&(this._fingerprint=f),d&&(this._propagationContext=d),this}clear(){return this._breadcrumbs=[],this._tags={},this._attributes={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._session=void 0,zc(this,void 0),this._attachments=[],this.setPropagationContext({traceId:Ks(),sampleRand:Math.random()}),this._notifyScopeListeners(),this}addBreadcrumb(t,n){const r=typeof n=="number"?n:gG;if(r<=0)return this;const s={timestamp:_u(),...t,message:t.message?Al(t.message,2048):t.message};return this._breadcrumbs.push(s),this._breadcrumbs.length>r&&(this._breadcrumbs=this._breadcrumbs.slice(-r),this._client?.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(t){return this._attachments.push(t),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,attributes:this._attributes,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:Rl(this)}}setSDKProcessingMetadata(t){return this._sdkProcessingMetadata=pu(this._sdkProcessingMetadata,t,2),this}setPropagationContext(t){return this._propagationContext=t,this}getPropagationContext(){return this._propagationContext}captureException(t,n){const r=n?.event_id||nn();if(!this._client)return Te&&Y.warn("No client configured on scope - will not capture exception!"),r;const s=new Error("Sentry syntheticException");return this._client.captureException(t,{originalException:t,syntheticException:s,...n,event_id:r},this),r}captureMessage(t,n,r){const s=r?.event_id||nn();if(!this._client)return Te&&Y.warn("No client configured on scope - will not capture message!"),s;const i=r?.syntheticException??new Error(t);return this._client.captureMessage(t,n,{originalException:t,syntheticException:i,...r,event_id:s},this),s}captureEvent(t,n){const r=n?.event_id||nn();return this._client?(this._client.captureEvent(t,{...n,event_id:r},this),r):(Te&&Y.warn("No client configured on scope - will not capture event!"),r)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(t=>{t(this)}),this._notifyingListeners=!1)}}function cT(){return Xi("defaultCurrentScope",()=>new jn)}function Qi(){return Xi("defaultIsolationScope",()=>new jn)}class AG{constructor(t,n){let r;t?r=t:r=new jn;let s;n?s=n:s=new jn,this._stack=[{scope:r}],this._isolationScope=s}withScope(t){const n=this._pushScope();let r;try{r=t(n)}catch(s){throw this._popScope(),s}return $r(r)?r.then(s=>(this._popScope(),s),s=>{throw this._popScope(),s}):(this._popScope(),r)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const t=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:t}),t}_popScope(){return this._stack.length<=1?!1:!!this._stack.pop()}}function Gi(){const e=mr(),t=du(e);return t.stack=t.stack||new AG(cT(),Qi())}function RG(e){return Gi().withScope(e)}function yG(e,t){const n=Gi();return n.withScope(()=>(n.getStackTop().scope=e,t(e)))}function GR(e){return Gi().withScope(()=>e(Gi().getIsolationScope()))}function NG(){return{withIsolationScope:GR,withScope:RG,withSetScope:yG,withSetIsolationScope:(e,t)=>GR(t),getCurrentScope:()=>Gi().getScope(),getIsolationScope:()=>Gi().getIsolationScope()}}function OG(e){const t=mr(),n=du(t);n.acs=e}function ii(e){const t=du(e);return t.acs?t.acs:NG()}function rt(){const e=mr();return ii(e).getCurrentScope()}function tt(){const e=mr();return ii(e).getIsolationScope()}function bG(){return Xi("globalScope",()=>new jn)}function zs(...e){const t=mr(),n=ii(t);if(e.length===2){const[r,s]=e;return r?n.withSetScope(r,s):n.withScope(s)}return n.withScope(e[0])}function IG(...e){const t=mr(),n=ii(t);if(e.length===2){const[r,s]=e;return r?n.withSetIsolationScope(r,s):n.withIsolationScope(s)}return n.withIsolationScope(e[0])}function ye(){return rt().getClient()}function uT(e){const t=e.getPropagationContext(),{traceId:n,parentSpanId:r,propagationSpanId:s}=t,i={trace_id:n,span_id:s||si()};return r&&(i.parent_span_id=r),i}const cn="sentry.source",Vi="sentry.sample_rate",CG="sentry.previous_trace_sample_rate",Re="sentry.op",He="sentry.origin",vG="sentry.measurement_unit",PG="sentry.measurement_value",$i="sentry.custom_span_name",lT="sentry.profile_id",dT="sentry.exclusive_time",MG="cache.hit",wG="cache.key",LG="cache.item_size",DG=0,yl=1,be=2;function Qh(e){if(e<400&&e>=100)return{code:yl};if(e>=400&&e<500)switch(e){case 401:return{code:be,message:"unauthenticated"};case 403:return{code:be,message:"permission_denied"};case 404:return{code:be,message:"not_found"};case 409:return{code:be,message:"already_exists"};case 413:return{code:be,message:"failed_precondition"};case 429:return{code:be,message:"resource_exhausted"};case 499:return{code:be,message:"cancelled"};default:return{code:be,message:"invalid_argument"}}if(e>=500&&e<600)switch(e){case 501:return{code:be,message:"unimplemented"};case 503:return{code:be,message:"unavailable"};case 504:return{code:be,message:"deadline_exceeded"};default:return{code:be,message:"internal_error"}}return{code:be,message:"internal_error"}}const lw="_sentryScope",dw="_sentryIsolationScope";function UG(e){try{const t=Me.WeakRef;if(typeof t=="function")return new t(e)}catch{}return e}function kG(e){if(e){if(typeof e=="object"&&"deref"in e&&typeof e.deref=="function")try{return e.deref()}catch{return}return e}}function fw(e,t,n){e&&(vn(e,dw,UG(n)),vn(e,lw,t))}function Hi(e){const t=e;return{scope:t[lw],isolationScope:kG(t[dw])}}const fT="sentry-",xG=/^sentry-/,BG=8192;function hu(e){const t=Nl(e);if(!t)return;const n=Object.entries(t).reduce((r,[s,i])=>{if(s.match(xG)){const o=s.slice(fT.length);r[o]=i}return r},{});if(Object.keys(n).length>0)return n}function _T(e){if(!e)return;const t=Object.entries(e).reduce((n,[r,s])=>(s&&(n[`${fT}${r}`]=s),n),{});return _w(t)}function Nl(e){if(!(!e||!gl(e)&&!Array.isArray(e)))return Array.isArray(e)?e.reduce((t,n)=>{const r=VR(n);return Object.entries(r).forEach(([s,i])=>{t[s]=i}),t},{}):VR(e)}function VR(e){return e.split(",").map(t=>{const n=t.indexOf("=");if(n===-1)return[];const r=t.slice(0,n),s=t.slice(n+1);return[r,s].map(i=>{try{return decodeURIComponent(i.trim())}catch{return}})}).reduce((t,[n,r])=>(n&&r&&(t[n]=r),t),{})}function _w(e){if(Object.keys(e).length!==0)return Object.entries(e).reduce((t,[n,r],s)=>{const i=`${encodeURIComponent(n)}=${encodeURIComponent(r)}`,o=s===0?i:`${t},${i}`;return o.length>BG?(Te&&Y.warn(`Not adding key: ${n} with val: ${r} to baggage header due to exceeding baggage size limits.`),t):o},"")}const GG=/^o(\d+)\./,VG=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function $G(e){return e==="http"||e==="https"}function oi(e,t=!1){const{host:n,path:r,pass:s,port:i,projectId:o,protocol:c,publicKey:a}=e;return`${c}://${a}${t&&s?`:${s}`:""}@${n}${i?`:${i}`:""}/${r&&`${r}/`}${o}`}function HG(e){const t=VG.exec(e);if(!t){Cn(()=>{console.error(`Invalid Sentry Dsn: ${e}`)});return}const[n,r,s="",i="",o="",c=""]=t.slice(1);let a="",l=c;const f=l.split("/");if(f.length>1&&(a=f.slice(0,-1).join("/"),l=f.pop()),l){const d=l.match(/^\d+/);d&&(l=d[0])}return pw({host:i,pass:s,path:a,projectId:l,port:o,protocol:n,publicKey:r})}function pw(e){return{protocol:e.protocol,publicKey:e.publicKey||"",pass:e.pass||"",host:e.host,port:e.port||"",path:e.path||"",projectId:e.projectId}}function FG(e){if(!Te)return!0;const{port:t,projectId:n,protocol:r}=e;return["protocol","publicKey","host","projectId"].find(o=>e[o]?!1:(Y.error(`Invalid Sentry Dsn: ${o} missing`),!0))?!1:n.match(/^\d+$/)?$G(r)?t&&isNaN(parseInt(t,10))?(Y.error(`Invalid Sentry Dsn: Invalid port ${t}`),!1):!0:(Y.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),!1):(Y.error(`Invalid Sentry Dsn: Invalid projectId ${n}`),!1)}function jG(e){return e.match(GG)?.[1]}function hw(e){const t=e.getOptions(),{host:n}=e.getDsn()||{};let r;return t.orgId?r=String(t.orgId):n&&(r=jG(n)),r}function qG(e){const t=typeof e=="string"?HG(e):pw(e);if(!(!t||!FG(t)))return t}function Zs(e){if(typeof e=="boolean")return Number(e);const t=typeof e=="string"?parseFloat(e):e;if(!(typeof t!="number"||isNaN(t)||t<0||t>1))return t}const Ew=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function YG(e){if(!e)return;const t=e.match(Ew);if(!t)return;let n;return t[3]==="1"?n=!0:t[3]==="0"&&(n=!1),{traceId:t[1],parentSampled:n,parentSpanId:t[2]}}function Tw(e,t){const n=YG(e),r=hu(t);if(!n?.traceId)return{traceId:Ks(),sampleRand:Math.random()};const s=WG(n,r);r&&(r.sample_rand=s.toString());const{traceId:i,parentSpanId:o,parentSampled:c}=n;return{traceId:i,parentSpanId:o,sampled:c,dsc:r||{},sampleRand:s}}function dd(e=Ks(),t=si(),n){let r="";return n!==void 0&&(r=n?"-1":"-0"),`${e}-${t}${r}`}function Sw(e=Ks(),t=si(),n){return`00-${e}-${t}-${n?"01":"00"}`}function WG(e,t){const n=Zs(t?.sample_rand);if(n!==void 0)return n;const r=Zs(t?.sample_rate);return r&&e?.parentSampled!==void 0?e.parentSampled?Math.random()*r:r+Math.random()*(1-r):Math.random()}function KG(e,t){const n=hw(e);return t&&n&&t!==n?(Y.log(`Won't continue trace because org IDs don't match (incoming baggage: ${t}, SDK options: ${n})`),!1):(e.getOptions().strictTraceContinuation||!1)&&(t&&!n||!t&&n)?(Y.log(`Starting a new trace because strict trace continuation is enabled but one org ID is missing (incoming baggage: ${t}, Sentry client: ${n})`),!1):!0}const mw=0,pT=1;let $R=!1;function zG(e){const{spanId:t,traceId:n}=e.spanContext(),{data:r,op:s,parent_span_id:i,status:o,origin:c,links:a}=ve(e);return{parent_span_id:i,span_id:t,trace_id:n,data:r,op:s,status:o,origin:c,links:a}}function fd(e){const{spanId:t,traceId:n,isRemote:r}=e.spanContext(),s=r?t:ve(e).parent_span_id,i=Hi(e).scope,o=r?i?.getPropagationContext().propagationSpanId||si():t;return{parent_span_id:s,span_id:o,trace_id:n}}function ZG(e){const{traceId:t,spanId:n}=e.spanContext(),r=ai(e);return dd(t,n,r)}function XG(e){const{traceId:t,spanId:n}=e.spanContext(),r=ai(e);return Sw(t,n,r)}function _d(e){if(e&&e.length>0)return e.map(({context:{spanId:t,traceId:n,traceFlags:r,...s},attributes:i})=>({span_id:t,trace_id:n,sampled:r===pT,attributes:i,...s}))}function Fn(e){return typeof e=="number"?HR(e):Array.isArray(e)?e[0]+e[1]/1e9:e instanceof Date?HR(e.getTime()):Kc()}function HR(e){return e>9999999999?e/1e3:e}function ve(e){if(JG(e))return e.getSpanJSON();const{spanId:t,traceId:n}=e.spanContext();if(QG(e)){const{attributes:r,startTime:s,name:i,endTime:o,status:c,links:a}=e,l="parentSpanId"in e?e.parentSpanId:"parentSpanContext"in e?e.parentSpanContext?.spanId:void 0;return{span_id:t,trace_id:n,data:r,description:i,parent_span_id:l,start_timestamp:Fn(s),timestamp:Fn(o)||void 0,status:pd(c),op:r[Re],origin:r[He],links:_d(a)}}return{span_id:t,trace_id:n,start_timestamp:0,data:{}}}function QG(e){const t=e;return!!t.attributes&&!!t.startTime&&!!t.name&&!!t.endTime&&!!t.status}function JG(e){return typeof e.getSpanJSON=="function"}function ai(e){const{traceFlags:t}=e.spanContext();return t===pT}function pd(e){if(!(!e||e.code===DG))return e.code===yl?"ok":e.message||"internal_error"}const Bc="_sentryChildSpans",Jh="_sentryRootSpan";function hT(e,t){const n=e[Jh]||e;vn(t,Jh,n),e[Bc]?e[Bc].add(t):vn(e,Bc,new Set([t]))}function eV(e){const t=new Set;function n(r){if(!t.has(r)&&ai(r)){t.add(r);const s=r[Bc]?Array.from(r[Bc]):[];for(const i of s)n(i)}}return n(e),Array.from(t)}function rn(e){return e[Jh]||e}function hd(){const e=mr(),t=ii(e);return t.getActiveSpan?t.getActiveSpan():Rl(rt())}function eE(){$R||(Cn(()=>{console.warn("[Sentry] Returning null from `beforeSendSpan` is disallowed. To drop certain spans, configure the respective integrations directly or use `ignoreSpans`.")}),$R=!0)}let FR=!1;function tV(){if(FR)return;function e(){const t=hd(),n=t&&rn(t);if(n){const r="internal_error";Te&&Y.log(`[Tracing] Root span: ${r} -> Global error occurred`),n.setStatus({code:be,message:r})}}e.tag="sentry_tracingErrorCallback",FR=!0,qB(e),WB(e)}function un(e){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;const t=e||ye()?.getOptions();return!!t&&(t.tracesSampleRate!=null||!!t.tracesSampler)}function jR(e){Y.log(`Ignoring span ${e.op} - ${e.description} because it matches \`ignoreSpans\`.`)}function tE(e,t){if(!t?.length||!e.description)return!1;for(const n of t){if(rV(n)){if(wi(e.description,n))return Te&&jR(e),!0;continue}if(!n.name&&!n.op)continue;const r=n.name?wi(e.description,n.name):!0,s=n.op?e.op&&wi(e.op,n.op):!0;if(r&&s)return Te&&jR(e),!0}return!1}function nV(e,t){const n=t.parent_span_id,r=t.span_id;if(n)for(const s of e)s.parent_span_id===r&&(s.parent_span_id=n)}function rV(e){return typeof e=="string"||e instanceof RegExp}const ET="production",gw="_frozenDsc";function Mf(e,t){vn(e,gw,t)}function Aw(e,t){const n=t.getOptions(),{publicKey:r}=t.getDsn()||{},s={environment:n.environment||ET,release:n.release,public_key:r,trace_id:e,org_id:hw(t)};return t.emit("createDsc",s),s}function Eu(e,t){const n=t.getPropagationContext();return n.dsc||Aw(n.traceId,e)}function zt(e){const t=ye();if(!t)return{};const n=rn(e),r=ve(n),s=r.data,i=n.spanContext().traceState,o=i?.get("sentry.sample_rate")??s[Vi]??s[CG];function c(p){return(typeof o=="number"||typeof o=="string")&&(p.sample_rate=`${o}`),p}const a=n[gw];if(a)return c(a);const l=i?.get("sentry.dsc"),f=l&&hu(l);if(f)return c(f);const d=Aw(e.spanContext().traceId,t),u=s[cn],_=r.description;return u!=="url"&&_&&(d.transaction=_),un()&&(d.sampled=String(ai(n)),d.sample_rand=i?.get("sentry.sample_rand")??Hi(n).scope?.getPropagationContext().sampleRand.toString()),c(d),t.emit("createDsc",d,n),d}class Ed{constructor(t={}){this._traceId=t.traceId||Ks(),this._spanId=t.spanId||si()}spanContext(){return{spanId:this._spanId,traceId:this._traceId,traceFlags:mw}}end(t){}setAttribute(t,n){return this}setAttributes(t){return this}setStatus(t){return this}updateName(t){return this}isRecording(){return!1}addEvent(t,n,r){return this}addLink(t){return this}addLinks(t){return this}recordException(t,n){}}function ur(e,t=100,n=1/0){try{return nE("",e,t,n)}catch(r){return{ERROR:`**non-serializable** (${r})`}}}function Rw(e,t=3,n=100*1024){const r=ur(e,t);return aV(r)>n?Rw(e,t-1,n):r}function nE(e,t,n=1/0,r=1/0,s=cV()){const[i,o]=s;if(t==null||["boolean","string"].includes(typeof t)||typeof t=="number"&&Number.isFinite(t))return t;const c=sV(e,t);if(!c.startsWith("[object "))return c;if(t.__sentry_skip_normalization__)return t;const a=typeof t.__sentry_override_normalization_depth__=="number"?t.__sentry_override_normalization_depth__:n;if(a===0)return c.replace("object ","");if(i(t))return"[Circular ~]";const l=t;if(l&&typeof l.toJSON=="function")try{const _=l.toJSON();return nE("",_,a-1,r,s)}catch{}const f=Array.isArray(t)?[]:{};let d=0;const u=aw(t);for(const _ in u){if(!Object.prototype.hasOwnProperty.call(u,_))continue;if(d>=r){f[_]="[MaxProperties ~]";break}const p=u[_];f[_]=nE(_,p,a-1,r,s),d++}return o(t),f}function sV(e,t){try{if(e==="domain"&&t&&typeof t=="object"&&t._events)return"[Domain]";if(e==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&t===global)return"[Global]";if(typeof window<"u"&&t===window)return"[Window]";if(typeof document<"u"&&t===document)return"[Document]";if(ow(t))return rw(t);if(JB(t))return"[SyntheticEvent]";if(typeof t=="number"&&!Number.isFinite(t))return`[${t}]`;if(typeof t=="function")return`[Function: ${nw(t)}]`;if(typeof t=="symbol")return`[${String(t)}]`;if(typeof t=="bigint")return`[BigInt: ${String(t)}]`;const n=iV(t);return/^HTML(\w*)Element$/.test(n)?`[HTMLElement: ${n}]`:`[object ${n}]`}catch(n){return`**non-serializable** (${n})`}}function iV(e){const t=Object.getPrototypeOf(e);return t?.constructor?t.constructor.name:"null prototype"}function oV(e){return~-encodeURI(e).split(/%..|./).length}function aV(e){return oV(JSON.stringify(e))}function cV(){const e=new WeakSet;function t(r){return e.has(r)?!0:(e.add(r),!1)}function n(r){e.delete(r)}return[t,n]}function Fr(e,t=[]){return[e,t]}function uV(e,t){const[n,r]=e;return[n,[...r,t]]}function qR(e,t){const n=e[1];for(const r of n){const s=r[0].type;if(t(r,s))return!0}return!1}function rE(e){const t=du(Me);return t.encodePolyfill?t.encodePolyfill(e):new TextEncoder().encode(e)}function yw(e){const[t,n]=e;let r=JSON.stringify(t);function s(i){typeof r=="string"?r=typeof i=="string"?r+i:[rE(r),i]:r.push(typeof i=="string"?rE(i):i)}for(const i of n){const[o,c]=i;if(s(`
${JSON.stringify(o)}
`),typeof c=="string"||c instanceof Uint8Array)s(c);else{let a;try{a=JSON.stringify(c)}catch{a=JSON.stringify(ur(c))}s(a)}}return typeof r=="string"?r:lV(r)}function lV(e){const t=e.reduce((s,i)=>s+i.length,0),n=new Uint8Array(t);let r=0;for(const s of e)n.set(s,r),r+=s.length;return n}function dV(e){return[{type:"span"},e]}function fV(e){const t=typeof e.data=="string"?rE(e.data):e.data;return[{type:"attachment",length:t.length,filename:e.filename,content_type:e.contentType,attachment_type:e.attachmentType},t]}const _V={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",raw_security:"security",log:"log_item",metric:"metric",trace_metric:"metric"};function YR(e){return _V[e]}function Nw(e){if(!e?.sdk)return;const{name:t,version:n}=e.sdk;return{name:t,version:n}}function pV(e,t,n,r){const s=e.sdkProcessingMetadata?.dynamicSamplingContext;return{event_id:e.event_id,sent_at:new Date().toISOString(),...t&&{sdk:t},...!!n&&r&&{dsn:oi(r)},...s&&{trace:s}}}function hV(e,t){if(!t)return e;const n=e.sdk||{};return e.sdk={...n,name:n.name||t.name,version:n.version||t.version,integrations:[...e.sdk?.integrations||[],...t.integrations||[]],packages:[...e.sdk?.packages||[],...t.packages||[]],settings:e.sdk?.settings||t.settings?{...e.sdk?.settings,...t.settings}:void 0},e}function EV(e,t,n,r){const s=Nw(n),i={sent_at:new Date().toISOString(),...s&&{sdk:s},...!!r&&t&&{dsn:oi(t)}},o="aggregates"in e?[{type:"sessions"},e]:[{type:"session"},e.toJSON()];return Fr(i,[o])}function TV(e,t,n,r){const s=Nw(n),i=e.type&&e.type!=="replay_event"?e.type:"event";hV(e,n?.sdk);const o=pV(e,s,r,t);return delete e.sdkProcessingMetadata,Fr(o,[[{type:i},e]])}function SV(e,t){function n(_){return!!_.trace_id&&!!_.public_key}const r=zt(e[0]),s=t?.getDsn(),i=t?.getOptions().tunnel,o={sent_at:new Date().toISOString(),...n(r)&&{trace:r},...!!i&&s&&{dsn:oi(s)}},{beforeSendSpan:c,ignoreSpans:a}=t?.getOptions()||{},l=a?.length?e.filter(_=>!tE(ve(_),a)):e,f=e.length-l.length;f&&t?.recordDroppedEvent("before_send","span",f);const d=c?_=>{const p=ve(_),h=c(p);return h||(eE(),p)}:ve,u=[];for(const _ of l){const p=d(_);p&&u.push(dV(p))}return Fr(o,u)}function Ow(e){if(!Te)return;const{description:t="< unknown name >",op:n="< unknown op >",parent_span_id:r}=ve(e),{spanId:s}=e.spanContext(),i=ai(e),o=rn(e),c=o===e,a=`[Tracing] Starting ${i?"sampled":"unsampled"} ${c?"root ":""}span`,l=[`op: ${n}`,`name: ${t}`,`ID: ${s}`];if(r&&l.push(`parent ID: ${r}`),!c){const{op:f,description:d}=ve(o);l.push(`root ID: ${o.spanContext().spanId}`),f&&l.push(`root op: ${f}`),d&&l.push(`root description: ${d}`)}Y.log(`${a}
  ${l.join(`
  `)}`)}function bw(e){if(!Te)return;const{description:t="< unknown name >",op:n="< unknown op >"}=ve(e),{spanId:r}=e.spanContext(),i=rn(e)===e,o=`[Tracing] Finishing "${n}" ${i?"root ":""}span "${t}" with ID ${r}`;Y.log(o)}function Ol(e){if(!e||e.length===0)return;const t={};return e.forEach(n=>{const r=n.attributes||{},s=r[vG],i=r[PG];typeof s=="string"&&typeof i=="number"&&(t[n.name]={value:i,unit:s})}),t}const WR=1e3;class TT{constructor(t={}){this._traceId=t.traceId||Ks(),this._spanId=t.spanId||si(),this._startTime=t.startTimestamp||Kc(),this._links=t.links,this._attributes={},this.setAttributes({[He]:"manual",[Re]:t.op,...t.attributes}),this._name=t.name,t.parentSpanId&&(this._parentSpanId=t.parentSpanId),"sampled"in t&&(this._sampled=t.sampled),t.endTimestamp&&(this._endTime=t.endTimestamp),this._events=[],this._isStandaloneSpan=t.isStandalone,this._endTime&&this._onSpanEnded()}addLink(t){return this._links?this._links.push(t):this._links=[t],this}addLinks(t){return this._links?this._links.push(...t):this._links=t,this}recordException(t,n){}spanContext(){const{_spanId:t,_traceId:n,_sampled:r}=this;return{spanId:t,traceId:n,traceFlags:r?pT:mw}}setAttribute(t,n){return n===void 0?delete this._attributes[t]:this._attributes[t]=n,this}setAttributes(t){return Object.keys(t).forEach(n=>this.setAttribute(n,t[n])),this}updateStartTime(t){this._startTime=Fn(t)}setStatus(t){return this._status=t,this}updateName(t){return this._name=t,this.setAttribute(cn,"custom"),this}end(t){this._endTime||(this._endTime=Fn(t),bw(this),this._onSpanEnded())}getSpanJSON(){return{data:this._attributes,description:this._name,op:this._attributes[Re],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:pd(this._status),timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[He],profile_id:this._attributes[lT],exclusive_time:this._attributes[dT],measurements:Ol(this._events),is_segment:this._isStandaloneSpan&&rn(this)===this||void 0,segment_id:this._isStandaloneSpan?rn(this).spanContext().spanId:void 0,links:_d(this._links)}}isRecording(){return!this._endTime&&!!this._sampled}addEvent(t,n,r){Te&&Y.log("[Tracing] Adding an event to span:",t);const s=KR(n)?n:r||Kc(),i=KR(n)?{}:n||{},o={name:t,time:Fn(s),attributes:i};return this._events.push(o),this}isStandaloneSpan(){return!!this._isStandaloneSpan}_onSpanEnded(){const t=ye();if(t&&t.emit("spanEnd",this),!(this._isStandaloneSpan||this===rn(this)))return;if(this._isStandaloneSpan){this._sampled?gV(SV([this],t)):(Te&&Y.log("[Tracing] Discarding standalone span because its trace was not chosen to be sampled."),t&&t.recordDroppedEvent("sample_rate","span"));return}const r=this._convertSpanToTransaction();r&&(Hi(this).scope||rt()).captureEvent(r)}_convertSpanToTransaction(){if(!zR(ve(this)))return;this._name||(Te&&Y.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>");const{scope:t,isolationScope:n}=Hi(this),r=t?.getScopeData().sdkProcessingMetadata?.normalizedRequest;if(this._sampled!==!0)return;const i=eV(this).filter(f=>f!==this&&!mV(f)).map(f=>ve(f)).filter(zR),o=this._attributes[cn];delete this._attributes[$i],i.forEach(f=>{delete f.data[$i]});const c={contexts:{trace:zG(this)},spans:i.length>WR?i.sort((f,d)=>f.start_timestamp-d.start_timestamp).slice(0,WR):i,start_timestamp:this._startTime,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:t,capturedSpanIsolationScope:n,dynamicSamplingContext:zt(this)},request:r,...o&&{transaction_info:{source:o}}},a=Ol(this._events);return a&&Object.keys(a).length&&(Te&&Y.log("[Measurements] Adding measurements to transaction event",JSON.stringify(a,void 0,2)),c.measurements=a),c}}function KR(e){return e&&typeof e=="number"||e instanceof Date||Array.isArray(e)}function zR(e){return!!e.start_timestamp&&!!e.timestamp&&!!e.span_id&&!!e.trace_id}function mV(e){return e instanceof TT&&e.isStandaloneSpan()}function gV(e){const t=ye();if(!t)return;const n=e[1];if(!n||n.length===0){t.recordDroppedEvent("before_send","span");return}t.sendEnvelope(e)}function Xs(e,t,n=()=>{},r=()=>{}){let s;try{s=e()}catch(i){throw t(i),n(),i}return AV(s,t,n,r)}function AV(e,t,n,r){return $r(e)?e.then(s=>(n(),r(s),s),s=>{throw t(s),n(),s}):(n(),r(e),e)}function Iw(e,t,n){if(!un(e))return[!1];let r,s;typeof e.tracesSampler=="function"?(s=e.tracesSampler({...t,inheritOrSampleWith:c=>typeof t.parentSampleRate=="number"?t.parentSampleRate:typeof t.parentSampled=="boolean"?Number(t.parentSampled):c}),r=!0):t.parentSampled!==void 0?s=t.parentSampled:typeof e.tracesSampleRate<"u"&&(s=e.tracesSampleRate,r=!0);const i=Zs(s);if(i===void 0)return Te&&Y.warn(`[Tracing] Discarding root span because of invalid sample rate. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(s)} of type ${JSON.stringify(typeof s)}.`),[!1];if(!i)return Te&&Y.log(`[Tracing] Discarding transaction because ${typeof e.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0"}`),[!1,i,r];const o=n<i;return o||Te&&Y.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(s)})`),[o,i,r]}const bl="__SENTRY_SUPPRESS_TRACING__";function Ji(e,t){const n=Td();if(n.startSpan)return n.startSpan(e,t);const r=Mw(e),{forceTransaction:s,parentSpan:i,scope:o}=e,c=o?.clone();return zs(c,()=>Lw(i)(()=>{const l=rt(),f=ww(l,i),u=e.onlyIfParent&&!f?new Ed:Pw({parentSpan:f,spanArguments:r,forceTransaction:s,scope:l});return zc(l,u),Xs(()=>t(u),()=>{const{status:_}=ve(u);u.isRecording()&&(!_||_==="ok")&&u.setStatus({code:be,message:"internal_error"})},()=>{u.end()})}))}function fr(e,t){const n=Td();if(n.startSpanManual)return n.startSpanManual(e,t);const r=Mw(e),{forceTransaction:s,parentSpan:i,scope:o}=e,c=o?.clone();return zs(c,()=>Lw(i)(()=>{const l=rt(),f=ww(l,i),u=e.onlyIfParent&&!f?new Ed:Pw({parentSpan:f,spanArguments:r,forceTransaction:s,scope:l});return zc(l,u),Xs(()=>t(u,()=>u.end()),()=>{const{status:_}=ve(u);u.isRecording()&&(!_||_==="ok")&&u.setStatus({code:be,message:"internal_error"})})}))}function Cw(e,t){const n=Td();return n.withActiveSpan?n.withActiveSpan(e,t):zs(r=>(zc(r,e||void 0),t(r)))}function vw(e){const t=Td();return t.suppressTracing?t.suppressTracing(e):zs(n=>{n.setSDKProcessingMetadata({[bl]:!0});const r=e();return n.setSDKProcessingMetadata({[bl]:void 0}),r})}function Pw({parentSpan:e,spanArguments:t,forceTransaction:n,scope:r}){if(!un()){const o=new Ed;if(n||!e){const c={sampled:"false",sample_rate:"0",transaction:t.name,...zt(o)};Mf(o,c)}return o}const s=tt();let i;if(e&&!n)i=RV(e,r,t),hT(e,i);else if(e){const o=zt(e),{traceId:c,spanId:a}=e.spanContext(),l=ai(e);i=ZR({traceId:c,parentSpanId:a,...t},r,l),Mf(i,o)}else{const{traceId:o,dsc:c,parentSpanId:a,sampled:l}={...s.getPropagationContext(),...r.getPropagationContext()};i=ZR({traceId:o,parentSpanId:a,...t},r,l),c&&Mf(i,c)}return Ow(i),fw(i,r,s),i}function Mw(e){const n={isStandalone:(e.experimental||{}).standalone,...e};if(e.startTime){const r={...n};return r.startTimestamp=Fn(e.startTime),delete r.startTime,r}return n}function Td(){const e=mr();return ii(e)}function ZR(e,t,n){const r=ye(),s=r?.getOptions()||{},{name:i=""}=e,o={spanAttributes:{...e.attributes},spanName:i,parentSampled:n};r?.emit("beforeSampling",o,{decision:!1});const c=o.parentSampled??n,a=o.spanAttributes,l=t.getPropagationContext(),[f,d,u]=t.getScopeData().sdkProcessingMetadata[bl]?[!1]:Iw(s,{name:i,parentSampled:c,attributes:a,parentSampleRate:Zs(l.dsc?.sample_rate)},l.sampleRand),_=new TT({...e,attributes:{[cn]:"custom",[Vi]:d!==void 0&&u?d:void 0,...a},sampled:f});return!f&&r&&(Te&&Y.log("[Tracing] Discarding root span because its trace was not chosen to be sampled."),r.recordDroppedEvent("sample_rate","transaction")),r&&r.emit("spanStart",_),_}function RV(e,t,n){const{spanId:r,traceId:s}=e.spanContext(),i=t.getScopeData().sdkProcessingMetadata[bl]?!1:ai(e),o=i?new TT({...n,parentSpanId:r,traceId:s,sampled:i}):new Ed({traceId:s});hT(e,o);const c=ye();return c&&(c.emit("spanStart",o),n.endTimestamp&&c.emit("spanEnd",o)),o}function ww(e,t){if(t)return t;if(t===null)return;const n=Rl(e);if(!n)return;const r=ye();return(r?r.getOptions():{}).parentSpanIsAlwaysRootSpan?rn(n):n}function Lw(e){return e!==void 0?t=>Cw(e,t):t=>t()}const wf=0,XR=1,QR=2;function Il(e){return new Zc(t=>{t(e)})}function ST(e){return new Zc((t,n)=>{n(e)})}class Zc{constructor(t){this._state=wf,this._handlers=[],this._runExecutor(t)}then(t,n){return new Zc((r,s)=>{this._handlers.push([!1,i=>{if(!t)r(i);else try{r(t(i))}catch(o){s(o)}},i=>{if(!n)s(i);else try{r(n(i))}catch(o){s(o)}}]),this._executeHandlers()})}catch(t){return this.then(n=>n,t)}finally(t){return new Zc((n,r)=>{let s,i;return this.then(o=>{i=!1,s=o,t&&t()},o=>{i=!0,s=o,t&&t()}).then(()=>{if(i){r(s);return}n(s)})})}_executeHandlers(){if(this._state===wf)return;const t=this._handlers.slice();this._handlers=[],t.forEach(n=>{n[0]||(this._state===XR&&n[1](this._value),this._state===QR&&n[2](this._value),n[0]=!0)})}_runExecutor(t){const n=(i,o)=>{if(this._state===wf){if($r(o)){o.then(r,s);return}this._state=i,this._value=o,this._executeHandlers()}},r=i=>{n(XR,i)},s=i=>{n(QR,i)};try{t(r,s)}catch(i){s(i)}}}function yV(e,t,n,r=0){try{const s=sE(t,n,e,r);return $r(s)?s:Il(s)}catch(s){return ST(s)}}function sE(e,t,n,r){const s=n[r];if(!e||!s)return e;const i=s({...e},t);return Te&&i===null&&Y.log(`Event processor "${s.id||"?"}" dropped event`),$r(i)?i.then(o=>sE(o,t,n,r+1)):sE(i,t,n,r+1)}function NV(e,t){const{fingerprint:n,span:r,breadcrumbs:s,sdkProcessingMetadata:i}=t;OV(e,t),r&&CV(e,r),vV(e,n),bV(e,s),IV(e,i)}function JR(e,t){const{extra:n,tags:r,user:s,contexts:i,level:o,sdkProcessingMetadata:c,breadcrumbs:a,fingerprint:l,eventProcessors:f,attachments:d,propagationContext:u,transactionName:_,span:p}=t;Iu(e,"extra",n),Iu(e,"tags",r),Iu(e,"user",s),Iu(e,"contexts",i),e.sdkProcessingMetadata=pu(e.sdkProcessingMetadata,c,2),o&&(e.level=o),_&&(e.transactionName=_),p&&(e.span=p),a.length&&(e.breadcrumbs=[...e.breadcrumbs,...a]),l.length&&(e.fingerprint=[...e.fingerprint,...l]),f.length&&(e.eventProcessors=[...e.eventProcessors,...f]),d.length&&(e.attachments=[...e.attachments,...d]),e.propagationContext={...e.propagationContext,...u}}function Iu(e,t,n){e[t]=pu(e[t],n,1)}function OV(e,t){const{extra:n,tags:r,user:s,contexts:i,level:o,transactionName:c}=t;Object.keys(n).length&&(e.extra={...n,...e.extra}),Object.keys(r).length&&(e.tags={...r,...e.tags}),Object.keys(s).length&&(e.user={...s,...e.user}),Object.keys(i).length&&(e.contexts={...i,...e.contexts}),o&&(e.level=o),c&&e.type!=="transaction"&&(e.transaction=c)}function bV(e,t){const n=[...e.breadcrumbs||[],...t];e.breadcrumbs=n.length?n:void 0}function IV(e,t){e.sdkProcessingMetadata={...e.sdkProcessingMetadata,...t}}function CV(e,t){e.contexts={trace:fd(t),...e.contexts},e.sdkProcessingMetadata={dynamicSamplingContext:zt(t),...e.sdkProcessingMetadata};const n=rn(t),r=ve(n).description;r&&!e.transaction&&e.type==="transaction"&&(e.transaction=r)}function vV(e,t){e.fingerprint=e.fingerprint?Array.isArray(e.fingerprint)?e.fingerprint:[e.fingerprint]:[],t&&(e.fingerprint=e.fingerprint.concat(t)),e.fingerprint.length||delete e.fingerprint}let cs,ey,ty,vr;function PV(e){const t=Me._sentryDebugIds,n=Me._debugIds;if(!t&&!n)return{};const r=t?Object.keys(t):[],s=n?Object.keys(n):[];if(vr&&r.length===ey&&s.length===ty)return vr;ey=r.length,ty=s.length,vr={},cs||(cs={});const i=(o,c)=>{for(const a of o){const l=c[a],f=cs?.[a];if(f&&vr&&l)vr[f[0]]=l,cs&&(cs[a]=[f[0],l]);else if(l){const d=e(a);for(let u=d.length-1;u>=0;u--){const p=d[u]?.filename;if(p&&vr&&cs){vr[p]=l,cs[a]=[p,l];break}}}}};return t&&i(r,t),n&&i(s,n),vr}function MV(e,t,n,r,s,i){const{normalizeDepth:o=3,normalizeMaxBreadth:c=1e3}=e,a={...t,event_id:t.event_id||n.event_id||nn(),timestamp:t.timestamp||_u()},l=n.integrations||e.integrations.map(E=>E.name);wV(a,e),UV(a,l),s&&s.emit("applyFrameMetadata",t),t.type===void 0&&LV(a,e.stackParser);const f=xV(r,n.captureContext);n.mechanism&&aT(a,n.mechanism);const d=s?s.getEventProcessors():[],u=bG().getScopeData();if(i){const E=i.getScopeData();JR(u,E)}if(f){const E=f.getScopeData();JR(u,E)}const _=[...n.attachments||[],...u.attachments];_.length&&(n.attachments=_),NV(a,u);const p=[...d,...u.eventProcessors];return yV(p,a,n).then(E=>(E&&DV(E),typeof o=="number"&&o>0?kV(E,o,c):E))}function wV(e,t){const{environment:n,release:r,dist:s,maxValueLength:i}=t;e.environment=e.environment||n||ET,!e.release&&r&&(e.release=r),!e.dist&&s&&(e.dist=s);const o=e.request;o?.url&&i&&(o.url=Al(o.url,i)),i&&e.exception?.values?.forEach(c=>{c.value&&(c.value=Al(c.value,i))})}function LV(e,t){const n=PV(t);e.exception?.values?.forEach(r=>{r.stacktrace?.frames?.forEach(s=>{s.filename&&(s.debug_id=n[s.filename])})})}function DV(e){const t={};if(e.exception?.values?.forEach(r=>{r.stacktrace?.frames?.forEach(s=>{s.debug_id&&(s.abs_path?t[s.abs_path]=s.debug_id:s.filename&&(t[s.filename]=s.debug_id),delete s.debug_id)})}),Object.keys(t).length===0)return;e.debug_meta=e.debug_meta||{},e.debug_meta.images=e.debug_meta.images||[];const n=e.debug_meta.images;Object.entries(t).forEach(([r,s])=>{n.push({type:"sourcemap",code_file:r,debug_id:s})})}function UV(e,t){t.length>0&&(e.sdk=e.sdk||{},e.sdk.integrations=[...e.sdk.integrations||[],...t])}function kV(e,t,n){if(!e)return null;const r={...e,...e.breadcrumbs&&{breadcrumbs:e.breadcrumbs.map(s=>({...s,...s.data&&{data:ur(s.data,t,n)}}))},...e.user&&{user:ur(e.user,t,n)},...e.contexts&&{contexts:ur(e.contexts,t,n)},...e.extra&&{extra:ur(e.extra,t,n)}};return e.contexts?.trace&&r.contexts&&(r.contexts.trace=e.contexts.trace,e.contexts.trace.data&&(r.contexts.trace.data=ur(e.contexts.trace.data,t,n))),e.spans&&(r.spans=e.spans.map(s=>({...s,...s.data&&{data:ur(s.data,t,n)}}))),e.contexts?.flags&&r.contexts&&(r.contexts.flags=ur(e.contexts.flags,3,n)),r}function xV(e,t){if(!t)return e;const n=e?e.clone():new jn;return n.update(t),n}function BV(e){if(e)return GV(e)?{captureContext:e}:$V(e)?{captureContext:e}:e}function GV(e){return e instanceof jn||typeof e=="function"}const VV=["user","level","extra","contexts","tags","fingerprint","propagationContext"];function $V(e){return Object.keys(e).some(t=>VV.includes(t))}function Ye(e,t){return rt().captureException(e,BV(t))}function HV(e,t){return rt().captureEvent(e,t)}function FV(e,t){tt().setTag(e,t)}function ny(e){tt().setUser(e)}async function jV(e){const t=ye();return t?t.flush(e):(Te&&Y.warn("Cannot flush events. No client defined."),Promise.resolve(!1))}function qV(){const e=ye();return e?.getOptions().enabled!==!1&&!!e?.getTransport()}function YV(e){const t=tt(),n=rt(),{userAgent:r}=Me.navigator||{},s=TG({user:n.getUser()||t.getUser(),...r&&{userAgent:r},...e}),i=t.getSession();return i?.status==="ok"&&Bi(i,{status:"exited"}),Dw(),t.setSession(s),s}function Dw(){const e=tt(),n=rt().getSession()||e.getSession();n&&SG(n),WV(),e.setSession()}function WV(){const e=tt(),t=ye(),n=e.getSession();n&&t&&t.captureSession(n)}const KV="7";function zV(e){const t=e.protocol?`${e.protocol}:`:"",n=e.port?`:${e.port}`:"";return`${t}//${e.host}${n}${e.path?`/${e.path}`:""}/api/`}function ZV(e){return`${zV(e)}${e.projectId}/envelope/`}function XV(e,t){const n={sentry_version:KV};return e.publicKey&&(n.sentry_key=e.publicKey),t&&(n.sentry_client=`${t.name}/${t.version}`),new URLSearchParams(n).toString()}function QV(e,t,n){return t||`${ZV(e)}?${XV(e,n)}`}const ry=[];function JV(e){const t={};return e.forEach(n=>{const{name:r}=n,s=t[r];s&&!s.isDefaultInstance&&n.isDefaultInstance||(t[r]=n)}),Object.values(t)}function e$(e){const t=e.defaultIntegrations||[],n=e.integrations;t.forEach(s=>{s.isDefaultInstance=!0});let r;if(Array.isArray(n))r=[...t,...n];else if(typeof n=="function"){const s=n(t);r=Array.isArray(s)?s:[s]}else r=t;return JV(r)}function t$(e,t){const n={};return t.forEach(r=>{r&&Uw(e,r,n)}),n}function sy(e,t){for(const n of t)n?.afterAllSetup&&n.afterAllSetup(e)}function Uw(e,t,n){if(n[t.name]){Te&&Y.log(`Integration skipped because it was already installed: ${t.name}`);return}if(n[t.name]=t,!ry.includes(t.name)&&typeof t.setupOnce=="function"&&(t.setupOnce(),ry.push(t.name)),t.setup&&typeof t.setup=="function"&&t.setup(e),typeof t.preprocessEvent=="function"){const r=t.preprocessEvent.bind(t);e.on("preprocessEvent",(s,i)=>r(s,i,e))}if(typeof t.processEvent=="function"){const r=t.processEvent.bind(t),s=Object.assign((i,o)=>r(i,o,e),{id:t.name});e.addEventProcessor(s)}Te&&Y.log(`Integration installed: ${t.name}`)}function n$(e,t){return t?zs(t,()=>{const n=hd(),r=n?fd(n):uT(t);return[n?zt(n):Eu(e,t),r]}):[void 0,void 0]}function r$(e){return[{type:"log",item_count:e.length,content_type:"application/vnd.sentry.items.log+json"},{items:e}]}function s$(e,t,n,r){const s={};return t?.sdk&&(s.sdk={name:t.sdk.name,version:t.sdk.version}),n&&r&&(s.dsn=oi(r)),Fr(s,[r$(e)])}function kw(e,t){const n=t??i$(e)??[];if(n.length===0)return;const r=e.getOptions(),s=s$(n,r._metadata,r.tunnel,e.getDsn());xw().set(e,[]),e.emit("flushLogs"),e.sendEnvelope(s)}function i$(e){return xw().get(e)}function xw(){return Xi("clientToLogBufferMap",()=>new WeakMap)}function o$(e){return[{type:"trace_metric",item_count:e.length,content_type:"application/vnd.sentry.items.trace-metric+json"},{items:e}]}function a$(e,t,n,r){const s={};return t?.sdk&&(s.sdk={name:t.sdk.name,version:t.sdk.version}),n&&r&&(s.dsn=oi(r)),Fr(s,[o$(e)])}function c$(e,t){const n=t??u$(e)??[];if(n.length===0)return;const r=e.getOptions(),s=a$(n,r._metadata,r.tunnel,e.getDsn());Bw().set(e,[]),e.emit("flushMetrics"),e.sendEnvelope(s)}function u$(e){return Bw().get(e)}function Bw(){return Xi("clientToMetricBufferMap",()=>new WeakMap)}const mT=Symbol.for("SentryBufferFullError");function Gw(e=100){const t=new Set;function n(){return t.size<e}function r(o){t.delete(o)}function s(o){if(!n())return ST(mT);const c=o();return t.add(c),c.then(()=>r(c),()=>r(c)),c}function i(o){if(!t.size)return Il(!0);const c=Promise.allSettled(Array.from(t)).then(()=>!0);if(!o)return c;const a=[c,new Promise(l=>setTimeout(()=>l(!1),o))];return Promise.race(a)}return{get $(){return Array.from(t)},add:s,drain:i}}const l$=60*1e3;function d$(e,t=Date.now()){const n=parseInt(`${e}`,10);if(!isNaN(n))return n*1e3;const r=Date.parse(`${e}`);return isNaN(r)?l$:r-t}function f$(e,t){return e[t]||e.all||0}function _$(e,t,n=Date.now()){return f$(e,t)>n}function p$(e,{statusCode:t,headers:n},r=Date.now()){const s={...e},i=n?.["x-sentry-rate-limits"],o=n?.["retry-after"];if(i)for(const c of i.trim().split(",")){const[a,l,,,f]=c.split(":",5),d=parseInt(a,10),u=(isNaN(d)?60:d)*1e3;if(!l)s.all=r+u;else for(const _ of l.split(";"))_==="metric_bucket"?(!f||f.split(";").includes("custom"))&&(s[_]=r+u):s[_]=r+u}else o?s.all=r+d$(o,r):t===429&&(s.all=r+60*1e3);return s}const Vw=64;function iy(e,t,n=Gw(e.bufferSize||Vw)){let r={};const s=o=>n.drain(o);function i(o){const c=[];if(qR(o,(d,u)=>{const _=YR(u);_$(r,_)?e.recordDroppedEvent("ratelimit_backoff",_):c.push(d)}),c.length===0)return Promise.resolve({});const a=Fr(o[0],c),l=d=>{qR(a,(u,_)=>{e.recordDroppedEvent(d,YR(_))})},f=()=>t({body:yw(a)}).then(d=>(d.statusCode!==void 0&&(d.statusCode<200||d.statusCode>=300)&&Te&&Y.warn(`Sentry responded with status code ${d.statusCode} to sent event.`),r=p$(r,d),d),d=>{throw l("network_error"),Te&&Y.error("Encountered error running transport request:",d),d});return n.add(f).then(d=>d,d=>{if(d===mT)return Te&&Y.error("Skipped sending event because buffer is full."),l("queue_overflow"),Promise.resolve({});throw d})}return{send:i,flush:s}}function h$(e,t,n){const r=[{type:"client_report"},{timestamp:_u(),discarded_events:e}];return Fr(t?{dsn:t}:{},[r])}function $w(e){const t=[];e.message&&t.push(e.message);try{const n=e.exception.values[e.exception.values.length-1];n?.value&&(t.push(n.value),n.type&&t.push(`${n.type}: ${n.value}`))}catch{}return t}function E$(e){const{trace_id:t,parent_span_id:n,span_id:r,status:s,origin:i,data:o,op:c}=e.contexts?.trace??{};return{data:o??{},description:e.transaction,op:c,parent_span_id:n,span_id:r??"",start_timestamp:e.start_timestamp??0,status:s,timestamp:e.timestamp,trace_id:t??"",origin:i,profile_id:o?.[lT],exclusive_time:o?.[dT],measurements:e.measurements,is_segment:!0}}function T$(e){return{type:"transaction",timestamp:e.timestamp,start_timestamp:e.start_timestamp,transaction:e.description,contexts:{trace:{trace_id:e.trace_id,span_id:e.span_id,parent_span_id:e.parent_span_id,op:e.op,status:e.status,origin:e.origin,data:{...e.data,...e.profile_id&&{[lT]:e.profile_id},...e.exclusive_time&&{[dT]:e.exclusive_time}}}},measurements:e.measurements}}const oy="Not capturing exception because it's already been captured.",ay="Discarded session because of missing or non-string release",Hw=Symbol.for("SentryInternalError"),Fw=Symbol.for("SentryDoNotSendEventError"),S$=5e3;function ol(e){return{message:e,[Hw]:!0}}function Lf(e){return{message:e,[Fw]:!0}}function cy(e){return!!e&&typeof e=="object"&&Hw in e}function uy(e){return!!e&&typeof e=="object"&&Fw in e}function ly(e,t,n,r,s){let i=0,o,c=!1;e.on(n,()=>{i=0,clearTimeout(o),c=!1}),e.on(t,a=>{i+=r(a),i>=8e5?s(e):c||(c=!0,o=setTimeout(()=>{s(e)},S$))}),e.on("flush",()=>{s(e)})}class m${constructor(t){if(this._options=t,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],this._promiseBuffer=Gw(t.transportOptions?.bufferSize??Vw),t.dsn?this._dsn=qG(t.dsn):Te&&Y.warn("No DSN provided, client will not send events."),this._dsn){const r=QV(this._dsn,t.tunnel,t._metadata?t._metadata.sdk:void 0);this._transport=t.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...t.transportOptions,url:r})}this._options.enableLogs=this._options.enableLogs??this._options._experiments?.enableLogs,this._options.enableLogs&&ly(this,"afterCaptureLog","flushLogs",y$,kw),(this._options.enableMetrics??this._options._experiments?.enableMetrics??!0)&&ly(this,"afterCaptureMetric","flushMetrics",R$,c$)}captureException(t,n,r){const s=nn();if(xR(t))return Te&&Y.log(oy),s;const i={event_id:s,...n};return this._process(()=>this.eventFromException(t,i).then(o=>this._captureEvent(o,i,r)).then(o=>o),"error"),i.event_id}captureMessage(t,n,r,s){const i={event_id:nn(),...r},o=oT(t)?t:String(t),c=iw(t),a=c?this.eventFromMessage(o,n,i):this.eventFromException(t,i);return this._process(()=>a.then(l=>this._captureEvent(l,i,s)),c?"unknown":"error"),i.event_id}captureEvent(t,n,r){const s=nn();if(n?.originalException&&xR(n.originalException))return Te&&Y.log(oy),s;const i={event_id:s,...n},o=t.sdkProcessingMetadata||{},c=o.capturedSpanScope,a=o.capturedSpanIsolationScope,l=dy(t.type);return this._process(()=>this._captureEvent(t,i,c||r,a),l),i.event_id}captureSession(t){this.sendSession(t),Bi(t,{init:!1})}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}async flush(t){const n=this._transport;if(!n)return!0;this.emit("flush");const r=await this._isClientDoneProcessing(t),s=await n.flush(t);return r&&s}async close(t){const n=await this.flush(t);return this.getOptions().enabled=!1,this.emit("close"),n}getEventProcessors(){return this._eventProcessors}addEventProcessor(t){this._eventProcessors.push(t)}init(){(this._isEnabled()||this._options.integrations.some(({name:t})=>t.startsWith("Spotlight")))&&this._setupIntegrations()}getIntegrationByName(t){return this._integrations[t]}addIntegration(t){const n=this._integrations[t.name];Uw(this,t,this._integrations),n||sy(this,[t])}sendEvent(t,n={}){this.emit("beforeSendEvent",t,n);let r=TV(t,this._dsn,this._options._metadata,this._options.tunnel);for(const s of n.attachments||[])r=uV(r,fV(s));this.sendEnvelope(r).then(s=>this.emit("afterSendEvent",t,s))}sendSession(t){const{release:n,environment:r=ET}=this._options;if("aggregates"in t){const i=t.attrs||{};if(!i.release&&!n){Te&&Y.warn(ay);return}i.release=i.release||n,i.environment=i.environment||r,t.attrs=i}else{if(!t.release&&!n){Te&&Y.warn(ay);return}t.release=t.release||n,t.environment=t.environment||r}this.emit("beforeSendSession",t);const s=EV(t,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(s)}recordDroppedEvent(t,n,r=1){if(this._options.sendClientReports){const s=`${t}:${n}`;Te&&Y.log(`Recording outcome: "${s}"${r>1?` (${r} times)`:""}`),this._outcomes[s]=(this._outcomes[s]||0)+r}}on(t,n){const r=this._hooks[t]=this._hooks[t]||new Set,s=(...i)=>n(...i);return r.add(s),()=>{r.delete(s)}}emit(t,...n){const r=this._hooks[t];r&&r.forEach(s=>s(...n))}async sendEnvelope(t){if(this.emit("beforeEnvelope",t),this._isEnabled()&&this._transport)try{return await this._transport.send(t)}catch(n){return Te&&Y.error("Error while sending envelope:",n),{}}return Te&&Y.error("Transport disabled"),{}}_setupIntegrations(){const{integrations:t}=this._options;this._integrations=t$(this,t),sy(this,t)}_updateSessionFromEvent(t,n){let r=n.level==="fatal",s=!1;const i=n.exception?.values;if(i){s=!0,r=!1;for(const a of i)if(a.mechanism?.handled===!1){r=!0;break}}const o=t.status==="ok";(o&&t.errors===0||o&&r)&&(Bi(t,{...r&&{status:"crashed"},errors:t.errors||Number(s||r)}),this.captureSession(t))}async _isClientDoneProcessing(t){let n=0;for(;!t||n<t;){if(await new Promise(r=>setTimeout(r,1)),!this._numProcessing)return!0;n++}return!1}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(t,n,r,s){const i=this.getOptions(),o=Object.keys(this._integrations);return!n.integrations&&o?.length&&(n.integrations=o),this.emit("preprocessEvent",t,n),t.type||s.setLastEventId(t.event_id||n.event_id),MV(i,t,n,r,this,s).then(c=>{if(c===null)return c;this.emit("postprocessEvent",c,n),c.contexts={trace:uT(r),...c.contexts};const a=Eu(this,r);return c.sdkProcessingMetadata={dynamicSamplingContext:a,...c.sdkProcessingMetadata},c})}_captureEvent(t,n={},r=rt(),s=tt()){return Te&&iE(t)&&Y.log(`Captured error event \`${$w(t)[0]||"<unknown>"}\``),this._processEvent(t,n,r,s).then(i=>i.event_id,i=>{Te&&(uy(i)?Y.log(i.message):cy(i)?Y.warn(i.message):Y.warn(i))})}_processEvent(t,n,r,s){const i=this.getOptions(),{sampleRate:o}=i,c=jw(t),a=iE(t),f=`before send for type \`${t.type||"error"}\``,d=typeof o>"u"?void 0:Zs(o);if(a&&typeof d=="number"&&Math.random()>d)return this.recordDroppedEvent("sample_rate","error"),ST(Lf(`Discarding event because it's not included in the random sample (sampling rate = ${o})`));const u=dy(t.type);return this._prepareEvent(t,n,r,s).then(_=>{if(_===null)throw this.recordDroppedEvent("event_processor",u),Lf("An event processor returned `null`, will not send event.");if(n.data&&n.data.__sentry__===!0)return _;const h=A$(this,i,_,n);return g$(h,f)}).then(_=>{if(_===null){if(this.recordDroppedEvent("before_send",u),c){const T=1+(t.spans||[]).length;this.recordDroppedEvent("before_send","span",T)}throw Lf(`${f} returned \`null\`, will not send event.`)}const p=r.getSession()||s.getSession();if(a&&p&&this._updateSessionFromEvent(p,_),c){const E=_.sdkProcessingMetadata?.spanCountBeforeProcessing||0,T=_.spans?_.spans.length:0,S=E-T;S>0&&this.recordDroppedEvent("before_send","span",S)}const h=_.transaction_info;if(c&&h&&_.transaction!==t.transaction){const E="custom";_.transaction_info={...h,source:E}}return this.sendEvent(_,n),_}).then(null,_=>{throw uy(_)||cy(_)?_:(this.captureException(_,{mechanism:{handled:!1,type:"internal"},data:{__sentry__:!0},originalException:_}),ol(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${_}`))})}_process(t,n){this._numProcessing++,this._promiseBuffer.add(t).then(r=>(this._numProcessing--,r),r=>(this._numProcessing--,r===mT&&this.recordDroppedEvent("queue_overflow",n),r))}_clearOutcomes(){const t=this._outcomes;return this._outcomes={},Object.entries(t).map(([n,r])=>{const[s,i]=n.split(":");return{reason:s,category:i,quantity:r}})}_flushOutcomes(){Te&&Y.log("Flushing outcomes...");const t=this._clearOutcomes();if(t.length===0){Te&&Y.log("No outcomes to send");return}if(!this._dsn){Te&&Y.log("No dsn provided, will not send outcomes");return}Te&&Y.log("Sending outcomes:",t);const n=h$(t,this._options.tunnel&&oi(this._dsn));this.sendEnvelope(n)}}function dy(e){return e==="replay_event"?"replay":e||"error"}function g$(e,t){const n=`${t} must return \`null\` or a valid event.`;if($r(e))return e.then(r=>{if(!Wc(r)&&r!==null)throw ol(n);return r},r=>{throw ol(`${t} rejected with ${r}`)});if(!Wc(e)&&e!==null)throw ol(n);return e}function A$(e,t,n,r){const{beforeSend:s,beforeSendTransaction:i,beforeSendSpan:o,ignoreSpans:c}=t;let a=n;if(iE(a)&&s)return s(a,r);if(jw(a)){if(o||c){const l=E$(a);if(c?.length&&tE(l,c))return null;if(o){const f=o(l);f?a=pu(n,T$(f)):eE()}if(a.spans){const f=[],d=a.spans;for(const _ of d){if(c?.length&&tE(_,c)){nV(d,_);continue}if(o){const p=o(_);p?f.push(p):(eE(),f.push(_))}else f.push(_)}const u=a.spans.length-f.length;u&&e.recordDroppedEvent("before_send","span",u),a.spans=f}}if(i){if(a.spans){const l=a.spans.length;a.sdkProcessingMetadata={...n.sdkProcessingMetadata,spanCountBeforeProcessing:l}}return i(a,r)}}return a}function iE(e){return e.type===void 0}function jw(e){return e.type==="transaction"}function R$(e){let t=0;return e.name&&(t+=e.name.length*2),t+=8,t+qw(e.attributes)}function y$(e){let t=0;return e.message&&(t+=e.message.length*2),t+qw(e.attributes)}function qw(e){if(!e)return 0;let t=0;return Object.values(e).forEach(n=>{Array.isArray(n)?t+=n.length*fy(n[0]):iw(n)?t+=fy(n):t+=100}),t}function fy(e){return typeof e=="string"?e.length*2:typeof e=="number"?8:typeof e=="boolean"?4:0}function N$(e,t,n,r,s){const i={sent_at:new Date().toISOString()};n?.sdk&&(i.sdk={name:n.sdk.name,version:n.sdk.version}),r&&s&&(i.dsn=oi(s)),t&&(i.trace=t);const o=O$(e);return Fr(i,[o])}function O$(e){return[{type:"check_in"},e]}function b$(e){const t=e._metadata?.sdk,n=t?.name&&t?.version?`${t?.name}/${t?.version}`:void 0;e.transportOptions={...e.transportOptions,headers:{...n&&{"user-agent":n},...e.transportOptions?.headers}}}function Yw(e,t){return e(t.stack||"",1)}function Ww(e,t){const n={type:t.name||t.constructor.name,value:t.message},r=Yw(e,t);return r.length&&(n.stacktrace={frames:r}),n}function I$(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const n=e[t];if(n instanceof Error)return n}}function C$(e){if("name"in e&&typeof e.name=="string"){let r=`'${e.name}' captured as exception`;return"message"in e&&typeof e.message=="string"&&(r+=` with message '${e.message}'`),r}else if("message"in e&&typeof e.message=="string")return e.message;const t=aG(e);if(zB(e))return`Event \`ErrorEvent\` captured as exception with message \`${e.message}\``;const n=v$(e);return`${n&&n!=="Object"?`'${n}'`:"Object"} captured as exception with keys: ${t}`}function v$(e){try{const t=Object.getPrototypeOf(e);return t?t.constructor.name:void 0}catch{}}function P$(e,t,n,r){if(ml(n))return[n,void 0];if(t.synthetic=!0,Wc(n)){const i=e?.getOptions().normalizeDepth,o={__serialized__:Rw(n,i)},c=I$(n);if(c)return[c,o];const a=C$(n),l=r?.syntheticException||new Error(a);return l.message=a,[l,o]}const s=r?.syntheticException||new Error(n);return s.message=`${n}`,[s,void 0]}function M$(e,t,n,r){const i=r?.data&&r.data.mechanism||{handled:!0,type:"generic"},[o,c]=P$(e,i,n,r),a={exception:{values:[Ww(t,o)]}};return c&&(a.extra=c),fG(a),aT(a,i),{...a,event_id:r?.event_id}}function w$(e,t,n="info",r,s){const i={event_id:r?.event_id,level:n};if(s&&r?.syntheticException){const o=Yw(e,r.syntheticException);o.length&&(i.exception={values:[{value:t,stacktrace:{frames:o}}]},aT(i,{synthetic:!0}))}if(oT(t)){const{__sentry_template_string__:o,__sentry_template_values__:c}=t;return i.logentry={message:o,params:c},i}return i.message=t,i}class L$ extends m${constructor(t){tV(),b$(t),super(t),this._setUpMetricsProcessing()}eventFromException(t,n){const r=M$(this,this._options.stackParser,t,n);return r.level="error",Il(r)}eventFromMessage(t,n="info",r){return Il(w$(this._options.stackParser,t,n,r,this._options.attachStacktrace))}captureException(t,n,r){return _y(n),super.captureException(t,n,r)}captureEvent(t,n,r){return!t.type&&t.exception?.values&&t.exception.values.length>0&&_y(n),super.captureEvent(t,n,r)}captureCheckIn(t,n,r){const s="checkInId"in t&&t.checkInId?t.checkInId:nn();if(!this._isEnabled())return Te&&Y.warn("SDK not enabled, will not capture check-in."),s;const i=this.getOptions(),{release:o,environment:c,tunnel:a}=i,l={check_in_id:s,monitor_slug:t.monitorSlug,status:t.status,release:o,environment:c};"duration"in t&&(l.duration=t.duration),n&&(l.monitor_config={schedule:n.schedule,checkin_margin:n.checkinMargin,max_runtime:n.maxRuntime,timezone:n.timezone,failure_issue_threshold:n.failureIssueThreshold,recovery_threshold:n.recoveryThreshold});const[f,d]=n$(this,r);d&&(l.contexts={trace:d});const u=N$(l,f,this.getSdkMetadata(),a,this.getDsn());return Te&&Y.log("Sending checkin:",t.monitorSlug,t.status),this.sendEnvelope(u),s}_prepareEvent(t,n,r,s){return this._options.platform&&(t.platform=t.platform||this._options.platform),this._options.runtime&&(t.contexts={...t.contexts,runtime:t.contexts?.runtime||this._options.runtime}),this._options.serverName&&(t.server_name=t.server_name||this._options.serverName),super._prepareEvent(t,n,r,s)}_setUpMetricsProcessing(){this.on("processMetric",t=>{this._options.serverName&&(t.attributes={"server.address":this._options.serverName,...t.attributes})})}}function _y(e){const t=tt().getScopeData().sdkProcessingMetadata.requestSession;if(t){const n=e?.mechanism?.handled??!0;n&&t.status!=="crashed"?t.status="errored":n||(t.status="crashed")}}const gT=new Set;function D$(e){e.forEach(t=>{gT.add(t),Te&&Y.log(`AI provider "${t}" wrapping will be skipped`)})}function AT(e){return gT.has(e)}function U$(){gT.clear(),Te&&Y.log("Cleared AI provider skip registrations")}const k$="thismessage:/";function x$(e,t){const n=e.indexOf("://")<=0&&e.indexOf("//")!==0,r=n?k$:void 0;try{if("canParse"in URL&&!URL.canParse(e,r))return;const s=new URL(e,r);return n?{isRelative:n,pathname:s.pathname,search:s.search,hash:s.hash}:s}catch{}}function Sd(e){if(!e)return{};const t=e.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};const n=t[6]||"",r=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],search:n,hash:r,relative:t[5]+n+r}}function Xc(e){return e.split(/[?#]/,1)[0]}function md(e){const{protocol:t,host:n,path:r}=e,s=n?.replace(/^.*@/,"[filtered]:[filtered]@").replace(/(:80)$/,"").replace(/(:443)$/,"")||"";return`${t?`${t}://`:""}${s}${r}`}function RT(e,t,n=[t],r="npm"){const s=e._metadata||{};s.sdk||(s.sdk={name:`sentry.javascript.${t}`,packages:n.map(i=>({name:`${r}:@sentry/${i}`,version:at})),version:at}),e._metadata=s}function Kw(e={}){const t=e.client||ye();if(!qV()||!t)return{};const n=mr(),r=ii(n);if(r.getTraceData)return r.getTraceData(e);const s=e.scope||rt(),i=e.span||hd(),o=i?ZG(i):B$(s),c=i?zt(i):Eu(t,s),a=_T(c);if(!Ew.test(o))return Y.warn("Invalid sentry-trace data. Cannot generate trace data"),{};const f={"sentry-trace":o,baggage:a};if(e.propagateTraceparent){const d=i?XG(i):G$(s);d&&(f.traceparent=d)}return f}function B$(e){const{traceId:t,sampled:n,propagationSpanId:r}=e.getPropagationContext();return dd(t,r,n)}function G$(e){const{traceId:t,sampled:n,propagationSpanId:r}=e.getPropagationContext();return Sw(t,r,n)}function V$(e,t,n){let r,s,i;const o=Math.max(n.maxWait,t),c=n?.setTimeoutImpl||setTimeout;function a(){return l(),r=e(),r}function l(){s!==void 0&&clearTimeout(s),i!==void 0&&clearTimeout(i),s=i=void 0}function f(){return s!==void 0||i!==void 0?a():r}function d(){return s&&clearTimeout(s),s=c(a,t),o&&i===void 0&&(i=c(a,o)),r}return d.cancel=l,d.flush=f,d}function $$(e){const t=Object.create(null);try{Object.entries(e).forEach(([n,r])=>{typeof r=="string"&&(t[n]=r)})}catch{}return t}function H$(e){const t=e.headers||{},r=(typeof t["x-forwarded-host"]=="string"?t["x-forwarded-host"]:void 0)||(typeof t.host=="string"?t.host:void 0),i=(typeof t["x-forwarded-proto"]=="string"?t["x-forwarded-proto"]:void 0)||e.protocol||(e.socket?.encrypted?"https":"http"),o=e.url||"",c=F$({url:o,host:r,protocol:i}),a=e.body||void 0,l=e.cookies;return{url:c,method:e.method,query_string:Y$(o),headers:$$(t),cookies:l,data:a}}function F$({url:e,protocol:t,host:n}){if(e?.startsWith("http"))return e;if(e&&n)return`${t}://${n}${e}`}const j$=["auth","token","secret","cookie","-user","password","key","jwt","bearer","sso","saml"];function q$(e){const t={};try{Object.entries(e).forEach(([n,r])=>{if(r==null)return;const s=n.toLowerCase(),i=j$.some(c=>s.includes(c)),o=`http.request.header.${s.replace(/-/g,"_")}`;i?t[o]="[Filtered]":Array.isArray(r)?t[o]=r.map(c=>c!=null?String(c):c).join(";"):typeof r=="string"&&(t[o]=r)})}catch{}return t}function Y$(e){if(e)try{const t=new URL(e,"http://s.io").search.slice(1);return t.length?t:void 0}catch{return}}const W$=100;function Fi(e,t){const n=ye(),r=tt();if(!n)return;const{beforeBreadcrumb:s=null,maxBreadcrumbs:i=W$}=n.getOptions();if(i<=0)return;const c={timestamp:_u(),...e},a=s?Cn(()=>s(c,t)):c;a!==null&&(n.emit&&n.emit("beforeAddBreadcrumb",a,t),r.addBreadcrumb(a,i))}let py;const K$="FunctionToString",hy=new WeakMap,z$=(()=>({name:K$,setupOnce(){py=Function.prototype.toString;try{Function.prototype.toString=function(...e){const t=oG(this),n=hy.has(ye())&&t!==void 0?t:this;return py.apply(n,e)}}catch{}},setup(e){hy.set(e,!0)}})),Z$=z$,X$=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,/^Can't find variable: gmo$/,/^undefined is not an object \(evaluating 'a\.[A-Z]'\)$/,`can't redefine non-configurable property "solana"`,"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler",/^Non-Error promise rejection captured with value: Object Not Found Matching Id:\d+, MethodName:simulateEvent, ParamCount:\d+$/,/^Java exception was raised during method invocation$/],Q$="EventFilters",J$=(e={})=>{let t;return{name:Q$,setup(n){const r=n.getOptions();t=Ey(e,r)},processEvent(n,r,s){if(!t){const i=s.getOptions();t=Ey(e,i)}return tH(n,t)?null:n}}},eH=((e={})=>({...J$(e),name:"InboundFilters"}));function Ey(e={},t={}){return{allowUrls:[...e.allowUrls||[],...t.allowUrls||[]],denyUrls:[...e.denyUrls||[],...t.denyUrls||[]],ignoreErrors:[...e.ignoreErrors||[],...t.ignoreErrors||[],...e.disableErrorDefaults?[]:X$],ignoreTransactions:[...e.ignoreTransactions||[],...t.ignoreTransactions||[]]}}function tH(e,t){if(e.type){if(e.type==="transaction"&&rH(e,t.ignoreTransactions))return Te&&Y.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${Ai(e)}`),!0}else{if(nH(e,t.ignoreErrors))return Te&&Y.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${Ai(e)}`),!0;if(aH(e))return Te&&Y.warn(`Event dropped due to not having an error message, error type or stacktrace.
Event: ${Ai(e)}`),!0;if(sH(e,t.denyUrls))return Te&&Y.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${Ai(e)}.
Url: ${Cl(e)}`),!0;if(!iH(e,t.allowUrls))return Te&&Y.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${Ai(e)}.
Url: ${Cl(e)}`),!0}return!1}function nH(e,t){return t?.length?$w(e).some(n=>fu(n,t)):!1}function rH(e,t){if(!t?.length)return!1;const n=e.transaction;return n?fu(n,t):!1}function sH(e,t){if(!t?.length)return!1;const n=Cl(e);return n?fu(n,t):!1}function iH(e,t){if(!t?.length)return!0;const n=Cl(e);return n?fu(n,t):!0}function oH(e=[]){for(let t=e.length-1;t>=0;t--){const n=e[t];if(n&&n.filename!=="<anonymous>"&&n.filename!=="[native code]")return n.filename||null}return null}function Cl(e){try{const n=[...e.exception?.values??[]].reverse().find(r=>r.mechanism?.parent_id===void 0&&r.stacktrace?.frames?.length)?.stacktrace?.frames;return n?oH(n):null}catch{return Te&&Y.error(`Cannot extract url for event ${Ai(e)}`),null}}function aH(e){return e.exception?.values?.length?!e.message&&!e.exception.values.some(t=>t.stacktrace||t.type&&t.type!=="Error"||t.value):!1}function cH(e,t,n,r,s,i){if(!s.exception?.values||!i||!Ws(i.originalException,Error))return;const o=s.exception.values.length>0?s.exception.values[s.exception.values.length-1]:void 0;o&&(s.exception.values=oE(e,t,r,i.originalException,n,s.exception.values,o,0))}function oE(e,t,n,r,s,i,o,c){if(i.length>=n+1)return i;let a=[...i];if(Ws(r[s],Error)){Ty(o,c);const l=e(t,r[s]),f=a.length;Sy(l,s,f,c),a=oE(e,t,n,r[s],s,[l,...a],l,f)}return Array.isArray(r.errors)&&r.errors.forEach((l,f)=>{if(Ws(l,Error)){Ty(o,c);const d=e(t,l),u=a.length;Sy(d,`errors[${f}]`,u,c),a=oE(e,t,n,l,s,[d,...a],d,u)}}),a}function Ty(e,t){e.mechanism={handled:!0,type:"auto.core.linked_errors",...e.mechanism,...e.type==="AggregateError"&&{is_exception_group:!0},exception_id:t}}function Sy(e,t,n,r){e.mechanism={handled:!0,...e.mechanism,type:"chained",source:t,exception_id:n,parent_id:r}}const uH="cause",lH=5,dH="LinkedErrors",fH=((e={})=>{const t=e.limit||lH,n=e.key||uH;return{name:dH,preprocessEvent(r,s,i){const o=i.getOptions();cH(Ww,o.stackParser,n,t,r,s)}}}),_H=fH;function pH(e){const t={};let n=0;for(;n<e.length;){const r=e.indexOf("=",n);if(r===-1)break;let s=e.indexOf(";",n);if(s===-1)s=e.length;else if(s<r){n=e.lastIndexOf(";",r-1)+1;continue}const i=e.slice(n,r).trim();if(t[i]===void 0){let o=e.slice(r+1,s).trim();o.charCodeAt(0)===34&&(o=o.slice(1,-1));try{t[i]=o.indexOf("%")!==-1?decodeURIComponent(o):o}catch{t[i]=o}}n=s+1}return t}const zw=["X-Client-IP","X-Forwarded-For","Fly-Client-IP","CF-Connecting-IP","Fastly-Client-Ip","True-Client-Ip","X-Real-IP","X-Cluster-Client-IP","X-Forwarded","Forwarded-For","Forwarded","X-Vercel-Forwarded-For"];function hH(e){return zw.map(s=>{const i=e[s],o=Array.isArray(i)?i.join(";"):i;return s==="Forwarded"?EH(o):o?.split(",").map(c=>c.trim())}).reduce((s,i)=>i?s.concat(i):s,[]).find(s=>s!==null&&TH(s))||null}function EH(e){if(!e)return null;for(const t of e.split(";"))if(t.startsWith("for="))return t.slice(4);return null}function TH(e){return/(?:^(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}$)|(?:^(?:(?:[a-fA-F\d]{1,4}:){7}(?:[a-fA-F\d]{1,4}|:)|(?:[a-fA-F\d]{1,4}:){6}(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|:[a-fA-F\d]{1,4}|:)|(?:[a-fA-F\d]{1,4}:){5}(?::(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,2}|:)|(?:[a-fA-F\d]{1,4}:){4}(?:(?::[a-fA-F\d]{1,4}){0,1}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,3}|:)|(?:[a-fA-F\d]{1,4}:){3}(?:(?::[a-fA-F\d]{1,4}){0,2}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,4}|:)|(?:[a-fA-F\d]{1,4}:){2}(?:(?::[a-fA-F\d]{1,4}){0,3}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,5}|:)|(?:[a-fA-F\d]{1,4}:){1}(?:(?::[a-fA-F\d]{1,4}){0,4}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,6}|:)|(?::(?:(?::[a-fA-F\d]{1,4}){0,5}:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)(?:\\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]\d|\d)){3}|(?::[a-fA-F\d]{1,4}){1,7}|:)))(?:%[0-9a-zA-Z]{1,})?$)/.test(e)}const SH={cookies:!0,data:!0,headers:!0,query_string:!0,url:!0},mH="RequestData",gH=((e={})=>{const t={...SH,...e.include};return{name:mH,processEvent(n,r,s){const{sdkProcessingMetadata:i={}}=n,{normalizedRequest:o,ipAddress:c}=i,a={...t,ip:t.ip??s.getOptions().sendDefaultPii};return o&&RH(n,o,{ipAddress:c},a),n}}}),AH=gH;function RH(e,t,n,r){if(e.request={...e.request,...yH(t,r)},r.ip){const s=t.headers&&hH(t.headers)||n.ipAddress;s&&(e.user={...e.user,ip_address:s})}}function yH(e,t){const n={},r={...e.headers};if(t.headers&&(n.headers=r,t.cookies||delete r.cookie,t.ip||zw.forEach(s=>{delete r[s]})),n.method=e.method,t.url&&(n.url=e.url),t.cookies){const s=e.cookies||(r?.cookie?pH(r.cookie):void 0);n.cookies=s||{}}return t.query_string&&(n.query_string=e.query_string),t.data&&(n.data=e.data),n}function NH(e){const t="console";rT(t,e),sT(t,OH)}function OH(){"console"in Me&&XM.forEach(function(e){e in Me.console&&sG(Me.console,e,function(t){return Sl[e]=t,function(...n){iT("console",{args:n,level:e}),Sl[e]?.apply(Me.console,n)}})})}function bH(e){return e==="warn"?"warning":["fatal","error","warning","log","info","debug"].includes(e)?e:"log"}function IH(e,t){let n=0;for(let r=e.length-1;r>=0;r--){const s=e[r];s==="."?e.splice(r,1):s===".."?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}const CH=/^(\S+:\\|\/?)([\s\S]*?)((?:\.{1,2}|[^/\\]+?|)(\.[^./\\]*|))(?:[/\\]*)$/;function Zw(e){const t=e.length>1024?`<truncated>${e.slice(-1024)}`:e,n=CH.exec(t);return n?n.slice(1):[]}function my(...e){let t="",n=!1;for(let r=e.length-1;r>=-1&&!n;r--){const s=r>=0?e[r]:"/";s&&(t=`${s}/${t}`,n=s.charAt(0)==="/")}return t=IH(t.split("/").filter(r=>!!r),!n).join("/"),(n?"/":"")+t||"."}function gy(e){let t=0;for(;t<e.length&&e[t]==="";t++);let n=e.length-1;for(;n>=0&&e[n]==="";n--);return t>n?[]:e.slice(t,n-t+1)}function vH(e,t){e=my(e).slice(1),t=my(t).slice(1);const n=gy(e.split("/")),r=gy(t.split("/")),s=Math.min(n.length,r.length);let i=s;for(let c=0;c<s;c++)if(n[c]!==r[c]){i=c;break}let o=[];for(let c=i;c<n.length;c++)o.push("..");return o=o.concat(r.slice(i)),o.join("/")}function PH(e){const t=Zw(e),n=t[0]||"";let r=t[1];return!n&&!r?".":(r&&(r=r.slice(0,r.length-1)),n+r)}function MH(e,t){return Zw(e)[2]||""}const wH="RewriteFrames",LH=(e={})=>{const t=e.root,n=e.prefix||"app:///",r="window"in Me&&!!Me.window,s=e.iteratee||DH({isBrowser:r,root:t,prefix:n});function i(c){try{return{...c,exception:{...c.exception,values:c.exception.values.map(a=>({...a,...a.stacktrace&&{stacktrace:o(a.stacktrace)}}))}}}catch{return c}}function o(c){return{...c,frames:c?.frames?.map(a=>s(a))}}return{name:wH,processEvent(c){let a=c;return c.exception&&Array.isArray(c.exception.values)&&(a=i(a)),a}}};function DH({isBrowser:e,root:t,prefix:n}){return r=>{if(!r.filename)return r;const s=/^[a-zA-Z]:\\/.test(r.filename)||r.filename.includes("\\")&&!r.filename.includes("/"),i=/^\//.test(r.filename);if(e){if(t){const o=r.filename;o.indexOf(t)===0&&(r.filename=o.replace(t,n))}}else if(s||i){const o=s?r.filename.replace(/^[a-zA-Z]:/,"").replace(/\\/g,"/"):r.filename,c=t?vH(t,o):MH(o);r.filename=`${n}${c}`}return r}}const UH="Console",kH=(e={})=>{const t=new Set(e.levels||XM);return{name:UH,setup(n){NH(({args:r,level:s})=>{ye()!==n||!t.has(s)||xH(s,r)})}}};function xH(e,t){const n={category:"console",data:{arguments:t,logger:"console"},level:bH(e),message:Ay(t)};if(e==="assert")if(t[0]===!1){const r=t.slice(1);n.message=r.length>0?`Assertion failed: ${Ay(r)}`:"Assertion failed",n.data.arguments=r}else return;Fi(n,{input:t,level:e})}function Ay(e){return"util"in Me&&typeof Me.util.format=="function"?Me.util.format(...e):uG(e," ")}const BH="gen_ai.prompt",gd="gen_ai.system",wt="gen_ai.request.model",yT="gen_ai.request.stream",Ad="gen_ai.request.temperature",NT="gen_ai.request.max_tokens",Rd="gen_ai.request.frequency_penalty",OT="gen_ai.request.presence_penalty",yd="gen_ai.request.top_p",Xw="gen_ai.request.top_k",GH="gen_ai.request.encoding_format",VH="gen_ai.request.dimensions",jr="gen_ai.response.finish_reasons",qn="gen_ai.response.model",eo="gen_ai.response.id",$H="gen_ai.response.stop_reason",sn="gen_ai.usage.input_tokens",on="gen_ai.usage.output_tokens",Qs="gen_ai.usage.total_tokens",Tr="gen_ai.operation.name",Kt="gen_ai.request.messages",an="gen_ai.response.text",Nd="gen_ai.request.available_tools",Od="gen_ai.response.streaming",zn="gen_ai.response.tool_calls",Qw="gen_ai.agent.name",HH="gen_ai.pipeline.name",FH="gen_ai.usage.cache_creation_input_tokens",jH="gen_ai.usage.cache_read_input_tokens",Ry="gen_ai.usage.input_tokens.cache_write",Pc="gen_ai.usage.input_tokens.cached",qH="gen_ai.invoke_agent",YH="openai.response.id",Jw="openai.response.model",WH="openai.response.timestamp",KH="openai.usage.completion_tokens",zH="openai.usage.prompt_tokens",Df={CHAT:"chat",RESPONSES:"responses",EMBEDDINGS:"embeddings"},yy="anthropic.response.timestamp",bT=new Map,e0=2e4,vl=e=>new TextEncoder().encode(e).length,Pl=e=>vl(JSON.stringify(e));function IT(e,t){if(vl(e)<=t)return e;let n=0,r=e.length,s="";for(;n<=r;){const i=Math.floor((n+r)/2),o=e.slice(0,i);vl(o)<=t?(s=o,n=i+1):r=i-1}return s}function ZH(e){return typeof e=="string"?e:e.text}function Ny(e,t){return typeof e=="string"?t:{...e,text:t}}function XH(e){return e!==null&&typeof e=="object"&&"content"in e&&typeof e.content=="string"}function QH(e){return e!==null&&typeof e=="object"&&"parts"in e&&Array.isArray(e.parts)&&e.parts.length>0}function JH(e,t){const n={...e,content:""},r=Pl(n),s=t-r;if(s<=0)return[];const i=IT(e.content,s);return[{...e,content:i}]}function eF(e,t){const{parts:n}=e,r=n.map(c=>Ny(c,"")),s=Pl({...e,parts:r});let i=t-s;if(i<=0)return[];const o=[];for(const c of n){const a=ZH(c),l=vl(a);if(l<=i)o.push(c),i-=l;else if(o.length===0){const f=IT(a,i);f&&o.push(Ny(c,f));break}else break}return o.length>0?[{...e,parts:o}]:[]}function tF(e,t){return!e||typeof e!="object"?[]:XH(e)?JH(e,t):QH(e)?eF(e,t):[]}function nF(e,t){if(!Array.isArray(e)||e.length===0||Pl(e)<=t)return e;const r=e.map(Pl);let s=0,i=e.length;for(let o=e.length-1;o>=0;o--){const c=r[o];if(c&&s+c>t)break;c&&(s+=c),i=o}if(i===e.length){const o=e[e.length-1];return tF(o,t)}return e.slice(i)}function CT(e){return nF(e,e0)}function rF(e){return IT(e,e0)}function Tu(e){return e.includes("messages")?"messages":e.includes("completions")?"completions":e.includes("models")?"models":e.includes("chat")?"chat":e.split(".").pop()||"unknown"}function Ml(e){return`gen_ai.${Tu(e)}`}function t0(e,t){return e?`${e}.${t}`:t}function vT(e,t,n,r,s){if(t!==void 0&&e.setAttributes({[sn]:t}),n!==void 0&&e.setAttributes({[on]:n}),t!==void 0||n!==void 0||r!==void 0||s!==void 0){const i=(t??0)+(n??0)+(r??0)+(s??0);e.setAttributes({[Qs]:i})}}function _r(e){if(typeof e=="string")return rF(e);if(Array.isArray(e)){const t=CT(e);return JSON.stringify(t)}return JSON.stringify(e)}const sF="operation.name",Uf="ai.prompt",iF="ai.schema",oF="ai.response.object",aF="ai.response.text",cF="ai.response.toolCalls",n0="ai.prompt.messages",Va="ai.prompt.tools",kn="ai.model.id",uF="ai.model.provider",lF="ai.response.providerMetadata",dF="ai.usage.cachedInputTokens",fF="ai.telemetry.functionId",_F="ai.usage.completionTokens",pF="ai.usage.promptTokens",r0="ai.toolCall.name",s0="ai.toolCall.id",hF="ai.toolCall.args",EF="ai.toolCall.result";function TF(e,t){const n=e.parent_span_id;if(!n)return;const r=e.data[sn],s=e.data[on];if(typeof r=="number"||typeof s=="number"){const i=t.get(n)||{inputTokens:0,outputTokens:0};typeof r=="number"&&(i.inputTokens+=r),typeof s=="number"&&(i.outputTokens+=s),t.set(n,i)}}function Oy(e,t){const n=t.get(e.span_id);!n||!e.data||(n.inputTokens>0&&(e.data[sn]=n.inputTokens),n.outputTokens>0&&(e.data[on]=n.outputTokens),(n.inputTokens>0||n.outputTokens>0)&&(e.data["gen_ai.usage.total_tokens"]=n.inputTokens+n.outputTokens))}function SF(e){return bT.get(e)}function mF(e){bT.delete(e)}function gF(e){const t=e.map(n=>{if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n});return JSON.stringify(t)}function AF(e){try{const t=JSON.parse(e);if(t&&typeof t=="object"){const{prompt:n,system:r}=t;if(typeof n=="string"||typeof r=="string"){const s=[];return typeof r=="string"&&s.push({role:"system",content:r}),typeof n=="string"&&s.push({role:"user",content:n}),s}}}catch{}return[]}function RF(e,t){if(t[Uf]){const r=_r(t[Uf]);e.setAttribute("gen_ai.prompt",r)}const n=t[Uf];if(typeof n=="string"&&!t[Kt]&&!t[n0]){const r=AF(n);r.length&&e.setAttribute(Kt,_r(r))}}function i0(e,t){e.setAttribute(He,t)}function yF(e){const{data:t,description:n}=ve(e);if(!n)return;if(t[r0]&&t[s0]&&n==="ai.toolCall"){bF(e,t);return}const r=t[kn],s=t[uF];typeof r!="string"||typeof s!="string"||!r||!s||IF(e,n,t)}function NF(e){if(e.type==="transaction"&&e.spans){const t=new Map;for(const r of e.spans)OF(r),TF(r,t);for(const r of e.spans)r.op==="gen_ai.invoke_agent"&&Oy(r,t);const n=e.contexts?.trace;n&&n.op==="gen_ai.invoke_agent"&&Oy(n,t)}return e}function OF(e){const{data:t,origin:n}=e;if(n==="auto.vercelai.otel"){ht(t,_F,on),ht(t,pF,sn),ht(t,dF,Pc),typeof t[on]=="number"&&typeof t[sn]=="number"&&(t["gen_ai.usage.total_tokens"]=t[on]+t[sn]),t[Va]&&Array.isArray(t[Va])&&(t[Va]=gF(t[Va])),ht(t,sF,Tr),ht(t,n0,Kt),ht(t,aF,"gen_ai.response.text"),ht(t,cF,"gen_ai.response.tool_calls"),ht(t,oF,"gen_ai.response.object"),ht(t,Va,"gen_ai.request.available_tools"),ht(t,hF,"gen_ai.tool.input"),ht(t,EF,"gen_ai.tool.output"),ht(t,iF,"gen_ai.request.schema"),ht(t,kn,wt),CF(t);for(const r of Object.keys(t))r.startsWith("ai.")&&ht(t,r,`vercel.${r}`)}}function ht(e,t,n){e[t]!=null&&(e[n]=e[t],delete e[t])}function bF(e,t){i0(e,"auto.vercelai.otel"),e.setAttribute(Re,"gen_ai.execute_tool"),ht(t,r0,"gen_ai.tool.name"),ht(t,s0,"gen_ai.tool.call.id");const n=t["gen_ai.tool.call.id"];typeof n=="string"&&bT.set(n,e),t["gen_ai.tool.type"]||e.setAttribute("gen_ai.tool.type","function");const r=t["gen_ai.tool.name"];r&&e.updateName(`execute_tool ${r}`)}function IF(e,t,n){i0(e,"auto.vercelai.otel");const r=t.replace("ai.","");e.setAttribute("ai.pipeline.name",r),e.updateName(r);const s=n[fF];if(s&&typeof s=="string"&&(e.updateName(`${r} ${s}`),e.setAttribute("gen_ai.function_id",s)),RF(e,n),n[kn]&&!n[qn]&&e.setAttribute(qn,n[kn]),e.setAttribute("ai.streaming",t.includes("stream")),t==="ai.generateText"){e.setAttribute(Re,"gen_ai.invoke_agent");return}if(t==="ai.generateText.doGenerate"){e.setAttribute(Re,"gen_ai.generate_text"),e.updateName(`generate_text ${n[kn]}`);return}if(t==="ai.streamText"){e.setAttribute(Re,"gen_ai.invoke_agent");return}if(t==="ai.streamText.doStream"){e.setAttribute(Re,"gen_ai.stream_text"),e.updateName(`stream_text ${n[kn]}`);return}if(t==="ai.generateObject"){e.setAttribute(Re,"gen_ai.invoke_agent");return}if(t==="ai.generateObject.doGenerate"){e.setAttribute(Re,"gen_ai.generate_object"),e.updateName(`generate_object ${n[kn]}`);return}if(t==="ai.streamObject"){e.setAttribute(Re,"gen_ai.invoke_agent");return}if(t==="ai.streamObject.doStream"){e.setAttribute(Re,"gen_ai.stream_object"),e.updateName(`stream_object ${n[kn]}`);return}if(t==="ai.embed"){e.setAttribute(Re,"gen_ai.invoke_agent");return}if(t==="ai.embed.doEmbed"){e.setAttribute(Re,"gen_ai.embed"),e.updateName(`embed ${n[kn]}`);return}if(t==="ai.embedMany"){e.setAttribute(Re,"gen_ai.invoke_agent");return}if(t==="ai.embedMany.doEmbed"){e.setAttribute(Re,"gen_ai.embed_many"),e.updateName(`embed_many ${n[kn]}`);return}if(t.startsWith("ai.stream")){e.setAttribute(Re,"ai.run");return}}function by(e){e.on("spanStart",yF),e.addEventProcessor(Object.assign(NF,{id:"VercelAiEventProcessor"}))}function CF(e){const t=e[lF];if(t)try{const n=JSON.parse(t);if(n.openai&&(mn(e,Pc,n.openai.cachedPromptTokens),mn(e,"gen_ai.usage.output_tokens.reasoning",n.openai.reasoningTokens),mn(e,"gen_ai.usage.output_tokens.prediction_accepted",n.openai.acceptedPredictionTokens),mn(e,"gen_ai.usage.output_tokens.prediction_rejected",n.openai.rejectedPredictionTokens),mn(e,"gen_ai.conversation.id",n.openai.responseId)),n.anthropic){const r=n.anthropic.usage?.cache_read_input_tokens??n.anthropic.cacheReadInputTokens;mn(e,Pc,r);const s=n.anthropic.usage?.cache_creation_input_tokens??n.anthropic.cacheCreationInputTokens;mn(e,Ry,s)}n.bedrock?.usage&&(mn(e,Pc,n.bedrock.usage.cacheReadInputTokens),mn(e,Ry,n.bedrock.usage.cacheWriteInputTokens)),n.deepseek&&(mn(e,Pc,n.deepseek.promptCacheHitTokens),mn(e,"gen_ai.usage.input_tokens.cache_miss",n.deepseek.promptCacheMissTokens))}catch{}}function mn(e,t,n){n!=null&&(e[t]=n)}const bd="OpenAI",vF=["responses.create","chat.completions.create","embeddings.create"],PF=["response.output_item.added","response.function_call_arguments.delta","response.function_call_arguments.done","response.output_item.done"],MF=["response.created","response.in_progress","response.failed","response.completed","response.incomplete","response.queued","response.output_text.delta",...PF];function PT(e){return e.includes("chat.completions")?Df.CHAT:e.includes("responses")?Df.RESPONSES:e.includes("embeddings")?Df.EMBEDDINGS:e.split(".").pop()||"unknown"}function Iy(e){return`gen_ai.${PT(e)}`}function wF(e){return vF.includes(e)}function LF(e,t){return e?`${e}.${t}`:t}function DF(e){return e!==null&&typeof e=="object"&&"object"in e&&e.object==="chat.completion"}function UF(e){return e!==null&&typeof e=="object"&&"object"in e&&e.object==="response"}function kF(e){if(e===null||typeof e!="object"||!("object"in e))return!1;const t=e;return t.object==="list"&&typeof t.model=="string"&&t.model.toLowerCase().includes("embedding")}function xF(e){return e!==null&&typeof e=="object"&&"type"in e&&typeof e.type=="string"&&e.type.startsWith("response.")}function BF(e){return e!==null&&typeof e=="object"&&"object"in e&&e.object==="chat.completion.chunk"}function GF(e,t,n){if(MT(e,t.id,t.model,t.created),t.usage&&Id(e,t.usage.prompt_tokens,t.usage.completion_tokens,t.usage.total_tokens),Array.isArray(t.choices)){const r=t.choices.map(s=>s.finish_reason).filter(s=>s!==null);if(r.length>0&&e.setAttributes({[jr]:JSON.stringify(r)}),n){const s=t.choices.map(i=>i.message?.tool_calls).filter(i=>Array.isArray(i)&&i.length>0).flat();s.length>0&&e.setAttributes({[zn]:JSON.stringify(s)})}}}function VF(e,t,n){if(MT(e,t.id,t.model,t.created_at),t.status&&e.setAttributes({[jr]:JSON.stringify([t.status])}),t.usage&&Id(e,t.usage.input_tokens,t.usage.output_tokens,t.usage.total_tokens),n){const r=t;if(Array.isArray(r.output)&&r.output.length>0){const s=r.output.filter(i=>typeof i=="object"&&i!==null&&i.type==="function_call");s.length>0&&e.setAttributes({[zn]:JSON.stringify(s)})}}}function $F(e,t){e.setAttributes({[Jw]:t.model,[qn]:t.model}),t.usage&&Id(e,t.usage.prompt_tokens,void 0,t.usage.total_tokens)}function Id(e,t,n,r){t!==void 0&&e.setAttributes({[zH]:t,[sn]:t}),n!==void 0&&e.setAttributes({[KH]:n,[on]:n}),r!==void 0&&e.setAttributes({[Qs]:r})}function MT(e,t,n,r){e.setAttributes({[YH]:t,[eo]:t}),e.setAttributes({[Jw]:n,[qn]:n}),e.setAttributes({[WH]:new Date(r*1e3).toISOString()})}function HF(e,t){for(const n of e){const r=n.index;if(!(r===void 0||!n.function))if(!(r in t.chatCompletionToolCalls))t.chatCompletionToolCalls[r]={...n,function:{name:n.function.name,arguments:n.function.arguments||""}};else{const s=t.chatCompletionToolCalls[r];n.function.arguments&&s?.function&&(s.function.arguments+=n.function.arguments)}}}function FF(e,t,n){t.responseId=e.id??t.responseId,t.responseModel=e.model??t.responseModel,t.responseTimestamp=e.created??t.responseTimestamp,e.usage&&(t.promptTokens=e.usage.prompt_tokens,t.completionTokens=e.usage.completion_tokens,t.totalTokens=e.usage.total_tokens);for(const r of e.choices??[])n&&(r.delta?.content&&t.responseTexts.push(r.delta.content),r.delta?.tool_calls&&HF(r.delta.tool_calls,t)),r.finish_reason&&t.finishReasons.push(r.finish_reason)}function jF(e,t,n,r){if(!(e&&typeof e=="object")){t.eventTypes.push("unknown:non-object");return}if(e instanceof Error){r.setStatus({code:be,message:"internal_error"}),Ye(e,{mechanism:{handled:!1,type:"auto.ai.openai.stream-response"}});return}if(!("type"in e))return;const s=e;if(!MF.includes(s.type)){t.eventTypes.push(s.type);return}if(n&&(s.type==="response.output_item.done"&&"item"in s&&t.responsesApiToolCalls.push(s.item),s.type==="response.output_text.delta"&&"delta"in s&&s.delta)){t.responseTexts.push(s.delta);return}if("response"in s){const{response:i}=s;t.responseId=i.id??t.responseId,t.responseModel=i.model??t.responseModel,t.responseTimestamp=i.created_at??t.responseTimestamp,i.usage&&(t.promptTokens=i.usage.input_tokens,t.completionTokens=i.usage.output_tokens,t.totalTokens=i.usage.total_tokens),i.status&&t.finishReasons.push(i.status),n&&i.output_text&&t.responseTexts.push(i.output_text)}}async function*qF(e,t,n){const r={eventTypes:[],responseTexts:[],finishReasons:[],responseId:"",responseModel:"",responseTimestamp:0,promptTokens:void 0,completionTokens:void 0,totalTokens:void 0,chatCompletionToolCalls:{},responsesApiToolCalls:[]};try{for await(const s of e)BF(s)?FF(s,r,n):xF(s)&&jF(s,r,n,t),yield s}finally{MT(t,r.responseId,r.responseModel,r.responseTimestamp),Id(t,r.promptTokens,r.completionTokens,r.totalTokens),t.setAttributes({[Od]:!0}),r.finishReasons.length&&t.setAttributes({[jr]:JSON.stringify(r.finishReasons)}),n&&r.responseTexts.length&&t.setAttributes({[an]:r.responseTexts.join("")});const i=[...Object.values(r.chatCompletionToolCalls),...r.responsesApiToolCalls];i.length>0&&t.setAttributes({[zn]:JSON.stringify(i)}),t.end()}}function YF(e,t){const n={[gd]:"openai",[Tr]:PT(t),[He]:"auto.ai.openai"};if(e.length>0&&typeof e[0]=="object"&&e[0]!==null){const r=e[0],s=Array.isArray(r.tools)?r.tools:[],o=r.web_search_options&&typeof r.web_search_options=="object"?[{type:"web_search_options",...r.web_search_options}]:[],c=[...s,...o];c.length>0&&(n[Nd]=JSON.stringify(c))}if(e.length>0&&typeof e[0]=="object"&&e[0]!==null){const r=e[0];n[wt]=r.model??"unknown","temperature"in r&&(n[Ad]=r.temperature),"top_p"in r&&(n[yd]=r.top_p),"frequency_penalty"in r&&(n[Rd]=r.frequency_penalty),"presence_penalty"in r&&(n[OT]=r.presence_penalty),"stream"in r&&(n[yT]=r.stream),"encoding_format"in r&&(n[GH]=r.encoding_format),"dimensions"in r&&(n[VH]=r.dimensions)}else n[wt]="unknown";return n}function WF(e,t,n){if(!t||typeof t!="object")return;const r=t;if(DF(r)){if(GF(e,r,n),n&&r.choices?.length){const s=r.choices.map(i=>i.message?.content||"");e.setAttributes({[an]:JSON.stringify(s)})}}else UF(r)?(VF(e,r,n),n&&r.output_text&&e.setAttributes({[an]:r.output_text})):kF(r)&&$F(e,r)}function Cy(e,t){if("messages"in t){const n=_r(t.messages);e.setAttributes({[Kt]:n})}if("input"in t){const n=_r(t.input);e.setAttributes({[Kt]:n})}}function KF(e,t,n,r){return async function(...i){const o=YF(i,t),c=o[wt]||"unknown",a=PT(t),l=i[0];return l&&typeof l=="object"&&l.stream===!0?fr({name:`${a} ${c} stream-response`,op:Iy(t),attributes:o},async d=>{try{r.recordInputs&&l&&Cy(d,l);const u=await e.apply(n,i);return qF(u,d,r.recordOutputs??!1)}catch(u){throw d.setStatus({code:be,message:"internal_error"}),Ye(u,{mechanism:{handled:!1,type:"auto.ai.openai.stream",data:{function:t}}}),d.end(),u}}):Ji({name:`${a} ${c}`,op:Iy(t),attributes:o},async d=>{try{r.recordInputs&&l&&Cy(d,l);const u=await e.apply(n,i);return WF(d,u,r.recordOutputs),u}catch(u){throw Ye(u,{mechanism:{handled:!1,type:"auto.ai.openai",data:{function:t}}}),u}})}}function o0(e,t="",n){return new Proxy(e,{get(r,s){const i=r[s],o=LF(t,String(s));return typeof i=="function"&&wF(o)?KF(i,o,r,n):typeof i=="function"?i.bind(r):i&&typeof i=="object"?o0(i,o,n):i}})}function zF(e,t){const n=!!ye()?.getOptions().sendDefaultPii,r={recordInputs:n,recordOutputs:n,...t};return o0(e,"",r)}function ZF(e,t){return"type"in e&&typeof e.type=="string"&&e.type==="error"?(t.setStatus({code:be,message:e.error?.type??"internal_error"}),Ye(e.error,{mechanism:{handled:!1,type:"auto.ai.anthropic.anthropic_error"}}),!0):!1}function XF(e,t){if(e.type==="message_delta"&&e.usage&&"output_tokens"in e.usage&&typeof e.usage.output_tokens=="number"&&(t.completionTokens=e.usage.output_tokens),e.message){const n=e.message;n.id&&(t.responseId=n.id),n.model&&(t.responseModel=n.model),n.stop_reason&&t.finishReasons.push(n.stop_reason),n.usage&&(typeof n.usage.input_tokens=="number"&&(t.promptTokens=n.usage.input_tokens),typeof n.usage.cache_creation_input_tokens=="number"&&(t.cacheCreationInputTokens=n.usage.cache_creation_input_tokens),typeof n.usage.cache_read_input_tokens=="number"&&(t.cacheReadInputTokens=n.usage.cache_read_input_tokens))}}function QF(e,t){e.type!=="content_block_start"||typeof e.index!="number"||!e.content_block||(e.content_block.type==="tool_use"||e.content_block.type==="server_tool_use")&&(t.activeToolBlocks[e.index]={id:e.content_block.id,name:e.content_block.name,inputJsonParts:[]})}function JF(e,t,n){if(!(e.type!=="content_block_delta"||!e.delta)){if(typeof e.index=="number"&&"partial_json"in e.delta&&typeof e.delta.partial_json=="string"){const r=t.activeToolBlocks[e.index];r&&r.inputJsonParts.push(e.delta.partial_json)}n&&typeof e.delta.text=="string"&&t.responseTexts.push(e.delta.text)}}function ej(e,t){if(e.type!=="content_block_stop"||typeof e.index!="number")return;const n=t.activeToolBlocks[e.index];if(!n)return;const r=n.inputJsonParts.join("");let s;try{s=r?JSON.parse(r):{}}catch{s={__unparsed:r}}t.toolCalls.push({type:"tool_use",id:n.id,name:n.name,input:s}),delete t.activeToolBlocks[e.index]}function a0(e,t,n,r){!(e&&typeof e=="object")||ZF(e,r)||(XF(e,t),QF(e,t),JF(e,t,n),ej(e,t))}function tj(e,t,n){t.isRecording()&&(e.responseId&&t.setAttributes({[eo]:e.responseId}),e.responseModel&&t.setAttributes({[qn]:e.responseModel}),vT(t,e.promptTokens,e.completionTokens,e.cacheCreationInputTokens,e.cacheReadInputTokens),t.setAttributes({[Od]:!0}),e.finishReasons.length>0&&t.setAttributes({[jr]:JSON.stringify(e.finishReasons)}),n&&e.responseTexts.length>0&&t.setAttributes({[an]:e.responseTexts.join("")}),n&&e.toolCalls.length>0&&t.setAttributes({[zn]:JSON.stringify(e.toolCalls)}),t.end())}async function*nj(e,t,n){const r={responseTexts:[],finishReasons:[],responseId:"",responseModel:"",promptTokens:void 0,completionTokens:void 0,cacheCreationInputTokens:void 0,cacheReadInputTokens:void 0,toolCalls:[],activeToolBlocks:{}};try{for await(const s of e)a0(s,r,n,t),yield s}finally{r.responseId&&t.setAttributes({[eo]:r.responseId}),r.responseModel&&t.setAttributes({[qn]:r.responseModel}),vT(t,r.promptTokens,r.completionTokens,r.cacheCreationInputTokens,r.cacheReadInputTokens),t.setAttributes({[Od]:!0}),r.finishReasons.length>0&&t.setAttributes({[jr]:JSON.stringify(r.finishReasons)}),n&&r.responseTexts.length>0&&t.setAttributes({[an]:r.responseTexts.join("")}),n&&r.toolCalls.length>0&&t.setAttributes({[zn]:JSON.stringify(r.toolCalls)}),t.end()}}function rj(e,t,n){const r={responseTexts:[],finishReasons:[],responseId:"",responseModel:"",promptTokens:void 0,completionTokens:void 0,cacheCreationInputTokens:void 0,cacheReadInputTokens:void 0,toolCalls:[],activeToolBlocks:{}};return e.on("streamEvent",s=>{a0(s,r,n,t)}),e.on("message",()=>{tj(r,t,n)}),e.on("error",s=>{Ye(s,{mechanism:{handled:!1,type:"auto.ai.anthropic.stream_error"}}),t.isRecording()&&(t.setStatus({code:be,message:"stream_error"}),t.end())}),e}const Cd="Anthropic_AI",sj=["messages.create","messages.stream","messages.countTokens","models.get","completions.create","models.retrieve","beta.messages.create"];function ij(e){return sj.includes(e)}function oj(e,t){t.error&&(e.setStatus({code:be,message:t.error.type||"internal_error"}),Ye(t.error,{mechanism:{handled:!1,type:"auto.ai.anthropic.anthropic_error"}}))}function aj(e){const{system:t,messages:n}=e,r=typeof t=="string"?[{role:"system",content:e.system}]:[],s=Array.isArray(n)?n:n!=null?[n]:[];return[...r,...s]}function cj(e,t){const n={[gd]:"anthropic",[Tr]:Tu(t),[He]:"auto.ai.anthropic"};if(e.length>0&&typeof e[0]=="object"&&e[0]!==null){const r=e[0];r.tools&&Array.isArray(r.tools)&&(n[Nd]=JSON.stringify(r.tools)),n[wt]=r.model??"unknown","temperature"in r&&(n[Ad]=r.temperature),"top_p"in r&&(n[yd]=r.top_p),"stream"in r&&(n[yT]=r.stream),"top_k"in r&&(n[Xw]=r.top_k),"frequency_penalty"in r&&(n[Rd]=r.frequency_penalty),"max_tokens"in r&&(n[NT]=r.max_tokens)}else t==="models.retrieve"||t==="models.get"?n[wt]=e[0]:n[wt]="unknown";return n}function aE(e,t){const n=aj(t);if(n.length){const r=_r(n);e.setAttributes({[Kt]:r})}if("input"in t){const r=_r(t.input);e.setAttributes({[Kt]:r})}"prompt"in t&&e.setAttributes({[BH]:JSON.stringify(t.prompt)})}function uj(e,t){if("content"in t&&Array.isArray(t.content)){e.setAttributes({[an]:t.content.map(r=>r.text).filter(r=>!!r).join("")});const n=[];for(const r of t.content)(r.type==="tool_use"||r.type==="server_tool_use")&&n.push(r);n.length>0&&e.setAttributes({[zn]:JSON.stringify(n)})}"completion"in t&&e.setAttributes({[an]:t.completion}),"input_tokens"in t&&e.setAttributes({[an]:JSON.stringify(t.input_tokens)})}function lj(e,t){"id"in t&&"model"in t&&(e.setAttributes({[eo]:t.id,[qn]:t.model}),"created"in t&&typeof t.created=="number"&&e.setAttributes({[yy]:new Date(t.created*1e3).toISOString()}),"created_at"in t&&typeof t.created_at=="number"&&e.setAttributes({[yy]:new Date(t.created_at*1e3).toISOString()}),"usage"in t&&t.usage&&vT(e,t.usage.input_tokens,t.usage.output_tokens,t.usage.cache_creation_input_tokens,t.usage.cache_read_input_tokens))}function dj(e,t,n){if(!(!t||typeof t!="object")){if("type"in t&&t.type==="error"){oj(e,t);return}n&&uj(e,t),lj(e,t)}}function vy(e,t,n){throw Ye(e,{mechanism:{handled:!1,type:"auto.ai.anthropic",data:{function:n}}}),t.isRecording()&&(t.setStatus({code:be,message:"internal_error"}),t.end()),e}function fj(e,t,n,r,s,i,o,c,a,l,f){const d=s[wt]??"unknown",u={name:`${i} ${d} stream-response`,op:Ml(o),attributes:s};return l&&!f?fr(u,async _=>{try{a.recordInputs&&c&&aE(_,c);const p=await e.apply(n,r);return nj(p,_,a.recordOutputs??!1)}catch(p){return vy(p,_,o)}}):fr(u,_=>{try{a.recordInputs&&c&&aE(_,c);const p=t.apply(n,r);return rj(p,_,a.recordOutputs??!1)}catch(p){return vy(p,_,o)}})}function _j(e,t,n,r){return new Proxy(e,{apply(s,i,o){const c=cj(o,t),a=c[wt]??"unknown",l=Tu(t),f=typeof o[0]=="object"?o[0]:void 0,d=!!f?.stream,u=t==="messages.stream";return d||u?fj(e,s,n,o,c,l,t,f,r,d,u):Ji({name:`${l} ${a}`,op:Ml(t),attributes:c},_=>(r.recordInputs&&f&&aE(_,f),Xs(()=>s.apply(n,o),p=>{Ye(p,{mechanism:{handled:!1,type:"auto.ai.anthropic",data:{function:t}}})},()=>{},p=>dj(_,p,r.recordOutputs))))}})}function c0(e,t="",n){return new Proxy(e,{get(r,s){const i=r[s],o=t0(t,String(s));return typeof i=="function"&&ij(o)?_j(i,o,r,n):typeof i=="function"?i.bind(r):i&&typeof i=="object"?c0(i,o,n):i}})}function pj(e,t){const n=!!ye()?.getOptions().sendDefaultPii,r={recordInputs:n,recordOutputs:n,...t};return c0(e,"",r)}const vd="Google_GenAI",Py=["models.generateContent","models.generateContentStream","chats.create","sendMessage","sendMessageStream"],hj="google_genai",u0="chats.create",Ej="chat";function Tj(e,t){const n=e?.promptFeedback;if(n?.blockReason){const r=n.blockReasonMessage??n.blockReason;return t.setStatus({code:be,message:`Content blocked: ${r}`}),Ye(`Content blocked: ${r}`,{mechanism:{handled:!1,type:"auto.ai.google_genai"}}),!0}return!1}function Sj(e,t){typeof e.responseId=="string"&&(t.responseId=e.responseId),typeof e.modelVersion=="string"&&(t.responseModel=e.modelVersion);const n=e.usageMetadata;n&&(typeof n.promptTokenCount=="number"&&(t.promptTokens=n.promptTokenCount),typeof n.candidatesTokenCount=="number"&&(t.completionTokens=n.candidatesTokenCount),typeof n.totalTokenCount=="number"&&(t.totalTokens=n.totalTokenCount))}function mj(e,t,n){Array.isArray(e.functionCalls)&&t.toolCalls.push(...e.functionCalls);for(const r of e.candidates??[]){r?.finishReason&&!t.finishReasons.includes(r.finishReason)&&t.finishReasons.push(r.finishReason);for(const s of r?.content?.parts??[])n&&s.text&&t.responseTexts.push(s.text),s.functionCall&&t.toolCalls.push({type:"function",id:s.functionCall.id,name:s.functionCall.name,arguments:s.functionCall.args})}}function gj(e,t,n,r){!e||Tj(e,r)||(Sj(e,t),mj(e,t,n))}async function*Aj(e,t,n){const r={responseTexts:[],finishReasons:[],toolCalls:[]};try{for await(const s of e)gj(s,r,n,t),yield s}finally{const s={[Od]:!0};r.responseId&&(s[eo]=r.responseId),r.responseModel&&(s[qn]=r.responseModel),r.promptTokens!==void 0&&(s[sn]=r.promptTokens),r.completionTokens!==void 0&&(s[on]=r.completionTokens),r.totalTokens!==void 0&&(s[Qs]=r.totalTokens),r.finishReasons.length&&(s[jr]=JSON.stringify(r.finishReasons)),n&&r.responseTexts.length&&(s[an]=r.responseTexts.join("")),n&&r.toolCalls.length&&(s[zn]=JSON.stringify(r.toolCalls)),t.setAttributes(s),t.end()}}function Rj(e){if(Py.includes(e))return!0;const t=e.split(".").pop();return Py.includes(t)}function yj(e){return e.includes("Stream")||e.endsWith("generateContentStream")||e.endsWith("sendMessageStream")}function My(e,t){if("model"in e&&typeof e.model=="string")return e.model;if(t&&typeof t=="object"){const n=t;if("model"in n&&typeof n.model=="string")return n.model;if("modelVersion"in n&&typeof n.modelVersion=="string")return n.modelVersion}return"unknown"}function Nj(e){const t={};return"temperature"in e&&typeof e.temperature=="number"&&(t[Ad]=e.temperature),"topP"in e&&typeof e.topP=="number"&&(t[yd]=e.topP),"topK"in e&&typeof e.topK=="number"&&(t[Xw]=e.topK),"maxOutputTokens"in e&&typeof e.maxOutputTokens=="number"&&(t[NT]=e.maxOutputTokens),"frequencyPenalty"in e&&typeof e.frequencyPenalty=="number"&&(t[Rd]=e.frequencyPenalty),"presencePenalty"in e&&typeof e.presencePenalty=="number"&&(t[OT]=e.presencePenalty),t}function Oj(e,t,n){const r={[gd]:hj,[Tr]:Tu(e),[He]:"auto.ai.google_genai"};if(t){if(r[wt]=My(t,n),"config"in t&&typeof t.config=="object"&&t.config){const s=t.config;if(Object.assign(r,Nj(s)),"tools"in s&&Array.isArray(s.tools)){const i=s.tools.flatMap(o=>o.functionDeclarations);r[Nd]=JSON.stringify(i)}}}else r[wt]=My({},n);return r}function wy(e,t){if("contents"in t){const n=t.contents,r=_r(n);e.setAttributes({[Kt]:r})}if("message"in t){const n=t.message,r=_r(n);e.setAttributes({[Kt]:r})}if("history"in t){const n=t.history,r=_r(n);e.setAttributes({[Kt]:r})}}function bj(e,t,n){if(!(!t||typeof t!="object")){if(t.usageMetadata&&typeof t.usageMetadata=="object"){const r=t.usageMetadata;typeof r.promptTokenCount=="number"&&e.setAttributes({[sn]:r.promptTokenCount}),typeof r.candidatesTokenCount=="number"&&e.setAttributes({[on]:r.candidatesTokenCount}),typeof r.totalTokenCount=="number"&&e.setAttributes({[Qs]:r.totalTokenCount})}if(n&&Array.isArray(t.candidates)&&t.candidates.length>0){const r=t.candidates.map(s=>s.content?.parts&&Array.isArray(s.content.parts)?s.content.parts.map(i=>typeof i.text=="string"?i.text:"").filter(i=>i.length>0).join(""):"").filter(s=>s.length>0);r.length>0&&e.setAttributes({[an]:r.join("")})}if(n&&t.functionCalls){const r=t.functionCalls;Array.isArray(r)&&r.length>0&&e.setAttributes({[zn]:JSON.stringify(r)})}}}function Ly(e,t,n,r){const s=t===u0;return new Proxy(e,{apply(i,o,c){const a=c[0],l=Oj(t,a,n),f=l[wt]??"unknown",d=Tu(t);return yj(t)?fr({name:`${d} ${f} stream-response`,op:Ml(t),attributes:l},async u=>{try{r.recordInputs&&a&&wy(u,a);const _=await i.apply(n,c);return Aj(_,u,!!r.recordOutputs)}catch(_){throw u.setStatus({code:be,message:"internal_error"}),Ye(_,{mechanism:{handled:!1,type:"auto.ai.google_genai",data:{function:t}}}),u.end(),_}}):Ji({name:s?`${d} ${f} create`:`${d} ${f}`,op:Ml(t),attributes:l},u=>(r.recordInputs&&a&&wy(u,a),Xs(()=>i.apply(n,c),_=>{Ye(_,{mechanism:{handled:!1,type:"auto.ai.google_genai",data:{function:t}}})},()=>{},_=>{s||bj(u,_,r.recordOutputs)})))}})}function cE(e,t="",n){return new Proxy(e,{get:(r,s,i)=>{const o=Reflect.get(r,s,i),c=t0(t,String(s));if(typeof o=="function"&&Rj(c)){if(c===u0){const a=Ly(o,c,r,n);return function(...f){const d=a(...f);return d&&typeof d=="object"?cE(d,Ej,n):d}}return Ly(o,c,r,n)}return typeof o=="function"?o.bind(r):o&&typeof o=="object"?cE(o,c,n):o}})}function Ij(e,t){const n=!!ye()?.getOptions().sendDefaultPii,r={recordInputs:n,recordOutputs:n,...t};return cE(e,"",r)}const l0="LangChain",Mc="auto.ai.langchain",Cj={human:"user",ai:"assistant",assistant:"assistant",system:"system",function:"function",tool:"tool"},lr=(e,t,n)=>{n!=null&&(e[t]=n)},Ft=(e,t,n)=>{const r=Number(n);Number.isNaN(r)||(e[t]=r)};function Bt(e){if(typeof e=="string")return e;try{return JSON.stringify(e)}catch{return String(e)}}function $a(e){const t=e.toLowerCase();return Cj[t]??t}function Dy(e){return e.includes("System")?"system":e.includes("Human")?"user":e.includes("AI")||e.includes("Assistant")?"assistant":e.includes("Function")?"function":e.includes("Tool")?"tool":"user"}function Uy(e){if(!(!e||Array.isArray(e)))return e.invocation_params}function wT(e){return e.map(t=>{const n=t._getType;if(typeof n=="function"){const s=n.call(t);return{role:$a(s),content:Bt(t.content)}}const r=t.constructor?.name;if(r)return{role:$a(Dy(r)),content:Bt(t.content)};if(t.type){const s=String(t.type).toLowerCase();return{role:$a(s),content:Bt(t.content)}}if(t.role)return{role:$a(String(t.role)),content:Bt(t.content)};if(t.lc===1&&t.kwargs){const s=t.id,i=Array.isArray(s)&&s.length>0?s[s.length-1]:"",o=typeof i=="string"?Dy(i):"user";return{role:$a(o),content:Bt(t.kwargs?.content)}}return{role:"user",content:Bt(t.content)}})}function vj(e,t,n){const r={},s="kwargs"in e?e.kwargs:void 0,i=t?.temperature??n?.ls_temperature??s?.temperature;Ft(r,Ad,i);const o=t?.max_tokens??n?.ls_max_tokens??s?.max_tokens;Ft(r,NT,o);const c=t?.top_p??s?.top_p;Ft(r,yd,c);const a=t?.frequency_penalty;Ft(r,Rd,a);const l=t?.presence_penalty;return Ft(r,OT,l),t&&"stream"in t&&lr(r,yT,!!t.stream),r}function d0(e,t,n,r,s,i){return{[gd]:Bt(e??"langchain"),[Tr]:n,[wt]:Bt(t),[He]:Mc,...vj(r,s,i)}}function Pj(e,t,n,r,s){const i=s?.ls_provider,o=r?.model??s?.ls_model_name??"unknown",c=d0(i,o,"pipeline",e,r,s);if(n&&Array.isArray(t)&&t.length>0){const a=t.map(l=>({role:"user",content:l}));lr(c,Kt,Bt(a))}return c}function Mj(e,t,n,r,s){const i=s?.ls_provider??e.id?.[2],o=r?.model??s?.ls_model_name??"unknown",c=d0(i,o,"chat",e,r,s);if(n&&Array.isArray(t)&&t.length>0){const a=wT(t.flat()),l=CT(a);lr(c,Kt,Bt(l))}return c}function wj(e,t){const n=[],r=e.flat();for(const s of r){const i=s.message?.content;if(Array.isArray(i))for(const o of i){const c=o;c.type==="tool_use"&&n.push(c)}}n.length>0&&lr(t,zn,Bt(n))}function Lj(e,t){if(!e)return;const n=e.tokenUsage,r=e.usage;if(n)Ft(t,sn,n.promptTokens),Ft(t,on,n.completionTokens),Ft(t,Qs,n.totalTokens);else if(r){Ft(t,sn,r.input_tokens),Ft(t,on,r.output_tokens);const s=Number(r.input_tokens),i=Number(r.output_tokens),o=(Number.isNaN(s)?0:s)+(Number.isNaN(i)?0:i);o>0&&Ft(t,Qs,o),r.cache_creation_input_tokens!==void 0&&Ft(t,FH,r.cache_creation_input_tokens),r.cache_read_input_tokens!==void 0&&Ft(t,jH,r.cache_read_input_tokens)}}function Dj(e,t){if(!e)return;const n={};if(Array.isArray(e.generations)){const l=e.generations.flat().map(f=>f.generationInfo?.finish_reason?f.generationInfo.finish_reason:f.generation_info?.finish_reason?f.generation_info.finish_reason:null).filter(f=>typeof f=="string");if(l.length>0&&lr(n,jr,Bt(l)),wj(e.generations,n),t){const f=e.generations.flat().map(d=>d.text??d.message?.content).filter(d=>typeof d=="string");f.length>0&&lr(n,an,Bt(f))}}Lj(e.llmOutput,n);const r=e.llmOutput,i=e.generations?.[0]?.[0]?.message,o=r?.model_name??r?.model??i?.response_metadata?.model_name;o&&lr(n,qn,o);const c=r?.id??i?.id;c&&lr(n,eo,c);const a=r?.stop_reason??i?.response_metadata?.finish_reason;return a&&lr(n,$H,Bt(a)),n}function Uj(e={}){const t=e.recordInputs??!1,n=e.recordOutputs??!1,r=new Map,s=o=>{const c=r.get(o);c?.isRecording()&&(c.end(),r.delete(o))},i={lc_serializable:!1,lc_namespace:["langchain_core","callbacks","sentry"],lc_secrets:void 0,lc_attributes:void 0,lc_aliases:void 0,lc_serializable_keys:void 0,lc_id:["langchain_core","callbacks","sentry"],lc_kwargs:{},name:"SentryCallbackHandler",ignoreLLM:!1,ignoreChain:!1,ignoreAgent:!1,ignoreRetriever:!1,ignoreCustomEvent:!1,raiseError:!1,awaitHandlers:!0,handleLLMStart(o,c,a,l,f,d,u,_){const p=Uy(d),h=Pj(o,c,t,p,u),E=h[wt],T=h[Tr];fr({name:`${T} ${E}`,op:"gen_ai.pipeline",attributes:{...h,[Re]:"gen_ai.pipeline"}},S=>(r.set(a,S),S))},handleChatModelStart(o,c,a,l,f,d,u,_){const p=Uy(d),h=Mj(o,c,t,p,u),E=h[wt],T=h[Tr];fr({name:`${T} ${E}`,op:"gen_ai.chat",attributes:{...h,[Re]:"gen_ai.chat"}},S=>(r.set(a,S),S))},handleLLMEnd(o,c,a,l,f){const d=r.get(c);if(d?.isRecording()){const u=Dj(o,n);u&&d.setAttributes(u),s(c)}},handleLLMError(o,c){const a=r.get(c);a?.isRecording()&&(a.setStatus({code:be,message:"llm_error"}),s(c)),Ye(o,{mechanism:{handled:!1,type:`${Mc}.llm_error_handler`}})},handleChainStart(o,c,a,l){const f=o.name||"unknown_chain",d={[He]:"auto.ai.langchain","langchain.chain.name":f};t&&(d["langchain.chain.inputs"]=JSON.stringify(c)),fr({name:`chain ${f}`,op:"gen_ai.invoke_agent",attributes:{...d,[Re]:"gen_ai.invoke_agent"}},u=>(r.set(a,u),u))},handleChainEnd(o,c){const a=r.get(c);a?.isRecording()&&(n&&a.setAttributes({"langchain.chain.outputs":JSON.stringify(o)}),s(c))},handleChainError(o,c){const a=r.get(c);a?.isRecording()&&(a.setStatus({code:be,message:"chain_error"}),s(c)),Ye(o,{mechanism:{handled:!1,type:`${Mc}.chain_error_handler`}})},handleToolStart(o,c,a,l){const f=o.name||"unknown_tool",d={[He]:Mc,"gen_ai.tool.name":f};t&&(d["gen_ai.tool.input"]=c),fr({name:`execute_tool ${f}`,op:"gen_ai.execute_tool",attributes:{...d,[Re]:"gen_ai.execute_tool"}},u=>(r.set(a,u),u))},handleToolEnd(o,c){const a=r.get(c);a?.isRecording()&&(n&&a.setAttributes({"gen_ai.tool.output":JSON.stringify(o)}),s(c))},handleToolError(o,c){const a=r.get(c);a?.isRecording()&&(a.setStatus({code:be,message:"tool_error"}),s(c)),Ye(o,{mechanism:{handled:!1,type:`${Mc}.tool_error_handler`}})},copy(){return i},toJSON(){return{lc:1,type:"not_implemented",id:i.lc_id}},toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:i.lc_id}}};return i}const f0="LangGraph",_0="auto.ai.langgraph";function kj(e){if(!e||e.length===0)return null;const t=[];for(const n of e)if(n&&typeof n=="object"){const r=n.tool_calls;r&&Array.isArray(r)&&t.push(...r)}return t.length>0?t:null}function xj(e){const t=e;let n=0,r=0,s=0;if(t.usage_metadata&&typeof t.usage_metadata=="object"){const i=t.usage_metadata;return typeof i.input_tokens=="number"&&(n=i.input_tokens),typeof i.output_tokens=="number"&&(r=i.output_tokens),typeof i.total_tokens=="number"&&(s=i.total_tokens),{inputTokens:n,outputTokens:r,totalTokens:s}}if(t.response_metadata&&typeof t.response_metadata=="object"){const i=t.response_metadata;if(i.tokenUsage&&typeof i.tokenUsage=="object"){const o=i.tokenUsage;typeof o.promptTokens=="number"&&(n=o.promptTokens),typeof o.completionTokens=="number"&&(r=o.completionTokens),typeof o.totalTokens=="number"&&(s=o.totalTokens)}}return{inputTokens:n,outputTokens:r,totalTokens:s}}function Bj(e,t){const n=t;if(n.response_metadata&&typeof n.response_metadata=="object"){const r=n.response_metadata;r.model_name&&typeof r.model_name=="string"&&e.setAttribute(qn,r.model_name),r.finish_reason&&typeof r.finish_reason=="string"&&e.setAttribute(jr,[r.finish_reason])}}function Gj(e){if(!e.builder?.nodes?.tools?.runnable?.tools)return null;const t=e.builder?.nodes?.tools?.runnable?.tools;return!t||!Array.isArray(t)||t.length===0?null:t.map(n=>({name:n.lc_kwargs?.name,description:n.lc_kwargs?.description,schema:n.lc_kwargs?.schema}))}function Vj(e,t,n){const s=n?.messages;if(!s||!Array.isArray(s))return;const i=t?.length??0,o=s.length>i?s.slice(i):[];if(o.length===0)return;const c=kj(o);c&&e.setAttribute(zn,JSON.stringify(c));const a=wT(o);e.setAttribute(an,JSON.stringify(a));let l=0,f=0,d=0;for(const u of o){const _=xj(u);l+=_.inputTokens,f+=_.outputTokens,d+=_.totalTokens,Bj(e,u)}l>0&&e.setAttribute(sn,l),f>0&&e.setAttribute(on,f),d>0&&e.setAttribute(Qs,d)}function $j(e,t){return new Proxy(e,{apply(n,r,s){return Ji({op:"gen_ai.create_agent",name:"create_agent",attributes:{[He]:_0,[Re]:"gen_ai.create_agent",[Tr]:"create_agent"}},i=>{try{const o=Reflect.apply(n,r,s),c=s.length>0?s[0]:{};c?.name&&typeof c.name=="string"&&(i.setAttribute(Qw,c.name),i.updateName(`create_agent ${c.name}`));const a=o.invoke;return a&&typeof a=="function"&&(o.invoke=Hj(a.bind(o),o,c,t)),o}catch(o){throw i.setStatus({code:be,message:"internal_error"}),Ye(o,{mechanism:{handled:!1,type:"auto.ai.langgraph.error"}}),o}})}})}function Hj(e,t,n,r){return new Proxy(e,{apply(s,i,o){return Ji({op:"gen_ai.invoke_agent",name:"invoke_agent",attributes:{[He]:_0,[Re]:qH,[Tr]:"invoke_agent"}},async c=>{try{const a=n?.name;a&&typeof a=="string"&&(c.setAttribute(HH,a),c.setAttribute(Qw,a),c.updateName(`invoke_agent ${a}`));const l=Gj(t);l&&c.setAttribute(Nd,JSON.stringify(l));const f=r.recordInputs,d=r.recordOutputs,u=o.length>0?o[0].messages??[]:[];if(u&&f){const p=wT(u),h=CT(p);c.setAttribute(Kt,JSON.stringify(h))}const _=await Reflect.apply(s,i,o);return d&&Vj(c,u??null,_),_}catch(a){throw c.setStatus({code:be,message:"internal_error"}),Ye(a,{mechanism:{handled:!1,type:"auto.ai.langgraph.error"}}),a}})}})}function p0(e){if(e!==void 0)return e>=400&&e<500?"warning":e>=500?"error":void 0}function Fj(e,t,n){const r=e[t];if(typeof r=="function"){try{e[t]=n}catch{Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0,enumerable:!0})}if(e.default===r)try{e.default=n}catch{Object.defineProperty(e,"default",{value:n,writable:!0,configurable:!0,enumerable:!0})}}}function jj(e,t=!1){return!(t||e&&!e.startsWith("/")&&!e.match(/^[A-Z]:/)&&!e.startsWith(".")&&!e.match(/^[a-zA-Z]([a-zA-Z0-9.\-+])*:\/\//))&&e!==void 0&&!e.includes("node_modules/")}function qj(e){const t=/^\s*[-]{4,}$/,n=/at (?:async )?(?:(.+?)\s+\()?(?:(.+):(\d+):(\d+)?|([^)]+))\)?/,r=/at (?:async )?(.+?) \(data:(.*?),/;return s=>{const i=s.match(r);if(i)return{filename:`<data:${i[2]}>`,function:i[1]};const o=s.match(n);if(o){let c,a,l,f,d;if(o[1]){l=o[1];let p=l.lastIndexOf(".");if(l[p-1]==="."&&p--,p>0){c=l.slice(0,p),a=l.slice(p+1);const h=c.indexOf(".Module");h>0&&(l=l.slice(h+1),c=c.slice(0,h))}f=void 0}a&&(f=c,d=a),a==="<anonymous>"&&(d=void 0,l=void 0),l===void 0&&(d=d||ew,l=f?`${f}.${d}`:d);let u=o[2]?.startsWith("file://")?o[2].slice(7):o[2];const _=o[5]==="native";return u?.match(/\/[A-Z]:/)&&(u=u.slice(1)),!u&&o[5]&&!_&&(u=o[5]),{filename:u?decodeURI(u):void 0,module:e?e(u):void 0,function:l,lineno:ky(o[3]),colno:ky(o[4]),in_app:jj(u||"",_)}}if(s.match(t))return{filename:s}}}function Yj(e){return[90,qj(e)]}function ky(e){return parseInt(e||"",10)||void 0}class to{constructor(t){this._maxSize=t,this._cache=new Map}get size(){return this._cache.size}get(t){const n=this._cache.get(t);if(n!==void 0)return this._cache.delete(t),this._cache.set(t,n),n}set(t,n){if(this._cache.size>=this._maxSize){const r=this._cache.keys().next().value;this._cache.delete(r)}this._cache.set(t,n)}remove(t){const n=this._cache.get(t);return n&&this._cache.delete(t),n}clear(){this._cache.clear()}keys(){return Array.from(this._cache.keys())}values(){const t=[];return this._cache.forEach(n=>t.push(n)),t}}const wl={};function Pe(e,t,n){return n?Kj(e,t,n):Wj(e,t)}function Wj(e,t){return Object.assign(n=>{const r=wl[e];if(r)return n&&r.setConfig(n),r;const s=t(n);return wl[e]=s,cd({instrumentations:[s]}),s},{id:e})}function Kj(e,t,n){return Object.assign(r=>{const s=n(r),i=wl[e];if(i)return i.setConfig(s),i;const o=new t(s);return wl[e]=o,cd({instrumentations:[o]}),o},{id:e})}function h0(e){let t=!1,n=[];if(!zj(e))t=!0;else{const s=e._wrap;e._wrap=(...i)=>(t=!0,n.forEach(o=>o()),n=[],s(...i))}return s=>{t?s():n.push(s)}}function zj(e){return typeof e._wrap=="function"}const De=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,yi="@sentry/instrumentation-http",Zj=1024*1024,xy=D.createContextKey("sentry_http_server_instrumented"),Lr="Http.Server",kf=new Map,By=new WeakSet;function Xj(e,t){vn(e,"_startSpanCallback",new WeakRef(t))}const Qj=((e={})=>{const t={sessions:e.sessions??!0,sessionFlushingDelayMS:e.sessionFlushingDelayMS??6e4,maxRequestBodySize:e.maxRequestBodySize??"medium",ignoreRequestBody:e.ignoreRequestBody};return{name:Lr,setupOnce(){const n=(r=>{Jj(r.server,t)});$n.subscribe("http.server.request.start",n)},afterAllSetup(n){De&&n.getIntegrationByName("Http")&&Y.warn("It seems that you have manually added `httpServerIntegration` while `httpIntegration` is also present. Make sure to remove `httpServerIntegration` when adding `httpIntegration`.")}}}),E0=Qj;function Jj(e,{ignoreRequestBody:t,maxRequestBodySize:n,sessions:r,sessionFlushingDelayMS:s}){const i=e.emit;if(By.has(i))return;const o=new Proxy(i,{apply(c,a,l){if(l[0]!=="request")return c.apply(a,l);const f=ye();if(D.context.active().getValue(xy)||!f)return c.apply(a,l);De&&Y.log(Lr,"Handling incoming request");const d=tt().clone(),u=l[1],_=l[2],p=H$(u),h=u.ip||u.socket?.remoteAddress,E=u.url||"/";n!=="none"&&!t?.(E,u)&&tq(u,d,n),d.setSDKProcessingMetadata({normalizedRequest:p,ipAddress:h});const T=(u.method||"GET").toUpperCase(),S=Xc(E),m=`${T} ${S}`;return d.setTransactionName(m),r&&f&&eq(f,{requestIsolationScope:d,response:_,sessionFlushingDelayMS:s??6e4}),IG(d,()=>{rt().getPropagationContext().propagationSpanId=si();const g=D.propagation.extract(D.context.active(),p.headers).setValue(xy,!0);return D.context.with(g,()=>{f.emit("httpServerRequest",u,_,p);const y=u._startSpanCallback?.deref();return y?y(()=>c.apply(a,l)):c.apply(a,l)})})}});By.add(o),e.emit=o}function eq(e,{requestIsolationScope:t,response:n,sessionFlushingDelayMS:r}){t.setSDKProcessingMetadata({requestSession:{status:"ok"}}),n.once("close",()=>{const s=t.getScopeData().sdkProcessingMetadata.requestSession;if(e&&s){De&&Y.log(`Recorded request session with status: ${s.status}`);const i=new Date;i.setSeconds(0,0);const o=i.toISOString(),c=kf.get(e),a=c?.[o]||{exited:0,crashed:0,errored:0};if(a[{ok:"exited",crashed:"crashed",errored:"errored"}[s.status]]++,c)c[o]=a;else{De&&Y.log("Opened new request session aggregate.");const l={[o]:a};kf.set(e,l);const f=()=>{clearTimeout(u),d(),kf.delete(e);const _=Object.entries(l).map(([p,h])=>({started:p,exited:h.exited,errored:h.errored,crashed:h.crashed}));e.sendSession({aggregates:_})},d=e.on("flush",()=>{De&&Y.log("Sending request session aggregate due to client flush"),f()}),u=setTimeout(()=>{De&&Y.log("Sending request session aggregate due to flushing schedule"),f()},r).unref()}}})}function tq(e,t,n){let r=0;const s=[];De&&Y.log(Lr,"Patching request.on");const i=new WeakMap,o=n==="small"?1e3:n==="medium"?1e4:Zj;try{e.on=new Proxy(e.on,{apply:(c,a,l)=>{const[f,d,...u]=l;if(f==="data"){De&&Y.log(Lr,`Handling request.on("data") with maximum body size of ${o}b`);const _=new Proxy(d,{apply:(p,h,E)=>{try{const T=E[0],S=Buffer.from(T);r<o?(s.push(S),r+=S.byteLength):De&&Y.log(Lr,`Dropping request body chunk because maximum body length of ${o}b is exceeded.`)}catch{De&&Y.error(Lr,"Encountered error while storing body chunk.")}return Reflect.apply(p,h,E)}});return i.set(d,_),Reflect.apply(c,a,[f,_,...u])}return Reflect.apply(c,a,l)}}),e.off=new Proxy(e.off,{apply:(c,a,l)=>{const[,f]=l,d=i.get(f);if(d){i.delete(f);const u=l.slice();return u[1]=d,Reflect.apply(c,a,u)}return Reflect.apply(c,a,l)}}),e.on("end",()=>{try{const c=Buffer.concat(s).toString("utf-8");if(c){const l=Buffer.byteLength(c,"utf-8")>o?`${Buffer.from(c).subarray(0,o-3).toString("utf-8")}...`:c;t.setSDKProcessingMetadata({normalizedRequest:{data:l}})}}catch(c){De&&Y.error(Lr,"Error building captured request body",c)}})}catch(c){De&&Y.error(Lr,"Error patching request to capture body",c)}}const Gy="Http.ServerSpans",nq=((e={})=>{const t=e.ignoreStaticAssets??!0,n=e.ignoreIncomingRequests,r=e.ignoreStatusCodes??[[401,404],[301,303],[305,399]],{onSpanCreated:s}=e,{requestHook:i,responseHook:o,applyCustomAttributesOnSpan:c}=e.instrumentation??{};return{name:Gy,setup(a){typeof __SENTRY_TRACING__<"u"&&!__SENTRY_TRACING__||a.on("httpServerRequest",(l,f,d)=>{const u=l,_=f;Xj(u,h=>{if(iq(u,{ignoreStaticAssets:t,ignoreIncomingRequests:n}))return De&&Y.log(Gy,"Skipping span creation for incoming request",u.url),h();const E=d.url||u.url||"/",T=x$(E),S=u.headers,m=S["user-agent"],g=S["x-forwarded-for"],y=u.httpVersion,A=S.host,N=A?.replace(/^(.*)(:[0-9]{1,5})/,"$1")||"localhost",O=a.tracer,b=E.startsWith("https")?"https":"http",C=d.method||u.method?.toUpperCase()||"GET",w=T?T.pathname:Xc(E),k=`${C} ${w}`,U=O.startSpan(k,{kind:D.SpanKind.SERVER,attributes:{[Re]:"http.server",[He]:"auto.http.otel.http","sentry.http.prefetch":rq(u)||void 0,"http.url":E,"http.method":d.method,"http.target":T?`${T.pathname}${T.search}`:w,"http.host":A,"net.host.name":N,"http.client_ip":typeof g=="string"?g.split(",")[0]:void 0,"http.user_agent":m,"http.scheme":b,"http.flavor":y,"net.transport":y?.toUpperCase()==="QUIC"?"ip_udp":"ip_tcp",...oq(u),...q$(d.headers||{})}});i?.(U,u),o?.(U,_),c?.(U,u,_),s?.(U,u,_);const M={type:Ys.HTTP,span:U};return D.context.with(PM(D.trace.setSpan(D.context.active(),U),M),()=>{D.context.bind(D.context.active(),u),D.context.bind(D.context.active(),_);let F=!1;function v(L){if(F)return;F=!0;const H=uq(u,_);U.setAttributes(H),U.setStatus(L),U.end();const te=H["http.route"];te&&tt().setTransactionName(`${u.method?.toUpperCase()||"GET"} ${te}`)}return _.on("close",()=>{v(Qh(_.statusCode))}),_.on(bk.errorMonitor,()=>{const L=Qh(_.statusCode);v(L.code===be?L:{code:be})}),h()})})})},processEvent(a){if(a.type==="transaction"){const l=a.contexts?.trace?.data?.["http.response.status_code"];if(typeof l=="number"&&lq(l,r))return De&&Y.log("Dropping transaction due to status code",l),null}return a},afterAllSetup(a){De&&(a.getIntegrationByName("Http")&&Y.warn("It seems that you have manually added `httpServerSpansIntergation` while `httpIntegration` is also present. Make sure to remove `httpIntegration` when adding `httpServerSpansIntegration`."),a.getIntegrationByName("Http.Server")||Y.error("It seems that you have manually added `httpServerSpansIntergation` without adding `httpServerIntegration`. This is a requiement for spans to be created - please add the `httpServerIntegration` integration."))}}}),T0=nq;function rq(e){return e.headers["next-router-prefetch"]==="1"}function sq(e){const t=Xc(e);return!!(t.match(/\.(ico|png|jpg|jpeg|gif|svg|css|js|woff|woff2|ttf|eot|webp|avif)$/)||t.match(/^\/(robots\.txt|sitemap\.xml|manifest\.json|browserconfig\.xml)$/))}function iq(e,{ignoreStaticAssets:t,ignoreIncomingRequests:n}){if(Kn(D.context.active()))return!0;const r=e.url,s=e.method?.toUpperCase();return!!(s==="OPTIONS"||s==="HEAD"||!r||t&&s==="GET"&&sq(r)||n?.(r,e))}function oq(e){const t=aq(e.headers);return t==null?{}:cq(e.headers)?{"http.request_content_length":t}:{"http.request_content_length_uncompressed":t}}function aq(e){const t=e["content-length"];if(t===void 0)return null;const n=parseInt(t,10);return isNaN(n)?null:n}function cq(e){const t=e["content-encoding"];return!!t&&t!=="identity"}function uq(e,t){const{socket:n}=e,{statusCode:r,statusMessage:s}=t,i={[ne.ATTR_HTTP_RESPONSE_STATUS_CODE]:r,[ne.SEMATTRS_HTTP_STATUS_CODE]:r,"http.status_text":s?.toUpperCase()},o=od(D.context.active());if(n){const{localAddress:c,localPort:a,remoteAddress:l,remotePort:f}=n;i[ne.SEMATTRS_NET_HOST_IP]=c,i[ne.SEMATTRS_NET_HOST_PORT]=a,i[ne.SEMATTRS_NET_PEER_IP]=l,i["net.peer.port"]=f}if(i[ne.SEMATTRS_HTTP_STATUS_CODE]=r,i["http.status_text"]=(s||"").toUpperCase(),o?.type===Ys.HTTP&&o.route!==void 0){const c=o.route;i[ne.ATTR_HTTP_ROUTE]=c}return i}function lq(e,t){return t.some(n=>{if(typeof n=="number")return n===e;const[r,s]=n;return e>=r&&e<=s})}function S0(e){const t=e.protocol||"",n=e.hostname||e.host||"",r=!e.port||e.port===80||e.port===443||/^(.*):(\d+)$/.test(n)?"":`:${e.port}`,s=e.path?e.path:"/";return`${t}//${n}${r}${s}`}function dq(){return`unknown_service:${process.argv0}`}const wc=e=>e!==null&&typeof e=="object"&&typeof e.then=="function";class Ll{_rawAttributes;_asyncAttributesPending=!1;_schemaUrl;_memoizedAttributes;static FromAttributeList(t,n){const r=new Ll({},n);return r._rawAttributes=Vy(t),r._asyncAttributesPending=t.filter(([s,i])=>wc(i)).length>0,r}constructor(t,n){const r=t.attributes??{};this._rawAttributes=Object.entries(r).map(([s,i])=>(wc(i)&&(this._asyncAttributesPending=!0),[s,i])),this._rawAttributes=Vy(this._rawAttributes),this._schemaUrl=fq(n?.schemaUrl)}get asyncAttributesPending(){return this._asyncAttributesPending}async waitForAsyncAttributes(){if(this.asyncAttributesPending){for(let t=0;t<this._rawAttributes.length;t++){const[n,r]=this._rawAttributes[t];this._rawAttributes[t]=[n,wc(r)?await r:r]}this._asyncAttributesPending=!1}}get attributes(){if(this.asyncAttributesPending&&D.diag.error("Accessing resource attributes before async attributes settled"),this._memoizedAttributes)return this._memoizedAttributes;const t={};for(const[n,r]of this._rawAttributes){if(wc(r)){D.diag.debug(`Unsettled resource attribute ${n} skipped`);continue}r!=null&&(t[n]??=r)}return this._asyncAttributesPending||(this._memoizedAttributes=t),t}getRawAttributes(){return this._rawAttributes}get schemaUrl(){return this._schemaUrl}merge(t){if(t==null)return this;const n=_q(this,t),r=n?{schemaUrl:n}:void 0;return Ll.FromAttributeList([...t.getRawAttributes(),...this.getRawAttributes()],r)}}function m0(e,t){return Ll.FromAttributeList(Object.entries(e),t)}function g0(){return m0({[ne.ATTR_SERVICE_NAME]:dq(),[ne.ATTR_TELEMETRY_SDK_LANGUAGE]:tl[ne.ATTR_TELEMETRY_SDK_LANGUAGE],[ne.ATTR_TELEMETRY_SDK_NAME]:tl[ne.ATTR_TELEMETRY_SDK_NAME],[ne.ATTR_TELEMETRY_SDK_VERSION]:tl[ne.ATTR_TELEMETRY_SDK_VERSION]})}function Vy(e){return e.map(([t,n])=>wc(n)?[t,n.catch(r=>{D.diag.debug("promise rejection for resource attribute: %s - %s",t,r)})]:[t,n])}function fq(e){if(typeof e=="string"||e===void 0)return e;D.diag.warn("Schema URL must be string or undefined, got %s. Schema URL will be ignored.",e)}function _q(e,t){const n=e?.schemaUrl,r=t?.schemaUrl,s=n===void 0||n==="",i=r===void 0||r==="";if(s)return r;if(i||n===r)return n;D.diag.warn('Schema URL merge conflict: old resource has "%s", updating resource has "%s". Resulting resource will have undefined Schema URL.',n,r)}const pq="exception";class hq{_spanContext;kind;parentSpanContext;attributes={};links=[];events=[];startTime;resource;instrumentationScope;_droppedAttributesCount=0;_droppedEventsCount=0;_droppedLinksCount=0;name;status={code:D.SpanStatusCode.UNSET};endTime=[0,0];_ended=!1;_duration=[-1,-1];_spanProcessor;_spanLimits;_attributeValueLengthLimit;_performanceStartTime;_performanceOffset;_startTimeProvided;constructor(t){const n=Date.now();this._spanContext=t.spanContext,this._performanceStartTime=Hs.now(),this._performanceOffset=n-(this._performanceStartTime+sd()),this._startTimeProvided=t.startTime!=null,this._spanLimits=t.spanLimits,this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0,this._spanProcessor=t.spanProcessor,this.name=t.name,this.parentSpanContext=t.parentSpanContext,this.kind=t.kind,this.links=t.links||[],this.startTime=this._getTime(t.startTime??n),this.resource=t.resource,this.instrumentationScope=t.scope,t.attributes!=null&&this.setAttributes(t.attributes),this._spanProcessor.onStart(this,t.context)}spanContext(){return this._spanContext}setAttribute(t,n){if(n==null||this._isSpanEnded())return this;if(t.length===0)return D.diag.warn(`Invalid attribute key: ${t}`),this;if(!WE(n))return D.diag.warn(`Invalid attribute value set for key: ${t}`),this;const{attributeCountLimit:r}=this._spanLimits;return r!==void 0&&Object.keys(this.attributes).length>=r&&!Object.prototype.hasOwnProperty.call(this.attributes,t)?(this._droppedAttributesCount++,this):(this.attributes[t]=this._truncateToSize(n),this)}setAttributes(t){for(const[n,r]of Object.entries(t))this.setAttribute(n,r);return this}addEvent(t,n,r){if(this._isSpanEnded())return this;const{eventCountLimit:s}=this._spanLimits;if(s===0)return D.diag.warn("No events allowed."),this._droppedEventsCount++,this;s!==void 0&&this.events.length>=s&&(this._droppedEventsCount===0&&D.diag.debug("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),Wh(n)&&(Wh(r)||(r=n),n=void 0);const i=xc(n);return this.events.push({name:t,attributes:i,time:this._getTime(r),droppedAttributesCount:0}),this}addLink(t){return this.links.push(t),this}addLinks(t){return this.links.push(...t),this}setStatus(t){return this._isSpanEnded()?this:(this.status={...t},this.status.message!=null&&typeof t.message!="string"&&(D.diag.warn(`Dropping invalid status.message of type '${typeof t.message}', expected 'string'`),delete this.status.message),this)}updateName(t){return this._isSpanEnded()?this:(this.name=t,this)}end(t){if(this._isSpanEnded()){D.diag.error(`${this.name} ${this._spanContext.traceId}-${this._spanContext.spanId} - You can only call end() on a span once.`);return}this._ended=!0,this.endTime=this._getTime(t),this._duration=CM(this.startTime,this.endTime),this._duration[0]<0&&(D.diag.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._droppedEventsCount>0&&D.diag.warn(`Dropped ${this._droppedEventsCount} events because eventCountLimit reached`),this._spanProcessor.onEnd(this)}_getTime(t){if(typeof t=="number"&&t<=Hs.now())return ZE(t+this._performanceOffset);if(typeof t=="number")return dr(t);if(t instanceof Date)return dr(t.getTime());if(id(t))return t;if(this._startTimeProvided)return dr(Date.now());const n=Hs.now()-this._performanceStartTime;return XE(this.startTime,dr(n))}isRecording(){return this._ended===!1}recordException(t,n){const r={};typeof t=="string"?r[ne.ATTR_EXCEPTION_MESSAGE]=t:t&&(t.code?r[ne.ATTR_EXCEPTION_TYPE]=t.code.toString():t.name&&(r[ne.ATTR_EXCEPTION_TYPE]=t.name),t.message&&(r[ne.ATTR_EXCEPTION_MESSAGE]=t.message),t.stack&&(r[ne.ATTR_EXCEPTION_STACKTRACE]=t.stack)),r[ne.ATTR_EXCEPTION_TYPE]||r[ne.ATTR_EXCEPTION_MESSAGE]?this.addEvent(pq,r,n):D.diag.warn(`Failed to record an exception ${t}`)}get duration(){return this._duration}get ended(){return this._ended}get droppedAttributesCount(){return this._droppedAttributesCount}get droppedEventsCount(){return this._droppedEventsCount}get droppedLinksCount(){return this._droppedLinksCount}_isSpanEnded(){if(this._ended){const t=new Error(`Operation attempted on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`);D.diag.warn(`Cannot execute the operation on ended Span {traceId: ${this._spanContext.traceId}, spanId: ${this._spanContext.spanId}}`,t)}return this._ended}_truncateToLimitUtil(t,n){return t.length<=n?t:t.substring(0,n)}_truncateToSize(t){const n=this._attributeValueLengthLimit;return n<=0?(D.diag.warn(`Attribute value limit must be positive, got ${n}`),t):typeof t=="string"?this._truncateToLimitUtil(t,n):Array.isArray(t)?t.map(r=>typeof r=="string"?this._truncateToLimitUtil(r,n):r):t}}var qt;(function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(qt||(qt={}));class Dl{shouldSample(){return{decision:qt.NOT_RECORD}}toString(){return"AlwaysOffSampler"}}class Li{shouldSample(){return{decision:qt.RECORD_AND_SAMPLED}}toString(){return"AlwaysOnSampler"}}class Cu{_root;_remoteParentSampled;_remoteParentNotSampled;_localParentSampled;_localParentNotSampled;constructor(t){this._root=t.root,this._root||(KE(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new Li),this._remoteParentSampled=t.remoteParentSampled??new Li,this._remoteParentNotSampled=t.remoteParentNotSampled??new Dl,this._localParentSampled=t.localParentSampled??new Li,this._localParentNotSampled=t.localParentNotSampled??new Dl}shouldSample(t,n,r,s,i,o){const c=D.trace.getSpanContext(t);return!c||!D.isSpanContextValid(c)?this._root.shouldSample(t,n,r,s,i,o):c.isRemote?c.traceFlags&D.TraceFlags.SAMPLED?this._remoteParentSampled.shouldSample(t,n,r,s,i,o):this._remoteParentNotSampled.shouldSample(t,n,r,s,i,o):c.traceFlags&D.TraceFlags.SAMPLED?this._localParentSampled.shouldSample(t,n,r,s,i,o):this._localParentNotSampled.shouldSample(t,n,r,s,i,o)}toString(){return`ParentBased{root=${this._root.toString()}, remoteParentSampled=${this._remoteParentSampled.toString()}, remoteParentNotSampled=${this._remoteParentNotSampled.toString()}, localParentSampled=${this._localParentSampled.toString()}, localParentNotSampled=${this._localParentNotSampled.toString()}}`}}class $y{_ratio;_upperBound;constructor(t=0){this._ratio=t,this._ratio=this._normalize(t),this._upperBound=Math.floor(this._ratio*4294967295)}shouldSample(t,n){return{decision:D.isValidTraceId(n)&&this._accumulate(n)<this._upperBound?qt.RECORD_AND_SAMPLED:qt.NOT_RECORD}}toString(){return`TraceIdRatioBased{${this._ratio}}`}_normalize(t){return typeof t!="number"||isNaN(t)?0:t>=1?1:t<=0?0:t}_accumulate(t){let n=0;for(let r=0;r<t.length/8;r++){const s=r*8,i=parseInt(t.slice(s,s+8),16);n=(n^i)>>>0}return n}}var xn;(function(e){e.AlwaysOff="always_off",e.AlwaysOn="always_on",e.ParentBasedAlwaysOff="parentbased_always_off",e.ParentBasedAlwaysOn="parentbased_always_on",e.ParentBasedTraceIdRatio="parentbased_traceidratio",e.TraceIdRatio="traceidratio"})(xn||(xn={}));const vu=1;function A0(){return{sampler:R0(),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:xt("OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT")??1/0,attributeCountLimit:xt("OTEL_ATTRIBUTE_COUNT_LIMIT")??128},spanLimits:{attributeValueLengthLimit:xt("OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT")??1/0,attributeCountLimit:xt("OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT")??128,linkCountLimit:xt("OTEL_SPAN_LINK_COUNT_LIMIT")??128,eventCountLimit:xt("OTEL_SPAN_EVENT_COUNT_LIMIT")??128,attributePerEventCountLimit:xt("OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT")??128,attributePerLinkCountLimit:xt("OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT")??128}}}function R0(){const e=zE("OTEL_TRACES_SAMPLER")??xn.ParentBasedAlwaysOn;switch(e){case xn.AlwaysOn:return new Li;case xn.AlwaysOff:return new Dl;case xn.ParentBasedAlwaysOn:return new Cu({root:new Li});case xn.ParentBasedAlwaysOff:return new Cu({root:new Dl});case xn.TraceIdRatio:return new $y(Hy());case xn.ParentBasedTraceIdRatio:return new Cu({root:new $y(Hy())});default:return D.diag.error(`OTEL_TRACES_SAMPLER value "${e}" invalid, defaulting to "${xn.ParentBasedAlwaysOn}".`),new Cu({root:new Li})}}function Hy(){const e=xt("OTEL_TRACES_SAMPLER_ARG");return e==null?(D.diag.error(`OTEL_TRACES_SAMPLER_ARG is blank, defaulting to ${vu}.`),vu):e<0||e>1?(D.diag.error(`OTEL_TRACES_SAMPLER_ARG=${e} was given, but it is out of range ([0..1]), defaulting to ${vu}.`),vu):e}const Eq=128,Tq=1/0;function Sq(e){const t={sampler:R0()},n=A0(),r=Object.assign({},n,t,e);return r.generalLimits=Object.assign({},n.generalLimits,e.generalLimits||{}),r.spanLimits=Object.assign({},n.spanLimits,e.spanLimits||{}),r}function mq(e){const t=Object.assign({},e.spanLimits);return t.attributeCountLimit=e.spanLimits?.attributeCountLimit??e.generalLimits?.attributeCountLimit??xt("OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT")??xt("OTEL_ATTRIBUTE_COUNT_LIMIT")??Eq,t.attributeValueLengthLimit=e.spanLimits?.attributeValueLengthLimit??e.generalLimits?.attributeValueLengthLimit??xt("OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT")??xt("OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT")??Tq,Object.assign({},e,{spanLimits:t})}const gq=8,y0=16;class Aq{generateTraceId=Fy(y0);generateSpanId=Fy(gq)}const Pu=Buffer.allocUnsafe(y0);function Fy(e){return function(){for(let n=0;n<e/4;n++)Pu.writeUInt32BE(Math.random()*2**32>>>0,n*4);for(let n=0;n<e&&!(Pu[n]>0);n++)n===e-1&&(Pu[e-1]=1);return Pu.toString("hex",0,e)}}class Rq{_sampler;_generalLimits;_spanLimits;_idGenerator;instrumentationScope;_resource;_spanProcessor;constructor(t,n,r,s){const i=Sq(n);this._sampler=i.sampler,this._generalLimits=i.generalLimits,this._spanLimits=i.spanLimits,this._idGenerator=n.idGenerator||new Aq,this._resource=r,this._spanProcessor=s,this.instrumentationScope=t}startSpan(t,n={},r=D.context.active()){n.root&&(r=D.trace.deleteSpan(r));const s=D.trace.getSpan(r);if(Kn(r))return D.diag.debug("Instrumentation suppressed, returning Noop Span"),D.trace.wrapSpanContext(D.INVALID_SPAN_CONTEXT);const i=s?.spanContext(),o=this._idGenerator.generateSpanId();let c,a,l;!i||!D.trace.isSpanContextValid(i)?a=this._idGenerator.generateTraceId():(a=i.traceId,l=i.traceState,c=i);const f=n.kind??D.SpanKind.INTERNAL,d=(n.links??[]).map(S=>({context:S.context,attributes:xc(S.attributes)})),u=xc(n.attributes),_=this._sampler.shouldSample(r,a,t,f,u,d);l=_.traceState??l;const p=_.decision===D.SamplingDecision.RECORD_AND_SAMPLED?D.TraceFlags.SAMPLED:D.TraceFlags.NONE,h={traceId:a,spanId:o,traceFlags:p,traceState:l};if(_.decision===D.SamplingDecision.NOT_RECORD)return D.diag.debug("Recording is off, propagating context in a non-recording span"),D.trace.wrapSpanContext(h);const E=xc(Object.assign(u,_.attributes));return new hq({resource:this._resource,scope:this.instrumentationScope,context:r,spanContext:h,name:t,kind:f,links:d,parentSpanContext:c,attributes:E,startTime:n.startTime,spanProcessor:this._spanProcessor,spanLimits:this._spanLimits})}startActiveSpan(t,n,r,s){let i,o,c;if(arguments.length<2)return;arguments.length===2?c=n:arguments.length===3?(i=n,c=r):(i=n,o=r,c=s);const a=o??D.context.active(),l=this.startSpan(t,i,a),f=D.trace.setSpan(a,l);return D.context.with(f,c,void 0,l)}getGeneralLimits(){return this._generalLimits}getSpanLimits(){return this._spanLimits}}class yq{_spanProcessors;constructor(t){this._spanProcessors=t}forceFlush(){const t=[];for(const n of this._spanProcessors)t.push(n.forceFlush());return new Promise(n=>{Promise.all(t).then(()=>{n()}).catch(r=>{KE(r||new Error("MultiSpanProcessor: forceFlush failed")),n()})})}onStart(t,n){for(const r of this._spanProcessors)r.onStart(t,n)}onEnd(t){for(const n of this._spanProcessors)n.onEnd(t)}shutdown(){const t=[];for(const n of this._spanProcessors)t.push(n.shutdown());return new Promise((n,r)=>{Promise.all(t).then(()=>{n()},r)})}}var $s;(function(e){e[e.resolved=0]="resolved",e[e.timeout=1]="timeout",e[e.error=2]="error",e[e.unresolved=3]="unresolved"})($s||($s={}));class Nq{_config;_tracers=new Map;_resource;_activeSpanProcessor;constructor(t={}){const n=UM({},A0(),mq(t));this._resource=n.resource??g0(),this._config=Object.assign({},n,{resource:this._resource});const r=[];t.spanProcessors?.length&&r.push(...t.spanProcessors),this._activeSpanProcessor=new yq(r)}getTracer(t,n,r){const s=`${t}@${n||""}:${r?.schemaUrl||""}`;return this._tracers.has(s)||this._tracers.set(s,new Rq({name:t,version:n,schemaUrl:r?.schemaUrl},this._config,this._resource,this._activeSpanProcessor)),this._tracers.get(s)}forceFlush(){const t=this._config.forceFlushTimeoutMillis,n=this._activeSpanProcessor._spanProcessors.map(r=>new Promise(s=>{let i;const o=setTimeout(()=>{s(new Error(`Span processor did not completed within timeout period of ${t} ms`)),i=$s.timeout},t);r.forceFlush().then(()=>{clearTimeout(o),i!==$s.timeout&&(i=$s.resolved,s(i))}).catch(c=>{clearTimeout(o),i=$s.error,s(c)})}));return new Promise((r,s)=>{Promise.all(n).then(i=>{const o=i.filter(c=>c!==$s.resolved);o.length>0?s(o):r()}).catch(i=>s([i]))})}shutdown(){return this._activeSpanProcessor.shutdown()}}const LT="sentry.parentIsRemote",Lc="sentry.graphql.operation";function DT(e){if("parentSpanId"in e)return e.parentSpanId;if("parentSpanContext"in e)return e.parentSpanContext?.spanId}function UT(e){const t=e;return!!t.attributes&&typeof t.attributes=="object"}function Oq(e){return typeof e.kind=="number"}function bq(e){return!!e.status}function N0(e){return!!e.name}function Iq(e){if(!UT(e))return{};const t=e.attributes[ne.ATTR_URL_FULL]||e.attributes[ne.SEMATTRS_HTTP_URL],n={url:t,"http.method":e.attributes[ne.ATTR_HTTP_REQUEST_METHOD]||e.attributes[ne.SEMATTRS_HTTP_METHOD]};!n["http.method"]&&n.url&&(n["http.method"]="GET");try{if(typeof t=="string"){const r=Sd(t);n.url=md(r),r.search&&(n["http.query"]=r.search),r.hash&&(n["http.fragment"]=r.hash)}}catch{}return n}function Cq(e){return Oq(e)?e.kind:D.SpanKind.INTERNAL}const xf="sentry-trace",uE="baggage",kT="sentry.dsc",xT="sentry.sampled_not_recording",O0="sentry.url",vq="sentry.sample_rand",Pq="sentry.sample_rate",b0=D.createContextKey("sentry_scopes"),lE=D.createContextKey("sentry_fork_isolation_scope"),dE=D.createContextKey("sentry_fork_set_scope"),fE=D.createContextKey("sentry_fork_set_isolation_scope"),I0="_scopeContext";function no(e){return e.getValue(b0)}function C0(e,t){return e.setValue(b0,t)}function Mq(e,t){vn(e,I0,t)}function Qc(e){return e[I0]}function ji(e){const{traceFlags:t,traceState:n}=e,r=n?n.get(xT)==="1":!1;if(t===D.TraceFlags.SAMPLED)return!0;if(r)return!1;const s=n?n.get(kT):void 0,i=s?hu(s):void 0;if(i?.sampled==="true")return!0;if(i?.sampled==="false")return!1}function v0(e,t,n){const r=t[ne.ATTR_HTTP_REQUEST_METHOD]||t[ne.SEMATTRS_HTTP_METHOD];if(r)return Lq({attributes:t,name:e,kind:n},r);const s=t[ne.SEMATTRS_DB_SYSTEM],i=typeof t[Re]=="string"&&t[Re].startsWith("cache.");if(s&&!i)return wq({attributes:t,name:e});const o=t[cn]==="custom"?"custom":"route";if(t[ne.SEMATTRS_RPC_SERVICE])return{...Gc(e,t,"route"),op:"rpc"};if(t[ne.SEMATTRS_MESSAGING_SYSTEM])return{...Gc(e,t,o),op:"message"};const l=t[ne.SEMATTRS_FAAS_TRIGGER];return l?{...Gc(e,t,o),op:l.toString()}:{op:void 0,description:e,source:"custom"}}function P0(e){const t=UT(e)?e.attributes:{},n=N0(e)?e.name:"<unknown>",r=Cq(e);return v0(n,t,r)}function wq({attributes:e,name:t}){const n=e[$i];if(typeof n=="string")return{op:"db",description:n,source:e[cn]||"custom"};if(e[cn]==="custom")return{op:"db",description:t,source:"custom"};const r=e[ne.SEMATTRS_DB_STATEMENT];return{op:"db",description:r?r.toString():t,source:"task"}}function Lq({name:e,kind:t,attributes:n},r){const s=["http"];switch(t){case D.SpanKind.CLIENT:s.push("client");break;case D.SpanKind.SERVER:s.push("server");break}n["sentry.http.prefetch"]&&s.push("prefetch");const{urlPath:i,url:o,query:c,fragment:a,hasRoute:l}=Uq(n,t);if(!i)return{...Gc(e,n),op:s.join(".")};const f=n[Lc],d=`${r} ${i}`,u=f?`${d} (${Dq(f)})`:d,_=l||i==="/"?"route":"url",p={};o&&(p.url=o),c&&(p["http.query"]=c),a&&(p["http.fragment"]=a);const h=t===D.SpanKind.CLIENT||t===D.SpanKind.SERVER,T=!`${n[He]||"manual"}`.startsWith("auto"),S=n[cn]==="custom",m=n[$i],g=!S&&m==null&&(h||!T),{description:y,source:A}=g?{description:u,source:_}:Gc(e,n);return{op:s.join("."),description:y,source:A,data:p}}function Dq(e){if(Array.isArray(e)){const t=e.slice().sort();return t.length<=5?t.join(", "):`${t.slice(0,5).join(", ")}, +${t.length-5}`}return`${e}`}function Uq(e,t){const n=e[ne.SEMATTRS_HTTP_TARGET],r=e[ne.SEMATTRS_HTTP_URL]||e[ne.ATTR_URL_FULL],s=e[ne.ATTR_HTTP_ROUTE],i=typeof r=="string"?Sd(r):void 0,o=i?md(i):void 0,c=i?.search||void 0,a=i?.hash||void 0;return typeof s=="string"?{urlPath:s,url:o,query:c,fragment:a,hasRoute:!0}:t===D.SpanKind.SERVER&&typeof n=="string"?{urlPath:Xc(n),url:o,query:c,fragment:a,hasRoute:!1}:i?{urlPath:o,url:o,query:c,fragment:a,hasRoute:!1}:typeof n=="string"?{urlPath:Xc(n),url:o,query:c,fragment:a,hasRoute:!1}:{urlPath:void 0,url:o,query:c,fragment:a,hasRoute:!1}}function Gc(e,t,n="custom"){const r=t[cn]||n,s=t[$i];return s&&typeof s=="string"?{description:s,source:r}:{description:e,source:r}}function kq(e){e.on("createDsc",(t,n)=>{if(!n)return;const i=ve(n).data[cn],{description:o}=N0(n)?P0(n):{description:void 0};if(i!=="url"&&o&&(t.transaction=o),un()){const c=ji(n.spanContext());t.sampled=c==null?void 0:String(c)}})}function M0(){return D.trace.getActiveSpan()}const Yn=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function w0({dsc:e,sampled:t}){const n=e?_T(e):void 0,r=new Zi,s=n?r.set(kT,n):r;return t===!1?s.set(xT,"1"):s}const L0=new Set;function xq(){return Array.from(L0)}function Pd(e){L0.add(e)}class Bq extends RM{constructor(){super(),Pd("SentryPropagator"),this._urlMatchesTargetsMap=new to(100)}inject(t,n,r){if(Kn(t)){Yn&&Y.log("[Tracing] Not injecting trace data for url because tracing is suppressed.");return}const s=D.trace.getSpan(t),i=s&&$q(s),o=ye()?.getOptions()?.tracePropagationTargets;if(!BT(i,o,this._urlMatchesTargetsMap)){Yn&&Y.log("[Tracing] Not injecting trace data for url because it does not match tracePropagationTargets:",i);return}const c=Vq(n);let a=D.propagation.getBaggage(t)||D.propagation.createBaggage({});const{dynamicSamplingContext:l,traceId:f,spanId:d,sampled:u}=D0(t);if(c){const _=Nl(c);_&&Object.entries(_).forEach(([p,h])=>{a=a.setEntry(p,{value:h})})}l&&(a=Object.entries(l).reduce((_,[p,h])=>h?_.setEntry(`${fT}${p}`,{value:h}):_,a)),f&&f!==D.INVALID_TRACEID&&r.set(n,xf,dd(f,d,u)),super.inject(D.propagation.setBaggage(t,a),n,r)}extract(t,n,r){const s=r.get(n,xf),i=r.get(n,uE),o=s?Array.isArray(s)?s[0]:s:void 0;return k0(U0(t,{sentryTrace:o,baggage:i}))}fields(){return[xf,uE]}}const jy="[Tracing] Not injecting trace data for url because it does not match tracePropagationTargets:";function BT(e,t,n){if(typeof e!="string"||!t)return!0;const r=n?.get(e);if(r!==void 0)return Yn&&!r&&Y.log(jy,e),r;const s=fu(e,t);return n?.set(e,s),Yn&&!s&&Y.log(jy,e),s}function D0(e,t={}){const n=D.trace.getSpan(e);if(n?.spanContext().isRemote){const c=n.spanContext();return{dynamicSamplingContext:zt(n),traceId:c.traceId,spanId:void 0,sampled:ji(c)}}if(n){const c=n.spanContext();return{dynamicSamplingContext:zt(n),traceId:c.traceId,spanId:c.spanId,sampled:ji(c)}}const r=t.scope||no(e)?.scope||rt(),s=t.client||ye(),i=r.getPropagationContext();return{dynamicSamplingContext:s?Eu(s,r):void 0,traceId:i.traceId,spanId:i.propagationSpanId,sampled:i.sampled}}function U0(e,{sentryTrace:t,baggage:n}){const r=Tw(t,n),{traceId:s,parentSpanId:i,sampled:o,dsc:c}=r,a=ye(),l=hu(n);if(!i||a&&!KG(a,l?.org_id))return e;const f=Hq({traceId:s,spanId:i,sampled:o,dsc:c});return D.trace.setSpanContext(e,f)}function Gq(e,t,n){const r=k0(U0(e,t));return D.context.with(r,n)}function k0(e){const t=no(e),n={scope:t?t.scope:rt().clone(),isolationScope:t?t.isolationScope:tt()};return C0(e,n)}function Vq(e){try{const t=e[uE];return Array.isArray(t)?t.join(","):t}catch{return}}function $q(e){const t=ve(e).data,n=t[ne.SEMATTRS_HTTP_URL]||t[ne.ATTR_URL_FULL];if(typeof n=="string")return n;const r=e.spanContext().traceState?.get(O0);if(r)return r}function Hq({spanId:e,traceId:t,sampled:n,dsc:r}){const s=w0({dsc:r,sampled:n});return{traceId:t,spanId:e,isRemote:!0,traceFlags:n?D.TraceFlags.SAMPLED:D.TraceFlags.NONE,traceState:s}}function x0(e,t,n){const r=G0(),{name:s,parentSpan:i}=e;return H0(i)(()=>{const c=$0(e.scope,e.forceTransaction),l=e.onlyIfParent&&!D.trace.getSpan(c)?qs(c):c,f=V0(e);if(!un()){const d=Kn(l)?l:qs(l);return D.context.with(d,()=>r.startActiveSpan(s,f,d,u=>D.context.with(c,()=>Xs(()=>t(u),()=>{ve(u).status===void 0&&u.setStatus({code:D.SpanStatusCode.ERROR})},n?()=>u.end():void 0))))}return r.startActiveSpan(s,f,l,d=>Xs(()=>t(d),()=>{ve(d).status===void 0&&d.setStatus({code:D.SpanStatusCode.ERROR})},n?()=>d.end():void 0))})}function Fq(e,t){return x0(e,t,!0)}function jq(e,t){return x0(e,n=>t(n,()=>n.end()),!1)}function qq(e){const t=G0(),{name:n,parentSpan:r}=e;return H0(r)(()=>{const i=$0(e.scope,e.forceTransaction);let c=e.onlyIfParent&&!D.trace.getSpan(i)?qs(i):i;const a=V0(e);return un()||(c=Kn(c)?c:qs(c)),t.startSpan(n,a,c)})}function B0(e,t){const n=e?D.trace.setSpan(D.context.active(),e):D.trace.deleteSpan(D.context.active());return D.context.with(n,()=>t(rt()))}function G0(){return ye()?.tracer||D.trace.getTracer("@sentry/opentelemetry",at)}function V0(e){const{startTime:t,attributes:n,kind:r,op:s,links:i}=e,o=typeof t=="number"?Yq(t):t;return{attributes:s?{[Re]:s,...n}:n,kind:r,links:i,startTime:o}}function Yq(e){return e<9999999999?e*1e3:e}function $0(e,t){const n=Wq(e),r=D.trace.getSpan(n);if(!r||!t)return n;const s=D.trace.deleteSpan(n),{spanId:i,traceId:o}=r.spanContext(),c=ji(r.spanContext()),a=rn(r),l=zt(a),f=w0({dsc:l,sampled:c}),d={traceId:o,spanId:i,isRemote:!0,traceFlags:c?D.TraceFlags.SAMPLED:D.TraceFlags.NONE,traceState:f};return D.trace.setSpanContext(s,d)}function Wq(e){if(e){const t=Qc(e);if(t)return t}return D.context.active()}function Kq(e,t){return Gq(D.context.active(),e,t)}function zq(e,t){const n=Qc(t),r=n&&D.trace.getSpan(n),s=r?fd(r):uT(t);return[r?zt(r):Eu(e,t),s]}function H0(e){return e!==void 0?t=>B0(e,t):t=>t()}function Zq(e){const t=qs(D.context.active());return D.context.with(t,e)}function Xq(e){e.on("preprocessEvent",t=>{const n=M0();if(!n||t.type==="transaction")return;t.contexts={trace:fd(n),...t.contexts};const r=rn(n);return t.sdkProcessingMetadata={dynamicSamplingContext:zt(r),...t.sdkProcessingMetadata},t})}function Qq({span:e,scope:t,client:n}={}){let r=(t&&Qc(t))??D.context.active();if(e){const{scope:a}=Hi(e);r=a&&Qc(a)||D.trace.setSpan(D.context.active(),e)}const{traceId:s,spanId:i,sampled:o,dynamicSamplingContext:c}=D0(r,{scope:t,client:n});return{"sentry-trace":dd(s,i,o),baggage:_T(c)}}function Jq(){function e(){const c=D.context.active(),a=no(c);return a||{scope:cT(),isolationScope:Qi()}}function t(c){const a=D.context.active();return D.context.with(a,()=>c(i()))}function n(c,a){const l=Qc(c)||D.context.active();return D.context.with(l.setValue(dE,c),()=>a(c))}function r(c){const a=D.context.active();return D.context.with(a.setValue(lE,!0),()=>c(o()))}function s(c,a){const l=D.context.active();return D.context.with(l.setValue(fE,c),()=>a(o()))}function i(){return e().scope}function o(){return e().isolationScope}OG({withScope:t,withSetScope:n,withSetIsolationScope:s,withIsolationScope:r,getCurrentScope:i,getIsolationScope:o,startSpan:Fq,startSpanManual:jq,startInactiveSpan:qq,getActiveSpan:M0,suppressTracing:Zq,getTraceData:Qq,continueTrace:Kq,withActiveSpan:B0})}function eY(e){class t extends e{constructor(...r){super(...r),Pd("SentryContextManager")}with(r,s,i,...o){const c=no(r),a=c?.scope||rt(),l=c?.isolationScope||tt(),f=r.getValue(lE)===!0,d=r.getValue(dE),u=r.getValue(fE),_=d||a.clone(),p=u||(f?l.clone():l),T=C0(r,{scope:_,isolationScope:p}).deleteValue(lE).deleteValue(dE).deleteValue(fE);return Mq(_,T),super.with(T,s,i,...o)}}return t}function tY(e){const t=new Map;for(const n of e)nY(t,n);return Array.from(t,function([n,r]){return r})}function F0(e){return e.attributes[LT]===!0?void 0:DT(e)}function nY(e,t){const n=t.spanContext().spanId,r=F0(t);if(!r){_E(e,{id:n,span:t,children:[]});return}const s=rY(e,r),i=_E(e,{id:n,span:t,parentNode:s,children:[]});s.children.push(i)}function rY(e,t){const n=e.get(t);return n||_E(e,{id:t,children:[]})}function _E(e,t){const n=e.get(t.id);return n?.span?n:n&&!n.span?(n.span=t.span,n.parentNode=t.parentNode,n):(e.set(t.id,t),t)}const j0={1:"cancelled",2:"unknown_error",3:"invalid_argument",4:"deadline_exceeded",5:"not_found",6:"already_exists",7:"permission_denied",8:"resource_exhausted",9:"failed_precondition",10:"aborted",11:"out_of_range",12:"unimplemented",13:"internal_error",14:"unavailable",15:"data_loss",16:"unauthenticated"},sY=e=>Object.values(j0).includes(e);function q0(e){const t=UT(e)?e.attributes:{},n=bq(e)?e.status:void 0;if(n){if(n.code===D.SpanStatusCode.OK)return{code:yl};if(n.code===D.SpanStatusCode.ERROR){if(typeof n.message>"u"){const s=qy(t);if(s)return s}return n.message&&sY(n.message)?{code:be,message:n.message}:{code:be,message:"internal_error"}}}const r=qy(t);return r||(n?.code===D.SpanStatusCode.UNSET?{code:yl}:{code:be,message:"unknown_error"})}function qy(e){const t=e[ne.ATTR_HTTP_RESPONSE_STATUS_CODE]||e[ne.SEMATTRS_HTTP_STATUS_CODE],n=e[ne.SEMATTRS_RPC_GRPC_STATUS_CODE],r=typeof t=="number"?t:typeof t=="string"?parseInt(t):void 0;if(typeof r=="number")return Qh(r);if(typeof n=="string")return{code:be,message:j0[n]||"unknown_error"}}const Yy=1e3,Wy=300;class iY{constructor(t){this._finishedSpanBucketSize=t?.timeout||Wy,this._finishedSpanBuckets=new Array(this._finishedSpanBucketSize).fill(void 0),this._lastCleanupTimestampInS=Math.floor(Date.now()/1e3),this._spansToBucketEntry=new WeakMap,this._sentSpans=new Map,this._debouncedFlush=V$(this.flush.bind(this),1,{maxWait:100})}export(t){const n=Math.floor(Date.now()/1e3);if(this._lastCleanupTimestampInS!==n){let o=0;this._finishedSpanBuckets.forEach((c,a)=>{c&&c.timestampInS<=n-this._finishedSpanBucketSize&&(o+=c.spans.size,this._finishedSpanBuckets[a]=void 0)}),o>0&&Yn&&Y.log(`SpanExporter dropped ${o} spans because they were pending for more than ${this._finishedSpanBucketSize} seconds.`),this._lastCleanupTimestampInS=n}const r=n%this._finishedSpanBucketSize,s=this._finishedSpanBuckets[r]||{timestampInS:n,spans:new Set};this._finishedSpanBuckets[r]=s,s.spans.add(t),this._spansToBucketEntry.set(t,s);const i=F0(t);(!i||this._sentSpans.has(i))&&this._debouncedFlush()}flush(){const t=this._finishedSpanBuckets.flatMap(o=>o?Array.from(o.spans):[]);this._flushSentSpanCache();const n=this._maybeSend(t),r=n.size,s=t.length-r;Yn&&Y.log(`SpanExporter exported ${r} spans, ${s} spans are waiting for their parent spans to finish`);const i=Date.now()+Wy*1e3;for(const o of n){this._sentSpans.set(o.spanContext().spanId,i);const c=this._spansToBucketEntry.get(o);c&&c.spans.delete(o)}this._debouncedFlush.cancel()}clear(){this._finishedSpanBuckets=this._finishedSpanBuckets.fill(void 0),this._sentSpans.clear(),this._debouncedFlush.cancel()}_maybeSend(t){const n=tY(t),r=new Set,s=this._getCompletedRootNodes(n);for(const i of s){const o=i.span;r.add(o);const c=aY(o);if(i.parentNode&&this._sentSpans.has(i.parentNode.id)){const f=c.contexts?.trace?.data;f&&(f["sentry.parent_span_already_sent"]=!0)}const a=c.spans||[];for(const f of i.children)pE(f,a,r);c.spans=a.length>Yy?a.sort((f,d)=>f.start_timestamp-d.start_timestamp).slice(0,Yy):a;const l=Ol(o.events);l&&(c.measurements=l),HV(c)}return r}_flushSentSpanCache(){const t=Date.now();for(const[n,r]of this._sentSpans.entries())r<=t&&this._sentSpans.delete(n)}_nodeIsCompletedRootNodeOrHasSentParent(t){return!!t.span&&(!t.parentNode||this._sentSpans.has(t.parentNode.id))}_getCompletedRootNodes(t){return t.filter(n=>this._nodeIsCompletedRootNodeOrHasSentParent(n))}}function oY(e){const t=e.attributes,n=t[He],r=t[Re],s=t[cn];return{origin:n,op:r,source:s}}function aY(e){const{op:t,description:n,data:r,origin:s="manual",source:i}=Y0(e),o=Hi(e),c=e.attributes[Vi],a={[cn]:i,[Vi]:c,[Re]:t,[He]:s,...r,...W0(e.attributes)},{links:l}=e,{traceId:f,spanId:d}=e.spanContext(),u=DT(e),_=q0(e),p={parent_span_id:u,span_id:d,trace_id:f,data:a,origin:s,op:t,status:pd(_),links:_d(l)},h=a[ne.ATTR_HTTP_RESPONSE_STATUS_CODE],E=typeof h=="number"?{response:{status_code:h}}:void 0;return{contexts:{trace:p,otel:{resource:e.resource.attributes},...E},spans:[],start_timestamp:Fn(e.startTime),timestamp:Fn(e.endTime),transaction:n,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:o.scope,capturedSpanIsolationScope:o.isolationScope,sampleRate:c,dynamicSamplingContext:zt(e)},...i&&{transaction_info:{source:i}}}}function pE(e,t,n){const r=e.span;if(r&&n.add(r),!r){e.children.forEach(m=>{pE(m,t,n)});return}const i=r.spanContext().spanId,o=r.spanContext().traceId,c=DT(r),{attributes:a,startTime:l,endTime:f,links:d}=r,{op:u,description:_,data:p,origin:h="manual"}=Y0(r),E={[He]:h,[Re]:u,...W0(a),...p},T=q0(r),S={span_id:i,trace_id:o,data:E,description:_,parent_span_id:c,start_timestamp:Fn(l),timestamp:Fn(f)||void 0,status:pd(T),op:u,origin:h,measurements:Ol(r.events),links:_d(d)};t.push(S),e.children.forEach(m=>{pE(m,t,n)})}function Y0(e){const{op:t,source:n,origin:r}=oY(e),{op:s,description:i,source:o,data:c}=P0(e),a=t||s,l=n||o,f={...c,...cY(e)};return{op:a,description:i,source:l,origin:r,data:f}}function W0(e){const t={...e};return delete t[Vi],delete t[LT],delete t[$i],t}function cY(e){const t=e.attributes,n={};e.kind!==D.SpanKind.INTERNAL&&(n["otel.kind"]=D.SpanKind[e.kind]);const r=t[ne.SEMATTRS_HTTP_STATUS_CODE];r&&(n[ne.ATTR_HTTP_RESPONSE_STATUS_CODE]=r);const s=Iq(e);return s.url&&(n.url=s.url),s["http.query"]&&(n["http.query"]=s["http.query"].slice(1)),s["http.fragment"]&&(n["http.fragment"]=s["http.fragment"].slice(1)),n}function uY(e,t){const n=D.trace.getSpan(t);let r=no(t);n&&!n.spanContext().isRemote&&hT(n,e),n?.spanContext().isRemote&&e.setAttribute(LT,!0),t===D.ROOT_CONTEXT&&(r={scope:cT(),isolationScope:Qi()}),r&&fw(e,r.scope,r.isolationScope),Ow(e),ye()?.emit("spanStart",e)}function lY(e){bw(e),ye()?.emit("spanEnd",e)}class dY{constructor(t){Pd("SentrySpanProcessor"),this._exporter=new iY(t)}async forceFlush(){this._exporter.flush()}async shutdown(){this._exporter.clear()}onStart(t,n){uY(t,n)}onEnd(t){lY(t),this._exporter.export(t)}}class fY{constructor(t){this._client=t,Pd("SentrySampler")}shouldSample(t,n,r,s,i,o){const c=this._client.getOptions(),a=hY(t),l=a?.spanContext();if(!un(c))return pi({decision:void 0,context:t,spanAttributes:i});const f=i[ne.SEMATTRS_HTTP_METHOD]||i[ne.ATTR_HTTP_REQUEST_METHOD];if(s===D.SpanKind.CLIENT&&f&&(!a||l?.isRemote))return pi({decision:void 0,context:t,spanAttributes:i});const d=a?_Y(a,n,r):void 0;if(!(!a||l?.isRemote))return pi({decision:d?qt.RECORD_AND_SAMPLED:qt.NOT_RECORD,context:t,spanAttributes:i});const{description:_,data:p,op:h}=v0(r,i,s),E={...p,...i};h&&(E[Re]=h);const T={decision:!0};if(this._client.emit("beforeSampling",{spanAttributes:E,spanName:_,parentSampled:d,parentContext:l},T),!T.decision)return pi({decision:void 0,context:t,spanAttributes:i});const{isolationScope:S}=no(t)??{},m=l?.traceState?l.traceState.get(kT):void 0,g=m?hu(m):void 0,y=Zs(g?.sample_rand)??Math.random(),[A,N,O]=Iw(c,{name:_,attributes:E,normalizedRequest:S?.getScopeData().sdkProcessingMetadata.normalizedRequest,parentSampled:d,parentSampleRate:Zs(g?.sample_rate)},y),b=`${f}`.toUpperCase();return b==="OPTIONS"||b==="HEAD"?(Yn&&Y.log(`[Tracing] Not sampling span because HTTP method is '${b}' for ${r}`),pi({decision:qt.NOT_RECORD,context:t,spanAttributes:i,sampleRand:y,downstreamTraceSampleRate:0})):(!A&&d===void 0&&(Yn&&Y.log("[Tracing] Discarding root span because its trace was not chosen to be sampled."),this._client.recordDroppedEvent("sample_rate","transaction")),{...pi({decision:A?qt.RECORD_AND_SAMPLED:qt.NOT_RECORD,context:t,spanAttributes:i,sampleRand:y,downstreamTraceSampleRate:O?N:void 0}),attributes:{[Vi]:O?N:void 0}})}toString(){return"SentrySampler"}}function _Y(e,t,n){const r=e.spanContext();if(D.isSpanContextValid(r)&&r.traceId===t){if(r.isRemote){const i=ji(e.spanContext());return Yn&&Y.log(`[Tracing] Inheriting remote parent's sampled decision for ${n}: ${i}`),i}const s=ji(r);return Yn&&Y.log(`[Tracing] Inheriting parent's sampled decision for ${n}: ${s}`),s}}function pi({decision:e,context:t,spanAttributes:n,sampleRand:r,downstreamTraceSampleRate:s}){let i=pY(t,n);return s!==void 0&&(i=i.set(Pq,`${s}`)),r!==void 0&&(i=i.set(vq,`${r}`)),e==null?{decision:qt.NOT_RECORD,traceState:i}:e===qt.NOT_RECORD?{decision:e,traceState:i.set(xT,"1")}:{decision:e,traceState:i}}function pY(e,t){let s=D.trace.getSpan(e)?.spanContext()?.traceState||new Zi;const i=t[ne.SEMATTRS_HTTP_URL]||t[ne.ATTR_URL_FULL];return i&&typeof i=="string"&&(s=s.set(O0,i)),s}function hY(e){const t=D.trace.getSpan(e);return t&&D.isSpanContextValid(t.spanContext())?t:void 0}function hE(e,t){if(!e)return t;const n=Nl(e),r=Nl(t);if(!r)return e;const s={...n};return Object.entries(r).forEach(([i,o])=>{s[i]||(s[i]=o)}),_w(s)}function EY(e,t){const n=SY(e),r=t?.statusCode,s=p0(r);Fi({category:"http",data:{status_code:r,...n},type:"http",level:s},{event:"response",request:e,response:t})}function TY(e,t){const n=gY(e),r=ye()?.getOptions().tracePropagationTargets,s=BT(n,r,t)?Kw():void 0;if(!s)return;const{"sentry-trace":i,baggage:o}=s;if(i&&!e.getHeader("sentry-trace"))try{e.setHeader("sentry-trace",i),De&&Y.log(yi,"Added sentry-trace header to outgoing request")}catch(c){De&&Y.error(yi,"Failed to add sentry-trace header to outgoing request:",ml(c)?c.message:"Unknown error")}if(o){const c=hE(e.getHeader("baggage"),o);if(c)try{e.setHeader("baggage",c),De&&Y.log(yi,"Added baggage header to outgoing request")}catch(a){De&&Y.error(yi,"Failed to add baggage header to outgoing request:",ml(a)?a.message:"Unknown error")}}}function SY(e){try{const t=e.getHeader("host")||e.host,n=new URL(e.path,`${e.protocol}//${t}`),r=Sd(n.toString()),s={url:md(r),"http.method":e.method||"GET"};return r.search&&(s["http.query"]=r.search),r.hash&&(s["http.fragment"]=r.hash),s}catch{return{}}}function mY(e){return{method:e.method,protocol:e.protocol,host:e.host,hostname:e.host,path:e.path,headers:e.getHeaders()}}function gY(e){const t=e.getHeader("host")||e.host,n=e.protocol,r=e.path;return`${n}//${t}${r}`}class K0 extends Ut{constructor(t={}){super(yi,at,t),this._propagationDecisionMap=new to(100),this._ignoreOutgoingRequestsMap=new WeakMap}init(){let t=!1;const n=(c=>{const a=c;this._onOutgoingRequestFinish(a.request,a.response)}),r=(c=>{const a=c;this._onOutgoingRequestFinish(a.request,void 0)}),s=(c=>{const a=c;this._onOutgoingRequestCreated(a.request)}),i=c=>(t||(t=!0,$n.subscribe("http.client.response.finish",n),$n.subscribe("http.client.request.error",r),this.getConfig().propagateTraceInOutgoingRequests&&$n.subscribe("http.client.request.created",s)),c),o=()=>{$n.unsubscribe("http.client.response.finish",n),$n.unsubscribe("http.client.request.error",r),$n.unsubscribe("http.client.request.created",s)};return[new St("http",["*"],i,o),new St("https",["*"],i,o)]}_onOutgoingRequestFinish(t,n){De&&Y.log(yi,"Handling finished outgoing request");const r=this.getConfig().breadcrumbs,s=typeof r>"u"?!0:r,i=this._ignoreOutgoingRequestsMap.get(t)??this._shouldIgnoreOutgoingRequest(t);this._ignoreOutgoingRequestsMap.set(t,i),s&&!i&&EY(t,n)}_onOutgoingRequestCreated(t){const n=this._ignoreOutgoingRequestsMap.get(t)??this._shouldIgnoreOutgoingRequest(t);this._ignoreOutgoingRequestsMap.set(t,n),!n&&TY(t,this._propagationDecisionMap)}_shouldIgnoreOutgoingRequest(t){if(Kn(D.context.active()))return!0;const n=this.getConfig().ignoreOutgoingRequests;if(!n)return!1;const r=mY(t),s=S0(t);return n(s,r)}}const z0="Http",AY=Pe(`${z0}.sentry`,e=>new K0(e)),RY=(e={})=>{const t={sessions:e.trackIncomingRequestsAsSessions,sessionFlushingDelayMS:e.sessionFlushingDelayMS,ignoreRequestBody:e.ignoreIncomingRequestBody,maxRequestBodySize:e.maxIncomingRequestBodySize},n={ignoreIncomingRequests:e.ignoreIncomingRequests,ignoreStaticAssets:e.ignoreStaticAssets,ignoreStatusCodes:e.dropSpansForIncomingRequestStatusCodes},r={breadcrumbs:e.breadcrumbs,propagateTraceInOutgoingRequests:!0,ignoreOutgoingRequests:e.ignoreOutgoingRequests},s=E0(t),i=T0(n),o=e.spans??!1,c=e.disableIncomingRequestSpans??!1,a=o&&!c;return{name:z0,setup(l){a&&i.setup(l)},setupOnce(){s.setupOnce(),AY(r)},processEvent(l){return i.processEvent(l)}}},Md=pG(process.versions.node),Di=Md.major,EE=Md.minor,Mu="sentry-trace",Bf="baggage",Ky=/baggage: (.*)\r\n/;class Z0 extends Ut{constructor(t={}){super("@sentry/instrumentation-node-fetch",at,t),this._channelSubs=[],this._propagationDecisionMap=new to(100),this._ignoreOutgoingRequestsMap=new WeakMap}init(){}disable(){super.disable(),this._channelSubs.forEach(t=>t.unsubscribe()),this._channelSubs=[]}enable(){super.enable(),this._channelSubs=this._channelSubs||[],!(this._channelSubs.length>0)&&(this._subscribeToChannel("undici:request:create",this._onRequestCreated.bind(this)),this._subscribeToChannel("undici:request:headers",this._onResponseHeaders.bind(this)))}_onRequestCreated({request:t}){if(!(this.getConfig().enabled!==!1))return;const s=this._shouldIgnoreOutgoingRequest(t);if(this._ignoreOutgoingRequestsMap.set(t,s),s)return;const i=TE(t.origin,t.path),o=ye()?.getOptions().tracePropagationTargets,c=BT(i,o,this._propagationDecisionMap)?Kw():void 0;if(!c)return;const{"sentry-trace":a,baggage:l}=c;if(Array.isArray(t.headers)){const f=t.headers;a&&!f.includes(Mu)&&f.push(Mu,a);const d=f.findIndex(u=>u===Bf);if(l&&d===-1)f.push(Bf,l);else if(l){const u=f[d+1],_=hE(u,l);_&&(f[d+1]=_)}}else{const f=t.headers;a&&!f.includes(`${Mu}:`)&&(t.headers+=`${Mu}: ${a}\r
`);const d=t.headers.match(Ky)?.[1];if(l&&!d)t.headers+=`${Bf}: ${l}\r
`;else if(l){const u=hE(d,l);u&&(t.headers=t.headers.replace(Ky,`baggage: ${u}\r
`))}}}_onResponseHeaders({request:t,response:n}){const r=this.getConfig();if(!(r.enabled!==!1))return;const i=r.breadcrumbs,o=typeof i>"u"?!0:i,c=this._ignoreOutgoingRequestsMap.get(t);o&&!c&&yY(t,n)}_subscribeToChannel(t,n){const r=Di>18||Di===18&&EE>=19;let s;if(r)ef.subscribe?.(t,n),s=()=>ef.unsubscribe?.(t,n);else{const i=ef.channel(t);i.subscribe(n),s=()=>i.unsubscribe(n)}this._channelSubs.push({name:t,unsubscribe:s})}_shouldIgnoreOutgoingRequest(t){if(Kn(D.context.active()))return!0;const n=TE(t.origin,t.path),r=this.getConfig().ignoreOutgoingRequests;return typeof r!="function"||!n?!1:r(n)}}function yY(e,t){const n=NY(e),r=t.statusCode,s=p0(r);Fi({category:"http",data:{status_code:r,...n},type:"http",level:s},{event:"response",request:e,response:t})}function NY(e){try{const t=TE(e.origin,e.path),n=Sd(t),r={url:md(n),"http.method":e.method||"GET"};return n.search&&(r["http.query"]=n.search),n.hash&&(r["http.fragment"]=n.hash),r}catch{return{}}}function TE(e,t="/"){try{return new URL(t,e).toString()}catch{const n=`${e}`;return n.endsWith("/")&&t.startsWith("/")?`${n}${t.slice(1)}`:!n.endsWith("/")&&!t.startsWith("/")?`${n}/${t.slice(1)}`:`${n}${t}`}}const OY="NodeFetch",bY=Pe(`${OY}.sentry`,Z0,e=>e),IY=((e={})=>({name:"NodeFetch",setupOnce(){bY(e)}})),CY=IY,vY=lu.promisify(me.readFile),PY=lu.promisify(me.readdir),MY="Context",wY=((e={})=>{let t;const n={app:!0,os:!0,device:!0,culture:!0,cloudResource:!0,...e};async function r(i){t===void 0&&(t=s());const o=DY(await t);return i.contexts={...i.contexts,app:{...o.app,...i.contexts?.app},os:{...o.os,...i.contexts?.os},device:{...o.device,...i.contexts?.device},culture:{...o.culture,...i.contexts?.culture},cloud_resource:{...o.cloud_resource,...i.contexts?.cloud_resource}},i}async function s(){const i={};if(n.os&&(i.os=await UY()),n.app&&(i.app=xY()),n.device&&(i.device=BY(n.device)),n.culture){const o=kY();o&&(i.culture=o)}return n.cloudResource&&(i.cloud_resource=jY()),i}return{name:MY,processEvent(i){return r(i)}}}),LY=wY;function DY(e){if(e.app?.app_memory&&(e.app.app_memory=process.memoryUsage().rss),e.app?.free_memory&&typeof process.availableMemory=="function"){const t=process.availableMemory?.();t!=null&&(e.app.free_memory=t)}return e.device?.free_memory&&(e.device.free_memory=jt.freemem()),e}async function UY(){const e=jt.platform();switch(e){case"darwin":return HY();case"linux":return FY();default:return{name:GY[e]||e,version:jt.release()}}}function kY(){try{if(typeof process.versions.icu!="string")return;const e=new Date(9e8);if(new Intl.DateTimeFormat("es",{month:"long"}).format(e)==="enero"){const n=Intl.DateTimeFormat().resolvedOptions();return{locale:n.locale,timezone:n.timeZone}}}catch{}}function xY(){const e=process.memoryUsage().rss,n={app_start_time:new Date(Date.now()-process.uptime()*1e3).toISOString(),app_memory:e};if(typeof process.availableMemory=="function"){const r=process.availableMemory?.();r!=null&&(n.free_memory=r)}return n}function BY(e){const t={};let n;try{n=jt.uptime()}catch{}if(typeof n=="number"&&(t.boot_time=new Date(Date.now()-n*1e3).toISOString()),t.arch=jt.arch(),(e===!0||e.memory)&&(t.memory_size=jt.totalmem(),t.free_memory=jt.freemem()),e===!0||e.cpu){const r=jt.cpus(),s=r?.[0];s&&(t.processor_count=r.length,t.cpu_description=s.model,t.processor_frequency=s.speed)}return t}const GY={aix:"IBM AIX",freebsd:"FreeBSD",openbsd:"OpenBSD",sunos:"SunOS",win32:"Windows",ohos:"OpenHarmony",android:"Android"},VY=[{name:"fedora-release",distros:["Fedora"]},{name:"redhat-release",distros:["Red Hat Linux","Centos"]},{name:"redhat_version",distros:["Red Hat Linux"]},{name:"SuSE-release",distros:["SUSE Linux"]},{name:"lsb-release",distros:["Ubuntu Linux","Arch Linux"]},{name:"debian_version",distros:["Debian"]},{name:"debian_release",distros:["Debian"]},{name:"arch-release",distros:["Arch Linux"]},{name:"gentoo-release",distros:["Gentoo Linux"]},{name:"novell-release",distros:["SUSE Linux"]},{name:"alpine-release",distros:["Alpine Linux"]}],$Y={alpine:e=>e,arch:e=>Gn(/distrib_release=(.*)/,e),centos:e=>Gn(/release ([^ ]+)/,e),debian:e=>e,fedora:e=>Gn(/release (..)/,e),mint:e=>Gn(/distrib_release=(.*)/,e),red:e=>Gn(/release ([^ ]+)/,e),suse:e=>Gn(/VERSION = (.*)\n/,e),ubuntu:e=>Gn(/distrib_release=(.*)/,e)};function Gn(e,t){const n=e.exec(t);return n?n[1]:void 0}async function HY(){const e={kernel_version:jt.release(),name:"Mac OS X",version:`10.${Number(jt.release().split(".")[0])-4}`};try{const t=await new Promise((n,r)=>{ou.execFile("/usr/bin/sw_vers",(s,i)=>{if(s){r(s);return}n(i)})});e.name=Gn(/^ProductName:\s+(.*)$/m,t),e.version=Gn(/^ProductVersion:\s+(.*)$/m,t),e.build=Gn(/^BuildVersion:\s+(.*)$/m,t)}catch{}return e}function zy(e){return e.split(" ")[0].toLowerCase()}async function FY(){const e={kernel_version:jt.release(),name:"Linux"};try{const t=await PY("/etc"),n=VY.find(c=>t.includes(c.name));if(!n)return e;const r=he.join("/etc",n.name),s=(await vY(r,{encoding:"utf-8"})).toLowerCase(),{distros:i}=n;e.name=i.find(c=>s.indexOf(zy(c))>=0)||i[0];const o=zy(e.name);e.version=$Y[o]?.(s)}catch{}return e}function jY(){return process.env.VERCEL?{"cloud.provider":"vercel","cloud.region":process.env.VERCEL_REGION}:process.env.AWS_REGION?{"cloud.provider":"aws","cloud.region":process.env.AWS_REGION,"cloud.platform":process.env.AWS_EXECUTION_ENV}:process.env.GCP_PROJECT?{"cloud.provider":"gcp"}:process.env.ALIYUN_REGION_ID?{"cloud.provider":"alibaba_cloud","cloud.region":process.env.ALIYUN_REGION_ID}:process.env.WEBSITE_SITE_NAME&&process.env.REGION_NAME?{"cloud.provider":"azure","cloud.region":process.env.REGION_NAME}:process.env.IBM_CLOUD_REGION?{"cloud.provider":"ibm_cloud","cloud.region":process.env.IBM_CLOUD_REGION}:process.env.TENCENTCLOUD_REGION?{"cloud.provider":"tencent_cloud","cloud.region":process.env.TENCENTCLOUD_REGION,"cloud.account.id":process.env.TENCENTCLOUD_APPID,"cloud.availability_zone":process.env.TENCENTCLOUD_ZONE}:process.env.NETLIFY?{"cloud.provider":"netlify"}:process.env.FLY_REGION?{"cloud.provider":"fly.io","cloud.region":process.env.FLY_REGION}:process.env.DYNO?{"cloud.provider":"heroku"}:void 0}const SE=new to(10),X0=new to(20),qY=7,YY="ContextLines",WY=1e3,KY=1e4;function zY(e,t,n){const r=e.get(t);return r===void 0?(e.set(t,n),n):r}function ZY(e){return!!(e.startsWith("node:")||e.endsWith(".min.js")||e.endsWith(".min.cjs")||e.endsWith(".min.mjs")||e.startsWith("data:"))}function XY(e){return e.lineno!==void 0&&e.lineno>KY||e.colno!==void 0&&e.colno>WY}function QY(e,t){const n=SE.get(e);if(n===void 0)return!1;for(let r=t[0];r<=t[1];r++)if(n[r]===void 0)return!1;return!0}function JY(e,t){if(!e.length)return[];let n=0;const r=e[0];if(typeof r!="number")return[];let s=Xy(r,t);const i=[];for(;;){if(n===e.length-1){i.push(s);break}const o=e[n+1];if(typeof o!="number")break;o<=s[1]?s[1]=o+t:(i.push(s),s=Xy(o,t)),n++}return i}function eW(e,t,n){return new Promise((r,s)=>{const i=me.createReadStream(e),o=Ik.createInterface({input:i});function c(){i.destroy(),r()}let a=0,l=0;const f=t[l];if(f===void 0){c();return}let d=f[0],u=f[1];function _(p){X0.set(e,1),De&&Y.error(`Failed to read file: ${e}. Error: ${p}`),o.close(),o.removeAllListeners(),c()}i.on("error",_),o.on("error",_),o.on("close",c),o.on("line",p=>{if(a++,!(a<d)&&(n[a]=cG(p,0),a>=u)){if(l===t.length-1){o.close(),o.removeAllListeners();return}l++;const h=t[l];if(h===void 0){o.close(),o.removeAllListeners();return}d=h[0],u=h[1]}})})}async function tW(e,t){const n={};if(t>0&&e.exception?.values){for(const i of e.exception.values)if(i.stacktrace?.frames?.length)for(let o=i.stacktrace.frames.length-1;o>=0;o--){const c=i.stacktrace.frames[o],a=c?.filename;if(!c||typeof a!="string"||typeof c.lineno!="number"||ZY(a)||XY(c))continue;n[a]||(n[a]=[]),n[a].push(c.lineno)}}const r=Object.keys(n);if(r.length==0)return e;const s=[];for(const i of r){if(X0.get(i))continue;const o=n[i];if(!o)continue;o.sort((l,f)=>l-f);const c=JY(o,t);if(c.every(l=>QY(i,l)))continue;const a=zY(SE,i,{});s.push(eW(i,c,a))}if(await Promise.all(s).catch(()=>{De&&Y.log("Failed to read one or more source files and resolve context lines")}),t>0&&e.exception?.values)for(const i of e.exception.values)i.stacktrace?.frames&&i.stacktrace.frames.length>0&&nW(i.stacktrace.frames,t,SE);return e}function nW(e,t,n){for(const r of e)if(r.filename&&r.context_line===void 0&&typeof r.lineno=="number"){const s=n.get(r.filename);if(s===void 0)continue;rW(r.lineno,r,t,s)}}function Zy(e){delete e.pre_context,delete e.context_line,delete e.post_context}function rW(e,t,n,r){if(t.lineno===void 0||r===void 0){De&&Y.error("Cannot resolve context for frame with no lineno or file contents");return}t.pre_context=[];for(let i=Q0(e,n);i<e;i++){const o=r[i];if(o===void 0){Zy(t),De&&Y.error(`Could not find line ${i} in file ${t.filename}`);return}t.pre_context.push(o)}if(r[e]===void 0){Zy(t),De&&Y.error(`Could not find line ${e} in file ${t.filename}`);return}t.context_line=r[e];const s=J0(e,n);t.post_context=[];for(let i=e+1;i<=s;i++){const o=r[i];if(o===void 0)break;t.post_context.push(o)}}function Q0(e,t){return Math.max(1,e-t)}function J0(e,t){return e+t}function Xy(e,t){return[Q0(e,t),J0(e,t)]}const sW=((e={})=>{const t=e.frameContextLines!==void 0?e.frameContextLines:qY;return{name:YY,processEvent(n){return tW(n,t)}}}),iW=sW;let wu;async function eL(){if(wu===void 0)try{wu=!!(await import("node:inspector")).url()}catch{wu=!1}return wu}const Lu="__SENTRY_ERROR_LOCAL_VARIABLES__";function oW(e,t,n){let r=0,s=5,i=0;return setInterval(()=>{i===0?r>e&&(s*=2,n(s),s>86400&&(s=86400),i=s):(i-=1,i===0&&t()),r=0},1e3).unref(),()=>{r+=1}}function Qy(e){return e!==void 0&&(e.length===0||e==="?"||e==="<anonymous>")}function tL(e,t){return e===t||`Object.${e}`===t||e===`Object.${t}`||Qy(e)&&Qy(t)}const aW="LyohIEBzZW50cnkvbm9kZS1jb3JlIDEwLjI5LjAgKDM1MjlkNDYpIHwgaHR0cHM6Ly9naXRodWIuY29tL2dldHNlbnRyeS9zZW50cnktamF2YXNjcmlwdCAqLwppbXBvcnR7U2Vzc2lvbiBhcyBlfWZyb20ibm9kZTppbnNwZWN0b3IvcHJvbWlzZXMiO2ltcG9ydHt3b3JrZXJEYXRhIGFzIHR9ZnJvbSJub2RlOndvcmtlcl90aHJlYWRzIjtjb25zdCBuPWdsb2JhbFRoaXMsaT17fTtjb25zdCBvPSJfX1NFTlRSWV9FUlJPUl9MT0NBTF9WQVJJQUJMRVNfXyI7Y29uc3QgYT10O2Z1bmN0aW9uIHMoLi4uZSl7YS5kZWJ1ZyYmZnVuY3Rpb24oZSl7aWYoISgiY29uc29sZSJpbiBuKSlyZXR1cm4gZSgpO2NvbnN0IHQ9bi5jb25zb2xlLG89e30sYT1PYmplY3Qua2V5cyhpKTthLmZvckVhY2goZT0+e2NvbnN0IG49aVtlXTtvW2VdPXRbZV0sdFtlXT1ufSk7dHJ5e3JldHVybiBlKCl9ZmluYWxseXthLmZvckVhY2goZT0+e3RbZV09b1tlXX0pfX0oKCk9PmNvbnNvbGUubG9nKCJbTG9jYWxWYXJpYWJsZXMgV29ya2VyXSIsLi4uZSkpfWFzeW5jIGZ1bmN0aW9uIGMoZSx0LG4saSl7Y29uc3Qgbz1hd2FpdCBlLnBvc3QoIlJ1bnRpbWUuZ2V0UHJvcGVydGllcyIse29iamVjdElkOnQsb3duUHJvcGVydGllczohMH0pO2lbbl09by5yZXN1bHQuZmlsdGVyKGU9PiJsZW5ndGgiIT09ZS5uYW1lJiYhaXNOYU4ocGFyc2VJbnQoZS5uYW1lLDEwKSkpLnNvcnQoKGUsdCk9PnBhcnNlSW50KGUubmFtZSwxMCktcGFyc2VJbnQodC5uYW1lLDEwKSkubWFwKGU9PmUudmFsdWU/LnZhbHVlKX1hc3luYyBmdW5jdGlvbiByKGUsdCxuLGkpe2NvbnN0IG89YXdhaXQgZS5wb3N0KCJSdW50aW1lLmdldFByb3BlcnRpZXMiLHtvYmplY3RJZDp0LG93blByb3BlcnRpZXM6ITB9KTtpW25dPW8ucmVzdWx0Lm1hcChlPT5bZS5uYW1lLGUudmFsdWU/LnZhbHVlXSkucmVkdWNlKChlLFt0LG5dKT0+KGVbdF09bixlKSx7fSl9ZnVuY3Rpb24gdShlLHQpe2UudmFsdWUmJigidmFsdWUiaW4gZS52YWx1ZT92b2lkIDA9PT1lLnZhbHVlLnZhbHVlfHxudWxsPT09ZS52YWx1ZS52YWx1ZT90W2UubmFtZV09YDwke2UudmFsdWUudmFsdWV9PmA6dFtlLm5hbWVdPWUudmFsdWUudmFsdWU6ImRlc2NyaXB0aW9uImluIGUudmFsdWUmJiJmdW5jdGlvbiIhPT1lLnZhbHVlLnR5cGU/dFtlLm5hbWVdPWA8JHtlLnZhbHVlLmRlc2NyaXB0aW9ufT5gOiJ1bmRlZmluZWQiPT09ZS52YWx1ZS50eXBlJiYodFtlLm5hbWVdPSI8dW5kZWZpbmVkPiIpKX1hc3luYyBmdW5jdGlvbiBsKGUsdCl7Y29uc3Qgbj1hd2FpdCBlLnBvc3QoIlJ1bnRpbWUuZ2V0UHJvcGVydGllcyIse29iamVjdElkOnQsb3duUHJvcGVydGllczohMH0pLGk9e307Zm9yKGNvbnN0IHQgb2Ygbi5yZXN1bHQpaWYodC52YWx1ZT8ub2JqZWN0SWQmJiJBcnJheSI9PT10LnZhbHVlLmNsYXNzTmFtZSl7Y29uc3Qgbj10LnZhbHVlLm9iamVjdElkO2F3YWl0IGMoZSxuLHQubmFtZSxpKX1lbHNlIGlmKHQudmFsdWU/Lm9iamVjdElkJiYiT2JqZWN0Ij09PXQudmFsdWUuY2xhc3NOYW1lKXtjb25zdCBuPXQudmFsdWUub2JqZWN0SWQ7YXdhaXQgcihlLG4sdC5uYW1lLGkpfWVsc2UgdC52YWx1ZSYmdSh0LGkpO3JldHVybiBpfWxldCBmOyhhc3luYyBmdW5jdGlvbigpe2NvbnN0IHQ9bmV3IGU7dC5jb25uZWN0VG9NYWluVGhyZWFkKCkscygiQ29ubmVjdGVkIHRvIG1haW4gdGhyZWFkIik7bGV0IG49ITE7dC5vbigiRGVidWdnZXIucmVzdW1lZCIsKCk9PntuPSExfSksdC5vbigiRGVidWdnZXIucGF1c2VkIixlPT57bj0hMCxhc3luYyBmdW5jdGlvbihlLHtyZWFzb246dCxkYXRhOntvYmplY3RJZDpufSxjYWxsRnJhbWVzOml9KXtpZigiZXhjZXB0aW9uIiE9PXQmJiJwcm9taXNlUmVqZWN0aW9uIiE9PXQpcmV0dXJuO2lmKGY/LigpLG51bGw9PW4pcmV0dXJuO2NvbnN0IGE9W107Zm9yKGxldCB0PTA7dDxpLmxlbmd0aDt0Kyspe2NvbnN0e3Njb3BlQ2hhaW46bixmdW5jdGlvbk5hbWU6byx0aGlzOnN9PWlbdF0sYz1uLmZpbmQoZT0+ImxvY2FsIj09PWUudHlwZSkscj0iZ2xvYmFsIiE9PXMuY2xhc3NOYW1lJiZzLmNsYXNzTmFtZT9gJHtzLmNsYXNzTmFtZX0uJHtvfWA6bztpZih2b2lkIDA9PT1jPy5vYmplY3Qub2JqZWN0SWQpYVt0XT17ZnVuY3Rpb246cn07ZWxzZXtjb25zdCBuPWF3YWl0IGwoZSxjLm9iamVjdC5vYmplY3RJZCk7YVt0XT17ZnVuY3Rpb246cix2YXJzOm59fX1hd2FpdCBlLnBvc3QoIlJ1bnRpbWUuY2FsbEZ1bmN0aW9uT24iLHtmdW5jdGlvbkRlY2xhcmF0aW9uOmBmdW5jdGlvbigpIHsgdGhpcy4ke299ID0gdGhpcy4ke299IHx8ICR7SlNPTi5zdHJpbmdpZnkoYSl9OyB9YCxzaWxlbnQ6ITAsb2JqZWN0SWQ6bn0pLGF3YWl0IGUucG9zdCgiUnVudGltZS5yZWxlYXNlT2JqZWN0Iix7b2JqZWN0SWQ6bn0pfSh0LGUucGFyYW1zKS50aGVuKGFzeW5jKCk9PntuJiZhd2FpdCB0LnBvc3QoIkRlYnVnZ2VyLnJlc3VtZSIpfSxhc3luYyBlPT57biYmYXdhaXQgdC5wb3N0KCJEZWJ1Z2dlci5yZXN1bWUiKX0pfSksYXdhaXQgdC5wb3N0KCJEZWJ1Z2dlci5lbmFibGUiKTtjb25zdCBpPSExIT09YS5jYXB0dXJlQWxsRXhjZXB0aW9ucztpZihhd2FpdCB0LnBvc3QoIkRlYnVnZ2VyLnNldFBhdXNlT25FeGNlcHRpb25zIix7c3RhdGU6aT8iYWxsIjoidW5jYXVnaHQifSksaSl7Y29uc3QgZT1hLm1heEV4Y2VwdGlvbnNQZXJTZWNvbmR8fDUwO2Y9ZnVuY3Rpb24oZSx0LG4pe2xldCBpPTAsbz01LGE9MDtyZXR1cm4gc2V0SW50ZXJ2YWwoKCk9PnswPT09YT9pPmUmJihvKj0yLG4obyksbz44NjQwMCYmKG89ODY0MDApLGE9byk6KGEtPTEsMD09PWEmJnQoKSksaT0wfSwxZTMpLnVucmVmKCksKCk9PntpKz0xfX0oZSxhc3luYygpPT57cygiUmF0ZS1saW1pdCBsaWZ0ZWQuIiksYXdhaXQgdC5wb3N0KCJEZWJ1Z2dlci5zZXRQYXVzZU9uRXhjZXB0aW9ucyIse3N0YXRlOiJhbGwifSl9LGFzeW5jIGU9PntzKGBSYXRlLWxpbWl0IGV4Y2VlZGVkLiBEaXNhYmxpbmcgY2FwdHVyaW5nIG9mIGNhdWdodCBleGNlcHRpb25zIGZvciAke2V9IHNlY29uZHMuYCksYXdhaXQgdC5wb3N0KCJEZWJ1Z2dlci5zZXRQYXVzZU9uRXhjZXB0aW9ucyIse3N0YXRlOiJ1bmNhdWdodCJ9KX0pfX0pKCkuY2F0Y2goZT0+e3MoIkZhaWxlZCB0byBzdGFydCBkZWJ1Z2dlciIsZSl9KSxzZXRJbnRlcnZhbCgoKT0+e30sMWU0KTs=";function Jy(...e){Y.log("[LocalVariables]",...e)}const cW=((e={})=>{function t(i,o){const c=(i.stacktrace?.frames||[]).filter(a=>a.function!=="new Promise");for(let a=0;a<c.length;a++){const l=c.length-a-1,f=o[a],d=c[l];if(!d||!f)break;f.vars===void 0||d.in_app===!1&&e.includeOutOfAppFrames!==!0||!tL(d.function,f.function)||(d.vars=f.vars)}}function n(i,o){if(o.originalException&&typeof o.originalException=="object"&&Lu in o.originalException&&Array.isArray(o.originalException[Lu])){for(const c of i.exception?.values||[])t(c,o.originalException[Lu]);o.originalException[Lu]=void 0}return i}async function r(){const i=await import("node:inspector");i.url()||i.open(0)}function s(i){const o=new Jl.Worker(new URL(`data:application/javascript;base64,${aW}`),{workerData:i,execArgv:[],env:{...process.env,NODE_OPTIONS:void 0}});process.on("exit",()=>{o.terminate()}),o.once("error",c=>{Jy("Worker error",c)}),o.once("exit",c=>{Jy("Worker exit",c)}),o.unref()}return{name:"LocalVariablesAsync",async setup(i){if(!i.getOptions().includeLocalVariables)return;if(await eL()){Y.warn("Local variables capture has been disabled because the debugger was already enabled");return}const c={...e,debug:Y.isEnabled()};r().then(()=>{try{s(c)}catch(a){Y.error("Failed to start worker",a)}},a=>{Y.error("Failed to start inspector",a)})},processEvent(i,o){return n(i,o)}}});function nL(e){if(e!==void 0)return e.slice(-10).reduce((t,n)=>`${t},${n.function},${n.lineno},${n.colno}`,"")}function uW(e,t){if(t!==void 0)return nL(e(t,1))}function rL(e){let t=[],n=!1;function r(o){t=[],!n&&(n=!0,e(o))}t.push(r);function s(o){t.push(o)}function i(o){const c=t.pop()||r;try{c(o)}catch{r(o)}}return{add:s,next:i}}class GT{constructor(t){this._session=t}static async create(t){if(t)return t;const n=await import("node:inspector");return new GT(new n.Session)}configureAndConnect(t,n){this._session.connect(),this._session.on("Debugger.paused",r=>{t(r,()=>{this._session.post("Debugger.resume")})}),this._session.post("Debugger.enable"),this._session.post("Debugger.setPauseOnExceptions",{state:n?"all":"uncaught"})}setPauseOnExceptions(t){this._session.post("Debugger.setPauseOnExceptions",{state:t?"all":"uncaught"})}getLocalVariables(t,n){this._getProperties(t,r=>{const{add:s,next:i}=rL(n);for(const o of r)if(o.value?.objectId&&o.value.className==="Array"){const c=o.value.objectId;s(a=>this._unrollArray(c,o.name,a,i))}else if(o.value?.objectId&&o.value.className==="Object"){const c=o.value.objectId;s(a=>this._unrollObject(c,o.name,a,i))}else o.value&&s(c=>this._unrollOther(o,c,i));i({})})}_getProperties(t,n){this._session.post("Runtime.getProperties",{objectId:t,ownProperties:!0},(r,s)=>{n(r?[]:s.result)})}_unrollArray(t,n,r,s){this._getProperties(t,i=>{r[n]=i.filter(o=>o.name!=="length"&&!isNaN(parseInt(o.name,10))).sort((o,c)=>parseInt(o.name,10)-parseInt(c.name,10)).map(o=>o.value?.value),s(r)})}_unrollObject(t,n,r,s){this._getProperties(t,i=>{r[n]=i.map(o=>[o.name,o.value?.value]).reduce((o,[c,a])=>(o[c]=a,o),{}),s(r)})}_unrollOther(t,n,r){t.value&&("value"in t.value?t.value.value===void 0||t.value.value===null?n[t.name]=`<${t.value.value}>`:n[t.name]=t.value.value:"description"in t.value&&t.value.type!=="function"?n[t.name]=`<${t.value.description}>`:t.value.type==="undefined"&&(n[t.name]="<undefined>")),r(n)}}const lW="LocalVariables",dW=((e={},t)=>{const n=new to(20);let r,s=!1;function i(l){const f=nL(l.stacktrace?.frames);if(f===void 0)return;const d=n.remove(f);if(d===void 0)return;const u=(l.stacktrace?.frames||[]).filter(_=>_.function!=="new Promise");for(let _=0;_<u.length;_++){const p=u.length-_-1,h=d[_],E=u[p];if(!E||!h)break;h.vars===void 0||E.in_app===!1&&e.includeOutOfAppFrames!==!0||!tL(E.function,h.function)||(E.vars=h.vars)}}function o(l){for(const f of l.exception?.values||[])i(f);return l}let c;async function a(){const f=ye()?.getOptions();if(!f?.includeLocalVariables)return;if(Di<18){Y.log("The `LocalVariables` integration is only supported on Node >= v18.");return}if(await eL()){Y.warn("Local variables capture has been disabled because the debugger was already enabled");return}try{const u=await GT.create(t),_=(h,{params:{reason:E,data:T,callFrames:S}},m)=>{if(E!=="exception"&&E!=="promiseRejection"){m();return}r?.();const g=uW(h,T.description);if(g==null){m();return}const{add:y,next:A}=rL(N=>{n.set(g,N),m()});for(let N=0;N<Math.min(S.length,5);N++){const{scopeChain:O,functionName:b,this:C}=S[N],w=O.find(U=>U.type==="local"),k=C.className==="global"||!C.className?b:`${C.className}.${b}`;if(w?.object.objectId===void 0)y(U=>{U[N]={function:k},A(U)});else{const U=w.object.objectId;y(M=>u.getLocalVariables(U,F=>{M[N]={function:k,vars:F},A(M)}))}}A([])},p=e.captureAllExceptions!==!1;if(u.configureAndConnect((h,E)=>_(f.stackParser,h,E),p),p){const h=e.maxExceptionsPerSecond||50;r=oW(h,()=>{Y.log("Local variables rate-limit lifted."),u.setPauseOnExceptions(!0)},E=>{Y.log(`Local variables rate-limit exceeded. Disabling capturing of caught exceptions for ${E} seconds.`),u.setPauseOnExceptions(!1)})}s=!0}catch(u){Y.log("The `LocalVariables` integration failed to start.",u)}}return{name:lW,setupOnce(){c=a()},async processEvent(l){return await c,s?o(l):l},_getCachedFramesCount(){return n.size},_getFirstCachedFrame(){return n.values()[0]}}}),fW=dW,_W=(e={})=>Md.major<19?fW(e):cW(e);function VT(){try{return typeof module<"u"&&typeof module.exports<"u"}catch{return!1}}let eN;function pW(){return VT()?!1:Di>=21||Di===20&&EE>=6||Di===18&&EE>=19?!0:(eN||(eN=!0,Cn(()=>{console.warn(`[Sentry] You are using Node.js v${process.versions.node} in ESM mode ("import syntax"). The Sentry Node.js SDK is not compatible with ESM in Node.js versions before 18.19.0 or before 20.6.0. Please either build your application with CommonJS ("require() syntax"), or upgrade your Node.js version.`)})),!1)}let Gf;const hW="Modules",EW=typeof __SENTRY_SERVER_MODULES__>"u"?{}:__SENTRY_SERVER_MODULES__,TW=(()=>({name:hW,processEvent(e){return e.modules={...e.modules,...tN()},e},getModules:tN})),SW=TW;function mW(){try{return require.cache?Object.keys(require.cache):[]}catch{return[]}}function gW(){return{...EW,...yW(),...VT()?AW():{}}}function AW(){const e=require.main?.paths||[],t=mW(),n={},r=new Set;return t.forEach(s=>{let i=s;const o=()=>{const c=i;if(i=he.dirname(c),!i||c===i||r.has(c))return;if(e.indexOf(i)<0)return o();const a=he.join(c,"package.json");if(r.add(c),!me.existsSync(a))return o();try{const l=JSON.parse(me.readFileSync(a,"utf8"));n[l.name]=l.version}catch{}};o()}),n}function tN(){return Gf||(Gf=gW()),Gf}function RW(){try{const e=he.join(process.cwd(),"package.json");return JSON.parse(me.readFileSync(e,"utf8"))}catch{return{}}}function yW(){const e=RW();return{...e.dependencies,...e.devDependencies}}const NW=2e3;function mE(e){Cn(()=>{console.error(e)});const t=ye();if(t===void 0){De&&Y.warn("No NodeClient was defined, we are exiting the process now."),global.process.exit(1);return}const n=t.getOptions(),r=n?.shutdownTimeout&&n.shutdownTimeout>0?n.shutdownTimeout:NW;t.close(r).then(s=>{s||De&&Y.warn("We reached the timeout for emptying the request buffer, still exiting now!"),global.process.exit(1)},s=>{De&&Y.error(s)})}const OW="OnUncaughtException",bW=(e={})=>{const t={exitEvenIfOtherHandlersAreRegistered:!1,...e};return{name:OW,setup(n){global.process.on("uncaughtException",IW(n,t))}}};function IW(e,t){let r=!1,s=!1,i=!1,o;const c=e.getOptions();return Object.assign(a=>{let l=mE;t.onFatalError?l=t.onFatalError:c.onFatalError&&(l=c.onFatalError);const d=global.process.listeners("uncaughtException").filter(_=>_.name!=="domainUncaughtExceptionClear"&&_.tag!=="sentry_tracingErrorCallback"&&_._errorHandler!==!0).length===0,u=t.exitEvenIfOtherHandlersAreRegistered||d;r?u&&(i?(De&&Y.warn("uncaught exception after calling fatal error shutdown callback - this is bad! forcing shutdown"),mE(a)):s||(s=!0,setTimeout(()=>{i||(i=!0,l(o,a))},2e3))):(o=a,r=!0,ye()===e&&Ye(a,{originalException:a,captureContext:{level:"fatal"},mechanism:{handled:!1,type:"auto.node.onuncaughtexception"}}),!i&&u&&(i=!0,l(a)))},{_errorHandler:!0})}const CW="OnUnhandledRejection",vW=[{name:"AI_NoOutputGeneratedError"}],PW=((e={})=>{const t={mode:e.mode??"warn",ignore:[...vW,...e.ignore??[]]};return{name:CW,setup(n){global.process.on("unhandledRejection",UW(n,t))}}}),MW=PW;function wW(e){if(typeof e!="object"||e===null)return{name:"",message:String(e??"")};const t=e,n=typeof t.name=="string"?t.name:"",r=typeof t.message=="string"?t.message:String(e);return{name:n,message:r}}function LW(e,t){const n=e.name===void 0||wi(t.name,e.name,!0),r=e.message===void 0||wi(t.message,e.message);return n&&r}function DW(e,t){const n=wW(t);return e.some(r=>LW(r,n))}function UW(e,t){return function(r,s){if(ye()!==e||DW(t.ignore??[],r))return;const i=t.mode==="strict"?"fatal":"error",o=r&&typeof r=="object"?r._sentry_active_span:void 0;(o?a=>Cw(o,a):a=>a())(()=>{Ye(r,{originalException:s,captureContext:{extra:{unhandledPromiseRejection:!0},level:i},mechanism:{handled:!1,type:"auto.node.onunhandledrejection"}})}),kW(r,t.mode)}}function kW(e,t){const n="This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). The promise rejected with the reason:";t==="warn"?Cn(()=>{console.warn(n),console.error(e&&typeof e=="object"&&"stack"in e?e.stack:e)}):t==="strict"&&(Cn(()=>{console.warn(n)}),mE(e))}const sL="Spotlight",xW=((e={})=>{const t={sidecarUrl:e.sidecarUrl||"http://localhost:8969/stream"};return{name:sL,setup(n){try{process.env.NODE_ENV&&process.env.NODE_ENV!=="development"&&Y.warn("[Spotlight] It seems you're not in dev mode. Do you really want to have Spotlight enabled?")}catch{}GW(n,t)}}}),BW=xW;function GW(e,t){const n=VW(t.sidecarUrl);if(!n)return;let r=0;e.on("beforeEnvelope",s=>{if(r>3){Y.warn("[Spotlight] Disabled Sentry -> Spotlight integration due to too many failed requests");return}const i=yw(s);vw(()=>{const o=dl.request({method:"POST",path:n.pathname,hostname:n.hostname,port:n.port,headers:{"Content-Type":"application/x-sentry-envelope"}},c=>{c.statusCode&&c.statusCode>=200&&c.statusCode<400&&(r=0),c.on("data",()=>{}),c.on("end",()=>{}),c.setEncoding("utf8")});o.on("error",()=>{r++,Y.warn("[Spotlight] Failed to send envelope to Spotlight Sidecar")}),o.write(i),o.end()})})}function VW(e){try{return new URL(`${e}`)}catch{Y.warn(`[Spotlight] Invalid sidecar URL: ${e}`);return}}const $W="NodeSystemError";function HW(e){return!(e instanceof Error)||!("errno"in e)||typeof e.errno!="number"?!1:Lk.getSystemErrorMap().has(e.errno)}const FW=(e={})=>({name:$W,processEvent:(t,n,r)=>{if(!HW(n.originalException))return t;const s=n.originalException,i={...s};!r.getOptions().sendDefaultPii&&e.includePaths!==!0&&(delete i.path,delete i.dest),t.contexts={...t.contexts,node_system_error:i};for(const o of t.exception?.values||[])o.value&&(s.path&&o.value.includes(s.path)&&(o.value=o.value.replace(`'${s.path}'`,"").trim()),s.dest&&o.value.includes(s.dest)&&(o.value=o.value.replace(`'${s.dest}'`,"").trim()));return t}}),jW="ChildProcess",qW=(e={})=>({name:jW,setup(){ll.channel("child_process").subscribe(t=>{t&&typeof t=="object"&&"process"in t&&YW(t.process,e)}),ll.channel("worker_threads").subscribe(t=>{t&&typeof t=="object"&&"worker"in t&&WW(t.worker,e)})}});function YW(e,t){let n=!1,r;e.on("spawn",()=>{if(e.spawnfile==="/usr/bin/sw_vers"){n=!0;return}r={spawnfile:e.spawnfile},t.includeChildProcessArgs&&(r.spawnargs=e.spawnargs)}).on("exit",s=>{n||(n=!0,s!==null&&s!==0&&Fi({category:"child_process",message:`Child process exited with code '${s}'`,level:s===0?"info":"warning",data:r}))}).on("error",s=>{n||(n=!0,Fi({category:"child_process",message:`Child process errored with '${s.message}'`,level:"error",data:r}))})}function WW(e,t){let n;e.on("online",()=>{n=e.threadId}).on("error",r=>{t.captureWorkerErrors!==!1?Ye(r,{mechanism:{type:"auto.child_process.worker_thread",handled:!1,data:{threadId:String(n)}}}):Fi({category:"worker_thread",message:`Worker thread errored with '${r.message}'`,level:"error",data:{threadId:n}})})}var Vf={},Ha={},Fa={},nN;function iL(){if(nN)return Fa;nN=1,Object.defineProperty(Fa,"__esModule",{value:!0}),Fa.AbstractAsyncHooksContextManager=void 0;const e=Hr,t=["addListener","on","once","prependListener","prependOnceListener"];let n=class{bind(s,i){return i instanceof e.EventEmitter?this._bindEventEmitter(s,i):typeof i=="function"?this._bindFunction(s,i):i}_bindFunction(s,i){const o=this,c=function(...a){return o.with(s,()=>i.apply(this,a))};return Object.defineProperty(c,"length",{enumerable:!1,configurable:!0,writable:!1,value:i.length}),c}_bindEventEmitter(s,i){return this._getPatchMap(i)!==void 0||(this._createPatchMap(i),t.forEach(c=>{i[c]!==void 0&&(i[c]=this._patchAddListener(i,i[c],s))}),typeof i.removeListener=="function"&&(i.removeListener=this._patchRemoveListener(i,i.removeListener)),typeof i.off=="function"&&(i.off=this._patchRemoveListener(i,i.off)),typeof i.removeAllListeners=="function"&&(i.removeAllListeners=this._patchRemoveAllListeners(i,i.removeAllListeners))),i}_patchRemoveListener(s,i){const o=this;return function(c,a){const l=o._getPatchMap(s)?.[c];if(l===void 0)return i.call(this,c,a);const f=l.get(a);return i.call(this,c,f||a)}}_patchRemoveAllListeners(s,i){const o=this;return function(c){const a=o._getPatchMap(s);return a!==void 0&&(arguments.length===0?o._createPatchMap(s):a[c]!==void 0&&delete a[c]),i.apply(this,arguments)}}_patchAddListener(s,i,o){const c=this;return function(a,l){if(c._wrapped)return i.call(this,a,l);let f=c._getPatchMap(s);f===void 0&&(f=c._createPatchMap(s));let d=f[a];d===void 0&&(d=new WeakMap,f[a]=d);const u=c.bind(o,l);d.set(l,u),c._wrapped=!0;try{return i.call(this,a,u)}finally{c._wrapped=!1}}}_createPatchMap(s){const i=Object.create(null);return s[this._kOtListeners]=i,i}_getPatchMap(s){return s[this._kOtListeners]}_kOtListeners=Symbol("OtListeners");_wrapped=!1};return Fa.AbstractAsyncHooksContextManager=n,Fa}var rN;function KW(){if(rN)return Ha;rN=1,Object.defineProperty(Ha,"__esModule",{value:!0}),Ha.AsyncHooksContextManager=void 0;const e=Ue(),t=uM,n=iL();let r=class extends n.AbstractAsyncHooksContextManager{_asyncHook;_contexts=new Map;_stack=[];constructor(){super(),this._asyncHook=t.createHook({init:this._init.bind(this),before:this._before.bind(this),after:this._after.bind(this),destroy:this._destroy.bind(this),promiseResolve:this._destroy.bind(this)})}active(){return this._stack[this._stack.length-1]??e.ROOT_CONTEXT}with(i,o,c,...a){this._enterContext(i);try{return o.call(c,...a)}finally{this._exitContext()}}enable(){return this._asyncHook.enable(),this}disable(){return this._asyncHook.disable(),this._contexts.clear(),this._stack=[],this}_init(i,o){if(o==="TIMERWRAP")return;const c=this._stack[this._stack.length-1];c!==void 0&&this._contexts.set(i,c)}_destroy(i){this._contexts.delete(i)}_before(i){const o=this._contexts.get(i);o!==void 0&&this._enterContext(o)}_after(){this._exitContext()}_enterContext(i){this._stack.push(i)}_exitContext(){this._stack.pop()}};return Ha.AsyncHooksContextManager=r,Ha}var ja={},sN;function zW(){if(sN)return ja;sN=1,Object.defineProperty(ja,"__esModule",{value:!0}),ja.AsyncLocalStorageContextManager=void 0;const e=Ue(),t=uM,n=iL();let r=class extends n.AbstractAsyncHooksContextManager{_asyncLocalStorage;constructor(){super(),this._asyncLocalStorage=new t.AsyncLocalStorage}active(){return this._asyncLocalStorage.getStore()??e.ROOT_CONTEXT}with(i,o,c,...a){const l=c==null?o:o.bind(c);return this._asyncLocalStorage.run(i,l,...a)}enable(){return this}disable(){return this._asyncLocalStorage.disable(),this}};return ja.AsyncLocalStorageContextManager=r,ja}var iN;function ZW(){return iN||(iN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncLocalStorageContextManager=e.AsyncHooksContextManager=void 0;var t=KW();Object.defineProperty(e,"AsyncHooksContextManager",{enumerable:!0,get:function(){return t.AsyncHooksContextManager}});var n=zW();Object.defineProperty(e,"AsyncLocalStorageContextManager",{enumerable:!0,get:function(){return n.AsyncLocalStorageContextManager}})})(Vf)),Vf}var XW=ZW();const QW=eY(XW.AsyncLocalStorageContextManager);function JW(){D.diag.disable(),D.diag.setLogger({error:Y.error,warn:Y.warn,info:Y.log,debug:Y.log,verbose:Y.log},D.DiagLogLevel.DEBUG)}const e2="ProcessSession",t2=()=>({name:e2,setupOnce(){YV(),process.on("beforeExit",()=>{tt().getSession()?.status!=="ok"&&Dw()})}}),Dn=Symbol("AgentBaseInternalState");class n2 extends dl.Agent{constructor(t){super(t),this[Dn]={}}isSecureEndpoint(t){if(t){if(typeof t.secureEndpoint=="boolean")return t.secureEndpoint;if(typeof t.protocol=="string")return t.protocol==="https:"}const{stack:n}=new Error;return typeof n!="string"?!1:n.split(`
`).some(r=>r.indexOf("(https.js:")!==-1||r.indexOf("node:https:")!==-1)}createSocket(t,n,r){const s={...n,secureEndpoint:this.isSecureEndpoint(n)};Promise.resolve().then(()=>this.connect(t,s)).then(i=>{if(i instanceof dl.Agent)return i.addRequest(t,s);this[Dn].currentSocket=i,super.createSocket(t,n,r)},r)}createConnection(){const t=this[Dn].currentSocket;if(this[Dn].currentSocket=void 0,!t)throw new Error("No socket was returned in the `connect()` function");return t}get defaultPort(){return this[Dn].defaultPort??(this.protocol==="https:"?443:80)}set defaultPort(t){this[Dn]&&(this[Dn].defaultPort=t)}get protocol(){return this[Dn].protocol??(this.isSecureEndpoint()?"https:":"http:")}set protocol(t){this[Dn]&&(this[Dn].protocol=t)}}function Du(...e){Y.log("[https-proxy-agent:parse-proxy-response]",...e)}function r2(e){return new Promise((t,n)=>{let r=0;const s=[];function i(){const f=e.read();f?l(f):e.once("readable",i)}function o(){e.removeListener("end",c),e.removeListener("error",a),e.removeListener("readable",i)}function c(){o(),Du("onend"),n(new Error("Proxy connection ended before receiving CONNECT response"))}function a(f){o(),Du("onerror %o",f),n(f)}function l(f){s.push(f),r+=f.length;const d=Buffer.concat(s,r),u=d.indexOf(`\r
\r
`);if(u===-1){Du("have not received end of HTTP headers yet..."),i();return}const _=d.subarray(0,u).toString("ascii").split(`\r
`),p=_.shift();if(!p)return e.destroy(),n(new Error("No header received from proxy CONNECT response"));const h=p.split(" "),E=+(h[1]||0),T=h.slice(2).join(" "),S={};for(const m of _){if(!m)continue;const g=m.indexOf(":");if(g===-1)return e.destroy(),n(new Error(`Invalid header from proxy CONNECT response: "${m}"`));const y=m.slice(0,g).toLowerCase(),A=m.slice(g+1).trimStart(),N=S[y];typeof N=="string"?S[y]=[N,A]:Array.isArray(N)?N.push(A):S[y]=A}Du("got proxy server response: %o %o",p,S),o(),t({connect:{statusCode:E,statusText:T,headers:S},buffered:d})}e.on("error",a),e.on("end",c),i()})}function qa(...e){Y.log("[https-proxy-agent]",...e)}class oL extends n2{static __initStatic(){this.protocols=["http","https"]}constructor(t,n){super(n),this.options={},this.proxy=typeof t=="string"?new URL(t):t,this.proxyHeaders=n?.headers??{},qa("Creating new HttpsProxyAgent instance: %o",this.proxy.href);const r=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),s=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...n?oN(n,"headers"):null,host:r,port:s}}async connect(t,n){const{proxy:r}=this;if(!n.host)throw new TypeError('No "host" provided');let s;if(r.protocol==="https:"){qa("Creating `tls.Socket`: %o",this.connectOpts);const u=this.connectOpts.servername||this.connectOpts.host;s=Wg.connect({...this.connectOpts,servername:u&&gi.isIP(u)?void 0:u})}else qa("Creating `net.Socket`: %o",this.connectOpts),s=gi.connect(this.connectOpts);const i=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders},o=gi.isIPv6(n.host)?`[${n.host}]`:n.host;let c=`CONNECT ${o}:${n.port} HTTP/1.1\r
`;if(r.username||r.password){const u=`${decodeURIComponent(r.username)}:${decodeURIComponent(r.password)}`;i["Proxy-Authorization"]=`Basic ${Buffer.from(u).toString("base64")}`}i.Host=`${o}:${n.port}`,i["Proxy-Connection"]||(i["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(const u of Object.keys(i))c+=`${u}: ${i[u]}\r
`;const a=r2(s);s.write(`${c}\r
`);const{connect:l,buffered:f}=await a;if(t.emit("proxyConnect",l),this.emit("proxyConnect",l,t),l.statusCode===200){if(t.once("socket",s2),n.secureEndpoint){qa("Upgrading socket connection to TLS");const u=n.servername||n.host;return Wg.connect({...oN(n,"host","path","port"),socket:s,servername:gi.isIP(u)?void 0:u})}return s}s.destroy();const d=new gi.Socket({writable:!1});return d.readable=!0,t.once("socket",u=>{qa("Replaying proxy buffer for failed request"),u.push(f),u.push(null)}),d}}oL.__initStatic();function s2(e){e.resume()}function oN(e,...t){const n={};let r;for(r in e)t.includes(r)||(n[r]=e[r]);return n}const i2=1024*32;function o2(e){return new Pk.Readable({read(){this.push(e),this.push(null)}})}function a2(e){let t;try{t=new URL(e.url)}catch{return Cn(()=>{console.warn("[@sentry/node]: Invalid dsn or tunnel option, will not send any events. The tunnel option must be a full URL when used.")}),iy(e,()=>Promise.resolve({}))}const n=t.protocol==="https:",r=c2(t,e.proxy||(n?process.env.https_proxy:void 0)||process.env.http_proxy),s=n?Uk:dl,i=e.keepAlive===void 0?!1:e.keepAlive,o=r?new oL(r):new s.Agent({keepAlive:i,maxSockets:30,timeout:2e3}),c=u2(e,e.httpModule??s,o);return iy(e,c)}function c2(e,t){const{no_proxy:n}=process.env;if(!n?.split(",").some(s=>e.host.endsWith(s)||e.hostname.endsWith(s)))return t}function u2(e,t,n){const{hostname:r,pathname:s,port:i,protocol:o,search:c}=new URL(e.url);return function(l){return new Promise((f,d)=>{vw(()=>{let u=o2(l.body);const _={...e.headers};l.body.length>i2&&(_["content-encoding"]="gzip",u=u.pipe(Mk.createGzip()));const p=t.request({method:"POST",agent:n,headers:_,hostname:r,path:`${s}${c}`,port:i,protocol:o,ca:e.caCerts},h=>{h.on("data",()=>{}),h.on("end",()=>{}),h.setEncoding("utf8");const E=h.headers["retry-after"]??null,T=h.headers["x-sentry-rate-limits"]??null;f({statusCode:h.statusCode,headers:{"retry-after":E,"x-sentry-rate-limits":Array.isArray(T)?T[0]||null:T}})});p.on("error",d),u.pipe(p)})})}}const l2=new Set(["false","f","n","no","off","0"]),d2=new Set(["true","t","y","yes","on","1"]);function gE(e,t){const n=String(e).toLowerCase();return l2.has(n)?!1:d2.has(n)?!0:t?.strict?null:!!e}function aN(e){return e.replace(/^[A-Z]:/,"").replace(/\\/g,"/")}function f2(e=process.argv[1]?PH(process.argv[1]):process.cwd(),t=he.sep==="\\"){const n=t?aN(e):e;return r=>{if(!r)return;const s=t?aN(r):r;let{dir:i,base:o,ext:c}=he.posix.parse(s);(c===".js"||c===".mjs"||c===".cjs")&&(o=o.slice(0,c.length*-1));const a=decodeURIComponent(o);i||(i=".");const l=i.lastIndexOf("/node_modules");if(l>-1)return`${i.slice(l+14).replace(/\//g,".")}:${a}`;if(i.startsWith(n)){const f=i.slice(n.length+1).replace(/\//g,".");return f?`${f}:${a}`:a}return a}}function _2(e){if(process.env.SENTRY_RELEASE)return process.env.SENTRY_RELEASE;if(Me.SENTRY_RELEASE?.id)return Me.SENTRY_RELEASE.id;const t=process.env.GITHUB_SHA||process.env.CI_MERGE_REQUEST_SOURCE_BRANCH_SHA||process.env.CI_BUILD_REF||process.env.CI_COMMIT_SHA||process.env.BITBUCKET_COMMIT,n=process.env.APPVEYOR_PULL_REQUEST_HEAD_COMMIT||process.env.APPVEYOR_REPO_COMMIT||process.env.CODEBUILD_RESOLVED_SOURCE_VERSION||process.env.AWS_COMMIT_ID||process.env.BUILD_SOURCEVERSION||process.env.GIT_CLONE_COMMIT_HASH||process.env.BUDDY_EXECUTION_REVISION||process.env.BUILDKITE_COMMIT||process.env.CIRCLE_SHA1||process.env.CIRRUS_CHANGE_IN_REPO||process.env.CF_REVISION||process.env.CM_COMMIT||process.env.CF_PAGES_COMMIT_SHA||process.env.DRONE_COMMIT_SHA||process.env.FC_GIT_COMMIT_SHA||process.env.HEROKU_TEST_RUN_COMMIT_VERSION||process.env.HEROKU_SLUG_COMMIT||process.env.RAILWAY_GIT_COMMIT_SHA||process.env.RENDER_GIT_COMMIT||process.env.SEMAPHORE_GIT_SHA||process.env.TRAVIS_PULL_REQUEST_SHA||process.env.VERCEL_GIT_COMMIT_SHA||process.env.VERCEL_GITHUB_COMMIT_SHA||process.env.VERCEL_GITLAB_COMMIT_SHA||process.env.VERCEL_BITBUCKET_COMMIT_SHA||process.env.ZEIT_GITHUB_COMMIT_SHA||process.env.ZEIT_GITLAB_COMMIT_SHA||process.env.ZEIT_BITBUCKET_COMMIT_SHA,r=process.env.CI_COMMIT_ID||process.env.SOURCE_COMMIT||process.env.SOURCE_VERSION||process.env.GIT_COMMIT||process.env.COMMIT_REF||process.env.BUILD_VCS_NUMBER||process.env.CI_COMMIT_SHA;return t||n||r||e}const p2=tw(Yj(f2())),h2=6e4;class E2 extends L${constructor(t){const n=t.includeServerName===!1?void 0:t.serverName||global.process.env.SENTRY_NAME||jt.hostname(),r={...t,platform:"node",runtime:{name:"node",version:global.process.version},serverName:n};t.openTelemetryInstrumentations&&cd({instrumentations:t.openTelemetryInstrumentations}),RT(r,"node"),Y.log(`Initializing Sentry: process: ${process.pid}, thread: ${qh.isMainThread?"main":`worker-${qh.threadId}`}.`),super(r),this.getOptions().enableLogs&&(this._logOnExitFlushListener=()=>{kw(this)},n&&this.on("beforeCaptureLog",s=>{s.attributes={...s.attributes,"server.address":n}}),process.on("beforeExit",this._logOnExitFlushListener))}get tracer(){if(this._tracer)return this._tracer;const t="@sentry/node",n=at,r=D.trace.getTracer(t,n);return this._tracer=r,r}async flush(t){return await this.traceProvider?.forceFlush(),this.getOptions().sendClientReports&&this._flushOutcomes(),super.flush(t)}async close(t){this._clientReportInterval&&clearInterval(this._clientReportInterval),this._clientReportOnExitFlushListener&&process.off("beforeExit",this._clientReportOnExitFlushListener),this._logOnExitFlushListener&&process.off("beforeExit",this._logOnExitFlushListener);const n=await super.close(t);return this.traceProvider&&await this.traceProvider.shutdown(),n}startClientReportTracking(){const t=this.getOptions();t.sendClientReports&&(this._clientReportOnExitFlushListener=()=>{this._flushOutcomes()},this._clientReportInterval=setInterval(()=>{De&&Y.log("Flushing client reports based on interval."),this._flushOutcomes()},t.clientReportFlushInterval??h2).unref(),process.on("beforeExit",this._clientReportOnExitFlushListener))}_setupIntegrations(){U$(),super._setupIntegrations()}_getTraceInfoFromScope(t){return t?zq(this,t):[void 0,void 0]}}function T2(){if(pW()&&!Me._sentryEsmLoaderHookRegistered){Me._sentryEsmLoaderHookRegistered=!0;try{const{addHookMessagePort:e}=ZM.createAddHookMessageChannel();Dk.register("import-in-the-middle/hook.mjs",typeof document>"u"?require("url").pathToFileURL(__filename).href:Jd&&Jd.tagName.toUpperCase()==="SCRIPT"&&Jd.src||new URL("worker.js",document.baseURI).href,{data:{addHookMessagePort:e,include:[]},transferList:[e]})}catch(e){Y.warn("Failed to register 'import-in-the-middle' hook",e)}}}function aL(){return[eH(),Z$(),_H(),AH(),FW(),kH(),RY(),CY(),bW(),MW(),iW(),_W(),LY(),qW(),t2(),SW()]}function S2(e={}){return m2(e,aL)}function m2(e={},t){const n=A2(e,t);n.debug===!0&&(De?Y.enable():Cn(()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")})),n.registerEsmLoaderHooks!==!1&&T2(),Jq(),rt().update(n.initialScope),n.spotlight&&!n.integrations.some(({name:i})=>i===sL)&&n.integrations.push(BW({sidecarUrl:typeof n.spotlight=="string"?n.spotlight:void 0})),RT(n,"node-core");const s=new E2(n);return rt().setClient(s),s.init(),Me._sentryInjectLoaderHookRegister?.(),Y.log(`SDK initialized from ${VT()?"CommonJS":"ESM"}`),s.startClientReportTracking(),N2(),kq(s),Xq(s),s}function g2(){if(!De)return;const e=xq(),t=["SentryContextManager","SentryPropagator"];un()&&t.push("SentrySpanProcessor");for(const n of t)e.includes(n)||Y.error(`You have to set up the ${n}. Without this, the OpenTelemetry & Sentry integration will not work properly.`);e.includes("SentrySampler")||Y.warn("You have to set up the SentrySampler. Without this, the OpenTelemetry & Sentry integration may still work, but sample rates set for the Sentry SDK will not be respected. If you use a custom sampler, make sure to use `wrapSamplingDecision`.")}function A2(e,t){const n=R2(e.release);let r;if(e.spotlight===!1)r=!1;else if(typeof e.spotlight=="string")r=e.spotlight;else{const a=gE(process.env.SENTRY_SPOTLIGHT,{strict:!0}),l=a===null&&process.env.SENTRY_SPOTLIGHT?process.env.SENTRY_SPOTLIGHT:void 0;r=e.spotlight===!0?l??!0:a??l}const s=y2(e.tracesSampleRate),i={...e,dsn:e.dsn??process.env.SENTRY_DSN,environment:e.environment??process.env.SENTRY_ENVIRONMENT,sendClientReports:e.sendClientReports??!0,transport:e.transport??a2,stackParser:FB(e.stackParser||p2),release:n,tracesSampleRate:s,spotlight:r,debug:gE(e.debug??process.env.SENTRY_DEBUG)},o=e.integrations,c=e.defaultIntegrations??t(i);return{...i,integrations:e$({defaultIntegrations:c,integrations:o})}}function R2(e){if(e!==void 0)return e;const t=_2();if(t!==void 0)return t}function y2(e){if(e!==void 0)return e;const t=process.env.SENTRY_TRACES_SAMPLE_RATE;if(!t)return;const n=parseFloat(t);return isFinite(n)?n:void 0}function N2(){if(gE(process.env.SENTRY_USE_ENVIRONMENT)!==!1){const e=process.env.SENTRY_TRACE,t=process.env.SENTRY_BAGGAGE,n=Tw(e,t);rt().setPropagationContext(n)}}function Dt(e,t){e.setAttribute(He,t)}const $T="Http",cN="@opentelemetry_sentry-patched/instrumentation-http",O2=Pe(`${$T}.sentry`,e=>new K0(e)),b2=Pe($T,e=>{const t=new kB.HttpInstrumentation({...e,disableIncomingRequestInstrumentation:!0});try{t._diag=D.diag.createComponentLogger({namespace:cN}),t.instrumentationName=cN}catch{}return t});function I2(e,t={}){return typeof e.spans=="boolean"?e.spans:!(t.skipOpenTelemetrySetup||!un(t)&&Md.major>=22)}const C2=(e={})=>{const t=e.spans??!0,n=e.disableIncomingRequestSpans,r={sessions:e.trackIncomingRequestsAsSessions,sessionFlushingDelayMS:e.sessionFlushingDelayMS,ignoreRequestBody:e.ignoreIncomingRequestBody,maxRequestBodySize:e.maxIncomingRequestBodySize},s={ignoreIncomingRequests:e.ignoreIncomingRequests,ignoreStaticAssets:e.ignoreStaticAssets,ignoreStatusCodes:e.dropSpansForIncomingRequestStatusCodes,instrumentation:e.instrumentation,onSpanCreated:e.incomingRequestSpanHook},i=E0(r),o=T0(s),c=t&&!n;return{name:$T,setup(a){const l=a.getOptions();c&&un(l)&&o.setup(a)},setupOnce(){const a=ye()?.getOptions()||{},l=I2(e,a);i.setupOnce();const f={breadcrumbs:e.breadcrumbs,propagateTraceInOutgoingRequests:!l,ignoreOutgoingRequests:e.ignoreOutgoingRequests};if(O2(f),l){const d=v2(e);b2(d)}},processEvent(a){return o.processEvent(a)}}};function v2(e={}){return{ignoreOutgoingRequestHook:n=>{const r=S0(n);if(!r)return!1;const s=e.ignoreOutgoingRequests;return!!s?.(r,n)},requireParentforOutgoingSpans:!1,requestHook:(n,r)=>{Dt(n,"auto.http.otel.http"),e.instrumentation?.requestHook?.(n,r)},responseHook:(n,r)=>{e.instrumentation?.responseHook?.(n,r)},applyCustomAttributesOnSpan:(n,r,s)=>{e.instrumentation?.applyCustomAttributesOnSpan?.(n,r,s)}}}var $f={},Ya={},us={},uN;function P2(){return uN||(uN=1,Object.defineProperty(us,"__esModule",{value:!0}),us.PACKAGE_NAME=us.PACKAGE_VERSION=void 0,us.PACKAGE_VERSION="0.19.0",us.PACKAGE_NAME="@opentelemetry/instrumentation-undici"),us}var lN;function M2(){if(lN)return Ya;lN=1,Object.defineProperty(Ya,"__esModule",{value:!0}),Ya.UndiciInstrumentation=void 0;const e=cM,t=Wi,n=Be,r=Ue(),s=Ln,i=gt(),o=P2();class c extends n.InstrumentationBase{_recordFromReq=new WeakMap;constructor(l={}){super(o.PACKAGE_NAME,o.PACKAGE_VERSION,l)}init(){}disable(){super.disable(),this._channelSubs.forEach(l=>l.unsubscribe()),this._channelSubs.length=0}enable(){super.enable(),this._channelSubs=this._channelSubs||[],!(this._channelSubs.length>0)&&(this.subscribeToChannel("undici:request:create",this.onRequestCreated.bind(this)),this.subscribeToChannel("undici:client:sendHeaders",this.onRequestHeaders.bind(this)),this.subscribeToChannel("undici:request:headers",this.onResponseHeaders.bind(this)),this.subscribeToChannel("undici:request:trailers",this.onDone.bind(this)),this.subscribeToChannel("undici:request:error",this.onError.bind(this)))}_updateMetricInstruments(){this._httpClientDurationHistogram=this.meter.createHistogram(i.METRIC_HTTP_CLIENT_REQUEST_DURATION,{description:"Measures the duration of outbound HTTP requests.",unit:"s",valueType:r.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[.005,.01,.025,.05,.075,.1,.25,.5,.75,1,2.5,5,7.5,10]}})}subscribeToChannel(l,f){const[d,u]=process.version.replace("v","").split(".").map(h=>Number(h)),_=d>18||d===18&&u>=19;let p;if(_)e.subscribe?.(l,f),p=()=>e.unsubscribe?.(l,f);else{const h=e.channel(l);h.subscribe(f),p=()=>h.unsubscribe(f)}this._channelSubs.push({name:l,unsubscribe:p})}parseRequestHeaders(l){const f=new Map;if(Array.isArray(l.headers))for(let d=0;d<l.headers.length;d+=2){const u=l.headers[d],_=l.headers[d+1];typeof u=="string"&&f.set(u.toLowerCase(),_)}else if(typeof l.headers=="string"){const d=l.headers.split(`\r
`);for(const u of d){if(!u)continue;const _=u.indexOf(":");if(_===-1)continue;const p=u.substring(0,_).toLowerCase(),h=u.substring(_+1).trim(),E=f.get(p);E&&Array.isArray(E)?E.push(h):E?f.set(p,[E,h]):f.set(p,h)}}return f}onRequestCreated({request:l}){const f=this.getConfig(),d=f.enabled!==!1;if((0,n.safeExecuteInTheMiddle)(()=>!d||l.method==="CONNECT"||f.ignoreRequestHook?.(l),M=>M&&this._diag.error("caught ignoreRequestHook error: ",M),!0))return;const _=(0,s.hrTime)();let p;try{p=new t.URL(l.path,l.origin)}catch(M){this._diag.warn("could not determine url.full:",M);return}const h=p.protocol.replace(":",""),E=this.getRequestMethod(l.method),T={[i.ATTR_HTTP_REQUEST_METHOD]:E,[i.ATTR_HTTP_REQUEST_METHOD_ORIGINAL]:l.method,[i.ATTR_URL_FULL]:p.toString(),[i.ATTR_URL_PATH]:p.pathname,[i.ATTR_URL_QUERY]:p.search,[i.ATTR_URL_SCHEME]:h},S={https:"443",http:"80"},m=p.hostname,g=p.port||S[h];T[i.ATTR_SERVER_ADDRESS]=m,g&&!isNaN(Number(g))&&(T[i.ATTR_SERVER_PORT]=Number(g));const A=this.parseRequestHeaders(l).get("user-agent");if(A){const M=Array.isArray(A)?A[A.length-1]:A;T[i.ATTR_USER_AGENT_ORIGINAL]=M}const N=(0,n.safeExecuteInTheMiddle)(()=>f.startSpanHook?.(l),M=>M&&this._diag.error("caught startSpanHook error: ",M),!0);N&&Object.entries(N).forEach(([M,F])=>{T[M]=F});const O=r.context.active(),b=r.trace.getSpan(O);let C;f.requireParentforSpans&&(!b||!r.trace.isSpanContextValid(b.spanContext()))?C=r.trace.wrapSpanContext(r.INVALID_SPAN_CONTEXT):C=this.tracer.startSpan(E==="_OTHER"?"HTTP":E,{kind:r.SpanKind.CLIENT,attributes:T},O),(0,n.safeExecuteInTheMiddle)(()=>f.requestHook?.(C,l),M=>M&&this._diag.error("caught requestHook error: ",M),!0);const w=r.trace.setSpan(r.context.active(),C),k={};r.propagation.inject(w,k);const U=Object.entries(k);for(let M=0;M<U.length;M++){const[F,v]=U[M];typeof l.addHeader=="function"?l.addHeader(F,v):typeof l.headers=="string"?l.headers+=`${F}: ${v}\r
`:Array.isArray(l.headers)&&l.headers.push(F,v)}this._recordFromReq.set(l,{span:C,attributes:T,startTime:_})}onRequestHeaders({request:l,socket:f}){const d=this._recordFromReq.get(l);if(!d)return;const u=this.getConfig(),{span:_}=d,{remoteAddress:p,remotePort:h}=f,E={[i.ATTR_NETWORK_PEER_ADDRESS]:p,[i.ATTR_NETWORK_PEER_PORT]:h};if(u.headersToSpanAttributes?.requestHeaders){const T=new Set(u.headersToSpanAttributes.requestHeaders.map(m=>m.toLowerCase())),S=this.parseRequestHeaders(l);for(const[m,g]of S.entries())if(T.has(m)){const y=Array.isArray(g)?g.join(", "):g;E[`http.request.header.${m}`]=y}}_.setAttributes(E)}onResponseHeaders({request:l,response:f}){const d=this._recordFromReq.get(l);if(!d)return;const{span:u,attributes:_}=d,p={[i.ATTR_HTTP_RESPONSE_STATUS_CODE]:f.statusCode},h=this.getConfig();(0,n.safeExecuteInTheMiddle)(()=>h.responseHook?.(u,{request:l,response:f}),T=>T&&this._diag.error("caught responseHook error: ",T),!0);const E=new Set;h.headersToSpanAttributes?.responseHeaders&&h.headersToSpanAttributes?.responseHeaders.forEach(T=>E.add(T.toLowerCase()));for(let T=0;T<f.headers.length;T=T+2){const S=f.headers[T].toString().toLowerCase(),m=f.headers[T+1];if(E.has(S)&&(p[`http.response.header.${S}`]=m.toString()),S==="content-length"){const g=Number(m.toString());isNaN(g)||(p["http.response.header.content-length"]=g)}}u.setAttributes(p),u.setStatus({code:f.statusCode>=400?r.SpanStatusCode.ERROR:r.SpanStatusCode.UNSET}),d.attributes=Object.assign(_,p)}onDone({request:l}){const f=this._recordFromReq.get(l);if(!f)return;const{span:d,attributes:u,startTime:_}=f;d.end(),this._recordFromReq.delete(l),this.recordRequestDuration(u,_)}onError({request:l,error:f}){const d=this._recordFromReq.get(l);if(!d)return;const{span:u,attributes:_,startTime:p}=d;u.recordException(f),u.setStatus({code:r.SpanStatusCode.ERROR,message:f.message}),u.end(),this._recordFromReq.delete(l),_[i.ATTR_ERROR_TYPE]=f.message,this.recordRequestDuration(_,p)}recordRequestDuration(l,f){const d={};[i.ATTR_HTTP_RESPONSE_STATUS_CODE,i.ATTR_HTTP_REQUEST_METHOD,i.ATTR_SERVER_ADDRESS,i.ATTR_SERVER_PORT,i.ATTR_URL_SCHEME,i.ATTR_ERROR_TYPE].forEach(p=>{p in l&&(d[p]=l[p])});const _=(0,s.hrTimeToMilliseconds)((0,s.hrTimeDuration)(f,(0,s.hrTime)()))/1e3;this._httpClientDurationHistogram.record(_,d)}getRequestMethod(l){const f={CONNECT:!0,OPTIONS:!0,HEAD:!0,GET:!0,POST:!0,PUT:!0,PATCH:!0,DELETE:!0,TRACE:!0};return l.toUpperCase()in f?l.toUpperCase():"_OTHER"}}return Ya.UndiciInstrumentation=c,Ya}var dN;function w2(){return dN||(dN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.UndiciInstrumentation=void 0;var t=M2();Object.defineProperty(e,"UndiciInstrumentation",{enumerable:!0,get:function(){return t.UndiciInstrumentation}})})($f)),$f}var L2=w2();const cL="NodeFetch",D2=Pe(cL,L2.UndiciInstrumentation,e=>V2(e)),U2=Pe(`${cL}.sentry`,Z0,e=>e),k2=((e={})=>({name:"NodeFetch",setupOnce(){G2(e,ye()?.getOptions())&&D2(e),U2(e)}})),x2=k2;function B2(e,t="/"){const n=`${e}`;return n.endsWith("/")&&t.startsWith("/")?`${n}${t.slice(1)}`:!n.endsWith("/")&&!t.startsWith("/")?`${n}/${t.slice(1)}`:`${n}${t}`}function G2(e,t={}){return typeof e.spans=="boolean"?e.spans:!t.skipOpenTelemetrySetup&&un(t)}function V2(e={}){return{requireParentforSpans:!1,ignoreRequestHook:n=>{const r=B2(n.origin,n.path),s=e.ignoreOutgoingRequests;return!!(s&&r&&s(r))},startSpanHook:()=>({[He]:"auto.http.otel.node_fetch"}),requestHook:e.requestHook,responseHook:e.responseHook}}var Hf={},Wa={},Ff={},fN;function HT(){return fN||(fN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ExpressLayerType=void 0,(function(t){t.ROUTER="router",t.MIDDLEWARE="middleware",t.REQUEST_HANDLER="request_handler"})(e.ExpressLayerType||(e.ExpressLayerType={}))})(Ff)),Ff}var jf={},_N;function FT(){return _N||(_N=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,(function(t){t.EXPRESS_TYPE="express.type",t.EXPRESS_NAME="express.name"})(e.AttributeNames||(e.AttributeNames={}))})(jf)),jf}var qf={},ls={},pN;function uL(){return pN||(pN=1,Object.defineProperty(ls,"__esModule",{value:!0}),ls._LAYERS_STORE_PROPERTY=ls.kLayerPatched=void 0,ls.kLayerPatched=Symbol("express-layer-patched"),ls._LAYERS_STORE_PROPERTY="__ot_middlewares"),ls}var hN;function $2(){return hN||(hN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getActualMatchedRoute=e.getConstructedRoute=e.getLayerPath=e.asErrorAndMessage=e.isLayerIgnored=e.getLayerMetadata=e.getRouterPath=e.storeLayerPath=void 0;const t=HT(),n=FT(),r=uL(),s=(h,E)=>(Array.isArray(h[r._LAYERS_STORE_PROPERTY])===!1&&Object.defineProperty(h,r._LAYERS_STORE_PROPERTY,{enumerable:!1,value:[]}),E===void 0?{isLayerPathStored:!1}:(h[r._LAYERS_STORE_PROPERTY].push(E),{isLayerPathStored:!0}));e.storeLayerPath=s;const i=(h,E)=>{const T=E.handle?.stack?.[0];return T?.route?.path?`${h}${T.route.path}`:T?.handle?.stack?(0,e.getRouterPath)(h,T):h};e.getRouterPath=i;const o=(h,E,T)=>{if(E.name==="router"){const S=(0,e.getRouterPath)("",E),m=S||T||h||"/";return{attributes:{[n.AttributeNames.EXPRESS_NAME]:m,[n.AttributeNames.EXPRESS_TYPE]:t.ExpressLayerType.ROUTER},name:`router - ${m}`}}else return E.name==="bound dispatch"||E.name==="handle"?{attributes:{[n.AttributeNames.EXPRESS_NAME]:(h||T)??"request handler",[n.AttributeNames.EXPRESS_TYPE]:t.ExpressLayerType.REQUEST_HANDLER},name:`request handler${E.path?` - ${h||T}`:""}`}:{attributes:{[n.AttributeNames.EXPRESS_NAME]:E.name,[n.AttributeNames.EXPRESS_TYPE]:t.ExpressLayerType.MIDDLEWARE},name:`middleware - ${E.name}`}};e.getLayerMetadata=o;const c=(h,E)=>{if(typeof E=="string")return E===h;if(E instanceof RegExp)return E.test(h);if(typeof E=="function")return E(h);throw new TypeError("Pattern is in unsupported datatype")},a=(h,E,T)=>{if(Array.isArray(T?.ignoreLayersType)&&T?.ignoreLayersType?.includes(E))return!0;if(Array.isArray(T?.ignoreLayers)===!1)return!1;try{for(const S of T.ignoreLayers)if(c(h,S))return!0}catch{}return!1};e.isLayerIgnored=a;const l=h=>h instanceof Error?[h,h.message]:[String(h),String(h)];e.asErrorAndMessage=l;const f=h=>{const E=h[0];return Array.isArray(E)?E.map(T=>d(T)||"").join(","):d(E)};e.getLayerPath=f;const d=h=>{if(typeof h=="string")return h;if(h instanceof RegExp||typeof h=="number")return h.toString()};function u(h){const T=(Array.isArray(h[r._LAYERS_STORE_PROPERTY])?h[r._LAYERS_STORE_PROPERTY]:[]).filter(S=>S!=="/"&&S!=="/*");return T.length===1&&T[0]==="*"?"*":T.join("").replace(/\/{2,}/g,"/")}e.getConstructedRoute=u;function _(h){const E=Array.isArray(h[r._LAYERS_STORE_PROPERTY])?h[r._LAYERS_STORE_PROPERTY]:[];if(E.length===0)return;if(E.every(g=>g==="/"))return h.originalUrl==="/"?"/":void 0;const T=u(h);if(T==="*"||T.includes("/")&&(T.includes(",")||T.includes("\\")||T.includes("*")||T.includes("[")))return T;const S=T.startsWith("/")?T:`/${T}`;return S.length>0&&(h.originalUrl===S||h.originalUrl.startsWith(S)||p(S))?S:void 0}e.getActualMatchedRoute=_;function p(h){return h.includes(":")||h.includes("*")}})(qf)),qf}var ds={},EN;function H2(){return EN||(EN=1,Object.defineProperty(ds,"__esModule",{value:!0}),ds.PACKAGE_NAME=ds.PACKAGE_VERSION=void 0,ds.PACKAGE_VERSION="0.57.0",ds.PACKAGE_NAME="@opentelemetry/instrumentation-express"),ds}var TN;function F2(){if(TN)return Wa;TN=1,Object.defineProperty(Wa,"__esModule",{value:!0}),Wa.ExpressInstrumentation=void 0;const e=Ln,t=Ue(),n=HT(),r=FT(),s=$2(),i=H2(),o=Be,c=gt(),a=uL();class l extends o.InstrumentationBase{constructor(d={}){super(i.PACKAGE_NAME,i.PACKAGE_VERSION,d)}init(){return[new o.InstrumentationNodeModuleDefinition("express",[">=4.0.0 <6"],d=>{const u=typeof d?.Router?.prototype?.route=="function",_=u?d.Router.prototype:d.Router;return(0,o.isWrapped)(_.route)&&this._unwrap(_,"route"),this._wrap(_,"route",this._getRoutePatch()),(0,o.isWrapped)(_.use)&&this._unwrap(_,"use"),this._wrap(_,"use",this._getRouterUsePatch()),(0,o.isWrapped)(d.application.use)&&this._unwrap(d.application,"use"),this._wrap(d.application,"use",this._getAppUsePatch(u)),d},d=>{if(d===void 0)return;const _=typeof d?.Router?.prototype?.route=="function"?d.Router.prototype:d.Router;this._unwrap(_,"route"),this._unwrap(_,"use"),this._unwrap(d.application,"use")})]}_getRoutePatch(){const d=this;return function(u){return function(...p){const h=u.apply(this,p),E=this.stack[this.stack.length-1];return d._applyPatch(E,(0,s.getLayerPath)(p)),h}}}_getRouterUsePatch(){const d=this;return function(u){return function(...p){const h=u.apply(this,p),E=this.stack[this.stack.length-1];return d._applyPatch(E,(0,s.getLayerPath)(p)),h}}}_getAppUsePatch(d){const u=this;return function(_){return function(...h){const E=d?this.router:this._router,T=_.apply(this,h);if(E){const S=E.stack[E.stack.length-1];u._applyPatch(S,(0,s.getLayerPath)(h))}return T}}}_applyPatch(d,u){const _=this;d[a.kLayerPatched]!==!0&&(d[a.kLayerPatched]=!0,this._wrap(d,"handle",p=>{if(p.length===4)return p;const h=function(E,T){const{isLayerPathStored:S}=(0,s.storeLayerPath)(E,u),m=(0,s.getConstructedRoute)(E),g=(0,s.getActualMatchedRoute)(E),y={[c.ATTR_HTTP_ROUTE]:g},A=(0,s.getLayerMetadata)(m,d,u),N=A.attributes[r.AttributeNames.EXPRESS_TYPE],O=(0,e.getRPCMetadata)(t.context.active());if(O?.type===e.RPCType.HTTP&&(O.route=g),(0,s.isLayerIgnored)(A.name,N,_.getConfig()))return N===n.ExpressLayerType.MIDDLEWARE&&E[a._LAYERS_STORE_PROPERTY].pop(),p.apply(this,arguments);if(t.trace.getSpan(t.context.active())===void 0)return p.apply(this,arguments);const b=_._getSpanName({request:E,layerType:N,route:m},A.name),C=_.tracer.startSpan(b,{attributes:Object.assign(y,A.attributes)}),w=t.context.active();let k=t.trace.setSpan(w,C);const{requestHook:U}=_.getConfig();U&&(0,o.safeExecuteInTheMiddle)(()=>U(C,{request:E,layerType:N,route:m}),H=>{H&&t.diag.error("express instrumentation: request hook failed",H)},!0);let M=!1;A.attributes[r.AttributeNames.EXPRESS_TYPE]===n.ExpressLayerType.ROUTER&&(C.end(),M=!0,k=w);const F=()=>{M===!1&&(M=!0,C.end())},v=Array.from(arguments),L=v.findIndex(H=>typeof H=="function");L>=0&&(arguments[L]=function(){const H=arguments[0],te=![void 0,null,"route","router"].includes(H);if(!M&&te){const[ee,x]=(0,s.asErrorAndMessage)(H);C.recordException(ee),C.setStatus({code:t.SpanStatusCode.ERROR,message:x})}M===!1&&(M=!0,E.res?.removeListener("finish",F),C.end()),!(E.route&&te)&&S&&E[a._LAYERS_STORE_PROPERTY].pop();const ce=v[L];return t.context.bind(w,ce).apply(this,arguments)});try{return t.context.bind(k,p).apply(this,arguments)}catch(H){const[te,ce]=(0,s.asErrorAndMessage)(H);throw C.recordException(te),C.setStatus({code:t.SpanStatusCode.ERROR,message:ce}),H}finally{M||T.once("finish",F)}};for(const E in p)Object.defineProperty(h,E,{get(){return p[E]},set(T){p[E]=T}});return h}))}_getSpanName(d,u){const{spanNameHook:_}=this.getConfig();if(!(_ instanceof Function))return u;try{return _(d,u)??u}catch(p){return t.diag.error("express instrumentation: error calling span name rewrite hook",p),u}}}return Wa.ExpressInstrumentation=l,Wa}var SN;function j2(){return SN||(SN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=e.ExpressLayerType=e.ExpressInstrumentation=void 0;var t=F2();Object.defineProperty(e,"ExpressInstrumentation",{enumerable:!0,get:function(){return t.ExpressInstrumentation}});var n=HT();Object.defineProperty(e,"ExpressLayerType",{enumerable:!0,get:function(){return n.ExpressLayerType}});var r=FT();Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return r.AttributeNames}})})(Hf)),Hf}var q2=j2();const Js=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,lL="Express";function Y2(e){Dt(e,"auto.http.otel.express");const t=ve(e).data,n=t["express.type"];n&&e.setAttribute(Re,`${n}.express`);const r=t["express.name"];typeof r=="string"&&e.updateName(r)}function W2(e,t){if(tt()===Qi())return Js&&Y.warn("Isolation scope is still default isolation scope - skipping setting transactionName"),t;if(e.layerType==="request_handler"){const n=e.request,r=n.method?n.method.toUpperCase():"GET";tt().setTransactionName(`${r} ${e.route}`)}return t}const K2=Pe(lL,()=>new q2.ExpressInstrumentation({requestHook:e=>Y2(e),spanNameHook:(e,t)=>W2(e,t)})),z2=(()=>({name:lL,setupOnce(){K2()}})),Z2=z2;var Yf,mN;function X2(){if(mN)return Yf;mN=1,Yf=e;function e(r,s,i){r instanceof RegExp&&(r=t(r,i)),s instanceof RegExp&&(s=t(s,i));var o=n(r,s,i);return o&&{start:o[0],end:o[1],pre:i.slice(0,o[0]),body:i.slice(o[0]+r.length,o[1]),post:i.slice(o[1]+s.length)}}function t(r,s){var i=s.match(r);return i?i[0]:null}e.range=n;function n(r,s,i){var o,c,a,l,f,d=i.indexOf(r),u=i.indexOf(s,d+1),_=d;if(d>=0&&u>0){if(r===s)return[d,u];for(o=[],a=i.length;_>=0&&!f;)_==d?(o.push(_),d=i.indexOf(r,_+1)):o.length==1?f=[o.pop(),u]:(c=o.pop(),c<a&&(a=c,l=u),u=i.indexOf(s,_+1)),_=d<u&&d>=0?d:u;o.length&&(f=[a,l])}return f}return Yf}var Wf,gN;function Q2(){if(gN)return Wf;gN=1;var e=X2();Wf=f;var t="\0SLASH"+Math.random()+"\0",n="\0OPEN"+Math.random()+"\0",r="\0CLOSE"+Math.random()+"\0",s="\0COMMA"+Math.random()+"\0",i="\0PERIOD"+Math.random()+"\0";function o(E){return parseInt(E,10)==E?parseInt(E,10):E.charCodeAt(0)}function c(E){return E.split("\\\\").join(t).split("\\{").join(n).split("\\}").join(r).split("\\,").join(s).split("\\.").join(i)}function a(E){return E.split(t).join("\\").split(n).join("{").split(r).join("}").split(s).join(",").split(i).join(".")}function l(E){if(!E)return[""];var T=[],S=e("{","}",E);if(!S)return E.split(",");var m=S.pre,g=S.body,y=S.post,A=m.split(",");A[A.length-1]+="{"+g+"}";var N=l(y);return y.length&&(A[A.length-1]+=N.shift(),A.push.apply(A,N)),T.push.apply(T,A),T}function f(E){return E?(E.substr(0,2)==="{}"&&(E="\\{\\}"+E.substr(2)),h(c(E),!0).map(a)):[]}function d(E){return"{"+E+"}"}function u(E){return/^-?0\d/.test(E)}function _(E,T){return E<=T}function p(E,T){return E>=T}function h(E,T){var S=[],m=e("{","}",E);if(!m)return[E];var g=m.pre,y=m.post.length?h(m.post,!1):[""];if(/\$$/.test(m.pre))for(var A=0;A<y.length;A++){var N=g+"{"+m.body+"}"+y[A];S.push(N)}else{var O=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(m.body),b=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(m.body),C=O||b,w=m.body.indexOf(",")>=0;if(!C&&!w)return m.post.match(/,(?!,).*\}/)?(E=m.pre+"{"+m.body+r+m.post,h(E)):[E];var k;if(C)k=m.body.split(/\.\./);else if(k=l(m.body),k.length===1&&(k=h(k[0],!1).map(d),k.length===1))return y.map(function(z){return m.pre+k[0]+z});var U;if(C){var M=o(k[0]),F=o(k[1]),v=Math.max(k[0].length,k[1].length),L=k.length==3?Math.abs(o(k[2])):1,H=_,te=F<M;te&&(L*=-1,H=p);var ce=k.some(u);U=[];for(var ee=M;H(ee,F);ee+=L){var x;if(b)x=String.fromCharCode(ee),x==="\\"&&(x="");else if(x=String(ee),ce){var B=v-x.length;if(B>0){var j=new Array(B+1).join("0");ee<0?x="-"+j+x.slice(1):x=j+x}}U.push(x)}}else{U=[];for(var q=0;q<k.length;q++)U.push.apply(U,h(k[q],!1))}for(var q=0;q<U.length;q++)for(var A=0;A<y.length;A++){var N=g+U[q]+y[A];(!T||C||N)&&S.push(N)}}return S}return Wf}var J2=Q2();const eK=td(J2),tK=1024*64,Ul=e=>{if(typeof e!="string")throw new TypeError("invalid pattern");if(e.length>tK)throw new TypeError("pattern is too long")},nK={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},Ka=e=>e.replace(/[[\]\\-]/g,"\\$&"),rK=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),AN=e=>e.join(""),sK=(e,t)=>{const n=t;if(e.charAt(n)!=="[")throw new Error("not in a brace expression");const r=[],s=[];let i=n+1,o=!1,c=!1,a=!1,l=!1,f=n,d="";e:for(;i<e.length;){const h=e.charAt(i);if((h==="!"||h==="^")&&i===n+1){l=!0,i++;continue}if(h==="]"&&o&&!a){f=i+1;break}if(o=!0,h==="\\"&&!a){a=!0,i++;continue}if(h==="["&&!a){for(const[E,[T,S,m]]of Object.entries(nK))if(e.startsWith(E,i)){if(d)return["$.",!1,e.length-n,!0];i+=E.length,m?s.push(T):r.push(T),c=c||S;continue e}}if(a=!1,d){h>d?r.push(Ka(d)+"-"+Ka(h)):h===d&&r.push(Ka(h)),d="",i++;continue}if(e.startsWith("-]",i+1)){r.push(Ka(h+"-")),i+=2;continue}if(e.startsWith("-",i+1)){d=h,i+=2;continue}r.push(Ka(h)),i++}if(f<i)return["",!1,0,!1];if(!r.length&&!s.length)return["$.",!1,e.length-n,!0];if(s.length===0&&r.length===1&&/^\\?.$/.test(r[0])&&!l){const h=r[0].length===2?r[0].slice(-1):r[0];return[rK(h),!1,f-n,!1]}const u="["+(l?"^":"")+AN(r)+"]",_="["+(l?"":"^")+AN(s)+"]";return[r.length&&s.length?"("+u+"|"+_+")":r.length?u:_,c,f-n,!0]},Dc=(e,{windowsPathsNoEscape:t=!1}={})=>t?e.replace(/\[([^\/\\])\]/g,"$1"):e.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),iK=new Set(["!","?","+","*","@"]),RN=e=>iK.has(e),oK="(?!(?:^|/)\\.\\.?(?:$|/))",Uu="(?!\\.)",aK=new Set(["[","."]),cK=new Set(["..","."]),uK=new Set("().*{}+?[]^$\\!"),lK=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),jT="[^/]",yN=jT+"*?",NN=jT+"+?";class vt{type;#e;#t;#r=!1;#n=[];#s;#o;#c;#a=!1;#i;#u;#d=!1;constructor(t,n,r={}){this.type=t,t&&(this.#t=!0),this.#s=n,this.#e=this.#s?this.#s.#e:this,this.#i=this.#e===this?r:this.#e.#i,this.#c=this.#e===this?[]:this.#e.#c,t==="!"&&!this.#e.#a&&this.#c.push(this),this.#o=this.#s?this.#s.#n.length:0}get hasMagic(){if(this.#t!==void 0)return this.#t;for(const t of this.#n)if(typeof t!="string"&&(t.type||t.hasMagic))return this.#t=!0;return this.#t}toString(){return this.#u!==void 0?this.#u:this.type?this.#u=this.type+"("+this.#n.map(t=>String(t)).join("|")+")":this.#u=this.#n.map(t=>String(t)).join("")}#_(){if(this!==this.#e)throw new Error("should only call on root");if(this.#a)return this;this.toString(),this.#a=!0;let t;for(;t=this.#c.pop();){if(t.type!=="!")continue;let n=t,r=n.#s;for(;r;){for(let s=n.#o+1;!r.type&&s<r.#n.length;s++)for(const i of t.#n){if(typeof i=="string")throw new Error("string part in extglob AST??");i.copyIn(r.#n[s])}n=r,r=n.#s}}return this}push(...t){for(const n of t)if(n!==""){if(typeof n!="string"&&!(n instanceof vt&&n.#s===this))throw new Error("invalid part: "+n);this.#n.push(n)}}toJSON(){const t=this.type===null?this.#n.slice().map(n=>typeof n=="string"?n:n.toJSON()):[this.type,...this.#n.map(n=>n.toJSON())];return this.isStart()&&!this.type&&t.unshift([]),this.isEnd()&&(this===this.#e||this.#e.#a&&this.#s?.type==="!")&&t.push({}),t}isStart(){if(this.#e===this)return!0;if(!this.#s?.isStart())return!1;if(this.#o===0)return!0;const t=this.#s;for(let n=0;n<this.#o;n++){const r=t.#n[n];if(!(r instanceof vt&&r.type==="!"))return!1}return!0}isEnd(){if(this.#e===this||this.#s?.type==="!")return!0;if(!this.#s?.isEnd())return!1;if(!this.type)return this.#s?.isEnd();const t=this.#s?this.#s.#n.length:0;return this.#o===t-1}copyIn(t){typeof t=="string"?this.push(t):this.push(t.clone(this))}clone(t){const n=new vt(this.type,t);for(const r of this.#n)n.copyIn(r);return n}static#l(t,n,r,s){let i=!1,o=!1,c=-1,a=!1;if(n.type===null){let _=r,p="";for(;_<t.length;){const h=t.charAt(_++);if(i||h==="\\"){i=!i,p+=h;continue}if(o){_===c+1?(h==="^"||h==="!")&&(a=!0):h==="]"&&!(_===c+2&&a)&&(o=!1),p+=h;continue}else if(h==="["){o=!0,c=_,a=!1,p+=h;continue}if(!s.noext&&RN(h)&&t.charAt(_)==="("){n.push(p),p="";const E=new vt(h,n);_=vt.#l(t,E,_,s),n.push(E);continue}p+=h}return n.push(p),_}let l=r+1,f=new vt(null,n);const d=[];let u="";for(;l<t.length;){const _=t.charAt(l++);if(i||_==="\\"){i=!i,u+=_;continue}if(o){l===c+1?(_==="^"||_==="!")&&(a=!0):_==="]"&&!(l===c+2&&a)&&(o=!1),u+=_;continue}else if(_==="["){o=!0,c=l,a=!1,u+=_;continue}if(RN(_)&&t.charAt(l)==="("){f.push(u),u="";const p=new vt(_,f);f.push(p),l=vt.#l(t,p,l,s);continue}if(_==="|"){f.push(u),u="",d.push(f),f=new vt(null,n);continue}if(_===")")return u===""&&n.#n.length===0&&(n.#d=!0),f.push(u),u="",n.push(...d,f),l;u+=_}return n.type=null,n.#t=void 0,n.#n=[t.substring(r-1)],l}static fromGlob(t,n={}){const r=new vt(null,void 0,n);return vt.#l(t,r,0,n),r}toMMPattern(){if(this!==this.#e)return this.#e.toMMPattern();const t=this.toString(),[n,r,s,i]=this.toRegExpSource();if(!(s||this.#t||this.#i.nocase&&!this.#i.nocaseMagicOnly&&t.toUpperCase()!==t.toLowerCase()))return r;const c=(this.#i.nocase?"i":"")+(i?"u":"");return Object.assign(new RegExp(`^${n}$`,c),{_src:n,_glob:t})}get options(){return this.#i}toRegExpSource(t){const n=t??!!this.#i.dot;if(this.#e===this&&this.#_(),!this.type){const a=this.isStart()&&this.isEnd(),l=this.#n.map(_=>{const[p,h,E,T]=typeof _=="string"?vt.#p(_,this.#t,a):_.toRegExpSource(t);return this.#t=this.#t||E,this.#r=this.#r||T,p}).join("");let f="";if(this.isStart()&&typeof this.#n[0]=="string"&&!(this.#n.length===1&&cK.has(this.#n[0]))){const p=aK,h=n&&p.has(l.charAt(0))||l.startsWith("\\.")&&p.has(l.charAt(2))||l.startsWith("\\.\\.")&&p.has(l.charAt(4)),E=!n&&!t&&p.has(l.charAt(0));f=h?oK:E?Uu:""}let d="";return this.isEnd()&&this.#e.#a&&this.#s?.type==="!"&&(d="(?:$|\\/)"),[f+l+d,Dc(l),this.#t=!!this.#t,this.#r]}const r=this.type==="*"||this.type==="+",s=this.type==="!"?"(?:(?!(?:":"(?:";let i=this.#f(n);if(this.isStart()&&this.isEnd()&&!i&&this.type!=="!"){const a=this.toString();return this.#n=[a],this.type=null,this.#t=void 0,[a,Dc(this.toString()),!1,!1]}let o=!r||t||n||!Uu?"":this.#f(!0);o===i&&(o=""),o&&(i=`(?:${i})(?:${o})*?`);let c="";if(this.type==="!"&&this.#d)c=(this.isStart()&&!n?Uu:"")+NN;else{const a=this.type==="!"?"))"+(this.isStart()&&!n&&!t?Uu:"")+yN+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&o?")":this.type==="*"&&o?")?":`)${this.type}`;c=s+i+a}return[c,Dc(i),this.#t=!!this.#t,this.#r]}#f(t){return this.#n.map(n=>{if(typeof n=="string")throw new Error("string type in extglob ast??");const[r,s,i,o]=n.toRegExpSource(t);return this.#r=this.#r||o,r}).filter(n=>!(this.isStart()&&this.isEnd())||!!n).join("|")}static#p(t,n,r=!1){let s=!1,i="",o=!1;for(let c=0;c<t.length;c++){const a=t.charAt(c);if(s){s=!1,i+=(uK.has(a)?"\\":"")+a;continue}if(a==="\\"){c===t.length-1?i+="\\\\":s=!0;continue}if(a==="["){const[l,f,d,u]=sK(t,c);if(d){i+=l,o=o||f,c+=d-1,n=n||u;continue}}if(a==="*"){r&&t==="*"?i+=NN:i+=yN,n=!0;continue}if(a==="?"){i+=jT,n=!0;continue}i+=lK(a)}return[i,Dc(t),!!n,o]}}const dK=(e,{windowsPathsNoEscape:t=!1}={})=>t?e.replace(/[?*()[\]]/g,"[$&]"):e.replace(/[?*()[\]\\]/g,"\\$&"),mt=(e,t,n={})=>(Ul(t),!n.nocomment&&t.charAt(0)==="#"?!1:new wd(t,n).match(e)),fK=/^\*+([^+@!?\*\[\(]*)$/,_K=e=>t=>!t.startsWith(".")&&t.endsWith(e),pK=e=>t=>t.endsWith(e),hK=e=>(e=e.toLowerCase(),t=>!t.startsWith(".")&&t.toLowerCase().endsWith(e)),EK=e=>(e=e.toLowerCase(),t=>t.toLowerCase().endsWith(e)),TK=/^\*+\.\*+$/,SK=e=>!e.startsWith(".")&&e.includes("."),mK=e=>e!=="."&&e!==".."&&e.includes("."),gK=/^\.\*+$/,AK=e=>e!=="."&&e!==".."&&e.startsWith("."),RK=/^\*+$/,yK=e=>e.length!==0&&!e.startsWith("."),NK=e=>e.length!==0&&e!=="."&&e!=="..",OK=/^\?+([^+@!?\*\[\(]*)?$/,bK=([e,t=""])=>{const n=dL([e]);return t?(t=t.toLowerCase(),r=>n(r)&&r.toLowerCase().endsWith(t)):n},IK=([e,t=""])=>{const n=fL([e]);return t?(t=t.toLowerCase(),r=>n(r)&&r.toLowerCase().endsWith(t)):n},CK=([e,t=""])=>{const n=fL([e]);return t?r=>n(r)&&r.endsWith(t):n},vK=([e,t=""])=>{const n=dL([e]);return t?r=>n(r)&&r.endsWith(t):n},dL=([e])=>{const t=e.length;return n=>n.length===t&&!n.startsWith(".")},fL=([e])=>{const t=e.length;return n=>n.length===t&&n!=="."&&n!==".."},_L=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",ON={win32:{sep:"\\"},posix:{sep:"/"}},PK=_L==="win32"?ON.win32.sep:ON.posix.sep;mt.sep=PK;const Jt=Symbol("globstar **");mt.GLOBSTAR=Jt;const MK="[^/]",wK=MK+"*?",LK="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",DK="(?:(?!(?:\\/|^)\\.).)*?",UK=(e,t={})=>n=>mt(n,e,t);mt.filter=UK;const Qt=(e,t={})=>Object.assign({},e,t),kK=e=>{if(!e||typeof e!="object"||!Object.keys(e).length)return mt;const t=mt;return Object.assign((r,s,i={})=>t(r,s,Qt(e,i)),{Minimatch:class extends t.Minimatch{constructor(s,i={}){super(s,Qt(e,i))}static defaults(s){return t.defaults(Qt(e,s)).Minimatch}},AST:class extends t.AST{constructor(s,i,o={}){super(s,i,Qt(e,o))}static fromGlob(s,i={}){return t.AST.fromGlob(s,Qt(e,i))}},unescape:(r,s={})=>t.unescape(r,Qt(e,s)),escape:(r,s={})=>t.escape(r,Qt(e,s)),filter:(r,s={})=>t.filter(r,Qt(e,s)),defaults:r=>t.defaults(Qt(e,r)),makeRe:(r,s={})=>t.makeRe(r,Qt(e,s)),braceExpand:(r,s={})=>t.braceExpand(r,Qt(e,s)),match:(r,s,i={})=>t.match(r,s,Qt(e,i)),sep:t.sep,GLOBSTAR:Jt})};mt.defaults=kK;const pL=(e,t={})=>(Ul(e),t.nobrace||!/\{(?:(?!\{).)*\}/.test(e)?[e]:eK(e));mt.braceExpand=pL;const xK=(e,t={})=>new wd(e,t).makeRe();mt.makeRe=xK;const BK=(e,t,n={})=>{const r=new wd(t,n);return e=e.filter(s=>r.match(s)),r.options.nonull&&!e.length&&e.push(t),e};mt.match=BK;const bN=/[?*]|[+@!]\(.*?\)|\[|\]/,GK=e=>e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");class wd{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(t,n={}){Ul(t),n=n||{},this.options=n,this.pattern=t,this.platform=n.platform||_L,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!n.windowsPathsNoEscape||n.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!n.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!n.nonegate,this.comment=!1,this.empty=!1,this.partial=!!n.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=n.windowsNoMagicRoot!==void 0?n.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const t of this.set)for(const n of t)if(typeof n!="string")return!0;return!1}debug(...t){}make(){const t=this.pattern,n=this.options;if(!n.nocomment&&t.charAt(0)==="#"){this.comment=!0;return}if(!t){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],n.debug&&(this.debug=(...i)=>console.error(...i)),this.debug(this.pattern,this.globSet);const r=this.globSet.map(i=>this.slashSplit(i));this.globParts=this.preprocess(r),this.debug(this.pattern,this.globParts);let s=this.globParts.map((i,o,c)=>{if(this.isWindows&&this.windowsNoMagicRoot){const a=i[0]===""&&i[1]===""&&(i[2]==="?"||!bN.test(i[2]))&&!bN.test(i[3]),l=/^[a-z]:/i.test(i[0]);if(a)return[...i.slice(0,4),...i.slice(4).map(f=>this.parse(f))];if(l)return[i[0],...i.slice(1).map(f=>this.parse(f))]}return i.map(a=>this.parse(a))});if(this.debug(this.pattern,s),this.set=s.filter(i=>i.indexOf(!1)===-1),this.isWindows)for(let i=0;i<this.set.length;i++){const o=this.set[i];o[0]===""&&o[1]===""&&this.globParts[i][2]==="?"&&typeof o[3]=="string"&&/^[a-z]:$/i.test(o[3])&&(o[2]="?")}this.debug(this.pattern,this.set)}preprocess(t){if(this.options.noglobstar)for(let r=0;r<t.length;r++)for(let s=0;s<t[r].length;s++)t[r][s]==="**"&&(t[r][s]="*");const{optimizationLevel:n=1}=this.options;return n>=2?(t=this.firstPhasePreProcess(t),t=this.secondPhasePreProcess(t)):n>=1?t=this.levelOneOptimize(t):t=this.adjascentGlobstarOptimize(t),t}adjascentGlobstarOptimize(t){return t.map(n=>{let r=-1;for(;(r=n.indexOf("**",r+1))!==-1;){let s=r;for(;n[s+1]==="**";)s++;s!==r&&n.splice(r,s-r)}return n})}levelOneOptimize(t){return t.map(n=>(n=n.reduce((r,s)=>{const i=r[r.length-1];return s==="**"&&i==="**"?r:s===".."&&i&&i!==".."&&i!=="."&&i!=="**"?(r.pop(),r):(r.push(s),r)},[]),n.length===0?[""]:n))}levelTwoFileOptimize(t){Array.isArray(t)||(t=this.slashSplit(t));let n=!1;do{if(n=!1,!this.preserveMultipleSlashes){for(let s=1;s<t.length-1;s++){const i=t[s];s===1&&i===""&&t[0]===""||(i==="."||i==="")&&(n=!0,t.splice(s,1),s--)}t[0]==="."&&t.length===2&&(t[1]==="."||t[1]==="")&&(n=!0,t.pop())}let r=0;for(;(r=t.indexOf("..",r+1))!==-1;){const s=t[r-1];s&&s!=="."&&s!==".."&&s!=="**"&&(n=!0,t.splice(r-1,2),r-=2)}}while(n);return t.length===0?[""]:t}firstPhasePreProcess(t){let n=!1;do{n=!1;for(let r of t){let s=-1;for(;(s=r.indexOf("**",s+1))!==-1;){let o=s;for(;r[o+1]==="**";)o++;o>s&&r.splice(s+1,o-s);let c=r[s+1];const a=r[s+2],l=r[s+3];if(c!==".."||!a||a==="."||a===".."||!l||l==="."||l==="..")continue;n=!0,r.splice(s,1);const f=r.slice(0);f[s]="**",t.push(f),s--}if(!this.preserveMultipleSlashes){for(let o=1;o<r.length-1;o++){const c=r[o];o===1&&c===""&&r[0]===""||(c==="."||c==="")&&(n=!0,r.splice(o,1),o--)}r[0]==="."&&r.length===2&&(r[1]==="."||r[1]==="")&&(n=!0,r.pop())}let i=0;for(;(i=r.indexOf("..",i+1))!==-1;){const o=r[i-1];if(o&&o!=="."&&o!==".."&&o!=="**"){n=!0;const a=i===1&&r[i+1]==="**"?["."]:[];r.splice(i-1,2,...a),r.length===0&&r.push(""),i-=2}}}}while(n);return t}secondPhasePreProcess(t){for(let n=0;n<t.length-1;n++)for(let r=n+1;r<t.length;r++){const s=this.partsMatch(t[n],t[r],!this.preserveMultipleSlashes);if(s){t[n]=[],t[r]=s;break}}return t.filter(n=>n.length)}partsMatch(t,n,r=!1){let s=0,i=0,o=[],c="";for(;s<t.length&&i<n.length;)if(t[s]===n[i])o.push(c==="b"?n[i]:t[s]),s++,i++;else if(r&&t[s]==="**"&&n[i]===t[s+1])o.push(t[s]),s++;else if(r&&n[i]==="**"&&t[s]===n[i+1])o.push(n[i]),i++;else if(t[s]==="*"&&n[i]&&(this.options.dot||!n[i].startsWith("."))&&n[i]!=="**"){if(c==="b")return!1;c="a",o.push(t[s]),s++,i++}else if(n[i]==="*"&&t[s]&&(this.options.dot||!t[s].startsWith("."))&&t[s]!=="**"){if(c==="a")return!1;c="b",o.push(n[i]),s++,i++}else return!1;return t.length===n.length&&o}parseNegate(){if(this.nonegate)return;const t=this.pattern;let n=!1,r=0;for(let s=0;s<t.length&&t.charAt(s)==="!";s++)n=!n,r++;r&&(this.pattern=t.slice(r)),this.negate=n}matchOne(t,n,r=!1){const s=this.options;if(this.isWindows){const h=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),E=!h&&t[0]===""&&t[1]===""&&t[2]==="?"&&/^[a-z]:$/i.test(t[3]),T=typeof n[0]=="string"&&/^[a-z]:$/i.test(n[0]),S=!T&&n[0]===""&&n[1]===""&&n[2]==="?"&&typeof n[3]=="string"&&/^[a-z]:$/i.test(n[3]),m=E?3:h?0:void 0,g=S?3:T?0:void 0;if(typeof m=="number"&&typeof g=="number"){const[y,A]=[t[m],n[g]];y.toLowerCase()===A.toLowerCase()&&(n[g]=y,g>m?n=n.slice(g):m>g&&(t=t.slice(m)))}}const{optimizationLevel:i=1}=this.options;i>=2&&(t=this.levelTwoFileOptimize(t)),this.debug("matchOne",this,{file:t,pattern:n}),this.debug("matchOne",t.length,n.length);for(var o=0,c=0,a=t.length,l=n.length;o<a&&c<l;o++,c++){this.debug("matchOne loop");var f=n[c],d=t[o];if(this.debug(n,f,d),f===!1)return!1;if(f===Jt){this.debug("GLOBSTAR",[n,f,d]);var u=o,_=c+1;if(_===l){for(this.debug("** at the end");o<a;o++)if(t[o]==="."||t[o]===".."||!s.dot&&t[o].charAt(0)===".")return!1;return!0}for(;u<a;){var p=t[u];if(this.debug(`
globstar while`,t,u,n,_,p),this.matchOne(t.slice(u),n.slice(_),r))return this.debug("globstar found match!",u,a,p),!0;if(p==="."||p===".."||!s.dot&&p.charAt(0)==="."){this.debug("dot detected!",t,u,n,_);break}this.debug("globstar swallow a segment, and continue"),u++}return!!(r&&(this.debug(`
>>> no match, partial?`,t,u,n,_),u===a))}let h;if(typeof f=="string"?(h=d===f,this.debug("string match",f,d,h)):(h=f.test(d),this.debug("pattern match",f,d,h)),!h)return!1}if(o===a&&c===l)return!0;if(o===a)return r;if(c===l)return o===a-1&&t[o]==="";throw new Error("wtf?")}braceExpand(){return pL(this.pattern,this.options)}parse(t){Ul(t);const n=this.options;if(t==="**")return Jt;if(t==="")return"";let r,s=null;(r=t.match(RK))?s=n.dot?NK:yK:(r=t.match(fK))?s=(n.nocase?n.dot?EK:hK:n.dot?pK:_K)(r[1]):(r=t.match(OK))?s=(n.nocase?n.dot?IK:bK:n.dot?CK:vK)(r):(r=t.match(TK))?s=n.dot?mK:SK:(r=t.match(gK))&&(s=AK);const i=vt.fromGlob(t,this.options).toMMPattern();return s&&typeof i=="object"&&Reflect.defineProperty(i,"test",{value:s}),i}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const t=this.set;if(!t.length)return this.regexp=!1,this.regexp;const n=this.options,r=n.noglobstar?wK:n.dot?LK:DK,s=new Set(n.nocase?["i"]:[]);let i=t.map(a=>{const l=a.map(f=>{if(f instanceof RegExp)for(const d of f.flags.split(""))s.add(d);return typeof f=="string"?GK(f):f===Jt?Jt:f._src});return l.forEach((f,d)=>{const u=l[d+1],_=l[d-1];f!==Jt||_===Jt||(_===void 0?u!==void 0&&u!==Jt?l[d+1]="(?:\\/|"+r+"\\/)?"+u:l[d]=r:u===void 0?l[d-1]=_+"(?:\\/|"+r+")?":u!==Jt&&(l[d-1]=_+"(?:\\/|\\/"+r+"\\/)"+u,l[d+1]=Jt))}),l.filter(f=>f!==Jt).join("/")}).join("|");const[o,c]=t.length>1?["(?:",")"]:["",""];i="^"+o+i+c+"$",this.negate&&(i="^(?!"+i+").+$");try{this.regexp=new RegExp(i,[...s].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(t){return this.preserveMultipleSlashes?t.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(t)?["",...t.split(/\/+/)]:t.split(/\/+/)}match(t,n=this.partial){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return t==="";if(t==="/"&&n)return!0;const r=this.options;this.isWindows&&(t=t.split("\\").join("/"));const s=this.slashSplit(t);this.debug(this.pattern,"split",s);const i=this.set;this.debug(this.pattern,"set",i);let o=s[s.length-1];if(!o)for(let c=s.length-2;!o&&c>=0;c--)o=s[c];for(let c=0;c<i.length;c++){const a=i[c];let l=s;if(r.matchBase&&a.length===1&&(l=[o]),this.matchOne(l,a,n))return r.flipNegate?!0:!this.negate}return r.flipNegate?!1:this.negate}static defaults(t){return mt.defaults(t).Minimatch}}mt.AST=vt;mt.Minimatch=wd;mt.escape=dK;mt.unescape=Dc;const IN="@fastify/otel",VK="0.8.0",$K=">=4.0.0 <6",CN=["onRequest","preParsing","preValidation","preHandler","preSerialization","onSend","onResponse","onError"],je={HOOK_NAME:"hook.name",FASTIFY_TYPE:"fastify.type",HOOK_CALLBACK_NAME:"hook.callback.name",ROOT:"fastify.root"},Pr={ROUTE:"route-hook",INSTANCE:"hook",HANDLER:"request-handler"},er="anonymous",yt=Symbol("fastify otel instance"),Mr=Symbol("fastify otel request spans"),za=Symbol("fastify otel request context"),vN=Symbol("fastify otel addhook original"),PN=Symbol("fastify otel setnotfound original"),ku=Symbol("fastify otel ignore path");class HK extends Ut{constructor(t){if(super(IN,VK,t),this.servername=t?.servername??process.env.OTEL_SERVICE_NAME??"fastify",this[ku]=null,this._logger=D.diag.createComponentLogger({namespace:IN}),t?.ignorePaths!=null||process.env.OTEL_FASTIFY_IGNORE_PATHS!=null){const n=t?.ignorePaths??process.env.OTEL_FASTIFY_IGNORE_PATHS;if((typeof n!="string"||n.length===0)&&typeof n!="function")throw new TypeError("ignorePaths must be a string or a function");const r=mt;this[ku]=s=>typeof n=="function"?n(s):r(s.url,n)}}enable(){if(this._handleInitialization===void 0&&this.getConfig().registerOnInitialization){const t=this.plugin();this._handleInitialization=n=>{n.fastify.register(t)},$n.subscribe("fastify.initialization",this._handleInitialization)}return super.enable()}disable(){return this._handleInitialization&&($n.unsubscribe("fastify.initialization",this._handleInitialization),this._handleInitialization=void 0),super.disable()}init(){return[]}plugin(){const t=this;return n[Symbol.for("skip-override")]=!0,n[Symbol.for("fastify.display-name")]="@fastify/otel",n[Symbol.for("plugin-meta")]={fastify:$K,name:"@fastify/otel"},n;function n(r,s,i){r.decorate(yt,t),r.decorate(vN,r.addHook),r.decorate(PN,r.setNotFoundHandler),r.decorateRequest("opentelemetry",function(){const u=this[za];return{span:this[Mr],tracer:t.tracer,context:u,inject:(p,h)=>D.propagation.inject(u,p,h),extract:(p,h)=>D.propagation.extract(u,p,h)}}),r.decorateRequest(Mr,null),r.decorateRequest(za,null),r.addHook("onRoute",function(d){if(t[ku]?.(d)===!0){t._logger.debug(`Ignoring route instrumentation ${d.method} ${d.url} because it matches the ignore path`);return}for(const u of CN)if(d[u]!=null){const _=d[u];if(typeof _=="function")d[u]=f(_,{[ne.ATTR_SERVICE_NAME]:r[yt].servername,[je.HOOK_NAME]:`${this.pluginName} - route -> ${u}`,[je.FASTIFY_TYPE]:Pr.ROUTE,[ne.ATTR_HTTP_ROUTE]:d.url,[je.HOOK_CALLBACK_NAME]:_.name?.length>0?_.name:er});else if(Array.isArray(_)){const p=[];for(const h of _)p.push(f(h,{[ne.ATTR_SERVICE_NAME]:r[yt].servername,[je.HOOK_NAME]:`${this.pluginName} - route -> ${u}`,[je.FASTIFY_TYPE]:Pr.ROUTE,[ne.ATTR_HTTP_ROUTE]:d.url,[je.HOOK_CALLBACK_NAME]:h.name?.length>0?h.name:er}));d[u]=p}}d.onSend!=null?d.onSend=Array.isArray(d.onSend)?[...d.onSend,o]:[d.onSend,o]:d.onSend=o,d.onError!=null?d.onError=Array.isArray(d.onError)?[...d.onError,c]:[d.onError,c]:d.onError=c,d.handler=f(d.handler,{[ne.ATTR_SERVICE_NAME]:r[yt].servername,[je.HOOK_NAME]:`${this.pluginName} - route-handler`,[je.FASTIFY_TYPE]:Pr.HANDLER,[ne.ATTR_HTTP_ROUTE]:d.url,[je.HOOK_CALLBACK_NAME]:d.handler.name.length>0?d.handler.name:er})}),r.addHook("onRequest",function(d,u,_){if(this[yt].isEnabled()===!1)return _();if(this[yt][ku]?.({url:d.url,method:d.method})===!0)return this[yt]._logger.debug(`Ignoring request ${d.method} ${d.url} because it matches the ignore path`),_();let p=D.context.active();D.trace.getSpan(p)==null&&(p=D.propagation.extract(p,d.headers));const h=od(p);d.routeOptions.url!=null&&h?.type===Ys.HTTP&&(h.route=d.routeOptions.url);const E=this[yt].tracer.startSpan("request",{attributes:{[ne.ATTR_SERVICE_NAME]:r[yt].servername,[je.ROOT]:"@fastify/otel",[ne.ATTR_HTTP_ROUTE]:d.url,[ne.ATTR_HTTP_REQUEST_METHOD]:d.method}},p);d[za]=D.trace.setSpan(p,E),d[Mr]=E,D.context.with(d[za],()=>{_()})}),r.addHook("onResponse",function(d,u,_){const p=d[Mr];p!=null&&(p.setStatus({code:D.SpanStatusCode.OK,message:"OK"}),p.setAttributes({[ne.ATTR_HTTP_RESPONSE_STATUS_CODE]:404}),p.end()),d[Mr]=null,_()}),r.addHook=a,r.setNotFoundHandler=l,i();function o(d,u,_,p){const h=d[Mr];h!=null&&(u.statusCode<500&&h.setStatus({code:D.SpanStatusCode.OK,message:"OK"}),h.setAttributes({[ne.ATTR_HTTP_RESPONSE_STATUS_CODE]:u.statusCode}),h.end()),d[Mr]=null,p(null,_)}function c(d,u,_,p){const h=d[Mr];h!=null&&(h.setStatus({code:D.SpanStatusCode.ERROR,message:_.message}),h.recordException(_)),p()}function a(d,u){const _=this[vN];return CN.includes(d)?_.call(this,d,f(u,{[ne.ATTR_SERVICE_NAME]:r[yt].servername,[je.HOOK_NAME]:`${this.pluginName} - ${d}`,[je.FASTIFY_TYPE]:Pr.INSTANCE,[je.HOOK_CALLBACK_NAME]:u.name?.length>0?u.name:er})):_.call(this,d,u)}function l(d,u){const _=this[PN];typeof d=="function"?(u=f(d,{[ne.ATTR_SERVICE_NAME]:r[yt].servername,[je.HOOK_NAME]:`${this.pluginName} - not-found-handler`,[je.FASTIFY_TYPE]:Pr.INSTANCE,[je.HOOK_CALLBACK_NAME]:d.name?.length>0?d.name:er}),_.call(this,u)):(d.preValidation!=null&&(d.preValidation=f(d.preValidation,{[ne.ATTR_SERVICE_NAME]:r[yt].servername,[je.HOOK_NAME]:`${this.pluginName} - not-found-handler - preValidation`,[je.FASTIFY_TYPE]:Pr.INSTANCE,[je.HOOK_CALLBACK_NAME]:d.preValidation.name?.length>0?d.preValidation.name:er})),d.preHandler!=null&&(d.preHandler=f(d.preHandler,{[ne.ATTR_SERVICE_NAME]:r[yt].servername,[je.HOOK_NAME]:`${this.pluginName} - not-found-handler - preHandler`,[je.FASTIFY_TYPE]:Pr.INSTANCE,[je.HOOK_CALLBACK_NAME]:d.preHandler.name?.length>0?d.preHandler.name:er})),u=f(u,{[ne.ATTR_SERVICE_NAME]:r[yt].servername,[je.HOOK_NAME]:`${this.pluginName} - not-found-handler`,[je.FASTIFY_TYPE]:Pr.INSTANCE,[je.HOOK_CALLBACK_NAME]:u.name?.length>0?u.name:er}),_.call(this,d,u))}function f(d,u={}){return function(...p){const h=this[yt],[E]=p;if(h.isEnabled()===!1)return d.call(this,...p);const T=E[za]??D.context.active(),S=h.tracer.startSpan(`handler - ${d.name?.length>0?d.name:this.pluginName??er}`,{attributes:u},T);return D.context.with(D.trace.setSpan(T,S),function(){try{const m=d.call(this,...p);return typeof m?.then=="function"?m.then(g=>(S.end(),g),g=>(S.setStatus({code:D.SpanStatusCode.ERROR,message:g.message}),S.recordException(g),S.end(),Promise.reject(g))):(S.end(),m)}catch(m){throw S.setStatus({code:D.SpanStatusCode.ERROR,message:m.message}),S.recordException(m),S.end(),m}},this)}}}}}var Dr;(function(e){const t="fastify.name";e.FASTIFY_NAME=t;const n="fastify.type";e.FASTIFY_TYPE=n;const r="hook.name";e.HOOK_NAME=r;const s="plugin.name";e.PLUGIN_NAME=s})(Dr||(Dr={}));var kl;(function(e){const t="middleware";e.MIDDLEWARE=t;const n="request_handler";e.REQUEST_HANDLER=n})(kl||(kl={}));var xl;(function(e){const t="middleware";e.MIDDLEWARE=t;const n="request handler";e.REQUEST_HANDLER=n})(xl||(xl={}));const Bl=Symbol("opentelemetry.instrumentation.fastify.request_active_span");function MN(e,t,n,r={}){const s=t.startSpan(n,{attributes:r}),i=e[Bl]||[];return i.push(s),Object.defineProperty(e,Bl,{enumerable:!1,configurable:!0,value:i}),s}function Kf(e,t){const n=e[Bl]||[];n.length&&(n.forEach(r=>{t&&(r.setStatus({code:D.SpanStatusCode.ERROR,message:t.message}),r.recordException(t)),r.end()}),delete e[Bl])}function FK(e,t,n){let r,s;try{s=e(),wN(s)&&s.then(i=>t(void 0,i),i=>t(i))}catch(i){r=i}finally{if(!wN(s)&&(t(r,s),r))throw r;return s}}function wN(e){return typeof e=="object"&&e&&typeof Object.getOwnPropertyDescriptor(e,"then")?.value=="function"||!1}const jK="0.1.0",qK="@sentry/instrumentation-fastify-v3",LN="anonymous",YK=new Set(["onTimeout","onRequest","preParsing","preValidation","preSerialization","preHandler","onSend","onResponse","onError"]);class WK extends Ut{constructor(t={}){super(qK,jK,t)}init(){return[new St("fastify",[">=3.0.0 <4"],t=>this._patchConstructor(t))]}_hookOnRequest(){const t=this;return function(r,s,i){if(!t.isEnabled())return i();t._wrap(s,"send",t._patchSend());const o=r,c=od(D.context.active()),a=o.routeOptions?o.routeOptions.url:r.routerPath;a&&c?.type===Ys.HTTP&&(c.route=a);const l=r.method||"GET";tt().setTransactionName(`${l} ${a}`),i()}}_wrapHandler(t,n,r,s){const i=this;return this._diag.debug("Patching fastify route.handler function"),function(...o){if(!i.isEnabled())return r.apply(this,o);const c=r.name||t||LN,a=`${xl.MIDDLEWARE} - ${c}`,l=o[1],f=MN(l,i.tracer,a,{[Dr.FASTIFY_TYPE]:kl.MIDDLEWARE,[Dr.PLUGIN_NAME]:t,[Dr.HOOK_NAME]:n}),d=s&&o[o.length-1];return d&&(o[o.length-1]=function(...u){Kf(l),d.apply(this,u)}),D.context.with(D.trace.setSpan(D.context.active(),f),()=>FK(()=>r.apply(this,o),u=>{u instanceof Error&&(f.setStatus({code:D.SpanStatusCode.ERROR,message:u.message}),f.recordException(u)),s||Kf(l)}))}}_wrapAddHook(){const t=this;return this._diag.debug("Patching fastify server.addHook function"),function(n){return function(...s){const i=s[0],o=s[1],c=this.pluginName;if(!YK.has(i))return n.apply(this,s);const a=typeof s[s.length-1]=="function"&&o.constructor.name!=="AsyncFunction";return n.apply(this,[i,t._wrapHandler(c,i,o,a)])}}}_patchConstructor(t){const n=this;function r(...s){const i=t.fastify.apply(this,s);return i.addHook("onRequest",n._hookOnRequest()),i.addHook("preHandler",n._hookPreHandler()),KK(),n._wrap(i,"addHook",n._wrapAddHook()),i}return t.errorCodes!==void 0&&(r.errorCodes=t.errorCodes),r.fastify=r,r.default=r,r}_patchSend(){const t=this;return this._diag.debug("Patching fastify reply.send function"),function(r){return function(...i){const o=i[0];return t.isEnabled()?Vr(()=>r.apply(this,i),c=>{!c&&o instanceof Error&&(c=o),Kf(this,c)}):r.apply(this,i)}}}_hookPreHandler(){const t=this;return this._diag.debug("Patching fastify preHandler function"),function(r,s,i){if(!t.isEnabled())return i();const o=r,c=o.routeOptions?.handler||o.context?.handler,a=c?.name.startsWith("bound ")?c.name.substring(6):c?.name,l=`${xl.REQUEST_HANDLER} - ${a||this.pluginName||LN}`,f={[Dr.PLUGIN_NAME]:this.pluginName,[Dr.FASTIFY_TYPE]:kl.REQUEST_HANDLER,[ne.SEMATTRS_HTTP_ROUTE]:o.routeOptions?o.routeOptions.url:r.routerPath};a&&(f[Dr.FASTIFY_NAME]=a);const d=MN(s,t.tracer,l,f);hL(d);const{requestHook:u}=t.getConfig();return u&&Vr(()=>u(d,{request:r}),_=>{_&&t._diag.error("request hook failed",_)},!0),D.context.with(D.trace.setSpan(D.context.active(),d),()=>{i()})}}}function KK(){const e=ye();e&&e.on("spanStart",t=>{hL(t)})}function hL(e){const t=ve(e).data,n=t["fastify.type"];if(t[Re]||!n)return;e.setAttributes({[He]:"auto.http.otel.fastify",[Re]:`${n}.fastify`});const r=t["fastify.name"]||t["plugin.name"]||t["hook.name"];if(typeof r=="string"){const s=r.replace(/^fastify -> /,"").replace(/^@fastify\/otel -> /,"");e.updateName(s)}}const Ld="Fastify",zK=Pe(`${Ld}.v3`,()=>new WK);function ZK(){const e=ye();if(e)return e.getIntegrationByName(Ld)}function DN(e,t,n,r){const s=ZK()?.getShouldHandleError()||EL;if(r==="diagnostics-channel"&&(this.diagnosticsChannelExists=!0),this.diagnosticsChannelExists&&r==="onError-hook"){Js&&Y.warn("Fastify error handler was already registered via diagnostics channel.","You can safely remove `setupFastifyErrorHandler` call and set `shouldHandleError` on the integration options.");return}s(e,t,n)&&Ye(e,{mechanism:{handled:!1,type:"auto.function.fastify"}})}const XK=Pe(`${Ld}.v5`,()=>{const e=new HK,t=e.plugin();return ll.subscribe("fastify.initialization",n=>{const r=n.fastify;r?.register(t).after(s=>{s?Js&&Y.error("Failed to setup Fastify instrumentation",s):(ez(),r&&tz(r))})}),ll.subscribe("tracing:fastify.request.handler:error",n=>{const{error:r,request:s,reply:i}=n;DN.call(DN,r,s,i,"diagnostics-channel")}),e}),QK=(({shouldHandleError:e})=>{let t;return{name:Ld,setupOnce(){t=e||EL,zK(),XK()},getShouldHandleError(){return t},setShouldHandleError(n){t=n}}}),JK=(e={})=>QK(e);function EL(e,t,n){const r=n.statusCode;return r>=500||r<=299}function TL(e){const t=ve(e),n=t.description,r=t.data,s=r["fastify.type"],i=s==="hook",o=s===n?.startsWith("handler -"),c=n==="request"||s==="request-handler";if(r[Re]||!o&&!c&&!i)return;const a=i?"hook":o?"middleware":c?"request-handler":"<unknown>";e.setAttributes({[He]:"auto.http.otel.fastify",[Re]:`${a}.fastify`});const l=r["fastify.name"]||r["plugin.name"]||r["hook.name"];if(typeof l=="string"){const f=l.replace(/^fastify -> /,"").replace(/^@fastify\/otel -> /,"");e.updateName(f)}}function ez(){const e=ye();e&&e.on("spanStart",t=>{TL(t)})}function tz(e){e.addHook("onRequest",async(t,n)=>{if(t.opentelemetry){const{span:i}=t.opentelemetry();i&&TL(i)}const r=t.routeOptions?.url,s=t.method||"GET";tt().setTransactionName(`${s} ${r}`)})}var zf={},Za={},Zf={},UN;function SL(){return UN||(UN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpanNames=e.TokenKind=e.AllowedOperationTypes=void 0,(function(t){t.QUERY="query",t.MUTATION="mutation",t.SUBSCRIPTION="subscription"})(e.AllowedOperationTypes||(e.AllowedOperationTypes={})),(function(t){t.SOF="<SOF>",t.EOF="<EOF>",t.BANG="!",t.DOLLAR="$",t.AMP="&",t.PAREN_L="(",t.PAREN_R=")",t.SPREAD="...",t.COLON=":",t.EQUALS="=",t.AT="@",t.BRACKET_L="[",t.BRACKET_R="]",t.BRACE_L="{",t.PIPE="|",t.BRACE_R="}",t.NAME="Name",t.INT="Int",t.FLOAT="Float",t.STRING="String",t.BLOCK_STRING="BlockString",t.COMMENT="Comment"})(e.TokenKind||(e.TokenKind={})),(function(t){t.EXECUTE="graphql.execute",t.PARSE="graphql.parse",t.RESOLVE="graphql.resolve",t.VALIDATE="graphql.validate",t.SCHEMA_VALIDATE="graphql.validateSchema",t.SCHEMA_PARSE="graphql.parseSchema"})(e.SpanNames||(e.SpanNames={}))})(Zf)),Zf}var Xf={},kN;function mL(){return kN||(kN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,(function(t){t.SOURCE="graphql.source",t.FIELD_NAME="graphql.field.name",t.FIELD_PATH="graphql.field.path",t.FIELD_TYPE="graphql.field.type",t.OPERATION_TYPE="graphql.operation.type",t.OPERATION_NAME="graphql.operation.name",t.VARIABLES="graphql.variables.",t.ERROR_VALIDATION_NAME="graphql.validation.error"})(e.AttributeNames||(e.AttributeNames={}))})(Xf)),Xf}var fs={},xN;function qT(){return xN||(xN=1,Object.defineProperty(fs,"__esModule",{value:!0}),fs.OTEL_GRAPHQL_DATA_SYMBOL=fs.OTEL_PATCHED_SYMBOL=void 0,fs.OTEL_PATCHED_SYMBOL=Symbol.for("opentelemetry.patched"),fs.OTEL_GRAPHQL_DATA_SYMBOL=Symbol.for("opentelemetry.graphql_data")),fs}var Xa={},BN;function nz(){return BN||(BN=1,Object.defineProperty(Xa,"__esModule",{value:!0}),Xa.OPERATION_NOT_SUPPORTED=void 0,qT(),Xa.OPERATION_NOT_SUPPORTED="Operation$operationName$not supported"),Xa}var Qf={},GN;function rz(){return GN||(GN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.wrapFieldResolver=e.wrapFields=e.getSourceFromLocation=e.getOperation=e.endSpan=e.addSpanSource=e.addInputVariableAttributes=e.isPromise=void 0;const t=Ue(),n=SL(),r=mL(),s=qT(),i=Object.values(n.AllowedOperationTypes),o=v=>typeof v?.then=="function";e.isPromise=o;const c=v=>typeof v=="object"&&v!==null;function a(v,L,H){Array.isArray(H)?H.forEach((te,ce)=>{a(v,`${L}.${ce}`,te)}):H instanceof Object?Object.entries(H).forEach(([te,ce])=>{a(v,`${L}.${te}`,ce)}):v.setAttribute(`${r.AttributeNames.VARIABLES}${String(L)}`,H)}function l(v,L){Object.entries(L).forEach(([H,te])=>{a(v,H,te)})}e.addInputVariableAttributes=l;function f(v,L,H,te,ce){const ee=O(L,H,te,ce);v.setAttribute(r.AttributeNames.SOURCE,ee)}e.addSpanSource=f;function d(v,L,H,te,ce){let ee=E(H,ce);if(ee)return{field:ee,spanAdded:!1};const B=L().flatResolveSpans?S(H):T(H,ce);return ee={span:u(v,L,H,te,ce,B)},h(H,ce,ee),{field:ee,spanAdded:!0}}function u(v,L,H,te,ce,ee){const x={[r.AttributeNames.FIELD_NAME]:te.fieldName,[r.AttributeNames.FIELD_PATH]:ce.join("."),[r.AttributeNames.FIELD_TYPE]:te.returnType.toString()},B=v.startSpan(`${n.SpanNames.RESOLVE} ${x[r.AttributeNames.FIELD_PATH]}`,{attributes:x},ee?t.trace.setSpan(t.context.active(),ee):void 0),j=H[s.OTEL_GRAPHQL_DATA_SYMBOL].source,q=te.fieldNodes.find(z=>z.kind==="Field");return q&&f(B,j.loc,L().allowValues,q.loc?.start,q.loc?.end),B}function _(v,L){L&&v.recordException(L),v.end()}e.endSpan=_;function p(v,L){if(!(!v||!Array.isArray(v.definitions)))return L?v.definitions.filter(H=>i.indexOf(H?.operation)!==-1).find(H=>L===H?.name?.value):v.definitions.find(H=>i.indexOf(H?.operation)!==-1)}e.getOperation=p;function h(v,L,H){return v[s.OTEL_GRAPHQL_DATA_SYMBOL].fields[L.join(".")]=H}function E(v,L){return v[s.OTEL_GRAPHQL_DATA_SYMBOL].fields[L.join(".")]}function T(v,L){for(let H=L.length-1;H>0;H--){const te=E(v,L.slice(0,H));if(te)return te.span}return S(v)}function S(v){return v[s.OTEL_GRAPHQL_DATA_SYMBOL].span}function m(v,L){const H=[];let te=L;for(;te;){let ce=te.key;v&&typeof ce=="number"&&(ce="*"),H.push(String(ce)),te=te.prev}return H.reverse()}function g(v){return A(`
`,v)}function y(v){return A(" ",v)}function A(v,L){let H="";for(let te=0;te<L;te++)H+=v;return H}const N=[n.TokenKind.FLOAT,n.TokenKind.STRING,n.TokenKind.INT,n.TokenKind.BLOCK_STRING];function O(v,L=!1,H,te){let ce="";if(v?.startToken){const ee=typeof H=="number"?H:v.start,x=typeof te=="number"?te:v.end;let B=v.startToken.next,j=1;for(;B;){if(B.start<ee){B=B.next,j=B?.line;continue}if(B.end>x){B=B.next,j=B?.line;continue}let q=B.value||B.kind,z="";!L&&N.indexOf(B.kind)>=0&&(q="*"),B.kind===n.TokenKind.STRING&&(q=`"${q}"`),B.kind===n.TokenKind.EOF&&(q=""),B.line>j?(ce+=g(B.line-j),j=B.line,z=y(B.column-1)):B.line===B.prev?.line&&(z=y(B.start-(B.prev?.end||0))),ce+=z+q,B&&(B=B.next)}}return ce}e.getSourceFromLocation=O;function b(v,L,H){if(!v||v[s.OTEL_PATCHED_SYMBOL])return;const te=v.getFields();v[s.OTEL_PATCHED_SYMBOL]=!0,Object.keys(te).forEach(ce=>{const ee=te[ce];if(ee&&(ee.resolve&&(ee.resolve=F(L,H,ee.resolve)),ee.type)){const x=C(ee.type);for(const B of x)b(B,L,H)}})}e.wrapFields=b;function C(v){return"ofType"in v?C(v.ofType):w(v)?v.getTypes():k(v)?[v]:[]}function w(v){return"getTypes"in v&&typeof v.getTypes=="function"}function k(v){return"getFields"in v&&typeof v.getFields=="function"}const U=(v,L,H)=>{H&&(v.recordException(L),v.setStatus({code:t.SpanStatusCode.ERROR,message:L.message}),v.end())},M=(v,L)=>{L&&v.end()};function F(v,L,H,te=!1){if(ce[s.OTEL_PATCHED_SYMBOL]||typeof H!="function")return H;function ce(ee,x,B,j){if(!H)return;const q=L();if(q.ignoreTrivialResolveSpans&&te&&(c(ee)||typeof ee=="function")&&typeof ee[j.fieldName]!="function")return H.call(this,ee,x,B,j);if(!B[s.OTEL_GRAPHQL_DATA_SYMBOL])return H.call(this,ee,x,B,j);const z=m(q.mergeItems,j&&j.path),J=z.filter(X=>typeof X=="string").length;let G,V=!1;if(q.depth>=0&&q.depth<J)G=T(B,z);else{const{field:X,spanAdded:K}=d(v,L,B,j,z);G=X.span,V=K}return t.context.with(t.trace.setSpan(t.context.active(),G),()=>{try{const X=H.call(this,ee,x,B,j);return(0,e.isPromise)(X)?X.then(K=>(M(G,V),K),K=>{throw U(G,K,V),K}):(M(G,V),X)}catch(X){throw U(G,X,V),X}})}return ce[s.OTEL_PATCHED_SYMBOL]=!0,ce}e.wrapFieldResolver=F})(Qf)),Qf}var _s={},VN;function sz(){return VN||(VN=1,Object.defineProperty(_s,"__esModule",{value:!0}),_s.PACKAGE_NAME=_s.PACKAGE_VERSION=void 0,_s.PACKAGE_VERSION="0.56.0",_s.PACKAGE_NAME="@opentelemetry/instrumentation-graphql"),_s}var $N;function iz(){if($N)return Za;$N=1,Object.defineProperty(Za,"__esModule",{value:!0}),Za.GraphQLInstrumentation=void 0;const e=Ue(),t=Be,n=SL(),r=mL(),s=qT(),i=nz(),o=rz(),c=sz(),a={mergeItems:!1,depth:-1,allowValues:!1,ignoreResolveSpans:!1},l=[">=14.0.0 <17"];class f extends t.InstrumentationBase{constructor(u={}){super(c.PACKAGE_NAME,c.PACKAGE_VERSION,{...a,...u})}setConfig(u={}){super.setConfig({...a,...u})}init(){const u=new t.InstrumentationNodeModuleDefinition("graphql",l);return u.files.push(this._addPatchingExecute()),u.files.push(this._addPatchingParser()),u.files.push(this._addPatchingValidate()),u}_addPatchingExecute(){return new t.InstrumentationNodeModuleFile("graphql/execution/execute.js",l,u=>((0,t.isWrapped)(u.execute)&&this._unwrap(u,"execute"),this._wrap(u,"execute",this._patchExecute(u.defaultFieldResolver)),u),u=>{u&&this._unwrap(u,"execute")})}_addPatchingParser(){return new t.InstrumentationNodeModuleFile("graphql/language/parser.js",l,u=>((0,t.isWrapped)(u.parse)&&this._unwrap(u,"parse"),this._wrap(u,"parse",this._patchParse()),u),u=>{u&&this._unwrap(u,"parse")})}_addPatchingValidate(){return new t.InstrumentationNodeModuleFile("graphql/validation/validate.js",l,u=>((0,t.isWrapped)(u.validate)&&this._unwrap(u,"validate"),this._wrap(u,"validate",this._patchValidate()),u),u=>{u&&this._unwrap(u,"validate")})}_patchExecute(u){const _=this;return function(h){return function(){let T;if(arguments.length>=2){const g=arguments;T=_._wrapExecuteArgs(g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],u)}else{const g=arguments[0];T=_._wrapExecuteArgs(g.schema,g.document,g.rootValue,g.contextValue,g.variableValues,g.operationName,g.fieldResolver,g.typeResolver,u)}const S=(0,o.getOperation)(T.document,T.operationName),m=_._createExecuteSpan(S,T);return T.contextValue[s.OTEL_GRAPHQL_DATA_SYMBOL]={source:T.document?T.document||T.document[s.OTEL_GRAPHQL_DATA_SYMBOL]:void 0,span:m,fields:{}},e.context.with(e.trace.setSpan(e.context.active(),m),()=>(0,t.safeExecuteInTheMiddle)(()=>h.apply(this,[T]),(g,y)=>{_._handleExecutionResult(m,g,y)}))}}}_handleExecutionResult(u,_,p){const h=this.getConfig();if(p===void 0||_){(0,o.endSpan)(u,_);return}if((0,o.isPromise)(p))p.then(E=>{if(typeof h.responseHook!="function"){(0,o.endSpan)(u);return}this._executeResponseHook(u,E)},E=>{(0,o.endSpan)(u,E)});else{if(typeof h.responseHook!="function"){(0,o.endSpan)(u);return}this._executeResponseHook(u,p)}}_executeResponseHook(u,_){const{responseHook:p}=this.getConfig();p&&(0,t.safeExecuteInTheMiddle)(()=>{p(u,_)},h=>{h&&this._diag.error("Error running response hook",h),(0,o.endSpan)(u,void 0)},!0)}_patchParse(){const u=this;return function(p){return function(E,T){return u._parse(this,p,E,T)}}}_patchValidate(){const u=this;return function(p){return function(E,T,S,m,g){return u._validate(this,p,E,T,S,g,m)}}}_parse(u,_,p,h){const E=this.getConfig(),T=this.tracer.startSpan(n.SpanNames.PARSE);return e.context.with(e.trace.setSpan(e.context.active(),T),()=>(0,t.safeExecuteInTheMiddle)(()=>_.call(u,p,h),(S,m)=>{m&&((0,o.getOperation)(m)?m.loc&&(0,o.addSpanSource)(T,m.loc,E.allowValues):T.updateName(n.SpanNames.SCHEMA_PARSE)),(0,o.endSpan)(T,S)}))}_validate(u,_,p,h,E,T,S){const m=this.tracer.startSpan(n.SpanNames.VALIDATE,{});return e.context.with(e.trace.setSpan(e.context.active(),m),()=>(0,t.safeExecuteInTheMiddle)(()=>_.call(u,p,h,E,S,T),(g,y)=>{h.loc||m.updateName(n.SpanNames.SCHEMA_VALIDATE),y&&y.length&&m.recordException({name:r.AttributeNames.ERROR_VALIDATION_NAME,message:JSON.stringify(y)}),(0,o.endSpan)(m,g)}))}_createExecuteSpan(u,_){const p=this.getConfig(),h=this.tracer.startSpan(n.SpanNames.EXECUTE,{});if(u){const{operation:E,name:T}=u;h.setAttribute(r.AttributeNames.OPERATION_TYPE,E);const S=T?.value;S?(h.setAttribute(r.AttributeNames.OPERATION_NAME,S),h.updateName(`${E} ${S}`)):h.updateName(E)}else{let E=" ";_.operationName&&(E=` "${_.operationName}" `),E=i.OPERATION_NOT_SUPPORTED.replace("$operationName$",E),h.setAttribute(r.AttributeNames.OPERATION_NAME,E)}return _.document?.loc&&(0,o.addSpanSource)(h,_.document.loc,p.allowValues),_.variableValues&&p.allowValues&&(0,o.addInputVariableAttributes)(h,_.variableValues),h}_wrapExecuteArgs(u,_,p,h,E,T,S,m,g){if(h||(h={}),h[s.OTEL_GRAPHQL_DATA_SYMBOL]||this.getConfig().ignoreResolveSpans)return{schema:u,document:_,rootValue:p,contextValue:h,variableValues:E,operationName:T,fieldResolver:S,typeResolver:m};const y=S==null,A=S??g;return S=(0,o.wrapFieldResolver)(this.tracer,()=>this.getConfig(),A,y),u&&((0,o.wrapFields)(u.getQueryType(),this.tracer,()=>this.getConfig()),(0,o.wrapFields)(u.getMutationType(),this.tracer,()=>this.getConfig())),{schema:u,document:_,rootValue:p,contextValue:h,variableValues:E,operationName:T,fieldResolver:S,typeResolver:m}}}return Za.GraphQLInstrumentation=f,Za}var HN;function oz(){return HN||(HN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.GraphQLInstrumentation=void 0;var t=iz();Object.defineProperty(e,"GraphQLInstrumentation",{enumerable:!0,get:function(){return t.GraphQLInstrumentation}})})(zf)),zf}var az=oz();const gL="Graphql",cz=Pe(gL,az.GraphQLInstrumentation,e=>{const t=AL(e);return{...t,responseHook(n,r){Dt(n,"auto.graphql.otel.graphql"),r.errors?.length&&!ve(n).status&&n.setStatus({code:D.SpanStatusCode.ERROR});const i=ve(n).data,o=i["graphql.operation.type"],c=i["graphql.operation.name"];if(t.useOperationNameForRootSpan&&o){const a=rn(n),f=ve(a).data[Lc]||[],d=c?`${o} ${c}`:`${o}`;Array.isArray(f)?(f.push(d),a.setAttribute(Lc,f)):typeof f=="string"?a.setAttribute(Lc,[f,d]):a.setAttribute(Lc,d),ve(a).data["original-description"]||a.setAttribute("original-description",ve(a).description),a.updateName(`${ve(a).data["original-description"]} (${dz(f)})`)}}}}),uz=((e={})=>({name:gL,setupOnce(){cz(AL(e))}})),lz=uz;function AL(e){return{ignoreResolveSpans:!0,ignoreTrivialResolveSpans:!0,useOperationNameForRootSpan:!0,...e}}function dz(e){if(Array.isArray(e)){const t=e.slice().sort();return t.length<=5?t.join(", "):`${t.slice(0,5).join(", ")}, +${t.length-5}`}return`${e}`}var Jf={},Qa={},Ja={},FN;function fz(){return FN||(FN=1,Object.defineProperty(Ja,"__esModule",{value:!0}),Ja.EVENT_LISTENERS_SET=void 0,Ja.EVENT_LISTENERS_SET=Symbol("opentelemetry.instrumentation.kafkajs.eventListenersSet")),Ja}var ec={},jN;function _z(){return jN||(jN=1,Object.defineProperty(ec,"__esModule",{value:!0}),ec.bufferTextMapGetter=void 0,ec.bufferTextMapGetter={get(e,t){if(!e)return;const n=Object.keys(e);for(const r of n)if(r===t||r.toLowerCase()===t)return e[r]?.toString()},keys(e){return e?Object.keys(e):[]}}),ec}var Ne={},qN;function pz(){return qN||(qN=1,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.METRIC_MESSAGING_PROCESS_DURATION=Ne.METRIC_MESSAGING_CLIENT_SENT_MESSAGES=Ne.METRIC_MESSAGING_CLIENT_OPERATION_DURATION=Ne.METRIC_MESSAGING_CLIENT_CONSUMED_MESSAGES=Ne.MESSAGING_SYSTEM_VALUE_KAFKA=Ne.MESSAGING_OPERATION_TYPE_VALUE_SEND=Ne.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE=Ne.MESSAGING_OPERATION_TYPE_VALUE_PROCESS=Ne.ATTR_MESSAGING_SYSTEM=Ne.ATTR_MESSAGING_OPERATION_TYPE=Ne.ATTR_MESSAGING_OPERATION_NAME=Ne.ATTR_MESSAGING_KAFKA_OFFSET=Ne.ATTR_MESSAGING_KAFKA_MESSAGE_TOMBSTONE=Ne.ATTR_MESSAGING_KAFKA_MESSAGE_KEY=Ne.ATTR_MESSAGING_DESTINATION_PARTITION_ID=Ne.ATTR_MESSAGING_DESTINATION_NAME=Ne.ATTR_MESSAGING_BATCH_MESSAGE_COUNT=void 0,Ne.ATTR_MESSAGING_BATCH_MESSAGE_COUNT="messaging.batch.message_count",Ne.ATTR_MESSAGING_DESTINATION_NAME="messaging.destination.name",Ne.ATTR_MESSAGING_DESTINATION_PARTITION_ID="messaging.destination.partition.id",Ne.ATTR_MESSAGING_KAFKA_MESSAGE_KEY="messaging.kafka.message.key",Ne.ATTR_MESSAGING_KAFKA_MESSAGE_TOMBSTONE="messaging.kafka.message.tombstone",Ne.ATTR_MESSAGING_KAFKA_OFFSET="messaging.kafka.offset",Ne.ATTR_MESSAGING_OPERATION_NAME="messaging.operation.name",Ne.ATTR_MESSAGING_OPERATION_TYPE="messaging.operation.type",Ne.ATTR_MESSAGING_SYSTEM="messaging.system",Ne.MESSAGING_OPERATION_TYPE_VALUE_PROCESS="process",Ne.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE="receive",Ne.MESSAGING_OPERATION_TYPE_VALUE_SEND="send",Ne.MESSAGING_SYSTEM_VALUE_KAFKA="kafka",Ne.METRIC_MESSAGING_CLIENT_CONSUMED_MESSAGES="messaging.client.consumed.messages",Ne.METRIC_MESSAGING_CLIENT_OPERATION_DURATION="messaging.client.operation.duration",Ne.METRIC_MESSAGING_CLIENT_SENT_MESSAGES="messaging.client.sent.messages",Ne.METRIC_MESSAGING_PROCESS_DURATION="messaging.process.duration"),Ne}var ps={},YN;function hz(){return YN||(YN=1,Object.defineProperty(ps,"__esModule",{value:!0}),ps.PACKAGE_NAME=ps.PACKAGE_VERSION=void 0,ps.PACKAGE_VERSION="0.18.0",ps.PACKAGE_NAME="@opentelemetry/instrumentation-kafkajs"),ps}var WN;function Ez(){if(WN)return Qa;WN=1,Object.defineProperty(Qa,"__esModule",{value:!0}),Qa.KafkaJsInstrumentation=void 0;const e=Ue(),t=Be,n=gt(),r=fz(),s=_z(),i=pz(),o=hz();function c(d,u,_){return p=>{d.add(u,{..._,...p?{[n.ATTR_ERROR_TYPE]:p}:{}})}}function a(d,u,_){return p=>{d.record((Date.now()-u)/1e3,{..._,...p?{[n.ATTR_ERROR_TYPE]:p}:{}})}}const l=[.005,.01,.025,.05,.075,.1,.25,.5,.75,1,2.5,5,7.5,10];class f extends t.InstrumentationBase{constructor(u={}){super(o.PACKAGE_NAME,o.PACKAGE_VERSION,u)}_updateMetricInstruments(){this._clientDuration=this.meter.createHistogram(i.METRIC_MESSAGING_CLIENT_OPERATION_DURATION,{advice:{explicitBucketBoundaries:l}}),this._sentMessages=this.meter.createCounter(i.METRIC_MESSAGING_CLIENT_SENT_MESSAGES),this._consumedMessages=this.meter.createCounter(i.METRIC_MESSAGING_CLIENT_CONSUMED_MESSAGES),this._processDuration=this.meter.createHistogram(i.METRIC_MESSAGING_PROCESS_DURATION,{advice:{explicitBucketBoundaries:l}})}init(){const u=p=>{(0,t.isWrapped)(p?.Kafka?.prototype.producer)&&this._unwrap(p.Kafka.prototype,"producer"),(0,t.isWrapped)(p?.Kafka?.prototype.consumer)&&this._unwrap(p.Kafka.prototype,"consumer")};return new t.InstrumentationNodeModuleDefinition("kafkajs",[">=0.3.0 <3"],p=>(u(p),this._wrap(p?.Kafka?.prototype,"producer",this._getProducerPatch()),this._wrap(p?.Kafka?.prototype,"consumer",this._getConsumerPatch()),p),u)}_getConsumerPatch(){const u=this;return _=>function(...h){const E=_.apply(this,h);return(0,t.isWrapped)(E.run)&&u._unwrap(E,"run"),u._wrap(E,"run",u._getConsumerRunPatch()),u._setKafkaEventListeners(E),E}}_setKafkaEventListeners(u){u[r.EVENT_LISTENERS_SET]||(u.events?.REQUEST&&u.on(u.events.REQUEST,this._recordClientDurationMetric.bind(this)),u[r.EVENT_LISTENERS_SET]=!0)}_recordClientDurationMetric(u){const[_,p]=u.payload.broker.split(":");this._clientDuration.record(u.payload.duration/1e3,{[i.ATTR_MESSAGING_SYSTEM]:i.MESSAGING_SYSTEM_VALUE_KAFKA,[i.ATTR_MESSAGING_OPERATION_NAME]:`${u.payload.apiName}`,[n.ATTR_SERVER_ADDRESS]:_,[n.ATTR_SERVER_PORT]:Number.parseInt(p,10)})}_getProducerPatch(){const u=this;return _=>function(...h){const E=_.apply(this,h);return(0,t.isWrapped)(E.sendBatch)&&u._unwrap(E,"sendBatch"),u._wrap(E,"sendBatch",u._getSendBatchPatch()),(0,t.isWrapped)(E.send)&&u._unwrap(E,"send"),u._wrap(E,"send",u._getSendPatch()),(0,t.isWrapped)(E.transaction)&&u._unwrap(E,"transaction"),u._wrap(E,"transaction",u._getProducerTransactionPatch()),u._setKafkaEventListeners(E),E}}_getConsumerRunPatch(){const u=this;return _=>function(...h){const E=h[0];return E?.eachMessage&&((0,t.isWrapped)(E.eachMessage)&&u._unwrap(E,"eachMessage"),u._wrap(E,"eachMessage",u._getConsumerEachMessagePatch())),E?.eachBatch&&((0,t.isWrapped)(E.eachBatch)&&u._unwrap(E,"eachBatch"),u._wrap(E,"eachBatch",u._getConsumerEachBatchPatch())),_.call(this,E)}}_getConsumerEachMessagePatch(){const u=this;return _=>function(...h){const E=h[0],T=e.propagation.extract(e.ROOT_CONTEXT,E.message.headers,s.bufferTextMapGetter),S=u._startConsumerSpan({topic:E.topic,message:E.message,operationType:i.MESSAGING_OPERATION_TYPE_VALUE_PROCESS,ctx:T,attributes:{[i.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(E.partition)}}),m=[a(u._processDuration,Date.now(),{[i.ATTR_MESSAGING_SYSTEM]:i.MESSAGING_SYSTEM_VALUE_KAFKA,[i.ATTR_MESSAGING_OPERATION_NAME]:"process",[i.ATTR_MESSAGING_DESTINATION_NAME]:E.topic,[i.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(E.partition)}),c(u._consumedMessages,1,{[i.ATTR_MESSAGING_SYSTEM]:i.MESSAGING_SYSTEM_VALUE_KAFKA,[i.ATTR_MESSAGING_OPERATION_NAME]:"process",[i.ATTR_MESSAGING_DESTINATION_NAME]:E.topic,[i.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(E.partition)})],g=e.context.with(e.trace.setSpan(T,S),()=>_.apply(this,h));return u._endSpansOnPromise([S],m,g)}}_getConsumerEachBatchPatch(){return u=>{const _=this;return function(...h){const E=h[0],T=_._startConsumerSpan({topic:E.batch.topic,message:void 0,operationType:i.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE,ctx:e.ROOT_CONTEXT,attributes:{[i.ATTR_MESSAGING_BATCH_MESSAGE_COUNT]:E.batch.messages.length,[i.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(E.batch.partition)}});return e.context.with(e.trace.setSpan(e.context.active(),T),()=>{const S=Date.now(),m=[],g=[c(_._consumedMessages,E.batch.messages.length,{[i.ATTR_MESSAGING_SYSTEM]:i.MESSAGING_SYSTEM_VALUE_KAFKA,[i.ATTR_MESSAGING_OPERATION_NAME]:"process",[i.ATTR_MESSAGING_DESTINATION_NAME]:E.batch.topic,[i.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(E.batch.partition)})];E.batch.messages.forEach(A=>{const N=e.propagation.extract(e.ROOT_CONTEXT,A.headers,s.bufferTextMapGetter),O=e.trace.getSpan(N)?.spanContext();let b;O&&(b={context:O}),m.push(_._startConsumerSpan({topic:E.batch.topic,message:A,operationType:i.MESSAGING_OPERATION_TYPE_VALUE_PROCESS,link:b,attributes:{[i.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(E.batch.partition)}})),g.push(a(_._processDuration,S,{[i.ATTR_MESSAGING_SYSTEM]:i.MESSAGING_SYSTEM_VALUE_KAFKA,[i.ATTR_MESSAGING_OPERATION_NAME]:"process",[i.ATTR_MESSAGING_DESTINATION_NAME]:E.batch.topic,[i.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(E.batch.partition)}))});const y=u.apply(this,h);return m.unshift(T),_._endSpansOnPromise(m,g,y)})}}}_getProducerTransactionPatch(){const u=this;return _=>function(...h){const E=u.tracer.startSpan("transaction"),T=_.apply(this,h);return T.then(S=>{const m=S.send;S.send=function(...O){return e.context.with(e.trace.setSpan(e.context.active(),E),()=>u._getSendPatch()(m).apply(this,O).catch(C=>{throw E.setStatus({code:e.SpanStatusCode.ERROR,message:C?.message}),E.recordException(C),C}))};const g=S.sendBatch;S.sendBatch=function(...O){return e.context.with(e.trace.setSpan(e.context.active(),E),()=>u._getSendBatchPatch()(g).apply(this,O).catch(C=>{throw E.setStatus({code:e.SpanStatusCode.ERROR,message:C?.message}),E.recordException(C),C}))};const y=S.commit;S.commit=function(...O){const b=y.apply(this,O).then(()=>{E.setStatus({code:e.SpanStatusCode.OK})});return u._endSpansOnPromise([E],[],b)};const A=S.abort;S.abort=function(...O){const b=A.apply(this,O);return u._endSpansOnPromise([E],[],b)}}).catch(S=>{E.setStatus({code:e.SpanStatusCode.ERROR,message:S?.message}),E.recordException(S),E.end()}),T}}_getSendBatchPatch(){const u=this;return _=>function(...h){const T=h[0].topicMessages||[],S=[],m=[];T.forEach(y=>{y.messages.forEach(A=>{S.push(u._startProducerSpan(y.topic,A)),m.push(c(u._sentMessages,1,{[i.ATTR_MESSAGING_SYSTEM]:i.MESSAGING_SYSTEM_VALUE_KAFKA,[i.ATTR_MESSAGING_OPERATION_NAME]:"send",[i.ATTR_MESSAGING_DESTINATION_NAME]:y.topic,...A.partition!==void 0?{[i.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(A.partition)}:{}}))})});const g=_.apply(this,h);return u._endSpansOnPromise(S,m,g)}}_getSendPatch(){const u=this;return _=>function(...h){const E=h[0],T=E.messages.map(g=>u._startProducerSpan(E.topic,g)),S=E.messages.map(g=>c(u._sentMessages,1,{[i.ATTR_MESSAGING_SYSTEM]:i.MESSAGING_SYSTEM_VALUE_KAFKA,[i.ATTR_MESSAGING_OPERATION_NAME]:"send",[i.ATTR_MESSAGING_DESTINATION_NAME]:E.topic,...g.partition!==void 0?{[i.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:String(g.partition)}:{}})),m=_.apply(this,h);return u._endSpansOnPromise(T,S,m)}}_endSpansOnPromise(u,_,p){return Promise.resolve(p).then(h=>(_.forEach(E=>E()),h)).catch(h=>{let E,T=n.ERROR_TYPE_VALUE_OTHER;throw typeof h=="string"||h===void 0?E=h:typeof h=="object"&&Object.prototype.hasOwnProperty.call(h,"message")&&(E=h.message,T=h.constructor.name),_.forEach(S=>S(T)),u.forEach(S=>{S.setAttribute(n.ATTR_ERROR_TYPE,T),S.setStatus({code:e.SpanStatusCode.ERROR,message:E})}),h}).finally(()=>{u.forEach(h=>h.end())})}_startConsumerSpan({topic:u,message:_,operationType:p,ctx:h,link:E,attributes:T}){const S=p===i.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE?"poll":p,m=this.tracer.startSpan(`${S} ${u}`,{kind:p===i.MESSAGING_OPERATION_TYPE_VALUE_RECEIVE?e.SpanKind.CLIENT:e.SpanKind.CONSUMER,attributes:{...T,[i.ATTR_MESSAGING_SYSTEM]:i.MESSAGING_SYSTEM_VALUE_KAFKA,[i.ATTR_MESSAGING_DESTINATION_NAME]:u,[i.ATTR_MESSAGING_OPERATION_TYPE]:p,[i.ATTR_MESSAGING_OPERATION_NAME]:S,[i.ATTR_MESSAGING_KAFKA_MESSAGE_KEY]:_?.key?String(_.key):void 0,[i.ATTR_MESSAGING_KAFKA_MESSAGE_TOMBSTONE]:_?.key&&_.value===null?!0:void 0,[i.ATTR_MESSAGING_KAFKA_OFFSET]:_?.offset},links:E?[E]:[]},h),{consumerHook:g}=this.getConfig();return g&&_&&(0,t.safeExecuteInTheMiddle)(()=>g(m,{topic:u,message:_}),y=>{y&&this._diag.error("consumerHook error",y)},!0),m}_startProducerSpan(u,_){const p=this.tracer.startSpan(`send ${u}`,{kind:e.SpanKind.PRODUCER,attributes:{[i.ATTR_MESSAGING_SYSTEM]:i.MESSAGING_SYSTEM_VALUE_KAFKA,[i.ATTR_MESSAGING_DESTINATION_NAME]:u,[i.ATTR_MESSAGING_KAFKA_MESSAGE_KEY]:_.key?String(_.key):void 0,[i.ATTR_MESSAGING_KAFKA_MESSAGE_TOMBSTONE]:_.key&&_.value===null?!0:void 0,[i.ATTR_MESSAGING_DESTINATION_PARTITION_ID]:_.partition!==void 0?String(_.partition):void 0,[i.ATTR_MESSAGING_OPERATION_NAME]:"send",[i.ATTR_MESSAGING_OPERATION_TYPE]:i.MESSAGING_OPERATION_TYPE_VALUE_SEND}});_.headers=_.headers??{},e.propagation.inject(e.trace.setSpan(e.context.active(),p),_.headers);const{producerHook:h}=this.getConfig();return h&&(0,t.safeExecuteInTheMiddle)(()=>h(p,{topic:u,message:_}),E=>{E&&this._diag.error("producerHook error",E)},!0),p}}return Qa.KafkaJsInstrumentation=f,Qa}var KN;function Tz(){return KN||(KN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.KafkaJsInstrumentation=void 0;var t=Ez();Object.defineProperty(e,"KafkaJsInstrumentation",{enumerable:!0,get:function(){return t.KafkaJsInstrumentation}})})(Jf)),Jf}var Sz=Tz();const RL="Kafka",mz=Pe(RL,()=>new Sz.KafkaJsInstrumentation({consumerHook(e){Dt(e,"auto.kafkajs.otel.consumer")},producerHook(e){Dt(e,"auto.kafkajs.otel.producer")}})),gz=(()=>({name:RL,setupOnce(){mz()}})),Az=gz;var e_={},tc={},hs={},zN;function Rz(){return zN||(zN=1,Object.defineProperty(hs,"__esModule",{value:!0}),hs.PACKAGE_NAME=hs.PACKAGE_VERSION=void 0,hs.PACKAGE_VERSION="0.53.0",hs.PACKAGE_NAME="@opentelemetry/instrumentation-lru-memoizer"),hs}var ZN;function yz(){if(ZN)return tc;ZN=1,Object.defineProperty(tc,"__esModule",{value:!0}),tc.LruMemoizerInstrumentation=void 0;const e=Ue(),t=Be,n=Rz();class r extends t.InstrumentationBase{constructor(i={}){super(n.PACKAGE_NAME,n.PACKAGE_VERSION,i)}init(){return[new t.InstrumentationNodeModuleDefinition("lru-memoizer",[">=1.3 <3"],i=>{const o=function(){const c=i.apply(this,arguments);return function(){const a=[...arguments],l=a.pop(),f=typeof l=="function"?e.context.bind(e.context.active(),l):l;return a.push(f),c.apply(this,a)}};return o.sync=i.sync,o},void 0)]}}return tc.LruMemoizerInstrumentation=r,tc}var XN;function Nz(){return XN||(XN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.LruMemoizerInstrumentation=void 0;var t=yz();Object.defineProperty(e,"LruMemoizerInstrumentation",{enumerable:!0,get:function(){return t.LruMemoizerInstrumentation}})})(e_)),e_}var Oz=Nz();const yL="LruMemoizer",bz=Pe(yL,()=>new Oz.LruMemoizerInstrumentation),Iz=(()=>({name:yL,setupOnce(){bz()}})),Cz=Iz;var t_={},nc={},ze={},QN;function vz(){return QN||(QN=1,Object.defineProperty(ze,"__esModule",{value:!0}),ze.METRIC_DB_CLIENT_CONNECTIONS_USAGE=ze.DB_SYSTEM_VALUE_MONGODB=ze.ATTR_NET_PEER_PORT=ze.ATTR_NET_PEER_NAME=ze.ATTR_DB_SYSTEM=ze.ATTR_DB_STATEMENT=ze.ATTR_DB_OPERATION=ze.ATTR_DB_NAME=ze.ATTR_DB_MONGODB_COLLECTION=ze.ATTR_DB_CONNECTION_STRING=void 0,ze.ATTR_DB_CONNECTION_STRING="db.connection_string",ze.ATTR_DB_MONGODB_COLLECTION="db.mongodb.collection",ze.ATTR_DB_NAME="db.name",ze.ATTR_DB_OPERATION="db.operation",ze.ATTR_DB_STATEMENT="db.statement",ze.ATTR_DB_SYSTEM="db.system",ze.ATTR_NET_PEER_NAME="net.peer.name",ze.ATTR_NET_PEER_PORT="net.peer.port",ze.DB_SYSTEM_VALUE_MONGODB="mongodb",ze.METRIC_DB_CLIENT_CONNECTIONS_USAGE="db.client.connections.usage"),ze}var n_={},JN;function Pz(){return JN||(JN=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MongodbCommandType=void 0,(function(t){t.CREATE_INDEXES="createIndexes",t.FIND_AND_MODIFY="findAndModify",t.IS_MASTER="isMaster",t.COUNT="count",t.AGGREGATE="aggregate",t.UNKNOWN="unknown"})(e.MongodbCommandType||(e.MongodbCommandType={}))})(n_)),n_}var Es={},eO;function Mz(){return eO||(eO=1,Object.defineProperty(Es,"__esModule",{value:!0}),Es.PACKAGE_NAME=Es.PACKAGE_VERSION=void 0,Es.PACKAGE_VERSION="0.61.0",Es.PACKAGE_NAME="@opentelemetry/instrumentation-mongodb"),Es}var tO;function wz(){if(tO)return nc;tO=1,Object.defineProperty(nc,"__esModule",{value:!0}),nc.MongoDBInstrumentation=void 0;const e=Ue(),t=Be,n=vz(),r=Pz(),s=Mz(),i={requireParentSpan:!0};class o extends t.InstrumentationBase{constructor(a={}){super(s.PACKAGE_NAME,s.PACKAGE_VERSION,{...i,...a})}setConfig(a={}){super.setConfig({...i,...a})}_updateMetricInstruments(){this._connectionsUsage=this.meter.createUpDownCounter(n.METRIC_DB_CLIENT_CONNECTIONS_USAGE,{description:"The number of connections that are currently in state described by the state attribute.",unit:"{connection}"})}init(){const{v3PatchConnection:a,v3UnpatchConnection:l}=this._getV3ConnectionPatches(),{v4PatchConnect:f,v4UnpatchConnect:d}=this._getV4ConnectPatches(),{v4PatchConnectionCallback:u,v4PatchConnectionPromise:_,v4UnpatchConnection:p}=this._getV4ConnectionPatches(),{v4PatchConnectionPool:h,v4UnpatchConnectionPool:E}=this._getV4ConnectionPoolPatches(),{v4PatchSessions:T,v4UnpatchSessions:S}=this._getV4SessionsPatches();return[new t.InstrumentationNodeModuleDefinition("mongodb",[">=3.3.0 <4"],void 0,void 0,[new t.InstrumentationNodeModuleFile("mongodb/lib/core/wireprotocol/index.js",[">=3.3.0 <4"],a,l)]),new t.InstrumentationNodeModuleDefinition("mongodb",[">=4.0.0 <7"],void 0,void 0,[new t.InstrumentationNodeModuleFile("mongodb/lib/cmap/connection.js",[">=4.0.0 <6.4"],u,p),new t.InstrumentationNodeModuleFile("mongodb/lib/cmap/connection.js",[">=6.4.0 <7"],_,p),new t.InstrumentationNodeModuleFile("mongodb/lib/cmap/connection_pool.js",[">=4.0.0 <6.4"],h,E),new t.InstrumentationNodeModuleFile("mongodb/lib/cmap/connect.js",[">=4.0.0 <7"],f,d),new t.InstrumentationNodeModuleFile("mongodb/lib/sessions.js",[">=4.0.0 <7"],T,S)])]}_getV3ConnectionPatches(){return{v3PatchConnection:a=>((0,t.isWrapped)(a.insert)&&this._unwrap(a,"insert"),this._wrap(a,"insert",this._getV3PatchOperation("insert")),(0,t.isWrapped)(a.remove)&&this._unwrap(a,"remove"),this._wrap(a,"remove",this._getV3PatchOperation("remove")),(0,t.isWrapped)(a.update)&&this._unwrap(a,"update"),this._wrap(a,"update",this._getV3PatchOperation("update")),(0,t.isWrapped)(a.command)&&this._unwrap(a,"command"),this._wrap(a,"command",this._getV3PatchCommand()),(0,t.isWrapped)(a.query)&&this._unwrap(a,"query"),this._wrap(a,"query",this._getV3PatchFind()),(0,t.isWrapped)(a.getMore)&&this._unwrap(a,"getMore"),this._wrap(a,"getMore",this._getV3PatchCursor()),a),v3UnpatchConnection:a=>{a!==void 0&&(this._unwrap(a,"insert"),this._unwrap(a,"remove"),this._unwrap(a,"update"),this._unwrap(a,"command"),this._unwrap(a,"query"),this._unwrap(a,"getMore"))}}}_getV4SessionsPatches(){return{v4PatchSessions:a=>((0,t.isWrapped)(a.acquire)&&this._unwrap(a,"acquire"),this._wrap(a.ServerSessionPool.prototype,"acquire",this._getV4AcquireCommand()),(0,t.isWrapped)(a.release)&&this._unwrap(a,"release"),this._wrap(a.ServerSessionPool.prototype,"release",this._getV4ReleaseCommand()),a),v4UnpatchSessions:a=>{a!==void 0&&((0,t.isWrapped)(a.acquire)&&this._unwrap(a,"acquire"),(0,t.isWrapped)(a.release)&&this._unwrap(a,"release"))}}}_getV4AcquireCommand(){const a=this;return l=>function(){const d=this.sessions.length,u=l.call(this),_=this.sessions.length;return d===_?a._connectionsUsage.add(1,{state:"used","pool.name":a._poolName}):d-1===_&&(a._connectionsUsage.add(-1,{state:"idle","pool.name":a._poolName}),a._connectionsUsage.add(1,{state:"used","pool.name":a._poolName})),u}}_getV4ReleaseCommand(){const a=this;return l=>function(d){const u=l.call(this,d);return a._connectionsUsage.add(-1,{state:"used","pool.name":a._poolName}),a._connectionsUsage.add(1,{state:"idle","pool.name":a._poolName}),u}}_getV4ConnectionPoolPatches(){return{v4PatchConnectionPool:a=>{const l=a.ConnectionPool.prototype;return(0,t.isWrapped)(l.checkOut)&&this._unwrap(l,"checkOut"),this._wrap(l,"checkOut",this._getV4ConnectionPoolCheckOut()),a},v4UnpatchConnectionPool:a=>{a!==void 0&&this._unwrap(a.ConnectionPool.prototype,"checkOut")}}}_getV4ConnectPatches(){return{v4PatchConnect:a=>((0,t.isWrapped)(a.connect)&&this._unwrap(a,"connect"),this._wrap(a,"connect",this._getV4ConnectCommand()),a),v4UnpatchConnect:a=>{a!==void 0&&this._unwrap(a,"connect")}}}_getV4ConnectionPoolCheckOut(){return a=>function(f){const d=e.context.bind(e.context.active(),f);return a.call(this,d)}}_getV4ConnectCommand(){const a=this;return l=>function(d,u){if(l.length===1){const p=l.call(this,d);return p&&typeof p.then=="function"&&p.then(()=>a.setPoolName(d),()=>{}),p}const _=function(p,h){if(p||!h){u(p,h);return}a.setPoolName(d),u(p,h)};return l.call(this,d,_)}}_getV4ConnectionPatches(){return{v4PatchConnectionCallback:a=>((0,t.isWrapped)(a.Connection.prototype.command)&&this._unwrap(a.Connection.prototype,"command"),this._wrap(a.Connection.prototype,"command",this._getV4PatchCommandCallback()),a),v4PatchConnectionPromise:a=>((0,t.isWrapped)(a.Connection.prototype.command)&&this._unwrap(a.Connection.prototype,"command"),this._wrap(a.Connection.prototype,"command",this._getV4PatchCommandPromise()),a),v4UnpatchConnection:a=>{a!==void 0&&this._unwrap(a.Connection.prototype,"command")}}}_getV3PatchOperation(a){const l=this;return f=>function(u,_,p,h,E){const T=e.trace.getSpan(e.context.active()),S=l._checkSkipInstrumentation(T),m=typeof h=="function"?h:E;if(S||typeof m!="function"||typeof p!="object")return typeof h=="function"?f.call(this,u,_,p,h):f.call(this,u,_,p,h,E);const g=l.tracer.startSpan(`mongodb.${a}`,{kind:e.SpanKind.CLIENT});l._populateV3Attributes(g,_,u,p[0],a);const y=l._patchEnd(g,m);return typeof h=="function"?f.call(this,u,_,p,y):f.call(this,u,_,p,h,y)}}_getV3PatchCommand(){const a=this;return l=>function(d,u,_,p,h){const E=e.trace.getSpan(e.context.active()),T=a._checkSkipInstrumentation(E),S=typeof p=="function"?p:h;if(T||typeof S!="function"||typeof _!="object")return typeof p=="function"?l.call(this,d,u,_,p):l.call(this,d,u,_,p,h);const m=o._getCommandType(_),g=m===r.MongodbCommandType.UNKNOWN?"command":m,y=a.tracer.startSpan(`mongodb.${g}`,{kind:e.SpanKind.CLIENT}),A=m===r.MongodbCommandType.UNKNOWN?void 0:m;a._populateV3Attributes(y,u,d,_,A);const N=a._patchEnd(y,S);return typeof p=="function"?l.call(this,d,u,_,N):l.call(this,d,u,_,p,N)}}_getV4PatchCommandCallback(){const a=this;return l=>function(d,u,_,p){const h=e.trace.getSpan(e.context.active()),E=a._checkSkipInstrumentation(h),T=p,S=Object.keys(u)[0];if(typeof u!="object"||u.ismaster||u.hello)return l.call(this,d,u,_,p);let m;E||(m=a.tracer.startSpan(`mongodb.${S}`,{kind:e.SpanKind.CLIENT}),a._populateV4Attributes(m,this,d,u,S));const g=a._patchEnd(m,T,this.id,S);return l.call(this,d,u,_,g)}}_getV4PatchCommandPromise(){const a=this;return l=>function(...d){const[u,_]=d,p=e.trace.getSpan(e.context.active()),h=a._checkSkipInstrumentation(p),E=Object.keys(_)[0],T=()=>{};if(typeof _!="object"||_.ismaster||_.hello)return l.apply(this,d);let S;h||(S=a.tracer.startSpan(`mongodb.${E}`,{kind:e.SpanKind.CLIENT}),a._populateV4Attributes(S,this,u,_,E));const m=a._patchEnd(S,T,this.id,E),g=l.apply(this,d);return g.then(y=>m(null,y),y=>m(y)),g}}_getV3PatchFind(){const a=this;return l=>function(d,u,_,p,h,E){const T=e.trace.getSpan(e.context.active()),S=a._checkSkipInstrumentation(T),m=typeof h=="function"?h:E;if(S||typeof m!="function"||typeof _!="object")return typeof h=="function"?l.call(this,d,u,_,p,h):l.call(this,d,u,_,p,h,E);const g=a.tracer.startSpan("mongodb.find",{kind:e.SpanKind.CLIENT});a._populateV3Attributes(g,u,d,_,"find");const y=a._patchEnd(g,m);return typeof h=="function"?l.call(this,d,u,_,p,y):l.call(this,d,u,_,p,h,y)}}_getV3PatchCursor(){const a=this;return l=>function(d,u,_,p,h,E){const T=e.trace.getSpan(e.context.active()),S=a._checkSkipInstrumentation(T),m=typeof h=="function"?h:E;if(S||typeof m!="function")return typeof h=="function"?l.call(this,d,u,_,p,h):l.call(this,d,u,_,p,h,E);const g=a.tracer.startSpan("mongodb.getMore",{kind:e.SpanKind.CLIENT});a._populateV3Attributes(g,u,d,_.cmd,"getMore");const y=a._patchEnd(g,m);return typeof h=="function"?l.call(this,d,u,_,p,y):l.call(this,d,u,_,p,h,y)}}static _getCommandType(a){return a.createIndexes!==void 0?r.MongodbCommandType.CREATE_INDEXES:a.findandmodify!==void 0?r.MongodbCommandType.FIND_AND_MODIFY:a.ismaster!==void 0?r.MongodbCommandType.IS_MASTER:a.count!==void 0?r.MongodbCommandType.COUNT:a.aggregate!==void 0?r.MongodbCommandType.AGGREGATE:r.MongodbCommandType.UNKNOWN}_populateV4Attributes(a,l,f,d,u){let _,p;if(l){const E=typeof l.address=="string"?l.address.split(":"):"";E.length===2&&(_=E[0],p=E[1])}let h;d?.documents&&d.documents[0]?h=d.documents[0]:d?.cursors?h=d.cursors:h=d,this._addAllSpanAttributes(a,f.db,f.collection,_,p,h,u)}_populateV3Attributes(a,l,f,d,u){let _,p;if(f&&f.s&&(_=f.s.options?.host??f.s.host,p=(f.s.options?.port??f.s.port)?.toString(),_==null||p==null)){const S=f.description?.address;if(S){const m=S.split(":");_=m[0],p=m[1]}}const[h,E]=l.toString().split("."),T=d?.query??d?.q??d;this._addAllSpanAttributes(a,h,E,_,p,T,u)}_addAllSpanAttributes(a,l,f,d,u,_,p){if(a.setAttributes({[n.ATTR_DB_SYSTEM]:n.DB_SYSTEM_VALUE_MONGODB,[n.ATTR_DB_NAME]:l,[n.ATTR_DB_MONGODB_COLLECTION]:f,[n.ATTR_DB_OPERATION]:p,[n.ATTR_DB_CONNECTION_STRING]:`mongodb://${d}:${u}/${l}`}),d&&u){a.setAttribute(n.ATTR_NET_PEER_NAME,d);const T=parseInt(u,10);isNaN(T)||a.setAttribute(n.ATTR_NET_PEER_PORT,T)}if(!_)return;const{dbStatementSerializer:h}=this.getConfig(),E=typeof h=="function"?h:this._defaultDbStatementSerializer.bind(this);(0,t.safeExecuteInTheMiddle)(()=>{const T=E(_);a.setAttribute(n.ATTR_DB_STATEMENT,T)},T=>{T&&this._diag.error("Error running dbStatementSerializer hook",T)},!0)}_getDefaultDbStatementReplacer(){const a=new WeakSet;return(l,f)=>typeof f!="object"||!f?"?":a.has(f)?"[Circular]":(a.add(f),f)}_defaultDbStatementSerializer(a){const{enhancedDatabaseReporting:l}=this.getConfig();return l?JSON.stringify(a):JSON.stringify(a,this._getDefaultDbStatementReplacer())}_handleExecutionResult(a,l){const{responseHook:f}=this.getConfig();typeof f=="function"&&(0,t.safeExecuteInTheMiddle)(()=>{f(a,{data:l})},d=>{d&&this._diag.error("Error running response hook",d)},!0)}_patchEnd(a,l,f,d){const u=e.context.active(),_=this;return function(...h){const E=h[0];if(a){if(E instanceof Error)a?.setStatus({code:e.SpanStatusCode.ERROR,message:E.message});else{const T=h[1];_._handleExecutionResult(a,T)}a.end()}return e.context.with(u,()=>(d==="endSessions"&&_._connectionsUsage.add(-1,{state:"idle","pool.name":_._poolName}),l.apply(this,h)))}}setPoolName(a){const l=a.hostAddress?.host,f=a.hostAddress?.port,d=a.dbName,u=`mongodb://${l}:${f}/${d}`;this._poolName=u}_checkSkipInstrumentation(a){return this.getConfig().requireParentSpan===!0&&a===void 0}}return nc.MongoDBInstrumentation=o,nc}var r_={},nO;function Lz(){return nO||(nO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MongodbCommandType=void 0,(function(t){t.CREATE_INDEXES="createIndexes",t.FIND_AND_MODIFY="findAndModify",t.IS_MASTER="isMaster",t.COUNT="count",t.UNKNOWN="unknown"})(e.MongodbCommandType||(e.MongodbCommandType={}))})(r_)),r_}var rO;function Dz(){return rO||(rO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MongodbCommandType=e.MongoDBInstrumentation=void 0;var t=wz();Object.defineProperty(e,"MongoDBInstrumentation",{enumerable:!0,get:function(){return t.MongoDBInstrumentation}});var n=Lz();Object.defineProperty(e,"MongodbCommandType",{enumerable:!0,get:function(){return n.MongodbCommandType}})})(t_)),t_}var Uz=Dz();const NL="Mongo",kz=Pe(NL,()=>new Uz.MongoDBInstrumentation({dbStatementSerializer:xz,responseHook(e){Dt(e,"auto.db.otel.mongo")}}));function xz(e){const t=AE(e);return JSON.stringify(t)}function AE(e){if(Array.isArray(e))return e.map(t=>AE(t));if(Bz(e)){const t={};return Object.entries(e).map(([n,r])=>[n,AE(r)]).reduce((n,r)=>(Vz(r)&&(n[r[0]]=r[1]),n),t)}return"?"}function Bz(e){return typeof e=="object"&&e!==null&&!Gz(e)}function Gz(e){let t=!1;return typeof Buffer<"u"&&(t=Buffer.isBuffer(e)),t}function Vz(e){return Array.isArray(e)}const $z=(()=>({name:NL,setupOnce(){kz()}})),Hz=$z;var s_={},i_={},tr={},ut={},sO;function OL(){return sO||(sO=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.ATTR_NET_PEER_PORT=ut.ATTR_NET_PEER_NAME=ut.ATTR_DB_USER=ut.ATTR_DB_SYSTEM=ut.ATTR_DB_STATEMENT=ut.ATTR_DB_OPERATION=ut.ATTR_DB_NAME=ut.ATTR_DB_MONGODB_COLLECTION=void 0,ut.ATTR_DB_MONGODB_COLLECTION="db.mongodb.collection",ut.ATTR_DB_NAME="db.name",ut.ATTR_DB_OPERATION="db.operation",ut.ATTR_DB_STATEMENT="db.statement",ut.ATTR_DB_SYSTEM="db.system",ut.ATTR_DB_USER="db.user",ut.ATTR_NET_PEER_NAME="net.peer.name",ut.ATTR_NET_PEER_PORT="net.peer.port"),ut}var iO;function Fz(){if(iO)return tr;iO=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.handleCallbackResponse=tr.handlePromiseResponse=tr.getAttributesFromCollection=void 0;const e=Ue(),t=Be,n=OL();function r(a){return{[n.ATTR_DB_MONGODB_COLLECTION]:a.name,[n.ATTR_DB_NAME]:a.conn.name,[n.ATTR_DB_USER]:a.conn.user,[n.ATTR_NET_PEER_NAME]:a.conn.host,[n.ATTR_NET_PEER_PORT]:a.conn.port}}tr.getAttributesFromCollection=r;function s(a,l={}){a.recordException(l),a.setStatus({code:e.SpanStatusCode.ERROR,message:`${l.message} ${l.code?`
Mongoose Error Code: ${l.code}`:""}`})}function i(a,l,f,d=void 0){f&&(0,t.safeExecuteInTheMiddle)(()=>f(a,{moduleVersion:d,response:l}),u=>{u&&e.diag.error("mongoose instrumentation: responseHook error",u)},!0)}function o(a,l,f,d=void 0){return a instanceof Promise?a.then(u=>(i(l,u,f,d),u)).catch(u=>{throw s(l,u),u}).finally(()=>l.end()):(i(l,a,f,d),l.end(),a)}tr.handlePromiseResponse=o;function c(a,l,f,d,u,_,p=void 0){let h=0;return u.length===2?h=1:u.length===3&&(h=2),u[h]=(E,T)=>(E?s(d,E):i(d,T,_,p),d.end(),a(E,T)),l.apply(f,u)}return tr.handleCallbackResponse=c,tr}var Ts={},oO;function jz(){return oO||(oO=1,Object.defineProperty(Ts,"__esModule",{value:!0}),Ts.PACKAGE_NAME=Ts.PACKAGE_VERSION=void 0,Ts.PACKAGE_VERSION="0.55.0",Ts.PACKAGE_NAME="@opentelemetry/instrumentation-mongoose"),Ts}var aO;function qz(){return aO||(aO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MongooseInstrumentation=e._STORED_PARENT_SPAN=void 0;const t=Ue(),n=Ln,r=Fz(),s=Be,i=jz(),o=OL(),c=["deleteOne","deleteMany","find","findOne","estimatedDocumentCount","countDocuments","distinct","where","$where","findOneAndUpdate","findOneAndDelete","findOneAndReplace"],a=["remove","count","findOneAndRemove",...c],l=["count","findOneAndRemove",...c],f=[...c];function d(p){return p?p.startsWith("6.")||p.startsWith("5.")?a:p.startsWith("7.")?l:f:c}function u(p){return p&&(p.startsWith("5.")||p.startsWith("6."))||!1}e._STORED_PARENT_SPAN=Symbol("stored-parent-span");class _ extends s.InstrumentationBase{constructor(h={}){super(i.PACKAGE_NAME,i.PACKAGE_VERSION,h)}init(){return new s.InstrumentationNodeModuleDefinition("mongoose",[">=5.9.7 <9"],this.patch.bind(this),this.unpatch.bind(this))}patch(h,E){const T=h[Symbol.toStringTag]==="Module"?h.default:h;return this._wrap(T.Model.prototype,"save",this.patchOnModelMethods("save",E)),T.Model.prototype.$save=T.Model.prototype.save,u(E)&&this._wrap(T.Model.prototype,"remove",this.patchOnModelMethods("remove",E)),this._wrap(T.Query.prototype,"exec",this.patchQueryExec(E)),this._wrap(T.Aggregate.prototype,"exec",this.patchAggregateExec(E)),d(E).forEach(m=>{this._wrap(T.Query.prototype,m,this.patchAndCaptureSpanContext(m))}),this._wrap(T.Model,"aggregate",this.patchModelAggregate()),this._wrap(T.Model,"insertMany",this.patchModelStatic("insertMany",E)),this._wrap(T.Model,"bulkWrite",this.patchModelStatic("bulkWrite",E)),T}unpatch(h,E){const T=h[Symbol.toStringTag]==="Module"?h.default:h,S=d(E);this._unwrap(T.Model.prototype,"save"),T.Model.prototype.$save=T.Model.prototype.save,u(E)&&this._unwrap(T.Model.prototype,"remove"),this._unwrap(T.Query.prototype,"exec"),this._unwrap(T.Aggregate.prototype,"exec"),S.forEach(m=>{this._unwrap(T.Query.prototype,m)}),this._unwrap(T.Model,"aggregate"),this._unwrap(T.Model,"insertMany"),this._unwrap(T.Model,"bulkWrite")}patchAggregateExec(h){const E=this;return T=>function(m){if(E.getConfig().requireParentSpan&&t.trace.getSpan(t.context.active())===void 0)return T.apply(this,arguments);const g=this[e._STORED_PARENT_SPAN],y={},{dbStatementSerializer:A}=E.getConfig();A&&(y[o.ATTR_DB_STATEMENT]=A("aggregate",{options:this.options,aggregatePipeline:this._pipeline}));const N=E._startSpan(this._model.collection,this._model?.modelName,"aggregate",y,g);return E._handleResponse(N,T,this,arguments,m,h)}}patchQueryExec(h){const E=this;return T=>function(m){if(E.getConfig().requireParentSpan&&t.trace.getSpan(t.context.active())===void 0)return T.apply(this,arguments);const g=this[e._STORED_PARENT_SPAN],y={},{dbStatementSerializer:A}=E.getConfig();A&&(y[o.ATTR_DB_STATEMENT]=A(this.op,{condition:this._conditions,updates:this._update,options:this.options,fields:this._fields}));const N=E._startSpan(this.mongooseCollection,this.model.modelName,this.op,y,g);return E._handleResponse(N,T,this,arguments,m,h)}}patchOnModelMethods(h,E){const T=this;return S=>function(g,y){if(T.getConfig().requireParentSpan&&t.trace.getSpan(t.context.active())===void 0)return S.apply(this,arguments);const A={document:this};g&&!(g instanceof Function)&&(A.options=g);const N={},{dbStatementSerializer:O}=T.getConfig();O&&(N[o.ATTR_DB_STATEMENT]=O(h,A));const b=T._startSpan(this.constructor.collection,this.constructor.modelName,h,N);return g instanceof Function&&(y=g,g=void 0),T._handleResponse(b,S,this,arguments,y,E)}}patchModelStatic(h,E){const T=this;return S=>function(g,y,A){if(T.getConfig().requireParentSpan&&t.trace.getSpan(t.context.active())===void 0)return S.apply(this,arguments);typeof y=="function"&&(A=y,y=void 0);const N={};switch(h){case"insertMany":N.documents=g;break;case"bulkWrite":N.operations=g;break;default:N.document=g;break}y!==void 0&&(N.options=y);const O={},{dbStatementSerializer:b}=T.getConfig();b&&(O[o.ATTR_DB_STATEMENT]=b(h,N));const C=T._startSpan(this.collection,this.modelName,h,O);return T._handleResponse(C,S,this,arguments,A,E)}}patchModelAggregate(){const h=this;return E=>function(){const S=t.trace.getSpan(t.context.active()),m=h._callOriginalFunction(()=>E.apply(this,arguments));return m&&(m[e._STORED_PARENT_SPAN]=S),m}}patchAndCaptureSpanContext(h){const E=this;return T=>function(){return this[e._STORED_PARENT_SPAN]=t.trace.getSpan(t.context.active()),E._callOriginalFunction(()=>T.apply(this,arguments))}}_startSpan(h,E,T,S,m){return this.tracer.startSpan(`mongoose.${E}.${T}`,{kind:t.SpanKind.CLIENT,attributes:{...S,...(0,r.getAttributesFromCollection)(h),[o.ATTR_DB_OPERATION]:T,[o.ATTR_DB_SYSTEM]:"mongoose"}},m?t.trace.setSpan(t.context.active(),m):void 0)}_handleResponse(h,E,T,S,m,g=void 0){const y=this;if(m instanceof Function)return y._callOriginalFunction(()=>(0,r.handleCallbackResponse)(m,E,T,h,S,y.getConfig().responseHook,g));{const A=y._callOriginalFunction(()=>E.apply(T,S));return(0,r.handlePromiseResponse)(A,h,y.getConfig().responseHook,g)}}_callOriginalFunction(h){return this.getConfig().suppressInternalInstrumentation?t.context.with((0,n.suppressTracing)(t.context.active()),h):h()}}e.MongooseInstrumentation=_})(i_)),i_}var cO;function Yz(){return cO||(cO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MongooseInstrumentation=void 0;var t=qz();Object.defineProperty(e,"MongooseInstrumentation",{enumerable:!0,get:function(){return t.MongooseInstrumentation}})})(s_)),s_}var Wz=Yz();const bL="Mongoose",Kz=Pe(bL,()=>new Wz.MongooseInstrumentation({responseHook(e){Dt(e,"auto.db.otel.mongoose")}})),zz=(()=>({name:bL,setupOnce(){Kz()}})),Zz=zz;var o_={},rc={},nt={},uO;function IL(){return uO||(uO=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.METRIC_DB_CLIENT_CONNECTIONS_USAGE=nt.DB_SYSTEM_VALUE_MYSQL=nt.ATTR_NET_PEER_PORT=nt.ATTR_NET_PEER_NAME=nt.ATTR_DB_USER=nt.ATTR_DB_SYSTEM=nt.ATTR_DB_STATEMENT=nt.ATTR_DB_NAME=nt.ATTR_DB_CONNECTION_STRING=void 0,nt.ATTR_DB_CONNECTION_STRING="db.connection_string",nt.ATTR_DB_NAME="db.name",nt.ATTR_DB_STATEMENT="db.statement",nt.ATTR_DB_SYSTEM="db.system",nt.ATTR_DB_USER="db.user",nt.ATTR_NET_PEER_NAME="net.peer.name",nt.ATTR_NET_PEER_PORT="net.peer.port",nt.DB_SYSTEM_VALUE_MYSQL="mysql",nt.METRIC_DB_CLIENT_CONNECTIONS_USAGE="db.client.connections.usage"),nt}var a_={},lO;function Xz(){return lO||(lO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,(function(t){t.MYSQL_VALUES="db.mysql.values"})(e.AttributeNames||(e.AttributeNames={}))})(a_)),a_}var Nt={},dO;function Qz(){if(dO)return Nt;dO=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.getPoolName=Nt.arrayStringifyHelper=Nt.getSpanName=Nt.getDbValues=Nt.getDbStatement=Nt.getConnectionAttributes=void 0;const e=IL();function t(l){const{host:f,port:d,database:u,user:_}=n(l),p=parseInt(d,10);return isNaN(p)?{[e.ATTR_NET_PEER_NAME]:f,[e.ATTR_DB_CONNECTION_STRING]:r(f,d,u),[e.ATTR_DB_NAME]:u,[e.ATTR_DB_USER]:_}:{[e.ATTR_NET_PEER_NAME]:f,[e.ATTR_NET_PEER_PORT]:p,[e.ATTR_DB_CONNECTION_STRING]:r(f,d,u),[e.ATTR_DB_NAME]:u,[e.ATTR_DB_USER]:_}}Nt.getConnectionAttributes=t;function n(l){const{host:f,port:d,database:u,user:_}=l&&l.connectionConfig||l||{};return{host:f,port:d,database:u,user:_}}function r(l,f,d){let u=`jdbc:mysql://${l||"localhost"}`;return typeof f=="number"&&(u+=`:${f}`),typeof d=="string"&&(u+=`/${d}`),u}function s(l){return typeof l=="string"?l:l.sql}Nt.getDbStatement=s;function i(l,f){return c(typeof l=="string"?f:f||l.values)}Nt.getDbValues=i;function o(l){const f=typeof l=="object"?l.sql:l,d=f?.indexOf(" ");return typeof d=="number"&&d!==-1?f?.substring(0,d):f}Nt.getSpanName=o;function c(l){return l?`[${l.toString()}]`:""}Nt.arrayStringifyHelper=c;function a(l){const f=l.config.connectionConfig;let d="";return d+=f.host?`host: '${f.host}', `:"",d+=f.port?`port: ${f.port}, `:"",d+=f.database?`database: '${f.database}', `:"",d+=f.user?`user: '${f.user}'`:"",f.user||(d=d.substring(0,d.length-2)),d.trim()}return Nt.getPoolName=a,Nt}var Ss={},fO;function Jz(){return fO||(fO=1,Object.defineProperty(Ss,"__esModule",{value:!0}),Ss.PACKAGE_NAME=Ss.PACKAGE_VERSION=void 0,Ss.PACKAGE_VERSION="0.54.0",Ss.PACKAGE_NAME="@opentelemetry/instrumentation-mysql"),Ss}var _O;function e4(){if(_O)return rc;_O=1,Object.defineProperty(rc,"__esModule",{value:!0}),rc.MySQLInstrumentation=void 0;const e=Ue(),t=Be,n=IL(),r=Xz(),s=Qz(),i=Jz();class o extends t.InstrumentationBase{static COMMON_ATTRIBUTES={[n.ATTR_DB_SYSTEM]:n.DB_SYSTEM_VALUE_MYSQL};constructor(a={}){super(i.PACKAGE_NAME,i.PACKAGE_VERSION,a)}_updateMetricInstruments(){this._connectionsUsage=this.meter.createUpDownCounter(n.METRIC_DB_CLIENT_CONNECTIONS_USAGE,{description:"The number of connections that are currently in state described by the state attribute.",unit:"{connection}"})}init(){return[new t.InstrumentationNodeModuleDefinition("mysql",[">=2.0.0 <3"],a=>((0,t.isWrapped)(a.createConnection)&&this._unwrap(a,"createConnection"),this._wrap(a,"createConnection",this._patchCreateConnection()),(0,t.isWrapped)(a.createPool)&&this._unwrap(a,"createPool"),this._wrap(a,"createPool",this._patchCreatePool()),(0,t.isWrapped)(a.createPoolCluster)&&this._unwrap(a,"createPoolCluster"),this._wrap(a,"createPoolCluster",this._patchCreatePoolCluster()),a),a=>{a!==void 0&&(this._unwrap(a,"createConnection"),this._unwrap(a,"createPool"),this._unwrap(a,"createPoolCluster"))})]}_patchCreateConnection(){return a=>{const l=this;return function(d){const u=a(...arguments);return l._wrap(u,"query",l._patchQuery(u)),u}}}_patchCreatePool(){return a=>{const l=this;return function(d){const u=a(...arguments);return l._wrap(u,"query",l._patchQuery(u)),l._wrap(u,"getConnection",l._patchGetConnection(u)),l._wrap(u,"end",l._patchPoolEnd(u)),l._setPoolcallbacks(u,l,""),u}}}_patchPoolEnd(a){return l=>{const f=this;return function(u){const _=a._allConnections.length,p=a._freeConnections.length,h=_-p,E=(0,s.getPoolName)(a);f._connectionsUsage.add(-h,{state:"used",name:E}),f._connectionsUsage.add(-p,{state:"idle",name:E}),l.apply(a,arguments)}}}_patchCreatePoolCluster(){return a=>{const l=this;return function(d){const u=a(...arguments);return l._wrap(u,"getConnection",l._patchGetConnection(u)),l._wrap(u,"add",l._patchAdd(u)),u}}}_patchAdd(a){return l=>{const f=this;return function(u,_){if(!f._enabled)return f._unwrap(a,"add"),l.apply(a,arguments);l.apply(a,arguments);const p=a._nodes;if(p){const h=typeof u=="object"?"CLUSTER::"+a._lastId:String(u),E=p[h].pool;f._setPoolcallbacks(E,f,u)}}}}_patchGetConnection(a){return l=>{const f=this;return function(u,_,p){if(!f._enabled)return f._unwrap(a,"getConnection"),l.apply(a,arguments);if(arguments.length===1&&typeof u=="function"){const h=f._getConnectionCallbackPatchFn(u);return l.call(a,h)}if(arguments.length===2&&typeof _=="function"){const h=f._getConnectionCallbackPatchFn(_);return l.call(a,u,h)}if(arguments.length===3&&typeof p=="function"){const h=f._getConnectionCallbackPatchFn(p);return l.call(a,u,_,h)}return l.apply(a,arguments)}}}_getConnectionCallbackPatchFn(a){const l=this,f=e.context.active();return function(d,u){u&&((0,t.isWrapped)(u.query)||l._wrap(u,"query",l._patchQuery(u))),typeof a=="function"&&e.context.with(f,a,this,d,u)}}_patchQuery(a){return l=>{const f=this;return function(d,u,_){if(!f._enabled)return f._unwrap(a,"query"),l.apply(a,arguments);const p=f.tracer.startSpan((0,s.getSpanName)(d),{kind:e.SpanKind.CLIENT,attributes:{...o.COMMON_ATTRIBUTES,...(0,s.getConnectionAttributes)(a.config)}});if(p.setAttribute(n.ATTR_DB_STATEMENT,(0,s.getDbStatement)(d)),f.getConfig().enhancedDatabaseReporting){let T;Array.isArray(u)?T=u:arguments[2]&&(T=[u]),p.setAttribute(r.AttributeNames.MYSQL_VALUES,(0,s.getDbValues)(d,T))}const h=Array.from(arguments).findIndex(T=>typeof T=="function"),E=e.context.active();if(h===-1){const T=e.context.with(e.trace.setSpan(e.context.active(),p),()=>l.apply(a,arguments));return e.context.bind(E,T),T.on("error",S=>p.setStatus({code:e.SpanStatusCode.ERROR,message:S.message})).on("end",()=>{p.end()})}else return f._wrap(arguments,h,f._patchCallbackQuery(p,E)),e.context.with(e.trace.setSpan(e.context.active(),p),()=>l.apply(a,arguments))}}}_patchCallbackQuery(a,l){return f=>function(d,u,_){return d&&a.setStatus({code:e.SpanStatusCode.ERROR,message:d.message}),a.end(),e.context.with(l,()=>f(...arguments))}}_setPoolcallbacks(a,l,f){const d=f||(0,s.getPoolName)(a);a.on("connection",u=>{l._connectionsUsage.add(1,{state:"idle",name:d})}),a.on("acquire",u=>{l._connectionsUsage.add(-1,{state:"idle",name:d}),l._connectionsUsage.add(1,{state:"used",name:d})}),a.on("release",u=>{l._connectionsUsage.add(-1,{state:"used",name:d}),l._connectionsUsage.add(1,{state:"idle",name:d})})}}return rc.MySQLInstrumentation=o,rc}var pO;function t4(){return pO||(pO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MySQLInstrumentation=void 0;var t=e4();Object.defineProperty(e,"MySQLInstrumentation",{enumerable:!0,get:function(){return t.MySQLInstrumentation}})})(o_)),o_}var n4=t4();const CL="Mysql",r4=Pe(CL,()=>new n4.MySQLInstrumentation({})),s4=(()=>({name:CL,setupOnce(){r4()}})),i4=s4;var c_={},sc={},lt={},hO;function vL(){return hO||(hO=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.DB_SYSTEM_VALUE_MYSQL=lt.ATTR_NET_PEER_PORT=lt.ATTR_NET_PEER_NAME=lt.ATTR_DB_USER=lt.ATTR_DB_SYSTEM=lt.ATTR_DB_STATEMENT=lt.ATTR_DB_NAME=lt.ATTR_DB_CONNECTION_STRING=void 0,lt.ATTR_DB_CONNECTION_STRING="db.connection_string",lt.ATTR_DB_NAME="db.name",lt.ATTR_DB_STATEMENT="db.statement",lt.ATTR_DB_SYSTEM="db.system",lt.ATTR_DB_USER="db.user",lt.ATTR_NET_PEER_NAME="net.peer.name",lt.ATTR_NET_PEER_PORT="net.peer.port",lt.DB_SYSTEM_VALUE_MYSQL="mysql"),lt}var ic={},EO;function PL(){if(EO)return ic;EO=1,Object.defineProperty(ic,"__esModule",{value:!0}),ic.addSqlCommenterComment=void 0;const e=Ue(),t=Ln;function n(i){const o=i.indexOf("--");if(o>=0)return!0;if(i.indexOf("/*")<0)return!1;const a=i.indexOf("*/");return o<a}function r(i){return encodeURIComponent(i).replace(/[!'()*]/g,o=>`%${o.charCodeAt(0).toString(16).toUpperCase()}`)}function s(i,o){if(typeof o!="string"||o.length===0||n(o))return o;const c=new t.W3CTraceContextPropagator,a={};c.inject(e.trace.setSpan(e.ROOT_CONTEXT,i),a,e.defaultTextMapSetter);const l=Object.keys(a).sort();if(l.length===0)return o;const f=l.map(d=>{const u=r(a[d]);return`${d}='${u}'`}).join(",");return`${o} /*${f}*/`}return ic.addSqlCommenterComment=s,ic}var Vt={},TO;function o4(){if(TO)return Vt;TO=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.getConnectionPrototypeToInstrument=Vt.once=Vt.getSpanName=Vt.getQueryText=Vt.getConnectionAttributes=void 0;const e=vL(),t=Be,n=gt();function r(u,_,p){const{host:h,port:E,database:T,user:S}=s(u),m={};_&t.SemconvStability.OLD&&(m[e.ATTR_DB_CONNECTION_STRING]=i(h,E,T),m[e.ATTR_DB_NAME]=T,m[e.ATTR_DB_USER]=S),_&t.SemconvStability.STABLE&&(m[n.ATTR_DB_NAMESPACE]=T);const g=parseInt(E,10);return p&t.SemconvStability.OLD&&(m[e.ATTR_NET_PEER_NAME]=h,isNaN(g)||(m[e.ATTR_NET_PEER_PORT]=g)),p&t.SemconvStability.STABLE&&(m[n.ATTR_SERVER_ADDRESS]=h,isNaN(g)||(m[n.ATTR_SERVER_PORT]=g)),m}Vt.getConnectionAttributes=r;function s(u){const{host:_,port:p,database:h,user:E}=u&&u.connectionConfig||u||{};return{host:_,port:p,database:h,user:E}}function i(u,_,p){let h=`jdbc:mysql://${u||"localhost"}`;return typeof _=="number"&&(h+=`:${_}`),typeof p=="string"&&(h+=`/${p}`),h}function o(u,_,p,h=!1,E=c){const[T,S]=typeof u=="string"?[u,p]:[u.sql,a(u)?p||u.values:p];try{return h?E(T):_&&S?_(T,S):T}catch{return"Could not determine the query due to an error in masking or formatting"}}Vt.getQueryText=o;function c(u){return u.replace(/\b\d+\b/g,"?").replace(/(["'])(?:(?=(\\?))\2.)*?\1/g,"?")}function a(u){return"values"in u}function l(u){const _=typeof u=="object"?u.sql:u,p=_?.indexOf(" ");return typeof p=="number"&&p!==-1?_?.substring(0,p):_}Vt.getSpanName=l;const f=u=>{let _=!1;return(...p)=>{if(!_)return _=!0,u(...p)}};Vt.once=f;function d(u){const _=u.prototype,p=Object.getPrototypeOf(_);return typeof p?.query=="function"&&typeof p?.execute=="function"?p:_}return Vt.getConnectionPrototypeToInstrument=d,Vt}var ms={},SO;function a4(){return SO||(SO=1,Object.defineProperty(ms,"__esModule",{value:!0}),ms.PACKAGE_NAME=ms.PACKAGE_VERSION=void 0,ms.PACKAGE_VERSION="0.55.0",ms.PACKAGE_NAME="@opentelemetry/instrumentation-mysql2"),ms}var mO;function c4(){if(mO)return sc;mO=1,Object.defineProperty(sc,"__esModule",{value:!0}),sc.MySQL2Instrumentation=void 0;const e=Ue(),t=Be,n=vL(),r=PL(),s=o4(),i=a4(),o=gt(),c=[">=1.4.2 <4"];class a extends t.InstrumentationBase{_netSemconvStability;_dbSemconvStability;constructor(f={}){super(i.PACKAGE_NAME,i.PACKAGE_VERSION,f),this._setSemconvStabilityFromEnv()}_setSemconvStabilityFromEnv(){this._netSemconvStability=(0,t.semconvStabilityFromStr)("http",process.env.OTEL_SEMCONV_STABILITY_OPT_IN),this._dbSemconvStability=(0,t.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}init(){let f;function d(p){!f&&p.format&&(f=p.format)}const u=p=>{(0,t.isWrapped)(p.query)&&this._unwrap(p,"query"),this._wrap(p,"query",this._patchQuery(f,!1)),(0,t.isWrapped)(p.execute)&&this._unwrap(p,"execute"),this._wrap(p,"execute",this._patchQuery(f,!0))},_=p=>{this._unwrap(p,"query"),this._unwrap(p,"execute")};return[new t.InstrumentationNodeModuleDefinition("mysql2",c,p=>(d(p),p),()=>{},[new t.InstrumentationNodeModuleFile("mysql2/promise.js",c,p=>(d(p),p),()=>{}),new t.InstrumentationNodeModuleFile("mysql2/lib/connection.js",c,p=>{const h=(0,s.getConnectionPrototypeToInstrument)(p);return u(h),p},p=>{if(p===void 0)return;const h=(0,s.getConnectionPrototypeToInstrument)(p);_(h)})])]}_patchQuery(f,d){return u=>{const _=this;return function(p,h,E){let T;Array.isArray(h)?T=h:arguments[2]&&(T=[h]);const{maskStatement:S,maskStatementHook:m,responseHook:g}=_.getConfig(),y=(0,s.getConnectionAttributes)(this.config,_._dbSemconvStability,_._netSemconvStability),A=(0,s.getQueryText)(p,f,T,S,m);_._dbSemconvStability&t.SemconvStability.OLD&&(y[n.ATTR_DB_SYSTEM]=n.DB_SYSTEM_VALUE_MYSQL,y[n.ATTR_DB_STATEMENT]=A),_._dbSemconvStability&t.SemconvStability.STABLE&&(y[o.ATTR_DB_SYSTEM_NAME]=o.DB_SYSTEM_NAME_VALUE_MYSQL,y[o.ATTR_DB_QUERY_TEXT]=A);const N=_.tracer.startSpan((0,s.getSpanName)(p),{kind:e.SpanKind.CLIENT,attributes:y});!d&&_.getConfig().addSqlCommenterCommentToQueries&&(arguments[0]=p=typeof p=="string"?(0,r.addSqlCommenterComment)(N,p):Object.assign(p,{sql:(0,r.addSqlCommenterComment)(N,p.sql)}));const O=(0,s.once)((b,C)=>{b?N.setStatus({code:e.SpanStatusCode.ERROR,message:b.message}):typeof g=="function"&&(0,t.safeExecuteInTheMiddle)(()=>{g(N,{queryResults:C})},w=>{w&&_._diag.warn("Failed executing responseHook",w)},!0),N.end()});if(arguments.length===1){typeof p.onResult=="function"&&_._wrap(p,"onResult",_._patchCallbackQuery(O));const b=u.apply(this,arguments);return b.once("error",C=>{O(C)}).once("result",C=>{O(void 0,C)}),b}return typeof arguments[1]=="function"?_._wrap(arguments,1,_._patchCallbackQuery(O)):typeof arguments[2]=="function"&&_._wrap(arguments,2,_._patchCallbackQuery(O)),u.apply(this,arguments)}}}_patchCallbackQuery(f){return d=>function(u,_,p){return f(u,_),d(...arguments)}}}return sc.MySQL2Instrumentation=a,sc}var gO;function u4(){return gO||(gO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.MySQL2Instrumentation=void 0;var t=c4();Object.defineProperty(e,"MySQL2Instrumentation",{enumerable:!0,get:function(){return t.MySQL2Instrumentation}})})(c_)),c_}var l4=u4();const ML="Mysql2",d4=Pe(ML,()=>new l4.MySQL2Instrumentation({responseHook(e){Dt(e,"auto.db.otel.mysql2")}})),f4=(()=>({name:ML,setupOnce(){d4()}})),_4=f4;var u_={},oc={},Ot={},AO;function p4(){return AO||(AO=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.DB_SYSTEM_VALUE_REDIS=Ot.ATTR_NET_PEER_PORT=Ot.ATTR_NET_PEER_NAME=Ot.ATTR_DB_SYSTEM=Ot.ATTR_DB_STATEMENT=Ot.ATTR_DB_CONNECTION_STRING=void 0,Ot.ATTR_DB_CONNECTION_STRING="db.connection_string",Ot.ATTR_DB_STATEMENT="db.statement",Ot.ATTR_DB_SYSTEM="db.system",Ot.ATTR_NET_PEER_NAME="net.peer.name",Ot.ATTR_NET_PEER_PORT="net.peer.port",Ot.DB_SYSTEM_VALUE_REDIS="redis"),Ot}var ac={},RO;function h4(){if(RO)return ac;RO=1,Object.defineProperty(ac,"__esModule",{value:!0}),ac.endSpan=void 0;const e=Ue(),t=(n,r)=>{r&&(n.recordException(r),n.setStatus({code:e.SpanStatusCode.ERROR,message:r.message})),n.end()};return ac.endSpan=t,ac}var cc={},yO;function YT(){if(yO)return cc;yO=1,Object.defineProperty(cc,"__esModule",{value:!0}),cc.defaultDbStatementSerializer=void 0;const e=[{regex:/^ECHO/i,args:0},{regex:/^(LPUSH|MSET|PFA|PUBLISH|RPUSH|SADD|SET|SPUBLISH|XADD|ZADD)/i,args:1},{regex:/^(HSET|HMSET|LSET|LINSERT)/i,args:2},{regex:/^(ACL|BIT|B[LRZ]|CLIENT|CLUSTER|CONFIG|COMMAND|DECR|DEL|EVAL|EX|FUNCTION|GEO|GET|HINCR|HMGET|HSCAN|INCR|L[TRLM]|MEMORY|P[EFISTU]|RPOP|S[CDIMORSU]|XACK|X[CDGILPRT]|Z[CDILMPRS])/i,args:-1}],t=(n,r)=>{if(Array.isArray(r)&&r.length){const s=e.find(({regex:o})=>o.test(n))?.args??0,i=s>=0?r.slice(0,s):r;return r.length>i.length&&i.push(`[${r.length-s} other arguments]`),`${n} ${i.join(" ")}`}return n};return cc.defaultDbStatementSerializer=t,cc}var gs={},NO;function E4(){return NO||(NO=1,Object.defineProperty(gs,"__esModule",{value:!0}),gs.PACKAGE_NAME=gs.PACKAGE_VERSION=void 0,gs.PACKAGE_VERSION="0.56.0",gs.PACKAGE_NAME="@opentelemetry/instrumentation-ioredis"),gs}var OO;function T4(){if(OO)return oc;OO=1,Object.defineProperty(oc,"__esModule",{value:!0}),oc.IORedisInstrumentation=void 0;const e=Ue(),t=Be,n=p4(),r=Be,s=h4(),i=YT(),o=E4(),c={requireParentSpan:!0};class a extends t.InstrumentationBase{constructor(f={}){super(o.PACKAGE_NAME,o.PACKAGE_VERSION,{...c,...f})}setConfig(f={}){super.setConfig({...c,...f})}init(){return[new t.InstrumentationNodeModuleDefinition("ioredis",[">=2.0.0 <6"],(f,d)=>{const u=f[Symbol.toStringTag]==="Module"?f.default:f;return(0,t.isWrapped)(u.prototype.sendCommand)&&this._unwrap(u.prototype,"sendCommand"),this._wrap(u.prototype,"sendCommand",this._patchSendCommand(d)),(0,t.isWrapped)(u.prototype.connect)&&this._unwrap(u.prototype,"connect"),this._wrap(u.prototype,"connect",this._patchConnection()),f},f=>{if(f===void 0)return;const d=f[Symbol.toStringTag]==="Module"?f.default:f;this._unwrap(d.prototype,"sendCommand"),this._unwrap(d.prototype,"connect")})]}_patchSendCommand(f){return d=>this._traceSendCommand(d,f)}_patchConnection(){return f=>this._traceConnection(f)}_traceSendCommand(f,d){const u=this;return function(_){if(arguments.length<1||typeof _!="object")return f.apply(this,arguments);const p=u.getConfig(),h=p.dbStatementSerializer||i.defaultDbStatementSerializer,E=e.trace.getSpan(e.context.active())===void 0;if(p.requireParentSpan===!0&&E)return f.apply(this,arguments);const T=u.tracer.startSpan(_.name,{kind:e.SpanKind.CLIENT,attributes:{[n.ATTR_DB_SYSTEM]:n.DB_SYSTEM_VALUE_REDIS,[n.ATTR_DB_STATEMENT]:h(_.name,_.args)}}),{requestHook:S}=p;S&&(0,r.safeExecuteInTheMiddle)(()=>S(T,{moduleVersion:d,cmdName:_.name,cmdArgs:_.args}),y=>{y&&e.diag.error("ioredis instrumentation: request hook failed",y)},!0);const{host:m,port:g}=this.options;T.setAttributes({[n.ATTR_NET_PEER_NAME]:m,[n.ATTR_NET_PEER_PORT]:g,[n.ATTR_DB_CONNECTION_STRING]:`redis://${m}:${g}`});try{const y=f.apply(this,arguments),A=_.resolve;_.resolve=function(O){(0,r.safeExecuteInTheMiddle)(()=>p.responseHook?.(T,_.name,_.args,O),b=>{b&&e.diag.error("ioredis instrumentation: response hook failed",b)},!0),(0,s.endSpan)(T,null),A(O)};const N=_.reject;return _.reject=function(O){(0,s.endSpan)(T,O),N(O)},y}catch(y){throw(0,s.endSpan)(T,y),y}}}_traceConnection(f){const d=this;return function(){const u=e.trace.getSpan(e.context.active())===void 0;if(d.getConfig().requireParentSpan===!0&&u)return f.apply(this,arguments);const _=d.tracer.startSpan("connect",{kind:e.SpanKind.CLIENT,attributes:{[n.ATTR_DB_SYSTEM]:n.DB_SYSTEM_VALUE_REDIS,[n.ATTR_DB_STATEMENT]:"connect"}}),{host:p,port:h}=this.options;_.setAttributes({[n.ATTR_NET_PEER_NAME]:p,[n.ATTR_NET_PEER_PORT]:h,[n.ATTR_DB_CONNECTION_STRING]:`redis://${p}:${h}`});try{const E=f.apply(this,arguments);return(0,s.endSpan)(_,null),E}catch(E){throw(0,s.endSpan)(_,E),E}}}}return oc.IORedisInstrumentation=a,oc}var bO;function S4(){return bO||(bO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.IORedisInstrumentation=void 0;var t=T4();Object.defineProperty(e,"IORedisInstrumentation",{enumerable:!0,get:function(){return t.IORedisInstrumentation}})})(u_)),u_}var m4=S4(),l_={},uc={},As={},IO;function WT(){return IO||(IO=1,Object.defineProperty(As,"__esModule",{value:!0}),As.PACKAGE_NAME=As.PACKAGE_VERSION=void 0,As.PACKAGE_VERSION="0.57.0",As.PACKAGE_NAME="@opentelemetry/instrumentation-redis"),As}var lc={},nr={},CO;function g4(){if(CO)return nr;CO=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.getTracedCreateStreamTrace=nr.getTracedCreateClient=nr.endSpan=void 0;const e=Ue(),t=(s,i)=>{i&&s.setStatus({code:e.SpanStatusCode.ERROR,message:i.message}),s.end()};nr.endSpan=t;const n=s=>function(){const o=s.apply(this,arguments);return e.context.bind(e.context.active(),o)};nr.getTracedCreateClient=n;const r=s=>function(){return Object.prototype.hasOwnProperty.call(this,"stream")||Object.defineProperty(this,"stream",{get(){return this._patched_redis_stream},set(o){e.context.bind(e.context.active(),o),this._patched_redis_stream=o}}),s.apply(this,arguments)};return nr.getTracedCreateStreamTrace=r,nr}var _t={},vO;function KT(){return vO||(vO=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.DB_SYSTEM_VALUE_REDIS=_t.DB_SYSTEM_NAME_VALUE_REDIS=_t.ATTR_NET_PEER_PORT=_t.ATTR_NET_PEER_NAME=_t.ATTR_DB_SYSTEM=_t.ATTR_DB_STATEMENT=_t.ATTR_DB_CONNECTION_STRING=void 0,_t.ATTR_DB_CONNECTION_STRING="db.connection_string",_t.ATTR_DB_STATEMENT="db.statement",_t.ATTR_DB_SYSTEM="db.system",_t.ATTR_NET_PEER_NAME="net.peer.name",_t.ATTR_NET_PEER_PORT="net.peer.port",_t.DB_SYSTEM_NAME_VALUE_REDIS="redis",_t.DB_SYSTEM_VALUE_REDIS="redis"),_t}var PO;function A4(){if(PO)return lc;PO=1,Object.defineProperty(lc,"__esModule",{value:!0}),lc.RedisInstrumentationV2_V3=void 0;const e=Be,t=g4(),n=WT(),r=Ue(),s=gt(),i=KT(),o=YT();class c extends e.InstrumentationBase{static COMPONENT="redis";_semconvStability;constructor(l={}){super(n.PACKAGE_NAME,n.PACKAGE_VERSION,l),this._semconvStability=l.semconvStability?l.semconvStability:(0,e.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}setConfig(l={}){super.setConfig(l),this._semconvStability=l.semconvStability?l.semconvStability:(0,e.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}init(){return[new e.InstrumentationNodeModuleDefinition("redis",[">=2.6.0 <4"],l=>((0,e.isWrapped)(l.RedisClient.prototype.internal_send_command)&&this._unwrap(l.RedisClient.prototype,"internal_send_command"),this._wrap(l.RedisClient.prototype,"internal_send_command",this._getPatchInternalSendCommand()),(0,e.isWrapped)(l.RedisClient.prototype.create_stream)&&this._unwrap(l.RedisClient.prototype,"create_stream"),this._wrap(l.RedisClient.prototype,"create_stream",this._getPatchCreateStream()),(0,e.isWrapped)(l.createClient)&&this._unwrap(l,"createClient"),this._wrap(l,"createClient",this._getPatchCreateClient()),l),l=>{l!==void 0&&(this._unwrap(l.RedisClient.prototype,"internal_send_command"),this._unwrap(l.RedisClient.prototype,"create_stream"),this._unwrap(l,"createClient"))})]}_getPatchInternalSendCommand(){const l=this;return function(d){return function(_){if(arguments.length!==1||typeof _!="object")return d.apply(this,arguments);const p=l.getConfig(),h=r.trace.getSpan(r.context.active())===void 0;if(p.requireParentSpan===!0&&h)return d.apply(this,arguments);const E=p?.dbStatementSerializer||o.defaultDbStatementSerializer,T={};l._semconvStability&e.SemconvStability.OLD&&Object.assign(T,{[i.ATTR_DB_SYSTEM]:i.DB_SYSTEM_VALUE_REDIS,[i.ATTR_DB_STATEMENT]:E(_.command,_.args)}),l._semconvStability&e.SemconvStability.STABLE&&Object.assign(T,{[s.ATTR_DB_SYSTEM_NAME]:i.DB_SYSTEM_NAME_VALUE_REDIS,[s.ATTR_DB_OPERATION_NAME]:_.command,[s.ATTR_DB_QUERY_TEXT]:E(_.command,_.args)});const S=l.tracer.startSpan(`${c.COMPONENT}-${_.command}`,{kind:r.SpanKind.CLIENT,attributes:T});if(this.connection_options){const g={};l._semconvStability&e.SemconvStability.OLD&&Object.assign(g,{[i.ATTR_NET_PEER_NAME]:this.connection_options.host,[i.ATTR_NET_PEER_PORT]:this.connection_options.port}),l._semconvStability&e.SemconvStability.STABLE&&Object.assign(g,{[s.ATTR_SERVER_ADDRESS]:this.connection_options.host,[s.ATTR_SERVER_PORT]:this.connection_options.port}),S.setAttributes(g)}this.address&&l._semconvStability&e.SemconvStability.OLD&&S.setAttribute(i.ATTR_DB_CONNECTION_STRING,`redis://${this.address}`);const m=arguments[0].callback;if(m){const g=r.context.active();arguments[0].callback=function(A,N){if(p?.responseHook){const O=p.responseHook;(0,e.safeExecuteInTheMiddle)(()=>{O(S,_.command,_.args,N)},b=>{b&&l._diag.error("Error executing responseHook",b)},!0)}return(0,t.endSpan)(S,A),r.context.with(g,m,this,...arguments)}}try{return d.apply(this,arguments)}catch(g){throw(0,t.endSpan)(S,g),g}}}}_getPatchCreateClient(){return function(f){return(0,t.getTracedCreateClient)(f)}}_getPatchCreateStream(){return function(f){return(0,t.getTracedCreateStreamTrace)(f)}}}return lc.RedisInstrumentationV2_V3=c,lc}var dc={},fc={},MO;function R4(){if(MO)return fc;MO=1,Object.defineProperty(fc,"__esModule",{value:!0}),fc.getClientAttributes=void 0;const e=gt(),t=KT(),n=Be;function r(i,o,c){const a={};return c&n.SemconvStability.OLD&&Object.assign(a,{[t.ATTR_DB_SYSTEM]:t.DB_SYSTEM_VALUE_REDIS,[t.ATTR_NET_PEER_NAME]:o?.socket?.host,[t.ATTR_NET_PEER_PORT]:o?.socket?.port,[t.ATTR_DB_CONNECTION_STRING]:s(i,o?.url)}),c&n.SemconvStability.STABLE&&Object.assign(a,{[e.ATTR_DB_SYSTEM_NAME]:t.DB_SYSTEM_NAME_VALUE_REDIS,[e.ATTR_SERVER_ADDRESS]:o?.socket?.host,[e.ATTR_SERVER_PORT]:o?.socket?.port}),a}fc.getClientAttributes=r;function s(i,o){if(!(typeof o!="string"||!o))try{const c=new URL(o);return c.searchParams.delete("user_pwd"),c.username="",c.password="",c.href}catch(c){i.error("failed to sanitize redis connection url",c)}}return fc}var wO;function y4(){if(wO)return dc;wO=1,Object.defineProperty(dc,"__esModule",{value:!0}),dc.RedisInstrumentationV4_V5=void 0;const e=Ue(),t=Be,n=R4(),r=YT(),s=WT(),i=gt(),o=KT(),c=Symbol("opentelemetry.instrumentation.redis.open_spans"),a=Symbol("opentelemetry.instrumentation.redis.multi_command_options");class l extends t.InstrumentationBase{static COMPONENT="redis";_semconvStability;constructor(d={}){super(s.PACKAGE_NAME,s.PACKAGE_VERSION,d),this._semconvStability=d.semconvStability?d.semconvStability:(0,t.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}setConfig(d={}){super.setConfig(d),this._semconvStability=d.semconvStability?d.semconvStability:(0,t.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}init(){return[this._getInstrumentationNodeModuleDefinition("@redis/client"),this._getInstrumentationNodeModuleDefinition("@node-redis/client")]}_getInstrumentationNodeModuleDefinition(d){const u=new t.InstrumentationNodeModuleFile(`${d}/dist/lib/commander.js`,["^1.0.0"],(h,E)=>{const T=h.transformCommandArguments;if(!T)return this._diag.error("internal instrumentation error, missing transformCommandArguments function"),h;const S=E?.startsWith("1.0.")?"extendWithCommands":"attachCommands";return(0,t.isWrapped)(h?.[S])&&this._unwrap(h,S),this._wrap(h,S,this._getPatchExtendWithCommands(T)),h},h=>{(0,t.isWrapped)(h?.extendWithCommands)&&this._unwrap(h,"extendWithCommands"),(0,t.isWrapped)(h?.attachCommands)&&this._unwrap(h,"attachCommands")}),_=new t.InstrumentationNodeModuleFile(`${d}/dist/lib/client/multi-command.js`,["^1.0.0","^5.0.0"],h=>{const E=h?.default?.prototype;return(0,t.isWrapped)(E?.exec)&&this._unwrap(E,"exec"),this._wrap(E,"exec",this._getPatchMultiCommandsExec()),(0,t.isWrapped)(E?.addCommand)&&this._unwrap(E,"addCommand"),this._wrap(E,"addCommand",this._getPatchMultiCommandsAddCommand()),h},h=>{const E=h?.default?.prototype;(0,t.isWrapped)(E?.exec)&&this._unwrap(E,"exec"),(0,t.isWrapped)(E?.addCommand)&&this._unwrap(E,"addCommand")}),p=new t.InstrumentationNodeModuleFile(`${d}/dist/lib/client/index.js`,["^1.0.0","^5.0.0"],h=>{const E=h?.default?.prototype;return E?.multi&&((0,t.isWrapped)(E?.multi)&&this._unwrap(E,"multi"),this._wrap(E,"multi",this._getPatchRedisClientMulti())),E?.MULTI&&((0,t.isWrapped)(E?.MULTI)&&this._unwrap(E,"MULTI"),this._wrap(E,"MULTI",this._getPatchRedisClientMulti())),(0,t.isWrapped)(E?.sendCommand)&&this._unwrap(E,"sendCommand"),this._wrap(E,"sendCommand",this._getPatchRedisClientSendCommand()),this._wrap(E,"connect",this._getPatchedClientConnect()),h},h=>{const E=h?.default?.prototype;(0,t.isWrapped)(E?.multi)&&this._unwrap(E,"multi"),(0,t.isWrapped)(E?.MULTI)&&this._unwrap(E,"MULTI"),(0,t.isWrapped)(E?.sendCommand)&&this._unwrap(E,"sendCommand")});return new t.InstrumentationNodeModuleDefinition(d,["^1.0.0","^5.0.0"],h=>h,()=>{},[u,_,p])}_getPatchExtendWithCommands(d){const u=this;return function(p){return function(E){if(E?.BaseClass?.name!=="RedisClient")return p.apply(this,arguments);const T=E.executor;return E.executor=function(S,m){const g=d(S,m).args;return u._traceClientCommand(T,this,arguments,g)},p.apply(this,arguments)}}}_getPatchMultiCommandsExec(){const d=this;return function(_){return function(){const h=_.apply(this,arguments);return typeof h?.then!="function"?(d._diag.error("got non promise result when patching RedisClientMultiCommand.exec"),h):h.then(E=>{const T=this[c];return d._endSpansWithRedisReplies(T,E),E}).catch(E=>{const T=this[c];if(!T)d._diag.error("cannot find open spans to end for redis multi command");else{const S=E.constructor.name==="MultiErrorReply"?E.replies:new Array(T.length).fill(E);d._endSpansWithRedisReplies(T,S)}return Promise.reject(E)})}}}_getPatchMultiCommandsAddCommand(){const d=this;return function(_){return function(h){return d._traceClientCommand(_,this,arguments,h)}}}_getPatchRedisClientMulti(){return function(u){return function(){const p=u.apply(this,arguments);return p[a]=this.options,p}}}_getPatchRedisClientSendCommand(){const d=this;return function(_){return function(h){return d._traceClientCommand(_,this,arguments,h)}}}_getPatchedClientConnect(){const d=this;return function(_){return function(){const h=this.options,E=(0,n.getClientAttributes)(d._diag,h,d._semconvStability),T=d.tracer.startSpan(`${l.COMPONENT}-connect`,{kind:e.SpanKind.CLIENT,attributes:E});return e.context.with(e.trace.setSpan(e.context.active(),T),()=>_.apply(this)).then(m=>(T.end(),m)).catch(m=>(T.recordException(m),T.setStatus({code:e.SpanStatusCode.ERROR,message:m.message}),T.end(),Promise.reject(m)))}}}_traceClientCommand(d,u,_,p){if(e.trace.getSpan(e.context.active())===void 0&&this.getConfig().requireParentSpan)return d.apply(u,_);const E=u.options||u[a],T=p[0],S=p.slice(1),m=this.getConfig().dbStatementSerializer||r.defaultDbStatementSerializer,g=(0,n.getClientAttributes)(this._diag,E,this._semconvStability);this._semconvStability&t.SemconvStability.STABLE&&(g[i.ATTR_DB_OPERATION_NAME]=T);try{const N=m(T,S);N!=null&&(this._semconvStability&t.SemconvStability.OLD&&(g[o.ATTR_DB_STATEMENT]=N),this._semconvStability&t.SemconvStability.STABLE&&(g[i.ATTR_DB_QUERY_TEXT]=N))}catch(N){this._diag.error("dbStatementSerializer throw an exception",N,{commandName:T})}const y=this.tracer.startSpan(`${l.COMPONENT}-${T}`,{kind:e.SpanKind.CLIENT,attributes:g}),A=e.context.with(e.trace.setSpan(e.context.active(),y),()=>d.apply(u,_));if(typeof A?.then=="function")A.then(N=>{this._endSpanWithResponse(y,T,S,N,void 0)},N=>{this._endSpanWithResponse(y,T,S,null,N)});else{const N=A;N[c]=N[c]||[],N[c].push({span:y,commandName:T,commandArgs:S})}return A}_endSpansWithRedisReplies(d,u){if(!d)return this._diag.error("cannot find open spans to end for redis multi command");if(u.length!==d.length)return this._diag.error("number of multi command spans does not match response from redis");for(let _=0;_<d.length;_++){const{span:p,commandName:h,commandArgs:E}=d[_],T=u[_],[S,m]=T instanceof Error?[null,T]:[T,void 0];this._endSpanWithResponse(p,h,E,S,m)}}_endSpanWithResponse(d,u,_,p,h){const{responseHook:E}=this.getConfig();if(!h&&E)try{E(d,u,_,p)}catch(T){this._diag.error("responseHook throw an exception",T)}h&&(d.recordException(h),d.setStatus({code:e.SpanStatusCode.ERROR,message:h?.message})),d.end()}}return dc.RedisInstrumentationV4_V5=l,dc}var LO;function N4(){if(LO)return uc;LO=1,Object.defineProperty(uc,"__esModule",{value:!0}),uc.RedisInstrumentation=void 0;const e=Be,t=WT(),n=A4(),r=y4(),s={requireParentSpan:!1};class i extends e.InstrumentationBase{instrumentationV2_V3;instrumentationV4_V5;initialized=!1;constructor(c={}){const a={...s,...c};super(t.PACKAGE_NAME,t.PACKAGE_VERSION,a),this.instrumentationV2_V3=new n.RedisInstrumentationV2_V3(this.getConfig()),this.instrumentationV4_V5=new r.RedisInstrumentationV4_V5(this.getConfig()),this.initialized=!0}setConfig(c={}){const a={...s,...c};super.setConfig(a),this.initialized&&(this.instrumentationV2_V3.setConfig(a),this.instrumentationV4_V5.setConfig(a))}init(){}getModuleDefinitions(){return[...this.instrumentationV2_V3.getModuleDefinitions(),...this.instrumentationV4_V5.getModuleDefinitions()]}setTracerProvider(c){super.setTracerProvider(c),this.initialized&&(this.instrumentationV2_V3.setTracerProvider(c),this.instrumentationV4_V5.setTracerProvider(c))}enable(){super.enable(),this.initialized&&(this.instrumentationV2_V3.enable(),this.instrumentationV4_V5.enable())}disable(){super.disable(),this.initialized&&(this.instrumentationV2_V3.disable(),this.instrumentationV4_V5.disable())}}return uc.RedisInstrumentation=i,uc}var DO;function O4(){return DO||(DO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RedisInstrumentation=void 0;var t=N4();Object.defineProperty(e,"RedisInstrumentation",{enumerable:!0,get:function(){return t.RedisInstrumentation}})})(l_)),l_}var b4=O4();const I4=["get","set","setex"],wL=["get","mget"],C4=["set","setex"];function Gl(e,t){return e.includes(t.toLowerCase())}function LL(e){return Gl(wL,e)?"cache.get":Gl(C4,e)?"cache.put":void 0}function v4(e,t){return t.some(n=>e.startsWith(n))}function P4(e,t){try{if(t.length===0)return;const n=s=>typeof s=="string"||typeof s=="number"||Buffer.isBuffer(s)?[s.toString()]:Array.isArray(s)?UO(s.map(i=>n(i))):["<unknown>"],r=t[0];return Gl(I4,e)&&r!=null?n(r):UO(t.map(s=>n(s)))}catch{return}}function M4(e,t,n){if(!LL(e))return!1;for(const r of t)if(v4(r,n))return!0;return!1}function w4(e){const t=n=>{try{return Buffer.isBuffer(n)?n.byteLength:typeof n=="string"?n.length:typeof n=="number"?n.toString().length:n==null?0:JSON.stringify(n).length}catch{return}};return Array.isArray(e)?e.reduce((n,r)=>{const s=t(r);return typeof s=="number"?n!==void 0?n+s:s:n},0):t(e)}function UO(e){const t=[],n=r=>{r.forEach(s=>{Array.isArray(s)?n(s):t.push(s)})};return n(e),t}const Dd="Redis";let Uc={};const DL=(e,t,n,r)=>{e.setAttribute(He,"auto.db.otel.redis");const s=P4(t,n),i=LL(t);if(!s||!i||!Uc.cachePrefixes||!M4(t,s,Uc.cachePrefixes))return;const o=ve(e).data["net.peer.name"],c=ve(e).data["net.peer.port"];c&&o&&e.setAttributes({"network.peer.address":o,"network.peer.port":c});const a=w4(r);a&&e.setAttribute(LG,a),Gl(wL,t)&&a!==void 0&&e.setAttribute(MG,a>0),e.setAttributes({[Re]:i,[wG]:s});const l=s.join(", ");e.updateName(Uc.maxCacheKeyLength?Al(l,Uc.maxCacheKeyLength):l)},L4=Pe(`${Dd}.IORedis`,()=>new m4.IORedisInstrumentation({responseHook:DL})),D4=Pe(`${Dd}.Redis`,()=>new b4.RedisInstrumentation({responseHook:DL})),U4=Object.assign(()=>{L4(),D4()},{id:Dd}),k4=((e={})=>({name:Dd,setupOnce(){Uc=e,U4()}})),x4=k4;var d_={},_c={},pc={},kO;function B4(){return kO||(kO=1,Object.defineProperty(pc,"__esModule",{value:!0}),pc.EVENT_LISTENERS_SET=void 0,pc.EVENT_LISTENERS_SET=Symbol("opentelemetry.instrumentation.pg.eventListenersSet")),pc}var Oe={},f_={},xO;function UL(){return xO||(xO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,(function(t){t.PG_VALUES="db.postgresql.values",t.PG_PLAN="db.postgresql.plan",t.IDLE_TIMEOUT_MILLIS="db.postgresql.idle.timeout.millis",t.MAX_CLIENT="db.postgresql.max.client"})(e.AttributeNames||(e.AttributeNames={}))})(f_)),f_}var ke={},BO;function kL(){return BO||(BO=1,Object.defineProperty(ke,"__esModule",{value:!0}),ke.METRIC_DB_CLIENT_CONNECTION_PENDING_REQUESTS=ke.METRIC_DB_CLIENT_CONNECTION_COUNT=ke.DB_SYSTEM_VALUE_POSTGRESQL=ke.DB_CLIENT_CONNECTION_STATE_VALUE_USED=ke.DB_CLIENT_CONNECTION_STATE_VALUE_IDLE=ke.ATTR_NET_PEER_PORT=ke.ATTR_NET_PEER_NAME=ke.ATTR_DB_USER=ke.ATTR_DB_SYSTEM=ke.ATTR_DB_STATEMENT=ke.ATTR_DB_NAME=ke.ATTR_DB_CONNECTION_STRING=ke.ATTR_DB_CLIENT_CONNECTION_STATE=ke.ATTR_DB_CLIENT_CONNECTION_POOL_NAME=void 0,ke.ATTR_DB_CLIENT_CONNECTION_POOL_NAME="db.client.connection.pool.name",ke.ATTR_DB_CLIENT_CONNECTION_STATE="db.client.connection.state",ke.ATTR_DB_CONNECTION_STRING="db.connection_string",ke.ATTR_DB_NAME="db.name",ke.ATTR_DB_STATEMENT="db.statement",ke.ATTR_DB_SYSTEM="db.system",ke.ATTR_DB_USER="db.user",ke.ATTR_NET_PEER_NAME="net.peer.name",ke.ATTR_NET_PEER_PORT="net.peer.port",ke.DB_CLIENT_CONNECTION_STATE_VALUE_IDLE="idle",ke.DB_CLIENT_CONNECTION_STATE_VALUE_USED="used",ke.DB_SYSTEM_VALUE_POSTGRESQL="postgresql",ke.METRIC_DB_CLIENT_CONNECTION_COUNT="db.client.connection.count",ke.METRIC_DB_CLIENT_CONNECTION_PENDING_REQUESTS="db.client.connection.pending_requests"),ke}var __={},GO;function xL(){return GO||(GO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.SpanNames=void 0,(function(t){t.QUERY_PREFIX="pg.query",t.CONNECT="pg.connect",t.POOL_CONNECT="pg-pool.connect"})(e.SpanNames||(e.SpanNames={}))})(__)),__}var VO;function G4(){if(VO)return Oe;VO=1,Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.sanitizedErrorMessage=Oe.isObjectWithTextString=Oe.getErrorMessage=Oe.patchClientConnectCallback=Oe.patchCallbackPGPool=Oe.updateCounter=Oe.getPoolName=Oe.patchCallback=Oe.handleExecutionResult=Oe.handleConfigQuery=Oe.shouldSkipInstrumentation=Oe.getSemanticAttributesFromPoolConnection=Oe.getSemanticAttributesFromConnection=Oe.getConnectionString=Oe.parseAndMaskConnectionString=Oe.parseNormalizedOperationName=Oe.getQuerySpanName=void 0;const e=Ue(),t=UL(),n=gt(),r=kL(),s=Be,i=xL();function o(O,b){if(!b)return i.SpanNames.QUERY_PREFIX;const C=typeof b.name=="string"&&b.name?b.name:c(b.text);return`${i.SpanNames.QUERY_PREFIX}:${C}${O?` ${O}`:""}`}Oe.getQuerySpanName=o;function c(O){const b=O.indexOf(" ");let C=b===-1?O:O.slice(0,b);return C=C.toUpperCase(),C.endsWith(";")?C.slice(0,-1):C}Oe.parseNormalizedOperationName=c;function a(O){try{const b=new URL(O);return b.username="",b.password="",b.toString()}catch{return"postgresql://localhost:5432/"}}Oe.parseAndMaskConnectionString=a;function l(O){if("connectionString"in O&&O.connectionString)return a(O.connectionString);const b=O.host||"localhost",C=O.port||5432,w=O.database||"";return`postgresql://${b}:${C}/${w}`}Oe.getConnectionString=l;function f(O){if(Number.isInteger(O))return O}function d(O,b){let C={};return b&s.SemconvStability.OLD&&(C={...C,[r.ATTR_DB_SYSTEM]:r.DB_SYSTEM_VALUE_POSTGRESQL,[r.ATTR_DB_NAME]:O.database,[r.ATTR_DB_CONNECTION_STRING]:l(O),[r.ATTR_DB_USER]:O.user,[r.ATTR_NET_PEER_NAME]:O.host,[r.ATTR_NET_PEER_PORT]:f(O.port)}),b&s.SemconvStability.STABLE&&(C={...C,[n.ATTR_DB_SYSTEM_NAME]:n.DB_SYSTEM_NAME_VALUE_POSTGRESQL,[n.ATTR_DB_NAMESPACE]:O.namespace,[n.ATTR_SERVER_ADDRESS]:O.host,[n.ATTR_SERVER_PORT]:f(O.port)}),C}Oe.getSemanticAttributesFromConnection=d;function u(O,b){let C;try{C=O.connectionString?new URL(O.connectionString):void 0}catch{C=void 0}let w={[t.AttributeNames.IDLE_TIMEOUT_MILLIS]:O.idleTimeoutMillis,[t.AttributeNames.MAX_CLIENT]:O.maxClient};return b&s.SemconvStability.OLD&&(w={...w,[r.ATTR_DB_SYSTEM]:r.DB_SYSTEM_VALUE_POSTGRESQL,[r.ATTR_DB_NAME]:C?.pathname.slice(1)??O.database,[r.ATTR_DB_CONNECTION_STRING]:l(O),[r.ATTR_NET_PEER_NAME]:C?.hostname??O.host,[r.ATTR_NET_PEER_PORT]:Number(C?.port)||f(O.port),[r.ATTR_DB_USER]:C?.username??O.user}),b&s.SemconvStability.STABLE&&(w={...w,[n.ATTR_DB_SYSTEM_NAME]:n.DB_SYSTEM_NAME_VALUE_POSTGRESQL,[n.ATTR_DB_NAMESPACE]:O.namespace,[n.ATTR_SERVER_ADDRESS]:C?.hostname??O.host,[n.ATTR_SERVER_PORT]:Number(C?.port)||f(O.port)}),w}Oe.getSemanticAttributesFromPoolConnection=u;function _(O){return O.requireParentSpan===!0&&e.trace.getSpan(e.context.active())===void 0}Oe.shouldSkipInstrumentation=_;function p(O,b,C,w){const{connectionParameters:k}=this,U=k.database,M=o(U,w),F=O.startSpan(M,{kind:e.SpanKind.CLIENT,attributes:d(k,C)});if(!w)return F;if(w.text&&(C&s.SemconvStability.OLD&&F.setAttribute(r.ATTR_DB_STATEMENT,w.text),C&s.SemconvStability.STABLE&&F.setAttribute(n.ATTR_DB_QUERY_TEXT,w.text)),b.enhancedDatabaseReporting&&Array.isArray(w.values))try{const v=w.values.map(L=>L==null?"null":L instanceof Buffer?L.toString():typeof L=="object"?typeof L.toPostgres=="function"?L.toPostgres():JSON.stringify(L):L.toString());F.setAttribute(t.AttributeNames.PG_VALUES,v)}catch(v){e.diag.error("failed to stringify ",w.values,v)}return typeof w.name=="string"&&F.setAttribute(t.AttributeNames.PG_PLAN,w.name),F}Oe.handleConfigQuery=p;function h(O,b,C){typeof O.responseHook=="function"&&(0,s.safeExecuteInTheMiddle)(()=>{O.responseHook(b,{data:C})},w=>{w&&e.diag.error("Error running response hook",w)},!0)}Oe.handleExecutionResult=h;function E(O,b,C,w,k){return function(M,F){M?(Object.prototype.hasOwnProperty.call(M,"code")&&(w[n.ATTR_ERROR_TYPE]=M.code),M instanceof Error&&b.recordException(N(M)),b.setStatus({code:e.SpanStatusCode.ERROR,message:M.message})):h(O,b,F),k(),b.end(),C.call(this,M,F)}}Oe.patchCallback=E;function T(O){let b="";return b+=(O?.host?`${O.host}`:"unknown_host")+":",b+=(O?.port?`${O.port}`:"unknown_port")+"/",b+=O?.database?`${O.database}`:"unknown_database",b.trim()}Oe.getPoolName=T;function S(O,b,C,w,k){const U=b.totalCount,M=b.waitingCount,F=b.idleCount,v=U-F;return C.add(v-k.used,{[r.ATTR_DB_CLIENT_CONNECTION_STATE]:r.DB_CLIENT_CONNECTION_STATE_VALUE_USED,[r.ATTR_DB_CLIENT_CONNECTION_POOL_NAME]:O}),C.add(F-k.idle,{[r.ATTR_DB_CLIENT_CONNECTION_STATE]:r.DB_CLIENT_CONNECTION_STATE_VALUE_IDLE,[r.ATTR_DB_CLIENT_CONNECTION_POOL_NAME]:O}),w.add(M-k.pending,{[r.ATTR_DB_CLIENT_CONNECTION_POOL_NAME]:O}),{used:v,idle:F,pending:M}}Oe.updateCounter=S;function m(O,b){return function(w,k,U){w&&(w instanceof Error&&O.recordException(N(w)),O.setStatus({code:e.SpanStatusCode.ERROR,message:w.message})),O.end(),b.call(this,w,k,U)}}Oe.patchCallbackPGPool=m;function g(O,b){return function(w){w&&(w instanceof Error&&O.recordException(N(w)),O.setStatus({code:e.SpanStatusCode.ERROR,message:w.message})),O.end(),b.apply(this,arguments)}}Oe.patchClientConnectCallback=g;function y(O){return typeof O=="object"&&O!==null&&"message"in O?String(O.message):void 0}Oe.getErrorMessage=y;function A(O){return typeof O=="object"&&typeof O?.text=="string"}Oe.isObjectWithTextString=A;function N(O){const b=O?.name??"PostgreSQLError",C=O?.code??"UNKNOWN";return`PostgreSQL error of type '${b}' occurred (code: ${C})`}return Oe.sanitizedErrorMessage=N,Oe}var Rs={},$O;function V4(){return $O||($O=1,Object.defineProperty(Rs,"__esModule",{value:!0}),Rs.PACKAGE_NAME=Rs.PACKAGE_VERSION=void 0,Rs.PACKAGE_VERSION="0.61.0",Rs.PACKAGE_NAME="@opentelemetry/instrumentation-pg"),Rs}var HO;function $4(){if(HO)return _c;HO=1,Object.defineProperty(_c,"__esModule",{value:!0}),_c.PgInstrumentation=void 0;const e=Be,t=Ue(),n=B4(),r=G4(),s=PL(),i=V4(),o=xL(),c=Ln,a=gt(),l=kL();function f(_){return _[Symbol.toStringTag]==="Module"?_.default:_}class d extends e.InstrumentationBase{_connectionsCounter={used:0,idle:0,pending:0};_semconvStability;constructor(p={}){super(i.PACKAGE_NAME,i.PACKAGE_VERSION,p),this._semconvStability=(0,e.semconvStabilityFromStr)("database",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}_updateMetricInstruments(){this._operationDuration=this.meter.createHistogram(a.METRIC_DB_CLIENT_OPERATION_DURATION,{description:"Duration of database client operations.",unit:"s",valueType:t.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[.001,.005,.01,.05,.1,.5,1,5,10]}}),this._connectionsCounter={idle:0,pending:0,used:0},this._connectionsCount=this.meter.createUpDownCounter(l.METRIC_DB_CLIENT_CONNECTION_COUNT,{description:"The number of connections that are currently in state described by the state attribute.",unit:"{connection}"}),this._connectionPendingRequests=this.meter.createUpDownCounter(l.METRIC_DB_CLIENT_CONNECTION_PENDING_REQUESTS,{description:"The number of current pending requests for an open connection.",unit:"{connection}"})}init(){const p=[">=8.0.3 <9"],h=[">=2.0.0 <4"],E=new e.InstrumentationNodeModuleFile("pg/lib/native/client.js",p,this._patchPgClient.bind(this),this._unpatchPgClient.bind(this)),T=new e.InstrumentationNodeModuleFile("pg/lib/client.js",p,this._patchPgClient.bind(this),this._unpatchPgClient.bind(this)),S=new e.InstrumentationNodeModuleDefinition("pg",p,g=>{const y=f(g);return this._patchPgClient(y.Client),g},g=>{const y=f(g);return this._unpatchPgClient(y.Client),g},[T,E]),m=new e.InstrumentationNodeModuleDefinition("pg-pool",h,g=>{const y=f(g);return(0,e.isWrapped)(y.prototype.connect)&&this._unwrap(y.prototype,"connect"),this._wrap(y.prototype,"connect",this._getPoolConnectPatch()),y},g=>{const y=f(g);(0,e.isWrapped)(y.prototype.connect)&&this._unwrap(y.prototype,"connect")});return[S,m]}_patchPgClient(p){if(!p)return;const h=f(p);return(0,e.isWrapped)(h.prototype.query)&&this._unwrap(h.prototype,"query"),(0,e.isWrapped)(h.prototype.connect)&&this._unwrap(h.prototype,"connect"),this._wrap(h.prototype,"query",this._getClientQueryPatch()),this._wrap(h.prototype,"connect",this._getClientConnectPatch()),p}_unpatchPgClient(p){const h=f(p);return(0,e.isWrapped)(h.prototype.query)&&this._unwrap(h.prototype,"query"),(0,e.isWrapped)(h.prototype.connect)&&this._unwrap(h.prototype,"connect"),p}_getClientConnectPatch(){const p=this;return h=>function(T){if(r.shouldSkipInstrumentation(p.getConfig()))return h.call(this,T);const S=p.tracer.startSpan(o.SpanNames.CONNECT,{kind:t.SpanKind.CLIENT,attributes:r.getSemanticAttributesFromConnection(this,p._semconvStability)});if(T){const g=t.trace.getSpan(t.context.active());T=r.patchClientConnectCallback(S,T),g&&(T=t.context.bind(t.context.active(),T))}const m=t.context.with(t.trace.setSpan(t.context.active(),S),()=>h.call(this,T));return u(S,m)}}recordOperationDuration(p,h){const E={},T=[a.ATTR_DB_NAMESPACE,a.ATTR_ERROR_TYPE,a.ATTR_SERVER_PORT,a.ATTR_SERVER_ADDRESS,a.ATTR_DB_OPERATION_NAME];this._semconvStability&e.SemconvStability.OLD&&T.push(l.ATTR_DB_SYSTEM),this._semconvStability&e.SemconvStability.STABLE&&T.push(a.ATTR_DB_SYSTEM_NAME),T.forEach(m=>{m in p&&(E[m]=p[m])});const S=(0,c.hrTimeToMilliseconds)((0,c.hrTimeDuration)(h,(0,c.hrTime)()))/1e3;this._operationDuration.record(S,E)}_getClientQueryPatch(){const p=this;return h=>(this._diag.debug("Patching pg.Client.prototype.query"),function(...T){if(r.shouldSkipInstrumentation(p.getConfig()))return h.apply(this,T);const S=(0,c.hrTime)(),m=T[0],g=typeof m=="string",y=r.isObjectWithTextString(m),A=g?{text:m,values:Array.isArray(T[1])?T[1]:void 0}:y?m:void 0,N={[l.ATTR_DB_SYSTEM]:l.DB_SYSTEM_VALUE_POSTGRESQL,[a.ATTR_DB_NAMESPACE]:this.database,[a.ATTR_SERVER_PORT]:this.connectionParameters.port,[a.ATTR_SERVER_ADDRESS]:this.connectionParameters.host};A?.text&&(N[a.ATTR_DB_OPERATION_NAME]=r.parseNormalizedOperationName(A?.text));const O=()=>{p.recordOperationDuration(N,S)},b=p.getConfig(),C=r.handleConfigQuery.call(this,p.tracer,b,p._semconvStability,A);if(b.addSqlCommenterCommentToQueries&&(g?T[0]=(0,s.addSqlCommenterComment)(C,m):y&&!("name"in m)&&(T[0]={...m,text:(0,s.addSqlCommenterComment)(C,m.text)})),T.length>0){const U=t.trace.getSpan(t.context.active());if(typeof T[T.length-1]=="function")T[T.length-1]=r.patchCallback(b,C,T[T.length-1],N,O),U&&(T[T.length-1]=t.context.bind(t.context.active(),T[T.length-1]));else if(typeof A?.callback=="function"){let M=r.patchCallback(p.getConfig(),C,A.callback,N,O);U&&(M=t.context.bind(t.context.active(),M)),T[0].callback=M}}const{requestHook:w}=b;typeof w=="function"&&A&&(0,e.safeExecuteInTheMiddle)(()=>{const{database:U,host:M,port:F,user:v}=this.connectionParameters;w(C,{connection:{database:U,host:M,port:F,user:v},query:{text:A.text,values:A.values,name:A.name}})},U=>{U&&p._diag.error("Error running query hook",U)},!0);let k;try{k=h.apply(this,T)}catch(U){throw U instanceof Error&&C.recordException(r.sanitizedErrorMessage(U)),C.setStatus({code:t.SpanStatusCode.ERROR,message:r.getErrorMessage(U)}),C.end(),U}return k instanceof Promise?k.then(U=>new Promise(M=>{r.handleExecutionResult(p.getConfig(),C,U),O(),C.end(),M(U)})).catch(U=>new Promise((M,F)=>{U instanceof Error&&C.recordException(r.sanitizedErrorMessage(U)),C.setStatus({code:t.SpanStatusCode.ERROR,message:U.message}),O(),C.end(),F(U)})):k})}_setPoolConnectEventListeners(p){if(p[n.EVENT_LISTENERS_SET])return;const h=r.getPoolName(p.options);p.on("connect",()=>{this._connectionsCounter=r.updateCounter(h,p,this._connectionsCount,this._connectionPendingRequests,this._connectionsCounter)}),p.on("acquire",()=>{this._connectionsCounter=r.updateCounter(h,p,this._connectionsCount,this._connectionPendingRequests,this._connectionsCounter)}),p.on("remove",()=>{this._connectionsCounter=r.updateCounter(h,p,this._connectionsCount,this._connectionPendingRequests,this._connectionsCounter)}),p.on("release",()=>{this._connectionsCounter=r.updateCounter(h,p,this._connectionsCount,this._connectionPendingRequests,this._connectionsCounter)}),p[n.EVENT_LISTENERS_SET]=!0}_getPoolConnectPatch(){const p=this;return h=>function(T){if(r.shouldSkipInstrumentation(p.getConfig()))return h.call(this,T);const S=p.tracer.startSpan(o.SpanNames.POOL_CONNECT,{kind:t.SpanKind.CLIENT,attributes:r.getSemanticAttributesFromPoolConnection(this.options,p._semconvStability)});if(p._setPoolConnectEventListeners(this),T){const g=t.trace.getSpan(t.context.active());T=r.patchCallbackPGPool(S,T),g&&(T=t.context.bind(t.context.active(),T))}const m=t.context.with(t.trace.setSpan(t.context.active(),S),()=>h.call(this,T));return u(S,m)}}}_c.PgInstrumentation=d;function u(_,p){if(!(p instanceof Promise))return p;const h=p;return t.context.bind(t.context.active(),h.then(E=>(_.end(),E)).catch(E=>(E instanceof Error&&_.recordException(r.sanitizedErrorMessage(E)),_.setStatus({code:t.SpanStatusCode.ERROR,message:r.getErrorMessage(E)}),_.end(),Promise.reject(E))))}return _c}var FO;function H4(){return FO||(FO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=e.PgInstrumentation=void 0;var t=$4();Object.defineProperty(e,"PgInstrumentation",{enumerable:!0,get:function(){return t.PgInstrumentation}});var n=UL();Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return n.AttributeNames}})})(d_)),d_}var F4=H4();const BL="Postgres",j4=Pe(BL,()=>new F4.PgInstrumentation({requireParentSpan:!0,requestHook(e){Dt(e,"auto.db.otel.postgres")}})),q4=(()=>({name:BL,setupOnce(){j4()}})),Y4=q4,zT="PostgresJs",jO=[">=3.0.0 <4"],W4=Pe(zT,e=>new K4({requireParentSpan:e?.requireParentSpan??!0,requestHook:e?.requestHook}));class K4 extends Ut{constructor(t){super("sentry-postgres-js",at,t)}init(){const t=new St("postgres",jO);return["src","cf/src","cjs/src"].forEach(n=>{t.files.push(new Er(`postgres/${n}/connection.js`,["*"],this._patchConnection.bind(this),this._unwrap.bind(this))),t.files.push(new Er(`postgres/${n}/query.js`,jO,this._patchQuery.bind(this),this._unwrap.bind(this)))}),[t]}_shouldCreateSpans(){const t=this.getConfig();return D.trace.getSpan(D.context.active())!==void 0||!t.requireParentSpan}_patchReject(t,n){return new Proxy(t,{apply:(r,s,i)=>{n.setStatus({code:be,message:i?.[0]?.message||"internal_error"});const o=Reflect.apply(r,s,i);return n.setAttribute(ne.ATTR_DB_RESPONSE_STATUS_CODE,i?.[0]?.code||"Unknown error"),n.setAttribute(ne.ATTR_ERROR_TYPE,i?.[0]?.name||"Unknown error"),n.end(),o}})}_patchResolve(t,n){return new Proxy(t,{apply:(r,s,i)=>{const o=Reflect.apply(r,s,i),c=i?.[0]?.command;return c&&n.setAttribute(ne.ATTR_DB_OPERATION_NAME,c),n.end(),o}})}_patchQuery(t){return t.Query.prototype.handle=new Proxy(t.Query.prototype.handle,{apply:async(n,r,s)=>{if(!this._shouldCreateSpans())return Reflect.apply(n,r,s);const i=this._sanitizeSqlQuery(r.strings?.[0]);return fr({name:i||"postgresjs.query",op:"db"},o=>{const a=rt().getScopeData().contexts.postgresjsConnection;Dt(o,"auto.db.otel.postgres");const{requestHook:l}=this.getConfig();l&&Vr(()=>l(o,i,a),_=>{_&&Y.error(`Error in requestHook for ${zT} integration:`,_)});const f=a?.ATTR_DB_NAMESPACE||"<unknown database>",d=a?.ATTR_SERVER_ADDRESS||"<unknown host>",u=a?.ATTR_SERVER_PORT||"<unknown port>";o.setAttribute(ne.ATTR_DB_SYSTEM_NAME,"postgres"),o.setAttribute(ne.ATTR_DB_NAMESPACE,f),o.setAttribute(ne.ATTR_SERVER_ADDRESS,d),o.setAttribute(ne.ATTR_SERVER_PORT,u),o.setAttribute(ne.ATTR_DB_QUERY_TEXT,i),r.resolve=this._patchResolve(r.resolve,o),r.reject=this._patchReject(r.reject,o);try{return Reflect.apply(n,r,s)}catch(_){throw o.setStatus({code:be}),o.end(),_}})}}),t}_patchConnection(t){return new Proxy(t,{apply:(n,r,s)=>{const i=s[0]?.database||"<unknown database>",o=s[0]?.host?.[0]||"<unknown host>",c=s[0]?.port?.[0]||"<unknown port>";return rt().setContext("postgresjsConnection",{ATTR_DB_NAMESPACE:i,ATTR_SERVER_ADDRESS:o,ATTR_SERVER_PORT:c}),Reflect.apply(n,r,s)}})}_sanitizeSqlQuery(t){return t?t.replace(/\s+/g," ").trim().substring(0,1024).replace(/--.*?(\r?\n|$)/g,"").replace(/\/\*[\s\S]*?\*\//g,"").replace(/;\s*$/,"").replace(/\b\d+\b/g,"?").replace(/\s+/g," ").replace(/\bIN\b\s*\(\s*\?(?:\s*,\s*\?)*\s*\)/g,"IN (?)"):"Unknown SQL Query"}}const z4=(()=>({name:zT,setupOnce(){W4()}})),Z4=z4;var X4=process.env.PRISMA_SHOW_ALL_TRACES==="true",Q4="00-10-10-00";function J4(e){switch(e){case"client":return D.SpanKind.CLIENT;case"internal":default:return D.SpanKind.INTERNAL}}var e3=class{tracerProvider;ignoreSpanTypes;constructor({tracerProvider:e,ignoreSpanTypes:t}){this.tracerProvider=e,this.ignoreSpanTypes=t}isEnabled(){return!0}getTraceParent(e){const t=D.trace.getSpanContext(e??D.context.active());return t?`00-${t.traceId}-${t.spanId}-0${t.traceFlags}`:Q4}dispatchEngineSpans(e){const t=this.tracerProvider.getTracer("prisma"),n=new Map,r=e.filter(s=>s.parentId===null);for(const s of r)GL(t,s,e,n,this.ignoreSpanTypes)}getActiveContext(){return D.context.active()}runInChildSpan(e,t){if(typeof e=="string"&&(e={name:e}),e.internal&&!X4)return t();const n=this.tracerProvider.getTracer("prisma"),r=e.context??this.getActiveContext(),s=`prisma:client:${e.name}`;if(VL(s,this.ignoreSpanTypes))return t();if(e.active===!1){const i=n.startSpan(s,e,r);return qO(i,t(i,r))}return n.startActiveSpan(s,e,i=>qO(i,t(i,r)))}};function GL(e,t,n,r,s){if(VL(t.name,s))return;const i={attributes:t.attributes,kind:J4(t.kind),startTime:t.startTime};e.startActiveSpan(t.name,i,o=>{r.set(t.id,o.spanContext().spanId),t.links&&o.addLinks(t.links.flatMap(a=>{const l=r.get(a);return l?{context:{spanId:l,traceId:o.spanContext().traceId,traceFlags:o.spanContext().traceFlags}}:[]}));const c=n.filter(a=>a.parentId===t.id);for(const a of c)GL(e,a,n,r,s);o.end(t.endTime)})}function qO(e,t){return t3(t)?t.then(n=>(e.end(),n),n=>{throw e.end(),n}):(e.end(),t)}function t3(e){return e!=null&&typeof e.then=="function"}function VL(e,t){return t.some(n=>typeof n=="string"?n===e:n.test(e))}var $L={name:"@prisma/instrumentation",version:"6.19.0"},RE=$L.version,n3=RE.split(".")[0],YO="PRISMA_INSTRUMENTATION",p_=`V${n3}_PRISMA_INSTRUMENTATION`,r3=$L.name,s3="@prisma/client",i3=class extends Ut{tracerProvider;constructor(e={}){super(r3,RE,e)}setTracerProvider(e){this.tracerProvider=e}init(){return[new St(s3,[RE])]}enable(){const e=this._config,t={helper:new e3({tracerProvider:this.tracerProvider??D.trace.getTracerProvider(),ignoreSpanTypes:e.ignoreSpanTypes??[]})};global[YO]=t,global[p_]=t}disable(){delete global[YO],delete global[p_]}isEnabled(){return!!global[p_]}};const HL="Prisma";function o3(e){return!!e&&typeof e=="object"&&"dispatchEngineSpans"in e}function FL(){const e=globalThis.PRISMA_INSTRUMENTATION;return e&&typeof e=="object"&&"helper"in e?e.helper:void 0}class a3 extends i3{constructor(){super()}enable(){super.enable();const t=FL();o3(t)&&(t.createEngineSpan=n=>{const r=D.trace.getTracer("prismaV5Compatibility"),s=r._idGenerator;if(!s){Cn(()=>{console.warn("[Sentry] Could not find _idGenerator on tracer, skipping Prisma v5 compatibility - some Prisma spans may be missing!")});return}try{n.spans.forEach(i=>{const o=c3(i.kind),c=i.parent_span_id,a=i.span_id,l=i.trace_id,f=i.links?.map(u=>({context:{traceId:u.trace_id,spanId:u.span_id,traceFlags:D.TraceFlags.SAMPLED}})),d=D.trace.setSpanContext(D.context.active(),{traceId:l,spanId:c,traceFlags:D.TraceFlags.SAMPLED});D.context.with(d,()=>{const u={generateTraceId:()=>l,generateSpanId:()=>a};r._idGenerator=u,r.startSpan(i.name,{kind:o,links:f,startTime:i.start_time,attributes:i.attributes}).end(i.end_time),r._idGenerator=s})})}finally{r._idGenerator=s}})}}function c3(e){switch(e){case"client":return D.SpanKind.CLIENT;case"internal":default:return D.SpanKind.INTERNAL}}const u3=Pe(HL,e=>new a3),l3=e=>({name:HL,setupOnce(){u3()},setup(t){FL()&&t.on("spanStart",n=>{const r=ve(n);r.description?.startsWith("prisma:")&&n.setAttribute(He,"auto.db.otel.prisma"),r.description==="prisma:engine:db_query"&&r.data["db.query.text"]&&n.updateName(r.data["db.query.text"]),r.description==="prisma:engine:db_query"&&!r.data["db.system"]&&n.setAttribute("db.system","prisma")})}});var h_={},hc={},ys={},WO;function d3(){return WO||(WO=1,Object.defineProperty(ys,"__esModule",{value:!0}),ys.PACKAGE_NAME=ys.PACKAGE_VERSION=void 0,ys.PACKAGE_VERSION="0.55.0",ys.PACKAGE_NAME="@opentelemetry/instrumentation-hapi"),ys}var gn={},KO;function jL(){return KO||(KO=1,Object.defineProperty(gn,"__esModule",{value:!0}),gn.HapiLifecycleMethodNames=gn.HapiLayerType=gn.handlerPatched=gn.HapiComponentName=void 0,gn.HapiComponentName="@hapi/hapi",gn.handlerPatched=Symbol("hapi-handler-patched"),gn.HapiLayerType={ROUTER:"router",PLUGIN:"plugin",EXT:"server.ext"},gn.HapiLifecycleMethodNames=new Set(["onPreAuth","onCredentials","onPostAuth","onPreHandler","onPostHandler","onPreResponse","onRequest"])),gn}var E_={},Ec={},zO;function f3(){return zO||(zO=1,Object.defineProperty(Ec,"__esModule",{value:!0}),Ec.ATTR_HTTP_METHOD=void 0,Ec.ATTR_HTTP_METHOD="http.method"),Ec}var T_={},ZO;function qL(){return ZO||(ZO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,(function(t){t.HAPI_TYPE="hapi.type",t.PLUGIN_NAME="hapi.plugin.name",t.EXT_TYPE="server.ext.type"})(e.AttributeNames||(e.AttributeNames={}))})(T_)),T_}var XO;function _3(){return XO||(XO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getPluginFromInput=e.getExtMetadata=e.getRouteMetadata=e.isPatchableExtMethod=e.isDirectExtInput=e.isLifecycleExtEventObj=e.isLifecycleExtType=e.getPluginName=void 0;const t=gt(),n=f3(),r=jL(),s=qL(),i=Be;function o(p){return p.name?p.name:p.pkg.name}e.getPluginName=o;const c=p=>typeof p=="string"&&r.HapiLifecycleMethodNames.has(p);e.isLifecycleExtType=c;const a=p=>{const h=p?.type;return h!==void 0&&(0,e.isLifecycleExtType)(h)};e.isLifecycleExtEventObj=a;const l=p=>Array.isArray(p)&&p.length<=3&&(0,e.isLifecycleExtType)(p[0])&&typeof p[1]=="function";e.isDirectExtInput=l;const f=p=>!Array.isArray(p);e.isPatchableExtMethod=f;const d=(p,h,E)=>{const T={[t.ATTR_HTTP_ROUTE]:p.path};h&i.SemconvStability.OLD&&(T[n.ATTR_HTTP_METHOD]=p.method),h&i.SemconvStability.STABLE&&(T[t.ATTR_HTTP_REQUEST_METHOD]=p.method);let S;return E?(T[s.AttributeNames.HAPI_TYPE]=r.HapiLayerType.PLUGIN,T[s.AttributeNames.PLUGIN_NAME]=E,S=`${E}: route - ${p.path}`):(T[s.AttributeNames.HAPI_TYPE]=r.HapiLayerType.ROUTER,S=`route - ${p.path}`),{attributes:T,name:S}};e.getRouteMetadata=d;const u=(p,h)=>h?{attributes:{[s.AttributeNames.EXT_TYPE]:p,[s.AttributeNames.HAPI_TYPE]:r.HapiLayerType.EXT,[s.AttributeNames.PLUGIN_NAME]:h},name:`${h}: ext - ${p}`}:{attributes:{[s.AttributeNames.EXT_TYPE]:p,[s.AttributeNames.HAPI_TYPE]:r.HapiLayerType.EXT},name:`ext - ${p}`};e.getExtMetadata=u;const _=p=>"plugin"in p?"plugin"in p.plugin?p.plugin.plugin:p.plugin:p;e.getPluginFromInput=_})(E_)),E_}var QO;function p3(){if(QO)return hc;QO=1,Object.defineProperty(hc,"__esModule",{value:!0}),hc.HapiInstrumentation=void 0;const e=Ue(),t=Ln,n=Be,r=d3(),s=jL(),i=_3();class o extends n.InstrumentationBase{_semconvStability;constructor(a={}){super(r.PACKAGE_NAME,r.PACKAGE_VERSION,a),this._semconvStability=(0,n.semconvStabilityFromStr)("http",process.env.OTEL_SEMCONV_STABILITY_OPT_IN)}init(){return new n.InstrumentationNodeModuleDefinition(s.HapiComponentName,[">=17.0.0 <22"],a=>{const l=a[Symbol.toStringTag]==="Module"?a.default:a;return(0,n.isWrapped)(l.server)||this._wrap(l,"server",this._getServerPatch.bind(this)),(0,n.isWrapped)(l.Server)||this._wrap(l,"Server",this._getServerPatch.bind(this)),l},a=>{const l=a[Symbol.toStringTag]==="Module"?a.default:a;this._massUnwrap([l],["server","Server"])})}_getServerPatch(a){const l=this,f=this;return function(u){const _=a.apply(this,[u]);return f._wrap(_,"route",p=>l._getServerRoutePatch.bind(l)(p)),f._wrap(_,"ext",p=>l._getServerExtPatch.bind(l)(p)),f._wrap(_,"register",l._getServerRegisterPatch.bind(l)),_}}_getServerRegisterPatch(a){const l=this;return function(d,u){if(Array.isArray(d))for(const _ of d){const p=(0,i.getPluginFromInput)(_);l._wrapRegisterHandler(p)}else{const _=(0,i.getPluginFromInput)(d);l._wrapRegisterHandler(_)}return a.apply(this,[d,u])}}_getServerExtPatch(a,l){const f=this;return function(...u){if(Array.isArray(u[0])){const _=u[0];for(let p=0;p<_.length;p++){const h=_[p];if((0,i.isLifecycleExtType)(h.type)){const E=h,T=f._wrapExtMethods(E.method,h.type,l);E.method=T,_[p]=E}}return a.apply(this,u)}else if((0,i.isDirectExtInput)(u)){const _=u,p=_[1],h=f._wrapExtMethods(p,_[0],l);return a.apply(this,[_[0],h,_[2]])}else if((0,i.isLifecycleExtEventObj)(u[0])){const _=u[0],p=f._wrapExtMethods(_.method,_.type,l);return _.method=p,a.call(this,_)}return a.apply(this,u)}}_getServerRoutePatch(a,l){const f=this;return function(d){if(Array.isArray(d))for(let u=0;u<d.length;u++){const _=f._wrapRouteHandler.call(f,d[u],l);d[u]=_}else d=f._wrapRouteHandler.call(f,d,l);return a.apply(this,[d])}}_wrapRegisterHandler(a){const l=this,f=(0,i.getPluginName)(a),d=a.register,u=this,_=function(p,h){return u._wrap(p,"route",E=>l._getServerRoutePatch.bind(l)(E,f)),u._wrap(p,"ext",E=>l._getServerExtPatch.bind(l)(E,f)),d.call(this,p,h)};a.register=_}_wrapExtMethods(a,l,f){const d=this;if(a instanceof Array){for(let u=0;u<a.length;u++)a[u]=d._wrapExtMethods(a[u],l);return a}else if((0,i.isPatchableExtMethod)(a))return a[s.handlerPatched]===!0?a:(a[s.handlerPatched]=!0,async function(..._){if(e.trace.getSpan(e.context.active())===void 0)return await a.apply(this,_);const p=(0,i.getExtMetadata)(l,f),h=d.tracer.startSpan(p.name,{attributes:p.attributes});try{return await e.context.with(e.trace.setSpan(e.context.active(),h),a,void 0,..._)}catch(E){throw h.recordException(E),h.setStatus({code:e.SpanStatusCode.ERROR,message:E.message}),E}finally{h.end()}});return a}_wrapRouteHandler(a,l){const f=this;if(a[s.handlerPatched]===!0)return a;a[s.handlerPatched]=!0;const d=u=>async function(..._){if(e.trace.getSpan(e.context.active())===void 0)return await u.call(this,..._);const p=(0,t.getRPCMetadata)(e.context.active());p?.type===t.RPCType.HTTP&&(p.route=a.path);const h=(0,i.getRouteMetadata)(a,f._semconvStability,l),E=f.tracer.startSpan(h.name,{attributes:h.attributes});try{return await e.context.with(e.trace.setSpan(e.context.active(),E),()=>u.call(this,..._))}catch(T){throw E.recordException(T),E.setStatus({code:e.SpanStatusCode.ERROR,message:T.message}),T}finally{E.end()}};if(typeof a.handler=="function")a.handler=d(a.handler);else if(typeof a.options=="function"){const u=a.options;a.options=function(_){const p=u(_);return typeof p.handler=="function"&&(p.handler=d(p.handler)),p}}else typeof a.options?.handler=="function"&&(a.options.handler=d(a.options.handler));return a}}return hc.HapiInstrumentation=o,hc}var JO;function h3(){return JO||(JO=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=e.HapiInstrumentation=void 0;var t=p3();Object.defineProperty(e,"HapiInstrumentation",{enumerable:!0,get:function(){return t.HapiInstrumentation}});var n=qL();Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return n.AttributeNames}})})(h_)),h_}var E3=h3();const YL="Hapi",T3=Pe(YL,()=>new E3.HapiInstrumentation),S3=(()=>({name:YL,setupOnce(){T3()}})),m3=S3,Ni={HONO_TYPE:"hono.type",HONO_NAME:"hono.name"},xu={MIDDLEWARE:"middleware",REQUEST_HANDLER:"request_handler"},g3="@sentry/instrumentation-hono",A3="0.0.1";class R3 extends Ut{constructor(t={}){super(g3,A3,t)}init(){return[new St("hono",[">=4.0.0 <5"],t=>this._patch(t))]}_patch(t){const n=this;class r extends t.Hono{constructor(...i){super(...i),n._wrap(this,"get",n._patchHandler()),n._wrap(this,"post",n._patchHandler()),n._wrap(this,"put",n._patchHandler()),n._wrap(this,"delete",n._patchHandler()),n._wrap(this,"options",n._patchHandler()),n._wrap(this,"patch",n._patchHandler()),n._wrap(this,"all",n._patchHandler()),n._wrap(this,"on",n._patchOnHandler()),n._wrap(this,"use",n._patchMiddlewareHandler())}}try{t.Hono=r}catch{return{...t,Hono:r}}return t}_patchHandler(){const t=this;return function(n){return function(...s){if(typeof s[0]=="string"){const i=s[0];if(s.length===1)return n.apply(this,[i]);const o=s.slice(1);return n.apply(this,[i,...o.map(c=>t._wrapHandler(c))])}return n.apply(this,s.map(i=>t._wrapHandler(i)))}}}_patchOnHandler(){const t=this;return function(n){return function(...s){const i=s.slice(2);return n.apply(this,[...s.slice(0,2),...i.map(o=>t._wrapHandler(o))])}}}_patchMiddlewareHandler(){const t=this;return function(n){return function(...s){if(typeof s[0]=="string"){const i=s[0];if(s.length===1)return n.apply(this,[i]);const o=s.slice(1);return n.apply(this,[i,...o.map(c=>t._wrapHandler(c))])}return n.apply(this,s.map(i=>t._wrapHandler(i)))}}}_wrapHandler(t){const n=this;return function(r,s){if(!n.isEnabled())return t.apply(this,[r,s]);const i=r.req.path,o=n.tracer.startSpan(i);return D.context.with(D.trace.setSpan(D.context.active(),o),()=>n._safeExecute(()=>{const c=t.apply(this,[r,s]);if($r(c))return c.then(a=>{const l=n._determineHandlerType(a);return o.setAttributes({[Ni.HONO_TYPE]:l,[Ni.HONO_NAME]:l===xu.REQUEST_HANDLER?i:t.name||"anonymous"}),n.getConfig().responseHook?.(o),a});{const a=n._determineHandlerType(c);return o.setAttributes({[Ni.HONO_TYPE]:a,[Ni.HONO_NAME]:a===xu.REQUEST_HANDLER?i:t.name||"anonymous"}),n.getConfig().responseHook?.(o),c}},()=>o.end(),c=>{n._handleError(o,c),o.end()}))}}_safeExecute(t,n,r){try{const s=t();return $r(s)?s.then(()=>n(),i=>r(i)):n(),s}catch(s){throw r(s),s}}_determineHandlerType(t){return t===void 0?xu.MIDDLEWARE:xu.REQUEST_HANDLER}_handleError(t,n){n instanceof Error&&(t.setStatus({code:D.SpanStatusCode.ERROR,message:n.message}),t.recordException(n))}}const WL="Hono";function y3(e){const t=ve(e).data,n=t[Ni.HONO_TYPE];if(t[Re]||!n)return;e.setAttributes({[He]:"auto.http.otel.hono",[Re]:`${n}.hono`});const r=t[Ni.HONO_NAME];if(typeof r=="string"&&e.updateName(r),tt()===Qi()){Js&&Y.warn("Isolation scope is default isolation scope - skipping setting transactionName");return}const s=t[ne.ATTR_HTTP_ROUTE],i=t[ne.ATTR_HTTP_REQUEST_METHOD];typeof s=="string"&&typeof i=="string"&&tt().setTransactionName(`${i} ${s}`)}const N3=Pe(WL,()=>new R3({responseHook:e=>{y3(e)}})),O3=(()=>({name:WL,setupOnce(){N3()}})),b3=O3;var S_={},Tc={},m_={},eb;function ZT(){return eb||(eb=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.KoaLayerType=void 0,(function(t){t.ROUTER="router",t.MIDDLEWARE="middleware"})(e.KoaLayerType||(e.KoaLayerType={}))})(m_)),m_}var Ns={},tb;function I3(){return tb||(tb=1,Object.defineProperty(Ns,"__esModule",{value:!0}),Ns.PACKAGE_NAME=Ns.PACKAGE_VERSION=void 0,Ns.PACKAGE_VERSION="0.57.0",Ns.PACKAGE_NAME="@opentelemetry/instrumentation-koa"),Ns}var Os={},g_={},nb;function KL(){return nb||(nb=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeNames=void 0,(function(t){t.KOA_TYPE="koa.type",t.KOA_NAME="koa.name"})(e.AttributeNames||(e.AttributeNames={}))})(g_)),g_}var rb;function C3(){if(rb)return Os;rb=1,Object.defineProperty(Os,"__esModule",{value:!0}),Os.isLayerIgnored=Os.getMiddlewareMetadata=void 0;const e=ZT(),t=KL(),n=gt(),r=(i,o,c,a)=>c?{attributes:{[t.AttributeNames.KOA_NAME]:a?.toString(),[t.AttributeNames.KOA_TYPE]:e.KoaLayerType.ROUTER,[n.ATTR_HTTP_ROUTE]:a?.toString()},name:i._matchedRouteName||`router - ${a}`}:{attributes:{[t.AttributeNames.KOA_NAME]:o.name??"middleware",[t.AttributeNames.KOA_TYPE]:e.KoaLayerType.MIDDLEWARE},name:`middleware - ${o.name}`};Os.getMiddlewareMetadata=r;const s=(i,o)=>!!(Array.isArray(o?.ignoreLayersType)&&o?.ignoreLayersType?.includes(i));return Os.isLayerIgnored=s,Os}var Sc={},sb;function v3(){return sb||(sb=1,Object.defineProperty(Sc,"__esModule",{value:!0}),Sc.kLayerPatched=void 0,Sc.kLayerPatched=Symbol("koa-layer-patched")),Sc}var ib;function P3(){if(ib)return Tc;ib=1,Object.defineProperty(Tc,"__esModule",{value:!0}),Tc.KoaInstrumentation=void 0;const e=Ue(),t=Be,n=ZT(),r=I3(),s=C3(),i=Ln,o=v3();class c extends t.InstrumentationBase{constructor(l={}){super(r.PACKAGE_NAME,r.PACKAGE_VERSION,l)}init(){return new t.InstrumentationNodeModuleDefinition("koa",[">=2.0.0 <4"],l=>{const f=l[Symbol.toStringTag]==="Module"?l.default:l;return f==null?f:((0,t.isWrapped)(f.prototype.use)&&this._unwrap(f.prototype,"use"),this._wrap(f.prototype,"use",this._getKoaUsePatch.bind(this)),l)},l=>{const f=l[Symbol.toStringTag]==="Module"?l.default:l;(0,t.isWrapped)(f.prototype.use)&&this._unwrap(f.prototype,"use")})}_getKoaUsePatch(l){const f=this;return function(u){let _;return u.router?_=f._patchRouterDispatch(u):_=f._patchLayer(u,!1),l.apply(this,[_])}}_patchRouterDispatch(l){e.diag.debug("Patching @koa/router dispatch");const d=l.router?.stack??[];for(const u of d){const _=u.path,p=u.stack;for(let h=0;h<p.length;h++){const E=p[h];p[h]=this._patchLayer(E,!0,_)}}return l}_patchLayer(l,f,d){const u=f?n.KoaLayerType.ROUTER:n.KoaLayerType.MIDDLEWARE;return l[o.kLayerPatched]===!0||(0,s.isLayerIgnored)(u,this.getConfig())?l:l.constructor.name==="GeneratorFunction"||l.constructor.name==="AsyncGeneratorFunction"?(e.diag.debug("ignoring generator-based Koa middleware layer"),l):(l[o.kLayerPatched]=!0,e.diag.debug("patching Koa middleware layer"),async(_,p)=>{if(e.trace.getSpan(e.context.active())===void 0)return l(_,p);const E=(0,s.getMiddlewareMetadata)(_,l,f,d),T=this.tracer.startSpan(E.name,{attributes:E.attributes}),S=(0,i.getRPCMetadata)(e.context.active());S?.type===i.RPCType.HTTP&&_._matchedRoute&&(S.route=_._matchedRoute.toString());const{requestHook:m}=this.getConfig();m&&(0,t.safeExecuteInTheMiddle)(()=>m(T,{context:_,middlewareLayer:l,layerType:u}),y=>{y&&e.diag.error("koa instrumentation: request hook failed",y)},!0);const g=e.trace.setSpan(e.context.active(),T);return e.context.with(g,async()=>{try{return await l(_,p)}catch(y){throw T.recordException(y),y}finally{T.end()}})})}}return Tc.KoaInstrumentation=c,Tc}var ob;function M3(){return ob||(ob=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.KoaLayerType=e.AttributeNames=e.KoaInstrumentation=void 0;var t=P3();Object.defineProperty(e,"KoaInstrumentation",{enumerable:!0,get:function(){return t.KoaInstrumentation}});var n=KL();Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return n.AttributeNames}});var r=ZT();Object.defineProperty(e,"KoaLayerType",{enumerable:!0,get:function(){return r.KoaLayerType}})})(S_)),S_}var w3=M3();const zL="Koa",L3=Pe(zL,w3.KoaInstrumentation,(e={})=>({ignoreLayersType:e.ignoreLayersType,requestHook(t,n){Dt(t,"auto.http.otel.koa");const r=ve(t).data,s=r["koa.type"];s&&t.setAttribute(Re,`${s}.koa`);const i=r["koa.name"];if(typeof i=="string"&&t.updateName(i||"< unknown >"),tt()===Qi()){Js&&Y.warn("Isolation scope is default isolation scope - skipping setting transactionName");return}const o=r[ne.ATTR_HTTP_ROUTE],c=n.context?.request?.method?.toUpperCase()||"GET";o&&tt().setTransactionName(`${c} ${o}`)}})),D3=((e={})=>({name:zL,setupOnce(){L3(e)}})),U3=D3;var A_={},R_={},y_={},ab;function ZL(){return ab||(ab=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectNames=e.ConnectTypes=e.AttributeNames=void 0,(function(t){t.CONNECT_TYPE="connect.type",t.CONNECT_NAME="connect.name"})(e.AttributeNames||(e.AttributeNames={})),(function(t){t.MIDDLEWARE="middleware",t.REQUEST_HANDLER="request_handler"})(e.ConnectTypes||(e.ConnectTypes={})),(function(t){t.MIDDLEWARE="middleware",t.REQUEST_HANDLER="request handler"})(e.ConnectNames||(e.ConnectNames={}))})(y_)),y_}var bs={},cb;function k3(){return cb||(cb=1,Object.defineProperty(bs,"__esModule",{value:!0}),bs.PACKAGE_NAME=bs.PACKAGE_VERSION=void 0,bs.PACKAGE_VERSION="0.52.0",bs.PACKAGE_NAME="@opentelemetry/instrumentation-connect"),bs}var rr={},mc={},ub;function x3(){return ub||(ub=1,Object.defineProperty(mc,"__esModule",{value:!0}),mc._LAYERS_STORE_PROPERTY=void 0,mc._LAYERS_STORE_PROPERTY=Symbol("opentelemetry.instrumentation-connect.request-route-stack")),mc}var lb;function B3(){if(lb)return rr;lb=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.generateRoute=rr.replaceCurrentStackRoute=rr.addNewStackLayer=void 0;const e=Ue(),t=x3(),n=i=>{Array.isArray(i[t._LAYERS_STORE_PROPERTY])===!1&&Object.defineProperty(i,t._LAYERS_STORE_PROPERTY,{enumerable:!1,value:[]}),i[t._LAYERS_STORE_PROPERTY].push("/");const o=i[t._LAYERS_STORE_PROPERTY].length;return()=>{o===i[t._LAYERS_STORE_PROPERTY].length?i[t._LAYERS_STORE_PROPERTY].pop():e.diag.warn("Connect: Trying to pop the stack multiple time")}};rr.addNewStackLayer=n;const r=(i,o)=>{o&&i[t._LAYERS_STORE_PROPERTY].splice(-1,1,o)};rr.replaceCurrentStackRoute=r;const s=i=>i[t._LAYERS_STORE_PROPERTY].reduce((o,c)=>o.replace(/\/+$/,"")+c);return rr.generateRoute=s,rr}var db;function G3(){return db||(db=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectInstrumentation=e.ANONYMOUS_NAME=void 0;const t=Ue(),n=Ln,r=ZL(),s=k3(),i=Be,o=gt(),c=B3();e.ANONYMOUS_NAME="anonymous";class a extends i.InstrumentationBase{constructor(f={}){super(s.PACKAGE_NAME,s.PACKAGE_VERSION,f)}init(){return[new i.InstrumentationNodeModuleDefinition("connect",[">=3.0.0 <4"],f=>this._patchConstructor(f))]}_patchApp(f){(0,i.isWrapped)(f.use)||this._wrap(f,"use",this._patchUse.bind(this)),(0,i.isWrapped)(f.handle)||this._wrap(f,"handle",this._patchHandle.bind(this))}_patchConstructor(f){const d=this;return function(...u){const _=f.apply(this,u);return d._patchApp(_),_}}_patchNext(f,d){return function(_){const p=f.apply(this,[_]);return d(),p}}_startSpan(f,d){let u,_,p;f?(u=r.ConnectTypes.REQUEST_HANDLER,p=r.ConnectNames.REQUEST_HANDLER,_=f):(u=r.ConnectTypes.MIDDLEWARE,p=r.ConnectNames.MIDDLEWARE,_=d.name||e.ANONYMOUS_NAME);const h=`${p} - ${_}`,E={attributes:{[o.ATTR_HTTP_ROUTE]:f.length>0?f:"/",[r.AttributeNames.CONNECT_TYPE]:u,[r.AttributeNames.CONNECT_NAME]:_}};return this.tracer.startSpan(h,E)}_patchMiddleware(f,d){const u=this,_=d.length===4;function p(){if(!u.isEnabled())return d.apply(this,arguments);const[h,E,T]=_?[1,2,3]:[0,1,2],S=arguments[h],m=arguments[E],g=arguments[T];(0,c.replaceCurrentStackRoute)(S,f);const y=(0,n.getRPCMetadata)(t.context.active());f&&y?.type===n.RPCType.HTTP&&(y.route=(0,c.generateRoute)(S));let A="";f?A=`request handler - ${f}`:A=`middleware - ${d.name||e.ANONYMOUS_NAME}`;const N=u._startSpan(f,d);u._diag.debug("start span",A);let O=!1;function b(){O?u._diag.debug(`span ${N.name} - already finished`):(O=!0,u._diag.debug(`finishing span ${N.name}`),N.end()),m.removeListener("close",b)}return m.addListener("close",b),arguments[T]=u._patchNext(g,b),d.apply(this,arguments)}return Object.defineProperty(p,"length",{value:d.length,writable:!1,configurable:!0}),p}_patchUse(f){const d=this;return function(...u){const _=u[u.length-1],p=u[u.length-2]||"";return u[u.length-1]=d._patchMiddleware(p,_),f.apply(this,u)}}_patchHandle(f){const d=this;return function(){const[u,_]=[0,2],p=arguments[u],h=arguments[_],E=(0,c.addNewStackLayer)(p);return typeof h=="function"&&(arguments[_]=d._patchOut(h,E)),f.apply(this,arguments)}}_patchOut(f,d){return function(..._){return d(),Reflect.apply(f,this,_)}}}e.ConnectInstrumentation=a})(R_)),R_}var fb;function V3(){return fb||(fb=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectTypes=e.ConnectNames=e.AttributeNames=e.ANONYMOUS_NAME=e.ConnectInstrumentation=void 0;var t=G3();Object.defineProperty(e,"ConnectInstrumentation",{enumerable:!0,get:function(){return t.ConnectInstrumentation}}),Object.defineProperty(e,"ANONYMOUS_NAME",{enumerable:!0,get:function(){return t.ANONYMOUS_NAME}});var n=ZL();Object.defineProperty(e,"AttributeNames",{enumerable:!0,get:function(){return n.AttributeNames}}),Object.defineProperty(e,"ConnectNames",{enumerable:!0,get:function(){return n.ConnectNames}}),Object.defineProperty(e,"ConnectTypes",{enumerable:!0,get:function(){return n.ConnectTypes}})})(A_)),A_}var $3=V3();const XL="Connect",H3=Pe(XL,()=>new $3.ConnectInstrumentation),F3=(()=>({name:XL,setupOnce(){H3()}})),j3=F3;var N_={},O_={},dt={},_b;function q3(){return _b||(_b=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.DB_SYSTEM_VALUE_MSSQL=dt.ATTR_NET_PEER_PORT=dt.ATTR_NET_PEER_NAME=dt.ATTR_DB_USER=dt.ATTR_DB_SYSTEM=dt.ATTR_DB_STATEMENT=dt.ATTR_DB_SQL_TABLE=dt.ATTR_DB_NAME=void 0,dt.ATTR_DB_NAME="db.name",dt.ATTR_DB_SQL_TABLE="db.sql.table",dt.ATTR_DB_STATEMENT="db.statement",dt.ATTR_DB_SYSTEM="db.system",dt.ATTR_DB_USER="db.user",dt.ATTR_NET_PEER_NAME="net.peer.name",dt.ATTR_NET_PEER_PORT="net.peer.port",dt.DB_SYSTEM_VALUE_MSSQL="mssql"),dt}var Is={},pb;function Y3(){if(pb)return Is;pb=1,Object.defineProperty(Is,"__esModule",{value:!0}),Is.once=Is.getSpanName=void 0;function e(n,r,s,i){return n==="execBulkLoad"&&i&&r?`${n} ${i} ${r}`:n==="callProcedure"?r?`${n} ${s} ${r}`:`${n} ${s}`:r?`${n} ${r}`:`${n}`}Is.getSpanName=e;const t=n=>{let r=!1;return(...s)=>{if(!r)return r=!0,n(...s)}};return Is.once=t,Is}var Cs={},hb;function W3(){return hb||(hb=1,Object.defineProperty(Cs,"__esModule",{value:!0}),Cs.PACKAGE_NAME=Cs.PACKAGE_VERSION=void 0,Cs.PACKAGE_VERSION="0.27.0",Cs.PACKAGE_NAME="@opentelemetry/instrumentation-tedious"),Cs}var Eb;function K3(){return Eb||(Eb=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TediousInstrumentation=e.INJECTED_CTX=void 0;const t=Ue(),n=Hr,r=Be,s=q3(),i=Y3(),o=W3(),c=Symbol("opentelemetry.instrumentation-tedious.current-database");e.INJECTED_CTX=Symbol("opentelemetry.instrumentation-tedious.context-info-injected");const a=["callProcedure","execSql","execSqlBatch","execBulkLoad","prepare","execute"];function l(d){Object.defineProperty(this,c,{value:d,writable:!0})}class f extends r.InstrumentationBase{static COMPONENT="tedious";constructor(u={}){super(o.PACKAGE_NAME,o.PACKAGE_VERSION,u)}init(){return[new r.InstrumentationNodeModuleDefinition(f.COMPONENT,[">=1.11.0 <20"],u=>{const _=u.Connection.prototype;for(const p of a)(0,r.isWrapped)(_[p])&&this._unwrap(_,p),this._wrap(_,p,this._patchQuery(p,u));return(0,r.isWrapped)(_.connect)&&this._unwrap(_,"connect"),this._wrap(_,"connect",this._patchConnect),u},u=>{if(u===void 0)return;const _=u.Connection.prototype;for(const p of a)this._unwrap(_,p);this._unwrap(_,"connect")})]}_patchConnect(u){return function(){return l.call(this,this.config?.options?.database),this.removeListener("databaseChange",l),this.on("databaseChange",l),this.once("end",()=>{this.removeListener("databaseChange",l)}),u.apply(this,arguments)}}_buildTraceparent(u){const _=u.spanContext();return`00-${_.traceId}-${_.spanId}-0${Number(_.traceFlags||t.TraceFlags.NONE).toString(16)}`}_injectContextInfo(u,_,p){return new Promise(h=>{try{const E="set context_info @opentelemetry_traceparent",T=new _.Request(E,m=>{h()});Object.defineProperty(T,e.INJECTED_CTX,{value:!0});const S=Buffer.from(p,"utf8");T.addParameter("opentelemetry_traceparent",_.TYPES.VarBinary,S,{length:S.length}),u.execSql(T)}catch{h()}})}_shouldInjectFor(u){return u==="execSql"||u==="execSqlBatch"||u==="callProcedure"||u==="execute"}_patchQuery(u,_){return p=>{const h=this;function E(T){if(T?.[e.INJECTED_CTX])return p.apply(this,arguments);if(!(T instanceof n.EventEmitter))return h._diag.warn(`Unexpected invocation of patched ${u} method. Span not recorded`),p.apply(this,arguments);let S=0,m=0;const g=()=>m++,y=()=>S++,A=this[c],N=(M=>M.sqlTextOrProcedure==="sp_prepare"&&M.parametersByName?.stmt?.value?M.parametersByName.stmt.value:M.sqlTextOrProcedure)(T),O=h.tracer.startSpan((0,i.getSpanName)(u,A,N,T.table),{kind:t.SpanKind.CLIENT,attributes:{[s.ATTR_DB_SYSTEM]:s.DB_SYSTEM_VALUE_MSSQL,[s.ATTR_DB_NAME]:A,[s.ATTR_NET_PEER_PORT]:this.config?.options?.port,[s.ATTR_NET_PEER_NAME]:this.config?.server,[s.ATTR_DB_USER]:this.config?.userName??this.config?.authentication?.options?.userName,[s.ATTR_DB_STATEMENT]:N,[s.ATTR_DB_SQL_TABLE]:T.table}}),b=(0,i.once)(M=>{T.removeListener("done",g),T.removeListener("doneInProc",g),T.removeListener("doneProc",y),T.removeListener("error",b),this.removeListener("end",b),O.setAttribute("tedious.procedure_count",S),O.setAttribute("tedious.statement_count",m),M&&O.setStatus({code:t.SpanStatusCode.ERROR,message:M.message}),O.end()});T.on("done",g),T.on("doneInProc",g),T.on("doneProc",y),T.once("error",b),this.on("end",b),typeof T.callback=="function"?h._wrap(T,"callback",h._patchCallbackQuery(b)):h._diag.error("Expected request.callback to be a function");const C=()=>t.context.with(t.trace.setSpan(t.context.active(),O),p,this,...arguments);if(!(h.getConfig().enableTraceContextPropagation&&h._shouldInjectFor(u)))return C();const U=h._buildTraceparent(O);h._injectContextInfo(this,_,U).finally(C)}return Object.defineProperty(E,"length",{value:p.length,writable:!1}),E}}_patchCallbackQuery(u){return _=>function(p,h,E){return u(p),_.apply(this,arguments)}}}e.TediousInstrumentation=f})(O_)),O_}var Tb;function z3(){return Tb||(Tb=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TediousInstrumentation=void 0;var t=K3();Object.defineProperty(e,"TediousInstrumentation",{enumerable:!0,get:function(){return t.TediousInstrumentation}})})(N_)),N_}var Z3=z3();const X3=new Set(["callProcedure","execSql","execSqlBatch","execBulkLoad","prepare","execute"]),QL="Tedious",Q3=Pe(QL,()=>new Z3.TediousInstrumentation({})),J3=(()=>{let e;return{name:QL,setupOnce(){const t=Q3();e=h0(t)},setup(t){e?.(()=>t.on("spanStart",n=>{const{description:r,data:s}=ve(n);if(!r||s["db.system"]!=="mssql")return;const i=r.split(" ")[0]||"";X3.has(i)&&n.setAttribute(He,"auto.db.otel.tedious")}))}}}),eZ=J3;var b_={},gc={},vs={},Sb;function tZ(){return Sb||(Sb=1,Object.defineProperty(vs,"__esModule",{value:!0}),vs.PACKAGE_NAME=vs.PACKAGE_VERSION=void 0,vs.PACKAGE_VERSION="0.52.0",vs.PACKAGE_NAME="@opentelemetry/instrumentation-generic-pool"),vs}var mb;function nZ(){if(mb)return gc;mb=1,Object.defineProperty(gc,"__esModule",{value:!0}),gc.GenericPoolInstrumentation=void 0;const e=Ue(),t=Be,n=tZ(),r="generic-pool";class s extends t.InstrumentationBase{_isDisabled=!1;constructor(o={}){super(n.PACKAGE_NAME,n.PACKAGE_VERSION,o)}init(){return[new t.InstrumentationNodeModuleDefinition(r,[">=3.0.0 <4"],o=>{const c=o.Pool;return(0,t.isWrapped)(c.prototype.acquire)&&this._unwrap(c.prototype,"acquire"),this._wrap(c.prototype,"acquire",this._acquirePatcher.bind(this)),o},o=>{const c=o.Pool;return this._unwrap(c.prototype,"acquire"),o}),new t.InstrumentationNodeModuleDefinition(r,[">=2.4.0 <3"],o=>{const c=o.Pool;return(0,t.isWrapped)(c.prototype.acquire)&&this._unwrap(c.prototype,"acquire"),this._wrap(c.prototype,"acquire",this._acquireWithCallbacksPatcher.bind(this)),o},o=>{const c=o.Pool;return this._unwrap(c.prototype,"acquire"),o}),new t.InstrumentationNodeModuleDefinition(r,[">=2.0.0 <2.4"],o=>(this._isDisabled=!1,(0,t.isWrapped)(o.Pool)&&this._unwrap(o,"Pool"),this._wrap(o,"Pool",this._poolWrapper.bind(this)),o),o=>(this._isDisabled=!0,o))]}_acquirePatcher(o){const c=this;return function(...l){const f=e.context.active(),d=c.tracer.startSpan("generic-pool.acquire",{},f);return e.context.with(e.trace.setSpan(f,d),()=>o.call(this,...l).then(u=>(d.end(),u),u=>{throw d.recordException(u),d.end(),u}))}}_poolWrapper(o){const c=this;return function(){const l=o.apply(this,arguments);return c._wrap(l,"acquire",c._acquireWithCallbacksPatcher.bind(c)),l}}_acquireWithCallbacksPatcher(o){const c=this;return function(l,f){if(c._isDisabled)return o.call(this,l,f);const d=e.context.active(),u=c.tracer.startSpan("generic-pool.acquire",{},d);return e.context.with(e.trace.setSpan(d,u),()=>{o.call(this,(_,p)=>{if(u.end(),l)return l(_,p)},f)})}}}return gc.GenericPoolInstrumentation=s,gc}var gb;function rZ(){return gb||(gb=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.GenericPoolInstrumentation=void 0;var t=nZ();Object.defineProperty(e,"GenericPoolInstrumentation",{enumerable:!0,get:function(){return t.GenericPoolInstrumentation}})})(b_)),b_}var sZ=rZ();const JL="GenericPool",iZ=Pe(JL,()=>new sZ.GenericPoolInstrumentation({})),oZ=(()=>{let e;return{name:JL,setupOnce(){const t=iZ();e=h0(t)},setup(t){e?.(()=>t.on("spanStart",n=>{const s=ve(n).description;(s==="generic-pool.aquire"||s==="generic-pool.acquire")&&n.setAttribute(He,"auto.db.otel.generic_pool")}))}}}),aZ=oZ;var I_={},Ac={},An={},Ab;function eD(){return Ab||(Ab=1,Object.defineProperty(An,"__esModule",{value:!0}),An.ATTR_NET_PEER_PORT=An.ATTR_NET_PEER_NAME=An.ATTR_MESSAGING_SYSTEM=An.ATTR_MESSAGING_OPERATION=void 0,An.ATTR_MESSAGING_OPERATION="messaging.operation",An.ATTR_MESSAGING_SYSTEM="messaging.system",An.ATTR_NET_PEER_NAME="net.peer.name",An.ATTR_NET_PEER_PORT="net.peer.port"),An}var Ze={},Rb;function tD(){return Rb||(Rb=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.ATTR_MESSAGING_CONVERSATION_ID=Ze.OLD_ATTR_MESSAGING_MESSAGE_ID=Ze.MESSAGING_DESTINATION_KIND_VALUE_TOPIC=Ze.ATTR_MESSAGING_URL=Ze.ATTR_MESSAGING_PROTOCOL_VERSION=Ze.ATTR_MESSAGING_PROTOCOL=Ze.MESSAGING_OPERATION_VALUE_PROCESS=Ze.ATTR_MESSAGING_RABBITMQ_ROUTING_KEY=Ze.ATTR_MESSAGING_DESTINATION_KIND=Ze.ATTR_MESSAGING_DESTINATION=void 0,Ze.ATTR_MESSAGING_DESTINATION="messaging.destination",Ze.ATTR_MESSAGING_DESTINATION_KIND="messaging.destination_kind",Ze.ATTR_MESSAGING_RABBITMQ_ROUTING_KEY="messaging.rabbitmq.routing_key",Ze.MESSAGING_OPERATION_VALUE_PROCESS="process",Ze.ATTR_MESSAGING_PROTOCOL="messaging.protocol",Ze.ATTR_MESSAGING_PROTOCOL_VERSION="messaging.protocol_version",Ze.ATTR_MESSAGING_URL="messaging.url",Ze.MESSAGING_DESTINATION_KIND_VALUE_TOPIC="topic",Ze.OLD_ATTR_MESSAGING_MESSAGE_ID="messaging.message_id",Ze.ATTR_MESSAGING_CONVERSATION_ID="messaging.conversation_id"),Ze}var C_={},yb;function nD(){return yb||(yb=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_CONFIG=e.EndOperation=void 0,(function(t){t.AutoAck="auto ack",t.Ack="ack",t.AckAll="ackAll",t.Reject="reject",t.Nack="nack",t.NackAll="nackAll",t.ChannelClosed="channel closed",t.ChannelError="channel error",t.InstrumentationTimeout="instrumentation timeout"})(e.EndOperation||(e.EndOperation={})),e.DEFAULT_CONFIG={consumeTimeoutMs:1e3*60,useLinksForConsume:!1}})(C_)),C_}var Xe={},Nb;function cZ(){if(Nb)return Xe;Nb=1,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.isConfirmChannelTracing=Xe.unmarkConfirmChannelTracing=Xe.markConfirmChannelTracing=Xe.getConnectionAttributesFromUrl=Xe.getConnectionAttributesFromServer=Xe.normalizeExchange=Xe.CONNECTION_ATTRIBUTES=Xe.CHANNEL_CONSUME_TIMEOUT_TIMER=Xe.CHANNEL_SPANS_NOT_ENDED=Xe.MESSAGE_STORED_SPAN=void 0;const e=Ue(),t=eD(),n=tD();Xe.MESSAGE_STORED_SPAN=Symbol("opentelemetry.amqplib.message.stored-span"),Xe.CHANNEL_SPANS_NOT_ENDED=Symbol("opentelemetry.amqplib.channel.spans-not-ended"),Xe.CHANNEL_CONSUME_TIMEOUT_TIMER=Symbol("opentelemetry.amqplib.channel.consumer-timeout-timer"),Xe.CONNECTION_ATTRIBUTES=Symbol("opentelemetry.amqplib.connection.attributes");const r=(0,e.createContextKey)("opentelemetry.amqplib.channel.is-confirm-channel"),s=h=>h!==""?h:"<default>";Xe.normalizeExchange=s;const i=h=>h.replace(/:[^:@/]*@/,":***@"),o=(h,E)=>h||(E==="AMQP"?5672:5671),c=h=>{const E=h||"amqp";return(E.endsWith(":")?E.substring(0,E.length-1):E).toUpperCase()},a=h=>h||"localhost",l=(h,E,T,S)=>T?{[E]:T}:(e.diag.error(`amqplib instrumentation: could not extract connection attribute ${S} from user supplied url`,{url:h}),{}),f=h=>{const E=h.serverProperties.product?.toLowerCase?.();return E?{[t.ATTR_MESSAGING_SYSTEM]:E}:{}};Xe.getConnectionAttributesFromServer=f;const d=h=>{const E={[n.ATTR_MESSAGING_PROTOCOL_VERSION]:"0.9.1"};if(h=h||"amqp://localhost",typeof h=="object"){const T=h,S=c(T?.protocol);Object.assign(E,{...l(h,n.ATTR_MESSAGING_PROTOCOL,S,"protocol")});const m=a(T?.hostname);Object.assign(E,{...l(h,t.ATTR_NET_PEER_NAME,m,"hostname")});const g=o(T.port,S);Object.assign(E,{...l(h,t.ATTR_NET_PEER_PORT,g,"port")})}else{const T=i(h);E[n.ATTR_MESSAGING_URL]=T;try{const S=new URL(T),m=c(S.protocol);Object.assign(E,{...l(T,n.ATTR_MESSAGING_PROTOCOL,m,"protocol")});const g=a(S.hostname);Object.assign(E,{...l(T,t.ATTR_NET_PEER_NAME,g,"hostname")});const y=o(S.port?parseInt(S.port):void 0,m);Object.assign(E,{...l(T,t.ATTR_NET_PEER_PORT,y,"port")})}catch(S){e.diag.error("amqplib instrumentation: error while extracting connection details from connection url",{censoredUrl:T,err:S})}}return E};Xe.getConnectionAttributesFromUrl=d;const u=h=>h.setValue(r,!0);Xe.markConfirmChannelTracing=u;const _=h=>h.deleteValue(r);Xe.unmarkConfirmChannelTracing=_;const p=h=>h.getValue(r)===!0;return Xe.isConfirmChannelTracing=p,Xe}var Ps={},Ob;function uZ(){return Ob||(Ob=1,Object.defineProperty(Ps,"__esModule",{value:!0}),Ps.PACKAGE_NAME=Ps.PACKAGE_VERSION=void 0,Ps.PACKAGE_VERSION="0.55.0",Ps.PACKAGE_NAME="@opentelemetry/instrumentation-amqplib"),Ps}var bb;function lZ(){if(bb)return Ac;bb=1,Object.defineProperty(Ac,"__esModule",{value:!0}),Ac.AmqplibInstrumentation=void 0;const e=Ue(),t=Ln,n=Be,r=eD(),s=tD(),i=nD(),o=cZ(),c=uZ(),a=[">=0.5.5 <1"];class l extends n.InstrumentationBase{constructor(d={}){super(c.PACKAGE_NAME,c.PACKAGE_VERSION,{...i.DEFAULT_CONFIG,...d})}setConfig(d={}){super.setConfig({...i.DEFAULT_CONFIG,...d})}init(){const d=new n.InstrumentationNodeModuleFile("amqplib/lib/channel_model.js",a,this.patchChannelModel.bind(this),this.unpatchChannelModel.bind(this)),u=new n.InstrumentationNodeModuleFile("amqplib/lib/callback_model.js",a,this.patchChannelModel.bind(this),this.unpatchChannelModel.bind(this)),_=new n.InstrumentationNodeModuleFile("amqplib/lib/connect.js",a,this.patchConnect.bind(this),this.unpatchConnect.bind(this));return new n.InstrumentationNodeModuleDefinition("amqplib",a,void 0,void 0,[d,_,u])}patchConnect(d){return d=this.unpatchConnect(d),(0,n.isWrapped)(d.connect)||this._wrap(d,"connect",this.getConnectPatch.bind(this)),d}unpatchConnect(d){return(0,n.isWrapped)(d.connect)&&this._unwrap(d,"connect"),d}patchChannelModel(d,u){return(0,n.isWrapped)(d.Channel.prototype.publish)||this._wrap(d.Channel.prototype,"publish",this.getPublishPatch.bind(this,u)),(0,n.isWrapped)(d.Channel.prototype.consume)||this._wrap(d.Channel.prototype,"consume",this.getConsumePatch.bind(this,u)),(0,n.isWrapped)(d.Channel.prototype.ack)||this._wrap(d.Channel.prototype,"ack",this.getAckPatch.bind(this,!1,i.EndOperation.Ack)),(0,n.isWrapped)(d.Channel.prototype.nack)||this._wrap(d.Channel.prototype,"nack",this.getAckPatch.bind(this,!0,i.EndOperation.Nack)),(0,n.isWrapped)(d.Channel.prototype.reject)||this._wrap(d.Channel.prototype,"reject",this.getAckPatch.bind(this,!0,i.EndOperation.Reject)),(0,n.isWrapped)(d.Channel.prototype.ackAll)||this._wrap(d.Channel.prototype,"ackAll",this.getAckAllPatch.bind(this,!1,i.EndOperation.AckAll)),(0,n.isWrapped)(d.Channel.prototype.nackAll)||this._wrap(d.Channel.prototype,"nackAll",this.getAckAllPatch.bind(this,!0,i.EndOperation.NackAll)),(0,n.isWrapped)(d.Channel.prototype.emit)||this._wrap(d.Channel.prototype,"emit",this.getChannelEmitPatch.bind(this)),(0,n.isWrapped)(d.ConfirmChannel.prototype.publish)||this._wrap(d.ConfirmChannel.prototype,"publish",this.getConfirmedPublishPatch.bind(this,u)),d}unpatchChannelModel(d){return(0,n.isWrapped)(d.Channel.prototype.publish)&&this._unwrap(d.Channel.prototype,"publish"),(0,n.isWrapped)(d.Channel.prototype.consume)&&this._unwrap(d.Channel.prototype,"consume"),(0,n.isWrapped)(d.Channel.prototype.ack)&&this._unwrap(d.Channel.prototype,"ack"),(0,n.isWrapped)(d.Channel.prototype.nack)&&this._unwrap(d.Channel.prototype,"nack"),(0,n.isWrapped)(d.Channel.prototype.reject)&&this._unwrap(d.Channel.prototype,"reject"),(0,n.isWrapped)(d.Channel.prototype.ackAll)&&this._unwrap(d.Channel.prototype,"ackAll"),(0,n.isWrapped)(d.Channel.prototype.nackAll)&&this._unwrap(d.Channel.prototype,"nackAll"),(0,n.isWrapped)(d.Channel.prototype.emit)&&this._unwrap(d.Channel.prototype,"emit"),(0,n.isWrapped)(d.ConfirmChannel.prototype.publish)&&this._unwrap(d.ConfirmChannel.prototype,"publish"),d}getConnectPatch(d){return function(_,p,h){return d.call(this,_,p,function(E,T){if(E==null){const S=(0,o.getConnectionAttributesFromUrl)(_),m=(0,o.getConnectionAttributesFromServer)(T);T[o.CONNECTION_ATTRIBUTES]={...S,...m}}h.apply(this,arguments)})}}getChannelEmitPatch(d){const u=this;return function(p){if(p==="close"){u.endAllSpansOnChannel(this,!0,i.EndOperation.ChannelClosed,void 0);const h=this[o.CHANNEL_CONSUME_TIMEOUT_TIMER];h&&clearInterval(h),this[o.CHANNEL_CONSUME_TIMEOUT_TIMER]=void 0}else p==="error"&&u.endAllSpansOnChannel(this,!0,i.EndOperation.ChannelError,void 0);return d.apply(this,arguments)}}getAckAllPatch(d,u,_){const p=this;return function(E){return p.endAllSpansOnChannel(this,d,u,E),_.apply(this,arguments)}}getAckPatch(d,u,_){const p=this;return function(E,T,S){const m=this,g=u===i.EndOperation.Reject?T:S,y=m[o.CHANNEL_SPANS_NOT_ENDED]??[],A=y.findIndex(N=>N.msg===E);if(A<0)p.endConsumerSpan(E,d,u,g);else if(u!==i.EndOperation.Reject&&T){for(let N=0;N<=A;N++)p.endConsumerSpan(y[N].msg,d,u,g);y.splice(0,A+1)}else p.endConsumerSpan(E,d,u,g),y.splice(A,1);return _.apply(this,arguments)}}getConsumePatch(d,u){const _=this;return function(h,E,T){const S=this;if(!Object.prototype.hasOwnProperty.call(S,o.CHANNEL_SPANS_NOT_ENDED)){const{consumeTimeoutMs:g}=_.getConfig();if(g){const y=setInterval(()=>{_.checkConsumeTimeoutOnChannel(S)},g);y.unref(),S[o.CHANNEL_CONSUME_TIMEOUT_TIMER]=y}S[o.CHANNEL_SPANS_NOT_ENDED]=[]}const m=function(g){if(!g)return E.call(this,g);const y=g.properties.headers??{};let A=e.propagation.extract(e.ROOT_CONTEXT,y);const N=g.fields?.exchange;let O;if(_._config.useLinksForConsume){const k=A?e.trace.getSpan(A)?.spanContext():void 0;A=void 0,k&&(O=[{context:k}])}const b=_.tracer.startSpan(`${h} process`,{kind:e.SpanKind.CONSUMER,attributes:{...S?.connection?.[o.CONNECTION_ATTRIBUTES],[s.ATTR_MESSAGING_DESTINATION]:N,[s.ATTR_MESSAGING_DESTINATION_KIND]:s.MESSAGING_DESTINATION_KIND_VALUE_TOPIC,[s.ATTR_MESSAGING_RABBITMQ_ROUTING_KEY]:g.fields?.routingKey,[r.ATTR_MESSAGING_OPERATION]:s.MESSAGING_OPERATION_VALUE_PROCESS,[s.OLD_ATTR_MESSAGING_MESSAGE_ID]:g?.properties.messageId,[s.ATTR_MESSAGING_CONVERSATION_ID]:g?.properties.correlationId},links:O},A),{consumeHook:C}=_.getConfig();C&&(0,n.safeExecuteInTheMiddle)(()=>C(b,{moduleVersion:d,msg:g}),k=>{k&&e.diag.error("amqplib instrumentation: consumerHook error",k)},!0),T?.noAck||(S[o.CHANNEL_SPANS_NOT_ENDED].push({msg:g,timeOfConsume:(0,t.hrTime)()}),g[o.MESSAGE_STORED_SPAN]=b);const w=A||e.ROOT_CONTEXT;e.context.with(e.trace.setSpan(w,b),()=>{E.call(this,g)}),T?.noAck&&(_.callConsumeEndHook(b,g,!1,i.EndOperation.AutoAck),b.end())};return arguments[1]=m,u.apply(this,arguments)}}getConfirmedPublishPatch(d,u){const _=this;return function(h,E,T,S,m){const g=this,{span:y,modifiedOptions:A}=_.createPublishSpan(_,h,E,g,S),{publishHook:N}=_.getConfig();N&&(0,n.safeExecuteInTheMiddle)(()=>N(y,{moduleVersion:d,exchange:h,routingKey:E,content:T,options:A,isConfirmChannel:!0}),w=>{w&&e.diag.error("amqplib instrumentation: publishHook error",w)},!0);const O=function(w,k){try{m?.call(this,w,k)}finally{const{publishConfirmHook:U}=_.getConfig();U&&(0,n.safeExecuteInTheMiddle)(()=>U(y,{moduleVersion:d,exchange:h,routingKey:E,content:T,options:S,isConfirmChannel:!0,confirmError:w}),M=>{M&&e.diag.error("amqplib instrumentation: publishConfirmHook error",M)},!0),w&&y.setStatus({code:e.SpanStatusCode.ERROR,message:"message confirmation has been nack'ed"}),y.end()}},b=(0,o.markConfirmChannelTracing)(e.context.active()),C=[...arguments];return C[3]=A,C[4]=e.context.bind((0,o.unmarkConfirmChannelTracing)(e.trace.setSpan(b,y)),O),e.context.with(b,u.bind(this,...C))}}getPublishPatch(d,u){const _=this;return function(h,E,T,S){if((0,o.isConfirmChannelTracing)(e.context.active()))return u.apply(this,arguments);{const m=this,{span:g,modifiedOptions:y}=_.createPublishSpan(_,h,E,m,S),{publishHook:A}=_.getConfig();A&&(0,n.safeExecuteInTheMiddle)(()=>A(g,{moduleVersion:d,exchange:h,routingKey:E,content:T,options:y,isConfirmChannel:!1}),b=>{b&&e.diag.error("amqplib instrumentation: publishHook error",b)},!0);const N=[...arguments];N[3]=y;const O=u.apply(this,N);return g.end(),O}}}createPublishSpan(d,u,_,p,h){const E=(0,o.normalizeExchange)(u),T=d.tracer.startSpan(`publish ${E}`,{kind:e.SpanKind.PRODUCER,attributes:{...p.connection[o.CONNECTION_ATTRIBUTES],[s.ATTR_MESSAGING_DESTINATION]:u,[s.ATTR_MESSAGING_DESTINATION_KIND]:s.MESSAGING_DESTINATION_KIND_VALUE_TOPIC,[s.ATTR_MESSAGING_RABBITMQ_ROUTING_KEY]:_,[s.OLD_ATTR_MESSAGING_MESSAGE_ID]:h?.messageId,[s.ATTR_MESSAGING_CONVERSATION_ID]:h?.correlationId}}),S=h??{};return S.headers=S.headers??{},e.propagation.inject(e.trace.setSpan(e.context.active(),T),S.headers),{span:T,modifiedOptions:S}}endConsumerSpan(d,u,_,p){const h=d[o.MESSAGE_STORED_SPAN];h&&(u!==!1&&h.setStatus({code:e.SpanStatusCode.ERROR,message:_!==i.EndOperation.ChannelClosed&&_!==i.EndOperation.ChannelError?`${_} called on message${p===!0?" with requeue":p===!1?" without requeue":""}`:_}),this.callConsumeEndHook(h,d,u,_),h.end(),d[o.MESSAGE_STORED_SPAN]=void 0)}endAllSpansOnChannel(d,u,_,p){(d[o.CHANNEL_SPANS_NOT_ENDED]??[]).forEach(E=>{this.endConsumerSpan(E.msg,u,_,p)}),d[o.CHANNEL_SPANS_NOT_ENDED]=[]}callConsumeEndHook(d,u,_,p){const{consumeEndHook:h}=this.getConfig();h&&(0,n.safeExecuteInTheMiddle)(()=>h(d,{msg:u,rejected:_,endOperation:p}),E=>{E&&e.diag.error("amqplib instrumentation: consumerEndHook error",E)},!0)}checkConsumeTimeoutOnChannel(d){const u=(0,t.hrTime)(),_=d[o.CHANNEL_SPANS_NOT_ENDED]??[];let p;const{consumeTimeoutMs:h}=this.getConfig();for(p=0;p<_.length;p++){const E=_[p],T=(0,t.hrTimeDuration)(E.timeOfConsume,u);if((0,t.hrTimeToMilliseconds)(T)<h)break;this.endConsumerSpan(E.msg,null,i.EndOperation.InstrumentationTimeout,!0)}_.splice(0,p)}}return Ac.AmqplibInstrumentation=l,Ac}var Ib;function dZ(){return Ib||(Ib=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EndOperation=e.DEFAULT_CONFIG=e.AmqplibInstrumentation=void 0;var t=lZ();Object.defineProperty(e,"AmqplibInstrumentation",{enumerable:!0,get:function(){return t.AmqplibInstrumentation}});var n=nD();Object.defineProperty(e,"DEFAULT_CONFIG",{enumerable:!0,get:function(){return n.DEFAULT_CONFIG}}),Object.defineProperty(e,"EndOperation",{enumerable:!0,get:function(){return n.EndOperation}})})(I_)),I_}var fZ=dZ();const rD="Amqplib",_Z={consumeEndHook:e=>{Dt(e,"auto.amqplib.otel.consumer")},publishHook:e=>{Dt(e,"auto.amqplib.otel.publisher")}},pZ=Pe(rD,()=>new fZ.AmqplibInstrumentation(_Z)),hZ=(()=>({name:rD,setupOnce(){pZ()}})),EZ=hZ,XT="VercelAI",Cb=["generateText","streamText","generateObject","streamObject","embed","embedMany"];function TZ(e){if(typeof e!="object"||e===null)return!1;const t=e;return"type"in t&&"error"in t&&"toolName"in t&&"toolCallId"in t&&t.type==="tool-error"&&t.error instanceof Error}function SZ(e){if(typeof e!="object"||e===null||!("content"in e))return;const t=e;if(Array.isArray(t.content)){for(const n of t.content)if(TZ(n)){const r=SF(n.toolCallId);if(r){const s=r.spanContext();zs(i=>{i.setContext("trace",{trace_id:s.traceId,span_id:s.spanId}),i.setTag("vercel.ai.tool.name",n.toolName),i.setTag("vercel.ai.tool.callId",n.toolCallId),i.setLevel("error"),Ye(n.error,{mechanism:{type:"auto.vercelai.otel",handled:!1}})}),mF(n.toolCallId)}else zs(s=>{s.setTag("vercel.ai.tool.name",n.toolName),s.setTag("vercel.ai.tool.callId",n.toolCallId),s.setLevel("error"),Ye(n.error,{mechanism:{type:"auto.vercelai.otel",handled:!1}})})}}}function mZ(e,t,n,r){const s=e?.recordInputs!==void 0?e.recordInputs:t.recordInputs!==void 0?t.recordInputs:n===!0?!0:r,i=e?.recordOutputs!==void 0?e.recordOutputs:t.recordOutputs!==void 0?t.recordOutputs:n===!0?!0:r;return{recordInputs:s,recordOutputs:i}}class Vl extends Ut{__init(){this._isPatched=!1}__init2(){this._callbacks=[]}constructor(t={}){super("@sentry/instrumentation-vercel-ai",at,t),Vl.prototype.__init.call(this),Vl.prototype.__init2.call(this)}init(){return new St("ai",[">=3.0.0 <6"],this._patch.bind(this))}callWhenPatched(t){this._isPatched?t():this._callbacks.push(t)}_patch(t){this._isPatched=!0,this._callbacks.forEach(r=>r()),this._callbacks=[];const n=r=>new Proxy(r,{apply:(s,i,o)=>{const c=o[0].experimental_telemetry||{},a=c.isEnabled,l=ye(),f=l?.getIntegrationByName(XT),d=f?.options,u=f?!!l?.getOptions().sendDefaultPii:!1,{recordInputs:_,recordOutputs:p}=mZ(d,c,a,u);return o[0].experimental_telemetry={...c,isEnabled:a!==void 0?a:!0,recordInputs:_,recordOutputs:p},Xs(()=>Reflect.apply(s,i,o),h=>{h&&typeof h=="object"&&vn(h,"_sentry_active_span",hd())},()=>{},h=>{SZ(h)})}});if(Object.prototype.toString.call(t)==="[object Module]"){for(const r of Cb)t[r]=n(t[r]);return t}else{const r=Cb.reduce((s,i)=>(s[i]=n(t[i]),s),{});return{...t,...r}}}}const gZ=Pe(XT,()=>new Vl({}));function AZ(e){return!!e.getIntegrationByName("Modules")?.getModules?.()?.ai}const RZ=((e={})=>{let t;return{name:XT,options:e,setupOnce(){t=gZ()},afterAllSetup(n){e.force??AZ(n)?by(n):t?.callWhenPatched(()=>by(n))}}}),yZ=RZ,NZ=[">=4.0.0 <7"];class OZ extends Ut{constructor(t={}){super("@sentry/instrumentation-openai",at,t)}init(){return new St("openai",NZ,this._patch.bind(this))}_patch(t){let n=t;return n=this._patchClient(n,"OpenAI"),n=this._patchClient(n,"AzureOpenAI"),n}_patchClient(t,n){const r=t[n];if(!r)return t;const s=this.getConfig(),i=function(...o){if(AT(bd))return Reflect.construct(r,o);const c=Reflect.construct(r,o),l=!!ye()?.getOptions().sendDefaultPii,f=s.recordInputs??l,d=s.recordOutputs??l;return zF(c,{recordInputs:f,recordOutputs:d})};Object.setPrototypeOf(i,r),Object.setPrototypeOf(i.prototype,r.prototype);for(const o of Object.getOwnPropertyNames(r))if(!["length","name","prototype"].includes(o)){const c=Object.getOwnPropertyDescriptor(r,o);c&&Object.defineProperty(i,o,c)}try{t[n]=i}catch{Object.defineProperty(t,n,{value:i,writable:!0,configurable:!0,enumerable:!0})}if(t.default===r)try{t.default=i}catch{Object.defineProperty(t,"default",{value:i,writable:!0,configurable:!0,enumerable:!0})}return t}}const bZ=Pe(bd,e=>new OZ(e)),IZ=((e={})=>({name:bd,setupOnce(){bZ(e)}})),CZ=IZ,vZ=[">=0.19.2 <1.0.0"];class PZ extends Ut{constructor(t={}){super("@sentry/instrumentation-anthropic-ai",at,t)}init(){return new St("@anthropic-ai/sdk",vZ,this._patch.bind(this))}_patch(t){const n=t.Anthropic,r=this.getConfig(),s=function(...i){if(AT(Cd))return Reflect.construct(n,i);const o=Reflect.construct(n,i),a=!!ye()?.getOptions().sendDefaultPii,l=r.recordInputs??a,f=r.recordOutputs??a;return pj(o,{recordInputs:l,recordOutputs:f})};Object.setPrototypeOf(s,n),Object.setPrototypeOf(s.prototype,n.prototype);for(const i of Object.getOwnPropertyNames(n))if(!["length","name","prototype"].includes(i)){const o=Object.getOwnPropertyDescriptor(n,i);o&&Object.defineProperty(s,i,o)}try{t.Anthropic=s}catch{Object.defineProperty(t,"Anthropic",{value:s,writable:!0,configurable:!0,enumerable:!0})}if(t.default===n)try{t.default=s}catch{Object.defineProperty(t,"default",{value:s,writable:!0,configurable:!0,enumerable:!0})}return t}}const MZ=Pe(Cd,e=>new PZ(e)),wZ=((e={})=>({name:Cd,options:e,setupOnce(){MZ(e)}})),LZ=wZ,vb=[">=0.10.0 <2"];class DZ extends Ut{constructor(t={}){super("@sentry/instrumentation-google-genai",at,t)}init(){return new St("@google/genai",vb,n=>this._patch(n),n=>n,[new Er("@google/genai/dist/node/index.cjs",vb,n=>this._patch(n),n=>n)])}_patch(t){const n=t.GoogleGenAI,r=this.getConfig();if(typeof n!="function")return t;const s=function(...i){if(AT(vd))return Reflect.construct(n,i);const o=Reflect.construct(n,i),a=!!ye()?.getOptions().sendDefaultPii,l=r,f=l?.recordInputs??a,d=l?.recordOutputs??a;return Ij(o,{recordInputs:f,recordOutputs:d})};Object.setPrototypeOf(s,n),Object.setPrototypeOf(s.prototype,n.prototype);for(const i of Object.getOwnPropertyNames(n))if(!["length","name","prototype"].includes(i)){const o=Object.getOwnPropertyDescriptor(n,i);o&&Object.defineProperty(s,i,o)}return Fj(t,"GoogleGenAI",s),t}}const UZ=Pe(vd,e=>new DZ(e)),kZ=((e={})=>({name:vd,setupOnce(){UZ(e)}})),xZ=kZ,Bu=[">=0.1.0 <2.0.0"];function BZ(e,t){return e?Array.isArray(e)?e.includes(t)?e:[...e,t]:typeof e=="object"?[e,t]:e:[t]}function GZ(e,t,n){return new Proxy(e,{apply(r,s,i){let c=i[1];(!c||typeof c!="object"||Array.isArray(c))&&(c={},i[1]=c);const a=c.callbacks,l=BZ(a,t);return c.callbacks=l,Reflect.apply(r,s,i)}})}class VZ extends Ut{constructor(t={}){super("@sentry/instrumentation-langchain",at,t)}init(){const t=[],n=["@langchain/anthropic","@langchain/openai","@langchain/google-genai","@langchain/mistralai","@langchain/google-vertexai","@langchain/groq"];for(const r of n)t.push(new St(r,Bu,this._patch.bind(this),s=>s,[new Er(`${r}/dist/index.cjs`,Bu,this._patch.bind(this),s=>s)]));return t.push(new St("langchain",Bu,this._patch.bind(this),r=>r,[new Er("langchain/dist/chat_models/universal.cjs",Bu,this._patch.bind(this),r=>r)])),t}_patch(t){D$([bd,Cd,vd]);const r=!!ye()?.getOptions().sendDefaultPii,s=this.getConfig(),i=s?.recordInputs??r,o=s?.recordOutputs??r,c=Uj({recordInputs:i,recordOutputs:o});return this._patchRunnableMethods(t,c),t}_patchRunnableMethods(t,n){const r=["ChatAnthropic","ChatOpenAI","ChatGoogleGenerativeAI","ChatMistralAI","ChatVertexAI","ChatGroq","ConfigurableModel"],s=t.universal_exports??t,i=Object.values(s).find(a=>typeof a=="function"&&r.includes(a.name));if(!i)return;const o=i.prototype,c=["invoke","stream","batch"];for(const a of c){const l=o[a];typeof l=="function"&&(o[a]=GZ(l,n))}}}const $Z=Pe(l0,e=>new VZ(e)),HZ=((e={})=>({name:l0,setupOnce(){$Z(e)}})),FZ=HZ,Pb=[">=0.0.0 <2.0.0"];class jZ extends Ut{constructor(t={}){super("@sentry/instrumentation-langgraph",at,t)}init(){return new St("@langchain/langgraph",Pb,this._patch.bind(this),n=>n,[new Er("@langchain/langgraph/dist/index.cjs",Pb,this._patch.bind(this),n=>n)])}_patch(t){const r=!!ye()?.getOptions().sendDefaultPii,s=this.getConfig(),i=s.recordInputs??r,o=s.recordOutputs??r,c={recordInputs:i,recordOutputs:o};if(t.StateGraph&&typeof t.StateGraph=="function"){const a=t.StateGraph;a.prototype.compile=$j(a.prototype.compile,c)}return t}}const qZ=Pe(f0,e=>new jZ(e)),YZ=((e={})=>({name:f0,setupOnce(){qZ(e)}})),WZ=YZ;function KZ(e,t,n,r,s){let o=()=>{};const c=s.firestoreSpanCreationHook;typeof c=="function"&&(o=f=>{Vr(()=>c(f),d=>{d&&D.diag.error(d?.message)},!0)});const a=new St("@firebase/firestore",t,f=>Mb(f,n,r,e,o)),l=["@firebase/firestore/dist/lite/index.node.cjs.js","@firebase/firestore/dist/lite/index.node.mjs.js","@firebase/firestore/dist/lite/index.rn.esm2017.js","@firebase/firestore/dist/lite/index.cjs.js"];for(const f of l)a.files.push(new Er(f,t,d=>Mb(d,n,r,e,o),d=>sD(d,r)));return a}function Mb(e,t,n,r,s){return sD(e,n),t(e,"addDoc",zZ(r,s)),t(e,"getDocs",XZ(r,s)),t(e,"setDoc",QZ(r,s)),t(e,"deleteDoc",ZZ(r,s)),e}function sD(e,t){for(const n of["addDoc","getDocs","setDoc","deleteDoc"])ud(e[n])&&t(e,n);return e}function zZ(e,t){return function(r){return function(s,i){const o=kd(e,"addDoc",s);return t(o),Ud(o,()=>r(s,i))}}}function ZZ(e,t){return function(r){return function(s){const i=kd(e,"deleteDoc",s.parent||s);return t(i),Ud(i,()=>r(s))}}}function XZ(e,t){return function(r){return function(s){const i=kd(e,"getDocs",s);return t(i),Ud(i,()=>r(s))}}}function QZ(e,t){return function(r){return function(s,i,o){const c=kd(e,"setDoc",s.parent||s);return t(c),Ud(c,()=>typeof o<"u"?r(s,i,o):r(s,i))}}}function Ud(e,t){return D.context.with(D.trace.setSpan(D.context.active(),e),()=>Vr(()=>t(),n=>{n&&e.recordException(n),e.end()},!0))}function kd(e,t,n){const r=e.startSpan(`${t} ${n.path}`,{kind:D.SpanKind.CLIENT});return e6(r,n),r.setAttribute(ne.ATTR_DB_OPERATION_NAME,t),r}function JZ(e){let t,n;if(typeof e.host=="string")if(e.host.startsWith("[")){if(e.host.endsWith("]"))t=e.host.replace(/^\[|\]$/g,"");else if(e.host.includes("]:")){const r=e.host.lastIndexOf(":");r!==-1&&(t=e.host.slice(1,r).replace(/^\[|\]$/g,""),n=e.host.slice(r+1))}}else if(gi.isIPv6(e.host))t=e.host;else{const r=e.host.lastIndexOf(":");r!==-1?(t=e.host.slice(0,r),n=e.host.slice(r+1)):t=e.host}return{address:t,port:n?parseInt(n,10):void 0}}function e6(e,t){const n=t.firestore.app,r=n.options,i=(t.firestore.toJSON()||{}).settings||{},o={[ne.ATTR_DB_COLLECTION_NAME]:t.path,[ne.ATTR_DB_NAMESPACE]:n.name,[ne.ATTR_DB_SYSTEM_NAME]:"firebase.firestore","firebase.firestore.type":t.type,"firebase.firestore.options.projectId":r.projectId,"firebase.firestore.options.appId":r.appId,"firebase.firestore.options.messagingSenderId":r.messagingSenderId,"firebase.firestore.options.storageBucket":r.storageBucket},{address:c,port:a}=JZ(i);c&&(o[ne.ATTR_SERVER_ADDRESS]=c),a&&(o[ne.ATTR_SERVER_PORT]=a),e.setAttributes(o)}function t6(e,t,n,r,s){let i=()=>{},o=()=>{};const c=s.functions?.errorHook,a=s.functions?.requestHook,l=s.functions?.responseHook;typeof l=="function"&&(o=(u,_)=>{Vr(()=>l(u,_),p=>{p&&D.diag.error(p?.message)},!0)}),typeof a=="function"&&(i=u=>{Vr(()=>a(u),_=>{_&&D.diag.error(_?.message)},!0)});const f=new St("firebase-functions",t);return[{name:"firebase-functions/lib/v2/providers/https.js",triggerType:"function"},{name:"firebase-functions/lib/v2/providers/firestore.js",triggerType:"firestore"},{name:"firebase-functions/lib/v2/providers/scheduler.js",triggerType:"scheduler"},{name:"firebase-functions/lib/v2/storage.js",triggerType:"storage"}].forEach(({name:u,triggerType:_})=>{f.files.push(new Er(u,t,p=>n6(p,n,r,e,{requestHook:i,responseHook:o,errorHook:c},_),p=>iD(p,r)))}),f}function bt(e,t,n){return function(s){return function(...i){const o=typeof i[0]=="function"?i[0]:i[1],c=typeof i[0]=="function"?void 0:i[0];if(!o)return s.call(this,...i);const a=async function(...l){const f=process.env.FUNCTION_TARGET||process.env.K_SERVICE||"unknown",d=e.startSpan(`firebase.function.${n}`,{kind:D.SpanKind.SERVER}),u={"faas.name":f,"faas.trigger":n,"faas.provider":"firebase"};return process.env.GCLOUD_PROJECT&&(u["cloud.project_id"]=process.env.GCLOUD_PROJECT),process.env.EVENTARC_CLOUD_EVENT_SOURCE&&(u["cloud.event_source"]=process.env.EVENTARC_CLOUD_EVENT_SOURCE),d.setAttributes(u),t?.requestHook?.(d),D.context.with(D.trace.setSpan(D.context.active(),d),async()=>{let _,p;try{p=await o.apply(this,l)}catch(h){_=h}if(t?.responseHook?.(d,_),_&&d.recordException(_),d.end(),_)throw await t?.errorHook?.(d,_),_;return p})};return c?s.call(this,c,a):s.call(this,a)}}}function n6(e,t,n,r,s,i){switch(iD(e,n),i){case"function":t(e,"onRequest",bt(r,s,"http.request")),t(e,"onCall",bt(r,s,"http.call"));break;case"firestore":t(e,"onDocumentCreated",bt(r,s,"firestore.document.created")),t(e,"onDocumentUpdated",bt(r,s,"firestore.document.updated")),t(e,"onDocumentDeleted",bt(r,s,"firestore.document.deleted")),t(e,"onDocumentWritten",bt(r,s,"firestore.document.written")),t(e,"onDocumentCreatedWithAuthContext",bt(r,s,"firestore.document.created")),t(e,"onDocumentUpdatedWithAuthContext",bt(r,s,"firestore.document.updated")),t(e,"onDocumentDeletedWithAuthContext",bt(r,s,"firestore.document.deleted")),t(e,"onDocumentWrittenWithAuthContext",bt(r,s,"firestore.document.written"));break;case"scheduler":t(e,"onSchedule",bt(r,s,"scheduler.scheduled"));break;case"storage":t(e,"onObjectFinalized",bt(r,s,"storage.object.finalized")),t(e,"onObjectArchived",bt(r,s,"storage.object.archived")),t(e,"onObjectDeleted",bt(r,s,"storage.object.deleted")),t(e,"onObjectMetadataUpdated",bt(r,s,"storage.object.metadataUpdated"));break}return e}function iD(e,t){const n=["onSchedule","onRequest","onCall","onObjectFinalized","onObjectArchived","onObjectDeleted","onObjectMetadataUpdated","onDocumentCreated","onDocumentUpdated","onDocumentDeleted","onDocumentWritten","onDocumentCreatedWithAuthContext","onDocumentUpdatedWithAuthContext","onDocumentDeletedWithAuthContext","onDocumentWrittenWithAuthContext"];for(const r of n)ud(e[r])&&t(e,r);return e}const wb={},r6=[">=3.0.0 <5"],s6=[">=6.0.0 <7"];class i6 extends Ut{constructor(t=wb){super("@sentry/instrumentation-firebase",at,t)}setConfig(t={}){super.setConfig({...wb,...t})}init(){const t=[];return t.push(KZ(this.tracer,r6,this._wrap,this._unwrap,this.getConfig())),t.push(t6(this.tracer,s6,this._wrap,this._unwrap,this.getConfig())),t}}const oD="Firebase",o6={firestoreSpanCreationHook:e=>{Dt(e,"auto.firebase.otel.firestore"),e.setAttribute(Re,"db.query")},functions:{requestHook:e=>{Dt(e,"auto.firebase.otel.functions"),e.setAttribute(Re,"http.request")},errorHook:async(e,t)=>{t&&(Ye(t,{mechanism:{type:"auto.firebase.otel.functions",handled:!1}}),await jV(2e3))}}},a6=Pe(oD,()=>new i6(o6)),c6=(()=>({name:oD,setupOnce(){a6()}})),u6=c6;function l6(){return[Z2(),JK(),lz(),b3(),Hz(),Zz(),i4(),_4(),x4(),Y4(),l3(),m3(),U3(),j3(),eZ(),aZ(),Az(),EZ(),Cz(),FZ(),WZ(),yZ(),CZ(),LZ(),xZ(),Z4(),u6()]}const v_=1e6;function d6(e,t={}){e.getOptions().debug&&JW();const n=f6(e,t);e.traceProvider=n}function f6(e,t={}){const n=new Nq({sampler:new fY(e),resource:g0().merge(m0({[ne.ATTR_SERVICE_NAME]:"node",[ne.SEMRESATTRS_SERVICE_NAMESPACE]:"sentry",[ne.ATTR_SERVICE_VERSION]:at})),forceFlushTimeoutMillis:500,spanProcessors:[new dY({timeout:_6(e.getOptions().maxSpanWaitDuration)}),...t.spanProcessors||[]]});return D.trace.setGlobalTracerProvider(n),D.propagation.setGlobalPropagator(new Bq),D.context.setGlobalContextManager(new QW),n}function _6(e){if(e!=null){if(e>v_)return Js&&Y.warn(`\`maxSpanWaitDuration\` is too high, using the maximum value of ${v_}`),v_;if(e<=0||Number.isNaN(e)){Js&&Y.warn("`maxSpanWaitDuration` must be a positive number, using default value instead.");return}return e}}function p6(){return aL().filter(t=>t.name!=="Http"&&t.name!=="NodeFetch").concat(C2(),x2())}function h6(e){return[...p6(),...un(e)?l6():[]]}function E6(e={}){return T6(e,h6)}function T6(e={},t){RT(e,"node");const n=S2({...e,defaultIntegrations:e.defaultIntegrations??t(e)});return n&&!e.skipOpenTelemetrySetup&&(d6(n,{spanProcessors:e.openTelemetrySpanProcessors}),g2()),n}function Z(e,t,n){function r(c,a){if(c._zod||Object.defineProperty(c,"_zod",{value:{def:a,constr:o,traits:new Set},enumerable:!1}),c._zod.traits.has(e))return;c._zod.traits.add(e),t(c,a);const l=o.prototype,f=Object.keys(l);for(let d=0;d<f.length;d++){const u=f[d];u in c||(c[u]=l[u].bind(c))}}const s=n?.Parent??Object;class i extends s{}Object.defineProperty(i,"name",{value:e});function o(c){var a;const l=n?.Parent?new i:this;r(l,c),(a=l._zod).deferred??(a.deferred=[]);for(const f of l._zod.deferred)f();return l}return Object.defineProperty(o,"init",{value:r}),Object.defineProperty(o,Symbol.hasInstance,{value:c=>n?.Parent&&c instanceof n.Parent?!0:c?._zod?.traits?.has(e)}),Object.defineProperty(o,"name",{value:e}),o}class Ui extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class aD extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const cD={};function ei(e){return cD}function S6(e){const t=Object.values(e).filter(r=>typeof r=="number");return Object.entries(e).filter(([r,s])=>t.indexOf(+r)===-1).map(([r,s])=>s)}function yE(e,t){return typeof t=="bigint"?t.toString():t}function QT(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function JT(e){return e==null}function eS(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function m6(e,t){const n=(e.toString().split(".")[1]||"").length,r=t.toString();let s=(r.split(".")[1]||"").length;if(s===0&&/\d?e-\d?/.test(r)){const a=r.match(/\d?e-(\d?)/);a?.[1]&&(s=Number.parseInt(a[1]))}const i=n>s?n:s,o=Number.parseInt(e.toFixed(i).replace(".","")),c=Number.parseInt(t.toFixed(i).replace(".",""));return o%c/10**i}const Lb=Symbol("evaluating");function $e(e,t,n){let r;Object.defineProperty(e,t,{get(){if(r!==Lb)return r===void 0&&(r=Lb,r=n()),r},set(s){Object.defineProperty(e,t,{value:s})},configurable:!0})}function ci(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function ui(...e){const t={};for(const n of e){const r=Object.getOwnPropertyDescriptors(n);Object.assign(t,r)}return Object.defineProperties({},t)}function Db(e){return JSON.stringify(e)}function g6(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const uD="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function $l(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const A6=QT(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function Jc(e){if($l(e)===!1)return!1;const t=e.constructor;if(t===void 0||typeof t!="function")return!0;const n=t.prototype;return!($l(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}function lD(e){return Jc(e)?{...e}:Array.isArray(e)?[...e]:e}const R6=new Set(["string","number","symbol"]);function qi(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function qr(e,t,n){const r=new e._zod.constr(t??e._zod.def);return(!t||n?.parent)&&(r._zod.parent=e),r}function Se(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function y6(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const N6={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function O6(e,t){const n=e._zod.def,r=ui(e._zod.def,{get shape(){const s={};for(const i in t){if(!(i in n.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&(s[i]=n.shape[i])}return ci(this,"shape",s),s},checks:[]});return qr(e,r)}function b6(e,t){const n=e._zod.def,r=ui(e._zod.def,{get shape(){const s={...e._zod.def.shape};for(const i in t){if(!(i in n.shape))throw new Error(`Unrecognized key: "${i}"`);t[i]&&delete s[i]}return ci(this,"shape",s),s},checks:[]});return qr(e,r)}function I6(e,t){if(!Jc(t))throw new Error("Invalid input to extend: expected a plain object");const n=e._zod.def.checks;if(n&&n.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const s=ui(e._zod.def,{get shape(){const i={...e._zod.def.shape,...t};return ci(this,"shape",i),i},checks:[]});return qr(e,s)}function C6(e,t){if(!Jc(t))throw new Error("Invalid input to safeExtend: expected a plain object");const n={...e._zod.def,get shape(){const r={...e._zod.def.shape,...t};return ci(this,"shape",r),r},checks:e._zod.def.checks};return qr(e,n)}function v6(e,t){const n=ui(e._zod.def,{get shape(){const r={...e._zod.def.shape,...t._zod.def.shape};return ci(this,"shape",r),r},get catchall(){return t._zod.def.catchall},checks:[]});return qr(e,n)}function P6(e,t,n){const r=ui(t._zod.def,{get shape(){const s=t._zod.def.shape,i={...s};if(n)for(const o in n){if(!(o in s))throw new Error(`Unrecognized key: "${o}"`);n[o]&&(i[o]=e?new e({type:"optional",innerType:s[o]}):s[o])}else for(const o in s)i[o]=e?new e({type:"optional",innerType:s[o]}):s[o];return ci(this,"shape",i),i},checks:[]});return qr(t,r)}function M6(e,t,n){const r=ui(t._zod.def,{get shape(){const s=t._zod.def.shape,i={...s};if(n)for(const o in n){if(!(o in i))throw new Error(`Unrecognized key: "${o}"`);n[o]&&(i[o]=new e({type:"nonoptional",innerType:s[o]}))}else for(const o in s)i[o]=new e({type:"nonoptional",innerType:s[o]});return ci(this,"shape",i),i},checks:[]});return qr(t,r)}function Oi(e,t=0){if(e.aborted===!0)return!0;for(let n=t;n<e.issues.length;n++)if(e.issues[n]?.continue!==!0)return!0;return!1}function dD(e,t){return t.map(n=>{var r;return(r=n).path??(r.path=[]),n.path.unshift(e),n})}function Gu(e){return typeof e=="string"?e:e?.message}function ti(e,t,n){const r={...e,path:e.path??[]};if(!e.message){const s=Gu(e.inst?._zod.def?.error?.(e))??Gu(t?.error?.(e))??Gu(n.customError?.(e))??Gu(n.localeError?.(e))??"Invalid input";r.message=s}return delete r.inst,delete r.continue,t?.reportInput||delete r.input,r}function tS(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function eu(...e){const[t,n,r]=e;return typeof t=="string"?{message:t,code:"custom",input:n,inst:r}:{...t}}const fD=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,yE,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},_D=Z("$ZodError",fD),pD=Z("$ZodError",fD,{Parent:Error});function w6(e,t=n=>n.message){const n={},r=[];for(const s of e.issues)s.path.length>0?(n[s.path[0]]=n[s.path[0]]||[],n[s.path[0]].push(t(s))):r.push(t(s));return{formErrors:r,fieldErrors:n}}function L6(e,t=n=>n.message){const n={_errors:[]},r=s=>{for(const i of s.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(o=>r({issues:o}));else if(i.code==="invalid_key")r({issues:i.issues});else if(i.code==="invalid_element")r({issues:i.issues});else if(i.path.length===0)n._errors.push(t(i));else{let o=n,c=0;for(;c<i.path.length;){const a=i.path[c];c===i.path.length-1?(o[a]=o[a]||{_errors:[]},o[a]._errors.push(t(i))):o[a]=o[a]||{_errors:[]},o=o[a],c++}}};return r(e),n}const nS=e=>(t,n,r,s)=>{const i=r?Object.assign(r,{async:!1}):{async:!1},o=t._zod.run({value:n,issues:[]},i);if(o instanceof Promise)throw new Ui;if(o.issues.length){const c=new(s?.Err??e)(o.issues.map(a=>ti(a,i,ei())));throw uD(c,s?.callee),c}return o.value},rS=e=>async(t,n,r,s)=>{const i=r?Object.assign(r,{async:!0}):{async:!0};let o=t._zod.run({value:n,issues:[]},i);if(o instanceof Promise&&(o=await o),o.issues.length){const c=new(s?.Err??e)(o.issues.map(a=>ti(a,i,ei())));throw uD(c,s?.callee),c}return o.value},xd=e=>(t,n,r)=>{const s=r?{...r,async:!1}:{async:!1},i=t._zod.run({value:n,issues:[]},s);if(i instanceof Promise)throw new Ui;return i.issues.length?{success:!1,error:new(e??_D)(i.issues.map(o=>ti(o,s,ei())))}:{success:!0,data:i.value}},D6=xd(pD),Bd=e=>async(t,n,r)=>{const s=r?Object.assign(r,{async:!0}):{async:!0};let i=t._zod.run({value:n,issues:[]},s);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new e(i.issues.map(o=>ti(o,s,ei())))}:{success:!0,data:i.value}},U6=Bd(pD),k6=e=>(t,n,r)=>{const s=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return nS(e)(t,n,s)},x6=e=>(t,n,r)=>nS(e)(t,n,r),B6=e=>async(t,n,r)=>{const s=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return rS(e)(t,n,s)},G6=e=>async(t,n,r)=>rS(e)(t,n,r),V6=e=>(t,n,r)=>{const s=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return xd(e)(t,n,s)},$6=e=>(t,n,r)=>xd(e)(t,n,r),H6=e=>async(t,n,r)=>{const s=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return Bd(e)(t,n,s)},F6=e=>async(t,n,r)=>Bd(e)(t,n,r),j6=/^[cC][^\s-]{8,}$/,q6=/^[0-9a-z]+$/,Y6=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,W6=/^[0-9a-vA-V]{20}$/,K6=/^[A-Za-z0-9]{27}$/,z6=/^[a-zA-Z0-9_-]{21}$/,Z6=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,X6=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,Ub=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,Q6=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,J6="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function e5(){return new RegExp(J6,"u")}const t5=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,n5=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,r5=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,s5=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,i5=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,hD=/^[A-Za-z0-9_-]*$/,o5=/^\+(?:[0-9]){6,14}[0-9]$/,ED="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",a5=new RegExp(`^${ED}$`);function TD(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function c5(e){return new RegExp(`^${TD(e)}$`)}function u5(e){const t=TD({precision:e.precision}),n=["Z"];e.local&&n.push(""),e.offset&&n.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const r=`${t}(?:${n.join("|")})`;return new RegExp(`^${ED}T(?:${r})$`)}const l5=e=>{const t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},d5=/^-?\d+$/,f5=/^-?\d+(?:\.\d+)?/,_5=/^[^A-Z]*$/,p5=/^[^a-z]*$/,Gt=Z("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),SD={number:"number",bigint:"bigint",object:"date"},mD=Z("$ZodCheckLessThan",(e,t)=>{Gt.init(e,t);const n=SD[typeof t.value];e._zod.onattach.push(r=>{const s=r._zod.bag,i=(t.inclusive?s.maximum:s.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<i&&(t.inclusive?s.maximum=t.value:s.exclusiveMaximum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value<=t.value:r.value<t.value)||r.issues.push({origin:n,code:"too_big",maximum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),gD=Z("$ZodCheckGreaterThan",(e,t)=>{Gt.init(e,t);const n=SD[typeof t.value];e._zod.onattach.push(r=>{const s=r._zod.bag,i=(t.inclusive?s.minimum:s.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>i&&(t.inclusive?s.minimum=t.value:s.exclusiveMinimum=t.value)}),e._zod.check=r=>{(t.inclusive?r.value>=t.value:r.value>t.value)||r.issues.push({origin:n,code:"too_small",minimum:t.value,input:r.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),h5=Z("$ZodCheckMultipleOf",(e,t)=>{Gt.init(e,t),e._zod.onattach.push(n=>{var r;(r=n._zod.bag).multipleOf??(r.multipleOf=t.value)}),e._zod.check=n=>{if(typeof n.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%t.value===BigInt(0):m6(n.value,t.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:t.value,input:n.value,inst:e,continue:!t.abort})}}),E5=Z("$ZodCheckNumberFormat",(e,t)=>{Gt.init(e,t),t.format=t.format||"float64";const n=t.format?.includes("int"),r=n?"int":"number",[s,i]=N6[t.format];e._zod.onattach.push(o=>{const c=o._zod.bag;c.format=t.format,c.minimum=s,c.maximum=i,n&&(c.pattern=d5)}),e._zod.check=o=>{const c=o.value;if(n){if(!Number.isInteger(c)){o.issues.push({expected:r,format:t.format,code:"invalid_type",continue:!1,input:c,inst:e});return}if(!Number.isSafeInteger(c)){c>0?o.issues.push({input:c,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort}):o.issues.push({input:c,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:r,continue:!t.abort});return}}c<s&&o.issues.push({origin:"number",input:c,code:"too_small",minimum:s,inclusive:!0,inst:e,continue:!t.abort}),c>i&&o.issues.push({origin:"number",input:c,code:"too_big",maximum:i,inst:e})}}),T5=Z("$ZodCheckMaxLength",(e,t)=>{var n;Gt.init(e,t),(n=e._zod.def).when??(n.when=r=>{const s=r.value;return!JT(s)&&s.length!==void 0}),e._zod.onattach.push(r=>{const s=r._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<s&&(r._zod.bag.maximum=t.maximum)}),e._zod.check=r=>{const s=r.value;if(s.length<=t.maximum)return;const o=tS(s);r.issues.push({origin:o,code:"too_big",maximum:t.maximum,inclusive:!0,input:s,inst:e,continue:!t.abort})}}),S5=Z("$ZodCheckMinLength",(e,t)=>{var n;Gt.init(e,t),(n=e._zod.def).when??(n.when=r=>{const s=r.value;return!JT(s)&&s.length!==void 0}),e._zod.onattach.push(r=>{const s=r._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>s&&(r._zod.bag.minimum=t.minimum)}),e._zod.check=r=>{const s=r.value;if(s.length>=t.minimum)return;const o=tS(s);r.issues.push({origin:o,code:"too_small",minimum:t.minimum,inclusive:!0,input:s,inst:e,continue:!t.abort})}}),m5=Z("$ZodCheckLengthEquals",(e,t)=>{var n;Gt.init(e,t),(n=e._zod.def).when??(n.when=r=>{const s=r.value;return!JT(s)&&s.length!==void 0}),e._zod.onattach.push(r=>{const s=r._zod.bag;s.minimum=t.length,s.maximum=t.length,s.length=t.length}),e._zod.check=r=>{const s=r.value,i=s.length;if(i===t.length)return;const o=tS(s),c=i>t.length;r.issues.push({origin:o,...c?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:r.value,inst:e,continue:!t.abort})}}),Gd=Z("$ZodCheckStringFormat",(e,t)=>{var n,r;Gt.init(e,t),e._zod.onattach.push(s=>{const i=s._zod.bag;i.format=t.format,t.pattern&&(i.patterns??(i.patterns=new Set),i.patterns.add(t.pattern))}),t.pattern?(n=e._zod).check??(n.check=s=>{t.pattern.lastIndex=0,!t.pattern.test(s.value)&&s.issues.push({origin:"string",code:"invalid_format",format:t.format,input:s.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(r=e._zod).check??(r.check=()=>{})}),g5=Z("$ZodCheckRegex",(e,t)=>{Gd.init(e,t),e._zod.check=n=>{t.pattern.lastIndex=0,!t.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),A5=Z("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=_5),Gd.init(e,t)}),R5=Z("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=p5),Gd.init(e,t)}),y5=Z("$ZodCheckIncludes",(e,t)=>{Gt.init(e,t);const n=qi(t.includes),r=new RegExp(typeof t.position=="number"?`^.{${t.position}}${n}`:n);t.pattern=r,e._zod.onattach.push(s=>{const i=s._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(r)}),e._zod.check=s=>{s.value.includes(t.includes,t.position)||s.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:s.value,inst:e,continue:!t.abort})}}),N5=Z("$ZodCheckStartsWith",(e,t)=>{Gt.init(e,t);const n=new RegExp(`^${qi(t.prefix)}.*`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const s=r._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),O5=Z("$ZodCheckEndsWith",(e,t)=>{Gt.init(e,t);const n=new RegExp(`.*${qi(t.suffix)}$`);t.pattern??(t.pattern=n),e._zod.onattach.push(r=>{const s=r._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}}),b5=Z("$ZodCheckOverwrite",(e,t)=>{Gt.init(e,t),e._zod.check=n=>{n.value=t.tx(n.value)}});class I5{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const r=t.split(`
`).filter(o=>o),s=Math.min(...r.map(o=>o.length-o.trimStart().length)),i=r.map(o=>o.slice(s)).map(o=>" ".repeat(this.indent*2)+o);for(const o of i)this.content.push(o)}compile(){const t=Function,n=this?.args,s=[...(this?.content??[""]).map(i=>`  ${i}`)];return new t(...n,s.join(`
`))}}const C5={major:4,minor:1,patch:13},st=Z("$ZodType",(e,t)=>{var n;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=C5;const r=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&r.unshift(e);for(const s of r)for(const i of s._zod.onattach)i(e);if(r.length===0)(n=e._zod).deferred??(n.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const s=(o,c,a)=>{let l=Oi(o),f;for(const d of c){if(d._zod.def.when){if(!d._zod.def.when(o))continue}else if(l)continue;const u=o.issues.length,_=d._zod.check(o);if(_ instanceof Promise&&a?.async===!1)throw new Ui;if(f||_ instanceof Promise)f=(f??Promise.resolve()).then(async()=>{await _,o.issues.length!==u&&(l||(l=Oi(o,u)))});else{if(o.issues.length===u)continue;l||(l=Oi(o,u))}}return f?f.then(()=>o):o},i=(o,c,a)=>{if(Oi(o))return o.aborted=!0,o;const l=s(c,r,a);if(l instanceof Promise){if(a.async===!1)throw new Ui;return l.then(f=>e._zod.parse(f,a))}return e._zod.parse(l,a)};e._zod.run=(o,c)=>{if(c.skipChecks)return e._zod.parse(o,c);if(c.direction==="backward"){const l=e._zod.parse({value:o.value,issues:[]},{...c,skipChecks:!0});return l instanceof Promise?l.then(f=>i(f,o,c)):i(l,o,c)}const a=e._zod.parse(o,c);if(a instanceof Promise){if(c.async===!1)throw new Ui;return a.then(l=>s(l,r,c))}return s(a,r,c)}}e["~standard"]={validate:s=>{try{const i=D6(e,s);return i.success?{value:i.data}:{issues:i.error?.issues}}catch{return U6(e,s).then(o=>o.success?{value:o.data}:{issues:o.error?.issues})}},vendor:"zod",version:1}}),sS=Z("$ZodString",(e,t)=>{st.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??l5(e._zod.bag),e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=String(n.value)}catch{}return typeof n.value=="string"||n.issues.push({expected:"string",code:"invalid_type",input:n.value,inst:e}),n}}),We=Z("$ZodStringFormat",(e,t)=>{Gd.init(e,t),sS.init(e,t)}),v5=Z("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=X6),We.init(e,t)}),P5=Z("$ZodUUID",(e,t)=>{if(t.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(r===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=Ub(r))}else t.pattern??(t.pattern=Ub());We.init(e,t)}),M5=Z("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=Q6),We.init(e,t)}),w5=Z("$ZodURL",(e,t)=>{We.init(e,t),e._zod.check=n=>{try{const r=n.value.trim(),s=new URL(r);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(s.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:t.hostname.source,input:n.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(s.protocol.endsWith(":")?s.protocol.slice(0,-1):s.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:n.value,inst:e,continue:!t.abort})),t.normalize?n.value=s.href:n.value=r;return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:e,continue:!t.abort})}}}),L5=Z("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=e5()),We.init(e,t)}),D5=Z("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=z6),We.init(e,t)}),U5=Z("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=j6),We.init(e,t)}),k5=Z("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=q6),We.init(e,t)}),x5=Z("$ZodULID",(e,t)=>{t.pattern??(t.pattern=Y6),We.init(e,t)}),B5=Z("$ZodXID",(e,t)=>{t.pattern??(t.pattern=W6),We.init(e,t)}),G5=Z("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=K6),We.init(e,t)}),V5=Z("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=u5(t)),We.init(e,t)}),$5=Z("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=a5),We.init(e,t)}),H5=Z("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=c5(t)),We.init(e,t)}),F5=Z("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=Z6),We.init(e,t)}),j5=Z("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=t5),We.init(e,t),e._zod.bag.format="ipv4"}),q5=Z("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=n5),We.init(e,t),e._zod.bag.format="ipv6",e._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:e,continue:!t.abort})}}}),Y5=Z("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=r5),We.init(e,t)}),W5=Z("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=s5),We.init(e,t),e._zod.check=n=>{const r=n.value.split("/");try{if(r.length!==2)throw new Error;const[s,i]=r;if(!i)throw new Error;const o=Number(i);if(`${o}`!==i)throw new Error;if(o<0||o>128)throw new Error;new URL(`http://[${s}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:e,continue:!t.abort})}}});function AD(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const K5=Z("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=i5),We.init(e,t),e._zod.bag.contentEncoding="base64",e._zod.check=n=>{AD(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:e,continue:!t.abort})}});function z5(e){if(!hD.test(e))return!1;const t=e.replace(/[-_]/g,r=>r==="-"?"+":"/"),n=t.padEnd(Math.ceil(t.length/4)*4,"=");return AD(n)}const Z5=Z("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=hD),We.init(e,t),e._zod.bag.contentEncoding="base64url",e._zod.check=n=>{z5(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:e,continue:!t.abort})}}),X5=Z("$ZodE164",(e,t)=>{t.pattern??(t.pattern=o5),We.init(e,t)});function Q5(e,t=null){try{const n=e.split(".");if(n.length!==3)return!1;const[r]=n;if(!r)return!1;const s=JSON.parse(atob(r));return!("typ"in s&&s?.typ!=="JWT"||!s.alg||t&&(!("alg"in s)||s.alg!==t))}catch{return!1}}const J5=Z("$ZodJWT",(e,t)=>{We.init(e,t),e._zod.check=n=>{Q5(n.value,t.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:e,continue:!t.abort})}}),RD=Z("$ZodNumber",(e,t)=>{st.init(e,t),e._zod.pattern=e._zod.bag.pattern??f5,e._zod.parse=(n,r)=>{if(t.coerce)try{n.value=Number(n.value)}catch{}const s=n.value;if(typeof s=="number"&&!Number.isNaN(s)&&Number.isFinite(s))return n;const i=typeof s=="number"?Number.isNaN(s)?"NaN":Number.isFinite(s)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:s,inst:e,...i?{received:i}:{}}),n}}),e9=Z("$ZodNumberFormat",(e,t)=>{E5.init(e,t),RD.init(e,t)}),t9=Z("$ZodUnknown",(e,t)=>{st.init(e,t),e._zod.parse=n=>n}),n9=Z("$ZodNever",(e,t)=>{st.init(e,t),e._zod.parse=(n,r)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:e}),n)});function kb(e,t,n){e.issues.length&&t.issues.push(...dD(n,e.issues)),t.value[n]=e.value}const r9=Z("$ZodArray",(e,t)=>{st.init(e,t),e._zod.parse=(n,r)=>{const s=n.value;if(!Array.isArray(s))return n.issues.push({expected:"array",code:"invalid_type",input:s,inst:e}),n;n.value=Array(s.length);const i=[];for(let o=0;o<s.length;o++){const c=s[o],a=t.element._zod.run({value:c,issues:[]},r);a instanceof Promise?i.push(a.then(l=>kb(l,n,o))):kb(a,n,o)}return i.length?Promise.all(i).then(()=>n):n}});function Hl(e,t,n,r){e.issues.length&&t.issues.push(...dD(n,e.issues)),e.value===void 0?n in r&&(t.value[n]=void 0):t.value[n]=e.value}function yD(e){const t=Object.keys(e.shape);for(const r of t)if(!e.shape?.[r]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${r}": expected a Zod schema`);const n=y6(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(n)}}function ND(e,t,n,r,s,i){const o=[],c=s.keySet,a=s.catchall._zod,l=a.def.type;for(const f in t){if(c.has(f))continue;if(l==="never"){o.push(f);continue}const d=a.run({value:t[f],issues:[]},r);d instanceof Promise?e.push(d.then(u=>Hl(u,n,f,t))):Hl(d,n,f,t)}return o.length&&n.issues.push({code:"unrecognized_keys",keys:o,input:t,inst:i}),e.length?Promise.all(e).then(()=>n):n}const s9=Z("$ZodObject",(e,t)=>{if(st.init(e,t),!Object.getOwnPropertyDescriptor(t,"shape")?.get){const c=t.shape;Object.defineProperty(t,"shape",{get:()=>{const a={...c};return Object.defineProperty(t,"shape",{value:a}),a}})}const r=QT(()=>yD(t));$e(e._zod,"propValues",()=>{const c=t.shape,a={};for(const l in c){const f=c[l]._zod;if(f.values){a[l]??(a[l]=new Set);for(const d of f.values)a[l].add(d)}}return a});const s=$l,i=t.catchall;let o;e._zod.parse=(c,a)=>{o??(o=r.value);const l=c.value;if(!s(l))return c.issues.push({expected:"object",code:"invalid_type",input:l,inst:e}),c;c.value={};const f=[],d=o.shape;for(const u of o.keys){const p=d[u]._zod.run({value:l[u],issues:[]},a);p instanceof Promise?f.push(p.then(h=>Hl(h,c,u,l))):Hl(p,c,u,l)}return i?ND(f,l,c,a,r.value,e):f.length?Promise.all(f).then(()=>c):c}}),i9=Z("$ZodObjectJIT",(e,t)=>{s9.init(e,t);const n=e._zod.parse,r=QT(()=>yD(t)),s=u=>{const _=new I5(["shape","payload","ctx"]),p=r.value,h=m=>{const g=Db(m);return`shape[${g}]._zod.run({ value: input[${g}], issues: [] }, ctx)`};_.write("const input = payload.value;");const E=Object.create(null);let T=0;for(const m of p.keys)E[m]=`key_${T++}`;_.write("const newResult = {};");for(const m of p.keys){const g=E[m],y=Db(m);_.write(`const ${g} = ${h(m)};`),_.write(`
        if (${g}.issues.length) {
          payload.issues = payload.issues.concat(${g}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${y}, ...iss.path] : [${y}]
          })));
        }
        
        
        if (${g}.value === undefined) {
          if (${y} in input) {
            newResult[${y}] = undefined;
          }
        } else {
          newResult[${y}] = ${g}.value;
        }
        
      `)}_.write("payload.value = newResult;"),_.write("return payload;");const S=_.compile();return(m,g)=>S(u,m,g)};let i;const o=$l,c=!cD.jitless,l=c&&A6.value,f=t.catchall;let d;e._zod.parse=(u,_)=>{d??(d=r.value);const p=u.value;return o(p)?c&&l&&_?.async===!1&&_.jitless!==!0?(i||(i=s(t.shape)),u=i(u,_),f?ND([],p,u,_,d,e):u):n(u,_):(u.issues.push({expected:"object",code:"invalid_type",input:p,inst:e}),u)}});function xb(e,t,n,r){for(const i of e)if(i.issues.length===0)return t.value=i.value,t;const s=e.filter(i=>!Oi(i));return s.length===1?(t.value=s[0].value,s[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(i=>i.issues.map(o=>ti(o,r,ei())))}),t)}const o9=Z("$ZodUnion",(e,t)=>{st.init(e,t),$e(e._zod,"optin",()=>t.options.some(s=>s._zod.optin==="optional")?"optional":void 0),$e(e._zod,"optout",()=>t.options.some(s=>s._zod.optout==="optional")?"optional":void 0),$e(e._zod,"values",()=>{if(t.options.every(s=>s._zod.values))return new Set(t.options.flatMap(s=>Array.from(s._zod.values)))}),$e(e._zod,"pattern",()=>{if(t.options.every(s=>s._zod.pattern)){const s=t.options.map(i=>i._zod.pattern);return new RegExp(`^(${s.map(i=>eS(i.source)).join("|")})$`)}});const n=t.options.length===1,r=t.options[0]._zod.run;e._zod.parse=(s,i)=>{if(n)return r(s,i);let o=!1;const c=[];for(const a of t.options){const l=a._zod.run({value:s.value,issues:[]},i);if(l instanceof Promise)c.push(l),o=!0;else{if(l.issues.length===0)return l;c.push(l)}}return o?Promise.all(c).then(a=>xb(a,s,e,i)):xb(c,s,e,i)}}),a9=Z("$ZodIntersection",(e,t)=>{st.init(e,t),e._zod.parse=(n,r)=>{const s=n.value,i=t.left._zod.run({value:s,issues:[]},r),o=t.right._zod.run({value:s,issues:[]},r);return i instanceof Promise||o instanceof Promise?Promise.all([i,o]).then(([a,l])=>Bb(n,a,l)):Bb(n,i,o)}});function NE(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(Jc(e)&&Jc(t)){const n=Object.keys(t),r=Object.keys(e).filter(i=>n.indexOf(i)!==-1),s={...e,...t};for(const i of r){const o=NE(e[i],t[i]);if(!o.valid)return{valid:!1,mergeErrorPath:[i,...o.mergeErrorPath]};s[i]=o.data}return{valid:!0,data:s}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let r=0;r<e.length;r++){const s=e[r],i=t[r],o=NE(s,i);if(!o.valid)return{valid:!1,mergeErrorPath:[r,...o.mergeErrorPath]};n.push(o.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function Bb(e,t,n){if(t.issues.length&&e.issues.push(...t.issues),n.issues.length&&e.issues.push(...n.issues),Oi(e))return e;const r=NE(t.value,n.value);if(!r.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(r.mergeErrorPath)}`);return e.value=r.data,e}const c9=Z("$ZodEnum",(e,t)=>{st.init(e,t);const n=S6(t.entries),r=new Set(n);e._zod.values=r,e._zod.pattern=new RegExp(`^(${n.filter(s=>R6.has(typeof s)).map(s=>typeof s=="string"?qi(s):s.toString()).join("|")})$`),e._zod.parse=(s,i)=>{const o=s.value;return r.has(o)||s.issues.push({code:"invalid_value",values:n,input:o,inst:e}),s}}),u9=Z("$ZodLiteral",(e,t)=>{if(st.init(e,t),t.values.length===0)throw new Error("Cannot create literal schema with no valid values");const n=new Set(t.values);e._zod.values=n,e._zod.pattern=new RegExp(`^(${t.values.map(r=>typeof r=="string"?qi(r):r?qi(r.toString()):String(r)).join("|")})$`),e._zod.parse=(r,s)=>{const i=r.value;return n.has(i)||r.issues.push({code:"invalid_value",values:t.values,input:i,inst:e}),r}}),l9=Z("$ZodTransform",(e,t)=>{st.init(e,t),e._zod.parse=(n,r)=>{if(r.direction==="backward")throw new aD(e.constructor.name);const s=t.transform(n.value,n);if(r.async)return(s instanceof Promise?s:Promise.resolve(s)).then(o=>(n.value=o,n));if(s instanceof Promise)throw new Ui;return n.value=s,n}});function Gb(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const d9=Z("$ZodOptional",(e,t)=>{st.init(e,t),e._zod.optin="optional",e._zod.optout="optional",$e(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),$e(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${eS(n.source)})?$`):void 0}),e._zod.parse=(n,r)=>{if(t.innerType._zod.optin==="optional"){const s=t.innerType._zod.run(n,r);return s instanceof Promise?s.then(i=>Gb(i,n.value)):Gb(s,n.value)}return n.value===void 0?n:t.innerType._zod.run(n,r)}}),f9=Z("$ZodNullable",(e,t)=>{st.init(e,t),$e(e._zod,"optin",()=>t.innerType._zod.optin),$e(e._zod,"optout",()=>t.innerType._zod.optout),$e(e._zod,"pattern",()=>{const n=t.innerType._zod.pattern;return n?new RegExp(`^(${eS(n.source)}|null)$`):void 0}),$e(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(n,r)=>n.value===null?n:t.innerType._zod.run(n,r)}),_9=Z("$ZodDefault",(e,t)=>{st.init(e,t),e._zod.optin="optional",$e(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{if(r.direction==="backward")return t.innerType._zod.run(n,r);if(n.value===void 0)return n.value=t.defaultValue,n;const s=t.innerType._zod.run(n,r);return s instanceof Promise?s.then(i=>Vb(i,t)):Vb(s,t)}});function Vb(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const p9=Z("$ZodPrefault",(e,t)=>{st.init(e,t),e._zod.optin="optional",$e(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>(r.direction==="backward"||n.value===void 0&&(n.value=t.defaultValue),t.innerType._zod.run(n,r))}),h9=Z("$ZodNonOptional",(e,t)=>{st.init(e,t),$e(e._zod,"values",()=>{const n=t.innerType._zod.values;return n?new Set([...n].filter(r=>r!==void 0)):void 0}),e._zod.parse=(n,r)=>{const s=t.innerType._zod.run(n,r);return s instanceof Promise?s.then(i=>$b(i,e)):$b(s,e)}});function $b(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const E9=Z("$ZodCatch",(e,t)=>{st.init(e,t),$e(e._zod,"optin",()=>t.innerType._zod.optin),$e(e._zod,"optout",()=>t.innerType._zod.optout),$e(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(n,r)=>{if(r.direction==="backward")return t.innerType._zod.run(n,r);const s=t.innerType._zod.run(n,r);return s instanceof Promise?s.then(i=>(n.value=i.value,i.issues.length&&(n.value=t.catchValue({...n,error:{issues:i.issues.map(o=>ti(o,r,ei()))},input:n.value}),n.issues=[]),n)):(n.value=s.value,s.issues.length&&(n.value=t.catchValue({...n,error:{issues:s.issues.map(i=>ti(i,r,ei()))},input:n.value}),n.issues=[]),n)}}),T9=Z("$ZodPipe",(e,t)=>{st.init(e,t),$e(e._zod,"values",()=>t.in._zod.values),$e(e._zod,"optin",()=>t.in._zod.optin),$e(e._zod,"optout",()=>t.out._zod.optout),$e(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(n,r)=>{if(r.direction==="backward"){const i=t.out._zod.run(n,r);return i instanceof Promise?i.then(o=>Vu(o,t.in,r)):Vu(i,t.in,r)}const s=t.in._zod.run(n,r);return s instanceof Promise?s.then(i=>Vu(i,t.out,r)):Vu(s,t.out,r)}});function Vu(e,t,n){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},n)}const S9=Z("$ZodReadonly",(e,t)=>{st.init(e,t),$e(e._zod,"propValues",()=>t.innerType._zod.propValues),$e(e._zod,"values",()=>t.innerType._zod.values),$e(e._zod,"optin",()=>t.innerType?._zod?.optin),$e(e._zod,"optout",()=>t.innerType?._zod?.optout),e._zod.parse=(n,r)=>{if(r.direction==="backward")return t.innerType._zod.run(n,r);const s=t.innerType._zod.run(n,r);return s instanceof Promise?s.then(Hb):Hb(s)}});function Hb(e){return e.value=Object.freeze(e.value),e}const m9=Z("$ZodCustom",(e,t)=>{Gt.init(e,t),st.init(e,t),e._zod.parse=(n,r)=>n,e._zod.check=n=>{const r=n.value,s=t.fn(r);if(s instanceof Promise)return s.then(i=>Fb(i,n,r,e));Fb(s,n,r,e)}});function Fb(e,t,n,r){if(!e){const s={code:"custom",input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(s.params=r._zod.def.params),t.issues.push(eu(s))}}var jb;class g9{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...n){const r=n[0];if(this._map.set(t,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,t)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const n=this._map.get(t);return n&&typeof n=="object"&&"id"in n&&this._idmap.delete(n.id),this._map.delete(t),this}get(t){const n=t._zod.parent;if(n){const r={...this.get(n)??{}};delete r.id;const s={...r,...this._map.get(t)};return Object.keys(s).length?s:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function A9(){return new g9}(jb=globalThis).__zod_globalRegistry??(jb.__zod_globalRegistry=A9());const $u=globalThis.__zod_globalRegistry;function R9(e,t){return new e({type:"string",...Se(t)})}function y9(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...Se(t)})}function qb(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...Se(t)})}function N9(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...Se(t)})}function O9(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...Se(t)})}function b9(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...Se(t)})}function I9(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...Se(t)})}function C9(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...Se(t)})}function v9(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...Se(t)})}function P9(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...Se(t)})}function M9(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...Se(t)})}function w9(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...Se(t)})}function L9(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...Se(t)})}function D9(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...Se(t)})}function U9(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...Se(t)})}function k9(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...Se(t)})}function x9(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...Se(t)})}function B9(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...Se(t)})}function G9(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...Se(t)})}function V9(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...Se(t)})}function $9(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...Se(t)})}function H9(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...Se(t)})}function F9(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...Se(t)})}function j9(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...Se(t)})}function q9(e,t){return new e({type:"string",format:"date",check:"string_format",...Se(t)})}function Y9(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...Se(t)})}function W9(e,t){return new e({type:"string",format:"duration",check:"string_format",...Se(t)})}function K9(e,t){return new e({type:"number",checks:[],...Se(t)})}function z9(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...Se(t)})}function Z9(e){return new e({type:"unknown"})}function X9(e,t){return new e({type:"never",...Se(t)})}function Yb(e,t){return new mD({check:"less_than",...Se(t),value:e,inclusive:!1})}function P_(e,t){return new mD({check:"less_than",...Se(t),value:e,inclusive:!0})}function Wb(e,t){return new gD({check:"greater_than",...Se(t),value:e,inclusive:!1})}function M_(e,t){return new gD({check:"greater_than",...Se(t),value:e,inclusive:!0})}function Kb(e,t){return new h5({check:"multiple_of",...Se(t),value:e})}function OD(e,t){return new T5({check:"max_length",...Se(t),maximum:e})}function Fl(e,t){return new S5({check:"min_length",...Se(t),minimum:e})}function bD(e,t){return new m5({check:"length_equals",...Se(t),length:e})}function Q9(e,t){return new g5({check:"string_format",format:"regex",...Se(t),pattern:e})}function J9(e){return new A5({check:"string_format",format:"lowercase",...Se(e)})}function e8(e){return new R5({check:"string_format",format:"uppercase",...Se(e)})}function t8(e,t){return new y5({check:"string_format",format:"includes",...Se(t),includes:e})}function n8(e,t){return new N5({check:"string_format",format:"starts_with",...Se(t),prefix:e})}function r8(e,t){return new O5({check:"string_format",format:"ends_with",...Se(t),suffix:e})}function ro(e){return new b5({check:"overwrite",tx:e})}function s8(e){return ro(t=>t.normalize(e))}function i8(){return ro(e=>e.trim())}function o8(){return ro(e=>e.toLowerCase())}function a8(){return ro(e=>e.toUpperCase())}function c8(){return ro(e=>g6(e))}function u8(e,t,n){return new e({type:"array",element:t,...Se(n)})}function l8(e,t,n){return new e({type:"custom",check:"custom",fn:t,...Se(n)})}function d8(e){const t=f8(n=>(n.addIssue=r=>{if(typeof r=="string")n.issues.push(eu(r,n.value,t._zod.def));else{const s=r;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=n.value),s.inst??(s.inst=t),s.continue??(s.continue=!t._zod.def.abort),n.issues.push(eu(s))}},e(n.value,n)));return t}function f8(e,t){const n=new Gt({check:"custom",...Se(t)});return n._zod.check=e,n}const _8=Z("ZodISODateTime",(e,t)=>{V5.init(e,t),Je.init(e,t)});function p8(e){return j9(_8,e)}const h8=Z("ZodISODate",(e,t)=>{$5.init(e,t),Je.init(e,t)});function E8(e){return q9(h8,e)}const T8=Z("ZodISOTime",(e,t)=>{H5.init(e,t),Je.init(e,t)});function S8(e){return Y9(T8,e)}const m8=Z("ZodISODuration",(e,t)=>{F5.init(e,t),Je.init(e,t)});function g8(e){return W9(m8,e)}const A8=(e,t)=>{_D.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:n=>L6(e,n)},flatten:{value:n=>w6(e,n)},addIssue:{value:n=>{e.issues.push(n),e.message=JSON.stringify(e.issues,yE,2)}},addIssues:{value:n=>{e.issues.push(...n),e.message=JSON.stringify(e.issues,yE,2)}},isEmpty:{get(){return e.issues.length===0}}})},ln=Z("ZodError",A8,{Parent:Error}),R8=nS(ln),y8=rS(ln),N8=xd(ln),O8=Bd(ln),b8=k6(ln),I8=x6(ln),C8=B6(ln),v8=G6(ln),P8=V6(ln),M8=$6(ln),w8=H6(ln),L8=F6(ln),ct=Z("ZodType",(e,t)=>(st.init(e,t),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...n)=>e.clone(ui(t,{checks:[...t.checks??[],...n.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]})),e.clone=(n,r)=>qr(e,n,r),e.brand=()=>e,e.register=((n,r)=>(n.add(e,r),e)),e.parse=(n,r)=>R8(e,n,r,{callee:e.parse}),e.safeParse=(n,r)=>N8(e,n,r),e.parseAsync=async(n,r)=>y8(e,n,r,{callee:e.parseAsync}),e.safeParseAsync=async(n,r)=>O8(e,n,r),e.spa=e.safeParseAsync,e.encode=(n,r)=>b8(e,n,r),e.decode=(n,r)=>I8(e,n,r),e.encodeAsync=async(n,r)=>C8(e,n,r),e.decodeAsync=async(n,r)=>v8(e,n,r),e.safeEncode=(n,r)=>P8(e,n,r),e.safeDecode=(n,r)=>M8(e,n,r),e.safeEncodeAsync=async(n,r)=>w8(e,n,r),e.safeDecodeAsync=async(n,r)=>L8(e,n,r),e.refine=(n,r)=>e.check(NX(n,r)),e.superRefine=n=>e.check(OX(n)),e.overwrite=n=>e.check(ro(n)),e.optional=()=>Qb(e),e.nullable=()=>Jb(e),e.nullish=()=>Qb(Jb(e)),e.nonoptional=n=>TX(e,n),e.array=()=>Vd(e),e.or=n=>iX([e,n]),e.and=n=>aX(e,n),e.transform=n=>eI(e,dX(n)),e.default=n=>pX(e,n),e.prefault=n=>EX(e,n),e.catch=n=>mX(e,n),e.pipe=n=>eI(e,n),e.readonly=()=>RX(e),e.describe=n=>{const r=e.clone();return $u.add(r,{description:n}),r},Object.defineProperty(e,"description",{get(){return $u.get(e)?.description},configurable:!0}),e.meta=(...n)=>{if(n.length===0)return $u.get(e);const r=e.clone();return $u.add(r,n[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),ID=Z("_ZodString",(e,t)=>{sS.init(e,t),ct.init(e,t);const n=e._zod.bag;e.format=n.format??null,e.minLength=n.minimum??null,e.maxLength=n.maximum??null,e.regex=(...r)=>e.check(Q9(...r)),e.includes=(...r)=>e.check(t8(...r)),e.startsWith=(...r)=>e.check(n8(...r)),e.endsWith=(...r)=>e.check(r8(...r)),e.min=(...r)=>e.check(Fl(...r)),e.max=(...r)=>e.check(OD(...r)),e.length=(...r)=>e.check(bD(...r)),e.nonempty=(...r)=>e.check(Fl(1,...r)),e.lowercase=r=>e.check(J9(r)),e.uppercase=r=>e.check(e8(r)),e.trim=()=>e.check(i8()),e.normalize=(...r)=>e.check(s8(...r)),e.toLowerCase=()=>e.check(o8()),e.toUpperCase=()=>e.check(a8()),e.slugify=()=>e.check(c8())}),D8=Z("ZodString",(e,t)=>{sS.init(e,t),ID.init(e,t),e.email=n=>e.check(y9(U8,n)),e.url=n=>e.check(C9(k8,n)),e.jwt=n=>e.check(F9(X8,n)),e.emoji=n=>e.check(v9(x8,n)),e.guid=n=>e.check(qb(zb,n)),e.uuid=n=>e.check(N9(Hu,n)),e.uuidv4=n=>e.check(O9(Hu,n)),e.uuidv6=n=>e.check(b9(Hu,n)),e.uuidv7=n=>e.check(I9(Hu,n)),e.nanoid=n=>e.check(P9(B8,n)),e.guid=n=>e.check(qb(zb,n)),e.cuid=n=>e.check(M9(G8,n)),e.cuid2=n=>e.check(w9(V8,n)),e.ulid=n=>e.check(L9($8,n)),e.base64=n=>e.check(V9(K8,n)),e.base64url=n=>e.check($9(z8,n)),e.xid=n=>e.check(D9(H8,n)),e.ksuid=n=>e.check(U9(F8,n)),e.ipv4=n=>e.check(k9(j8,n)),e.ipv6=n=>e.check(x9(q8,n)),e.cidrv4=n=>e.check(B9(Y8,n)),e.cidrv6=n=>e.check(G9(W8,n)),e.e164=n=>e.check(H9(Z8,n)),e.datetime=n=>e.check(p8(n)),e.date=n=>e.check(E8(n)),e.time=n=>e.check(S8(n)),e.duration=n=>e.check(g8(n))});function pt(e){return R9(D8,e)}const Je=Z("ZodStringFormat",(e,t)=>{We.init(e,t),ID.init(e,t)}),U8=Z("ZodEmail",(e,t)=>{M5.init(e,t),Je.init(e,t)}),zb=Z("ZodGUID",(e,t)=>{v5.init(e,t),Je.init(e,t)}),Hu=Z("ZodUUID",(e,t)=>{P5.init(e,t),Je.init(e,t)}),k8=Z("ZodURL",(e,t)=>{w5.init(e,t),Je.init(e,t)}),x8=Z("ZodEmoji",(e,t)=>{L5.init(e,t),Je.init(e,t)}),B8=Z("ZodNanoID",(e,t)=>{D5.init(e,t),Je.init(e,t)}),G8=Z("ZodCUID",(e,t)=>{U5.init(e,t),Je.init(e,t)}),V8=Z("ZodCUID2",(e,t)=>{k5.init(e,t),Je.init(e,t)}),$8=Z("ZodULID",(e,t)=>{x5.init(e,t),Je.init(e,t)}),H8=Z("ZodXID",(e,t)=>{B5.init(e,t),Je.init(e,t)}),F8=Z("ZodKSUID",(e,t)=>{G5.init(e,t),Je.init(e,t)}),j8=Z("ZodIPv4",(e,t)=>{j5.init(e,t),Je.init(e,t)}),q8=Z("ZodIPv6",(e,t)=>{q5.init(e,t),Je.init(e,t)}),Y8=Z("ZodCIDRv4",(e,t)=>{Y5.init(e,t),Je.init(e,t)}),W8=Z("ZodCIDRv6",(e,t)=>{W5.init(e,t),Je.init(e,t)}),K8=Z("ZodBase64",(e,t)=>{K5.init(e,t),Je.init(e,t)}),z8=Z("ZodBase64URL",(e,t)=>{Z5.init(e,t),Je.init(e,t)}),Z8=Z("ZodE164",(e,t)=>{X5.init(e,t),Je.init(e,t)}),X8=Z("ZodJWT",(e,t)=>{J5.init(e,t),Je.init(e,t)}),CD=Z("ZodNumber",(e,t)=>{RD.init(e,t),ct.init(e,t),e.gt=(r,s)=>e.check(Wb(r,s)),e.gte=(r,s)=>e.check(M_(r,s)),e.min=(r,s)=>e.check(M_(r,s)),e.lt=(r,s)=>e.check(Yb(r,s)),e.lte=(r,s)=>e.check(P_(r,s)),e.max=(r,s)=>e.check(P_(r,s)),e.int=r=>e.check(Zb(r)),e.safe=r=>e.check(Zb(r)),e.positive=r=>e.check(Wb(0,r)),e.nonnegative=r=>e.check(M_(0,r)),e.negative=r=>e.check(Yb(0,r)),e.nonpositive=r=>e.check(P_(0,r)),e.multipleOf=(r,s)=>e.check(Kb(r,s)),e.step=(r,s)=>e.check(Kb(r,s)),e.finite=()=>e;const n=e._zod.bag;e.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),e.isFinite=!0,e.format=n.format??null});function Vc(e){return K9(CD,e)}const Q8=Z("ZodNumberFormat",(e,t)=>{e9.init(e,t),CD.init(e,t)});function Zb(e){return z9(Q8,e)}const J8=Z("ZodUnknown",(e,t)=>{t9.init(e,t),ct.init(e,t)});function Xb(){return Z9(J8)}const eX=Z("ZodNever",(e,t)=>{n9.init(e,t),ct.init(e,t)});function tX(e){return X9(eX,e)}const nX=Z("ZodArray",(e,t)=>{r9.init(e,t),ct.init(e,t),e.element=t.element,e.min=(n,r)=>e.check(Fl(n,r)),e.nonempty=n=>e.check(Fl(1,n)),e.max=(n,r)=>e.check(OD(n,r)),e.length=(n,r)=>e.check(bD(n,r)),e.unwrap=()=>e.element});function Vd(e,t){return u8(nX,e,t)}const rX=Z("ZodObject",(e,t)=>{i9.init(e,t),ct.init(e,t),$e(e,"shape",()=>t.shape),e.keyof=()=>tu(Object.keys(e._zod.def.shape)),e.catchall=n=>e.clone({...e._zod.def,catchall:n}),e.passthrough=()=>e.clone({...e._zod.def,catchall:Xb()}),e.loose=()=>e.clone({...e._zod.def,catchall:Xb()}),e.strict=()=>e.clone({...e._zod.def,catchall:tX()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=n=>I6(e,n),e.safeExtend=n=>C6(e,n),e.merge=n=>v6(e,n),e.pick=n=>O6(e,n),e.omit=n=>b6(e,n),e.partial=(...n)=>P6(vD,e,n[0]),e.required=(...n)=>M6(PD,e,n[0])});function gr(e,t){const n={type:"object",shape:e??{},...Se(t)};return new rX(n)}const sX=Z("ZodUnion",(e,t)=>{o9.init(e,t),ct.init(e,t),e.options=t.options});function iX(e,t){return new sX({type:"union",options:e,...Se(t)})}const oX=Z("ZodIntersection",(e,t)=>{a9.init(e,t),ct.init(e,t)});function aX(e,t){return new oX({type:"intersection",left:e,right:t})}const OE=Z("ZodEnum",(e,t)=>{c9.init(e,t),ct.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const n=new Set(Object.keys(t.entries));e.extract=(r,s)=>{const i={};for(const o of r)if(n.has(o))i[o]=t.entries[o];else throw new Error(`Key ${o} not found in enum`);return new OE({...t,checks:[],...Se(s),entries:i})},e.exclude=(r,s)=>{const i={...t.entries};for(const o of r)if(n.has(o))delete i[o];else throw new Error(`Key ${o} not found in enum`);return new OE({...t,checks:[],...Se(s),entries:i})}});function tu(e,t){const n=Array.isArray(e)?Object.fromEntries(e.map(r=>[r,r])):e;return new OE({type:"enum",entries:n,...Se(t)})}const cX=Z("ZodLiteral",(e,t)=>{u9.init(e,t),ct.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function uX(e,t){return new cX({type:"literal",values:Array.isArray(e)?e:[e],...Se(t)})}const lX=Z("ZodTransform",(e,t)=>{l9.init(e,t),ct.init(e,t),e._zod.parse=(n,r)=>{if(r.direction==="backward")throw new aD(e.constructor.name);n.addIssue=i=>{if(typeof i=="string")n.issues.push(eu(i,n.value,t));else{const o=i;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=n.value),o.inst??(o.inst=e),n.issues.push(eu(o))}};const s=t.transform(n.value,n);return s instanceof Promise?s.then(i=>(n.value=i,n)):(n.value=s,n)}});function dX(e){return new lX({type:"transform",transform:e})}const vD=Z("ZodOptional",(e,t)=>{d9.init(e,t),ct.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Qb(e){return new vD({type:"optional",innerType:e})}const fX=Z("ZodNullable",(e,t)=>{f9.init(e,t),ct.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Jb(e){return new fX({type:"nullable",innerType:e})}const _X=Z("ZodDefault",(e,t)=>{_9.init(e,t),ct.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function pX(e,t){return new _X({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():lD(t)}})}const hX=Z("ZodPrefault",(e,t)=>{p9.init(e,t),ct.init(e,t),e.unwrap=()=>e._zod.def.innerType});function EX(e,t){return new hX({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():lD(t)}})}const PD=Z("ZodNonOptional",(e,t)=>{h9.init(e,t),ct.init(e,t),e.unwrap=()=>e._zod.def.innerType});function TX(e,t){return new PD({type:"nonoptional",innerType:e,...Se(t)})}const SX=Z("ZodCatch",(e,t)=>{E9.init(e,t),ct.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function mX(e,t){return new SX({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const gX=Z("ZodPipe",(e,t)=>{T9.init(e,t),ct.init(e,t),e.in=t.in,e.out=t.out});function eI(e,t){return new gX({type:"pipe",in:e,out:t})}const AX=Z("ZodReadonly",(e,t)=>{S9.init(e,t),ct.init(e,t),e.unwrap=()=>e._zod.def.innerType});function RX(e){return new AX({type:"readonly",innerType:e})}const yX=Z("ZodCustom",(e,t)=>{m9.init(e,t),ct.init(e,t)});function NX(e,t={}){return l8(yX,e,t)}function OX(e){return d8(e)}const bX=tu(["ACTIVE","PAUSED","DELETED"]),IX=tu(["worktree","local"]);gr({version:Vc().optional(),id:pt(),name:pt(),prompt:pt(),status:bX,rrule:pt().optional(),execution_environment:IX.optional(),cwds:Vd(pt()),created_at:Vc(),updated_at:Vc()});const CX={Dev:"dev",Agent:"agent",InternalAlpha:"internal-alpha",PublicBeta:"public-beta",Prod:"prod"},vX=Object.values(CX);vX.join(", ");function xe(e){return e==null?!1:e.kind==="ssh"||e.kind==="brix"}const PX="codex.localEnvironmentConfigPath",MX="__none__",wX=["tool","run","debug","test"],LX=["darwin","linux","win32"],DX=gr({name:pt(),icon:tu(wX).nullable().catch(null),command:pt(),platform:tu(LX).optional()}),w_=gr({script:pt()}),UX=gr({script:pt(),darwin:w_.optional(),linux:w_.optional(),win32:w_.optional()}),kX=gr({version:Vc().int().min(1).default(1),name:pt(),setup:UX,actions:Vd(DX).optional()}),xX={error:!0,"thread/started":!0,"thread/name/updated":!1,"thread/tokenUsage/updated":!0,"turn/started":!0,"turn/completed":!0,"turn/diff/updated":!0,"turn/plan/updated":!0,"item/started":!0,"item/completed":!0,"rawResponseItem/completed":!1,"item/agentMessage/delta":!0,"item/plan/delta":!0,"item/commandExecution/outputDelta":!0,"item/commandExecution/terminalInteraction":!1,"item/fileChange/outputDelta":!0,"item/mcpToolCall/progress":!0,"mcpServer/oauthLogin/completed":!0,"account/updated":!0,"account/rateLimits/updated":!0,"app/list/updated":!0,"item/reasoning/summaryTextDelta":!0,"item/reasoning/summaryPartAdded":!0,"item/reasoning/textDelta":!0,"thread/compacted":!1,deprecationNotice:!0,configWarning:!0,"windows/worldWritableWarning":!1,"account/login/completed":!0,"model/rerouted":!0,authStatusChange:!1,loginChatGptComplete:!1,sessionConfigured:!1,"codex/event/session_configured":!1,"codex/event/task_started":!1,"codex/event/agent_reasoning":!1,"codex/event/agent_message":!1,"codex/event/task_complete":!1,"codex/event/mcp_tool_call_begin":!1,"codex/event/mcp_tool_call_end":!1,"codex/event/exec_command_begin":!1,"codex/event/exec_command_end":!1,"codex/event/exec_command_output_delta":!1,"codex/event/exec_approval_request":!1,"codex/event/apply_patch_approval_request":!1,"codex/event/background_event":!1,"codex/event/turn_diff":!1,"codex/event/get_history_entry_response":!1,"codex/event/agent_reasoning_delta":!1,"codex/event/agent_reasoning_section_break":!1,"codex/event/agent_message_delta":!1,"codex/event/stream_error":!1,"codex/event/error":!1,"codex/event/turn_aborted":!1,"codex/event/plan_delta":!1,"codex/event/plan_update":!1,"codex/event/patch_apply_begin":!1,"codex/event/patch_apply_end":!1,"codex/event/item_started":!1,"codex/event/item_completed":!1,"codex/event/user_message":!1,"codex/event/agent_reasoning_raw_content":!1,"codex/event/agent_reasoning_raw_content_delta":!1,"codex/event/web_search_begin":!1,"codex/event/web_search_end":!1,"codex/event/mcp_list_tools_response":!1,"codex/event/list_skills_response":!1,"codex/event/list_remote_skills_response":!1,"codex/event/remote_skill_downloaded":!1,"codex/event/list_custom_prompts_response":!1,"codex/event/raw_response_item":!1,"codex/event/agent_message_content_delta":!1,"codex/event/reasoning_content_delta":!1,"codex/event/reasoning_raw_content_delta":!1,"codex/event/warning":!1,"codex/event/undo_started":!1,"codex/event/undo_completed":!1,"codex/event/shutdown_complete":!1,"codex/event/entered_review_mode":!1,"codex/event/exited_review_mode":!1,"codex/event/view_image_tool_call":!1,"codex/event/mcp_startup_update":!1,"codex/event/mcp_startup_complete":!1,"codex/event/remote_task_created":!1,"codex/event/thread_rolled_back":!1,"codex/event/thread_name_updated":!1,"codex/event/collab_agent_spawn_begin":!1,"codex/event/collab_agent_spawn_end":!1,"codex/event/collab_agent_interaction_begin":!1,"codex/event/collab_agent_interaction_end":!1,"codex/event/collab_resume_begin":!1,"codex/event/collab_resume_end":!1,"codex/event/collab_waiting_begin":!1,"codex/event/collab_waiting_end":!1,"codex/event/collab_close_begin":!1,"codex/event/collab_close_end":!1,"codex/event/elicitation_request":!1,"codex/event/dynamic_tool_call_request":!1,"codex/event/request_user_input":!1,"codex/event/terminal_interaction":!1,"codex/event/token_count":!1,"codex/event/deprecation_notice":!1,"fuzzyFileSearch/sessionUpdated":!0,"fuzzyFileSearch/sessionCompleted":!0,"thread/archived":!0,"thread/unarchived":!0,"thread/status/changed":!0,"windowsSandbox/setupCompleted":!1};Object.entries(xX).filter(([,e])=>!e).map(([e])=>e);function Ee(e){return{type:"ok",value:e}}function hi(e){return{type:"error",error:{message:e instanceof Error?e.message:String(e)}}}const BX="https://17de4aef18bcd467f0a250b004f16737@o33249.ingest.us.sentry.io/4510507758977024",GX="codex-desktop@";function VX(e){return`${GX}${e}`}function $X(e){switch(e){case"dev":case"agent":case"internal-alpha":case"public-beta":return!0;case"prod":return!1}}function HX(e){return $X(e)?1:0}var L_,tI;function FX(){return tI||(tI=1,L_=function(){}),L_}var D_,nI;function li(){if(nI)return D_;nI=1;var e=FX()();return D_=function(t){return t!==e&&t!==null},D_}var U_,rI;function MD(){if(rI)return U_;rI=1;var e=li(),t=Array.prototype.forEach,n=Object.create,r=function(s,i){var o;for(o in s)i[o]=s[o]};return U_=function(s){var i=n(null);return t.call(arguments,function(o){e(o)&&r(Object(o),i)}),i},U_}var k_,sI;function jX(){return sI||(sI=1,k_=function(){var e=Math.sign;return typeof e!="function"?!1:e(10)===1&&e(-20)===-1}),k_}var x_,iI;function qX(){return iI||(iI=1,x_=function(e){return e=Number(e),isNaN(e)||e===0?e:e>0?1:-1}),x_}var B_,oI;function YX(){return oI||(oI=1,B_=jX()()?Math.sign:qX()),B_}var G_,aI;function WX(){if(aI)return G_;aI=1;var e=YX(),t=Math.abs,n=Math.floor;return G_=function(r){return isNaN(r)?0:(r=Number(r),r===0||!isFinite(r)?r:e(r)*n(t(r)))},G_}var V_,cI;function di(){if(cI)return V_;cI=1;var e=WX(),t=Math.max;return V_=function(n){return t(0,e(n))},V_}var $_,uI;function wD(){if(uI)return $_;uI=1;var e=di();return $_=function(t,n,r){var s;return isNaN(t)?(s=n,s>=0?r&&s?s-1:s:1):t===!1?!1:e(t)},$_}var H_,lI;function Yr(){return lI||(lI=1,H_=function(e){if(typeof e!="function")throw new TypeError(e+" is not a function");return e}),H_}var F_,dI;function so(){if(dI)return F_;dI=1;var e=li();return F_=function(t){if(!e(t))throw new TypeError("Cannot use null or undefined");return t},F_}var j_,fI;function KX(){if(fI)return j_;fI=1;var e=Yr(),t=so(),n=Function.prototype.bind,r=Function.prototype.call,s=Object.keys,i=Object.prototype.propertyIsEnumerable;return j_=function(o,c){return function(a,l){var f,d=arguments[2],u=arguments[3];return a=Object(t(a)),e(l),f=s(a),u&&f.sort(typeof u=="function"?n.call(u,a):void 0),typeof o!="function"&&(o=f[o]),r.call(o,f,function(_,p){return i.call(a,_)?r.call(l,d,a[_],_,a,p):c})}},j_}var q_,_I;function $d(){return _I||(_I=1,q_=KX()("forEach")),q_}var pI={},hI;function fi(){return hI||(hI=1),pI}var Y_={exports:{}},W_,EI;function zX(){return EI||(EI=1,W_=function(){var e=Object.assign,t;return typeof e!="function"?!1:(t={foo:"raz"},e(t,{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}),W_}var K_,TI;function ZX(){return TI||(TI=1,K_=function(){try{return Object.keys("primitive"),!0}catch{return!1}}),K_}var z_,SI;function XX(){if(SI)return z_;SI=1;var e=li(),t=Object.keys;return z_=function(n){return t(e(n)?Object(n):n)},z_}var Z_,mI;function QX(){return mI||(mI=1,Z_=ZX()()?Object.keys:XX()),Z_}var X_,gI;function JX(){if(gI)return X_;gI=1;var e=QX(),t=so(),n=Math.max;return X_=function(r,s){var i,o,c=n(arguments.length,2),a;for(r=Object(t(r)),a=function(l){try{r[l]=s[l]}catch(f){i||(i=f)}},o=1;o<c;++o)s=arguments[o],e(s).forEach(a);if(i!==void 0)throw i;return r},X_}var Q_,AI;function LD(){return AI||(AI=1,Q_=zX()()?Object.assign:JX()),Q_}var J_,RI;function eQ(){if(RI)return J_;RI=1;var e=li(),t={function:!0,object:!0};return J_=function(n){return e(n)&&t[typeof n]||!1},J_}var yI;function tQ(){return yI||(yI=1,(function(e){var t=LD(),n=eQ(),r=li(),s=Error.captureStackTrace;e.exports=function(i){var o=new Error(i),c=arguments[1],a=arguments[2];return r(a)||n(c)&&(a=c,c=null),r(a)&&t(o,a),r(c)&&(o.code=c),s&&s(o,e.exports),o}})(Y_)),Y_.exports}var Fu={exports:{}},ep,NI;function DD(){if(NI)return ep;NI=1;var e=so(),t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,s=Object.getOwnPropertySymbols;return ep=function(i,o){var c,a=Object(e(o));if(i=Object(e(i)),r(a).forEach(function(l){try{t(i,l,n(o,l))}catch(f){c=f}}),typeof s=="function"&&s(a).forEach(function(l){try{t(i,l,n(o,l))}catch(f){c=f}}),c!==void 0)throw c;return i},ep}var OI;function UD(){if(OI)return Fu.exports;OI=1;var e=di(),t=function(o,c){return c},n,r,s,i;try{Object.defineProperty(t,"length",{configurable:!0,writable:!1,enumerable:!1,value:1})}catch{}return t.length===1?(n={configurable:!0,writable:!1,enumerable:!1},r=Object.defineProperty,Fu.exports=function(o,c){return c=e(c),o.length===c?o:(n.value=c,r(o,"length",n))}):(i=DD(),s=(function(){var o=[];return function(c){var a,l=0;if(o[c])return o[c];for(a=[];c--;)a.push("a"+(++l).toString(36));return new Function("fn","return function ("+a.join(", ")+") { return fn.apply(this, arguments); };")}})(),Fu.exports=function(o,c){var a;if(c=e(c),o.length===c)return o;a=s(c)(o);try{i(a,o)}catch{}return a}),Fu.exports}var tp={exports:{}},np,bI;function kD(){if(bI)return np;bI=1;var e=void 0;return np=function(t){return t!==e&&t!==null},np}var rp,II;function nQ(){if(II)return rp;II=1;var e=kD(),t={object:!0,function:!0,undefined:!0};return rp=function(n){return e(n)?hasOwnProperty.call(t,typeof n):!1},rp}var sp,CI;function rQ(){if(CI)return sp;CI=1;var e=nQ();return sp=function(t){if(!e(t))return!1;try{return t.constructor?t.constructor.prototype===t:!1}catch{return!1}},sp}var ip,vI;function sQ(){if(vI)return ip;vI=1;var e=rQ();return ip=function(t){if(typeof t!="function"||!hasOwnProperty.call(t,"length"))return!1;try{if(typeof t.length!="number"||typeof t.call!="function"||typeof t.apply!="function")return!1}catch{return!1}return!e(t)},ip}var op,PI;function iQ(){if(PI)return op;PI=1;var e=sQ(),t=/^\s*class[\s{/}]/,n=Function.prototype.toString;return op=function(r){return!(!e(r)||t.test(n.call(r)))},op}var ap,MI;function oQ(){if(MI)return ap;MI=1;var e="razdwatrzy";return ap=function(){return typeof e.contains!="function"?!1:e.contains("dwa")===!0&&e.contains("foo")===!1},ap}var cp,wI;function aQ(){if(wI)return cp;wI=1;var e=String.prototype.indexOf;return cp=function(t){return e.call(this,t,arguments[1])>-1},cp}var up,LI;function cQ(){return LI||(LI=1,up=oQ()()?String.prototype.contains:aQ()),up}var DI;function _i(){if(DI)return tp.exports;DI=1;var e=kD(),t=iQ(),n=LD(),r=MD(),s=cQ(),i=tp.exports=function(o,c){var a,l,f,d,u;return arguments.length<2||typeof o!="string"?(d=c,c=o,o=null):d=arguments[2],e(o)?(a=s.call(o,"c"),l=s.call(o,"e"),f=s.call(o,"w")):(a=f=!0,l=!1),u={value:c,configurable:a,enumerable:l,writable:f},d?n(r(d),u):u};return i.gs=function(o,c,a){var l,f,d,u;return typeof o!="string"?(d=a,a=c,c=o,o=null):d=arguments[3],e(c)?t(c)?e(a)?t(a)||(d=a,a=void 0):a=void 0:(d=c,c=a=void 0):c=void 0,e(o)?(l=s.call(o,"c"),f=s.call(o,"e")):(l=!0,f=!1),u={get:c,set:a,configurable:l,enumerable:f},d?n(r(d),u):u},tp.exports}var ju={exports:{}},UI;function uQ(){return UI||(UI=1,(function(e,t){var n=_i(),r=Yr(),s=Function.prototype.apply,i=Function.prototype.call,o=Object.create,c=Object.defineProperty,a=Object.defineProperties,l=Object.prototype.hasOwnProperty,f={configurable:!0,enumerable:!1,writable:!0},d,u,_,p,h,E,T;d=function(S,m){var g;return r(m),l.call(this,"__ee__")?g=this.__ee__:(g=f.value=o(null),c(this,"__ee__",f),f.value=null),g[S]?typeof g[S]=="object"?g[S].push(m):g[S]=[g[S],m]:g[S]=m,this},u=function(S,m){var g,y;return r(m),y=this,d.call(this,S,g=function(){_.call(y,S,g),s.call(m,this,arguments)}),g.__eeOnceListener__=m,this},_=function(S,m){var g,y,A,N;if(r(m),!l.call(this,"__ee__"))return this;if(g=this.__ee__,!g[S])return this;if(y=g[S],typeof y=="object")for(N=0;A=y[N];++N)(A===m||A.__eeOnceListener__===m)&&(y.length===2?g[S]=y[N?0:1]:y.splice(N,1));else(y===m||y.__eeOnceListener__===m)&&delete g[S];return this},p=function(S){var m,g,y,A,N;if(l.call(this,"__ee__")&&(A=this.__ee__[S],!!A))if(typeof A=="object"){for(g=arguments.length,N=new Array(g-1),m=1;m<g;++m)N[m-1]=arguments[m];for(A=A.slice(),m=0;y=A[m];++m)s.call(y,this,N)}else switch(arguments.length){case 1:i.call(A,this);break;case 2:i.call(A,this,arguments[1]);break;case 3:i.call(A,this,arguments[1],arguments[2]);break;default:for(g=arguments.length,N=new Array(g-1),m=1;m<g;++m)N[m-1]=arguments[m];s.call(A,this,N)}},h={on:d,once:u,off:_,emit:p},E={on:n(d),once:n(u),off:n(_),emit:n(p)},T=a({},E),e.exports=t=function(S){return S==null?o(T):a(Object(S),E)},t.methods=h})(ju,ju.exports)),ju.exports}var lp,kI;function lQ(){return kI||(kI=1,lp=function(){var e=Array.from,t,n;return typeof e!="function"?!1:(t=["raz","dwa"],n=e(t),!!(n&&n!==t&&n[1]==="dwa"))}),lp}var dp,xI;function dQ(){return xI||(xI=1,dp=function(){return typeof globalThis!="object"||!globalThis?!1:globalThis.Array===Array}),dp}var fp,BI;function fQ(){if(BI)return fp;BI=1;var e=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};return fp=(function(){if(this)return this;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return e()}try{return __global__||e()}finally{delete Object.prototype.__global__}})(),fp}var _p,GI;function Hd(){return GI||(GI=1,_p=dQ()()?globalThis:fQ()),_p}var pp,VI;function _Q(){if(VI)return pp;VI=1;var e=Hd(),t={object:!0,symbol:!0};return pp=function(){var n=e.Symbol,r;if(typeof n!="function")return!1;r=n("test symbol");try{String(r)}catch{return!1}return!(!t[typeof n.iterator]||!t[typeof n.toPrimitive]||!t[typeof n.toStringTag])},pp}var hp,$I;function pQ(){return $I||($I=1,hp=function(e){return e?typeof e=="symbol"?!0:!e.constructor||e.constructor.name!=="Symbol"?!1:e[e.constructor.toStringTag]==="Symbol":!1}),hp}var Ep,HI;function xD(){if(HI)return Ep;HI=1;var e=pQ();return Ep=function(t){if(!e(t))throw new TypeError(t+" is not a symbol");return t},Ep}var Tp,FI;function hQ(){if(FI)return Tp;FI=1;var e=_i(),t=Object.create,n=Object.defineProperty,r=Object.prototype,s=t(null);return Tp=function(i){for(var o=0,c,a;s[i+(o||"")];)++o;return i+=o||"",s[i]=!0,c="@@"+i,n(r,c,e.gs(null,function(l){a||(a=!0,n(this,c,e(l)),a=!1)})),c},Tp}var Sp,jI;function EQ(){if(jI)return Sp;jI=1;var e=_i(),t=Hd().Symbol;return Sp=function(n){return Object.defineProperties(n,{hasInstance:e("",t&&t.hasInstance||n("hasInstance")),isConcatSpreadable:e("",t&&t.isConcatSpreadable||n("isConcatSpreadable")),iterator:e("",t&&t.iterator||n("iterator")),match:e("",t&&t.match||n("match")),replace:e("",t&&t.replace||n("replace")),search:e("",t&&t.search||n("search")),species:e("",t&&t.species||n("species")),split:e("",t&&t.split||n("split")),toPrimitive:e("",t&&t.toPrimitive||n("toPrimitive")),toStringTag:e("",t&&t.toStringTag||n("toStringTag")),unscopables:e("",t&&t.unscopables||n("unscopables"))})},Sp}var mp,qI;function TQ(){if(qI)return mp;qI=1;var e=_i(),t=xD(),n=Object.create(null);return mp=function(r){return Object.defineProperties(r,{for:e(function(s){return n[s]?n[s]:n[s]=r(String(s))}),keyFor:e(function(s){var i;t(s);for(i in n)if(n[i]===s)return i})})},mp}var gp,YI;function SQ(){if(YI)return gp;YI=1;var e=_i(),t=xD(),n=Hd().Symbol,r=hQ(),s=EQ(),i=TQ(),o=Object.create,c=Object.defineProperties,a=Object.defineProperty,l,f,d;if(typeof n=="function")try{String(n()),d=!0}catch{}else n=null;return f=function(_){if(this instanceof f)throw new TypeError("Symbol is not a constructor");return l(_)},gp=l=function u(_){var p;if(this instanceof u)throw new TypeError("Symbol is not a constructor");return d?n(_):(p=o(f.prototype),_=_===void 0?"":String(_),c(p,{__description__:e("",_),__name__:e("",r(_))}))},s(l),i(l),c(f.prototype,{constructor:e(l),toString:e("",function(){return this.__name__})}),c(l.prototype,{toString:e(function(){return"Symbol ("+t(this).__description__+")"}),valueOf:e(function(){return t(this)})}),a(l.prototype,l.toPrimitive,e("",function(){var u=t(this);return typeof u=="symbol"?u:u.toString()})),a(l.prototype,l.toStringTag,e("c","Symbol")),a(f.prototype,l.toStringTag,e("c",l.prototype[l.toStringTag])),a(f.prototype,l.toPrimitive,e("c",l.prototype[l.toPrimitive])),gp}var Ap,WI;function mQ(){return WI||(WI=1,Ap=_Q()()?Hd().Symbol:SQ()),Ap}var Rp,KI;function gQ(){if(KI)return Rp;KI=1;var e=Object.prototype.toString,t=e.call((function(){return arguments})());return Rp=function(n){return e.call(n)===t},Rp}var yp,zI;function AQ(){if(zI)return yp;zI=1;var e=Object.prototype.toString,t=RegExp.prototype.test.bind(/^[object [A-Za-z0-9]*Function]$/);return yp=function(n){return typeof n=="function"&&t(e.call(n))},yp}var Np,ZI;function RQ(){if(ZI)return Np;ZI=1;var e=Object.prototype.toString,t=e.call("");return Np=function(n){return typeof n=="string"||n&&typeof n=="object"&&(n instanceof String||e.call(n)===t)||!1},Np}var Op,XI;function yQ(){if(XI)return Op;XI=1;var e=mQ().iterator,t=gQ(),n=AQ(),r=di(),s=Yr(),i=so(),o=li(),c=RQ(),a=Array.isArray,l=Function.prototype.call,f={configurable:!0,enumerable:!0,writable:!0,value:null},d=Object.defineProperty;return Op=function(u){var _=arguments[1],p=arguments[2],h,E,T,S,m,g,y,A,N,O;if(u=Object(i(u)),o(_)&&s(_),!this||this===Array||!n(this)){if(!_){if(t(u))return m=u.length,m!==1?Array.apply(null,u):(S=new Array(1),S[0]=u[0],S);if(a(u)){for(S=new Array(m=u.length),E=0;E<m;++E)S[E]=u[E];return S}}S=[]}else h=this;if(!a(u)){if((N=u[e])!==void 0){for(y=s(N).call(u),h&&(S=new h),A=y.next(),E=0;!A.done;)O=_?l.call(_,p,A.value,E):A.value,h?(f.value=O,d(S,E,f)):S[E]=O,A=y.next(),++E;m=E}else if(c(u)){for(m=u.length,h&&(S=new h),E=0,T=0;E<m;++E)O=u[E],E+1<m&&(g=O.charCodeAt(0),g>=55296&&g<=56319&&(O+=u[++E])),O=_?l.call(_,p,O,T):O,h?(f.value=O,d(S,T,f)):S[T]=O,++T;m=T}}if(m===void 0)for(m=r(u.length),h&&(S=new h(m)),E=0;E<m;++E)O=_?l.call(_,p,u[E],E):u[E],h?(f.value=O,d(S,E,f)):S[E]=O;return h&&(f.value=null,S.length=m),S},Op}var bp,QI;function iS(){return QI||(QI=1,bp=lQ()()?Array.from:yQ()),bp}var Ip,JI;function NQ(){if(JI)return Ip;JI=1;var e=iS(),t=Array.isArray;return Ip=function(n){return t(n)?n:e(n)},Ip}var Cp,eC;function OQ(){if(eC)return Cp;eC=1;var e=NQ(),t=li(),n=Yr(),r=Array.prototype.slice,s;return s=function(i){return this.map(function(o,c){return o?o(i[c]):i[c]}).concat(r.call(i,this.length))},Cp=function(i){return i=e(i),i.forEach(function(o){t(o)&&n(o)}),s.bind(i)},Cp}var vp,tC;function bQ(){if(tC)return vp;tC=1;var e=Yr();return vp=function(t){var n;return typeof t=="function"?{set:t,get:t}:(n={get:e(t.get)},t.set!==void 0?(n.set=e(t.set),t.delete&&(n.delete=e(t.delete)),t.clear&&(n.clear=e(t.clear)),n):(n.set=n.get,n))},vp}var Pp,nC;function IQ(){if(nC)return Pp;nC=1;var e=tQ(),t=UD(),n=_i(),r=uQ().methods,s=OQ(),i=bQ(),o=Function.prototype.apply,c=Function.prototype.call,a=Object.create,l=Object.defineProperties,f=r.on,d=r.emit;return Pp=function(u,_,p){var h=a(null),E,T,S,m,g,y,A,N,O,b,C,w,k,U,M;return _!==!1?T=_:isNaN(u.length)?T=1:T=u.length,p.normalizer&&(b=i(p.normalizer),S=b.get,m=b.set,g=b.delete,y=b.clear),p.resolvers!=null&&(M=s(p.resolvers)),S?U=t(function(F){var v,L,H=arguments;if(M&&(H=M(H)),v=S(H),v!==null&&hasOwnProperty.call(h,v))return C&&E.emit("get",v,H,this),h[v];if(H.length===1?L=c.call(u,this,H[0]):L=o.call(u,this,H),v===null){if(v=S(H),v!==null)throw e("Circular invocation","CIRCULAR_INVOCATION");v=m(H)}else if(hasOwnProperty.call(h,v))throw e("Circular invocation","CIRCULAR_INVOCATION");return h[v]=L,w&&E.emit("set",v,null,L),L},T):_===0?U=function(){var F;if(hasOwnProperty.call(h,"data"))return C&&E.emit("get","data",arguments,this),h.data;if(arguments.length?F=o.call(u,this,arguments):F=c.call(u,this),hasOwnProperty.call(h,"data"))throw e("Circular invocation","CIRCULAR_INVOCATION");return h.data=F,w&&E.emit("set","data",null,F),F}:U=function(F){var v,L=arguments,H;if(M&&(L=M(arguments)),H=String(L[0]),hasOwnProperty.call(h,H))return C&&E.emit("get",H,L,this),h[H];if(L.length===1?v=c.call(u,this,L[0]):v=o.call(u,this,L),hasOwnProperty.call(h,H))throw e("Circular invocation","CIRCULAR_INVOCATION");return h[H]=v,w&&E.emit("set",H,null,v),v},E={original:u,memoized:U,profileName:p.profileName,get:function(F){return M&&(F=M(F)),S?S(F):String(F[0])},has:function(F){return hasOwnProperty.call(h,F)},delete:function(F){var v;hasOwnProperty.call(h,F)&&(g&&g(F),v=h[F],delete h[F],k&&E.emit("delete",F,v))},clear:function(){var F=h;y&&y(),h=a(null),E.emit("clear",F)},on:function(F,v){return F==="get"?C=!0:F==="set"?w=!0:F==="delete"&&(k=!0),f.call(this,F,v)},emit:d,updateEnv:function(){u=E.original}},S?A=t(function(F){var v,L=arguments;M&&(L=M(L)),v=S(L),v!==null&&E.delete(v)},T):_===0?A=function(){return E.delete("data")}:A=function(F){return M&&(F=M(arguments)[0]),E.delete(F)},N=t(function(){var F,v=arguments;return _===0?h.data:(M&&(v=M(v)),S?F=S(v):F=String(v[0]),h[F])}),O=t(function(){var F,v=arguments;return _===0?E.has("data"):(M&&(v=M(v)),S?F=S(v):F=String(v[0]),F===null?!1:E.has(F))}),l(U,{__memoized__:n(!0),delete:n(A),clear:n(E.clear),_get:n(N),_has:n(O)}),E},Pp}var Mp,rC;function CQ(){if(rC)return Mp;rC=1;var e=Yr(),t=$d(),n=fi(),r=IQ(),s=wD();return Mp=function i(o){var c,a,l;if(e(o),c=Object(arguments[1]),c.async&&c.promise)throw new Error("Options 'async' and 'promise' cannot be used together");return hasOwnProperty.call(o,"__memoized__")&&!c.force?o:(a=s(c.length,o.length,c.async&&n.async),l=r(o,a,c),t(n,function(f,d){c[d]&&f(c[d],l,c)}),i.__profiler__&&i.__profiler__(l),l.updateEnv(),l.memoized)},Mp}var wp,sC;function vQ(){return sC||(sC=1,wp=function(e){var t,n,r=e.length;if(!r)return"";for(t=String(e[n=0]);--r;)t+=""+e[++n];return t}),wp}var Lp,iC;function PQ(){return iC||(iC=1,Lp=function(e){return e?function(t){for(var n=String(t[0]),r=0,s=e;--s;)n+=""+t[++r];return n}:function(){return""}}),Lp}var Dp,oC;function MQ(){return oC||(oC=1,Dp=function(){var e=Number.isNaN;return typeof e!="function"?!1:!e({})&&e(NaN)&&!e(34)}),Dp}var Up,aC;function wQ(){return aC||(aC=1,Up=function(e){return e!==e}),Up}var kp,cC;function LQ(){return cC||(cC=1,kp=MQ()()?Number.isNaN:wQ()),kp}var xp,uC;function oS(){if(uC)return xp;uC=1;var e=LQ(),t=di(),n=so(),r=Array.prototype.indexOf,s=Object.prototype.hasOwnProperty,i=Math.abs,o=Math.floor;return xp=function(c){var a,l,f,d;if(!e(c))return r.apply(this,arguments);for(l=t(n(this).length),f=arguments[1],isNaN(f)?f=0:f>=0?f=o(f):f=t(this.length)-o(i(f)),a=f;a<l;++a)if(s.call(this,a)&&(d=this[a],e(d)))return a;return-1},xp}var Bp,lC;function DQ(){if(lC)return Bp;lC=1;var e=oS(),t=Object.create;return Bp=function(){var n=0,r=[],s=t(null);return{get:function(i){var o=0,c=r,a,l=i.length;if(l===0)return c[l]||null;if(c=c[l]){for(;o<l-1;){if(a=e.call(c[0],i[o]),a===-1)return null;c=c[1][a],++o}return a=e.call(c[0],i[o]),a===-1?null:c[1][a]||null}return null},set:function(i){var o=0,c=r,a,l=i.length;if(l===0)c[l]=++n;else{for(c[l]||(c[l]=[[],[]]),c=c[l];o<l-1;)a=e.call(c[0],i[o]),a===-1&&(a=c[0].push(i[o])-1,c[1].push([[],[]])),c=c[1][a],++o;a=e.call(c[0],i[o]),a===-1&&(a=c[0].push(i[o])-1),c[1][a]=++n}return s[n]=i,n},delete:function(i){var o=0,c=r,a,l=s[i],f=l.length,d=[];if(f===0)delete c[f];else if(c=c[f]){for(;o<f-1;){if(a=e.call(c[0],l[o]),a===-1)return;d.push(c,a),c=c[1][a],++o}if(a=e.call(c[0],l[o]),a===-1)return;for(i=c[1][a],c[0].splice(a,1),c[1].splice(a,1);!c[0].length&&d.length;)a=d.pop(),c=d.pop(),c[0].splice(a,1),c[1].splice(a,1)}delete s[i]},clear:function(){r=[],s=t(null)}}},Bp}var Gp,dC;function UQ(){if(dC)return Gp;dC=1;var e=oS();return Gp=function(){var t=0,n=[],r=[];return{get:function(s){var i=e.call(n,s[0]);return i===-1?null:r[i]},set:function(s){return n.push(s[0]),r.push(++t),t},delete:function(s){var i=e.call(r,s);i!==-1&&(n.splice(i,1),r.splice(i,1))},clear:function(){n=[],r=[]}}},Gp}var Vp,fC;function kQ(){if(fC)return Vp;fC=1;var e=oS(),t=Object.create;return Vp=function(n){var r=0,s=[[],[]],i=t(null);return{get:function(o){for(var c=0,a=s,l;c<n-1;){if(l=e.call(a[0],o[c]),l===-1)return null;a=a[1][l],++c}return l=e.call(a[0],o[c]),l===-1?null:a[1][l]||null},set:function(o){for(var c=0,a=s,l;c<n-1;)l=e.call(a[0],o[c]),l===-1&&(l=a[0].push(o[c])-1,a[1].push([[],[]])),a=a[1][l],++c;return l=e.call(a[0],o[c]),l===-1&&(l=a[0].push(o[c])-1),a[1][l]=++r,i[r]=o,r},delete:function(o){for(var c=0,a=s,l,f=[],d=i[o];c<n-1;){if(l=e.call(a[0],d[c]),l===-1)return;f.push(a,l),a=a[1][l],++c}if(l=e.call(a[0],d[c]),l!==-1){for(o=a[1][l],a[0].splice(l,1),a[1].splice(l,1);!a[0].length&&f.length;)l=f.pop(),a=f.pop(),a[0].splice(l,1),a[1].splice(l,1);delete i[o]}},clear:function(){s=[[],[]],i=t(null)}}},Vp}var _C={},$p,pC;function BD(){if(pC)return $p;pC=1;var e=Yr(),t=$d(),n=Function.prototype.call;return $p=function(r,s){var i={},o=arguments[2];return e(s),t(r,function(c,a,l,f){i[a]=n.call(s,o,c,a,l,f)}),i},$p}var Hp,hC;function aS(){if(hC)return Hp;hC=1;var e=function(n){if(typeof n!="function")throw new TypeError(n+" is not a function");return n},t=function(n){var r=document.createTextNode(""),s,i,o=0;return new n(function(){var c;if(s)i&&(s=i.concat(s));else{if(!i)return;s=i}if(i=s,s=null,typeof i=="function"){c=i,i=null,c();return}for(r.data=o=++o%2;i;)c=i.shift(),i.length||(i=null),c()}).observe(r,{characterData:!0}),function(c){if(e(c),s){typeof s=="function"?s=[s,c]:s.push(c);return}s=c,r.data=o=++o%2}};return Hp=(function(){if(typeof process=="object"&&process&&typeof process.nextTick=="function")return process.nextTick;if(typeof queueMicrotask=="function")return function(n){queueMicrotask(e(n))};if(typeof document=="object"&&document){if(typeof MutationObserver=="function")return t(MutationObserver);if(typeof WebKitMutationObserver=="function")return t(WebKitMutationObserver)}return typeof setImmediate=="function"?function(n){setImmediate(e(n))}:typeof setTimeout=="function"||typeof setTimeout=="object"?function(n){setTimeout(e(n),0)}:null})(),Hp}var EC;function xQ(){if(EC)return _C;EC=1;var e=iS(),t=BD(),n=DD(),r=UD(),s=aS(),i=Array.prototype.slice,o=Function.prototype.apply,c=Object.create;return fi().async=function(a,l){var f=c(null),d=c(null),u=l.memoized,_=l.original,p,h,E;l.memoized=r(function(T){var S=arguments,m=S[S.length-1];return typeof m=="function"&&(p=m,S=i.call(S,0,-1)),u.apply(h=this,E=S)},u);try{n(l.memoized,u)}catch{}l.on("get",function(T){var S,m,g;if(p){if(f[T]){typeof f[T]=="function"?f[T]=[f[T],p]:f[T].push(p),p=null;return}S=p,m=h,g=E,p=h=E=null,s(function(){var y;hasOwnProperty.call(d,T)?(y=d[T],l.emit("getasync",T,g,m),o.call(S,y.context,y.args)):(p=S,h=m,E=g,u.apply(m,g))})}}),l.original=function(){var T,S,m,g;return p?(T=e(arguments),S=function y(A){var N,O,b=y.id;if(b==null){s(o.bind(y,this,arguments));return}if(delete y.id,N=f[b],delete f[b],!!N)return O=e(arguments),l.has(b)&&(A?l.delete(b):(d[b]={context:this,args:O},l.emit("setasync",b,typeof N=="function"?1:N.length))),typeof N=="function"?g=o.call(N,this,O):N.forEach(function(C){g=o.call(C,this,O)},this),g},m=p,p=h=E=null,T.push(S),g=o.call(_,this,T),S.cb=m,p=S,g):o.call(_,this,arguments)},l.on("set",function(T){if(!p){l.delete(T);return}f[T]?typeof f[T]=="function"?f[T]=[f[T],p.cb]:f[T].push(p.cb):f[T]=p.cb,delete p.cb,p.id=T,p=null}),l.on("delete",function(T){var S;hasOwnProperty.call(f,T)||d[T]&&(S=d[T],delete d[T],l.emit("deleteasync",T,i.call(S.args,1)))}),l.on("clear",function(){var T=d;d=c(null),l.emit("clearasync",t(T,function(S){return i.call(S.args,1)}))})},_C}var TC={},Fp,SC;function BQ(){if(SC)return Fp;SC=1;var e=Array.prototype.forEach,t=Object.create;return Fp=function(n){var r=t(null);return e.call(arguments,function(s){r[s]=!0}),r},Fp}var jp,mC;function GD(){return mC||(mC=1,jp=function(e){return typeof e=="function"}),jp}var qp,gC;function GQ(){if(gC)return qp;gC=1;var e=GD();return qp=function(t){try{return t&&e(t.toString)?t.toString():String(t)}catch{throw new TypeError("Passed argument cannot be stringifed")}},qp}var Yp,AC;function VQ(){if(AC)return Yp;AC=1;var e=so(),t=GQ();return Yp=function(n){return t(e(n))},Yp}var Wp,RC;function $Q(){if(RC)return Wp;RC=1;var e=GD();return Wp=function(t){try{return t&&e(t.toString)?t.toString():String(t)}catch{return"<Non-coercible to string value>"}},Wp}var Kp,yC;function HQ(){if(yC)return Kp;yC=1;var e=$Q(),t=/[\n\r\u2028\u2029]/g;return Kp=function(n){var r=e(n);return r.length>100&&(r=r.slice(0,99)+""),r=r.replace(t,function(s){return JSON.stringify(s).slice(1,-1)}),r},Kp}var qu={exports:{}},NC;function VD(){if(NC)return qu.exports;NC=1,qu.exports=e,qu.exports.default=e;function e(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}return qu.exports}var OC;function FQ(){if(OC)return TC;OC=1;var e=BD(),t=BQ(),n=VQ(),r=HQ(),s=VD(),i=aS(),o=Object.create,c=t("then","then:finally","done","done:finally");return fi().promise=function(a,l){var f=o(null),d=o(null),u=o(null);if(a===!0)a=null;else if(a=n(a),!c[a])throw new TypeError("'"+r(a)+"' is not valid promise mode");l.on("set",function(_,p,h){var E=!1;if(!s(h)){d[_]=h,l.emit("setasync",_,1);return}f[_]=1,u[_]=h;var T=function(y){var A=f[_];if(E)throw new Error(`Memoizee error: Detected unordered then|done & finally resolution, which in turn makes proper detection of success/failure impossible (when in 'done:finally' mode)
Consider to rely on 'then' or 'done' mode instead.`);A&&(delete f[_],d[_]=y,l.emit("setasync",_,A))},S=function(){E=!0,f[_]&&(delete f[_],delete u[_],l.delete(_))},m=a;if(m||(m="then"),m==="then"){var g=function(){i(S)};h=h.then(function(y){i(T.bind(this,y))},g),typeof h.finally=="function"&&h.finally(g)}else if(m==="done"){if(typeof h.done!="function")throw new Error("Memoizee error: Retrieved promise does not implement 'done' in 'done' mode");h.done(T,S)}else if(m==="done:finally"){if(typeof h.done!="function")throw new Error("Memoizee error: Retrieved promise does not implement 'done' in 'done:finally' mode");if(typeof h.finally!="function")throw new Error("Memoizee error: Retrieved promise does not implement 'finally' in 'done:finally' mode");h.done(T),h.finally(S)}}),l.on("get",function(_,p,h){var E;if(f[_]){++f[_];return}E=u[_];var T=function(){l.emit("getasync",_,p,h)};s(E)?typeof E.done=="function"?E.done(T):E.then(function(){i(T)}):T()}),l.on("delete",function(_){if(delete u[_],f[_]){delete f[_];return}if(hasOwnProperty.call(d,_)){var p=d[_];delete d[_],l.emit("deleteasync",_,[p])}}),l.on("clear",function(){var _=d;d=o(null),f=o(null),u=o(null),l.emit("clearasync",e(_,function(p){return[p]}))})},TC}var bC={},IC;function jQ(){if(IC)return bC;IC=1;var e=Yr(),t=$d(),n=fi(),r=Function.prototype.apply;return n.dispose=function(s,i,o){var c;if(e(s),o.async&&n.async||o.promise&&n.promise){i.on("deleteasync",c=function(a,l){r.call(s,null,l)}),i.on("clearasync",function(a){t(a,function(l,f){c(f,l)})});return}i.on("delete",c=function(a,l){s(l)}),i.on("clear",function(a){t(a,function(l,f){c(f,l)})})},bC}var CC={},zp,vC;function qQ(){return vC||(vC=1,zp=2147483647),zp}var Zp,PC;function YQ(){if(PC)return Zp;PC=1;var e=di(),t=qQ();return Zp=function(n){if(n=e(n),n>t)throw new TypeError(n+" exceeds maximum possible timeout");return n},Zp}var MC;function WQ(){if(MC)return CC;MC=1;var e=iS(),t=$d(),n=aS(),r=VD(),s=YQ(),i=fi(),o=Function.prototype,c=Math.max,a=Math.min,l=Object.create;return i.maxAge=function(f,d,u){var _,p,h,E;f=s(f),f&&(_=l(null),p=u.async&&i.async||u.promise&&i.promise?"async":"",d.on("set"+p,function(T){_[T]=setTimeout(function(){d.delete(T)},f),typeof _[T].unref=="function"&&_[T].unref(),E&&(E[T]&&E[T]!=="nextTick"&&clearTimeout(E[T]),E[T]=setTimeout(function(){delete E[T]},h),typeof E[T].unref=="function"&&E[T].unref())}),d.on("delete"+p,function(T){clearTimeout(_[T]),delete _[T],E&&(E[T]!=="nextTick"&&clearTimeout(E[T]),delete E[T])}),u.preFetch&&(u.preFetch===!0||isNaN(u.preFetch)?h=.333:h=c(a(Number(u.preFetch),1),0),h&&(E={},h=(1-h)*f,d.on("get"+p,function(T,S,m){E[T]||(E[T]="nextTick",n(function(){var g;E[T]==="nextTick"&&(delete E[T],d.delete(T),u.async&&(S=e(S),S.push(o)),g=d.memoized.apply(m,S),u.promise&&r(g)&&(typeof g.done=="function"?g.done(o,o):g.then(o,o)))}))}))),d.on("clear"+p,function(){t(_,function(T){clearTimeout(T)}),_={},E&&(t(E,function(T){T!=="nextTick"&&clearTimeout(T)}),E={})}))},CC}var wC={},Xp,LC;function KQ(){if(LC)return Xp;LC=1;var e=di(),t=Object.create,n=Object.prototype.hasOwnProperty;return Xp=function(r){var s=0,i=1,o=t(null),c=t(null),a=0,l;return r=e(r),{hit:function(f){var d=c[f],u=++a;if(o[u]=f,c[f]=u,!d)return++s,s<=r?void 0:(f=o[i],l(f),f);if(delete o[d],i===d)for(;!n.call(o,++i););},delete:l=function(f){var d=c[f];if(d&&(delete o[d],delete c[f],--s,i===d)){if(!s){a=0,i=1;return}for(;!n.call(o,++i););}},clear:function(){s=0,i=1,o=t(null),c=t(null),a=0}}},Xp}var DC;function zQ(){if(DC)return wC;DC=1;var e=di(),t=KQ(),n=fi();return n.max=function(r,s,i){var o,c,a;r=e(r),r&&(c=t(r),o=i.async&&n.async||i.promise&&n.promise?"async":"",s.on("set"+o,a=function(l){l=c.hit(l),l!==void 0&&s.delete(l)}),s.on("get"+o,a),s.on("delete"+o,c.delete),s.on("clear"+o,c.clear))},wC}var UC={},kC;function ZQ(){if(kC)return UC;kC=1;var e=_i(),t=fi(),n=Object.create,r=Object.defineProperties;return t.refCounter=function(s,i,o){var c,a;c=n(null),a=o.async&&t.async||o.promise&&t.promise?"async":"",i.on("set"+a,function(l,f){c[l]=f||1}),i.on("get"+a,function(l){++c[l]}),i.on("delete"+a,function(l){delete c[l]}),i.on("clear"+a,function(){c={}}),r(i.memoized,{deleteRef:e(function(){var l=i.get(arguments);return l===null||!c[l]?null:--c[l]?!1:(i.delete(l),!0)}),getRefCount:e(function(){var l=i.get(arguments);return l===null||!c[l]?0:c[l]})})},UC}var Qp,xC;function XQ(){if(xC)return Qp;xC=1;var e=MD(),t=wD(),n=CQ();return Qp=function(r){var s=e(arguments[1]),i;return s.normalizer||(i=s.length=t(s.length,r.length,s.async),i!==0&&(s.primitive?i===!1?s.normalizer=vQ():i>1&&(s.normalizer=PQ()(i)):i===!1?s.normalizer=DQ()():i===1?s.normalizer=UQ()():s.normalizer=kQ()(i))),s.async&&xQ(),s.promise&&FQ(),s.dispose&&jQ(),s.maxAge&&WQ(),s.max&&zQ(),s.refCounter&&ZQ(),n(r,s)},Qp}var QQ=XQ();const ki=td(QQ);class JQ{constructor(t){this.i=0,this.string=t,this.whitespace=` 	\r
`,this.quotes=`'"`,this.escapes="\\",this.escapedQuotes='"',this.ansiCQuotes=!0,this.localeQuotes=!0,this.debug=!1}readChar(){return this.string.charAt(this.i++)}processEscapes(t,n,r){if(!r&&!this.escapedQuotes.includes(n))return t;const s="["+this.escapes.replace(/(.)/g,"\\$1")+"]";if(!r&&this.escapedQuotes.includes(n)){const i=new RegExp(s+"("+s+"|\\"+n+")","g");return t.replace(i,"$1")}if(r){const i={"([\\\\'\"?])":c=>c,a:()=>"\x07",b:()=>"\b","e|E":()=>"\x1B",f:()=>"\f",n:()=>`
`,r:()=>"\r",t:()=>"	",v:()=>"\v","([0-7]{1,3})":c=>String.fromCharCode(parseInt(c,8)),"x([0-9a-fA-F]{1,2})":c=>String.fromCharCode(parseInt(c,16)),"u([0-9a-fA-F]{1,4})":c=>String.fromCharCode(parseInt(c,16)),"U([0-9a-fA-F]{1,8})":c=>String.fromCharCode(parseInt(c,16)),"c(.)":c=>c==="?"?"":c==="@"?"\0":String.fromCharCode(c.charCodeAt(0)&31)},o=new RegExp(s+"("+Object.keys(i).join("|")+")","g");return t.replace(o,function(c,a){for(const l in i){const f=new RegExp("^"+l+"$").exec(a);if(f!==null)return i[l].apply(null,f.slice(1))}})}}*[Symbol.iterator](){let t=!1,n=!1,r=!1,s=-2,i;for(this.debug&&console.log("full input:",">"+this.string+"<");;){const o=this.i,c=this.readChar();if(this.debug&&console.log("position:",o,"input:",">"+c+"<","accumulated:",i,"inQuote:",t,"inDollarQuote:",n,"lastDollar:",s,"escaped:",r),c===""){if(t)throw new Error("Got EOF while in a quoted string");if(r)throw new Error("Got EOF while in an escape sequence");i!==void 0&&(yield i);return}if(r){c===`
`||(t?i=(i||"")+r+c:i=(i||"")+c),r=!1;continue}if(this.escapes.includes(c)&&(!t||n!==!1||this.escapedQuotes.includes(t))){r=c;continue}if(t!==!1){if(c===t){i=this.processEscapes(i,t,n==="'"),t=!1,n=!1;continue}i=(i||"")+c;continue}if(this.quotes.includes(c)){t=c,s===o-1&&(c==="'"&&!this.ansiCQuotes||c==='"'&&!this.localeQuotes||(n=c)),i=i||"",n!==!1&&(i=i.slice(0,-1));continue}if(t===!1&&c==="$"&&(s=o),this.whitespace.includes(c)){i!==void 0&&(yield i),i=void 0;continue}i=(i||"")+c}}}function eJ(e){return Array.from(new JQ(e))}function Lt(e){return e===""?"''":/[^\w@%\-+=:,./]/.test(e)?("'"+e.replace(/('+)/g,`'"$1"'`)+"'").replace(/^''|''$/g,""):e}function tJ(e){if(!Array.isArray(e))throw new TypeError("args should be an array");return e.map(Lt).join(" ")}function nJ(e){if(!e.startsWith("["))return{loggerName:null,message:e};const t=e.indexOf("]");if(t===-1)return{loggerName:null,message:e};if(e[t+1]!==" ")return{loggerName:null,message:e};const n=e.slice(1,t).trim();if(!n)return{loggerName:null,message:e};const r=e.slice(t+2);return{loggerName:n,message:r}}const $D={safe:{},sensitive:{}};function jl(e){return e==null?$D:{safe:e.safe,sensitive:e.sensitive??{}}}class HD{buffer=[];maxBufferSize=500;hasLoggedDroppedLogMessage=!1;push(t){if(this.buffer.length>=this.maxBufferSize){this.hasLoggedDroppedLogMessage||(this.hasLoggedDroppedLogMessage=!0,this.buffer.push({level:"warning",message:"Dropped buffered log message after maxBufferSize was reached",tags:$D}));return}this.buffer.push(t)}createLogMethod(t){return(n,r)=>{this.push({level:t,message:n,tags:jl(r)})}}trace=this.createLogMethod("trace");debug=this.createLogMethod("debug");info=this.createLogMethod("info");warning=this.createLogMethod("warning");error=this.createLogMethod("error");log=(t,n,r)=>{this.push({level:t,message:n,tags:jl(r)})};flushTo(t){for(const n of this.buffer)t.log(n.level,n.message,n.tags);this.buffer.length=0}dispose(){this.buffer=[]}}let al=new HD,BC=!1;function rJ(e){if(BC&&process.env.NODE_ENV!=="test")throw new Error("Logger already set");BC=!0,al instanceof HD&&al.flushTo(e),al=e}function nu(){return al}function sJ(e){if(typeof e=="string")return e.length===0||/\s/.test(e)?JSON.stringify(e):e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return String(e);if(e==null)return typeof e>"u"?"undefined":"null";try{const t=JSON.stringify(e);if(t!=null)return t}catch{}return String(e)}function iJ(e,t){return e==="error"&&t instanceof Error}function oJ(e){const t={};for(const[n,r]of Object.entries(e)){if(iJ(n,r)){t.errorName=r.name,t.errorMessage=r.message,t.errorStack=r.stack,r.code!=null&&(t.errorCode=r.code);continue}t[n]=r}return t}function aJ(e){const t=oJ(e);return Object.keys(t).sort((r,s)=>r.localeCompare(s)).map(r=>{const s=t[r];return`${r}=${sJ(s)}`}).join(" ")}function Fd(e){const t=`[${e}] `,n=(s,i,o)=>{nu().log(s,`${t}${i}`,jl(o))},r=s=>(i,o)=>{n(s,i,o)};return{trace:r("trace"),debug:r("debug"),info:r("info"),warning:r("warning"),error:r("error"),log:(s,i,o)=>{n(s,i,o)},dispose:()=>{nu().dispose()}}}function At(e){let t=null;return()=>(t||(t=Fd(e)),t)}function FD(e){const t=Date.now(),n=Fd(e),r=(s,i)=>[`[${((Date.now()-t)/1e3).toFixed(3)}] ${s}`,jl(i)];return{trace:(s,i)=>{const[o,c]=r(s,i);n.trace(o,c)},debug:(s,i)=>{const[o,c]=r(s,i);n.debug(o,c)},info:(s,i)=>{const[o,c]=r(s,i);n.info(o,c)},warning:(s,i)=>{const[o,c]=r(s,i);n.warning(o,c)},error:(s,i)=>{const[o,c]=r(s,i);n.error(o,c)},log:(s,i,o)=>{const[c,a]=r(i,o);n.log(s,c,a)},dispose:()=>{n.dispose()}}}var sr={},GC;function cJ(){if(GC)return sr;GC=1;var e=sr&&sr.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(sr,"__esModule",{value:!0}),sr.RateLimit=sr.Sema=void 0;const t=e(Hr);function n(d,u,_,p,h){for(let E=0;E<h;++E)_[E+p]=d[E+u],d[E+u]=void 0}function r(d){return d=d>>>0,d=d-1,d=d|d>>1,d=d|d>>2,d=d|d>>4,d=d|d>>8,d=d|d>>16,d+1}function s(d){return r(Math.min(Math.max(16,d),1073741824))}class i{constructor(u){this._capacity=s(u),this._length=0,this._front=0,this.arr=[]}push(u){const _=this._length;this.checkCapacity(_+1);const p=this._front+_&this._capacity-1;return this.arr[p]=u,this._length=_+1,_+1}pop(){const u=this._length;if(u===0)return;const _=this._front+u-1&this._capacity-1,p=this.arr[_];return this.arr[_]=void 0,this._length=u-1,p}shift(){const u=this._length;if(u===0)return;const _=this._front,p=this.arr[_];return this.arr[_]=void 0,this._front=_+1&this._capacity-1,this._length=u-1,p}get length(){return this._length}checkCapacity(u){this._capacity<u&&this.resizeTo(s(this._capacity*1.5+16))}resizeTo(u){const _=this._capacity;this._capacity=u;const p=this._front,h=this._length;if(p+h>_){const E=p+h&_-1;n(this.arr,0,this.arr,_,E)}}}class o extends t.default{}function c(d){return typeof d=="function"}function a(){return"1"}class l{constructor(u,{initFn:_=a,pauseFn:p,resumeFn:h,capacity:E=10}={}){if(c(p)!==c(h))throw new Error("pauseFn and resumeFn must be both set for pausing");this.nrTokens=u,this.free=new i(u),this.waiting=new i(E),this.releaseEmitter=new o,this.noTokens=_===a,this.pauseFn=p,this.resumeFn=h,this.paused=!1,this.releaseEmitter.on("release",T=>{const S=this.waiting.shift();S?S.resolve(T):(this.resumeFn&&this.paused&&(this.paused=!1,this.resumeFn()),this.free.push(T))});for(let T=0;T<u;T++)this.free.push(_())}tryAcquire(){return this.free.pop()}async acquire(){let u=this.tryAcquire();return u!==void 0?u:new Promise((_,p)=>{this.pauseFn&&!this.paused&&(this.paused=!0,this.pauseFn()),this.waiting.push({resolve:_,reject:p})})}release(u){this.releaseEmitter.emit("release",this.noTokens?"1":u)}drain(){const u=new Array(this.nrTokens);for(let _=0;_<this.nrTokens;_++)u[_]=this.acquire();return Promise.all(u)}nrWaiting(){return this.waiting.length}}sr.Sema=l;function f(d,{timeUnit:u=1e3,uniformDistribution:_=!1}={}){const p=new l(_?1:d),h=_?u/d:u;return async function(){await p.acquire(),setTimeout(()=>p.release(),h)}}return sr.RateLimit=f,sr}var jD=cJ();class qD{constructor(t,n=[],r=[],s){this.child=t,this.stdoutChunks=n,this.stderrChunks=r,this.promise=s.then(({code:i,signal:o})=>({type:"resolve",code:i,signal:o}),i=>({type:"reject",error:i}))}result=null;promise;check(){return this.wait().then(({stdout:t,stderr:n,code:r,signal:s})=>{if(r===0)return{stdout:t,stderr:n};throw new Error(`process exited with code ${r}, signal ${s}`)})}wait(){return this.promise.then(t=>{switch(t.type){case"resolve":{const{code:n,signal:r}=t;return{stdout:Buffer.concat(this.stdoutChunks).toString("utf8"),stderr:Buffer.concat(this.stderrChunks).toString("utf8"),code:n,signal:r}}case"reject":throw t.error}})}getStdout(){return Buffer.concat(this.stdoutChunks)}getStderr(){return Buffer.concat(this.stderrChunks)}getExitCode(){return this.result?.type==="resolve"?this.result.code:null}isDone(){return this.result!=null}kill(){this.child.kill()}}const uJ={startSpan:(e,t)=>t()};let YD=uJ;function lJ(e){YD=e}function dJ(){return YD}function cS(e,t){return dJ().startSpan(e,t)}let ql;function fJ(e){if(ql)throw new Error("shouldSpawnInsideWsl already set");ql=e}function _J(){if(!ql){if(process.env.NODE_ENV==="test"||process.env.VITEST!=null)return!1;throw new Error("shouldSpawnInsideWsl not set")}return ql()}function pJ(){const e=nu(),t=hJ(e);if(!t)return;if(SJ(t))return bE(t);if(TJ(t))return bE(mJ(t));const n=EJ(t,e);if(n)return n;e.warning("[resolveCodexHomeFromWsl] Unable to translate Linux path",{safe:{},sensitive:{linuxPath:t}})}function hJ(e){return WD(["/usr/bin/env","bash","-lc",'printf %s "${CODEX_HOME:-$HOME/.codex}"'],"readCodexHomePathFromWslEnv",e)}function EJ(e,t){const n=WD(["wslpath","-w",e],`resolveCodexHomeFromWsl:wslpath(${e})`,t);return n?bE(n):void 0}function WD(e,t,n){try{const r=iu.spawnSync("wsl.exe",e,{encoding:"utf8",windowsHide:!0});if(r.error){n.debug("WSL command error",{safe:{context:t},sensitive:{error:r.error}});return}if(r.status!==0){n.debug("WSL command non-zero exit",{safe:{context:t},sensitive:{status:r.status,stderr:r.stderr?.toString()??""}});return}const s=r.stdout?.toString().trim();if(!s){n.warning("WSL command returned empty output",{safe:{context:t},sensitive:{}});return}return s}catch(r){n.warning("WSL command unexpected error",{safe:{context:t},sensitive:{error:r}});return}}function bE(e){return e.replace(/\//g,"\\")}function TJ(e){return/^\/mnt\/[a-zA-Z]\//.test(e)?!0:/^\\{1,2}mnt\\[a-zA-Z]\\/.test(e)}function SJ(e){return!!(/^[a-zA-Z]:[\\/]/.test(e)||/^\\\\/.test(e))}function mJ(e){const t=e.match(/^\/mnt\/([a-zA-Z])\/(.*)$/);if(t){const s=t[1].toUpperCase(),i=t[2].replace(/\//g,"\\");return`${s}:\\${i}`}const n=e.match(/^\\{1,2}[Mm][Nn][Tt]\\([a-zA-Z])\\(.*)$/i);if(n){const s=n[1].toUpperCase(),i=n[2].replace(/[\\/]/g,"\\");return`${s}:\\${i}`}const r=e.match(/^C:\\mnt\\c(.*)$/i);return r?`C:\\${r[1].replace(/^([\\/])+/,"").replace(/[\\/]/g,"\\")}`:e.replace(/\//g,"\\")}function KD(e){if(/^(\\\\|\/\/)(wsl\$|wsl\.localhost)/i.test(e)){const r=e.replace(/^((\\\\|\/\/)(wsl\$|wsl\.localhost)[\\/]+)/i,"").split(/[\\/]/);r.shift();const s=r.join("/").replace(/\\/g,"/");return s.length===0?"/":s.startsWith("/")?s:`/${s}`}if(e.startsWith("/"))return e;const t=e.match(/^([a-zA-Z]):[\\/](.*)$/);if(t){const n=t[1].toLowerCase(),r=t[2].replace(/\\/g,"/");return`/mnt/${n}/${r}`}return e.replace(/\\/g,"/")}const zD=At("spawn-async");function ZD(e){const t=e[0]??"process";return t==="git"&&e[1]?{op:"git.exec",name:`git ${e[1]}`}:{op:"process.exec",name:t}}function XD({args:e,cwd:t,env:n,signal:r,stdoutChunkHandler:s,stderrChunkHandler:i,onExitHandler:o}){if(_J())return zD().info("Spawning process inside WSL"),gJ(e,t,n?AJ(n):void 0,r,s,i);const c=e[0],a=e.slice(1),l={cwd:t,env:{...process.env,...n},stdio:["ignore","pipe","pipe"]},f=iu.spawn(c,a,l),d=[],u=[],_=new Promise((h,E)=>{const T=QD(f,r);f.stdout?.on("data",S=>{d.push(S),s?.(S)}),f.stderr?.on("data",S=>{u.push(S),i?.(S)}),f.on("close",(S,m)=>{o?.(),T?.(),h({code:S,signal:m})}),f.on("error",S=>{o?.(),T?.(),E(S)})}),p=ZD(e);return new qD(f,d,u,cS(p,()=>_))}function gJ(e,t,n,r,s,i){const o=t?KD(t):".",c=["RUST_LOG=warn"];n&&c.push(...RJ(n));const a=["-d","Ubuntu"];a.push("--cd",o),a.push("--exec","/usr/bin/env",...c,...e);const l={env:{...process.env},stdio:["ignore","pipe","pipe"]};zD().debug("Spawning process inside WSL",{safe:{command:`wsl.exe ${a.join(" ")}`},sensitive:{}});const f=iu.spawn("wsl.exe",a,l),d=[],u=[],_=new Promise((h,E)=>{const T=QD(f,r);f.stdout?.on("data",S=>{d.push(S),s?.(S)}),f.stderr?.on("data",S=>{u.push(S),i?.(S)}),f.on("close",(S,m)=>{T?.(),h({code:S,signal:m})}),f.on("error",S=>{T?.(),E(S)})}),p=ZD(e);return new qD(f,d,u,cS(p,()=>_))}function QD(e,t){if(!t)return;const n=()=>{e.kill()};return t.addEventListener("abort",n),t.aborted&&n(),()=>{t.removeEventListener("abort",n)}}function AJ(e){const t={};for(const[n,r]of Object.entries(e))r!=null&&process.env[n]!==r&&(t[n]=r);return t}function RJ(e){const t=[];for(const[n,r]of Object.entries(e)){const s=yJ(r)?KD(r):r;t.push(`${n}=${s}`)}return t}function yJ(e){return e.includes(";")?!1:!!(/^(?:[a-zA-Z]:[\\/]|\\\\|\/\/)/.test(e)||/^(\\\\|\/\/)(wsl\$|wsl\.localhost)[\\/]/i.test(e))}const NJ=4,OJ=1e3,Jp=new Map,eh=At("spawn-remote-async");function bJ(e){const t=[];for(const[n,r]of Object.entries(e))r!=null&&t.push(`${n}=${Lt(r)}`);return t}function IJ(e){return Jp.has(e)||Jp.set(e,new jD.Sema(NJ)),Jp.get(e)}class CJ{constructor(t,n){this.semaphore=t,this.timeout=n}releaseTimeout=null;released=!1;async acquire(){await this.semaphore.acquire(),this.releaseTimeout=setTimeout(()=>{this.release()},this.timeout)}release(){this.released||(this.released=!0,this.releaseTimeout&&clearTimeout(this.releaseTimeout),this.semaphore.release())}}async function Wr({hostConfig:e,args:t,env:n,signal:r,timeoutMs:s,noConcurrencyLimit:i,stdoutChunkHandler:o,stderrChunkHandler:c}){const a=n?bJ(n):[],l=[...e.terminal_command,"--",...a,...t];let f=null;if(!i){const p=IJ(e.id);f=new CJ(p,OJ),await f.acquire()}let d=!1,u=null;const _=XD({args:l,signal:r,stdoutChunkHandler:o,stderrChunkHandler:c,onExitHandler:()=>{d=!0,u&&clearTimeout(u),f&&f.release()}});return s!=null&&(u=setTimeout(()=>{_.kill()},s),d&&u&&(clearTimeout(u),u=null)),_}async function ir({hostConfig:e,args:t,errorOnNonZeroExitCode:n=!0}){const r=crypto.randomUUID().slice(0,8);eh().debug("Spawning remote process",{safe:{requestId:r,argsCount:t.length},sensitive:{args:t}});const s=await Wr({hostConfig:e,args:t}),{stdout:i,stderr:o,code:c}=await s.wait();if(c!==0){if(eh().debug("Remote process exited with non-zero code",{safe:{requestId:r,code:c},sensitive:{stderr:o}}),n)throw new Error(`Process errored with code ${c} stderr=${o}`)}else eh().debug("Remote process exited successfully",{safe:{requestId:r,code:c},sensitive:{}});return{stdout:i,stderr:o,code:c}}const vJ=6e4,PJ=60*vJ,uS=24*PJ;function MJ(e){const{preferWsl:t=!1}=e,n=nu();if(t&&process.platform==="win32"){const r=pJ();if(r)return r;n.info("[resolveCodexHome] Falling back to host home directory because WSL CODEX_HOME could not be resolved")}return process.env.CODEX_HOME??lM.join(jt.homedir(),".codex")}const JD=ki(async e=>{const t=typeof e=="string"?LJ(e):e;return wJ(t)},{length:1,normalizer:([e])=>typeof e=="string"?e:e.id,promise:!0,maxAge:uS});async function wJ(e){const t=nu(),r=["sh","-lc",Lt('if [ -n "$CODEX_HOME" ]; then printf "%s" "$CODEX_HOME"; else printf "%s" "$HOME/.codex"; fi')];let s,i=!1;const o=setTimeout(()=>{i=!0,s?.kill()},1e4);try{s=await Wr({hostConfig:e,args:r});const{stdout:c,stderr:a,code:l}=await s.wait();if(clearTimeout(o),i)throw t.warning("[resolveRemoteSshCodexHome] timed out"),new Error("resolveRemoteSshCodexHome timed out");if(l!==0)throw new Error(`[resolveRemoteSshCodexHome] failed (${l}): ${a||c}`);return c.trim()}catch(c){throw clearTimeout(o),t.warning("[resolveRemoteSshCodexHome] error",{safe:{},sensitive:{error:c}}),c}}function LJ(e){return{id:e,display_name:e,kind:"ssh",codex_cli_command:[],terminal_command:eJ(e)}}const et={async readFile(e,t){if(xe(t)){const{stdout:n}=await ir({hostConfig:t,args:["cat",e]});return n}return me.promises.readFile(e,"utf-8")},async readFileBase64(e,t){if(xe(t)){const{stdout:n}=await ir({hostConfig:t,args:["base64",e]});return Buffer.from(n,"base64")}return me.promises.readFile(e,"base64")},async writeFile(e,t,n){if(xe(n)){await ir({hostConfig:n,args:["sh","-c",Lt(`cat > ${e} << "EOF"
${t}
EOF`)]});return}await me.promises.writeFile(e,t,"utf8")},async mkdir(e,t={},n){if(xe(n)){const r=["mkdir"];t.recursive!==!1&&r.push("-p"),r.push(e),await ir({hostConfig:n,args:r});return}await me.promises.mkdir(e,{recursive:t.recursive??!0})},async stat(e,t){if(!xe(t))return me.promises.stat(e);const{stdout:n,code:r}=await ir({hostConfig:t,args:["sh","-c",Lt('if [ -d "$1" ]; then echo "dir"; elif [ -f "$1" ]; then echo "file"; elif [ -L "$1" ]; then echo "link"; else exit 1; fi'),"sh",e],errorOnNonZeroExitCode:!1});if(r===1)throw new Error(`File not found: ${e}`);const s=n.trim();return{isDirectory:()=>s==="dir",isFile:()=>s==="file"||s==="link"}},async readdir(e,t){if(xe(t)){const{stdout:n}=await ir({hostConfig:t,args:["sh","-c",Lt('ls -A "$1"'),"sh",e]});return n.split(/\r?\n/).map(r=>r.trim()).filter(r=>r.length>0)}return me.promises.readdir(e)},async rm(e,t={},n){if(xe(n)){const r=["rm"];t.recursive!==!1&&r.push("-r"),t.force!==!1&&r.push("-f"),r.push(e),await ir({hostConfig:n,args:r});return}await me.promises.rm(e,{recursive:t.recursive??!0,force:t.force??!0})},async copyFile(e,t,n){if(xe(n)){await ir({hostConfig:n,args:["cp",e,t]});return}await me.promises.copyFile(e,t)},async cp(e,t,n={},r){if(xe(r)){const s=["cp"];n.recursive&&s.push("-R"),s.push(e,t),await ir({hostConfig:r,args:s});return}await me.promises.cp(e,t,{recursive:n.recursive??!1})}};function kt(e){return xe(e)?he.posix:he}class DJ{handlers=new Set;subscribe(t){return this.handlers.add(t),{dispose:()=>{this.handlers.delete(t)}}}emit(t,n=Date.now()){for(const r of this.handlers)r({type:t,at:n})}}var $t={},Ms={},Rc={},Yu={},Un={},VC;function UJ(){if(VC)return Un;VC=1,Object.defineProperty(Un,"__esModule",{value:!0});const e=GE,t={INVALID_ENCODING:"Invalid encoding provided. Please specify a valid encoding the internal Node.js Buffer supports.",INVALID_SMARTBUFFER_SIZE:"Invalid size provided. Size must be a valid integer greater than zero.",INVALID_SMARTBUFFER_BUFFER:"Invalid Buffer provided in SmartBufferOptions.",INVALID_SMARTBUFFER_OBJECT:"Invalid SmartBufferOptions object supplied to SmartBuffer constructor or factory methods.",INVALID_OFFSET:"An invalid offset value was provided.",INVALID_OFFSET_NON_NUMBER:"An invalid offset value was provided. A numeric value is required.",INVALID_LENGTH:"An invalid length value was provided.",INVALID_LENGTH_NON_NUMBER:"An invalid length value was provived. A numeric value is required.",INVALID_TARGET_OFFSET:"Target offset is beyond the bounds of the internal SmartBuffer data.",INVALID_TARGET_LENGTH:"Specified length value moves cursor beyong the bounds of the internal SmartBuffer data.",INVALID_READ_BEYOND_BOUNDS:"Attempted to read beyond the bounds of the managed data.",INVALID_WRITE_BEYOND_BOUNDS:"Attempted to write beyond the bounds of the managed data."};Un.ERRORS=t;function n(f){if(!e.Buffer.isEncoding(f))throw new Error(t.INVALID_ENCODING)}Un.checkEncoding=n;function r(f){return typeof f=="number"&&isFinite(f)&&a(f)}Un.isFiniteInteger=r;function s(f,d){if(typeof f=="number"){if(!r(f)||f<0)throw new Error(d?t.INVALID_OFFSET:t.INVALID_LENGTH)}else throw new Error(d?t.INVALID_OFFSET_NON_NUMBER:t.INVALID_LENGTH_NON_NUMBER)}function i(f){s(f,!1)}Un.checkLengthValue=i;function o(f){s(f,!0)}Un.checkOffsetValue=o;function c(f,d){if(f<0||f>d.length)throw new Error(t.INVALID_TARGET_OFFSET)}Un.checkTargetOffset=c;function a(f){return typeof f=="number"&&isFinite(f)&&Math.floor(f)===f}function l(f){if(typeof BigInt>"u")throw new Error("Platform does not support JS BigInt type.");if(typeof e.Buffer.prototype[f]>"u")throw new Error(`Platform does not support Buffer.prototype.${f}.`)}return Un.bigIntAndBufferInt64Check=l,Un}var $C;function kJ(){if($C)return Yu;$C=1,Object.defineProperty(Yu,"__esModule",{value:!0});const e=UJ(),t=4096,n="utf8";class r{constructor(i){if(this.length=0,this._encoding=n,this._writeOffset=0,this._readOffset=0,r.isSmartBufferOptions(i))if(i.encoding&&(e.checkEncoding(i.encoding),this._encoding=i.encoding),i.size)if(e.isFiniteInteger(i.size)&&i.size>0)this._buff=Buffer.allocUnsafe(i.size);else throw new Error(e.ERRORS.INVALID_SMARTBUFFER_SIZE);else if(i.buff)if(Buffer.isBuffer(i.buff))this._buff=i.buff,this.length=i.buff.length;else throw new Error(e.ERRORS.INVALID_SMARTBUFFER_BUFFER);else this._buff=Buffer.allocUnsafe(t);else{if(typeof i<"u")throw new Error(e.ERRORS.INVALID_SMARTBUFFER_OBJECT);this._buff=Buffer.allocUnsafe(t)}}static fromSize(i,o){return new this({size:i,encoding:o})}static fromBuffer(i,o){return new this({buff:i,encoding:o})}static fromOptions(i){return new this(i)}static isSmartBufferOptions(i){const o=i;return o&&(o.encoding!==void 0||o.size!==void 0||o.buff!==void 0)}readInt8(i){return this._readNumberValue(Buffer.prototype.readInt8,1,i)}readInt16BE(i){return this._readNumberValue(Buffer.prototype.readInt16BE,2,i)}readInt16LE(i){return this._readNumberValue(Buffer.prototype.readInt16LE,2,i)}readInt32BE(i){return this._readNumberValue(Buffer.prototype.readInt32BE,4,i)}readInt32LE(i){return this._readNumberValue(Buffer.prototype.readInt32LE,4,i)}readBigInt64BE(i){return e.bigIntAndBufferInt64Check("readBigInt64BE"),this._readNumberValue(Buffer.prototype.readBigInt64BE,8,i)}readBigInt64LE(i){return e.bigIntAndBufferInt64Check("readBigInt64LE"),this._readNumberValue(Buffer.prototype.readBigInt64LE,8,i)}writeInt8(i,o){return this._writeNumberValue(Buffer.prototype.writeInt8,1,i,o),this}insertInt8(i,o){return this._insertNumberValue(Buffer.prototype.writeInt8,1,i,o)}writeInt16BE(i,o){return this._writeNumberValue(Buffer.prototype.writeInt16BE,2,i,o)}insertInt16BE(i,o){return this._insertNumberValue(Buffer.prototype.writeInt16BE,2,i,o)}writeInt16LE(i,o){return this._writeNumberValue(Buffer.prototype.writeInt16LE,2,i,o)}insertInt16LE(i,o){return this._insertNumberValue(Buffer.prototype.writeInt16LE,2,i,o)}writeInt32BE(i,o){return this._writeNumberValue(Buffer.prototype.writeInt32BE,4,i,o)}insertInt32BE(i,o){return this._insertNumberValue(Buffer.prototype.writeInt32BE,4,i,o)}writeInt32LE(i,o){return this._writeNumberValue(Buffer.prototype.writeInt32LE,4,i,o)}insertInt32LE(i,o){return this._insertNumberValue(Buffer.prototype.writeInt32LE,4,i,o)}writeBigInt64BE(i,o){return e.bigIntAndBufferInt64Check("writeBigInt64BE"),this._writeNumberValue(Buffer.prototype.writeBigInt64BE,8,i,o)}insertBigInt64BE(i,o){return e.bigIntAndBufferInt64Check("writeBigInt64BE"),this._insertNumberValue(Buffer.prototype.writeBigInt64BE,8,i,o)}writeBigInt64LE(i,o){return e.bigIntAndBufferInt64Check("writeBigInt64LE"),this._writeNumberValue(Buffer.prototype.writeBigInt64LE,8,i,o)}insertBigInt64LE(i,o){return e.bigIntAndBufferInt64Check("writeBigInt64LE"),this._insertNumberValue(Buffer.prototype.writeBigInt64LE,8,i,o)}readUInt8(i){return this._readNumberValue(Buffer.prototype.readUInt8,1,i)}readUInt16BE(i){return this._readNumberValue(Buffer.prototype.readUInt16BE,2,i)}readUInt16LE(i){return this._readNumberValue(Buffer.prototype.readUInt16LE,2,i)}readUInt32BE(i){return this._readNumberValue(Buffer.prototype.readUInt32BE,4,i)}readUInt32LE(i){return this._readNumberValue(Buffer.prototype.readUInt32LE,4,i)}readBigUInt64BE(i){return e.bigIntAndBufferInt64Check("readBigUInt64BE"),this._readNumberValue(Buffer.prototype.readBigUInt64BE,8,i)}readBigUInt64LE(i){return e.bigIntAndBufferInt64Check("readBigUInt64LE"),this._readNumberValue(Buffer.prototype.readBigUInt64LE,8,i)}writeUInt8(i,o){return this._writeNumberValue(Buffer.prototype.writeUInt8,1,i,o)}insertUInt8(i,o){return this._insertNumberValue(Buffer.prototype.writeUInt8,1,i,o)}writeUInt16BE(i,o){return this._writeNumberValue(Buffer.prototype.writeUInt16BE,2,i,o)}insertUInt16BE(i,o){return this._insertNumberValue(Buffer.prototype.writeUInt16BE,2,i,o)}writeUInt16LE(i,o){return this._writeNumberValue(Buffer.prototype.writeUInt16LE,2,i,o)}insertUInt16LE(i,o){return this._insertNumberValue(Buffer.prototype.writeUInt16LE,2,i,o)}writeUInt32BE(i,o){return this._writeNumberValue(Buffer.prototype.writeUInt32BE,4,i,o)}insertUInt32BE(i,o){return this._insertNumberValue(Buffer.prototype.writeUInt32BE,4,i,o)}writeUInt32LE(i,o){return this._writeNumberValue(Buffer.prototype.writeUInt32LE,4,i,o)}insertUInt32LE(i,o){return this._insertNumberValue(Buffer.prototype.writeUInt32LE,4,i,o)}writeBigUInt64BE(i,o){return e.bigIntAndBufferInt64Check("writeBigUInt64BE"),this._writeNumberValue(Buffer.prototype.writeBigUInt64BE,8,i,o)}insertBigUInt64BE(i,o){return e.bigIntAndBufferInt64Check("writeBigUInt64BE"),this._insertNumberValue(Buffer.prototype.writeBigUInt64BE,8,i,o)}writeBigUInt64LE(i,o){return e.bigIntAndBufferInt64Check("writeBigUInt64LE"),this._writeNumberValue(Buffer.prototype.writeBigUInt64LE,8,i,o)}insertBigUInt64LE(i,o){return e.bigIntAndBufferInt64Check("writeBigUInt64LE"),this._insertNumberValue(Buffer.prototype.writeBigUInt64LE,8,i,o)}readFloatBE(i){return this._readNumberValue(Buffer.prototype.readFloatBE,4,i)}readFloatLE(i){return this._readNumberValue(Buffer.prototype.readFloatLE,4,i)}writeFloatBE(i,o){return this._writeNumberValue(Buffer.prototype.writeFloatBE,4,i,o)}insertFloatBE(i,o){return this._insertNumberValue(Buffer.prototype.writeFloatBE,4,i,o)}writeFloatLE(i,o){return this._writeNumberValue(Buffer.prototype.writeFloatLE,4,i,o)}insertFloatLE(i,o){return this._insertNumberValue(Buffer.prototype.writeFloatLE,4,i,o)}readDoubleBE(i){return this._readNumberValue(Buffer.prototype.readDoubleBE,8,i)}readDoubleLE(i){return this._readNumberValue(Buffer.prototype.readDoubleLE,8,i)}writeDoubleBE(i,o){return this._writeNumberValue(Buffer.prototype.writeDoubleBE,8,i,o)}insertDoubleBE(i,o){return this._insertNumberValue(Buffer.prototype.writeDoubleBE,8,i,o)}writeDoubleLE(i,o){return this._writeNumberValue(Buffer.prototype.writeDoubleLE,8,i,o)}insertDoubleLE(i,o){return this._insertNumberValue(Buffer.prototype.writeDoubleLE,8,i,o)}readString(i,o){let c;typeof i=="number"?(e.checkLengthValue(i),c=Math.min(i,this.length-this._readOffset)):(o=i,c=this.length-this._readOffset),typeof o<"u"&&e.checkEncoding(o);const a=this._buff.slice(this._readOffset,this._readOffset+c).toString(o||this._encoding);return this._readOffset+=c,a}insertString(i,o,c){return e.checkOffsetValue(o),this._handleString(i,!0,o,c)}writeString(i,o,c){return this._handleString(i,!1,o,c)}readStringNT(i){typeof i<"u"&&e.checkEncoding(i);let o=this.length;for(let a=this._readOffset;a<this.length;a++)if(this._buff[a]===0){o=a;break}const c=this._buff.slice(this._readOffset,o);return this._readOffset=o+1,c.toString(i||this._encoding)}insertStringNT(i,o,c){return e.checkOffsetValue(o),this.insertString(i,o,c),this.insertUInt8(0,o+i.length),this}writeStringNT(i,o,c){return this.writeString(i,o,c),this.writeUInt8(0,typeof o=="number"?o+i.length:this.writeOffset),this}readBuffer(i){typeof i<"u"&&e.checkLengthValue(i);const o=typeof i=="number"?i:this.length,c=Math.min(this.length,this._readOffset+o),a=this._buff.slice(this._readOffset,c);return this._readOffset=c,a}insertBuffer(i,o){return e.checkOffsetValue(o),this._handleBuffer(i,!0,o)}writeBuffer(i,o){return this._handleBuffer(i,!1,o)}readBufferNT(){let i=this.length;for(let c=this._readOffset;c<this.length;c++)if(this._buff[c]===0){i=c;break}const o=this._buff.slice(this._readOffset,i);return this._readOffset=i+1,o}insertBufferNT(i,o){return e.checkOffsetValue(o),this.insertBuffer(i,o),this.insertUInt8(0,o+i.length),this}writeBufferNT(i,o){return typeof o<"u"&&e.checkOffsetValue(o),this.writeBuffer(i,o),this.writeUInt8(0,typeof o=="number"?o+i.length:this._writeOffset),this}clear(){return this._writeOffset=0,this._readOffset=0,this.length=0,this}remaining(){return this.length-this._readOffset}get readOffset(){return this._readOffset}set readOffset(i){e.checkOffsetValue(i),e.checkTargetOffset(i,this),this._readOffset=i}get writeOffset(){return this._writeOffset}set writeOffset(i){e.checkOffsetValue(i),e.checkTargetOffset(i,this),this._writeOffset=i}get encoding(){return this._encoding}set encoding(i){e.checkEncoding(i),this._encoding=i}get internalBuffer(){return this._buff}toBuffer(){return this._buff.slice(0,this.length)}toString(i){const o=typeof i=="string"?i:this._encoding;return e.checkEncoding(o),this._buff.toString(o,0,this.length)}destroy(){return this.clear(),this}_handleString(i,o,c,a){let l=this._writeOffset,f=this._encoding;typeof c=="number"?l=c:typeof c=="string"&&(e.checkEncoding(c),f=c),typeof a=="string"&&(e.checkEncoding(a),f=a);const d=Buffer.byteLength(i,f);return o?this.ensureInsertable(d,l):this._ensureWriteable(d,l),this._buff.write(i,l,d,f),o?this._writeOffset+=d:typeof c=="number"?this._writeOffset=Math.max(this._writeOffset,l+d):this._writeOffset+=d,this}_handleBuffer(i,o,c){const a=typeof c=="number"?c:this._writeOffset;return o?this.ensureInsertable(i.length,a):this._ensureWriteable(i.length,a),i.copy(this._buff,a),o?this._writeOffset+=i.length:typeof c=="number"?this._writeOffset=Math.max(this._writeOffset,a+i.length):this._writeOffset+=i.length,this}ensureReadable(i,o){let c=this._readOffset;if(typeof o<"u"&&(e.checkOffsetValue(o),c=o),c<0||c+i>this.length)throw new Error(e.ERRORS.INVALID_READ_BEYOND_BOUNDS)}ensureInsertable(i,o){e.checkOffsetValue(o),this._ensureCapacity(this.length+i),o<this.length&&this._buff.copy(this._buff,o+i,o,this._buff.length),o+i>this.length?this.length=o+i:this.length+=i}_ensureWriteable(i,o){const c=typeof o=="number"?o:this._writeOffset;this._ensureCapacity(c+i),c+i>this.length&&(this.length=c+i)}_ensureCapacity(i){const o=this._buff.length;if(i>o){let c=this._buff,a=o*3/2+1;a<i&&(a=i),this._buff=Buffer.allocUnsafe(a),c.copy(this._buff,0,0,o)}}_readNumberValue(i,o,c){this.ensureReadable(o,c);const a=i.call(this._buff,typeof c=="number"?c:this._readOffset);return typeof c>"u"&&(this._readOffset+=o),a}_insertNumberValue(i,o,c,a){return e.checkOffsetValue(a),this.ensureInsertable(o,a),i.call(this._buff,c,a),this._writeOffset+=o,this}_writeNumberValue(i,o,c,a){if(typeof a=="number"){if(a<0)throw new Error(e.ERRORS.INVALID_WRITE_BEYOND_BOUNDS);e.checkOffsetValue(a)}const l=typeof a=="number"?a:this._writeOffset;return this._ensureWriteable(o,l),i.call(this._buff,c,l),typeof a=="number"?this._writeOffset=Math.max(this._writeOffset,l+o):this._writeOffset+=o,this}}return Yu.SmartBuffer=r,Yu}var Ge={},HC;function eU(){if(HC)return Ge;HC=1,Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.SOCKS5_NO_ACCEPTABLE_AUTH=Ge.SOCKS5_CUSTOM_AUTH_END=Ge.SOCKS5_CUSTOM_AUTH_START=Ge.SOCKS_INCOMING_PACKET_SIZES=Ge.SocksClientState=Ge.Socks5Response=Ge.Socks5HostType=Ge.Socks5Auth=Ge.Socks4Response=Ge.SocksCommand=Ge.ERRORS=Ge.DEFAULT_TIMEOUT=void 0;const e=3e4;Ge.DEFAULT_TIMEOUT=e;const t={InvalidSocksCommand:"An invalid SOCKS command was provided. Valid options are connect, bind, and associate.",InvalidSocksCommandForOperation:"An invalid SOCKS command was provided. Only a subset of commands are supported for this operation.",InvalidSocksCommandChain:"An invalid SOCKS command was provided. Chaining currently only supports the connect command.",InvalidSocksClientOptionsDestination:"An invalid destination host was provided.",InvalidSocksClientOptionsExistingSocket:"An invalid existing socket was provided. This should be an instance of stream.Duplex.",InvalidSocksClientOptionsProxy:"Invalid SOCKS proxy details were provided.",InvalidSocksClientOptionsTimeout:"An invalid timeout value was provided. Please enter a value above 0 (in ms).",InvalidSocksClientOptionsProxiesLength:"At least two socks proxies must be provided for chaining.",InvalidSocksClientOptionsCustomAuthRange:"Custom auth must be a value between 0x80 and 0xFE.",InvalidSocksClientOptionsCustomAuthOptions:"When a custom_auth_method is provided, custom_auth_request_handler, custom_auth_response_size, and custom_auth_response_handler must also be provided and valid.",NegotiationError:"Negotiation error",SocketClosed:"Socket closed",ProxyConnectionTimedOut:"Proxy connection timed out",InternalError:"SocksClient internal error (this should not happen)",InvalidSocks4HandshakeResponse:"Received invalid Socks4 handshake response",Socks4ProxyRejectedConnection:"Socks4 Proxy rejected connection",InvalidSocks4IncomingConnectionResponse:"Socks4 invalid incoming connection response",Socks4ProxyRejectedIncomingBoundConnection:"Socks4 Proxy rejected incoming bound connection",InvalidSocks5InitialHandshakeResponse:"Received invalid Socks5 initial handshake response",InvalidSocks5IntiailHandshakeSocksVersion:"Received invalid Socks5 initial handshake (invalid socks version)",InvalidSocks5InitialHandshakeNoAcceptedAuthType:"Received invalid Socks5 initial handshake (no accepted authentication type)",InvalidSocks5InitialHandshakeUnknownAuthType:"Received invalid Socks5 initial handshake (unknown authentication type)",Socks5AuthenticationFailed:"Socks5 Authentication failed",InvalidSocks5FinalHandshake:"Received invalid Socks5 final handshake response",InvalidSocks5FinalHandshakeRejected:"Socks5 proxy rejected connection",InvalidSocks5IncomingConnectionResponse:"Received invalid Socks5 incoming connection response",Socks5ProxyRejectedIncomingBoundConnection:"Socks5 Proxy rejected incoming bound connection"};Ge.ERRORS=t;const n={Socks5InitialHandshakeResponse:2,Socks5UserPassAuthenticationResponse:2,Socks5ResponseHeader:5,Socks5ResponseIPv4:10,Socks5ResponseIPv6:22,Socks5ResponseHostname:u=>u+7,Socks4Response:8};Ge.SOCKS_INCOMING_PACKET_SIZES=n;var r;(function(u){u[u.connect=1]="connect",u[u.bind=2]="bind",u[u.associate=3]="associate"})(r||(Ge.SocksCommand=r={}));var s;(function(u){u[u.Granted=90]="Granted",u[u.Failed=91]="Failed",u[u.Rejected=92]="Rejected",u[u.RejectedIdent=93]="RejectedIdent"})(s||(Ge.Socks4Response=s={}));var i;(function(u){u[u.NoAuth=0]="NoAuth",u[u.GSSApi=1]="GSSApi",u[u.UserPass=2]="UserPass"})(i||(Ge.Socks5Auth=i={}));const o=128;Ge.SOCKS5_CUSTOM_AUTH_START=o;const c=254;Ge.SOCKS5_CUSTOM_AUTH_END=c;const a=255;Ge.SOCKS5_NO_ACCEPTABLE_AUTH=a;var l;(function(u){u[u.Granted=0]="Granted",u[u.Failure=1]="Failure",u[u.NotAllowed=2]="NotAllowed",u[u.NetworkUnreachable=3]="NetworkUnreachable",u[u.HostUnreachable=4]="HostUnreachable",u[u.ConnectionRefused=5]="ConnectionRefused",u[u.TTLExpired=6]="TTLExpired",u[u.CommandNotSupported=7]="CommandNotSupported",u[u.AddressNotSupported=8]="AddressNotSupported"})(l||(Ge.Socks5Response=l={}));var f;(function(u){u[u.IPv4=1]="IPv4",u[u.Hostname=3]="Hostname",u[u.IPv6=4]="IPv6"})(f||(Ge.Socks5HostType=f={}));var d;return(function(u){u[u.Created=0]="Created",u[u.Connecting=1]="Connecting",u[u.Connected=2]="Connected",u[u.SentInitialHandshake=3]="SentInitialHandshake",u[u.ReceivedInitialHandshakeResponse=4]="ReceivedInitialHandshakeResponse",u[u.SentAuthentication=5]="SentAuthentication",u[u.ReceivedAuthenticationResponse=6]="ReceivedAuthenticationResponse",u[u.SentFinalHandshake=7]="SentFinalHandshake",u[u.ReceivedFinalResponse=8]="ReceivedFinalResponse",u[u.BoundWaitingForConnection=9]="BoundWaitingForConnection",u[u.Established=10]="Established",u[u.Disconnected=11]="Disconnected",u[u.Error=99]="Error"})(d||(Ge.SocksClientState=d={})),Ge}var Ht={},ws={},FC;function tU(){if(FC)return ws;FC=1,Object.defineProperty(ws,"__esModule",{value:!0}),ws.shuffleArray=ws.SocksClientError=void 0;class e extends Error{constructor(r,s){super(r),this.options=s}}ws.SocksClientError=e;function t(n){for(let r=n.length-1;r>0;r--){const s=Math.floor(Math.random()*(r+1));[n[r],n[s]]=[n[s],n[r]]}}return ws.shuffleArray=t,ws}var or={},Rn={},wr={},jC;function IE(){if(jC)return wr;jC=1,Object.defineProperty(wr,"__esModule",{value:!0}),wr.isInSubnet=e,wr.isCorrect=t,wr.numberToPaddedHex=n,wr.stringToPaddedHex=r,wr.testBit=s;function e(i){return this.subnetMask<i.subnetMask?!1:this.mask(i.subnetMask)===i.mask()}function t(i){return function(){return this.addressMinusSuffix!==this.correctForm()?!1:this.subnetMask===i&&!this.parsedSubnet?!0:this.parsedSubnet===String(this.subnetMask)}}function n(i){return i.toString(16).padStart(2,"0")}function r(i){return n(parseInt(i,10))}function s(i,o){const{length:c}=i;if(o>c)return!1;const a=c-o;return i.substring(a,a+1)==="1"}return wr}var yn={},qC;function nU(){return qC||(qC=1,Object.defineProperty(yn,"__esModule",{value:!0}),yn.RE_SUBNET_STRING=yn.RE_ADDRESS=yn.GROUPS=yn.BITS=void 0,yn.BITS=32,yn.GROUPS=4,yn.RE_ADDRESS=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/g,yn.RE_SUBNET_STRING=/\/\d{1,2}$/),yn}var yc={},YC;function lS(){if(YC)return yc;YC=1,Object.defineProperty(yc,"__esModule",{value:!0}),yc.AddressError=void 0;class e extends Error{constructor(n,r){super(n),this.name="AddressError",this.parseMessage=r}}return yc.AddressError=e,yc}var WC;function rU(){if(WC)return Rn;WC=1;var e=Rn&&Rn.__createBinding||(Object.create?(function(c,a,l,f){f===void 0&&(f=l);var d=Object.getOwnPropertyDescriptor(a,l);(!d||("get"in d?!a.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return a[l]}}),Object.defineProperty(c,f,d)}):(function(c,a,l,f){f===void 0&&(f=l),c[f]=a[l]})),t=Rn&&Rn.__setModuleDefault||(Object.create?(function(c,a){Object.defineProperty(c,"default",{enumerable:!0,value:a})}):function(c,a){c.default=a}),n=Rn&&Rn.__importStar||function(c){if(c&&c.__esModule)return c;var a={};if(c!=null)for(var l in c)l!=="default"&&Object.prototype.hasOwnProperty.call(c,l)&&e(a,c,l);return t(a,c),a};Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.Address4=void 0;const r=n(IE()),s=n(nU()),i=lS();class o{constructor(a){this.groups=s.GROUPS,this.parsedAddress=[],this.parsedSubnet="",this.subnet="/32",this.subnetMask=32,this.v4=!0,this.isCorrect=r.isCorrect(s.BITS),this.isInSubnet=r.isInSubnet,this.address=a;const l=s.RE_SUBNET_STRING.exec(a);if(l){if(this.parsedSubnet=l[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet=`/${this.subnetMask}`,this.subnetMask<0||this.subnetMask>s.BITS)throw new i.AddressError("Invalid subnet mask.");a=a.replace(s.RE_SUBNET_STRING,"")}this.addressMinusSuffix=a,this.parsedAddress=this.parse(a)}static isValid(a){try{return new o(a),!0}catch{return!1}}parse(a){const l=a.split(".");if(!a.match(s.RE_ADDRESS))throw new i.AddressError("Invalid IPv4 address.");return l}correctForm(){return this.parsedAddress.map(a=>parseInt(a,10)).join(".")}static fromHex(a){const l=a.replace(/:/g,"").padStart(8,"0"),f=[];let d;for(d=0;d<8;d+=2){const u=l.slice(d,d+2);f.push(parseInt(u,16))}return new o(f.join("."))}static fromInteger(a){return o.fromHex(a.toString(16))}static fromArpa(a){const f=a.replace(/(\.in-addr\.arpa)?\.$/,"").split(".").reverse().join(".");return new o(f)}toHex(){return this.parsedAddress.map(a=>r.stringToPaddedHex(a)).join(":")}toArray(){return this.parsedAddress.map(a=>parseInt(a,10))}toGroup6(){const a=[];let l;for(l=0;l<s.GROUPS;l+=2)a.push(`${r.stringToPaddedHex(this.parsedAddress[l])}${r.stringToPaddedHex(this.parsedAddress[l+1])}`);return a.join(":")}bigInt(){return BigInt(`0x${this.parsedAddress.map(a=>r.stringToPaddedHex(a)).join("")}`)}_startAddress(){return BigInt(`0b${this.mask()+"0".repeat(s.BITS-this.subnetMask)}`)}startAddress(){return o.fromBigInt(this._startAddress())}startAddressExclusive(){const a=BigInt("1");return o.fromBigInt(this._startAddress()+a)}_endAddress(){return BigInt(`0b${this.mask()+"1".repeat(s.BITS-this.subnetMask)}`)}endAddress(){return o.fromBigInt(this._endAddress())}endAddressExclusive(){const a=BigInt("1");return o.fromBigInt(this._endAddress()-a)}static fromBigInt(a){return o.fromHex(a.toString(16))}static fromByteArray(a){if(a.length!==4)throw new i.AddressError("IPv4 addresses require exactly 4 bytes");for(let l=0;l<a.length;l++)if(!Number.isInteger(a[l])||a[l]<0||a[l]>255)throw new i.AddressError("All bytes must be integers between 0 and 255");return this.fromUnsignedByteArray(a)}static fromUnsignedByteArray(a){if(a.length!==4)throw new i.AddressError("IPv4 addresses require exactly 4 bytes");const l=a.join(".");return new o(l)}mask(a){return a===void 0&&(a=this.subnetMask),this.getBitsBase2(0,a)}getBitsBase2(a,l){return this.binaryZeroPad().slice(a,l)}reverseForm(a){a||(a={});const l=this.correctForm().split(".").reverse().join(".");return a.omitSuffix?l:`${l}.in-addr.arpa.`}isMulticast(){return this.isInSubnet(new o("224.0.0.0/4"))}binaryZeroPad(){return this.bigInt().toString(2).padStart(s.BITS,"0")}groupForV6(){const a=this.parsedAddress;return this.address.replace(s.RE_ADDRESS,`<span class="hover-group group-v4 group-6">${a.slice(0,2).join(".")}</span>.<span class="hover-group group-v4 group-7">${a.slice(2,4).join(".")}</span>`)}}return Rn.Address4=o,Rn}var Nn={},Qe={},KC;function sU(){return KC||(KC=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.RE_URL_WITH_PORT=Qe.RE_URL=Qe.RE_ZONE_STRING=Qe.RE_SUBNET_STRING=Qe.RE_BAD_ADDRESS=Qe.RE_BAD_CHARACTERS=Qe.TYPES=Qe.SCOPES=Qe.GROUPS=Qe.BITS=void 0,Qe.BITS=128,Qe.GROUPS=8,Qe.SCOPES={0:"Reserved",1:"Interface local",2:"Link local",4:"Admin local",5:"Site local",8:"Organization local",14:"Global",15:"Reserved"},Qe.TYPES={"ff01::1/128":"Multicast (All nodes on this interface)","ff01::2/128":"Multicast (All routers on this interface)","ff02::1/128":"Multicast (All nodes on this link)","ff02::2/128":"Multicast (All routers on this link)","ff05::2/128":"Multicast (All routers in this site)","ff02::5/128":"Multicast (OSPFv3 AllSPF routers)","ff02::6/128":"Multicast (OSPFv3 AllDR routers)","ff02::9/128":"Multicast (RIP routers)","ff02::a/128":"Multicast (EIGRP routers)","ff02::d/128":"Multicast (PIM routers)","ff02::16/128":"Multicast (MLDv2 reports)","ff01::fb/128":"Multicast (mDNSv6)","ff02::fb/128":"Multicast (mDNSv6)","ff05::fb/128":"Multicast (mDNSv6)","ff02::1:2/128":"Multicast (All DHCP servers and relay agents on this link)","ff05::1:2/128":"Multicast (All DHCP servers and relay agents in this site)","ff02::1:3/128":"Multicast (All DHCP servers on this link)","ff05::1:3/128":"Multicast (All DHCP servers in this site)","::/128":"Unspecified","::1/128":"Loopback","ff00::/8":"Multicast","fe80::/10":"Link-local unicast"},Qe.RE_BAD_CHARACTERS=/([^0-9a-f:/%])/gi,Qe.RE_BAD_ADDRESS=/([0-9a-f]{5,}|:{3,}|[^:]:$|^:[^:]|\/$)/gi,Qe.RE_SUBNET_STRING=/\/\d{1,3}(?=%|$)/,Qe.RE_ZONE_STRING=/%.*$/,Qe.RE_URL=/^\[{0,1}([0-9a-f:]+)\]{0,1}/,Qe.RE_URL_WITH_PORT=/\[([0-9a-f:]+)\]:([0-9]{1,5})/),Qe}var Ls={},zC;function iU(){if(zC)return Ls;zC=1,Object.defineProperty(Ls,"__esModule",{value:!0}),Ls.spanAllZeroes=e,Ls.spanAll=t,Ls.spanLeadingZeroes=r,Ls.simpleGroup=s;function e(i){return i.replace(/(0+)/g,'<span class="zero">$1</span>')}function t(i,o=0){return i.split("").map((a,l)=>`<span class="digit value-${a} position-${l+o}">${e(a)}</span>`).join("")}function n(i){return i.replace(/^(0+)/,'<span class="zero">$1</span>')}function r(i){return i.split(":").map(c=>n(c)).join(":")}function s(i,o=0){return i.split(":").map((a,l)=>/group-v4/.test(a)?a:`<span class="hover-group group-${l+o}">${n(a)}</span>`)}return Ls}var It={},ZC;function xJ(){if(ZC)return It;ZC=1;var e=It&&It.__createBinding||(Object.create?(function(a,l,f,d){d===void 0&&(d=f);var u=Object.getOwnPropertyDescriptor(l,f);(!u||("get"in u?!l.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return l[f]}}),Object.defineProperty(a,d,u)}):(function(a,l,f,d){d===void 0&&(d=f),a[d]=l[f]})),t=It&&It.__setModuleDefault||(Object.create?(function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}):function(a,l){a.default=l}),n=It&&It.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&e(l,a,f);return t(l,a),l};Object.defineProperty(It,"__esModule",{value:!0}),It.ADDRESS_BOUNDARY=void 0,It.groupPossibilities=s,It.padGroup=i,It.simpleRegularExpression=o,It.possibleElisions=c;const r=n(sU());function s(a){return`(${a.join("|")})`}function i(a){return a.length<4?`0{0,${4-a.length}}${a}`:a}It.ADDRESS_BOUNDARY="[^A-Fa-f0-9:]";function o(a){const l=[];a.forEach((d,u)=>{parseInt(d,16)===0&&l.push(u)});const f=l.map(d=>a.map((u,_)=>{if(_===d){const p=_===0||_===r.GROUPS-1?":":"";return s([i(u),p])}return i(u)}).join(":"));return f.push(a.map(i).join(":")),s(f)}function c(a,l,f){const d=l?"":":",u=f?"":":",_=[];!l&&!f&&_.push("::"),l&&f&&_.push(""),(f&&!l||!f&&l)&&_.push(":"),_.push(`${d}(:0{1,4}){1,${a-1}}`),_.push(`(0{1,4}:){1,${a-1}}${u}`),_.push(`(0{1,4}:){${a-1}}0{1,4}`);for(let p=1;p<a-1;p++)for(let h=1;h<a-p;h++)_.push(`(0{1,4}:){${h}}:(0{1,4}:){${a-h-p-1}}0{1,4}`);return s(_)}return It}var XC;function BJ(){if(XC)return Nn;XC=1;var e=Nn&&Nn.__createBinding||(Object.create?(function(S,m,g,y){y===void 0&&(y=g);var A=Object.getOwnPropertyDescriptor(m,g);(!A||("get"in A?!m.__esModule:A.writable||A.configurable))&&(A={enumerable:!0,get:function(){return m[g]}}),Object.defineProperty(S,y,A)}):(function(S,m,g,y){y===void 0&&(y=g),S[y]=m[g]})),t=Nn&&Nn.__setModuleDefault||(Object.create?(function(S,m){Object.defineProperty(S,"default",{enumerable:!0,value:m})}):function(S,m){S.default=m}),n=Nn&&Nn.__importStar||function(S){if(S&&S.__esModule)return S;var m={};if(S!=null)for(var g in S)g!=="default"&&Object.prototype.hasOwnProperty.call(S,g)&&e(m,S,g);return t(m,S),m};Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.Address6=void 0;const r=n(IE()),s=n(nU()),i=n(sU()),o=n(iU()),c=rU(),a=xJ(),l=lS(),f=IE();function d(S){if(!S)throw new Error("Assertion failed.")}function u(S){const m=/(\d+)(\d{3})/;for(;m.test(S);)S=S.replace(m,"$1,$2");return S}function _(S){return S=S.replace(/^(0{1,})([1-9]+)$/,'<span class="parse-error">$1</span>$2'),S=S.replace(/^(0{1,})(0)$/,'<span class="parse-error">$1</span>$2'),S}function p(S,m){const g=[],y=[];let A;for(A=0;A<S.length;A++)A<m[0]?g.push(S[A]):A>m[1]&&y.push(S[A]);return g.concat(["compact"]).concat(y)}function h(S){return parseInt(S,16).toString(16).padStart(4,"0")}function E(S){return S&255}class T{constructor(m,g){this.addressMinusSuffix="",this.parsedSubnet="",this.subnet="/128",this.subnetMask=128,this.v4=!1,this.zone="",this.isInSubnet=r.isInSubnet,this.isCorrect=r.isCorrect(i.BITS),g===void 0?this.groups=i.GROUPS:this.groups=g,this.address=m;const y=i.RE_SUBNET_STRING.exec(m);if(y){if(this.parsedSubnet=y[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet=`/${this.subnetMask}`,Number.isNaN(this.subnetMask)||this.subnetMask<0||this.subnetMask>i.BITS)throw new l.AddressError("Invalid subnet mask.");m=m.replace(i.RE_SUBNET_STRING,"")}else if(/\//.test(m))throw new l.AddressError("Invalid subnet mask.");const A=i.RE_ZONE_STRING.exec(m);A&&(this.zone=A[0],m=m.replace(i.RE_ZONE_STRING,"")),this.addressMinusSuffix=m,this.parsedAddress=this.parse(this.addressMinusSuffix)}static isValid(m){try{return new T(m),!0}catch{return!1}}static fromBigInt(m){const g=m.toString(16).padStart(32,"0"),y=[];let A;for(A=0;A<i.GROUPS;A++)y.push(g.slice(A*4,(A+1)*4));return new T(y.join(":"))}static fromURL(m){let g,y=null,A;if(m.indexOf("[")!==-1&&m.indexOf("]:")!==-1){if(A=i.RE_URL_WITH_PORT.exec(m),A===null)return{error:"failed to parse address with port",address:null,port:null};g=A[1],y=A[2]}else if(m.indexOf("/")!==-1){if(m=m.replace(/^[a-z0-9]+:\/\//,""),A=i.RE_URL.exec(m),A===null)return{error:"failed to parse address from URL",address:null,port:null};g=A[1]}else g=m;return y?(y=parseInt(y,10),(y<0||y>65536)&&(y=null)):y=null,{address:new T(g),port:y}}static fromAddress4(m){const g=new c.Address4(m),y=i.BITS-(s.BITS-g.subnetMask);return new T(`::ffff:${g.correctForm()}/${y}`)}static fromArpa(m){let g=m.replace(/(\.ip6\.arpa)?\.$/,"");const y=7;if(g.length!==63)throw new l.AddressError("Invalid 'ip6.arpa' form.");const A=g.split(".").reverse();for(let N=y;N>0;N--){const O=N*4;A.splice(O,0,":")}return g=A.join(""),new T(g)}microsoftTranscription(){return`${this.correctForm().replace(/:/g,"-")}.ipv6-literal.net`}mask(m=this.subnetMask){return this.getBitsBase2(0,m)}possibleSubnets(m=128){const g=i.BITS-this.subnetMask,y=Math.abs(m-i.BITS),A=g-y;return A<0?"0":u((BigInt("2")**BigInt(A)).toString(10))}_startAddress(){return BigInt(`0b${this.mask()+"0".repeat(i.BITS-this.subnetMask)}`)}startAddress(){return T.fromBigInt(this._startAddress())}startAddressExclusive(){const m=BigInt("1");return T.fromBigInt(this._startAddress()+m)}_endAddress(){return BigInt(`0b${this.mask()+"1".repeat(i.BITS-this.subnetMask)}`)}endAddress(){return T.fromBigInt(this._endAddress())}endAddressExclusive(){const m=BigInt("1");return T.fromBigInt(this._endAddress()-m)}getScope(){let m=i.SCOPES[parseInt(this.getBits(12,16).toString(10),10)];return this.getType()==="Global unicast"&&m!=="Link local"&&(m="Global"),m||"Unknown"}getType(){for(const m of Object.keys(i.TYPES))if(this.isInSubnet(new T(m)))return i.TYPES[m];return"Global unicast"}getBits(m,g){return BigInt(`0b${this.getBitsBase2(m,g)}`)}getBitsBase2(m,g){return this.binaryZeroPad().slice(m,g)}getBitsBase16(m,g){const y=g-m;if(y%4!==0)throw new Error("Length of bits to retrieve must be divisible by four");return this.getBits(m,g).toString(16).padStart(y/4,"0")}getBitsPastSubnet(){return this.getBitsBase2(this.subnetMask,i.BITS)}reverseForm(m){m||(m={});const g=Math.floor(this.subnetMask/4),y=this.canonicalForm().replace(/:/g,"").split("").slice(0,g).reverse().join(".");return g>0?m.omitSuffix?y:`${y}.ip6.arpa.`:m.omitSuffix?"":"ip6.arpa."}correctForm(){let m,g=[],y=0;const A=[];for(m=0;m<this.parsedAddress.length;m++){const b=parseInt(this.parsedAddress[m],16);b===0&&y++,b!==0&&y>0&&(y>1&&A.push([m-y,m-1]),y=0)}y>1&&A.push([this.parsedAddress.length-y,this.parsedAddress.length-1]);const N=A.map(b=>b[1]-b[0]+1);if(A.length>0){const b=N.indexOf(Math.max(...N));g=p(this.parsedAddress,A[b])}else g=this.parsedAddress;for(m=0;m<g.length;m++)g[m]!=="compact"&&(g[m]=parseInt(g[m],16).toString(16));let O=g.join(":");return O=O.replace(/^compact$/,"::"),O=O.replace(/(^compact)|(compact$)/,":"),O=O.replace(/compact/,""),O}binaryZeroPad(){return this.bigInt().toString(2).padStart(i.BITS,"0")}parse4in6(m){const g=m.split(":"),A=g.slice(-1)[0].match(s.RE_ADDRESS);if(A){this.parsedAddress4=A[0],this.address4=new c.Address4(this.parsedAddress4);for(let N=0;N<this.address4.groups;N++)if(/^0[0-9]+/.test(this.address4.parsedAddress[N]))throw new l.AddressError("IPv4 addresses can't have leading zeroes.",m.replace(s.RE_ADDRESS,this.address4.parsedAddress.map(_).join(".")));this.v4=!0,g[g.length-1]=this.address4.toGroup6(),m=g.join(":")}return m}parse(m){m=this.parse4in6(m);const g=m.match(i.RE_BAD_CHARACTERS);if(g)throw new l.AddressError(`Bad character${g.length>1?"s":""} detected in address: ${g.join("")}`,m.replace(i.RE_BAD_CHARACTERS,'<span class="parse-error">$1</span>'));const y=m.match(i.RE_BAD_ADDRESS);if(y)throw new l.AddressError(`Address failed regex: ${y.join("")}`,m.replace(i.RE_BAD_ADDRESS,'<span class="parse-error">$1</span>'));let A=[];const N=m.split("::");if(N.length===2){let O=N[0].split(":"),b=N[1].split(":");O.length===1&&O[0]===""&&(O=[]),b.length===1&&b[0]===""&&(b=[]);const C=this.groups-(O.length+b.length);if(!C)throw new l.AddressError("Error parsing groups");this.elidedGroups=C,this.elisionBegin=O.length,this.elisionEnd=O.length+this.elidedGroups,A=A.concat(O);for(let w=0;w<C;w++)A.push("0");A=A.concat(b)}else if(N.length===1)A=m.split(":"),this.elidedGroups=0;else throw new l.AddressError("Too many :: groups found");if(A=A.map(O=>parseInt(O,16).toString(16)),A.length!==this.groups)throw new l.AddressError("Incorrect number of groups found");return A}canonicalForm(){return this.parsedAddress.map(h).join(":")}decimal(){return this.parsedAddress.map(m=>parseInt(m,16).toString(10).padStart(5,"0")).join(":")}bigInt(){return BigInt(`0x${this.parsedAddress.map(h).join("")}`)}to4(){const m=this.binaryZeroPad().split("");return c.Address4.fromHex(BigInt(`0b${m.slice(96,128).join("")}`).toString(16))}to4in6(){const m=this.to4(),y=new T(this.parsedAddress.slice(0,6).join(":"),6).correctForm();let A="";return/:$/.test(y)||(A=":"),y+A+m.address}inspectTeredo(){const m=this.getBitsBase16(0,32),y=(this.getBits(80,96)^BigInt("0xffff")).toString(),A=c.Address4.fromHex(this.getBitsBase16(32,64)),N=this.getBits(96,128),O=c.Address4.fromHex((N^BigInt("0xffffffff")).toString(16)),b=this.getBitsBase2(64,80),C=(0,f.testBit)(b,15),w=(0,f.testBit)(b,14),k=(0,f.testBit)(b,8),U=(0,f.testBit)(b,9),M=BigInt(`0b${b.slice(2,6)+b.slice(8,16)}`).toString(10);return{prefix:`${m.slice(0,4)}:${m.slice(4,8)}`,server4:A.address,client4:O.address,flags:b,coneNat:C,microsoft:{reserved:w,universalLocal:U,groupIndividual:k,nonce:M},udpPort:y}}inspect6to4(){const m=this.getBitsBase16(0,16),g=c.Address4.fromHex(this.getBitsBase16(16,48));return{prefix:m.slice(0,4),gateway:g.address}}to6to4(){if(!this.is4())return null;const m=["2002",this.getBitsBase16(96,112),this.getBitsBase16(112,128),"","/16"].join(":");return new T(m)}toByteArray(){const m=this.bigInt().toString(16),y=`${"0".repeat(m.length%2)}${m}`,A=[];for(let N=0,O=y.length;N<O;N+=2)A.push(parseInt(y.substring(N,N+2),16));return A}toUnsignedByteArray(){return this.toByteArray().map(E)}static fromByteArray(m){return this.fromUnsignedByteArray(m.map(E))}static fromUnsignedByteArray(m){const g=BigInt("256");let y=BigInt("0"),A=BigInt("1");for(let N=m.length-1;N>=0;N--)y+=A*BigInt(m[N].toString(10)),A*=g;return T.fromBigInt(y)}isCanonical(){return this.addressMinusSuffix===this.canonicalForm()}isLinkLocal(){return this.getBitsBase2(0,64)==="1111111010000000000000000000000000000000000000000000000000000000"}isMulticast(){return this.getType()==="Multicast"}is4(){return this.v4}isTeredo(){return this.isInSubnet(new T("2001::/32"))}is6to4(){return this.isInSubnet(new T("2002::/16"))}isLoopback(){return this.getType()==="Loopback"}href(m){return m===void 0?m="":m=`:${m}`,`http://[${this.correctForm()}]${m}/`}link(m){m||(m={}),m.className===void 0&&(m.className=""),m.prefix===void 0&&(m.prefix="/#address="),m.v4===void 0&&(m.v4=!1);let g=this.correctForm;m.v4&&(g=this.to4in6);const y=g.call(this);return m.className?`<a href="${m.prefix}${y}" class="${m.className}">${y}</a>`:`<a href="${m.prefix}${y}">${y}</a>`}group(){if(this.elidedGroups===0)return o.simpleGroup(this.address).join(":");d(typeof this.elidedGroups=="number"),d(typeof this.elisionBegin=="number");const m=[],[g,y]=this.address.split("::");g.length?m.push(...o.simpleGroup(g)):m.push("");const A=["hover-group"];for(let N=this.elisionBegin;N<this.elisionBegin+this.elidedGroups;N++)A.push(`group-${N}`);return m.push(`<span class="${A.join(" ")}"></span>`),y.length?m.push(...o.simpleGroup(y,this.elisionEnd)):m.push(""),this.is4()&&(d(this.address4 instanceof c.Address4),m.pop(),m.push(this.address4.groupForV6())),m.join(":")}regularExpressionString(m=!1){let g=[];const y=new T(this.correctForm());if(y.elidedGroups===0)g.push((0,a.simpleRegularExpression)(y.parsedAddress));else if(y.elidedGroups===i.GROUPS)g.push((0,a.possibleElisions)(i.GROUPS));else{const A=y.address.split("::");A[0].length&&g.push((0,a.simpleRegularExpression)(A[0].split(":"))),d(typeof y.elidedGroups=="number"),g.push((0,a.possibleElisions)(y.elidedGroups,A[0].length!==0,A[1].length!==0)),A[1].length&&g.push((0,a.simpleRegularExpression)(A[1].split(":"))),g=[g.join(":")]}return m||(g=["(?=^|",a.ADDRESS_BOUNDARY,"|[^\\w\\:])(",...g,")(?=[^\\w\\:]|",a.ADDRESS_BOUNDARY,"|$)"]),g.join("")}regularExpression(m=!1){return new RegExp(this.regularExpressionString(m),"i")}}return Nn.Address6=T,Nn}var QC;function oU(){return QC||(QC=1,(function(e){var t=or&&or.__createBinding||(Object.create?(function(a,l,f,d){d===void 0&&(d=f);var u=Object.getOwnPropertyDescriptor(l,f);(!u||("get"in u?!l.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return l[f]}}),Object.defineProperty(a,d,u)}):(function(a,l,f,d){d===void 0&&(d=f),a[d]=l[f]})),n=or&&or.__setModuleDefault||(Object.create?(function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}):function(a,l){a.default=l}),r=or&&or.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&t(l,a,f);return n(l,a),l};Object.defineProperty(e,"__esModule",{value:!0}),e.v6=e.AddressError=e.Address6=e.Address4=void 0;var s=rU();Object.defineProperty(e,"Address4",{enumerable:!0,get:function(){return s.Address4}});var i=BJ();Object.defineProperty(e,"Address6",{enumerable:!0,get:function(){return i.Address6}});var o=lS();Object.defineProperty(e,"AddressError",{enumerable:!0,get:function(){return o.AddressError}});const c=r(iU());e.v6={helpers:c}})(or)),or}var JC;function GJ(){if(JC)return Ht;JC=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.ipToBuffer=Ht.int32ToIpv4=Ht.ipv4ToInt32=Ht.validateSocksClientChainOptions=Ht.validateSocksClientOptions=void 0;const e=tU(),t=eU(),n=Sr,r=oU(),s=au;function i(p,h=["connect","bind","associate"]){if(!t.SocksCommand[p.command])throw new e.SocksClientError(t.ERRORS.InvalidSocksCommand,p);if(h.indexOf(p.command)===-1)throw new e.SocksClientError(t.ERRORS.InvalidSocksCommandForOperation,p);if(!a(p.destination))throw new e.SocksClientError(t.ERRORS.InvalidSocksClientOptionsDestination,p);if(!l(p.proxy))throw new e.SocksClientError(t.ERRORS.InvalidSocksClientOptionsProxy,p);if(c(p.proxy,p),p.timeout&&!f(p.timeout))throw new e.SocksClientError(t.ERRORS.InvalidSocksClientOptionsTimeout,p);if(p.existing_socket&&!(p.existing_socket instanceof n.Duplex))throw new e.SocksClientError(t.ERRORS.InvalidSocksClientOptionsExistingSocket,p)}Ht.validateSocksClientOptions=i;function o(p){if(p.command!=="connect")throw new e.SocksClientError(t.ERRORS.InvalidSocksCommandChain,p);if(!a(p.destination))throw new e.SocksClientError(t.ERRORS.InvalidSocksClientOptionsDestination,p);if(!(p.proxies&&Array.isArray(p.proxies)&&p.proxies.length>=2))throw new e.SocksClientError(t.ERRORS.InvalidSocksClientOptionsProxiesLength,p);if(p.proxies.forEach(h=>{if(!l(h))throw new e.SocksClientError(t.ERRORS.InvalidSocksClientOptionsProxy,p);c(h,p)}),p.timeout&&!f(p.timeout))throw new e.SocksClientError(t.ERRORS.InvalidSocksClientOptionsTimeout,p)}Ht.validateSocksClientChainOptions=o;function c(p,h){if(p.custom_auth_method!==void 0){if(p.custom_auth_method<t.SOCKS5_CUSTOM_AUTH_START||p.custom_auth_method>t.SOCKS5_CUSTOM_AUTH_END)throw new e.SocksClientError(t.ERRORS.InvalidSocksClientOptionsCustomAuthRange,h);if(p.custom_auth_request_handler===void 0||typeof p.custom_auth_request_handler!="function")throw new e.SocksClientError(t.ERRORS.InvalidSocksClientOptionsCustomAuthOptions,h);if(p.custom_auth_response_size===void 0)throw new e.SocksClientError(t.ERRORS.InvalidSocksClientOptionsCustomAuthOptions,h);if(p.custom_auth_response_handler===void 0||typeof p.custom_auth_response_handler!="function")throw new e.SocksClientError(t.ERRORS.InvalidSocksClientOptionsCustomAuthOptions,h)}}function a(p){return p&&typeof p.host=="string"&&Buffer.byteLength(p.host)<256&&typeof p.port=="number"&&p.port>=0&&p.port<=65535}function l(p){return p&&(typeof p.host=="string"||typeof p.ipaddress=="string")&&typeof p.port=="number"&&p.port>=0&&p.port<=65535&&(p.type===4||p.type===5)}function f(p){return typeof p=="number"&&p>0}function d(p){return new r.Address4(p).toArray().reduce((E,T)=>(E<<8)+T,0)>>>0}Ht.ipv4ToInt32=d;function u(p){const h=p>>>24&255,E=p>>>16&255,T=p>>>8&255,S=p&255;return[h,E,T,S].join(".")}Ht.int32ToIpv4=u;function _(p){if(s.isIPv4(p)){const h=new r.Address4(p);return Buffer.from(h.toArray())}else if(s.isIPv6(p)){const h=new r.Address6(p);return Buffer.from(h.canonicalForm().split(":").map(E=>E.padStart(4,"0")).join(""),"hex")}else throw new Error("Invalid IP address format")}return Ht.ipToBuffer=_,Ht}var Nc={},ev;function VJ(){if(ev)return Nc;ev=1,Object.defineProperty(Nc,"__esModule",{value:!0}),Nc.ReceiveBuffer=void 0;class e{constructor(n=4096){this.buffer=Buffer.allocUnsafe(n),this.offset=0,this.originalSize=n}get length(){return this.offset}append(n){if(!Buffer.isBuffer(n))throw new Error("Attempted to append a non-buffer instance to ReceiveBuffer.");if(this.offset+n.length>=this.buffer.length){const r=this.buffer;this.buffer=Buffer.allocUnsafe(Math.max(this.buffer.length+this.originalSize,this.buffer.length+n.length)),r.copy(this.buffer)}return n.copy(this.buffer,this.offset),this.offset+=n.length}peek(n){if(n>this.offset)throw new Error("Attempted to read beyond the bounds of the managed internal data.");return this.buffer.slice(0,n)}get(n){if(n>this.offset)throw new Error("Attempted to read beyond the bounds of the managed internal data.");const r=Buffer.allocUnsafe(n);return this.buffer.slice(0,n).copy(r),this.buffer.copyWithin(0,n,n+this.offset-n),this.offset-=n,r}}return Nc.ReceiveBuffer=e,Nc}var tv;function $J(){return tv||(tv=1,(function(e){var t=Rc&&Rc.__awaiter||function(d,u,_,p){function h(E){return E instanceof _?E:new _(function(T){T(E)})}return new(_||(_=Promise))(function(E,T){function S(y){try{g(p.next(y))}catch(A){T(A)}}function m(y){try{g(p.throw(y))}catch(A){T(A)}}function g(y){y.done?E(y.value):h(y.value).then(S,m)}g((p=p.apply(d,u||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.SocksClientError=e.SocksClient=void 0;const n=Hr,r=au,s=kJ(),i=eU(),o=GJ(),c=VJ(),a=tU();Object.defineProperty(e,"SocksClientError",{enumerable:!0,get:function(){return a.SocksClientError}});const l=oU();class f extends n.EventEmitter{constructor(u){super(),this.options=Object.assign({},u),(0,o.validateSocksClientOptions)(u),this.setState(i.SocksClientState.Created)}static createConnection(u,_){return new Promise((p,h)=>{try{(0,o.validateSocksClientOptions)(u,["connect"])}catch(T){return typeof _=="function"?(_(T),p(T)):h(T)}const E=new f(u);E.connect(u.existing_socket),E.once("established",T=>{E.removeAllListeners(),typeof _=="function"&&_(null,T),p(T)}),E.once("error",T=>{E.removeAllListeners(),typeof _=="function"?(_(T),p(T)):h(T)})})}static createConnectionChain(u,_){return new Promise((p,h)=>t(this,void 0,void 0,function*(){try{(0,o.validateSocksClientChainOptions)(u)}catch(E){return typeof _=="function"?(_(E),p(E)):h(E)}u.randomizeChain&&(0,a.shuffleArray)(u.proxies);try{let E;for(let T=0;T<u.proxies.length;T++){const S=u.proxies[T],m=T===u.proxies.length-1?u.destination:{host:u.proxies[T+1].host||u.proxies[T+1].ipaddress,port:u.proxies[T+1].port},g=yield f.createConnection({command:"connect",proxy:S,destination:m,existing_socket:E});E=E||g.socket}typeof _=="function"?(_(null,{socket:E}),p({socket:E})):p({socket:E})}catch(E){typeof _=="function"?(_(E),p(E)):h(E)}}))}static createUDPFrame(u){const _=new s.SmartBuffer;return _.writeUInt16BE(0),_.writeUInt8(u.frameNumber||0),r.isIPv4(u.remoteHost.host)?(_.writeUInt8(i.Socks5HostType.IPv4),_.writeUInt32BE((0,o.ipv4ToInt32)(u.remoteHost.host))):r.isIPv6(u.remoteHost.host)?(_.writeUInt8(i.Socks5HostType.IPv6),_.writeBuffer((0,o.ipToBuffer)(u.remoteHost.host))):(_.writeUInt8(i.Socks5HostType.Hostname),_.writeUInt8(Buffer.byteLength(u.remoteHost.host)),_.writeString(u.remoteHost.host)),_.writeUInt16BE(u.remoteHost.port),_.writeBuffer(u.data),_.toBuffer()}static parseUDPFrame(u){const _=s.SmartBuffer.fromBuffer(u);_.readOffset=2;const p=_.readUInt8(),h=_.readUInt8();let E;h===i.Socks5HostType.IPv4?E=(0,o.int32ToIpv4)(_.readUInt32BE()):h===i.Socks5HostType.IPv6?E=l.Address6.fromByteArray(Array.from(_.readBuffer(16))).canonicalForm():E=_.readString(_.readUInt8());const T=_.readUInt16BE();return{frameNumber:p,remoteHost:{host:E,port:T},data:_.readBuffer()}}setState(u){this.state!==i.SocksClientState.Error&&(this.state=u)}connect(u){this.onDataReceived=p=>this.onDataReceivedHandler(p),this.onClose=()=>this.onCloseHandler(),this.onError=p=>this.onErrorHandler(p),this.onConnect=()=>this.onConnectHandler();const _=setTimeout(()=>this.onEstablishedTimeout(),this.options.timeout||i.DEFAULT_TIMEOUT);_.unref&&typeof _.unref=="function"&&_.unref(),u?this.socket=u:this.socket=new r.Socket,this.socket.once("close",this.onClose),this.socket.once("error",this.onError),this.socket.once("connect",this.onConnect),this.socket.on("data",this.onDataReceived),this.setState(i.SocksClientState.Connecting),this.receiveBuffer=new c.ReceiveBuffer,u?this.socket.emit("connect"):(this.socket.connect(this.getSocketOptions()),this.options.set_tcp_nodelay!==void 0&&this.options.set_tcp_nodelay!==null&&this.socket.setNoDelay(!!this.options.set_tcp_nodelay)),this.prependOnceListener("established",p=>{setImmediate(()=>{if(this.receiveBuffer.length>0){const h=this.receiveBuffer.get(this.receiveBuffer.length);p.socket.emit("data",h)}p.socket.resume()})})}getSocketOptions(){return Object.assign(Object.assign({},this.options.socket_options),{host:this.options.proxy.host||this.options.proxy.ipaddress,port:this.options.proxy.port})}onEstablishedTimeout(){this.state!==i.SocksClientState.Established&&this.state!==i.SocksClientState.BoundWaitingForConnection&&this.closeSocket(i.ERRORS.ProxyConnectionTimedOut)}onConnectHandler(){this.setState(i.SocksClientState.Connected),this.options.proxy.type===4?this.sendSocks4InitialHandshake():this.sendSocks5InitialHandshake(),this.setState(i.SocksClientState.SentInitialHandshake)}onDataReceivedHandler(u){this.receiveBuffer.append(u),this.processData()}processData(){for(;this.state!==i.SocksClientState.Established&&this.state!==i.SocksClientState.Error&&this.receiveBuffer.length>=this.nextRequiredPacketBufferSize;)if(this.state===i.SocksClientState.SentInitialHandshake)this.options.proxy.type===4?this.handleSocks4FinalHandshakeResponse():this.handleInitialSocks5HandshakeResponse();else if(this.state===i.SocksClientState.SentAuthentication)this.handleInitialSocks5AuthenticationHandshakeResponse();else if(this.state===i.SocksClientState.SentFinalHandshake)this.handleSocks5FinalHandshakeResponse();else if(this.state===i.SocksClientState.BoundWaitingForConnection)this.options.proxy.type===4?this.handleSocks4IncomingConnectionResponse():this.handleSocks5IncomingConnectionResponse();else{this.closeSocket(i.ERRORS.InternalError);break}}onCloseHandler(){this.closeSocket(i.ERRORS.SocketClosed)}onErrorHandler(u){this.closeSocket(u.message)}removeInternalSocketHandlers(){this.socket.pause(),this.socket.removeListener("data",this.onDataReceived),this.socket.removeListener("close",this.onClose),this.socket.removeListener("error",this.onError),this.socket.removeListener("connect",this.onConnect)}closeSocket(u){this.state!==i.SocksClientState.Error&&(this.setState(i.SocksClientState.Error),this.socket.destroy(),this.removeInternalSocketHandlers(),this.emit("error",new a.SocksClientError(u,this.options)))}sendSocks4InitialHandshake(){const u=this.options.proxy.userId||"",_=new s.SmartBuffer;_.writeUInt8(4),_.writeUInt8(i.SocksCommand[this.options.command]),_.writeUInt16BE(this.options.destination.port),r.isIPv4(this.options.destination.host)?(_.writeBuffer((0,o.ipToBuffer)(this.options.destination.host)),_.writeStringNT(u)):(_.writeUInt8(0),_.writeUInt8(0),_.writeUInt8(0),_.writeUInt8(1),_.writeStringNT(u),_.writeStringNT(this.options.destination.host)),this.nextRequiredPacketBufferSize=i.SOCKS_INCOMING_PACKET_SIZES.Socks4Response,this.socket.write(_.toBuffer())}handleSocks4FinalHandshakeResponse(){const u=this.receiveBuffer.get(8);if(u[1]!==i.Socks4Response.Granted)this.closeSocket(`${i.ERRORS.Socks4ProxyRejectedConnection} - (${i.Socks4Response[u[1]]})`);else if(i.SocksCommand[this.options.command]===i.SocksCommand.bind){const _=s.SmartBuffer.fromBuffer(u);_.readOffset=2;const p={port:_.readUInt16BE(),host:(0,o.int32ToIpv4)(_.readUInt32BE())};p.host==="0.0.0.0"&&(p.host=this.options.proxy.ipaddress),this.setState(i.SocksClientState.BoundWaitingForConnection),this.emit("bound",{remoteHost:p,socket:this.socket})}else this.setState(i.SocksClientState.Established),this.removeInternalSocketHandlers(),this.emit("established",{socket:this.socket})}handleSocks4IncomingConnectionResponse(){const u=this.receiveBuffer.get(8);if(u[1]!==i.Socks4Response.Granted)this.closeSocket(`${i.ERRORS.Socks4ProxyRejectedIncomingBoundConnection} - (${i.Socks4Response[u[1]]})`);else{const _=s.SmartBuffer.fromBuffer(u);_.readOffset=2;const p={port:_.readUInt16BE(),host:(0,o.int32ToIpv4)(_.readUInt32BE())};this.setState(i.SocksClientState.Established),this.removeInternalSocketHandlers(),this.emit("established",{remoteHost:p,socket:this.socket})}}sendSocks5InitialHandshake(){const u=new s.SmartBuffer,_=[i.Socks5Auth.NoAuth];(this.options.proxy.userId||this.options.proxy.password)&&_.push(i.Socks5Auth.UserPass),this.options.proxy.custom_auth_method!==void 0&&_.push(this.options.proxy.custom_auth_method),u.writeUInt8(5),u.writeUInt8(_.length);for(const p of _)u.writeUInt8(p);this.nextRequiredPacketBufferSize=i.SOCKS_INCOMING_PACKET_SIZES.Socks5InitialHandshakeResponse,this.socket.write(u.toBuffer()),this.setState(i.SocksClientState.SentInitialHandshake)}handleInitialSocks5HandshakeResponse(){const u=this.receiveBuffer.get(2);u[0]!==5?this.closeSocket(i.ERRORS.InvalidSocks5IntiailHandshakeSocksVersion):u[1]===i.SOCKS5_NO_ACCEPTABLE_AUTH?this.closeSocket(i.ERRORS.InvalidSocks5InitialHandshakeNoAcceptedAuthType):u[1]===i.Socks5Auth.NoAuth?(this.socks5ChosenAuthType=i.Socks5Auth.NoAuth,this.sendSocks5CommandRequest()):u[1]===i.Socks5Auth.UserPass?(this.socks5ChosenAuthType=i.Socks5Auth.UserPass,this.sendSocks5UserPassAuthentication()):u[1]===this.options.proxy.custom_auth_method?(this.socks5ChosenAuthType=this.options.proxy.custom_auth_method,this.sendSocks5CustomAuthentication()):this.closeSocket(i.ERRORS.InvalidSocks5InitialHandshakeUnknownAuthType)}sendSocks5UserPassAuthentication(){const u=this.options.proxy.userId||"",_=this.options.proxy.password||"",p=new s.SmartBuffer;p.writeUInt8(1),p.writeUInt8(Buffer.byteLength(u)),p.writeString(u),p.writeUInt8(Buffer.byteLength(_)),p.writeString(_),this.nextRequiredPacketBufferSize=i.SOCKS_INCOMING_PACKET_SIZES.Socks5UserPassAuthenticationResponse,this.socket.write(p.toBuffer()),this.setState(i.SocksClientState.SentAuthentication)}sendSocks5CustomAuthentication(){return t(this,void 0,void 0,function*(){this.nextRequiredPacketBufferSize=this.options.proxy.custom_auth_response_size,this.socket.write(yield this.options.proxy.custom_auth_request_handler()),this.setState(i.SocksClientState.SentAuthentication)})}handleSocks5CustomAuthHandshakeResponse(u){return t(this,void 0,void 0,function*(){return yield this.options.proxy.custom_auth_response_handler(u)})}handleSocks5AuthenticationNoAuthHandshakeResponse(u){return t(this,void 0,void 0,function*(){return u[1]===0})}handleSocks5AuthenticationUserPassHandshakeResponse(u){return t(this,void 0,void 0,function*(){return u[1]===0})}handleInitialSocks5AuthenticationHandshakeResponse(){return t(this,void 0,void 0,function*(){this.setState(i.SocksClientState.ReceivedAuthenticationResponse);let u=!1;this.socks5ChosenAuthType===i.Socks5Auth.NoAuth?u=yield this.handleSocks5AuthenticationNoAuthHandshakeResponse(this.receiveBuffer.get(2)):this.socks5ChosenAuthType===i.Socks5Auth.UserPass?u=yield this.handleSocks5AuthenticationUserPassHandshakeResponse(this.receiveBuffer.get(2)):this.socks5ChosenAuthType===this.options.proxy.custom_auth_method&&(u=yield this.handleSocks5CustomAuthHandshakeResponse(this.receiveBuffer.get(this.options.proxy.custom_auth_response_size))),u?this.sendSocks5CommandRequest():this.closeSocket(i.ERRORS.Socks5AuthenticationFailed)})}sendSocks5CommandRequest(){const u=new s.SmartBuffer;u.writeUInt8(5),u.writeUInt8(i.SocksCommand[this.options.command]),u.writeUInt8(0),r.isIPv4(this.options.destination.host)?(u.writeUInt8(i.Socks5HostType.IPv4),u.writeBuffer((0,o.ipToBuffer)(this.options.destination.host))):r.isIPv6(this.options.destination.host)?(u.writeUInt8(i.Socks5HostType.IPv6),u.writeBuffer((0,o.ipToBuffer)(this.options.destination.host))):(u.writeUInt8(i.Socks5HostType.Hostname),u.writeUInt8(this.options.destination.host.length),u.writeString(this.options.destination.host)),u.writeUInt16BE(this.options.destination.port),this.nextRequiredPacketBufferSize=i.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseHeader,this.socket.write(u.toBuffer()),this.setState(i.SocksClientState.SentFinalHandshake)}handleSocks5FinalHandshakeResponse(){const u=this.receiveBuffer.peek(5);if(u[0]!==5||u[1]!==i.Socks5Response.Granted)this.closeSocket(`${i.ERRORS.InvalidSocks5FinalHandshakeRejected} - ${i.Socks5Response[u[1]]}`);else{const _=u[3];let p,h;if(_===i.Socks5HostType.IPv4){const E=i.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseIPv4;if(this.receiveBuffer.length<E){this.nextRequiredPacketBufferSize=E;return}h=s.SmartBuffer.fromBuffer(this.receiveBuffer.get(E).slice(4)),p={host:(0,o.int32ToIpv4)(h.readUInt32BE()),port:h.readUInt16BE()},p.host==="0.0.0.0"&&(p.host=this.options.proxy.ipaddress)}else if(_===i.Socks5HostType.Hostname){const E=u[4],T=i.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseHostname(E);if(this.receiveBuffer.length<T){this.nextRequiredPacketBufferSize=T;return}h=s.SmartBuffer.fromBuffer(this.receiveBuffer.get(T).slice(5)),p={host:h.readString(E),port:h.readUInt16BE()}}else if(_===i.Socks5HostType.IPv6){const E=i.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseIPv6;if(this.receiveBuffer.length<E){this.nextRequiredPacketBufferSize=E;return}h=s.SmartBuffer.fromBuffer(this.receiveBuffer.get(E).slice(4)),p={host:l.Address6.fromByteArray(Array.from(h.readBuffer(16))).canonicalForm(),port:h.readUInt16BE()}}this.setState(i.SocksClientState.ReceivedFinalResponse),i.SocksCommand[this.options.command]===i.SocksCommand.connect?(this.setState(i.SocksClientState.Established),this.removeInternalSocketHandlers(),this.emit("established",{remoteHost:p,socket:this.socket})):i.SocksCommand[this.options.command]===i.SocksCommand.bind?(this.setState(i.SocksClientState.BoundWaitingForConnection),this.nextRequiredPacketBufferSize=i.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseHeader,this.emit("bound",{remoteHost:p,socket:this.socket})):i.SocksCommand[this.options.command]===i.SocksCommand.associate&&(this.setState(i.SocksClientState.Established),this.removeInternalSocketHandlers(),this.emit("established",{remoteHost:p,socket:this.socket}))}}handleSocks5IncomingConnectionResponse(){const u=this.receiveBuffer.peek(5);if(u[0]!==5||u[1]!==i.Socks5Response.Granted)this.closeSocket(`${i.ERRORS.Socks5ProxyRejectedIncomingBoundConnection} - ${i.Socks5Response[u[1]]}`);else{const _=u[3];let p,h;if(_===i.Socks5HostType.IPv4){const E=i.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseIPv4;if(this.receiveBuffer.length<E){this.nextRequiredPacketBufferSize=E;return}h=s.SmartBuffer.fromBuffer(this.receiveBuffer.get(E).slice(4)),p={host:(0,o.int32ToIpv4)(h.readUInt32BE()),port:h.readUInt16BE()},p.host==="0.0.0.0"&&(p.host=this.options.proxy.ipaddress)}else if(_===i.Socks5HostType.Hostname){const E=u[4],T=i.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseHostname(E);if(this.receiveBuffer.length<T){this.nextRequiredPacketBufferSize=T;return}h=s.SmartBuffer.fromBuffer(this.receiveBuffer.get(T).slice(5)),p={host:h.readString(E),port:h.readUInt16BE()}}else if(_===i.Socks5HostType.IPv6){const E=i.SOCKS_INCOMING_PACKET_SIZES.Socks5ResponseIPv6;if(this.receiveBuffer.length<E){this.nextRequiredPacketBufferSize=E;return}h=s.SmartBuffer.fromBuffer(this.receiveBuffer.get(E).slice(4)),p={host:l.Address6.fromByteArray(Array.from(h.readBuffer(16))).canonicalForm(),port:h.readUInt16BE()}}this.setState(i.SocksClientState.Established),this.removeInternalSocketHandlers(),this.emit("established",{remoteHost:p,socket:this.socket})}}get socksClientOptions(){return Object.assign({},this.options)}}e.SocksClient=f})(Rc)),Rc}var nv;function HJ(){return nv||(nv=1,(function(e){var t=Ms&&Ms.__createBinding||(Object.create?(function(r,s,i,o){o===void 0&&(o=i);var c=Object.getOwnPropertyDescriptor(s,i);(!c||("get"in c?!s.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return s[i]}}),Object.defineProperty(r,o,c)}):(function(r,s,i,o){o===void 0&&(o=i),r[o]=s[i]})),n=Ms&&Ms.__exportStar||function(r,s){for(var i in r)i!=="default"&&!Object.prototype.hasOwnProperty.call(s,i)&&t(s,r,i)};Object.defineProperty(e,"__esModule",{value:!0}),n($J(),e)})(Ms)),Ms}var On={},Ct={},rv;function FJ(){if(rv)return Ct;rv=1;var e=Ct&&Ct.__createBinding||(Object.create?(function(a,l,f,d){d===void 0&&(d=f);var u=Object.getOwnPropertyDescriptor(l,f);(!u||("get"in u?!l.__esModule:u.writable||u.configurable))&&(u={enumerable:!0,get:function(){return l[f]}}),Object.defineProperty(a,d,u)}):(function(a,l,f,d){d===void 0&&(d=f),a[d]=l[f]})),t=Ct&&Ct.__setModuleDefault||(Object.create?(function(a,l){Object.defineProperty(a,"default",{enumerable:!0,value:l})}):function(a,l){a.default=l}),n=Ct&&Ct.__importStar||function(a){if(a&&a.__esModule)return a;var l={};if(a!=null)for(var f in a)f!=="default"&&Object.prototype.hasOwnProperty.call(a,f)&&e(l,a,f);return t(l,a),l};Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.req=Ct.json=Ct.toBuffer=void 0;const r=n(ed),s=n(VE);async function i(a){let l=0;const f=[];for await(const d of a)l+=d.length,f.push(d);return Buffer.concat(f,l)}Ct.toBuffer=i;async function o(a){const f=(await i(a)).toString("utf8");try{return JSON.parse(f)}catch(d){const u=d;throw u.message+=` (input: ${f})`,u}}Ct.json=o;function c(a,l={}){const d=((typeof a=="string"?a:a.href).startsWith("https:")?s:r).request(a,l),u=new Promise((_,p)=>{d.once("response",_).once("error",p).end()});return d.then=u.then.bind(u),d}return Ct.req=c,Ct}var sv;function jJ(){return sv||(sv=1,(function(e){var t=On&&On.__createBinding||(Object.create?(function(f,d,u,_){_===void 0&&(_=u);var p=Object.getOwnPropertyDescriptor(d,u);(!p||("get"in p?!d.__esModule:p.writable||p.configurable))&&(p={enumerable:!0,get:function(){return d[u]}}),Object.defineProperty(f,_,p)}):(function(f,d,u,_){_===void 0&&(_=u),f[_]=d[u]})),n=On&&On.__setModuleDefault||(Object.create?(function(f,d){Object.defineProperty(f,"default",{enumerable:!0,value:d})}):function(f,d){f.default=d}),r=On&&On.__importStar||function(f){if(f&&f.__esModule)return f;var d={};if(f!=null)for(var u in f)u!=="default"&&Object.prototype.hasOwnProperty.call(f,u)&&t(d,f,u);return n(d,f),d},s=On&&On.__exportStar||function(f,d){for(var u in f)u!=="default"&&!Object.prototype.hasOwnProperty.call(d,u)&&t(d,f,u)};Object.defineProperty(e,"__esModule",{value:!0}),e.Agent=void 0;const i=r(au),o=r(ed),c=VE;s(FJ(),e);const a=Symbol("AgentBaseInternalState");class l extends o.Agent{constructor(d){super(d),this[a]={}}isSecureEndpoint(d){if(d){if(typeof d.secureEndpoint=="boolean")return d.secureEndpoint;if(typeof d.protocol=="string")return d.protocol==="https:"}const{stack:u}=new Error;return typeof u!="string"?!1:u.split(`
`).some(_=>_.indexOf("(https.js:")!==-1||_.indexOf("node:https:")!==-1)}incrementSockets(d){if(this.maxSockets===1/0&&this.maxTotalSockets===1/0)return null;this.sockets[d]||(this.sockets[d]=[]);const u=new i.Socket({writable:!1});return this.sockets[d].push(u),this.totalSocketCount++,u}decrementSockets(d,u){if(!this.sockets[d]||u===null)return;const _=this.sockets[d],p=_.indexOf(u);p!==-1&&(_.splice(p,1),this.totalSocketCount--,_.length===0&&delete this.sockets[d])}getName(d){return(typeof d.secureEndpoint=="boolean"?d.secureEndpoint:this.isSecureEndpoint(d))?c.Agent.prototype.getName.call(this,d):super.getName(d)}createSocket(d,u,_){const p={...u,secureEndpoint:this.isSecureEndpoint(u)},h=this.getName(p),E=this.incrementSockets(h);Promise.resolve().then(()=>this.connect(d,p)).then(T=>{if(this.decrementSockets(h,E),T instanceof o.Agent)try{return T.addRequest(d,p)}catch(S){return _(S)}this[a].currentSocket=T,super.createSocket(d,u,_)},T=>{this.decrementSockets(h,E),_(T)})}createConnection(){const d=this[a].currentSocket;if(this[a].currentSocket=void 0,!d)throw new Error("No socket was returned in the `connect()` function");return d}get defaultPort(){return this[a].defaultPort??(this.protocol==="https:"?443:80)}set defaultPort(d){this[a]&&(this[a].defaultPort=d)}get protocol(){return this[a].protocol??(this.isSecureEndpoint()?"https:":"http:")}set protocol(d){this[a]&&(this[a].protocol=d)}}e.Agent=l})(On)),On}var iv;function qJ(){if(iv)return $t;iv=1;var e=$t&&$t.__createBinding||(Object.create?(function(E,T,S,m){m===void 0&&(m=S);var g=Object.getOwnPropertyDescriptor(T,S);(!g||("get"in g?!T.__esModule:g.writable||g.configurable))&&(g={enumerable:!0,get:function(){return T[S]}}),Object.defineProperty(E,m,g)}):(function(E,T,S,m){m===void 0&&(m=S),E[m]=T[S]})),t=$t&&$t.__setModuleDefault||(Object.create?(function(E,T){Object.defineProperty(E,"default",{enumerable:!0,value:T})}):function(E,T){E.default=T}),n=$t&&$t.__importStar||function(E){if(E&&E.__esModule)return E;var T={};if(E!=null)for(var S in E)S!=="default"&&Object.prototype.hasOwnProperty.call(E,S)&&e(T,E,S);return t(T,E),T},r=$t&&$t.__importDefault||function(E){return E&&E.__esModule?E:{default:E}};Object.defineProperty($t,"__esModule",{value:!0}),$t.SocksProxyAgent=void 0;const s=HJ(),i=jJ(),o=r(WM()),c=n(Ak),a=n(au),l=n(iM),f=Wi,d=(0,o.default)("socks-proxy-agent"),u=E=>E.servername===void 0&&E.host&&!a.isIP(E.host)?{...E,servername:E.host}:E;function _(E){let T=!1,S=5;const m=E.hostname,g=parseInt(E.port,10)||1080;switch(E.protocol.replace(":","")){case"socks4":T=!0,S=4;break;case"socks4a":S=4;break;case"socks5":T=!0,S=5;break;case"socks":S=5;break;case"socks5h":S=5;break;default:throw new TypeError(`A "socks" protocol must be specified! Got: ${String(E.protocol)}`)}const y={host:m,port:g,type:S};return E.username&&Object.defineProperty(y,"userId",{value:decodeURIComponent(E.username),enumerable:!1}),E.password!=null&&Object.defineProperty(y,"password",{value:decodeURIComponent(E.password),enumerable:!1}),{lookup:T,proxy:y}}class p extends i.Agent{constructor(T,S){super(S);const m=typeof T=="string"?new f.URL(T):T,{proxy:g,lookup:y}=_(m);this.shouldLookup=y,this.proxy=g,this.timeout=S?.timeout??null,this.socketOptions=S?.socketOptions??null}async connect(T,S){const{shouldLookup:m,proxy:g,timeout:y}=this;if(!S.host)throw new Error("No `host` defined!");let{host:A}=S;const{port:N,lookup:O=c.lookup}=S;m&&(A=await new Promise((k,U)=>{O(A,{},(M,F)=>{M?U(M):k(F)})}));const b={proxy:g,destination:{host:A,port:typeof N=="number"?N:parseInt(N,10)},command:"connect",timeout:y??void 0,socket_options:this.socketOptions??void 0},C=k=>{T.destroy(),w.destroy(),k&&k.destroy()};d("Creating socks proxy connection: %o",b);const{socket:w}=await s.SocksClient.createConnection(b);if(d("Successfully created socks proxy connection"),y!==null&&(w.setTimeout(y),w.on("timeout",()=>C())),S.secureEndpoint){d("Upgrading socket connection to TLS");const k=l.connect({...h(u(S),"host","path","port"),socket:w});return k.once("error",U=>{d("Socket TLS error",U.message),C(k)}),k}return w}}p.protocols=["socks","socks4","socks4a","socks5","socks5h"],$t.SocksProxyAgent=p;function h(E,...T){const S={};let m;for(m in E)T.includes(m)||(S[m]=E[m]);return S}return $t}qJ();var Oc={exports:{}},th,ov;function Kr(){if(ov)return th;ov=1;const e=["nodebuffer","arraybuffer","fragments"],t=typeof Blob<"u";return t&&e.push("blob"),th={BINARY_TYPES:e,CLOSE_TIMEOUT:3e4,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:t,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}},th}var Wu={exports:{}};function aU(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ku={exports:{}},nh,av;function YJ(){if(av)return nh;av=1;var e=uu,t=Mn,n=cu,r=typeof __webpack_require__=="function"?__non_webpack_require__:aU,s=process.config&&process.config.variables||{},i=!!process.env.PREBUILDS_ONLY,o=process.versions.modules,c=b()?"electron":O()?"node-webkit":"node",a=process.env.npm_config_arch||n.arch(),l=process.env.npm_config_platform||n.platform(),f=process.env.LIBC||(C(l)?"musl":"glibc"),d=process.env.ARM_VERSION||(a==="arm64"?"8":s.arm_version)||"",u=(process.versions.uv||"").split(".")[0];nh=_;function _(w){return r(_.resolve(w))}_.resolve=_.path=function(w){w=t.resolve(w||".");try{var k=r(t.join(w,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[k+"_PREBUILD"]&&(w=process.env[k+"_PREBUILD"])}catch{}if(!i){var U=h(t.join(w,"build/Release"),E);if(U)return U;var M=h(t.join(w,"build/Debug"),E);if(M)return M}var F=H(w);if(F)return F;var v=H(t.dirname(process.execPath));if(v)return v;var L=["platform="+l,"arch="+a,"runtime="+c,"abi="+o,"uv="+u,d?"armv="+d:"","libc="+f,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"",typeof __webpack_require__=="function"?"webpack=true":""].filter(Boolean).join(" ");throw new Error("No native build was found for "+L+`
    loaded from: `+w+`
`);function H(te){var ce=p(t.join(te,"prebuilds")).map(T),ee=ce.filter(S(l,a)).sort(m)[0];if(ee){var x=t.join(te,"prebuilds",ee.name),B=p(x).map(g),j=B.filter(y(c,o)),q=j.sort(N(c))[0];if(q)return t.join(x,q.file)}}};function p(w){try{return e.readdirSync(w)}catch{return[]}}function h(w,k){var U=p(w).filter(k);return U[0]&&t.join(w,U[0])}function E(w){return/\.node$/.test(w)}function T(w){var k=w.split("-");if(k.length===2){var U=k[0],M=k[1].split("+");if(U&&M.length&&M.every(Boolean))return{name:w,platform:U,architectures:M}}}function S(w,k){return function(U){return U==null||U.platform!==w?!1:U.architectures.includes(k)}}function m(w,k){return w.architectures.length-k.architectures.length}function g(w){var k=w.split("."),U=k.pop(),M={file:w,specificity:0};if(U==="node"){for(var F=0;F<k.length;F++){var v=k[F];if(v==="node"||v==="electron"||v==="node-webkit")M.runtime=v;else if(v==="napi")M.napi=!0;else if(v.slice(0,3)==="abi")M.abi=v.slice(3);else if(v.slice(0,2)==="uv")M.uv=v.slice(2);else if(v.slice(0,4)==="armv")M.armv=v.slice(4);else if(v==="glibc"||v==="musl")M.libc=v;else continue;M.specificity++}return M}}function y(w,k){return function(U){return!(U==null||U.runtime&&U.runtime!==w&&!A(U)||U.abi&&U.abi!==k&&!U.napi||U.uv&&U.uv!==u||U.armv&&U.armv!==d||U.libc&&U.libc!==f)}}function A(w){return w.runtime==="node"&&w.napi}function N(w){return function(k,U){return k.runtime!==U.runtime?k.runtime===w?-1:1:k.abi!==U.abi?k.abi?-1:1:k.specificity!==U.specificity?k.specificity>U.specificity?-1:1:0}}function O(){return!!(process.versions&&process.versions.nw)}function b(){return process.versions&&process.versions.electron||process.env.ELECTRON_RUN_AS_NODE?!0:typeof window<"u"&&window.process&&window.process.type==="renderer"}function C(w){return w==="linux"&&e.existsSync("/etc/alpine-release")}return _.parseTags=g,_.matchTags=y,_.compareTags=N,_.parseTuple=T,_.matchTuple=S,_.compareTuples=m,nh}var cv;function cU(){if(cv)return Ku.exports;cv=1;const e=typeof __webpack_require__=="function"?__non_webpack_require__:aU;return typeof e.addon=="function"?Ku.exports=e.addon.bind(e):Ku.exports=YJ(),Ku.exports}var rh,uv;function WJ(){return uv||(uv=1,rh={mask:(n,r,s,i,o)=>{for(var c=0;c<o;c++)s[i+c]=n[c]^r[c&3]},unmask:(n,r)=>{const s=n.length;for(var i=0;i<s;i++)n[i]^=r[i&3]}}),rh}var lv;function KJ(){if(lv)return Wu.exports;lv=1;try{Wu.exports=cU()(__dirname)}catch{Wu.exports=WJ()}return Wu.exports}var dv;function jd(){if(dv)return Oc.exports;dv=1;const{EMPTY_BUFFER:e}=Kr(),t=Buffer[Symbol.species];function n(c,a){if(c.length===0)return e;if(c.length===1)return c[0];const l=Buffer.allocUnsafe(a);let f=0;for(let d=0;d<c.length;d++){const u=c[d];l.set(u,f),f+=u.length}return f<a?new t(l.buffer,l.byteOffset,f):l}function r(c,a,l,f,d){for(let u=0;u<d;u++)l[f+u]=c[u]^a[u&3]}function s(c,a){for(let l=0;l<c.length;l++)c[l]^=a[l&3]}function i(c){return c.length===c.buffer.byteLength?c.buffer:c.buffer.slice(c.byteOffset,c.byteOffset+c.length)}function o(c){if(o.readOnly=!0,Buffer.isBuffer(c))return c;let a;return c instanceof ArrayBuffer?a=new t(c):ArrayBuffer.isView(c)?a=new t(c.buffer,c.byteOffset,c.byteLength):(a=Buffer.from(c),o.readOnly=!1),a}if(Oc.exports={concat:n,mask:r,toArrayBuffer:i,toBuffer:o,unmask:s},!process.env.WS_NO_BUFFER_UTIL)try{const c=KJ();Oc.exports.mask=function(a,l,f,d,u){u<48?r(a,l,f,d,u):c.mask(a,l,f,d,u)},Oc.exports.unmask=function(a,l){a.length<32?s(a,l):c.unmask(a,l)}}catch{}return Oc.exports}var sh,fv;function zJ(){if(fv)return sh;fv=1;const e=Symbol("kDone"),t=Symbol("kRun");class n{constructor(s){this[e]=()=>{this.pending--,this[t]()},this.concurrency=s||1/0,this.jobs=[],this.pending=0}add(s){this.jobs.push(s),this[t]()}[t](){if(this.pending!==this.concurrency&&this.jobs.length){const s=this.jobs.shift();this.pending++,s(this[e])}}}return sh=n,sh}var ih,_v;function qd(){if(_v)return ih;_v=1;const e=Rk,t=jd(),n=zJ(),{kStatusCode:r}=Kr(),s=Buffer[Symbol.species],i=Buffer.from([0,0,255,255]),o=Symbol("permessage-deflate"),c=Symbol("total-length"),a=Symbol("callback"),l=Symbol("buffers"),f=Symbol("error");let d;class u{constructor(T,S,m){if(this._maxPayload=m|0,this._options=T||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!S,this._deflate=null,this._inflate=null,this.params=null,!d){const g=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;d=new n(g)}}static get extensionName(){return"permessage-deflate"}offer(){const T={};return this._options.serverNoContextTakeover&&(T.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(T.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(T.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?T.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(T.client_max_window_bits=!0),T}accept(T){return T=this.normalizeParams(T),this.params=this._isServer?this.acceptAsServer(T):this.acceptAsClient(T),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const T=this._deflate[a];this._deflate.close(),this._deflate=null,T&&T(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(T){const S=this._options,m=T.find(g=>!(S.serverNoContextTakeover===!1&&g.server_no_context_takeover||g.server_max_window_bits&&(S.serverMaxWindowBits===!1||typeof S.serverMaxWindowBits=="number"&&S.serverMaxWindowBits>g.server_max_window_bits)||typeof S.clientMaxWindowBits=="number"&&!g.client_max_window_bits));if(!m)throw new Error("None of the extension offers can be accepted");return S.serverNoContextTakeover&&(m.server_no_context_takeover=!0),S.clientNoContextTakeover&&(m.client_no_context_takeover=!0),typeof S.serverMaxWindowBits=="number"&&(m.server_max_window_bits=S.serverMaxWindowBits),typeof S.clientMaxWindowBits=="number"?m.client_max_window_bits=S.clientMaxWindowBits:(m.client_max_window_bits===!0||S.clientMaxWindowBits===!1)&&delete m.client_max_window_bits,m}acceptAsClient(T){const S=T[0];if(this._options.clientNoContextTakeover===!1&&S.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!S.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(S.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&S.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return S}normalizeParams(T){return T.forEach(S=>{Object.keys(S).forEach(m=>{let g=S[m];if(g.length>1)throw new Error(`Parameter "${m}" must have only a single value`);if(g=g[0],m==="client_max_window_bits"){if(g!==!0){const y=+g;if(!Number.isInteger(y)||y<8||y>15)throw new TypeError(`Invalid value for parameter "${m}": ${g}`);g=y}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${m}": ${g}`)}else if(m==="server_max_window_bits"){const y=+g;if(!Number.isInteger(y)||y<8||y>15)throw new TypeError(`Invalid value for parameter "${m}": ${g}`);g=y}else if(m==="client_no_context_takeover"||m==="server_no_context_takeover"){if(g!==!0)throw new TypeError(`Invalid value for parameter "${m}": ${g}`)}else throw new Error(`Unknown parameter "${m}"`);S[m]=g})}),T}decompress(T,S,m){d.add(g=>{this._decompress(T,S,(y,A)=>{g(),m(y,A)})})}compress(T,S,m){d.add(g=>{this._compress(T,S,(y,A)=>{g(),m(y,A)})})}_decompress(T,S,m){const g=this._isServer?"client":"server";if(!this._inflate){const y=`${g}_max_window_bits`,A=typeof this.params[y]!="number"?e.Z_DEFAULT_WINDOWBITS:this.params[y];this._inflate=e.createInflateRaw({...this._options.zlibInflateOptions,windowBits:A}),this._inflate[o]=this,this._inflate[c]=0,this._inflate[l]=[],this._inflate.on("error",h),this._inflate.on("data",p)}this._inflate[a]=m,this._inflate.write(T),S&&this._inflate.write(i),this._inflate.flush(()=>{const y=this._inflate[f];if(y){this._inflate.close(),this._inflate=null,m(y);return}const A=t.concat(this._inflate[l],this._inflate[c]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[c]=0,this._inflate[l]=[],S&&this.params[`${g}_no_context_takeover`]&&this._inflate.reset()),m(null,A)})}_compress(T,S,m){const g=this._isServer?"server":"client";if(!this._deflate){const y=`${g}_max_window_bits`,A=typeof this.params[y]!="number"?e.Z_DEFAULT_WINDOWBITS:this.params[y];this._deflate=e.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:A}),this._deflate[c]=0,this._deflate[l]=[],this._deflate.on("data",_)}this._deflate[a]=m,this._deflate.write(T),this._deflate.flush(e.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let y=t.concat(this._deflate[l],this._deflate[c]);S&&(y=new s(y.buffer,y.byteOffset,y.length-4)),this._deflate[a]=null,this._deflate[c]=0,this._deflate[l]=[],S&&this.params[`${g}_no_context_takeover`]&&this._deflate.reset(),m(null,y)})}}ih=u;function _(E){this[l].push(E),this[c]+=E.length}function p(E){if(this[c]+=E.length,this[o]._maxPayload<1||this[c]<=this[o]._maxPayload){this[l].push(E);return}this[f]=new RangeError("Max payload size exceeded"),this[f].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[f][r]=1009,this.removeListener("data",p),this.reset()}function h(E){if(this[o]._inflate=null,this[f]){this[a](this[f]);return}E[r]=1007,this[a](E)}return ih}var bc={exports:{}},zu={exports:{}},oh,pv;function ZJ(){if(pv)return oh;pv=1;function e(t){const n=t.length;let r=0;for(;r<n;)if((t[r]&128)===0)r++;else if((t[r]&224)===192){if(r+1===n||(t[r+1]&192)!==128||(t[r]&254)===192)return!1;r+=2}else if((t[r]&240)===224){if(r+2>=n||(t[r+1]&192)!==128||(t[r+2]&192)!==128||t[r]===224&&(t[r+1]&224)===128||t[r]===237&&(t[r+1]&224)===160)return!1;r+=3}else if((t[r]&248)===240){if(r+3>=n||(t[r+1]&192)!==128||(t[r+2]&192)!==128||(t[r+3]&192)!==128||t[r]===240&&(t[r+1]&240)===128||t[r]===244&&t[r+1]>143||t[r]>244)return!1;r+=4}else return!1;return!0}return oh=e,oh}var hv;function XJ(){if(hv)return zu.exports;hv=1;try{zu.exports=cU()(__dirname)}catch{zu.exports=ZJ()}return zu.exports}var Ev;function Su(){if(Ev)return bc.exports;Ev=1;const{isUtf8:e}=GE,{hasBlob:t}=Kr(),n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function r(o){return o>=1e3&&o<=1014&&o!==1004&&o!==1005&&o!==1006||o>=3e3&&o<=4999}function s(o){const c=o.length;let a=0;for(;a<c;)if((o[a]&128)===0)a++;else if((o[a]&224)===192){if(a+1===c||(o[a+1]&192)!==128||(o[a]&254)===192)return!1;a+=2}else if((o[a]&240)===224){if(a+2>=c||(o[a+1]&192)!==128||(o[a+2]&192)!==128||o[a]===224&&(o[a+1]&224)===128||o[a]===237&&(o[a+1]&224)===160)return!1;a+=3}else if((o[a]&248)===240){if(a+3>=c||(o[a+1]&192)!==128||(o[a+2]&192)!==128||(o[a+3]&192)!==128||o[a]===240&&(o[a+1]&240)===128||o[a]===244&&o[a+1]>143||o[a]>244)return!1;a+=4}else return!1;return!0}function i(o){return t&&typeof o=="object"&&typeof o.arrayBuffer=="function"&&typeof o.type=="string"&&typeof o.stream=="function"&&(o[Symbol.toStringTag]==="Blob"||o[Symbol.toStringTag]==="File")}if(bc.exports={isBlob:i,isValidStatusCode:r,isValidUTF8:s,tokenChars:n},e)bc.exports.isValidUTF8=function(o){return o.length<24?s(o):e(o)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{const o=XJ();bc.exports.isValidUTF8=function(c){return c.length<32?s(c):o(c)}}catch{}return bc.exports}var ah,Tv;function uU(){if(Tv)return ah;Tv=1;const{Writable:e}=Sr,t=qd(),{BINARY_TYPES:n,EMPTY_BUFFER:r,kStatusCode:s,kWebSocket:i}=Kr(),{concat:o,toArrayBuffer:c,unmask:a}=jd(),{isValidStatusCode:l,isValidUTF8:f}=Su(),d=Buffer[Symbol.species],u=0,_=1,p=2,h=3,E=4,T=5,S=6;class m extends e{constructor(y={}){super(),this._allowSynchronousEvents=y.allowSynchronousEvents!==void 0?y.allowSynchronousEvents:!0,this._binaryType=y.binaryType||n[0],this._extensions=y.extensions||{},this._isServer=!!y.isServer,this._maxPayload=y.maxPayload|0,this._skipUTF8Validation=!!y.skipUTF8Validation,this[i]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=u}_write(y,A,N){if(this._opcode===8&&this._state==u)return N();this._bufferedBytes+=y.length,this._buffers.push(y),this.startLoop(N)}consume(y){if(this._bufferedBytes-=y,y===this._buffers[0].length)return this._buffers.shift();if(y<this._buffers[0].length){const N=this._buffers[0];return this._buffers[0]=new d(N.buffer,N.byteOffset+y,N.length-y),new d(N.buffer,N.byteOffset,y)}const A=Buffer.allocUnsafe(y);do{const N=this._buffers[0],O=A.length-y;y>=N.length?A.set(this._buffers.shift(),O):(A.set(new Uint8Array(N.buffer,N.byteOffset,y),O),this._buffers[0]=new d(N.buffer,N.byteOffset+y,N.length-y)),y-=N.length}while(y>0);return A}startLoop(y){this._loop=!0;do switch(this._state){case u:this.getInfo(y);break;case _:this.getPayloadLength16(y);break;case p:this.getPayloadLength64(y);break;case h:this.getMask();break;case E:this.getData(y);break;case T:case S:this._loop=!1;return}while(this._loop);this._errored||y()}getInfo(y){if(this._bufferedBytes<2){this._loop=!1;return}const A=this.consume(2);if((A[0]&48)!==0){const O=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");y(O);return}const N=(A[0]&64)===64;if(N&&!this._extensions[t.extensionName]){const O=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");y(O);return}if(this._fin=(A[0]&128)===128,this._opcode=A[0]&15,this._payloadLength=A[1]&127,this._opcode===0){if(N){const O=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");y(O);return}if(!this._fragmented){const O=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");y(O);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){const O=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");y(O);return}this._compressed=N}else if(this._opcode>7&&this._opcode<11){if(!this._fin){const O=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");y(O);return}if(N){const O=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");y(O);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){const O=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");y(O);return}}else{const O=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");y(O);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(A[1]&128)===128,this._isServer){if(!this._masked){const O=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");y(O);return}}else if(this._masked){const O=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");y(O);return}this._payloadLength===126?this._state=_:this._payloadLength===127?this._state=p:this.haveLength(y)}getPayloadLength16(y){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(y)}getPayloadLength64(y){if(this._bufferedBytes<8){this._loop=!1;return}const A=this.consume(8),N=A.readUInt32BE(0);if(N>Math.pow(2,21)-1){const O=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");y(O);return}this._payloadLength=N*Math.pow(2,32)+A.readUInt32BE(4),this.haveLength(y)}haveLength(y){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){const A=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");y(A);return}this._masked?this._state=h:this._state=E}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=E}getData(y){let A=r;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}A=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0&&a(A,this._mask)}if(this._opcode>7){this.controlMessage(A,y);return}if(this._compressed){this._state=T,this.decompress(A,y);return}A.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(A)),this.dataMessage(y)}decompress(y,A){this._extensions[t.extensionName].decompress(y,this._fin,(O,b)=>{if(O)return A(O);if(b.length){if(this._messageLength+=b.length,this._messageLength>this._maxPayload&&this._maxPayload>0){const C=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");A(C);return}this._fragments.push(b)}this.dataMessage(A),this._state===u&&this.startLoop(A)})}dataMessage(y){if(!this._fin){this._state=u;return}const A=this._messageLength,N=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let O;this._binaryType==="nodebuffer"?O=o(N,A):this._binaryType==="arraybuffer"?O=c(o(N,A)):this._binaryType==="blob"?O=new Blob(N):O=N,this._allowSynchronousEvents?(this.emit("message",O,!0),this._state=u):(this._state=S,setImmediate(()=>{this.emit("message",O,!0),this._state=u,this.startLoop(y)}))}else{const O=o(N,A);if(!this._skipUTF8Validation&&!f(O)){const b=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");y(b);return}this._state===T||this._allowSynchronousEvents?(this.emit("message",O,!1),this._state=u):(this._state=S,setImmediate(()=>{this.emit("message",O,!1),this._state=u,this.startLoop(y)}))}}controlMessage(y,A){if(this._opcode===8){if(y.length===0)this._loop=!1,this.emit("conclude",1005,r),this.end();else{const N=y.readUInt16BE(0);if(!l(N)){const b=this.createError(RangeError,`invalid status code ${N}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");A(b);return}const O=new d(y.buffer,y.byteOffset+2,y.length-2);if(!this._skipUTF8Validation&&!f(O)){const b=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");A(b);return}this._loop=!1,this.emit("conclude",N,O),this.end()}this._state=u;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",y),this._state=u):(this._state=S,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",y),this._state=u,this.startLoop(A)}))}createError(y,A,N,O,b){this._loop=!1,this._errored=!0;const C=new y(N?`Invalid WebSocket frame: ${A}`:A);return Error.captureStackTrace(C,this.createError),C.code=b,C[s]=O,C}}return ah=m,ah}var ch,Sv;function lU(){if(Sv)return ch;Sv=1;const{Duplex:e}=Sr,{randomFillSync:t}=$E,n=qd(),{EMPTY_BUFFER:r,kWebSocket:s,NOOP:i}=Kr(),{isBlob:o,isValidStatusCode:c}=Su(),{mask:a,toBuffer:l}=jd(),f=Symbol("kByteLength"),d=Buffer.alloc(4),u=8*1024;let _,p=u;const h=0,E=1,T=2;class S{constructor(A,N,O){this._extensions=N||{},O&&(this._generateMask=O,this._maskBuffer=Buffer.alloc(4)),this._socket=A,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=h,this.onerror=i,this[s]=void 0}static frame(A,N){let O,b=!1,C=2,w=!1;N.mask&&(O=N.maskBuffer||d,N.generateMask?N.generateMask(O):(p===u&&(_===void 0&&(_=Buffer.alloc(u)),t(_,0,u),p=0),O[0]=_[p++],O[1]=_[p++],O[2]=_[p++],O[3]=_[p++]),w=(O[0]|O[1]|O[2]|O[3])===0,C=6);let k;typeof A=="string"?(!N.mask||w)&&N[f]!==void 0?k=N[f]:(A=Buffer.from(A),k=A.length):(k=A.length,b=N.mask&&N.readOnly&&!w);let U=k;k>=65536?(C+=8,U=127):k>125&&(C+=2,U=126);const M=Buffer.allocUnsafe(b?k+C:C);return M[0]=N.fin?N.opcode|128:N.opcode,N.rsv1&&(M[0]|=64),M[1]=U,U===126?M.writeUInt16BE(k,2):U===127&&(M[2]=M[3]=0,M.writeUIntBE(k,4,6)),N.mask?(M[1]|=128,M[C-4]=O[0],M[C-3]=O[1],M[C-2]=O[2],M[C-1]=O[3],w?[M,A]:b?(a(A,O,M,C,k),[M]):(a(A,O,A,0,k),[M,A])):[M,A]}close(A,N,O,b){let C;if(A===void 0)C=r;else{if(typeof A!="number"||!c(A))throw new TypeError("First argument must be a valid error code number");if(N===void 0||!N.length)C=Buffer.allocUnsafe(2),C.writeUInt16BE(A,0);else{const k=Buffer.byteLength(N);if(k>123)throw new RangeError("The message must not be greater than 123 bytes");C=Buffer.allocUnsafe(2+k),C.writeUInt16BE(A,0),typeof N=="string"?C.write(N,2):C.set(N,2)}}const w={[f]:C.length,fin:!0,generateMask:this._generateMask,mask:O,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._state!==h?this.enqueue([this.dispatch,C,!1,w,b]):this.sendFrame(S.frame(C,w),b)}ping(A,N,O){let b,C;if(typeof A=="string"?(b=Buffer.byteLength(A),C=!1):o(A)?(b=A.size,C=!1):(A=l(A),b=A.length,C=l.readOnly),b>125)throw new RangeError("The data size must not be greater than 125 bytes");const w={[f]:b,fin:!0,generateMask:this._generateMask,mask:N,maskBuffer:this._maskBuffer,opcode:9,readOnly:C,rsv1:!1};o(A)?this._state!==h?this.enqueue([this.getBlobData,A,!1,w,O]):this.getBlobData(A,!1,w,O):this._state!==h?this.enqueue([this.dispatch,A,!1,w,O]):this.sendFrame(S.frame(A,w),O)}pong(A,N,O){let b,C;if(typeof A=="string"?(b=Buffer.byteLength(A),C=!1):o(A)?(b=A.size,C=!1):(A=l(A),b=A.length,C=l.readOnly),b>125)throw new RangeError("The data size must not be greater than 125 bytes");const w={[f]:b,fin:!0,generateMask:this._generateMask,mask:N,maskBuffer:this._maskBuffer,opcode:10,readOnly:C,rsv1:!1};o(A)?this._state!==h?this.enqueue([this.getBlobData,A,!1,w,O]):this.getBlobData(A,!1,w,O):this._state!==h?this.enqueue([this.dispatch,A,!1,w,O]):this.sendFrame(S.frame(A,w),O)}send(A,N,O){const b=this._extensions[n.extensionName];let C=N.binary?2:1,w=N.compress,k,U;typeof A=="string"?(k=Buffer.byteLength(A),U=!1):o(A)?(k=A.size,U=!1):(A=l(A),k=A.length,U=l.readOnly),this._firstFragment?(this._firstFragment=!1,w&&b&&b.params[b._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(w=k>=b._threshold),this._compress=w):(w=!1,C=0),N.fin&&(this._firstFragment=!0);const M={[f]:k,fin:N.fin,generateMask:this._generateMask,mask:N.mask,maskBuffer:this._maskBuffer,opcode:C,readOnly:U,rsv1:w};o(A)?this._state!==h?this.enqueue([this.getBlobData,A,this._compress,M,O]):this.getBlobData(A,this._compress,M,O):this._state!==h?this.enqueue([this.dispatch,A,this._compress,M,O]):this.dispatch(A,this._compress,M,O)}getBlobData(A,N,O,b){this._bufferedBytes+=O[f],this._state=T,A.arrayBuffer().then(C=>{if(this._socket.destroyed){const k=new Error("The socket was closed while the blob was being read");process.nextTick(m,this,k,b);return}this._bufferedBytes-=O[f];const w=l(C);N?this.dispatch(w,N,O,b):(this._state=h,this.sendFrame(S.frame(w,O),b),this.dequeue())}).catch(C=>{process.nextTick(g,this,C,b)})}dispatch(A,N,O,b){if(!N){this.sendFrame(S.frame(A,O),b);return}const C=this._extensions[n.extensionName];this._bufferedBytes+=O[f],this._state=E,C.compress(A,O.fin,(w,k)=>{if(this._socket.destroyed){const U=new Error("The socket was closed while data was being compressed");m(this,U,b);return}this._bufferedBytes-=O[f],this._state=h,O.readOnly=!1,this.sendFrame(S.frame(k,O),b),this.dequeue()})}dequeue(){for(;this._state===h&&this._queue.length;){const A=this._queue.shift();this._bufferedBytes-=A[3][f],Reflect.apply(A[0],this,A.slice(1))}}enqueue(A){this._bufferedBytes+=A[3][f],this._queue.push(A)}sendFrame(A,N){A.length===2?(this._socket.cork(),this._socket.write(A[0]),this._socket.write(A[1],N),this._socket.uncork()):this._socket.write(A[0],N)}}ch=S;function m(y,A,N){typeof N=="function"&&N(A);for(let O=0;O<y._queue.length;O++){const b=y._queue[O],C=b[b.length-1];typeof C=="function"&&C(A)}}function g(y,A,N){m(y,A,N),y.onerror(A)}return ch}var uh,mv;function QJ(){if(mv)return uh;mv=1;const{kForOnEventAttribute:e,kListener:t}=Kr(),n=Symbol("kCode"),r=Symbol("kData"),s=Symbol("kError"),i=Symbol("kMessage"),o=Symbol("kReason"),c=Symbol("kTarget"),a=Symbol("kType"),l=Symbol("kWasClean");class f{constructor(T){this[c]=null,this[a]=T}get target(){return this[c]}get type(){return this[a]}}Object.defineProperty(f.prototype,"target",{enumerable:!0}),Object.defineProperty(f.prototype,"type",{enumerable:!0});class d extends f{constructor(T,S={}){super(T),this[n]=S.code===void 0?0:S.code,this[o]=S.reason===void 0?"":S.reason,this[l]=S.wasClean===void 0?!1:S.wasClean}get code(){return this[n]}get reason(){return this[o]}get wasClean(){return this[l]}}Object.defineProperty(d.prototype,"code",{enumerable:!0}),Object.defineProperty(d.prototype,"reason",{enumerable:!0}),Object.defineProperty(d.prototype,"wasClean",{enumerable:!0});class u extends f{constructor(T,S={}){super(T),this[s]=S.error===void 0?null:S.error,this[i]=S.message===void 0?"":S.message}get error(){return this[s]}get message(){return this[i]}}Object.defineProperty(u.prototype,"error",{enumerable:!0}),Object.defineProperty(u.prototype,"message",{enumerable:!0});class _ extends f{constructor(T,S={}){super(T),this[r]=S.data===void 0?null:S.data}get data(){return this[r]}}Object.defineProperty(_.prototype,"data",{enumerable:!0}),uh={CloseEvent:d,ErrorEvent:u,Event:f,EventTarget:{addEventListener(E,T,S={}){for(const g of this.listeners(E))if(!S[e]&&g[t]===T&&!g[e])return;let m;if(E==="message")m=function(y,A){const N=new _("message",{data:A?y:y.toString()});N[c]=this,h(T,this,N)};else if(E==="close")m=function(y,A){const N=new d("close",{code:y,reason:A.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});N[c]=this,h(T,this,N)};else if(E==="error")m=function(y){const A=new u("error",{error:y,message:y.message});A[c]=this,h(T,this,A)};else if(E==="open")m=function(){const y=new f("open");y[c]=this,h(T,this,y)};else return;m[e]=!!S[e],m[t]=T,S.once?this.once(E,m):this.on(E,m)},removeEventListener(E,T){for(const S of this.listeners(E))if(S[t]===T&&!S[e]){this.removeListener(E,S);break}}},MessageEvent:_};function h(E,T,S){typeof E=="object"&&E.handleEvent?E.handleEvent.call(E,S):E.call(T,S)}return uh}var lh,gv;function dU(){if(gv)return lh;gv=1;const{tokenChars:e}=Su();function t(s,i,o){s[i]===void 0?s[i]=[o]:s[i].push(o)}function n(s){const i=Object.create(null);let o=Object.create(null),c=!1,a=!1,l=!1,f,d,u=-1,_=-1,p=-1,h=0;for(;h<s.length;h++)if(_=s.charCodeAt(h),f===void 0)if(p===-1&&e[_]===1)u===-1&&(u=h);else if(h!==0&&(_===32||_===9))p===-1&&u!==-1&&(p=h);else if(_===59||_===44){if(u===-1)throw new SyntaxError(`Unexpected character at index ${h}`);p===-1&&(p=h);const T=s.slice(u,p);_===44?(t(i,T,o),o=Object.create(null)):f=T,u=p=-1}else throw new SyntaxError(`Unexpected character at index ${h}`);else if(d===void 0)if(p===-1&&e[_]===1)u===-1&&(u=h);else if(_===32||_===9)p===-1&&u!==-1&&(p=h);else if(_===59||_===44){if(u===-1)throw new SyntaxError(`Unexpected character at index ${h}`);p===-1&&(p=h),t(o,s.slice(u,p),!0),_===44&&(t(i,f,o),o=Object.create(null),f=void 0),u=p=-1}else if(_===61&&u!==-1&&p===-1)d=s.slice(u,h),u=p=-1;else throw new SyntaxError(`Unexpected character at index ${h}`);else if(a){if(e[_]!==1)throw new SyntaxError(`Unexpected character at index ${h}`);u===-1?u=h:c||(c=!0),a=!1}else if(l)if(e[_]===1)u===-1&&(u=h);else if(_===34&&u!==-1)l=!1,p=h;else if(_===92)a=!0;else throw new SyntaxError(`Unexpected character at index ${h}`);else if(_===34&&s.charCodeAt(h-1)===61)l=!0;else if(p===-1&&e[_]===1)u===-1&&(u=h);else if(u!==-1&&(_===32||_===9))p===-1&&(p=h);else if(_===59||_===44){if(u===-1)throw new SyntaxError(`Unexpected character at index ${h}`);p===-1&&(p=h);let T=s.slice(u,p);c&&(T=T.replace(/\\/g,""),c=!1),t(o,d,T),_===44&&(t(i,f,o),o=Object.create(null),f=void 0),d=void 0,u=p=-1}else throw new SyntaxError(`Unexpected character at index ${h}`);if(u===-1||l||_===32||_===9)throw new SyntaxError("Unexpected end of input");p===-1&&(p=h);const E=s.slice(u,p);return f===void 0?t(i,E,o):(d===void 0?t(o,E,!0):c?t(o,d,E.replace(/\\/g,"")):t(o,d,E),t(i,f,o)),i}function r(s){return Object.keys(s).map(i=>{let o=s[i];return Array.isArray(o)||(o=[o]),o.map(c=>[i].concat(Object.keys(c).map(a=>{let l=c[a];return Array.isArray(l)||(l=[l]),l.map(f=>f===!0?a:`${a}=${f}`).join("; ")})).join("; ")).join(", ")}).join(", ")}return lh={format:r,parse:n},lh}var dh,Av;function dS(){if(Av)return dh;Av=1;const e=Hr,t=VE,n=ed,r=au,s=iM,{randomBytes:i,createHash:o}=$E,{Duplex:c,Readable:a}=Sr,{URL:l}=Wi,f=qd(),d=uU(),u=lU(),{isBlob:_}=Su(),{BINARY_TYPES:p,CLOSE_TIMEOUT:h,EMPTY_BUFFER:E,GUID:T,kForOnEventAttribute:S,kListener:m,kStatusCode:g,kWebSocket:y,NOOP:A}=Kr(),{EventTarget:{addEventListener:N,removeEventListener:O}}=QJ(),{format:b,parse:C}=dU(),{toBuffer:w}=jd(),k=Symbol("kAborted"),U=[8,13],M=["CONNECTING","OPEN","CLOSING","CLOSED"],F=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class v extends e{constructor(W,re,le){super(),this._binaryType=p[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=E,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=v.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,W!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,re===void 0?re=[]:Array.isArray(re)||(typeof re=="object"&&re!==null?(le=re,re=[]):re=[re]),L(this,W,re,le)):(this._autoPong=le.autoPong,this._closeTimeout=le.closeTimeout,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(W){p.includes(W)&&(this._binaryType=W,this._receiver&&(this._receiver._binaryType=W))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(W,re,le){const ie=new d({allowSynchronousEvents:le.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:le.maxPayload,skipUTF8Validation:le.skipUTF8Validation}),Ae=new u(W,this._extensions,le.generateMask);this._receiver=ie,this._sender=Ae,this._socket=W,ie[y]=this,Ae[y]=this,W[y]=this,ie.on("conclude",B),ie.on("drain",j),ie.on("error",q),ie.on("message",J),ie.on("ping",G),ie.on("pong",V),Ae.onerror=K,W.setTimeout&&W.setTimeout(0),W.setNoDelay&&W.setNoDelay(),re.length>0&&W.unshift(re),W.on("close",ae),W.on("data",_e),W.on("end",de),W.on("error",fe),this._readyState=v.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=v.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[f.extensionName]&&this._extensions[f.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=v.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(W,re){if(this.readyState!==v.CLOSED){if(this.readyState===v.CONNECTING){ee(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===v.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=v.CLOSING,this._sender.close(W,re,!this._isServer,le=>{le||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),se(this)}}pause(){this.readyState===v.CONNECTING||this.readyState===v.CLOSED||(this._paused=!0,this._socket.pause())}ping(W,re,le){if(this.readyState===v.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof W=="function"?(le=W,W=re=void 0):typeof re=="function"&&(le=re,re=void 0),typeof W=="number"&&(W=W.toString()),this.readyState!==v.OPEN){x(this,W,le);return}re===void 0&&(re=!this._isServer),this._sender.ping(W||E,re,le)}pong(W,re,le){if(this.readyState===v.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof W=="function"?(le=W,W=re=void 0):typeof re=="function"&&(le=re,re=void 0),typeof W=="number"&&(W=W.toString()),this.readyState!==v.OPEN){x(this,W,le);return}re===void 0&&(re=!this._isServer),this._sender.pong(W||E,re,le)}resume(){this.readyState===v.CONNECTING||this.readyState===v.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(W,re,le){if(this.readyState===v.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof re=="function"&&(le=re,re={}),typeof W=="number"&&(W=W.toString()),this.readyState!==v.OPEN){x(this,W,le);return}const ie={binary:typeof W!="string",mask:!this._isServer,compress:!0,fin:!0,...re};this._extensions[f.extensionName]||(ie.compress=!1),this._sender.send(W||E,ie,le)}terminate(){if(this.readyState!==v.CLOSED){if(this.readyState===v.CONNECTING){ee(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=v.CLOSING,this._socket.destroy())}}}Object.defineProperty(v,"CONNECTING",{enumerable:!0,value:M.indexOf("CONNECTING")}),Object.defineProperty(v.prototype,"CONNECTING",{enumerable:!0,value:M.indexOf("CONNECTING")}),Object.defineProperty(v,"OPEN",{enumerable:!0,value:M.indexOf("OPEN")}),Object.defineProperty(v.prototype,"OPEN",{enumerable:!0,value:M.indexOf("OPEN")}),Object.defineProperty(v,"CLOSING",{enumerable:!0,value:M.indexOf("CLOSING")}),Object.defineProperty(v.prototype,"CLOSING",{enumerable:!0,value:M.indexOf("CLOSING")}),Object.defineProperty(v,"CLOSED",{enumerable:!0,value:M.indexOf("CLOSED")}),Object.defineProperty(v.prototype,"CLOSED",{enumerable:!0,value:M.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach($=>{Object.defineProperty(v.prototype,$,{enumerable:!0})}),["open","error","close","message"].forEach($=>{Object.defineProperty(v.prototype,`on${$}`,{enumerable:!0,get(){for(const W of this.listeners($))if(W[S])return W[m];return null},set(W){for(const re of this.listeners($))if(re[S]){this.removeListener($,re);break}typeof W=="function"&&this.addEventListener($,W,{[S]:!0})}})}),v.prototype.addEventListener=N,v.prototype.removeEventListener=O,dh=v;function L($,W,re,le){const ie={allowSynchronousEvents:!0,autoPong:!0,closeTimeout:h,protocolVersion:U[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...le,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if($._autoPong=ie.autoPong,$._closeTimeout=ie.closeTimeout,!U.includes(ie.protocolVersion))throw new RangeError(`Unsupported protocol version: ${ie.protocolVersion} (supported versions: ${U.join(", ")})`);let Ae;if(W instanceof l)Ae=W;else try{Ae=new l(W)}catch{throw new SyntaxError(`Invalid URL: ${W}`)}Ae.protocol==="http:"?Ae.protocol="ws:":Ae.protocol==="https:"&&(Ae.protocol="wss:"),$._url=Ae.href;const Ke=Ae.protocol==="wss:",Fe=Ae.protocol==="ws+unix:";let dn;if(Ae.protocol!=="ws:"&&!Ke&&!Fe?dn=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`:Fe&&!Ae.pathname?dn="The URL's pathname is empty":Ae.hash&&(dn="The URL contains a fragment identifier"),dn){const Ce=new SyntaxError(dn);if($._redirects===0)throw Ce;H($,Ce);return}const Rr=Ke?443:80,yr=i(16).toString("base64"),Nr=Ke?t.request:n.request,fn=new Set;let _n;if(ie.createConnection=ie.createConnection||(Ke?ce:te),ie.defaultPort=ie.defaultPort||Rr,ie.port=Ae.port||Rr,ie.host=Ae.hostname.startsWith("[")?Ae.hostname.slice(1,-1):Ae.hostname,ie.headers={...ie.headers,"Sec-WebSocket-Version":ie.protocolVersion,"Sec-WebSocket-Key":yr,Connection:"Upgrade",Upgrade:"websocket"},ie.path=Ae.pathname+Ae.search,ie.timeout=ie.handshakeTimeout,ie.perMessageDeflate&&(_n=new f(ie.perMessageDeflate!==!0?ie.perMessageDeflate:{},!1,ie.maxPayload),ie.headers["Sec-WebSocket-Extensions"]=b({[f.extensionName]:_n.offer()})),re.length){for(const Ce of re){if(typeof Ce!="string"||!F.test(Ce)||fn.has(Ce))throw new SyntaxError("An invalid or duplicated subprotocol was specified");fn.add(Ce)}ie.headers["Sec-WebSocket-Protocol"]=re.join(",")}if(ie.origin&&(ie.protocolVersion<13?ie.headers["Sec-WebSocket-Origin"]=ie.origin:ie.headers.Origin=ie.origin),(Ae.username||Ae.password)&&(ie.auth=`${Ae.username}:${Ae.password}`),Fe){const Ce=ie.path.split(":");ie.socketPath=Ce[0],ie.path=Ce[1]}let qe;if(ie.followRedirects){if($._redirects===0){$._originalIpc=Fe,$._originalSecure=Ke,$._originalHostOrSocketPath=Fe?ie.socketPath:Ae.host;const Ce=le&&le.headers;if(le={...le,headers:{}},Ce)for(const[it,Zt]of Object.entries(Ce))le.headers[it.toLowerCase()]=Zt}else if($.listenerCount("redirect")===0){const Ce=Fe?$._originalIpc?ie.socketPath===$._originalHostOrSocketPath:!1:$._originalIpc?!1:Ae.host===$._originalHostOrSocketPath;(!Ce||$._originalSecure&&!Ke)&&(delete ie.headers.authorization,delete ie.headers.cookie,Ce||delete ie.headers.host,ie.auth=void 0)}ie.auth&&!le.headers.authorization&&(le.headers.authorization="Basic "+Buffer.from(ie.auth).toString("base64")),qe=$._req=Nr(ie),$._redirects&&$.emit("redirect",$.url,qe)}else qe=$._req=Nr(ie);ie.timeout&&qe.on("timeout",()=>{ee($,qe,"Opening handshake has timed out")}),qe.on("error",Ce=>{qe===null||qe[k]||(qe=$._req=null,H($,Ce))}),qe.on("response",Ce=>{const it=Ce.headers.location,Zt=Ce.statusCode;if(it&&ie.followRedirects&&Zt>=300&&Zt<400){if(++$._redirects>ie.maxRedirects){ee($,qe,"Maximum redirects exceeded");return}qe.abort();let pn;try{pn=new l(it,W)}catch{const Xt=new SyntaxError(`Invalid URL: ${it}`);H($,Xt);return}L($,pn,re,le)}else $.emit("unexpected-response",qe,Ce)||ee($,qe,`Unexpected server response: ${Ce.statusCode}`)}),qe.on("upgrade",(Ce,it,Zt)=>{if($.emit("upgrade",Ce),$.readyState!==v.CONNECTING)return;qe=$._req=null;const pn=Ce.headers.upgrade;if(pn===void 0||pn.toLowerCase()!=="websocket"){ee($,it,"Invalid Upgrade header");return}const Or=o("sha1").update(yr+T).digest("base64");if(Ce.headers["sec-websocket-accept"]!==Or){ee($,it,"Invalid Sec-WebSocket-Accept header");return}const Xt=Ce.headers["sec-websocket-protocol"];let hn;if(Xt!==void 0?fn.size?fn.has(Xt)||(hn="Server sent an invalid subprotocol"):hn="Server sent a subprotocol but none was requested":fn.size&&(hn="Server sent no subprotocol"),hn){ee($,it,hn);return}Xt&&($._protocol=Xt);const br=Ce.headers["sec-websocket-extensions"];if(br!==void 0){if(!_n){ee($,it,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let Xn;try{Xn=C(br)}catch{ee($,it,"Invalid Sec-WebSocket-Extensions header");return}const Ir=Object.keys(Xn);if(Ir.length!==1||Ir[0]!==f.extensionName){ee($,it,"Server indicated an extension that was not requested");return}try{_n.accept(Xn[f.extensionName])}catch{ee($,it,"Invalid Sec-WebSocket-Extensions header");return}$._extensions[f.extensionName]=_n}$.setSocket(it,Zt,{allowSynchronousEvents:ie.allowSynchronousEvents,generateMask:ie.generateMask,maxPayload:ie.maxPayload,skipUTF8Validation:ie.skipUTF8Validation})}),ie.finishRequest?ie.finishRequest(qe,$):qe.end()}function H($,W){$._readyState=v.CLOSING,$._errorEmitted=!0,$.emit("error",W),$.emitClose()}function te($){return $.path=$.socketPath,r.connect($)}function ce($){return $.path=void 0,!$.servername&&$.servername!==""&&($.servername=r.isIP($.host)?"":$.host),s.connect($)}function ee($,W,re){$._readyState=v.CLOSING;const le=new Error(re);Error.captureStackTrace(le,ee),W.setHeader?(W[k]=!0,W.abort(),W.socket&&!W.socket.destroyed&&W.socket.destroy(),process.nextTick(H,$,le)):(W.destroy(le),W.once("error",$.emit.bind($,"error")),W.once("close",$.emitClose.bind($)))}function x($,W,re){if(W){const le=_(W)?W.size:w(W).length;$._socket?$._sender._bufferedBytes+=le:$._bufferedAmount+=le}if(re){const le=new Error(`WebSocket is not open: readyState ${$.readyState} (${M[$.readyState]})`);process.nextTick(re,le)}}function B($,W){const re=this[y];re._closeFrameReceived=!0,re._closeMessage=W,re._closeCode=$,re._socket[y]!==void 0&&(re._socket.removeListener("data",_e),process.nextTick(X,re._socket),$===1005?re.close():re.close($,W))}function j(){const $=this[y];$.isPaused||$._socket.resume()}function q($){const W=this[y];W._socket[y]!==void 0&&(W._socket.removeListener("data",_e),process.nextTick(X,W._socket),W.close($[g])),W._errorEmitted||(W._errorEmitted=!0,W.emit("error",$))}function z(){this[y].emitClose()}function J($,W){this[y].emit("message",$,W)}function G($){const W=this[y];W._autoPong&&W.pong($,!this._isServer,A),W.emit("ping",$)}function V($){this[y].emit("pong",$)}function X($){$.resume()}function K($){const W=this[y];W.readyState!==v.CLOSED&&(W.readyState===v.OPEN&&(W._readyState=v.CLOSING,se(W)),this._socket.end(),W._errorEmitted||(W._errorEmitted=!0,W.emit("error",$)))}function se($){$._closeTimer=setTimeout($._socket.destroy.bind($._socket),$._closeTimeout)}function ae(){const $=this[y];if(this.removeListener("close",ae),this.removeListener("data",_e),this.removeListener("end",de),$._readyState=v.CLOSING,!this._readableState.endEmitted&&!$._closeFrameReceived&&!$._receiver._writableState.errorEmitted&&this._readableState.length!==0){const W=this.read(this._readableState.length);$._receiver.write(W)}$._receiver.end(),this[y]=void 0,clearTimeout($._closeTimer),$._receiver._writableState.finished||$._receiver._writableState.errorEmitted?$.emitClose():($._receiver.on("error",z),$._receiver.on("finish",z))}function _e($){this[y]._receiver.write($)||this.pause()}function de(){const $=this[y];$._readyState=v.CLOSING,$._receiver.end(),this.end()}function fe(){const $=this[y];this.removeListener("error",fe),this.on("error",A),$&&($._readyState=v.CLOSING,this.destroy())}return dh}var fh,Rv;function JJ(){if(Rv)return fh;Rv=1,dS();const{Duplex:e}=Sr;function t(i){i.emit("close")}function n(){!this.destroyed&&this._writableState.finished&&this.destroy()}function r(i){this.removeListener("error",r),this.destroy(),this.listenerCount("error")===0&&this.emit("error",i)}function s(i,o){let c=!0;const a=new e({...o,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return i.on("message",function(f,d){const u=!d&&a._readableState.objectMode?f.toString():f;a.push(u)||i.pause()}),i.once("error",function(f){a.destroyed||(c=!1,a.destroy(f))}),i.once("close",function(){a.destroyed||a.push(null)}),a._destroy=function(l,f){if(i.readyState===i.CLOSED){f(l),process.nextTick(t,a);return}let d=!1;i.once("error",function(_){d=!0,f(_)}),i.once("close",function(){d||f(l),process.nextTick(t,a)}),c&&i.terminate()},a._final=function(l){if(i.readyState===i.CONNECTING){i.once("open",function(){a._final(l)});return}i._socket!==null&&(i._socket._writableState.finished?(l(),a._readableState.endEmitted&&a.destroy()):(i._socket.once("finish",function(){l()}),i.close()))},a._read=function(){i.isPaused&&i.resume()},a._write=function(l,f,d){if(i.readyState===i.CONNECTING){i.once("open",function(){a._write(l,f,d)});return}i.send(l,d)},a.on("end",n),a.on("error",r),a}return fh=s,fh}JJ();uU();lU();dS();var _h,yv;function e7(){if(yv)return _h;yv=1;const{tokenChars:e}=Su();function t(n){const r=new Set;let s=-1,i=-1,o=0;for(o;o<n.length;o++){const a=n.charCodeAt(o);if(i===-1&&e[a]===1)s===-1&&(s=o);else if(o!==0&&(a===32||a===9))i===-1&&s!==-1&&(i=o);else if(a===44){if(s===-1)throw new SyntaxError(`Unexpected character at index ${o}`);i===-1&&(i=o);const l=n.slice(s,i);if(r.has(l))throw new SyntaxError(`The "${l}" subprotocol is duplicated`);r.add(l),s=i=-1}else throw new SyntaxError(`Unexpected character at index ${o}`)}if(s===-1||i!==-1)throw new SyntaxError("Unexpected end of input");const c=n.slice(s,o);if(r.has(c))throw new SyntaxError(`The "${c}" subprotocol is duplicated`);return r.add(c),r}return _h={parse:t},_h}var ph,Nv;function t7(){if(Nv)return ph;Nv=1;const e=Hr,t=ed,{Duplex:n}=Sr,{createHash:r}=$E,s=dU(),i=qd(),o=e7(),c=dS(),{CLOSE_TIMEOUT:a,GUID:l,kWebSocket:f}=Kr(),d=/^[+/0-9A-Za-z]{22}==$/,u=0,_=1,p=2;class h extends e{constructor(A,N){if(super(),A={allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,closeTimeout:a,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:c,...A},A.port==null&&!A.server&&!A.noServer||A.port!=null&&(A.server||A.noServer)||A.server&&A.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(A.port!=null?(this._server=t.createServer((O,b)=>{const C=t.STATUS_CODES[426];b.writeHead(426,{"Content-Length":C.length,"Content-Type":"text/plain"}),b.end(C)}),this._server.listen(A.port,A.host,A.backlog,N)):A.server&&(this._server=A.server),this._server){const O=this.emit.bind(this,"connection");this._removeListeners=E(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(b,C,w)=>{this.handleUpgrade(b,C,w,O)}})}A.perMessageDeflate===!0&&(A.perMessageDeflate={}),A.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=A,this._state=u}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(A){if(this._state===p){A&&this.once("close",()=>{A(new Error("The server is not running"))}),process.nextTick(T,this);return}if(A&&this.once("close",A),this._state!==_)if(this._state=_,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(T,this):process.nextTick(T,this);else{const N=this._server;this._removeListeners(),this._removeListeners=this._server=null,N.close(()=>{T(this)})}}shouldHandle(A){if(this.options.path){const N=A.url.indexOf("?");if((N!==-1?A.url.slice(0,N):A.url)!==this.options.path)return!1}return!0}handleUpgrade(A,N,O,b){N.on("error",S);const C=A.headers["sec-websocket-key"],w=A.headers.upgrade,k=+A.headers["sec-websocket-version"];if(A.method!=="GET"){g(this,A,N,405,"Invalid HTTP method");return}if(w===void 0||w.toLowerCase()!=="websocket"){g(this,A,N,400,"Invalid Upgrade header");return}if(C===void 0||!d.test(C)){g(this,A,N,400,"Missing or invalid Sec-WebSocket-Key header");return}if(k!==13&&k!==8){g(this,A,N,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(A)){m(N,400);return}const U=A.headers["sec-websocket-protocol"];let M=new Set;if(U!==void 0)try{M=o.parse(U)}catch{g(this,A,N,400,"Invalid Sec-WebSocket-Protocol header");return}const F=A.headers["sec-websocket-extensions"],v={};if(this.options.perMessageDeflate&&F!==void 0){const L=new i(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const H=s.parse(F);H[i.extensionName]&&(L.accept(H[i.extensionName]),v[i.extensionName]=L)}catch{g(this,A,N,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){const L={origin:A.headers[`${k===8?"sec-websocket-origin":"origin"}`],secure:!!(A.socket.authorized||A.socket.encrypted),req:A};if(this.options.verifyClient.length===2){this.options.verifyClient(L,(H,te,ce,ee)=>{if(!H)return m(N,te||401,ce,ee);this.completeUpgrade(v,C,M,A,N,O,b)});return}if(!this.options.verifyClient(L))return m(N,401)}this.completeUpgrade(v,C,M,A,N,O,b)}completeUpgrade(A,N,O,b,C,w,k){if(!C.readable||!C.writable)return C.destroy();if(C[f])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>u)return m(C,503);const M=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${r("sha1").update(N+l).digest("base64")}`],F=new this.options.WebSocket(null,void 0,this.options);if(O.size){const v=this.options.handleProtocols?this.options.handleProtocols(O,b):O.values().next().value;v&&(M.push(`Sec-WebSocket-Protocol: ${v}`),F._protocol=v)}if(A[i.extensionName]){const v=A[i.extensionName].params,L=s.format({[i.extensionName]:[v]});M.push(`Sec-WebSocket-Extensions: ${L}`),F._extensions=A}this.emit("headers",M,b),C.write(M.concat(`\r
`).join(`\r
`)),C.removeListener("error",S),F.setSocket(C,w,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(F),F.on("close",()=>{this.clients.delete(F),this._shouldEmitClose&&!this.clients.size&&process.nextTick(T,this)})),k(F,b)}}ph=h;function E(y,A){for(const N of Object.keys(A))y.on(N,A[N]);return function(){for(const O of Object.keys(A))y.removeListener(O,A[O])}}function T(y){y._state=p,y.emit("close")}function S(){this.destroy()}function m(y,A,N,O){N=N||t.STATUS_CODES[A],O={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(N),...O},y.once("finish",y.destroy),y.end(`HTTP/1.1 ${A} ${t.STATUS_CODES[A]}\r
`+Object.keys(O).map(b=>`${b}: ${O[b]}`).join(`\r
`)+`\r
\r
`+N)}function g(y,A,N,O,b,C){if(y.listenerCount("wsClientError")){const w=new Error(b);Error.captureStackTrace(w,g),y.emit("wsClientError",w,N,A)}else m(N,O,b,C)}return ph}t7();const n7=["IN_PROGRESS","PENDING_REVIEW"],r7=["IN_PROGRESS","PENDING_REVIEW","ACCEPTED","ARCHIVED"],fU=e=>`(${e.map(t=>`'${t}'`).join(", ")})`;fU(n7);fU(r7);var CE=["MO","TU","WE","TH","FR","SA","SU"],Pt=(function(){function e(t,n){if(n===0)throw new Error("Can't create weekday with n == 0");this.weekday=t,this.n=n}return e.fromStr=function(t){return new e(CE.indexOf(t))},e.prototype.nth=function(t){return this.n===t?this:new e(this.weekday,t)},e.prototype.equals=function(t){return this.weekday===t.weekday&&this.n===t.n},e.prototype.toString=function(){var t=CE[this.weekday];return this.n&&(t=(this.n>0?"+":"")+String(this.n)+t),t},e.prototype.getJsWeekday=function(){return this.weekday===6?0:this.weekday+1},e})(),ot=function(e){return e!=null},Bn=function(e){return typeof e=="number"},Ov=function(e){return typeof e=="string"&&CE.includes(e)},Wt=Array.isArray,Zn=function(e,t){t===void 0&&(t=e),arguments.length===1&&(t=e,e=0);for(var n=[],r=e;r<t;r++)n.push(r);return n},we=function(e,t){var n=0,r=[];if(Wt(e))for(;n<t;n++)r[n]=[].concat(e);else for(;n<t;n++)r[n]=e;return r},s7=function(e){return Wt(e)?e:[e]};function Ei(e,t,n){n===void 0&&(n=" ");var r=String(e);return t=t>>0,r.length>t?String(r):(t=t-r.length,t>n.length&&(n+=we(n,t/n.length)),n.slice(0,t)+String(r))}var i7=function(e,t,n){var r=e.split(t);return n?r.slice(0,n).concat([r.slice(n).join(t)]):r},en=function(e,t){var n=e%t;return n*t<0?n+t:n},hh=function(e,t){return{div:Math.floor(e/t),mod:en(e,t)}},Hn=function(e){return!ot(e)||e.length===0},ft=function(e){return!Hn(e)},Ve=function(e,t){return ft(e)&&e.indexOf(t)!==-1},ni=function(e,t,n,r,s,i){return r===void 0&&(r=0),s===void 0&&(s=0),i===void 0&&(i=0),new Date(Date.UTC(e,t-1,n,r,s,i))},o7=[31,28,31,30,31,30,31,31,30,31,30,31],_U=1e3*60*60*24,pU=9999,hU=ni(1970,1,1),a7=[6,0,1,2,3,4,5],$c=function(e){return e%4===0&&e%100!==0||e%400===0},EU=function(e){return e instanceof Date},kc=function(e){return EU(e)&&!isNaN(e.getTime())},c7=function(e,t){var n=e.getTime(),r=t.getTime(),s=n-r;return Math.round(s/_U)},vE=function(e){return c7(e,hU)},TU=function(e){return new Date(hU.getTime()+e*_U)},u7=function(e){var t=e.getUTCMonth();return t===1&&$c(e.getUTCFullYear())?29:o7[t]},Yi=function(e){return a7[e.getUTCDay()]},bv=function(e,t){var n=ni(e,t+1,1);return[Yi(n),u7(n)]},SU=function(e,t){return t=t||e,new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()))},PE=function(e){var t=new Date(e.getTime());return t},Iv=function(e){for(var t=[],n=0;n<e.length;n++)t.push(PE(e[n]));return t},ru=function(e){e.sort(function(t,n){return t.getTime()-n.getTime()})},fS=function(e,t){t===void 0&&(t=!0);var n=new Date(e);return[Ei(n.getUTCFullYear().toString(),4,"0"),Ei(n.getUTCMonth()+1,2,"0"),Ei(n.getUTCDate(),2,"0"),"T",Ei(n.getUTCHours(),2,"0"),Ei(n.getUTCMinutes(),2,"0"),Ei(n.getUTCSeconds(),2,"0"),t?"Z":""].join("")},_S=function(e){var t=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z?)?$/,n=t.exec(e);if(!n)throw new Error("Invalid UNTIL value: ".concat(e));return new Date(Date.UTC(parseInt(n[1],10),parseInt(n[2],10)-1,parseInt(n[3],10),parseInt(n[5],10)||0,parseInt(n[6],10)||0,parseInt(n[7],10)||0))},Cv=function(e,t){var n=e.toLocaleString("sv-SE",{timeZone:t});return n.replace(" ","T")+"Z"},l7=function(e,t){var n=Intl.DateTimeFormat().resolvedOptions().timeZone,r=new Date(Cv(e,n)),s=new Date(Cv(e,t??"UTC")),i=s.getTime()-r.getTime();return new Date(e.getTime()-i)},bi=(function(){function e(t,n){this.minDate=null,this.maxDate=null,this._result=[],this.total=0,this.method=t,this.args=n,t==="between"?(this.maxDate=n.inc?n.before:new Date(n.before.getTime()-1),this.minDate=n.inc?n.after:new Date(n.after.getTime()+1)):t==="before"?this.maxDate=n.inc?n.dt:new Date(n.dt.getTime()-1):t==="after"&&(this.minDate=n.inc?n.dt:new Date(n.dt.getTime()+1))}return e.prototype.accept=function(t){++this.total;var n=this.minDate&&t<this.minDate,r=this.maxDate&&t>this.maxDate;if(this.method==="between"){if(n)return!0;if(r)return!1}else if(this.method==="before"){if(r)return!1}else if(this.method==="after")return n?!0:(this.add(t),!1);return this.add(t)},e.prototype.add=function(t){return this._result.push(t),!0},e.prototype.getValue=function(){var t=this._result;switch(this.method){case"all":case"between":return t;case"before":case"after":default:return t.length?t[t.length-1]:null}},e.prototype.clone=function(){return new e(this.method,this.args)},e})(),Eh={exports:{}},vv;function d7(){return vv||(vv=1,(function(e){var t,n,r,s,i,o,c,a,l,f,d,u,_,p,h,E,T,S,m,g,y,A,N,O,b,C,w,k,U,M,F,v;(function(L){var H=typeof bn=="object"?bn:typeof self=="object"?self:typeof this=="object"?this:{};L(te(H,te(e.exports)));function te(ce,ee){return ce!==H&&(typeof Object.create=="function"?Object.defineProperty(ce,"__esModule",{value:!0}):ce.__esModule=!0),function(x,B){return ce[x]=ee?ee(x,B):B}}})(function(L){var H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,B){x.__proto__=B}||function(x,B){for(var j in B)Object.prototype.hasOwnProperty.call(B,j)&&(x[j]=B[j])};t=function(x,B){if(typeof B!="function"&&B!==null)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");H(x,B);function j(){this.constructor=x}x.prototype=B===null?Object.create(B):(j.prototype=B.prototype,new j)},n=Object.assign||function(x){for(var B,j=1,q=arguments.length;j<q;j++){B=arguments[j];for(var z in B)Object.prototype.hasOwnProperty.call(B,z)&&(x[z]=B[z])}return x},r=function(x,B){var j={};for(var q in x)Object.prototype.hasOwnProperty.call(x,q)&&B.indexOf(q)<0&&(j[q]=x[q]);if(x!=null&&typeof Object.getOwnPropertySymbols=="function")for(var z=0,q=Object.getOwnPropertySymbols(x);z<q.length;z++)B.indexOf(q[z])<0&&Object.prototype.propertyIsEnumerable.call(x,q[z])&&(j[q[z]]=x[q[z]]);return j},s=function(x,B,j,q){var z=arguments.length,J=z<3?B:q===null?q=Object.getOwnPropertyDescriptor(B,j):q,G;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")J=Reflect.decorate(x,B,j,q);else for(var V=x.length-1;V>=0;V--)(G=x[V])&&(J=(z<3?G(J):z>3?G(B,j,J):G(B,j))||J);return z>3&&J&&Object.defineProperty(B,j,J),J},i=function(x,B){return function(j,q){B(j,q,x)}},o=function(x,B,j,q,z,J){function G(re){if(re!==void 0&&typeof re!="function")throw new TypeError("Function expected");return re}for(var V=q.kind,X=V==="getter"?"get":V==="setter"?"set":"value",K=!B&&x?q.static?x:x.prototype:null,se=B||(K?Object.getOwnPropertyDescriptor(K,q.name):{}),ae,_e=!1,de=j.length-1;de>=0;de--){var fe={};for(var $ in q)fe[$]=$==="access"?{}:q[$];for(var $ in q.access)fe.access[$]=q.access[$];fe.addInitializer=function(re){if(_e)throw new TypeError("Cannot add initializers after decoration has completed");J.push(G(re||null))};var W=(0,j[de])(V==="accessor"?{get:se.get,set:se.set}:se[X],fe);if(V==="accessor"){if(W===void 0)continue;if(W===null||typeof W!="object")throw new TypeError("Object expected");(ae=G(W.get))&&(se.get=ae),(ae=G(W.set))&&(se.set=ae),(ae=G(W.init))&&z.unshift(ae)}else(ae=G(W))&&(V==="field"?z.unshift(ae):se[X]=ae)}K&&Object.defineProperty(K,q.name,se),_e=!0},c=function(x,B,j){for(var q=arguments.length>2,z=0;z<B.length;z++)j=q?B[z].call(x,j):B[z].call(x);return q?j:void 0},a=function(x){return typeof x=="symbol"?x:"".concat(x)},l=function(x,B,j){return typeof B=="symbol"&&(B=B.description?"[".concat(B.description,"]"):""),Object.defineProperty(x,"name",{configurable:!0,value:j?"".concat(j," ",B):B})},f=function(x,B){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(x,B)},d=function(x,B,j,q){function z(J){return J instanceof j?J:new j(function(G){G(J)})}return new(j||(j=Promise))(function(J,G){function V(se){try{K(q.next(se))}catch(ae){G(ae)}}function X(se){try{K(q.throw(se))}catch(ae){G(ae)}}function K(se){se.done?J(se.value):z(se.value).then(V,X)}K((q=q.apply(x,B||[])).next())})},u=function(x,B){var j={label:0,sent:function(){if(J[0]&1)throw J[1];return J[1]},trys:[],ops:[]},q,z,J,G=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return G.next=V(0),G.throw=V(1),G.return=V(2),typeof Symbol=="function"&&(G[Symbol.iterator]=function(){return this}),G;function V(K){return function(se){return X([K,se])}}function X(K){if(q)throw new TypeError("Generator is already executing.");for(;G&&(G=0,K[0]&&(j=0)),j;)try{if(q=1,z&&(J=K[0]&2?z.return:K[0]?z.throw||((J=z.return)&&J.call(z),0):z.next)&&!(J=J.call(z,K[1])).done)return J;switch(z=0,J&&(K=[K[0]&2,J.value]),K[0]){case 0:case 1:J=K;break;case 4:return j.label++,{value:K[1],done:!1};case 5:j.label++,z=K[1],K=[0];continue;case 7:K=j.ops.pop(),j.trys.pop();continue;default:if(J=j.trys,!(J=J.length>0&&J[J.length-1])&&(K[0]===6||K[0]===2)){j=0;continue}if(K[0]===3&&(!J||K[1]>J[0]&&K[1]<J[3])){j.label=K[1];break}if(K[0]===6&&j.label<J[1]){j.label=J[1],J=K;break}if(J&&j.label<J[2]){j.label=J[2],j.ops.push(K);break}J[2]&&j.ops.pop(),j.trys.pop();continue}K=B.call(x,j)}catch(se){K=[6,se],z=0}finally{q=J=0}if(K[0]&5)throw K[1];return{value:K[0]?K[1]:void 0,done:!0}}},_=function(x,B){for(var j in x)j!=="default"&&!Object.prototype.hasOwnProperty.call(B,j)&&U(B,x,j)},U=Object.create?(function(x,B,j,q){q===void 0&&(q=j);var z=Object.getOwnPropertyDescriptor(B,j);(!z||("get"in z?!B.__esModule:z.writable||z.configurable))&&(z={enumerable:!0,get:function(){return B[j]}}),Object.defineProperty(x,q,z)}):(function(x,B,j,q){q===void 0&&(q=j),x[q]=B[j]}),p=function(x){var B=typeof Symbol=="function"&&Symbol.iterator,j=B&&x[B],q=0;if(j)return j.call(x);if(x&&typeof x.length=="number")return{next:function(){return x&&q>=x.length&&(x=void 0),{value:x&&x[q++],done:!x}}};throw new TypeError(B?"Object is not iterable.":"Symbol.iterator is not defined.")},h=function(x,B){var j=typeof Symbol=="function"&&x[Symbol.iterator];if(!j)return x;var q=j.call(x),z,J=[],G;try{for(;(B===void 0||B-- >0)&&!(z=q.next()).done;)J.push(z.value)}catch(V){G={error:V}}finally{try{z&&!z.done&&(j=q.return)&&j.call(q)}finally{if(G)throw G.error}}return J},E=function(){for(var x=[],B=0;B<arguments.length;B++)x=x.concat(h(arguments[B]));return x},T=function(){for(var x=0,B=0,j=arguments.length;B<j;B++)x+=arguments[B].length;for(var q=Array(x),z=0,B=0;B<j;B++)for(var J=arguments[B],G=0,V=J.length;G<V;G++,z++)q[z]=J[G];return q},S=function(x,B,j){if(j||arguments.length===2)for(var q=0,z=B.length,J;q<z;q++)(J||!(q in B))&&(J||(J=Array.prototype.slice.call(B,0,q)),J[q]=B[q]);return x.concat(J||Array.prototype.slice.call(B))},m=function(x){return this instanceof m?(this.v=x,this):new m(x)},g=function(x,B,j){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var q=j.apply(x,B||[]),z,J=[];return z=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),V("next"),V("throw"),V("return",G),z[Symbol.asyncIterator]=function(){return this},z;function G(de){return function(fe){return Promise.resolve(fe).then(de,ae)}}function V(de,fe){q[de]&&(z[de]=function($){return new Promise(function(W,re){J.push([de,$,W,re])>1||X(de,$)})},fe&&(z[de]=fe(z[de])))}function X(de,fe){try{K(q[de](fe))}catch($){_e(J[0][3],$)}}function K(de){de.value instanceof m?Promise.resolve(de.value.v).then(se,ae):_e(J[0][2],de)}function se(de){X("next",de)}function ae(de){X("throw",de)}function _e(de,fe){de(fe),J.shift(),J.length&&X(J[0][0],J[0][1])}},y=function(x){var B,j;return B={},q("next"),q("throw",function(z){throw z}),q("return"),B[Symbol.iterator]=function(){return this},B;function q(z,J){B[z]=x[z]?function(G){return(j=!j)?{value:m(x[z](G)),done:!1}:J?J(G):G}:J}},A=function(x){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var B=x[Symbol.asyncIterator],j;return B?B.call(x):(x=typeof p=="function"?p(x):x[Symbol.iterator](),j={},q("next"),q("throw"),q("return"),j[Symbol.asyncIterator]=function(){return this},j);function q(J){j[J]=x[J]&&function(G){return new Promise(function(V,X){G=x[J](G),z(V,X,G.done,G.value)})}}function z(J,G,V,X){Promise.resolve(X).then(function(K){J({value:K,done:V})},G)}},N=function(x,B){return Object.defineProperty?Object.defineProperty(x,"raw",{value:B}):x.raw=B,x};var te=Object.create?(function(x,B){Object.defineProperty(x,"default",{enumerable:!0,value:B})}):function(x,B){x.default=B},ce=function(x){return ce=Object.getOwnPropertyNames||function(B){var j=[];for(var q in B)Object.prototype.hasOwnProperty.call(B,q)&&(j[j.length]=q);return j},ce(x)};O=function(x){if(x&&x.__esModule)return x;var B={};if(x!=null)for(var j=ce(x),q=0;q<j.length;q++)j[q]!=="default"&&U(B,x,j[q]);return te(B,x),B},b=function(x){return x&&x.__esModule?x:{default:x}},C=function(x,B,j,q){if(j==="a"&&!q)throw new TypeError("Private accessor was defined without a getter");if(typeof B=="function"?x!==B||!q:!B.has(x))throw new TypeError("Cannot read private member from an object whose class did not declare it");return j==="m"?q:j==="a"?q.call(x):q?q.value:B.get(x)},w=function(x,B,j,q,z){if(q==="m")throw new TypeError("Private method is not writable");if(q==="a"&&!z)throw new TypeError("Private accessor was defined without a setter");if(typeof B=="function"?x!==B||!z:!B.has(x))throw new TypeError("Cannot write private member to an object whose class did not declare it");return q==="a"?z.call(x,j):z?z.value=j:B.set(x,j),j},k=function(x,B){if(B===null||typeof B!="object"&&typeof B!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof x=="function"?B===x:x.has(B)},M=function(x,B,j){if(B!=null){if(typeof B!="object"&&typeof B!="function")throw new TypeError("Object expected.");var q,z;if(j){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");q=B[Symbol.asyncDispose]}if(q===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");q=B[Symbol.dispose],j&&(z=q)}if(typeof q!="function")throw new TypeError("Object not disposable.");z&&(q=function(){try{z.call(this)}catch(J){return Promise.reject(J)}}),x.stack.push({value:B,dispose:q,async:j})}else j&&x.stack.push({async:!0});return B};var ee=typeof SuppressedError=="function"?SuppressedError:function(x,B,j){var q=new Error(j);return q.name="SuppressedError",q.error=x,q.suppressed=B,q};F=function(x){function B(J){x.error=x.hasError?new ee(J,x.error,"An error was suppressed during disposal."):J,x.hasError=!0}var j,q=0;function z(){for(;j=x.stack.pop();)try{if(!j.async&&q===1)return q=0,x.stack.push(j),Promise.resolve().then(z);if(j.dispose){var J=j.dispose.call(j.value);if(j.async)return q|=2,Promise.resolve(J).then(z,function(G){return B(G),z()})}else q|=1}catch(G){B(G)}if(q===1)return x.hasError?Promise.reject(x.error):Promise.resolve();if(x.hasError)throw x.error}return z()},v=function(x,B){return typeof x=="string"&&/^\.\.?\//.test(x)?x.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(j,q,z,J,G){return q?B?".jsx":".js":z&&(!J||!G)?j:z+J+"."+G.toLowerCase()+"js"}):x},L("__extends",t),L("__assign",n),L("__rest",r),L("__decorate",s),L("__param",i),L("__esDecorate",o),L("__runInitializers",c),L("__propKey",a),L("__setFunctionName",l),L("__metadata",f),L("__awaiter",d),L("__generator",u),L("__exportStar",_),L("__createBinding",U),L("__values",p),L("__read",h),L("__spread",E),L("__spreadArrays",T),L("__spreadArray",S),L("__await",m),L("__asyncGenerator",g),L("__asyncDelegator",y),L("__asyncValues",A),L("__makeTemplateObject",N),L("__importStar",O),L("__importDefault",b),L("__classPrivateFieldGet",C),L("__classPrivateFieldSet",w),L("__classPrivateFieldIn",k),L("__addDisposableResource",M),L("__disposeResources",F),L("__rewriteRelativeImportExtension",v)})})(Eh)),Eh.exports}var f7=d7();const _7=td(f7),{__extends:pS,__assign:Pn,__rest:Mse,__decorate:wse,__param:Lse,__esDecorate:Dse,__runInitializers:Use,__propKey:kse,__setFunctionName:xse,__metadata:Bse,__awaiter:Gse,__generator:Vse,__exportStar:$se,__createBinding:Hse,__values:Fse,__read:jse,__spread:qse,__spreadArrays:Yse,__spreadArray:oe,__await:Wse,__asyncGenerator:Kse,__asyncDelegator:zse,__asyncValues:Zse,__makeTemplateObject:Xse,__importStar:Qse,__importDefault:Jse,__classPrivateFieldGet:eie,__classPrivateFieldSet:tie,__classPrivateFieldIn:nie,__addDisposableResource:rie,__disposeResources:sie,__rewriteRelativeImportExtension:iie}=_7;var Pv=(function(e){pS(t,e);function t(n,r,s){var i=e.call(this,n,r)||this;return i.iterator=s,i}return t.prototype.add=function(n){return this.iterator(n,this._result.length)?(this._result.push(n),!0):!1},t})(bi),Yl={dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],tokens:{SKIP:/^[ \r\n\t]+|^\.$/,number:/^[1-9][0-9]*/,numberAsText:/^(one|two|three)/i,every:/^every/i,"day(s)":/^days?/i,"weekday(s)":/^weekdays?/i,"week(s)":/^weeks?/i,"hour(s)":/^hours?/i,"minute(s)":/^minutes?/i,"month(s)":/^months?/i,"year(s)":/^years?/i,on:/^(on|in)/i,at:/^(at)/i,the:/^the/i,first:/^first/i,second:/^second/i,third:/^third/i,nth:/^([1-9][0-9]*)(\.|th|nd|rd|st)/i,last:/^last/i,for:/^for/i,"time(s)":/^times?/i,until:/^(un)?til/i,monday:/^mo(n(day)?)?/i,tuesday:/^tu(e(s(day)?)?)?/i,wednesday:/^we(d(n(esday)?)?)?/i,thursday:/^th(u(r(sday)?)?)?/i,friday:/^fr(i(day)?)?/i,saturday:/^sa(t(urday)?)?/i,sunday:/^su(n(day)?)?/i,january:/^jan(uary)?/i,february:/^feb(ruary)?/i,march:/^mar(ch)?/i,april:/^apr(il)?/i,may:/^may/i,june:/^june?/i,july:/^july?/i,august:/^aug(ust)?/i,september:/^sep(t(ember)?)?/i,october:/^oct(ober)?/i,november:/^nov(ember)?/i,december:/^dec(ember)?/i,comma:/^(,\s*|(and|or)\s*)+/i}},Mv=function(e,t){return e.indexOf(t)!==-1},p7=function(e){return e.toString()},h7=function(e,t,n){return"".concat(t," ").concat(n,", ").concat(e)},Ar=(function(){function e(t,n,r,s){if(n===void 0&&(n=p7),r===void 0&&(r=Yl),s===void 0&&(s=h7),this.text=[],this.language=r||Yl,this.gettext=n,this.dateFormatter=s,this.rrule=t,this.options=t.options,this.origOptions=t.origOptions,this.origOptions.bymonthday){var i=[].concat(this.options.bymonthday),o=[].concat(this.options.bynmonthday);i.sort(function(f,d){return f-d}),o.sort(function(f,d){return d-f}),this.bymonthday=i.concat(o),this.bymonthday.length||(this.bymonthday=null)}if(ot(this.origOptions.byweekday)){var c=Wt(this.origOptions.byweekday)?this.origOptions.byweekday:[this.origOptions.byweekday],a=String(c);this.byweekday={allWeeks:c.filter(function(f){return!f.n}),someWeeks:c.filter(function(f){return!!f.n}),isWeekdays:a.indexOf("MO")!==-1&&a.indexOf("TU")!==-1&&a.indexOf("WE")!==-1&&a.indexOf("TH")!==-1&&a.indexOf("FR")!==-1&&a.indexOf("SA")===-1&&a.indexOf("SU")===-1,isEveryDay:a.indexOf("MO")!==-1&&a.indexOf("TU")!==-1&&a.indexOf("WE")!==-1&&a.indexOf("TH")!==-1&&a.indexOf("FR")!==-1&&a.indexOf("SA")!==-1&&a.indexOf("SU")!==-1};var l=function(f,d){return f.weekday-d.weekday};this.byweekday.allWeeks.sort(l),this.byweekday.someWeeks.sort(l),this.byweekday.allWeeks.length||(this.byweekday.allWeeks=null),this.byweekday.someWeeks.length||(this.byweekday.someWeeks=null)}else this.byweekday=null}return e.isFullyConvertible=function(t){var n=!0;if(!(t.options.freq in e.IMPLEMENTED)||t.origOptions.until&&t.origOptions.count)return!1;for(var r in t.origOptions){if(Mv(["dtstart","tzid","wkst","freq"],r))return!0;if(!Mv(e.IMPLEMENTED[t.options.freq],r))return!1}return n},e.prototype.isFullyConvertible=function(){return e.isFullyConvertible(this.rrule)},e.prototype.toString=function(){var t=this.gettext;if(!(this.options.freq in e.IMPLEMENTED))return t("RRule error: Unable to fully convert this rrule to text");if(this.text=[t("every")],this[ge.FREQUENCIES[this.options.freq]](),this.options.until){this.add(t("until"));var n=this.options.until;this.add(this.dateFormatter(n.getUTCFullYear(),this.language.monthNames[n.getUTCMonth()],n.getUTCDate()))}else this.options.count&&this.add(t("for")).add(this.options.count.toString()).add(this.plural(this.options.count)?t("times"):t("time"));return this.isFullyConvertible()||this.add(t("(~ approximate)")),this.text.join("")},e.prototype.HOURLY=function(){var t=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("hours"):t("hour"))},e.prototype.MINUTELY=function(){var t=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("minutes"):t("minute"))},e.prototype.DAILY=function(){var t=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.byweekday&&this.byweekday.isWeekdays?this.add(this.plural(this.options.interval)?t("weekdays"):t("weekday")):this.add(this.plural(this.options.interval)?t("days"):t("day")),this.origOptions.bymonth&&(this.add(t("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday?this._byweekday():this.origOptions.byhour&&this._byhour()},e.prototype.WEEKLY=function(){var t=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()).add(this.plural(this.options.interval)?t("weeks"):t("week")),this.byweekday&&this.byweekday.isWeekdays?this.options.interval===1?this.add(this.plural(this.options.interval)?t("weekdays"):t("weekday")):this.add(t("on")).add(t("weekdays")):this.byweekday&&this.byweekday.isEveryDay?this.add(this.plural(this.options.interval)?t("days"):t("day")):(this.options.interval===1&&this.add(t("week")),this.origOptions.bymonth&&(this.add(t("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.origOptions.byhour&&this._byhour())},e.prototype.MONTHLY=function(){var t=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()).add(t("months")),this.plural(this.options.interval)&&this.add(t("in"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("months"):t("month"))),this.bymonthday?this._bymonthday():this.byweekday&&this.byweekday.isWeekdays?this.add(t("on")).add(t("weekdays")):this.byweekday&&this._byweekday()},e.prototype.YEARLY=function(){var t=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()),this.add(t("years"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?t("years"):t("year"))),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.options.byyearday&&this.add(t("on the")).add(this.list(this.options.byyearday,this.nth,t("and"))).add(t("day")),this.options.byweekno&&this.add(t("in")).add(this.plural(this.options.byweekno.length)?t("weeks"):t("week")).add(this.list(this.options.byweekno,void 0,t("and")))},e.prototype._bymonthday=function(){var t=this.gettext;this.byweekday&&this.byweekday.allWeeks?this.add(t("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext,t("or"))).add(t("the")).add(this.list(this.bymonthday,this.nth,t("or"))):this.add(t("on the")).add(this.list(this.bymonthday,this.nth,t("and")))},e.prototype._byweekday=function(){var t=this.gettext;this.byweekday.allWeeks&&!this.byweekday.isWeekdays&&this.add(t("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext)),this.byweekday.someWeeks&&(this.byweekday.allWeeks&&this.add(t("and")),this.add(t("on the")).add(this.list(this.byweekday.someWeeks,this.weekdaytext,t("and"))))},e.prototype._byhour=function(){var t=this.gettext;this.add(t("at")).add(this.list(this.origOptions.byhour,void 0,t("and")))},e.prototype._bymonth=function(){this.add(this.list(this.options.bymonth,this.monthtext,this.gettext("and")))},e.prototype.nth=function(t){t=parseInt(t.toString(),10);var n,r=this.gettext;if(t===-1)return r("last");var s=Math.abs(t);switch(s){case 1:case 21:case 31:n=s+r("st");break;case 2:case 22:n=s+r("nd");break;case 3:case 23:n=s+r("rd");break;default:n=s+r("th")}return t<0?n+" "+r("last"):n},e.prototype.monthtext=function(t){return this.language.monthNames[t-1]},e.prototype.weekdaytext=function(t){var n=Bn(t)?(t+1)%7:t.getJsWeekday();return(t.n?this.nth(t.n)+" ":"")+this.language.dayNames[n]},e.prototype.plural=function(t){return t%100!==1},e.prototype.add=function(t){return this.text.push(" "),this.text.push(t),this},e.prototype.list=function(t,n,r,s){var i=this;s===void 0&&(s=","),Wt(t)||(t=[t]);var o=function(a,l,f){for(var d="",u=0;u<a.length;u++)u!==0&&(u===a.length-1?d+=" "+f+" ":d+=l+" "),d+=a[u];return d};n=n||function(a){return a.toString()};var c=function(a){return n&&n.call(i,a)};return r?o(t.map(c),s,r):t.map(c).join(s+" ")},e})(),E7=(function(){function e(t){this.done=!0,this.rules=t}return e.prototype.start=function(t){return this.text=t,this.done=!1,this.nextSymbol()},e.prototype.isDone=function(){return this.done&&this.symbol===null},e.prototype.nextSymbol=function(){var t,n;this.symbol=null,this.value=null;do{if(this.done)return!1;var r=void 0;t=null;for(var s in this.rules){r=this.rules[s];var i=r.exec(this.text);i&&(t===null||i[0].length>t[0].length)&&(t=i,n=s)}if(t!=null&&(this.text=this.text.substr(t[0].length),this.text===""&&(this.done=!0)),t==null){this.done=!0,this.symbol=null,this.value=null;return}}while(n==="SKIP");return this.symbol=n,this.value=t,!0},e.prototype.accept=function(t){if(this.symbol===t){if(this.value){var n=this.value;return this.nextSymbol(),n}return this.nextSymbol(),!0}return!1},e.prototype.acceptNumber=function(){return this.accept("number")},e.prototype.expect=function(t){if(this.accept(t))return!0;throw new Error("expected "+t+" but found "+this.symbol)},e})();function mU(e,t){t===void 0&&(t=Yl);var n={},r=new E7(t.tokens);if(!r.start(e))return null;return s(),n;function s(){r.expect("every");var u=r.acceptNumber();if(u&&(n.interval=parseInt(u[0],10)),r.isDone())throw new Error("Unexpected end");switch(r.symbol){case"day(s)":n.freq=ge.DAILY,r.nextSymbol()&&(o(),d());break;case"weekday(s)":n.freq=ge.WEEKLY,n.byweekday=[ge.MO,ge.TU,ge.WE,ge.TH,ge.FR],r.nextSymbol(),o(),d();break;case"week(s)":n.freq=ge.WEEKLY,r.nextSymbol()&&(i(),o(),d());break;case"hour(s)":n.freq=ge.HOURLY,r.nextSymbol()&&(i(),d());break;case"minute(s)":n.freq=ge.MINUTELY,r.nextSymbol()&&(i(),d());break;case"month(s)":n.freq=ge.MONTHLY,r.nextSymbol()&&(i(),d());break;case"year(s)":n.freq=ge.YEARLY,r.nextSymbol()&&(i(),d());break;case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":n.freq=ge.WEEKLY;var _=r.symbol.substr(0,2).toUpperCase();if(n.byweekday=[ge[_]],!r.nextSymbol())return;for(;r.accept("comma");){if(r.isDone())throw new Error("Unexpected end");var p=a();if(!p)throw new Error("Unexpected symbol "+r.symbol+", expected weekday");n.byweekday.push(ge[p]),r.nextSymbol()}o(),f(),d();break;case"january":case"february":case"march":case"april":case"may":case"june":case"july":case"august":case"september":case"october":case"november":case"december":if(n.freq=ge.YEARLY,n.bymonth=[c()],!r.nextSymbol())return;for(;r.accept("comma");){if(r.isDone())throw new Error("Unexpected end");var h=c();if(!h)throw new Error("Unexpected symbol "+r.symbol+", expected month");n.bymonth.push(h),r.nextSymbol()}i(),d();break;default:throw new Error("Unknown symbol")}}function i(){var u=r.accept("on"),_=r.accept("the");if(u||_)do{var p=l(),h=a(),E=c();if(p)h?(r.nextSymbol(),n.byweekday||(n.byweekday=[]),n.byweekday.push(ge[h].nth(p))):(n.bymonthday||(n.bymonthday=[]),n.bymonthday.push(p),r.accept("day(s)"));else if(h)r.nextSymbol(),n.byweekday||(n.byweekday=[]),n.byweekday.push(ge[h]);else if(r.symbol==="weekday(s)")r.nextSymbol(),n.byweekday||(n.byweekday=[ge.MO,ge.TU,ge.WE,ge.TH,ge.FR]);else if(r.symbol==="week(s)"){r.nextSymbol();var T=r.acceptNumber();if(!T)throw new Error("Unexpected symbol "+r.symbol+", expected week number");for(n.byweekno=[parseInt(T[0],10)];r.accept("comma");){if(T=r.acceptNumber(),!T)throw new Error("Unexpected symbol "+r.symbol+"; expected monthday");n.byweekno.push(parseInt(T[0],10))}}else if(E)r.nextSymbol(),n.bymonth||(n.bymonth=[]),n.bymonth.push(E);else return}while(r.accept("comma")||r.accept("the")||r.accept("on"))}function o(){var u=r.accept("at");if(u)do{var _=r.acceptNumber();if(!_)throw new Error("Unexpected symbol "+r.symbol+", expected hour");for(n.byhour=[parseInt(_[0],10)];r.accept("comma");){if(_=r.acceptNumber(),!_)throw new Error("Unexpected symbol "+r.symbol+"; expected hour");n.byhour.push(parseInt(_[0],10))}}while(r.accept("comma")||r.accept("at"))}function c(){switch(r.symbol){case"january":return 1;case"february":return 2;case"march":return 3;case"april":return 4;case"may":return 5;case"june":return 6;case"july":return 7;case"august":return 8;case"september":return 9;case"october":return 10;case"november":return 11;case"december":return 12;default:return!1}}function a(){switch(r.symbol){case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":return r.symbol.substr(0,2).toUpperCase();default:return!1}}function l(){switch(r.symbol){case"last":return r.nextSymbol(),-1;case"first":return r.nextSymbol(),1;case"second":return r.nextSymbol(),r.accept("last")?-2:2;case"third":return r.nextSymbol(),r.accept("last")?-3:3;case"nth":var u=parseInt(r.value[1],10);if(u<-366||u>366)throw new Error("Nth out of range: "+u);return r.nextSymbol(),r.accept("last")?-u:u;default:return!1}}function f(){r.accept("on"),r.accept("the");var u=l();if(u)for(n.bymonthday=[u],r.nextSymbol();r.accept("comma");){if(u=l(),!u)throw new Error("Unexpected symbol "+r.symbol+"; expected monthday");n.bymonthday.push(u),r.nextSymbol()}}function d(){if(r.symbol==="until"){var u=Date.parse(r.text);if(!u)throw new Error("Cannot parse until date:"+r.text);n.until=new Date(u)}else r.accept("for")&&(n.count=parseInt(r.value[0],10),r.expect("number"))}}var Le;(function(e){e[e.YEARLY=0]="YEARLY",e[e.MONTHLY=1]="MONTHLY",e[e.WEEKLY=2]="WEEKLY",e[e.DAILY=3]="DAILY",e[e.HOURLY=4]="HOURLY",e[e.MINUTELY=5]="MINUTELY",e[e.SECONDLY=6]="SECONDLY"})(Le||(Le={}));function hS(e){return e<Le.HOURLY}var T7=function(e,t){return t===void 0&&(t=Yl),new ge(mU(e,t)||void 0)},io=["count","until","interval","byweekday","bymonthday","bymonth"];Ar.IMPLEMENTED=[];Ar.IMPLEMENTED[Le.HOURLY]=io;Ar.IMPLEMENTED[Le.MINUTELY]=io;Ar.IMPLEMENTED[Le.DAILY]=["byhour"].concat(io);Ar.IMPLEMENTED[Le.WEEKLY]=io;Ar.IMPLEMENTED[Le.MONTHLY]=io;Ar.IMPLEMENTED[Le.YEARLY]=["byweekno","byyearday"].concat(io);var S7=function(e,t,n,r){return new Ar(e,t,n,r).toString()},m7=Ar.isFullyConvertible,Wl=(function(){function e(t,n,r,s){this.hour=t,this.minute=n,this.second=r,this.millisecond=s||0}return e.prototype.getHours=function(){return this.hour},e.prototype.getMinutes=function(){return this.minute},e.prototype.getSeconds=function(){return this.second},e.prototype.getMilliseconds=function(){return this.millisecond},e.prototype.getTime=function(){return(this.hour*60*60+this.minute*60+this.second)*1e3+this.millisecond},e})(),g7=(function(e){pS(t,e);function t(n,r,s,i,o,c,a){var l=e.call(this,i,o,c,a)||this;return l.year=n,l.month=r,l.day=s,l}return t.fromDate=function(n){return new this(n.getUTCFullYear(),n.getUTCMonth()+1,n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),n.valueOf()%1e3)},t.prototype.getWeekday=function(){return Yi(new Date(this.getTime()))},t.prototype.getTime=function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond)).getTime()},t.prototype.getDay=function(){return this.day},t.prototype.getMonth=function(){return this.month},t.prototype.getYear=function(){return this.year},t.prototype.addYears=function(n){this.year+=n},t.prototype.addMonths=function(n){if(this.month+=n,this.month>12){var r=Math.floor(this.month/12),s=en(this.month,12);this.month=s,this.year+=r,this.month===0&&(this.month=12,--this.year)}},t.prototype.addWeekly=function(n,r){r>this.getWeekday()?this.day+=-(this.getWeekday()+1+(6-r))+n*7:this.day+=-(this.getWeekday()-r)+n*7,this.fixDay()},t.prototype.addDaily=function(n){this.day+=n,this.fixDay()},t.prototype.addHours=function(n,r,s){for(r&&(this.hour+=Math.floor((23-this.hour)/n)*n);;){this.hour+=n;var i=hh(this.hour,24),o=i.div,c=i.mod;if(o&&(this.hour=c,this.addDaily(o)),Hn(s)||Ve(s,this.hour))break}},t.prototype.addMinutes=function(n,r,s,i){for(r&&(this.minute+=Math.floor((1439-(this.hour*60+this.minute))/n)*n);;){this.minute+=n;var o=hh(this.minute,60),c=o.div,a=o.mod;if(c&&(this.minute=a,this.addHours(c,!1,s)),(Hn(s)||Ve(s,this.hour))&&(Hn(i)||Ve(i,this.minute)))break}},t.prototype.addSeconds=function(n,r,s,i,o){for(r&&(this.second+=Math.floor((86399-(this.hour*3600+this.minute*60+this.second))/n)*n);;){this.second+=n;var c=hh(this.second,60),a=c.div,l=c.mod;if(a&&(this.second=l,this.addMinutes(a,!1,s,i)),(Hn(s)||Ve(s,this.hour))&&(Hn(i)||Ve(i,this.minute))&&(Hn(o)||Ve(o,this.second)))break}},t.prototype.fixDay=function(){if(!(this.day<=28)){var n=bv(this.year,this.month-1)[1];if(!(this.day<=n))for(;this.day>n;){if(this.day-=n,++this.month,this.month===13&&(this.month=1,++this.year,this.year>pU))return;n=bv(this.year,this.month-1)[1]}}},t.prototype.add=function(n,r){var s=n.freq,i=n.interval,o=n.wkst,c=n.byhour,a=n.byminute,l=n.bysecond;switch(s){case Le.YEARLY:return this.addYears(i);case Le.MONTHLY:return this.addMonths(i);case Le.WEEKLY:return this.addWeekly(i,o);case Le.DAILY:return this.addDaily(i);case Le.HOURLY:return this.addHours(i,r,c);case Le.MINUTELY:return this.addMinutes(i,r,c,a);case Le.SECONDLY:return this.addSeconds(i,r,c,a,l)}},t})(Wl);function gU(e){for(var t=[],n=Object.keys(e),r=0,s=n;r<s.length;r++){var i=s[r];Ve(Z7,i)||t.push(i),EU(e[i])&&!kc(e[i])&&t.push(i)}if(t.length)throw new Error("Invalid options: "+t.join(", "));return Pn({},e)}function A7(e){var t=Pn(Pn({},ES),gU(e));if(ot(t.byeaster)&&(t.freq=ge.YEARLY),!(ot(t.freq)&&ge.FREQUENCIES[t.freq]))throw new Error("Invalid frequency: ".concat(t.freq," ").concat(e.freq));if(t.dtstart||(t.dtstart=new Date(new Date().setMilliseconds(0))),ot(t.wkst)?Bn(t.wkst)||(t.wkst=t.wkst.weekday):t.wkst=ge.MO.weekday,ot(t.bysetpos)){Bn(t.bysetpos)&&(t.bysetpos=[t.bysetpos]);for(var n=0;n<t.bysetpos.length;n++){var r=t.bysetpos[n];if(r===0||!(r>=-366&&r<=366))throw new Error("bysetpos must be between 1 and 366, or between -366 and -1")}}if(!(t.byweekno||ft(t.byweekno)||ft(t.byyearday)||t.bymonthday||ft(t.bymonthday)||ot(t.byweekday)||ot(t.byeaster)))switch(t.freq){case ge.YEARLY:t.bymonth||(t.bymonth=t.dtstart.getUTCMonth()+1),t.bymonthday=t.dtstart.getUTCDate();break;case ge.MONTHLY:t.bymonthday=t.dtstart.getUTCDate();break;case ge.WEEKLY:t.byweekday=[Yi(t.dtstart)];break}if(ot(t.bymonth)&&!Wt(t.bymonth)&&(t.bymonth=[t.bymonth]),ot(t.byyearday)&&!Wt(t.byyearday)&&Bn(t.byyearday)&&(t.byyearday=[t.byyearday]),!ot(t.bymonthday))t.bymonthday=[],t.bynmonthday=[];else if(Wt(t.bymonthday)){for(var s=[],i=[],n=0;n<t.bymonthday.length;n++){var r=t.bymonthday[n];r>0?s.push(r):r<0&&i.push(r)}t.bymonthday=s,t.bynmonthday=i}else t.bymonthday<0?(t.bynmonthday=[t.bymonthday],t.bymonthday=[]):(t.bynmonthday=[],t.bymonthday=[t.bymonthday]);if(ot(t.byweekno)&&!Wt(t.byweekno)&&(t.byweekno=[t.byweekno]),!ot(t.byweekday))t.bynweekday=null;else if(Bn(t.byweekday))t.byweekday=[t.byweekday],t.bynweekday=null;else if(Ov(t.byweekday))t.byweekday=[Pt.fromStr(t.byweekday).weekday],t.bynweekday=null;else if(t.byweekday instanceof Pt)!t.byweekday.n||t.freq>ge.MONTHLY?(t.byweekday=[t.byweekday.weekday],t.bynweekday=null):(t.bynweekday=[[t.byweekday.weekday,t.byweekday.n]],t.byweekday=null);else{for(var o=[],c=[],n=0;n<t.byweekday.length;n++){var a=t.byweekday[n];if(Bn(a)){o.push(a);continue}else if(Ov(a)){o.push(Pt.fromStr(a).weekday);continue}!a.n||t.freq>ge.MONTHLY?o.push(a.weekday):c.push([a.weekday,a.n])}t.byweekday=ft(o)?o:null,t.bynweekday=ft(c)?c:null}return ot(t.byhour)?Bn(t.byhour)&&(t.byhour=[t.byhour]):t.byhour=t.freq<ge.HOURLY?[t.dtstart.getUTCHours()]:null,ot(t.byminute)?Bn(t.byminute)&&(t.byminute=[t.byminute]):t.byminute=t.freq<ge.MINUTELY?[t.dtstart.getUTCMinutes()]:null,ot(t.bysecond)?Bn(t.bysecond)&&(t.bysecond=[t.bysecond]):t.bysecond=t.freq<ge.SECONDLY?[t.dtstart.getUTCSeconds()]:null,{parsedOptions:t}}function R7(e){var t=e.dtstart.getTime()%1e3;if(!hS(e.freq))return[];var n=[];return e.byhour.forEach(function(r){e.byminute.forEach(function(s){e.bysecond.forEach(function(i){n.push(new Wl(r,s,i,t))})})}),n}function ME(e){var t=e.split(`
`).map(y7).filter(function(n){return n!==null});return Pn(Pn({},t[0]),t[1])}function Kl(e){var t={},n=/DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\s]+)/i.exec(e);if(!n)return t;var r=n[1],s=n[2];return r&&(t.tzid=r),t.dtstart=_S(s),t}function y7(e){if(e=e.replace(/^\s+|\s+$/,""),!e.length)return null;var t=/^([A-Z]+?)[:;]/.exec(e.toUpperCase());if(!t)return wv(e);var n=t[1];switch(n.toUpperCase()){case"RRULE":case"EXRULE":return wv(e);case"DTSTART":return Kl(e);default:throw new Error("Unsupported RFC prop ".concat(n," in ").concat(e))}}function wv(e){var t=e.replace(/^RRULE:/i,""),n=Kl(t),r=e.replace(/^(?:RRULE|EXRULE):/i,"").split(";");return r.forEach(function(s){var i=s.split("="),o=i[0],c=i[1];switch(o.toUpperCase()){case"FREQ":n.freq=Le[c.toUpperCase()];break;case"WKST":n.wkst=In[c.toUpperCase()];break;case"COUNT":case"INTERVAL":case"BYSETPOS":case"BYMONTH":case"BYMONTHDAY":case"BYYEARDAY":case"BYWEEKNO":case"BYHOUR":case"BYMINUTE":case"BYSECOND":var a=N7(c),l=o.toLowerCase();n[l]=a;break;case"BYWEEKDAY":case"BYDAY":n.byweekday=O7(c);break;case"DTSTART":case"TZID":var f=Kl(e);n.tzid=f.tzid,n.dtstart=f.dtstart;break;case"UNTIL":n.until=_S(c);break;case"BYEASTER":n.byeaster=Number(c);break;default:throw new Error("Unknown RRULE property '"+o+"'")}}),n}function N7(e){if(e.indexOf(",")!==-1){var t=e.split(",");return t.map(Lv)}return Lv(e)}function Lv(e){return/^[+-]?\d+$/.test(e)?Number(e):e}function O7(e){var t=e.split(",");return t.map(function(n){if(n.length===2)return In[n];var r=n.match(/^([+-]?\d{1,2})([A-Z]{2})$/);if(!r||r.length<3)throw new SyntaxError("Invalid weekday string: ".concat(n));var s=Number(r[1]),i=r[2],o=In[i].weekday;return new Pt(o,s)})}var zl=(function(){function e(t,n){if(isNaN(t.getTime()))throw new RangeError("Invalid date passed to DateWithZone");this.date=t,this.tzid=n}return Object.defineProperty(e.prototype,"isUTC",{get:function(){return!this.tzid||this.tzid.toUpperCase()==="UTC"},enumerable:!1,configurable:!0}),e.prototype.toString=function(){var t=fS(this.date.getTime(),this.isUTC);return this.isUTC?":".concat(t):";TZID=".concat(this.tzid,":").concat(t)},e.prototype.getTime=function(){return this.date.getTime()},e.prototype.rezonedDate=function(){return this.isUTC?this.date:l7(this.date,this.tzid)},e})();function wE(e){for(var t=[],n="",r=Object.keys(e),s=Object.keys(ES),i=0;i<r.length;i++)if(r[i]!=="tzid"&&Ve(s,r[i])){var o=r[i].toUpperCase(),c=e[r[i]],a="";if(!(!ot(c)||Wt(c)&&!c.length)){switch(o){case"FREQ":a=ge.FREQUENCIES[e.freq];break;case"WKST":Bn(c)?a=new Pt(c).toString():a=c.toString();break;case"BYWEEKDAY":o="BYDAY",a=s7(c).map(function(_){return _ instanceof Pt?_:Wt(_)?new Pt(_[0],_[1]):new Pt(_)}).toString();break;case"DTSTART":n=b7(c,e.tzid);break;case"UNTIL":a=fS(c,!e.tzid);break;default:if(Wt(c)){for(var l=[],f=0;f<c.length;f++)l[f]=String(c[f]);a=l.toString()}else a=String(c)}a&&t.push([o,a])}}var d=t.map(function(_){var p=_[0],h=_[1];return"".concat(p,"=").concat(h.toString())}).join(";"),u="";return d!==""&&(u="RRULE:".concat(d)),[n,u].filter(function(_){return!!_}).join(`
`)}function b7(e,t){return e?"DTSTART"+new zl(new Date(e),t).toString():""}function I7(e,t){return Array.isArray(e)?!Array.isArray(t)||e.length!==t.length?!1:e.every(function(n,r){return n.getTime()===t[r].getTime()}):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():e===t}var C7=(function(){function e(){this.all=!1,this.before=[],this.after=[],this.between=[]}return e.prototype._cacheAdd=function(t,n,r){n&&(n=n instanceof Date?PE(n):Iv(n)),t==="all"?this.all=n:(r._value=n,this[t].push(r))},e.prototype._cacheGet=function(t,n){var r=!1,s=n?Object.keys(n):[],i=function(f){for(var d=0;d<s.length;d++){var u=s[d];if(!I7(n[u],f[u]))return!0}return!1},o=this[t];if(t==="all")r=this.all;else if(Wt(o))for(var c=0;c<o.length;c++){var a=o[c];if(!(s.length&&i(a))){r=a._value;break}}if(!r&&this.all){for(var l=new bi(t,n),c=0;c<this.all.length&&l.accept(this.all[c]);c++);r=l.getValue(),this._cacheAdd(t,r,n)}return Wt(r)?Iv(r):r instanceof Date?PE(r):r},e})(),v7=oe(oe(oe(oe(oe(oe(oe(oe(oe(oe(oe(oe(oe([],we(1,31),!0),we(2,28),!0),we(3,31),!0),we(4,30),!0),we(5,31),!0),we(6,30),!0),we(7,31),!0),we(8,31),!0),we(9,30),!0),we(10,31),!0),we(11,30),!0),we(12,31),!0),we(1,7),!0),P7=oe(oe(oe(oe(oe(oe(oe(oe(oe(oe(oe(oe(oe([],we(1,31),!0),we(2,29),!0),we(3,31),!0),we(4,30),!0),we(5,31),!0),we(6,30),!0),we(7,31),!0),we(8,31),!0),we(9,30),!0),we(10,31),!0),we(11,30),!0),we(12,31),!0),we(1,7),!0),M7=Zn(1,29),w7=Zn(1,30),kr=Zn(1,31),Et=Zn(1,32),L7=oe(oe(oe(oe(oe(oe(oe(oe(oe(oe(oe(oe(oe([],Et,!0),w7,!0),Et,!0),kr,!0),Et,!0),kr,!0),Et,!0),Et,!0),kr,!0),Et,!0),kr,!0),Et,!0),Et.slice(0,7),!0),D7=oe(oe(oe(oe(oe(oe(oe(oe(oe(oe(oe(oe(oe([],Et,!0),M7,!0),Et,!0),kr,!0),Et,!0),kr,!0),Et,!0),Et,!0),kr,!0),Et,!0),kr,!0),Et,!0),Et.slice(0,7),!0),U7=Zn(-28,0),k7=Zn(-29,0),xr=Zn(-30,0),Tt=Zn(-31,0),x7=oe(oe(oe(oe(oe(oe(oe(oe(oe(oe(oe(oe(oe([],Tt,!0),k7,!0),Tt,!0),xr,!0),Tt,!0),xr,!0),Tt,!0),Tt,!0),xr,!0),Tt,!0),xr,!0),Tt,!0),Tt.slice(0,7),!0),B7=oe(oe(oe(oe(oe(oe(oe(oe(oe(oe(oe(oe(oe([],Tt,!0),U7,!0),Tt,!0),xr,!0),Tt,!0),xr,!0),Tt,!0),Tt,!0),xr,!0),Tt,!0),xr,!0),Tt,!0),Tt.slice(0,7),!0),G7=[0,31,60,91,121,152,182,213,244,274,305,335,366],V7=[0,31,59,90,120,151,181,212,243,273,304,334,365],Dv=(function(){for(var e=[],t=0;t<55;t++)e=e.concat(Zn(7));return e})();function $7(e,t){var n=ni(e,1,1),r=$c(e)?366:365,s=$c(e+1)?366:365,i=vE(n),o=Yi(n),c=Pn(Pn({yearlen:r,nextyearlen:s,yearordinal:i,yearweekday:o},H7(e)),{wnomask:null});if(Hn(t.byweekno))return c;c.wnomask=we(0,r+7);var a,l,f=a=en(7-o+t.wkst,7);f>=4?(f=0,l=c.yearlen+en(o-t.wkst,7)):l=r-f;for(var d=Math.floor(l/7),u=en(l,7),_=Math.floor(d+u/4),p=0;p<t.byweekno.length;p++){var h=t.byweekno[p];if(h<0&&(h+=_+1),h>0&&h<=_){var E=void 0;h>1?(E=f+(h-1)*7,f!==a&&(E-=7-a)):E=f;for(var T=0;T<7&&(c.wnomask[E]=1,E++,c.wdaymask[E]!==t.wkst);T++);}}if(Ve(t.byweekno,1)){var E=f+_*7;if(f!==a&&(E-=7-a),E<r)for(var p=0;p<7&&(c.wnomask[E]=1,E+=1,c.wdaymask[E]!==t.wkst);p++);}if(f){var S=void 0;if(Ve(t.byweekno,-1))S=-1;else{var m=Yi(ni(e-1,1,1)),g=en(7-m.valueOf()+t.wkst,7),y=$c(e-1)?366:365,A=void 0;g>=4?(g=0,A=y+en(m-t.wkst,7)):A=r-f,S=Math.floor(52+en(A,7)/4)}if(Ve(t.byweekno,S))for(var E=0;E<f;E++)c.wnomask[E]=1}return c}function H7(e){var t=$c(e)?366:365,n=ni(e,1,1),r=Yi(n);return t===365?{mmask:v7,mdaymask:D7,nmdaymask:B7,wdaymask:Dv.slice(r),mrange:V7}:{mmask:P7,mdaymask:L7,nmdaymask:x7,wdaymask:Dv.slice(r),mrange:G7}}function F7(e,t,n,r,s,i){var o={lastyear:e,lastmonth:t,nwdaymask:[]},c=[];if(i.freq===ge.YEARLY)if(Hn(i.bymonth))c=[[0,n]];else for(var a=0;a<i.bymonth.length;a++)t=i.bymonth[a],c.push(r.slice(t-1,t+1));else i.freq===ge.MONTHLY&&(c=[r.slice(t-1,t+1)]);if(Hn(c))return o;o.nwdaymask=we(0,n);for(var a=0;a<c.length;a++)for(var l=c[a],f=l[0],d=l[1]-1,u=0;u<i.bynweekday.length;u++){var _=void 0,p=i.bynweekday[u],h=p[0],E=p[1];E<0?(_=d+(E+1)*7,_-=en(s[_]-h,7)):(_=f+(E-1)*7,_+=en(7-s[_]+h,7)),f<=_&&_<=d&&(o.nwdaymask[_]=1)}return o}function j7(e,t){t===void 0&&(t=0);var n=e%19,r=Math.floor(e/100),s=e%100,i=Math.floor(r/4),o=r%4,c=Math.floor((r+8)/25),a=Math.floor((r-c+1)/3),l=Math.floor(19*n+r-i-a+15)%30,f=Math.floor(s/4),d=s%4,u=Math.floor(32+2*o+2*f-l-d)%7,_=Math.floor((n+11*l+22*u)/451),p=Math.floor((l+u-7*_+114)/31),h=(l+u-7*_+114)%31+1,E=Date.UTC(e,p-1,h+t),T=Date.UTC(e,0,1);return[Math.ceil((E-T)/(1e3*60*60*24))]}var q7=(function(){function e(t){this.options=t}return e.prototype.rebuild=function(t,n){var r=this.options;if(t!==this.lastyear&&(this.yearinfo=$7(t,r)),ft(r.bynweekday)&&(n!==this.lastmonth||t!==this.lastyear)){var s=this.yearinfo,i=s.yearlen,o=s.mrange,c=s.wdaymask;this.monthinfo=F7(t,n,i,o,c,r)}ot(r.byeaster)&&(this.eastermask=j7(t,r.byeaster))},Object.defineProperty(e.prototype,"lastyear",{get:function(){return this.monthinfo?this.monthinfo.lastyear:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastmonth",{get:function(){return this.monthinfo?this.monthinfo.lastmonth:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yearlen",{get:function(){return this.yearinfo.yearlen},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yearordinal",{get:function(){return this.yearinfo.yearordinal},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mrange",{get:function(){return this.yearinfo.mrange},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wdaymask",{get:function(){return this.yearinfo.wdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mmask",{get:function(){return this.yearinfo.mmask},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wnomask",{get:function(){return this.yearinfo.wnomask},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nwdaymask",{get:function(){return this.monthinfo?this.monthinfo.nwdaymask:[]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextyearlen",{get:function(){return this.yearinfo.nextyearlen},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mdaymask",{get:function(){return this.yearinfo.mdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nmdaymask",{get:function(){return this.yearinfo.nmdaymask},enumerable:!1,configurable:!0}),e.prototype.ydayset=function(){return[Zn(this.yearlen),0,this.yearlen]},e.prototype.mdayset=function(t,n){for(var r=this.mrange[n-1],s=this.mrange[n],i=we(null,this.yearlen),o=r;o<s;o++)i[o]=o;return[i,r,s]},e.prototype.wdayset=function(t,n,r){for(var s=we(null,this.yearlen+7),i=vE(ni(t,n,r))-this.yearordinal,o=i,c=0;c<7&&(s[i]=i,++i,this.wdaymask[i]!==this.options.wkst);c++);return[s,o,i]},e.prototype.ddayset=function(t,n,r){var s=we(null,this.yearlen),i=vE(ni(t,n,r))-this.yearordinal;return s[i]=i,[s,i,i+1]},e.prototype.htimeset=function(t,n,r,s){var i=this,o=[];return this.options.byminute.forEach(function(c){o=o.concat(i.mtimeset(t,c,r,s))}),ru(o),o},e.prototype.mtimeset=function(t,n,r,s){var i=this.options.bysecond.map(function(o){return new Wl(t,n,o,s)});return ru(i),i},e.prototype.stimeset=function(t,n,r,s){return[new Wl(t,n,r,s)]},e.prototype.getdayset=function(t){switch(t){case Le.YEARLY:return this.ydayset.bind(this);case Le.MONTHLY:return this.mdayset.bind(this);case Le.WEEKLY:return this.wdayset.bind(this);case Le.DAILY:return this.ddayset.bind(this);default:return this.ddayset.bind(this)}},e.prototype.gettimeset=function(t){switch(t){case Le.HOURLY:return this.htimeset.bind(this);case Le.MINUTELY:return this.mtimeset.bind(this);case Le.SECONDLY:return this.stimeset.bind(this)}},e})();function Y7(e,t,n,r,s,i){for(var o=[],c=0;c<e.length;c++){var a=void 0,l=void 0,f=e[c];f<0?(a=Math.floor(f/t.length),l=en(f,t.length)):(a=Math.floor((f-1)/t.length),l=en(f-1,t.length));for(var d=[],u=n;u<r;u++){var _=i[u];ot(_)&&d.push(_)}var p=void 0;a<0?p=d.slice(a)[0]:p=d[a];var h=t[l],E=TU(s.yearordinal+p),T=SU(E,h);Ve(o,T)||o.push(T)}return ru(o),o}function AU(e,t){var n=t.dtstart,r=t.freq,s=t.interval,i=t.until,o=t.bysetpos,c=t.count;if(c===0||s===0)return ar(e);var a=g7.fromDate(n),l=new q7(t);l.rebuild(a.year,a.month);for(var f=z7(l,a,t);;){var d=l.getdayset(r)(a.year,a.month,a.day),u=d[0],_=d[1],p=d[2],h=K7(u,_,p,l,t);if(ft(o))for(var E=Y7(o,f,_,p,l,u),T=0;T<E.length;T++){var S=E[T];if(i&&S>i)return ar(e);if(S>=n){var m=Uv(S,t);if(!e.accept(m)||c&&(--c,!c))return ar(e)}}else for(var T=_;T<p;T++){var g=u[T];if(ot(g))for(var y=TU(l.yearordinal+g),A=0;A<f.length;A++){var N=f[A],S=SU(y,N);if(i&&S>i)return ar(e);if(S>=n){var m=Uv(S,t);if(!e.accept(m)||c&&(--c,!c))return ar(e)}}}if(t.interval===0||(a.add(t,h),a.year>pU))return ar(e);hS(r)||(f=l.gettimeset(r)(a.hour,a.minute,a.second,0)),l.rebuild(a.year,a.month)}}function W7(e,t,n){var r=n.bymonth,s=n.byweekno,i=n.byweekday,o=n.byeaster,c=n.bymonthday,a=n.bynmonthday,l=n.byyearday;return ft(r)&&!Ve(r,e.mmask[t])||ft(s)&&!e.wnomask[t]||ft(i)&&!Ve(i,e.wdaymask[t])||ft(e.nwdaymask)&&!e.nwdaymask[t]||o!==null&&!Ve(e.eastermask,t)||(ft(c)||ft(a))&&!Ve(c,e.mdaymask[t])&&!Ve(a,e.nmdaymask[t])||ft(l)&&(t<e.yearlen&&!Ve(l,t+1)&&!Ve(l,-e.yearlen+t)||t>=e.yearlen&&!Ve(l,t+1-e.yearlen)&&!Ve(l,-e.nextyearlen+t-e.yearlen))}function Uv(e,t){return new zl(e,t.tzid).rezonedDate()}function ar(e){return e.getValue()}function K7(e,t,n,r,s){for(var i=!1,o=t;o<n;o++){var c=e[o];i=W7(r,c,s),i&&(e[c]=null)}return i}function z7(e,t,n){var r=n.freq,s=n.byhour,i=n.byminute,o=n.bysecond;return hS(r)?R7(n):r>=ge.HOURLY&&ft(s)&&!Ve(s,t.hour)||r>=ge.MINUTELY&&ft(i)&&!Ve(i,t.minute)||r>=ge.SECONDLY&&ft(o)&&!Ve(o,t.second)?[]:e.gettimeset(r)(t.hour,t.minute,t.second,t.millisecond)}var In={MO:new Pt(0),TU:new Pt(1),WE:new Pt(2),TH:new Pt(3),FR:new Pt(4),SA:new Pt(5),SU:new Pt(6)},ES={freq:Le.YEARLY,dtstart:null,interval:1,wkst:In.MO,count:null,until:null,tzid:null,bysetpos:null,bymonth:null,bymonthday:null,bynmonthday:null,byyearday:null,byweekno:null,byweekday:null,bynweekday:null,byhour:null,byminute:null,bysecond:null,byeaster:null},Z7=Object.keys(ES),ge=(function(){function e(t,n){t===void 0&&(t={}),n===void 0&&(n=!1),this._cache=n?null:new C7,this.origOptions=gU(t);var r=A7(t).parsedOptions;this.options=r}return e.parseText=function(t,n){return mU(t,n)},e.fromText=function(t,n){return T7(t,n)},e.fromString=function(t){return new e(e.parseString(t)||void 0)},e.prototype._iter=function(t){return AU(t,this.options)},e.prototype._cacheGet=function(t,n){return this._cache?this._cache._cacheGet(t,n):!1},e.prototype._cacheAdd=function(t,n,r){if(this._cache)return this._cache._cacheAdd(t,n,r)},e.prototype.all=function(t){if(t)return this._iter(new Pv("all",{},t));var n=this._cacheGet("all");return n===!1&&(n=this._iter(new bi("all",{})),this._cacheAdd("all",n)),n},e.prototype.between=function(t,n,r,s){if(r===void 0&&(r=!1),!kc(t)||!kc(n))throw new Error("Invalid date passed in to RRule.between");var i={before:n,after:t,inc:r};if(s)return this._iter(new Pv("between",i,s));var o=this._cacheGet("between",i);return o===!1&&(o=this._iter(new bi("between",i)),this._cacheAdd("between",o,i)),o},e.prototype.before=function(t,n){if(n===void 0&&(n=!1),!kc(t))throw new Error("Invalid date passed in to RRule.before");var r={dt:t,inc:n},s=this._cacheGet("before",r);return s===!1&&(s=this._iter(new bi("before",r)),this._cacheAdd("before",s,r)),s},e.prototype.after=function(t,n){if(n===void 0&&(n=!1),!kc(t))throw new Error("Invalid date passed in to RRule.after");var r={dt:t,inc:n},s=this._cacheGet("after",r);return s===!1&&(s=this._iter(new bi("after",r)),this._cacheAdd("after",s,r)),s},e.prototype.count=function(){return this.all().length},e.prototype.toString=function(){return wE(this.origOptions)},e.prototype.toText=function(t,n,r){return S7(this,t,n,r)},e.prototype.isFullyConvertibleToText=function(){return m7(this)},e.prototype.clone=function(){return new e(this.origOptions)},e.FREQUENCIES=["YEARLY","MONTHLY","WEEKLY","DAILY","HOURLY","MINUTELY","SECONDLY"],e.YEARLY=Le.YEARLY,e.MONTHLY=Le.MONTHLY,e.WEEKLY=Le.WEEKLY,e.DAILY=Le.DAILY,e.HOURLY=Le.HOURLY,e.MINUTELY=Le.MINUTELY,e.SECONDLY=Le.SECONDLY,e.MO=In.MO,e.TU=In.TU,e.WE=In.WE,e.TH=In.TH,e.FR=In.FR,e.SA=In.SA,e.SU=In.SU,e.parseString=ME,e.optionsToString=wE,e})();function X7(e,t,n,r,s,i){var o={},c=e.accept;function a(u,_){n.forEach(function(p){p.between(u,_,!0).forEach(function(h){o[Number(h)]=!0})})}s.forEach(function(u){var _=new zl(u,i).rezonedDate();o[Number(_)]=!0}),e.accept=function(u){var _=Number(u);return isNaN(_)?c.call(this,u):!o[_]&&(a(new Date(_-1),new Date(_+1)),!o[_])?(o[_]=!0,c.call(this,u)):!0},e.method==="between"&&(a(e.args.after,e.args.before),e.accept=function(u){var _=Number(u);return o[_]?!0:(o[_]=!0,c.call(this,u))});for(var l=0;l<r.length;l++){var f=new zl(r[l],i).rezonedDate();if(!e.accept(new Date(f.getTime())))break}t.forEach(function(u){AU(e,u.options)});var d=e._result;switch(ru(d),e.method){case"all":case"between":return d;case"before":return d.length&&d[d.length-1]||null;case"after":default:return d.length&&d[0]||null}}var kv={dtstart:null,cache:!1,unfold:!1,forceset:!1,compatible:!1,tzid:null};function Q7(e,t){var n=[],r=[],s=[],i=[],o=Kl(e),c=o.dtstart,a=o.tzid,l=ree(e,t.unfold);return l.forEach(function(f){var d;if(f){var u=nee(f),_=u.name,p=u.parms,h=u.value;switch(_.toUpperCase()){case"RRULE":if(p.length)throw new Error("unsupported RRULE parm: ".concat(p.join(",")));n.push(ME(f));break;case"RDATE":var E=(d=/RDATE(?:;TZID=([^:=]+))?/i.exec(f))!==null&&d!==void 0?d:[],T=E[1];T&&!a&&(a=T),r=r.concat(Bv(h,p));break;case"EXRULE":if(p.length)throw new Error("unsupported EXRULE parm: ".concat(p.join(",")));s.push(ME(h));break;case"EXDATE":i=i.concat(Bv(h,p));break;case"DTSTART":break;default:throw new Error("unsupported property: "+_)}}}),{dtstart:c,tzid:a,rrulevals:n,rdatevals:r,exrulevals:s,exdatevals:i}}function J7(e,t){var n=Q7(e,t),r=n.rrulevals,s=n.rdatevals,i=n.exrulevals,o=n.exdatevals,c=n.dtstart,a=n.tzid,l=t.cache===!1;if(t.compatible&&(t.forceset=!0,t.unfold=!0),t.forceset||r.length>1||s.length||i.length||o.length){var f=new iee(l);return f.dtstart(c),f.tzid(a||void 0),r.forEach(function(u){f.rrule(new ge(Th(u,c,a),l))}),s.forEach(function(u){f.rdate(u)}),i.forEach(function(u){f.exrule(new ge(Th(u,c,a),l))}),o.forEach(function(u){f.exdate(u)}),t.compatible&&t.dtstart&&f.rdate(c),f}var d=r[0]||{};return new ge(Th(d,d.dtstart||t.dtstart||c,d.tzid||t.tzid||a),l)}function xv(e,t){return t===void 0&&(t={}),J7(e,eee(t))}function Th(e,t,n){return Pn(Pn({},e),{dtstart:t,tzid:n})}function eee(e){var t=[],n=Object.keys(e),r=Object.keys(kv);if(n.forEach(function(s){Ve(r,s)||t.push(s)}),t.length)throw new Error("Invalid options: "+t.join(", "));return Pn(Pn({},kv),e)}function tee(e){if(e.indexOf(":")===-1)return{name:"RRULE",value:e};var t=i7(e,":",1),n=t[0],r=t[1];return{name:n,value:r}}function nee(e){var t=tee(e),n=t.name,r=t.value,s=n.split(";");if(!s)throw new Error("empty property name");return{name:s[0].toUpperCase(),parms:s.slice(1),value:r}}function ree(e,t){if(t===void 0&&(t=!1),e=e&&e.trim(),!e)throw new Error("Invalid empty string");if(!t)return e.split(/\s/);for(var n=e.split(`
`),r=0;r<n.length;){var s=n[r]=n[r].replace(/\s+$/g,"");s?r>0&&s[0]===" "?(n[r-1]+=s.slice(1),n.splice(r,1)):r+=1:n.splice(r,1)}return n}function see(e){e.forEach(function(t){if(!/(VALUE=DATE(-TIME)?)|(TZID=)/.test(t))throw new Error("unsupported RDATE/EXDATE parm: "+t)})}function Bv(e,t){return see(t),e.split(",").map(function(n){return _S(n)})}function Gv(e){var t=this;return function(n){if(n!==void 0&&(t["_".concat(e)]=n),t["_".concat(e)]!==void 0)return t["_".concat(e)];for(var r=0;r<t._rrule.length;r++){var s=t._rrule[r].origOptions[e];if(s)return s}}}var iee=(function(e){pS(t,e);function t(n){n===void 0&&(n=!1);var r=e.call(this,{},n)||this;return r.dtstart=Gv.apply(r,["dtstart"]),r.tzid=Gv.apply(r,["tzid"]),r._rrule=[],r._rdate=[],r._exrule=[],r._exdate=[],r}return t.prototype._iter=function(n){return X7(n,this._rrule,this._exrule,this._rdate,this._exdate,this.tzid())},t.prototype.rrule=function(n){Vv(n,this._rrule)},t.prototype.exrule=function(n){Vv(n,this._exrule)},t.prototype.rdate=function(n){$v(n,this._rdate)},t.prototype.exdate=function(n){$v(n,this._exdate)},t.prototype.rrules=function(){return this._rrule.map(function(n){return xv(n.toString())})},t.prototype.exrules=function(){return this._exrule.map(function(n){return xv(n.toString())})},t.prototype.rdates=function(){return this._rdate.map(function(n){return new Date(n.getTime())})},t.prototype.exdates=function(){return this._exdate.map(function(n){return new Date(n.getTime())})},t.prototype.valueOf=function(){var n=[];return!this._rrule.length&&this._dtstart&&(n=n.concat(wE({dtstart:this._dtstart}))),this._rrule.forEach(function(r){n=n.concat(r.toString().split(`
`))}),this._exrule.forEach(function(r){n=n.concat(r.toString().split(`
`).map(function(s){return s.replace(/^RRULE:/,"EXRULE:")}).filter(function(s){return!/^DTSTART/.test(s)}))}),this._rdate.length&&n.push(Hv("RDATE",this._rdate,this.tzid())),this._exdate.length&&n.push(Hv("EXDATE",this._exdate,this.tzid())),n},t.prototype.toString=function(){return this.valueOf().join(`
`)},t.prototype.clone=function(){var n=new t(!!this._cache);return this._rrule.forEach(function(r){return n.rrule(r.clone())}),this._exrule.forEach(function(r){return n.exrule(r.clone())}),this._rdate.forEach(function(r){return n.rdate(new Date(r.getTime()))}),this._exdate.forEach(function(r){return n.exdate(new Date(r.getTime()))}),n},t})(ge);function Vv(e,t){if(!(e instanceof ge))throw new TypeError(String(e)+" is not RRule instance");Ve(t.map(String),String(e))||t.push(e)}function $v(e,t){if(!(e instanceof Date))throw new TypeError(String(e)+" is not Date instance");Ve(t.map(Number),Number(e))||(t.push(e),ru(t))}function Hv(e,t,n){var r=!n||n.toUpperCase()==="UTC",s=r?"".concat(e,":"):"".concat(e,";TZID=").concat(n,":"),i=t.map(function(o){return fS(o.valueOf(),r)}).join(",");return"".concat(s).concat(i)}/*!
 * Copyright (c) Squirrel Chat et al., All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */function oee(e,t){let n=e.slice(0,t).split(/\r\n|\n|\r/g);return[n.length,n.pop().length+1]}function aee(e,t,n){let r=e.split(/\r\n|\n|\r/g),s="",i=(Math.log10(t+1)|0)+1;for(let o=t-1;o<=t+1;o++){let c=r[o-1];c&&(s+=o.toString().padEnd(i," "),s+=":  ",s+=c,s+=`
`,o===t&&(s+=" ".repeat(i+n+2),s+=`^
`))}return s}class Ie extends Error{line;column;codeblock;constructor(t,n){const[r,s]=oee(n.toml,n.ptr),i=aee(n.toml,r,s);super(`Invalid TOML document: ${t}

${i}`,n),this.line=r,this.column=s,this.codeblock=i}}/*!
 * Copyright (c) Squirrel Chat et al., All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */function cee(e,t){let n=0;for(;e[t-++n]==="\\";);return--n&&n%2}function Zl(e,t=0,n=e.length){let r=e.indexOf(`
`,t);return e[r-1]==="\r"&&r--,r<=n?r:-1}function TS(e,t){for(let n=t;n<e.length;n++){let r=e[n];if(r===`
`)return n;if(r==="\r"&&e[n+1]===`
`)return n+1;if(r<" "&&r!=="	"||r==="")throw new Ie("control characters are not allowed in comments",{toml:e,ptr:t})}return e.length}function pr(e,t,n,r){let s;for(;(s=e[t])===" "||s==="	"||!n&&(s===`
`||s==="\r"&&e[t+1]===`
`);)t++;return r||s!=="#"?t:pr(e,TS(e,t),n)}function Fv(e,t,n,r,s=!1){if(!r)return t=Zl(e,t),t<0?e.length:t;for(let i=t;i<e.length;i++){let o=e[i];if(o==="#")i=Zl(e,i);else{if(o===n)return i+1;if(o===r||s&&(o===`
`||o==="\r"&&e[i+1]===`
`))return i}}throw new Ie("cannot find end of structure",{toml:e,ptr:t})}function RU(e,t){let n=e[t],r=n===e[t+1]&&e[t+1]===e[t+2]?e.slice(t,t+3):n;t+=r.length-1;do t=e.indexOf(r,++t);while(t>-1&&n!=="'"&&cee(e,t));return t>-1&&(t+=r.length,r.length>1&&(e[t]===n&&t++,e[t]===n&&t++)),t}/*!
 * Copyright (c) Squirrel Chat et al., All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */let uee=/^(\d{4}-\d{2}-\d{2})?[T ]?(?:(\d{2}):\d{2}:\d{2}(?:\.\d+)?)?(Z|[-+]\d{2}:\d{2})?$/i;class Ii extends Date{#e=!1;#t=!1;#r=null;constructor(t){let n=!0,r=!0,s="Z";if(typeof t=="string"){let i=t.match(uee);i?(i[1]||(n=!1,t=`0000-01-01T${t}`),r=!!i[2],r&&t[10]===" "&&(t=t.replace(" ","T")),i[2]&&+i[2]>23?t="":(s=i[3]||null,t=t.toUpperCase(),!s&&r&&(t+="Z"))):t=""}super(t),isNaN(this.getTime())||(this.#e=n,this.#t=r,this.#r=s)}isDateTime(){return this.#e&&this.#t}isLocal(){return!this.#e||!this.#t||!this.#r}isDate(){return this.#e&&!this.#t}isTime(){return this.#t&&!this.#e}isValid(){return this.#e||this.#t}toISOString(){let t=super.toISOString();if(this.isDate())return t.slice(0,10);if(this.isTime())return t.slice(11,23);if(this.#r===null)return t.slice(0,-1);if(this.#r==="Z")return t;let n=+this.#r.slice(1,3)*60+ +this.#r.slice(4,6);return n=this.#r[0]==="-"?n:-n,new Date(this.getTime()-n*6e4).toISOString().slice(0,-1)+this.#r}static wrapAsOffsetDateTime(t,n="Z"){let r=new Ii(t);return r.#r=n,r}static wrapAsLocalDateTime(t){let n=new Ii(t);return n.#r=null,n}static wrapAsLocalDate(t){let n=new Ii(t);return n.#t=!1,n.#r=null,n}static wrapAsLocalTime(t){let n=new Ii(t);return n.#e=!1,n.#r=null,n}}/*!
 * Copyright (c) Squirrel Chat et al., All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */let lee=/^((0x[0-9a-fA-F](_?[0-9a-fA-F])*)|(([+-]|0[ob])?\d(_?\d)*))$/,dee=/^[+-]?\d(_?\d)*(\.\d(_?\d)*)?([eE][+-]?\d(_?\d)*)?$/,fee=/^[+-]?0[0-9_]/,_ee=/^[0-9a-f]{4,8}$/i,jv={b:"\b",t:"	",n:`
`,f:"\f",r:"\r",'"':'"',"\\":"\\"};function yU(e,t=0,n=e.length){let r=e[t]==="'",s=e[t++]===e[t]&&e[t]===e[t+1];s&&(n-=2,e[t+=2]==="\r"&&t++,e[t]===`
`&&t++);let i=0,o,c="",a=t;for(;t<n-1;){let l=e[t++];if(l===`
`||l==="\r"&&e[t]===`
`){if(!s)throw new Ie("newlines are not allowed in strings",{toml:e,ptr:t-1})}else if(l<" "&&l!=="	"||l==="")throw new Ie("control characters are not allowed in strings",{toml:e,ptr:t-1});if(o){if(o=!1,l==="u"||l==="U"){let f=e.slice(t,t+=l==="u"?4:8);if(!_ee.test(f))throw new Ie("invalid unicode escape",{toml:e,ptr:i});try{c+=String.fromCodePoint(parseInt(f,16))}catch{throw new Ie("invalid unicode escape",{toml:e,ptr:i})}}else if(s&&(l===`
`||l===" "||l==="	"||l==="\r")){if(t=pr(e,t-1,!0),e[t]!==`
`&&e[t]!=="\r")throw new Ie("invalid escape: only line-ending whitespace may be escaped",{toml:e,ptr:i});t=pr(e,t)}else if(l in jv)c+=jv[l];else throw new Ie("unrecognized escape sequence",{toml:e,ptr:i});a=t}else!r&&l==="\\"&&(i=t-1,o=!0,c+=e.slice(a,i))}return c+e.slice(a,n-1)}function pee(e,t,n,r){if(e==="true")return!0;if(e==="false")return!1;if(e==="-inf")return-1/0;if(e==="inf"||e==="+inf")return 1/0;if(e==="nan"||e==="+nan"||e==="-nan")return NaN;if(e==="-0")return r?0n:0;let s=lee.test(e);if(s||dee.test(e)){if(fee.test(e))throw new Ie("leading zeroes are not allowed",{toml:t,ptr:n});e=e.replace(/_/g,"");let o=+e;if(isNaN(o))throw new Ie("invalid number",{toml:t,ptr:n});if(s){if((s=!Number.isSafeInteger(o))&&!r)throw new Ie("integer value cannot be represented losslessly",{toml:t,ptr:n});(s||r===!0)&&(o=BigInt(e))}return o}const i=new Ii(e);if(!i.isValid())throw new Ie("invalid value",{toml:t,ptr:n});return i}/*!
 * Copyright (c) Squirrel Chat et al., All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */function hee(e,t,n,r){let s=e.slice(t,n),i=s.indexOf("#");i>-1&&(TS(e,i),s=s.slice(0,i));let o=s.trimEnd();if(!r){let c=s.indexOf(`
`,o.length);if(c>-1)throw new Ie("newlines are not allowed in inline tables",{toml:e,ptr:t+c})}return[o,i]}function SS(e,t,n,r,s){if(r===0)throw new Ie("document contains excessively nested structures. aborting.",{toml:e,ptr:t});let i=e[t];if(i==="["||i==="{"){let[a,l]=i==="["?See(e,t,r,s):Tee(e,t,r,s),f=n?Fv(e,l,",",n):l;if(l-f&&n==="}"){let d=Zl(e,l,f);if(d>-1)throw new Ie("newlines are not allowed in inline tables",{toml:e,ptr:d})}return[a,f]}let o;if(i==='"'||i==="'"){o=RU(e,t);let a=yU(e,t,o);if(n){if(o=pr(e,o,n!=="]"),e[o]&&e[o]!==","&&e[o]!==n&&e[o]!==`
`&&e[o]!=="\r")throw new Ie("unexpected character encountered",{toml:e,ptr:o});o+=+(e[o]===",")}return[a,o]}o=Fv(e,t,",",n);let c=hee(e,t,o-+(e[o-1]===","),n==="]");if(!c[0])throw new Ie("incomplete key-value declaration: no value specified",{toml:e,ptr:t});return n&&c[1]>-1&&(o=pr(e,t+c[1]),o+=+(e[o]===",")),[pee(c[0],e,t,s),o]}/*!
 * Copyright (c) Squirrel Chat et al., All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */let Eee=/^[a-zA-Z0-9-_]+[ \t]*$/;function LE(e,t,n="="){let r=t-1,s=[],i=e.indexOf(n,t);if(i<0)throw new Ie("incomplete key-value: cannot find end of key",{toml:e,ptr:t});do{let o=e[t=++r];if(o!==" "&&o!=="	")if(o==='"'||o==="'"){if(o===e[t+1]&&o===e[t+2])throw new Ie("multiline strings are not allowed in keys",{toml:e,ptr:t});let c=RU(e,t);if(c<0)throw new Ie("unfinished string encountered",{toml:e,ptr:t});r=e.indexOf(".",c);let a=e.slice(c,r<0||r>i?i:r),l=Zl(a);if(l>-1)throw new Ie("newlines are not allowed in keys",{toml:e,ptr:t+r+l});if(a.trimStart())throw new Ie("found extra tokens after the string part",{toml:e,ptr:c});if(i<c&&(i=e.indexOf(n,c),i<0))throw new Ie("incomplete key-value: cannot find end of key",{toml:e,ptr:t});s.push(yU(e,t,c))}else{r=e.indexOf(".",t);let c=e.slice(t,r<0||r>i?i:r);if(!Eee.test(c))throw new Ie("only letter, numbers, dashes and underscores are allowed in keys",{toml:e,ptr:t});s.push(c.trimEnd())}}while(r+1&&r<i);return[s,pr(e,i+1,!0,!0)]}function Tee(e,t,n,r){let s={},i=new Set,o,c=0;for(t++;(o=e[t++])!=="}"&&o;){let a={toml:e,ptr:t-1};if(o===`
`)throw new Ie("newlines are not allowed in inline tables",a);if(o==="#")throw new Ie("inline tables cannot contain comments",a);if(o===",")throw new Ie("expected key-value, found comma",a);if(o!==" "&&o!=="	"){let l,f=s,d=!1,[u,_]=LE(e,t-1);for(let E=0;E<u.length;E++){if(E&&(f=d?f[l]:f[l]={}),l=u[E],(d=Object.hasOwn(f,l))&&(typeof f[l]!="object"||i.has(f[l])))throw new Ie("trying to redefine an already defined value",{toml:e,ptr:t});!d&&l==="__proto__"&&Object.defineProperty(f,l,{enumerable:!0,configurable:!0,writable:!0})}if(d)throw new Ie("trying to redefine an already defined value",{toml:e,ptr:t});let[p,h]=SS(e,_,"}",n-1,r);i.add(p),f[l]=p,t=h,c=e[t-1]===","?t-1:0}}if(c)throw new Ie("trailing commas are not allowed in inline tables",{toml:e,ptr:c});if(!o)throw new Ie("unfinished table encountered",{toml:e,ptr:t});return[s,t]}function See(e,t,n,r){let s=[],i;for(t++;(i=e[t++])!=="]"&&i;){if(i===",")throw new Ie("expected value, found comma",{toml:e,ptr:t-1});if(i==="#")t=TS(e,t);else if(i!==" "&&i!=="	"&&i!==`
`&&i!=="\r"){let o=SS(e,t-1,"]",n-1,r);s.push(o[0]),t=o[1]}}if(!i)throw new Ie("unfinished array encountered",{toml:e,ptr:t});return[s,t]}/*!
 * Copyright (c) Squirrel Chat et al., All rights reserved.
 * SPDX-License-Identifier: BSD-3-Clause
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the copyright holder nor the names of its contributors
 *    may be used to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */function qv(e,t,n,r){let s=t,i=n,o,c=!1,a;for(let l=0;l<e.length;l++){if(l){if(s=c?s[o]:s[o]={},i=(a=i[o]).c,r===0&&(a.t===1||a.t===2))return null;if(a.t===2){let f=s.length-1;s=s[f],i=i[f].c}}if(o=e[l],(c=Object.hasOwn(s,o))&&i[o]?.t===0&&i[o]?.d)return null;c||(o==="__proto__"&&(Object.defineProperty(s,o,{enumerable:!0,configurable:!0,writable:!0}),Object.defineProperty(i,o,{enumerable:!0,configurable:!0,writable:!0})),i[o]={t:l<e.length-1&&r===2?3:r,d:!1,i:0,c:{}})}if(a=i[o],a.t!==r&&!(r===1&&a.t===3)||(r===2&&(a.d||(a.d=!0,s[o]=[]),s[o].push(s={}),a.c[a.i++]=a={t:1,d:!1,i:0,c:{}}),a.d))return null;if(a.d=!0,r===1)s=c?s[o]:s[o]={};else if(r===0&&c)return null;return[o,s,a.c]}function mee(e,{maxDepth:t=1e3,integersAsBigInt:n}={}){let r={},s={},i=r,o=s;for(let c=pr(e,0);c<e.length;){if(e[c]==="["){let a=e[++c]==="[",l=LE(e,c+=+a,"]");if(a){if(e[l[1]-1]!=="]")throw new Ie("expected end of table declaration",{toml:e,ptr:l[1]-1});l[1]++}let f=qv(l[0],r,s,a?2:1);if(!f)throw new Ie("trying to redefine an already defined table or value",{toml:e,ptr:c});o=f[2],i=f[1],c=l[1]}else{let a=LE(e,c),l=qv(a[0],i,o,0);if(!l)throw new Ie("trying to redefine an already defined table or value",{toml:e,ptr:c});let f=SS(e,a[1],void 0,t,n);l[1][l[0]]=f[0],c=f[1]}if(c=pr(e,c,!0),e[c]&&e[c]!==`
`&&e[c]!=="\r")throw new Ie("each key-value declaration must be followed by an end-of-line",{toml:e,ptr:c});c=pr(e,c)}return r}function gee(e,t,n,r){const s=nJ(t),i={message:s.message,status:Aee(e),source:n.source,service:n.source,env:n.env,date:Date.now(),logger:{name:s.loggerName??"app"},"codex.app_session_id":n.codexAppSessionId,usr:n.userInfo};return r!=null&&Object.assign(i,r),Ree(i,n.buildInfo),i}function Aee(e){switch(e){case"trace":case"debug":return"debug";case"info":return"info";case"warning":return"warn";case"error":return"error"}}function Ree(e,t){Sh(e,"build_number",t.buildNumber),Sh(e,"version",t.version),Sh(e,"app_version",t.version)}function Sh(e,t,n){n!=null&&(e[t]=n)}const yee=5e3,Nee=50,Oee=64e3;class bee{onFlush;flushIntervalMs;maxBatchSize;maxBatchBytes;buffer=[];bufferBytes=0;flushTimeout=null;constructor(t){this.onFlush=t.onFlush,this.flushIntervalMs=t.flushIntervalMs??yee,this.maxBatchSize=t.maxBatchSize??Nee,this.maxBatchBytes=t.maxBatchBytes??Oee}enqueue(t){if(this.buffer.push(t),this.bufferBytes+=t.length,this.buffer.length>=this.maxBatchSize||this.bufferBytes>=this.maxBatchBytes){this.flush();return}this.scheduleFlush()}flushNow(){this.flush()}scheduleFlush(){this.flushTimeout==null&&(this.flushTimeout=setTimeout(()=>{this.flush()},this.flushIntervalMs))}flush(){if(this.buffer.length===0){this.clearFlushTimeout();return}const t=this.buffer.splice(0,this.buffer.length);this.bufferBytes=0,this.clearFlushTimeout(),this.onFlush(t)}clearFlushTimeout(){this.flushTimeout!=null&&(clearTimeout(this.flushTimeout),this.flushTimeout=null)}}const Iee="https://chat.openai.com/ces/v1/telemetry/intake",Cee="dummy-token",vee="browser",Pee=2e3,Mee=3e4,wee=5;class Lee{options;reportFailure;batcher;queue=[];inFlightSend=null;retryTimeout=null;retryAttempts=0;disabled=!1;reportedDisabledReason=!1;fetchImpl;userInfo=null;constructor(t){this.options=t,this.reportFailure=t.reportFailure,this.fetchImpl=t.fetchImpl??fetch,this.batcher=new bee({onFlush:n=>this.enqueueBatch(n)})}setUserInfo(t){this.userInfo=t}log(t,n,r){const s=gee(t,n,{buildInfo:this.options.buildInfo,userInfo:this.userInfo,codexAppSessionId:this.options.codexAppSessionId,source:this.options.source,env:this.options.env},r);this.batcher.enqueue(JSON.stringify(s))}flushNow(){this.batcher.flushNow(),this.drainQueue()}enqueueBatch(t){this.disabled||t.length!==0&&(this.queue.push({requestId:xi.randomUUID(),events:t}),this.drainQueue())}async drainQueue(){if(this.disabled){this.queue.length=0;return}if(this.inFlightSend!=null||this.retryTimeout!=null)return;const t=this.queue[0];if(t==null)return;const n=t.events.join(`
`);this.inFlightSend=(async()=>{try{await this.send(n,t.requestId),this.queue.shift(),this.retryAttempts=0}catch{if(this.disabled){this.queue.length=0;return}this.scheduleRetry()}finally{this.inFlightSend=null,this.drainQueue()}})()}scheduleRetry(){if(this.retryTimeout!=null)return;if(this.retryAttempts>=wee){this.queue.shift(),this.retryAttempts=0,this.drainQueue();return}this.retryAttempts+=1;const t=Math.min(Mee,Pee*Math.pow(2,this.retryAttempts-1));this.retryTimeout=setTimeout(()=>{this.retryTimeout=null,this.drainQueue()},t)}disableWithFailure(t){this.disabled=!0,!this.reportedDisabledReason&&(this.reportedDisabledReason=!0,this.reportFailure(t))}async send(t,n){const r=Dee(n),s=await this.fetchImpl(r,{method:"POST",headers:{"content-type":"text/plain","x-request-id":n},body:Buffer.from(t)});if(!s.ok){const i=await s.text();if(s.status>=400&&s.status<500)return(s.status===401||s.status===403)&&this.disableWithFailure({type:"disabled",reason:"invalid_client_token",status:s.status,body:i}),s.status;throw new Error(`[datadog] non-2xx response (${s.status})`)}return s.status}}function Dee(e){const n=`/api/v2/logs?${new URLSearchParams({ddsource:"browser","dd-api-key":Cee,"dd-evp-origin":vee,"dd-request-id":e}).toString()}`;return`${Iee}?ddforward=${encodeURIComponent(n)}`}function mh(e,t){let n=null,r=null;const s=((...i)=>{r=i,n&&clearTimeout(n),n=setTimeout(()=>{n=null;const o=r;r=null,o&&e(...o)},t)});return s.cancel=()=>{n&&(clearTimeout(n),n=null),r=null},s}function Uee(e){const t=(n,r,s)=>{const i=typeof n=="string"?new Error(n):n;try{e(i,r,s)}catch{}};return{report:t,reportNonFatal:(n,r)=>t(n,"non-fatal",r),reportFatal:(n,r)=>t(n,"fatal",r)}}async function kee(e,t){let n;try{const s=await et.readFile(e,t);n=mee(s),n=xee(n)}catch(s){return{configPath:e,cwdRelativeToGitRoot:e,type:"error",error:new Error(`Failed to parse environment config at ${e}: ${String(s)}`)}}const r=kX.safeParse(n);return r.success?{configPath:e,cwdRelativeToGitRoot:await $ee(e,t),type:"success",environment:Gee(r.data)}:{configPath:e,cwdRelativeToGitRoot:e,type:"error",error:new Error(`Invalid environment config at ${e}: ${r.error.toString()}`)}}function xee(e){return!NU(e)||!Array.isArray(e.actions)?e:{...e,actions:e.actions.filter(t=>Bee(t))}}function Bee(e){return!NU(e)||typeof e.name!="string"||typeof e.command!="string"?!1:e.name.trim().length>0&&e.command.trim().length>0}function NU(e){return typeof e=="object"&&e!=null&&!Array.isArray(e)}function Gee(e){return{...e,name:e.name.trim(),setup:Vee(e.setup),actions:e.actions?e.actions.map(t=>({...t,name:t.name.trim(),command:t.command.trim()})):void 0}}function Vee(e){return{...e,script:e.script.trim(),darwin:e.darwin?{script:e.darwin.script.trim()}:void 0,linux:e.linux?{script:e.linux.script.trim()}:void 0,win32:e.win32?{script:e.win32.script.trim()}:void 0}}async function $ee(e,t){const n=kt(t),r=await Hee(e,t);let s=r;for(;s!==n.dirname(s)&&!await OU(s,t);)s=n.dirname(s);const i=n.relative(s,r);return i===""?".":i}async function OU(e,t){const n=kt(t);try{const r=await et.stat(n.join(e,".git"),t);return r.isDirectory()||r.isFile()}catch{return!1}}async function Hee(e,t){const n=kt(t);let r=n.dirname(e);for(;r!==n.dirname(r);){if(await Fee(r,t))return r;if(await OU(r,t))return r;r=n.dirname(r)}return e}async function Fee(e,t){const n=kt(t);try{const r=await et.stat(n.join(e,".codex"),t);return r.isDirectory()||r.isFile()}catch{return!1}}const Ti=At("git");async function ue(e,t,n,r={}){const{env:s,signal:i,timeoutMs:o,onStdoutRaw:c,onStderrRaw:a,maxOutputBytes:l,trim:f=!0,allowedNonZeroExitCodes:d}=r,u={LC_MESSAGES:"C",LANGUAGE:"C",GIT_TERMINAL_PROMPT:"0",GIT_OPTIONAL_LOCKS:"0",...s},_=jee(e,t,n),p=tJ(_),h=t[0],E=crypto.randomUUID().slice(0,8),T=Date.now(),S=xe(n),m={id:E,startTimeMs:T,isRemote:S,subcommand:h,allowedNonZeroExitCodes:d?.join(",")},g={command:p,commandArgs:_,cwd:e};let y=0,A=0;if(i&&i.aborted)return Ti().warning("git.command.complete",{safe:{requestId:E,subcommand:h,argsCount:t.length,isRemote:S,success:!1,failureReason:"abortedBeforeStart"},sensitive:{}}),{command:p,success:!1,code:null,stdout:"",stdoutBytes:y,stderr:"git process aborted",stderrBytes:A};let N=!1,O=!1,b,C=0;Ti().debug("git.command.start",{safe:m,sensitive:g});let w,k="",U="",M=null;const F=(H,te)=>{C+=te.length,H==="stdout"?y+=te.length:A+=te.length,l!=null&&C>l&&b==null&&(b={stream:H,limitBytes:l},w.kill()),H==="stdout"?c?.(te):a?.(te)};try{if(S){const H=Lt(p);w=await Wr({hostConfig:n,args:["bash","-lc",H],env:u,stdoutChunkHandler:te=>F("stdout",te),stderrChunkHandler:te=>F("stderr",te)})}else w=XD({args:_,cwd:e,env:{...process.env,...u},stdoutChunkHandler:H=>F("stdout",H),stderrChunkHandler:H=>F("stderr",H)})}catch(H){Ti().warning("git.command.complete",{safe:{...m,failureReason:"spawnFailed",durationMs:Date.now()-T},sensitive:g});const te=H instanceof Error?H.message:"Failed to start git process";return{command:p,success:!1,code:null,stdout:"",stdoutBytes:y,stderr:te,stderrBytes:A}}const v=()=>{O=!0,w.kill()};i&&(i.addEventListener("abort",v),i.aborted&&v());const L=o!=null?setTimeout(()=>{N=!0,w.kill()},o):null;try{const{stdout:H,stderr:te,code:ce}=await w.wait();if(k=f?H.trim():H,U=f?te.trim():te,M=ce,L&&clearTimeout(L),i&&i.removeEventListener("abort",v),O)return{command:p,success:!1,code:M,stdout:k,stdoutBytes:y,stderr:U?`${U}
git process aborted`:"git process aborted",stderrBytes:A,outputLimitExceeded:b,process:w};const ee=b==null&&M!=null&&(M===0||Array.isArray(d)&&d.includes(M));if(ee)Ti().debug("git.command.complete",{safe:{...m,success:!0,...M!=null?{exitCode:M}:{},durationMs:Date.now()-T,aborted:O,timedOut:N},sensitive:g});else{const x=b!=null?"output_limit_exceeded":N?"timed_out":O?"aborted":"command_failed";Ti().warning("git.command.complete",{safe:{...m,failureReason:x,...M!=null?{exitCode:M}:{},durationMs:Date.now()-T,aborted:O,timedOut:N,...b!=null?{outputLimitStream:b.stream,outputLimitMaxBytes:b.limitBytes}:{},...d!=null&&d.length>0?{allowedNonZeroExitCodes:d.join(",")}:{}},sensitive:g})}return{command:p,success:ee,code:M,stdout:k,stdoutBytes:y,stderr:N?`${U}git process timed out after ${o}ms`:U,stderrBytes:A,outputLimitExceeded:b,process:w}}catch(H){L&&clearTimeout(L),i&&i.removeEventListener("abort",v);const te=H instanceof Error?H.message:String(H);Ti().warning("git.command.complete",{safe:{...m,failureReason:"waitFailed",durationMs:Date.now()-T,aborted:O,timedOut:N},sensitive:g});const ce=w?.getStdout().toString("utf8")??k,ee=w?.getStderr().toString("utf8")??(te?`${U}${te}`:U);return{command:p,success:!1,code:M,stdout:ce,stdoutBytes:Buffer.byteLength(ce,"utf8"),stderr:ee,stderrBytes:Buffer.byteLength(ee,"utf8"),outputLimitExceeded:b,process:w}}}function jee(e,t,n){return xe(n)?["git","-C",e,...t]:["git",...t]}async function Yd(e,t=null){const n=kt(t),{success:r,stdout:s}=await ue(e,["rev-parse","--git-dir"],t,{allowedNonZeroExitCodes:[128]});return!r||!s?null:n.isAbsolute(s)?s:n.resolve(e,s)}async function mS(e,t,n=null){if(t)try{const r=kt(n).join(t,IU);if((await et.stat(r,n)).isFile())return!0}catch{}return xe(n)?!1:qee(e)}async function qee(e){try{const t=await et.stat(e,null);return t.birthtimeMs>0?t.birthtimeMs<Yee:!0}catch{return!1}}async function bU(e,t=null){try{const n=kt(t),r=await Yd(e,t);if(!r)return{success:!1,error:new Error("Failed to resolve worktree git directory")};const s=n.join(r,IU);return await et.writeFile(s,"",t),{success:!0}}catch(n){return{success:!1,error:n instanceof Error?n:new Error("Failed to mark worktree")}}}const IU="codex-managed",Yee=new Date("2026-01-29T00:00:00").getTime(),Ci=5*1024*1024,Yv=32*1024*1024,Wv=64*1024*1024,Hc="origin",Wee=["-c","diff.mnemonicPrefix=false","-c","diff.noprefix=false","-c","core.quotePath=false"],Kee=["diff","--no-ext-diff","--no-textconv","--color=never","--src-prefix=a/","--dst-prefix=b/"],zee=8;async function CU(e,t,n){if(!t.success)return{success:!1,error:{type:"unknown"}};const r=t.paths,s=[],i=Array.from({length:r.length},()=>{});let o=0,c=0,a=!1,l=null,f=0;const d=T=>{a||(a=!0,l=T)},u=T=>{T.trim().length===0||a||s.push(T)},_=()=>{if(!a)for(;c<i.length;){const T=i[c];if(T===void 0)return;if(c+=1,!(T==null||T.trim().length===0)&&(u(T),a))return}},p=()=>{if(a||o>=r.length)return null;const T=r[o],S=o;return o+=1,{index:S,path:T}},h=async()=>{if(a)return;const T=p();if(T==null)return;const S=await e(T.path,n);if(S.type==="error"){d(S.error);return}const m=f+(S.unifiedDiffBytes??S.unifiedDiff.length);if(m>Wv){d({type:"diff-too-large",limitBytes:Wv});return}f=m,i[T.index]=S.unifiedDiff.trim().length>0?S.unifiedDiff:null,_(),await h()},E=Math.min(zee,r.length);return await Promise.all(Array.from({length:E},()=>h())),l?{success:!1,error:l}:{success:!0,sections:s}}async function DE(e,t,n,{includePaths:r}={}){const s=await t.getWorktreeRepository(e,n);if(!s)return{type:"error",error:{type:"unknown"}};const i=await s.getUntrackedPaths(r),o=await CU(s.getUntrackedDiff,i);if(!o.success)return{type:"error",error:o.error};const c=o.sections.length>0?o.sections.map(a=>Zee(a)).join(`
`):"";return{type:"success",unifiedDiff:c,unifiedDiffBytes:Buffer.byteLength(c,"utf8")}}function Zee(e){return e.replace(/[\r\n]+$/,"")}async function Wd(e,t,n){const{success:r,stdout:s}=await ue(e,["rev-parse","--git-dir"],t,{signal:n});return!r||!s?null:he.isAbsolute(s)?s:he.join(e,s)}const Xee=At("git");async function gS(e,t,n){if(!xe(t)&&!me.existsSync(e))throw new Error(`ENOENT: path does not exist: ${e}`);const{success:r,stdout:s,stderr:i,code:o}=await ue(e,["rev-parse","--show-toplevel"],t,{allowedNonZeroExitCodes:[128],signal:n});if(r&&s)return s;if(o===128&&i.toLowerCase().includes("not a git repository"))return null;throw Xee().debug("[getGitRoot] failed to resolve git root",{safe:{stderr:i,stdout:s},sensitive:{}}),new Error(`Failed to resolve git root: ${i||s||"Unknown error"}`)}function mu(e){return e?.outputLimitExceeded?{type:"diff-too-large",limitBytes:e.outputLimitExceeded.limitBytes}:{type:"unknown"}}async function hr(e,t,n,r={}){const{binary:s=!1,maxOutputBytes:i,...o}=r,c=i==null?Yv:Math.min(i,Yv);return ue(e,[...Wee,...Kee,...s?["--binary"]:[],...t],n,{...o,maxOutputBytes:c})}const gh=At("git");function Kv(e){return{command:e.command,success:e.success,code:e.code,stdout:e.stdout,stderr:e.stderr,outputLimitExceeded:e.outputLimitExceeded}}async function vU(e,t,n){const r=await Wd(e,t,n);if(!r)return{type:"error",error:{type:"unknown"}};let s=null;try{s=await me.promises.mkdtemp(he.join(ri.tmpdir(),"codex-git-index"));const i=he.join(r,"index"),o=he.join(s,"index");await me.promises.copyFile(i,o).catch(f=>{if(f.code!=="ENOENT")throw f});const c={GIT_INDEX_FILE:o},a=await ue(e,["add","-u"],t,{env:c,signal:n});if(!a.success)return gh().warning("Failed to stage uncommitted diff",{safe:{},sensitive:{...Kv(a)}}),{type:"error",error:{type:"unknown"}};const l=await hr(e,["--cached"],t,{trim:!1,allowedNonZeroExitCodes:[0,1],env:c,signal:n});return l.outputLimitExceeded||!l.success?(gh().warning("Failed to collect uncommitted diff",{safe:{},sensitive:{...Kv(l)}}),{type:"error",error:mu(l)}):{type:"success",unifiedDiff:l.stdout,unifiedDiffBytes:l.stdoutBytes}}catch(i){return gh().error("failed to collect tracked uncommitted diff",{safe:{},sensitive:{error:i}}),{type:"error",error:{type:"unknown"}}}finally{s&&await me.promises.rm(s,{recursive:!0,force:!0})}}async function Qee(e,t,n,r){const s=await gS(e,n,r),[i,o]=await Promise.all([vU(e,n,r),s?DE(s,t,n):Promise.resolve({type:"error",error:{type:"unknown"}})]);if(i.type!=="success"||o.type!=="success")return{type:"error",error:{type:"unknown"}};const c=Jee([i.unifiedDiff,o.unifiedDiff]);return{type:"success",unifiedDiff:c,unifiedDiffBytes:Buffer.byteLength(c,"utf8")}}function Jee(e){const t=e.map(r=>ete(r)).filter(r=>r.length>0);if(t.length===0)return"";const n=t.join(`
`);return n.endsWith(`
`)?n:`${n}
`}function ete(e){return e.replace(/[\r\n]+$/,"")}async function Wn(e,t,n){const{success:r,stdout:s}=await ue(e,["rev-parse","--abbrev-ref","HEAD"],t,{signal:n});if(r&&s&&s!=="HEAD")return s;const i=await ue(e,["symbolic-ref","--quiet","--short","HEAD"],t,{signal:n});return i.success&&i.stdout?i.stdout:null}async function PU(e,t=Hc,n,r){const s=await ue(e,["symbolic-ref","--quiet",`refs/remotes/${t}/HEAD`],n,{signal:r});if(s.success&&s.stdout){const c=s.stdout.split("/");return c[c.length-1]??null}const i=await ue(e,["remote","show",t],n,{timeoutMs:1e4,signal:r});if(!i.success||!i.stdout)return null;const o=/HEAD branch:\s*(.+)/.exec(i.stdout);return o?o[1].trim():null}async function MU(e,t,n,r,s){const i=await ue(e,["rev-list","--left-right","--count",`${t}...${n}`],r,{allowedNonZeroExitCodes:[128,1],signal:s});if(!i.success||!i.stdout)return null;const o=tte(i.stdout);if(!o)return null;let c="equal";return o.leftAhead>0&&o.rightAhead>0?c="diverged":o.leftAhead>0?c="left-ahead":o.rightAhead>0&&(c="right-ahead"),{leftAhead:o.leftAhead,rightAhead:o.rightAhead,state:c}}function tte(e){const t=e.trim();if(!t)return null;const n=t.split(/\s+/);if(n.length<2)return null;const r=Number.parseInt(n[0]??"",10),s=Number.parseInt(n[1]??"",10);return!Number.isFinite(r)||!Number.isFinite(s)?null:{leftAhead:r,rightAhead:s}}async function nte(e,t,n,r){const s=await ue(e,["rev-parse","--abbrev-ref","--symbolic-full-name",`${t}@{u}`],n,{allowedNonZeroExitCodes:[128,1],signal:r});return s.success&&s.stdout?s.stdout:null}async function rte(e,t,n,r,s){const i=async f=>{const d=await nte(e,f,r,s);return d&&(await MU(e,f,d,r,s))?.state==="right-ahead"?d:f},o=async()=>t.type==="branch"?i(t.branchName):await Wn(e,r,s)??await PU(e,Hc,r,s)??"HEAD",c=async()=>{if(t.type!=="working-tree")return null;const f=await Qee(e,n,r,s);return f.type==="error"?null:f.unifiedDiff},[a,l]=await Promise.all([o(),c()]);return{startingRef:a,startingDiff:l}}function wU(e){return e?.id??"local"}function gu(e){return xi.createHash("sha1").update(e).digest("hex")}const Fc=At("git"),ste=3,zv=new Map;function ite(e){const t=wU(e),n=zv.get(t);if(n)return n;const r=new jD.Sema(ste);return zv.set(t,r),r}async function Fs(e,t,n=!1,r){const s=gu(e),i=ite(t);await i.acquire();try{Fc().info("[worktree-delete] start",{safe:{worktreeId:s,force:n,hasHostConfig:t!=null},sensitive:{}});const o=["worktree","remove"];n&&o.push("--force"),o.push(e);const c=await ue(e,o,t,{signal:r});Fc().info("[worktree-delete] git-remove-result",{safe:{worktreeId:s,force:n,success:c.success,code:c.code,outputLimitExceeded:c.outputLimitExceeded!=null},sensitive:{}}),(c.success||n)&&await ote(e,s,t)}finally{i.release()}}async function ote(e,t,n){const r=kt(n);let s=!1,i=!1;try{await et.rm(e,{recursive:!0,force:!0},n),s=!0}catch(o){Fc().warning("Failed to remove worktree directory",{safe:{},sensitive:{error:o}})}try{const o=r.dirname(e);if(o===e)return;(await et.readdir(o,n)).length===0&&(await et.rm(o,{recursive:!0,force:!0},n),i=!0)}catch(o){Fc().warning("Failed to remove worktree parent directory",{safe:{},sensitive:{error:o}})}Fc().debug("[worktree-delete] cleanup-finished",{safe:{worktreeId:t},sensitive:{removedWorktreeDir:s,removedParentDir:i}})}function ate(e,t){return[e,t].filter(r=>r.length>0).join(`
`)}function tn({command:e,stdout:t,stderr:n,fallbackOutput:r=t||n||"An unknown error occurred"}){const s=ate(t,n)||r;return{command:e,output:s}}async function LU(e,t,n,{preferWslPaths:r=!1,convertWindowsPathToWslPath:s=void 0}={}){const i=xe(n),o=i?he.posix.join(e,"index"):he.join(e,"index");if(i){const a=`cp ${Lt(t)} ${Lt(o)}`;await(await Wr({hostConfig:n,args:[`sh -lc ${Lt(a)}`]})).check()}else await me.promises.copyFile(t,o);let c=o;return r&&s&&(c=s(o)),c}async function Kd(e,t,n,r){const{success:s,stdout:i}=await ue(e,["rev-parse","--git-path",t],n,{signal:r});if(!s||!i)return null;if(he.isAbsolute(i))return i;if(i.startsWith(".git/"))return he.join(e,i);const o=await Wd(e,n,r);return o?he.join(o,i):null}async function AS(e,t){return Kd(e,"index",t)}function Xl(e){return e.split(/[/\\]+/).join("/")}function DU(e,t,n){const r=cte(t,n),s=ute(e,r);return s?Xl(s):n}function cte(e,t){return he.isAbsolute(t)?t:he.resolve(e,t)}function ute(e,t){const n=he.relative(e,t);return n===""||n.startsWith("..")||he.isAbsolute(n)?null:n}function lte(e,t){const n=new Set,r=new Set,s=new Set;let i=null;const o=[e,t].filter(Boolean).join(`
`),c=(F,v)=>{const L=(v??"").trim();if(!L)return;const H=L.charAt(0),te=L.charAt(L.length-1);let ce=L;(H==="'"||H==='"')&&te===H&&L.length>=2&&(ce=L.slice(1,-1)),ce&&F.add(ce)},a=(F,v)=>{for(const L of v)if(F[L])return F[L]},l=/^(?:Applied patch(?: to)?\s+(?:(["'])(?<qpath>.+?)\1|(?<path>.+?))\s+cleanly\.?)$/i,f=/^(?:Applied patch(?: to)?\s+(?:(["'])(?<qpath>.+?)\1|(?<path>.+?))\s+with conflicts\.?)$/i,d=/^(?:Applying patch\s+(?:(["'])(?<qpath>.+?)\1|(?<path>.+?))\s+with\s+\d+\s+rejects?\.{0,3})$/i,u=/^(?:Checking patch\s+(?:(["'])(?<qpath>.+?)\1|(?<path>.+?))\.\.\.)$/i,_=/^(?:Performing three-way merge|Falling back to three-way merge)\.\.\.$/i,p=/^Failed to perform three-way merge\.\.\.$/i,h=/^Falling back to direct application\.\.\.$/i,E=/^U\s+(?<path>.+)$/,T=/^error:\s+patch failed:\s+(?<path>.+?)(?::\d+)?(?:\s|$)/i,S=/^error:\s+(?<path>.+?):\s+patch does not apply$/i,m=/^(?:error: )?repository lacks the necessary blob to (?:perform|fall back on) 3-?way merge\.?$/i,g=/^error:\s+(?<path>.+?):\s+does not match index\b/i,y=/^error:\s+(?<path>.+?):\s+does not exist in index\b/i,A=/^error:\s+(?<path>.+?)\s+already exists in (?:the )?working directory\b/i,N=/^error:\s+patch failed:\s+(?<path>.+?)\s+File exists/i,O=/^error:\s+path\s+(?<path>.+?)\s+has been renamed\/deleted/i,b=/^error:\s+cannot apply binary patch to\s+['"]?(?<path>.+?)['"]?\s+without full index line$/i,C=/^error:\s+binary patch does not apply to\s+['"]?(?<path>.+?)['"]?$/i,w=/^error:\s+binary patch to\s+['"]?(?<path>.+?)['"]?\s+creates incorrect result\b/i,k=/^error:\s+cannot read the current contents of\s+['"]?(?<path>.+?)['"]?$/i,U=/^Skipped patch\s+['"]?(?<path>.+?)['"]\.$/i,M=/^warning:\s*Cannot merge binary files:\s+(?<path>.+?)\s+\(ours\s+vs\.\s+theirs\)/i;for(const F of o.split(/\r?\n/)){const v=F.trim();if(!v)continue;let L;if(L=v.match(l)){const H=a(L.groups??{},["qpath","path"]);c(n,H),i=H??i,s.delete(H??""),r.delete(H??"");continue}if(L=v.match(f)){const H=a(L.groups??{},["qpath","path"]);c(s,H),i=H??i,n.delete(H??""),r.delete(H??"");continue}if(L=v.match(d)){const H=a(L.groups??{},["qpath","path"]);c(s,H),i=H??i,n.delete(H??""),r.delete(H??"");continue}if(L=v.match(E)){c(s,L.groups?.path),i=L.groups?.path??i,n.delete(L.groups?.path??""),r.delete(L.groups?.path??"");continue}if(L=v.match(u)){i=a(L.groups??{},["qpath","path"])??i;continue}if((L=v.match(T))||(L=v.match(S))){c(r,L.groups?.path),i=L.groups?.path??i;continue}if(!(_.test(v)||h.test(v))){if(p.test(v)){i&&(c(r,i),n.delete(i),s.delete(i));continue}if(m.test(v)){i&&(c(r,i),n.delete(i),s.delete(i));continue}if((L=v.match(g))||(L=v.match(y))||(L=v.match(A))||(L=v.match(N))||(L=v.match(O))||(L=v.match(b))||(L=v.match(C))||(L=v.match(w))||(L=v.match(k))||(L=v.match(U))){c(r,L.groups?.path),i=L.groups?.path??i,n.delete(L.groups?.path??""),s.delete(L.groups?.path??"");continue}if(L=v.match(M)){c(s,L.groups?.path),i=L.groups?.path??i,n.delete(L.groups?.path??""),r.delete(L.groups?.path??"");continue}}}for(const F of s)n.delete(F),r.delete(F);for(const F of n)r.delete(F);return{appliedPaths:Array.from(n).sort(),skippedPaths:Array.from(r).sort(),conflictedPaths:Array.from(s).sort()}}function UU(e){const t=new Set,n=/^diff --git a\/(.*?) b\/(.*)$/gm;let r;for(;(r=n.exec(e))!=null;){const[s,i,o]=r;i&&i!=="/dev/null"&&t.add(i),o&&o!=="/dev/null"&&t.add(o)}return Array.from(t)}async function kU(e,t,n,{preferWslPaths:r=!1,convertWindowsPathToWslPath:s,convertWslPathToWindowsPath:i,signal:o}={}){const{cwd:c,env:a,diff:l,revert:f,target:d="unstaged",allowBinary:u}=e,_=Fd("applyPatch"),h=(await t.getWorktreeRepository(c,n))?.root;if(!h)return{status:"error",appliedPaths:[],skippedPaths:[],conflictedPaths:[],errorCode:"not-git-repo"};if(o?.aborted)return{status:"error",appliedPaths:[],skippedPaths:[],conflictedPaths:[]};const E=await fte({hostConfig:n,signal:o});let T=kt(n).join(E,"patch.diff");await _te(T,l,{hostConfig:n,signal:o}),r&&s&&(T=s(T));try{let S=a;if(d==="unstaged"){const C=await AS(h,n);if(!C)_.warning("[applyPatch] Unable to resolve git index path; applying without temp index");else{const w=await LU(E,C,n,{preferWslPaths:r,convertWindowsPathToWslPath:s});S={...a,GIT_INDEX_FILE:w},await dte(h,l,n,{preferWslPaths:r,convertWslPathToWindowsPath:i,env:{...a,GIT_INDEX_FILE:w},signal:o})}}const m=["apply"];f&&m.push("-R"),u&&m.push("--binary"),m.push("--3way"),d==="staged"?m.push("--cached"):d==="staged-and-unstaged"&&m.push("--index"),m.push(T);const{code:g,stdout:y,stderr:A}=await ue(h,m,n,{env:S,signal:o,allowedNonZeroExitCodes:[1]}),{appliedPaths:N,skippedPaths:O,conflictedPaths:b}=lte(y,A);return _.debug("ApplyPatch result metadata",{safe:{revert:f,target:d,code:g,stdoutLength:y.length,stderrLength:A.length,appliedCount:N.length,skippedCount:O.length,conflictedCount:b.length},sensitive:{}}),{status:o?.aborted||g==null?"error":g===0?"success":g===1?"partial-success":"error",appliedPaths:N,skippedPaths:O,conflictedPaths:b,execOutput:tn({command:m.join(" "),stdout:y,stderr:A})}}finally{await pte(E,{hostConfig:n})}}async function dte(e,t,n,{preferWslPaths:r,convertWslPathToWindowsPath:s,env:i,signal:o}){const c=UU(t);if(c.length===0)return;const a=[],l=kt(n);if(await Promise.all(c.map(async f=>{const d=DU(e,e,f);let u=l.join(e,d);r&&s&&(u=s(u)),await hte(u,{hostConfig:n,signal:o})&&a.push(d)})),a.length!==0){if(o?.aborted)throw new Error("Apply patch canceled");await ue(e,["add","--",...a],n,{env:i,signal:o})}}async function zd(e,t,{input:n,signal:r,timeoutMs:s=1e4}={}){if(!xe(e))throw new Error("runSshCommand requires a remote host config");const i=`sh -lc ${Lt(t)}`,[o,...c]=e.terminal_command;if(!o)throw new Error("remote host config missing terminal command");const a=[...c,"-o","BatchMode=yes","-o","ConnectTimeout=10",i],l=ou.spawn(o,a,{stdio:["pipe","pipe","pipe"]});n!=null&&l.stdin?.write(n),l.stdin?.end();let f=!1;const d=setTimeout(()=>{f=!0,l.kill()},s),u=()=>{l.kill()};r&&r.addEventListener("abort",u);const _=[],p=[];l.stdout?.on("data",S=>_.push(S)),l.stderr?.on("data",S=>p.push(S));const{code:h}=await new Promise(S=>{l.on("close",m=>S({code:m})),l.on("error",()=>S({code:null}))});clearTimeout(d),r&&r.removeEventListener("abort",u);const E=Buffer.concat(_).toString("utf8"),T=Buffer.concat(p).toString("utf8");return f?{code:null,stdout:E,stderr:`${T}ssh command timed out`}:{code:h,stdout:E,stderr:T}}async function fte({hostConfig:e,signal:t}){if(!xe(e))return me.promises.mkdtemp(lM.join(ri.tmpdir(),"codex-apply-"));const{code:n,stdout:r,stderr:s}=await zd(e,'mktemp -d "${TMPDIR:-/tmp}/codex-apply-XXXXXX"',{signal:t});if(n!==0||!r.trim())throw new Error(`failed to create remote temp dir: ${s||r}`.trim());return r.trim()}async function _te(e,t,{hostConfig:n,signal:r}){if(!xe(n)){await me.promises.writeFile(e,t);return}const s=`cat > ${Lt(e)}`,{code:i,stderr:o}=await zd(n,s,{input:t,signal:r});if(i!==0)throw new Error(`failed to write remote file: ${o}`)}async function pte(e,{hostConfig:t}){if(!xe(t)){await me.promises.rm(e,{recursive:!0,force:!0});return}await zd(t,`rm -rf ${Lt(e)}`)}async function hte(e,{hostConfig:t,signal:n}){if(!xe(t))try{return await me.promises.access(e),!0}catch{return!1}const{code:r}=await zd(t,`test -e ${Lt(e)}`,{signal:n});return r===0}const Zv=At("git");async function Ete(e,t,n,r,s,i=!0,o){try{const c=await Tte(e,t,n,r,s,i,o);if(!c.success)try{await Fs(t,s,!0)}catch(a){Zv().warning("Failed to cleanup worktree",{safe:{},sensitive:{error:a}})}return c}catch(c){try{await Fs(t,s,!0)}catch(a){Zv().warning("Failed to cleanup worktree",{safe:{},sensitive:{error:a}})}return{success:!1,error:Ste(c)}}}async function Tte(e,t,n,r,s,i,o){const c=o?.onLog,a=o?.signal;if(a&&a.aborted)return{success:!1,error:new Error("Operation canceled")};const{startingRef:l,startingDiff:f}=await rte(e,n,r,s,a);if(a&&a.aborted)return{success:!1,error:new Error("Operation canceled")};const u=await ue(e,["worktree","add","--detach",t,l],s,{onStdoutRaw:c?_=>c("stdout",_):void 0,onStderrRaw:c?_=>c("stderr",_):void 0,signal:a});if(!u.success)return{success:!1,error:new Error(`git worktree add failed: ${u.stderr||u.stdout}`)};if(a&&a.aborted)return{success:!1,error:new Error("Operation canceled")};if(i){const _=await bU(t,s);if(!_.success)return _}if(f){c?.("info",cr.Buffer.from(`[info] Applying working tree diff to new worktree
`,"utf8"));const _=await kU({cwd:t,diff:f,revert:!1},r,s,{signal:a});if(_.status!=="success"){const p=`git apply failed: applied:${_.appliedPaths.length} skipped:${_.skippedPaths.length} conflicted:${_.conflictedPaths.length}`;return c?.("info",cr.Buffer.from(`${p}
`,"utf8")),{success:!1,error:new Error(p)}}}return{success:!0}}function Ste(e){return e instanceof Error?e:new Error(String(e))}function xU(){return he.join(MJ({}),"worktrees")}const Xv=At("git");async function mte(e,t,n,r,s=xU()){const o=(await t.getWorktreeRepository(n,r))?.root;if(!o)return Xv().error("[createWorktreePath] failed to resolve git root for workspace"),{success:!1};let c=he.join,a=he.relative,l=s;if(xe(r)){const h=await JD(r);if(!h)return Xv().error("[createWorktreePath] failed to resolve remote codex home"),{success:!1};c=he.posix.join,a=he.posix.relative,l=c(h,"worktrees")}const f=xi.randomUUID().split("-")[0].slice(0,4),d=he.basename(e),u=c(l,f,d),_=a(o,n),p=c(u,_);return{success:!0,worktreeGitRoot:u,worktreeWorkspaceRoot:p}}async function BU(e,t,n){const r=await ue(e,["remote"],t,{signal:n});if(!r.success||!r.stdout)return[];const s=r.stdout.split(`
`).map(i=>i.trim()).filter(i=>i.length>0);return s.includes(Hc)&&s.length>1?[Hc,...s.filter(i=>i!==Hc)]:s}async function jc(e,t,n){const r=await BU(e,t,n);if(r.length===0)return null;for(const s of r){const i=await PU(e,s,t,n);if(i)return{remote:s,branch:i}}return null}async function GU(e,t,n,r){const s=await ue(e,["rev-parse",`${t}^{tree}`],n,{allowedNonZeroExitCodes:[128],signal:r});if(!s.success||!s.stdout)throw new Error(s.stderr||s.stdout||"Failed to resolve tree");return s.stdout}var Ds={exports:{}},Us={exports:{}},Ah,Qv;function gte(){if(Qv)return Ah;Qv=1,Ah=r,r.sync=s;var e=uu;function t(i,o){var c=o.pathExt!==void 0?o.pathExt:process.env.PATHEXT;if(!c||(c=c.split(";"),c.indexOf("")!==-1))return!0;for(var a=0;a<c.length;a++){var l=c[a].toLowerCase();if(l&&i.substr(-l.length).toLowerCase()===l)return!0}return!1}function n(i,o,c){return!i.isSymbolicLink()&&!i.isFile()?!1:t(o,c)}function r(i,o,c){e.stat(i,function(a,l){c(a,a?!1:n(l,i,o))})}function s(i,o){return n(e.statSync(i),i,o)}return Ah}var Rh,Jv;function Ate(){if(Jv)return Rh;Jv=1,Rh=t,t.sync=n;var e=uu;function t(i,o,c){e.stat(i,function(a,l){c(a,a?!1:r(l,o))})}function n(i,o){return r(e.statSync(i),o)}function r(i,o){return i.isFile()&&s(i,o)}function s(i,o){var c=i.mode,a=i.uid,l=i.gid,f=o.uid!==void 0?o.uid:process.getuid&&process.getuid(),d=o.gid!==void 0?o.gid:process.getgid&&process.getgid(),u=parseInt("100",8),_=parseInt("010",8),p=parseInt("001",8),h=u|_,E=c&p||c&_&&l===d||c&u&&a===f||c&h&&f===0;return E}return Rh}var yh,eP;function Rte(){if(eP)return yh;eP=1;var e;process.platform==="win32"||bn.TESTING_WINDOWS?e=gte():e=Ate(),yh=t,t.sync=n;function t(r,s,i){if(typeof s=="function"&&(i=s,s={}),!i){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(o,c){t(r,s||{},function(a,l){a?c(a):o(l)})})}e(r,s||{},function(o,c){o&&(o.code==="EACCES"||s&&s.ignoreErrors)&&(o=null,c=!1),i(o,c)})}function n(r,s){try{return e.sync(r,s||{})}catch(i){if(s&&s.ignoreErrors||i.code==="EACCES")return!1;throw i}}return yh}var Nh,tP;function yte(){if(tP)return Nh;tP=1;const e=process.platform==="win32"||process.env.OSTYPE==="cygwin"||process.env.OSTYPE==="msys",t=Mn,n=e?";":":",r=Rte(),s=a=>Object.assign(new Error(`not found: ${a}`),{code:"ENOENT"}),i=(a,l)=>{const f=l.colon||n,d=a.match(/\//)||e&&a.match(/\\/)?[""]:[...e?[process.cwd()]:[],...(l.path||process.env.PATH||"").split(f)],u=e?l.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",_=e?u.split(f):[""];return e&&a.indexOf(".")!==-1&&_[0]!==""&&_.unshift(""),{pathEnv:d,pathExt:_,pathExtExe:u}},o=(a,l,f)=>{typeof l=="function"&&(f=l,l={}),l||(l={});const{pathEnv:d,pathExt:u,pathExtExe:_}=i(a,l),p=[],h=T=>new Promise((S,m)=>{if(T===d.length)return l.all&&p.length?S(p):m(s(a));const g=d[T],y=/^".*"$/.test(g)?g.slice(1,-1):g,A=t.join(y,a),N=!y&&/^\.[\\\/]/.test(a)?a.slice(0,2)+A:A;S(E(N,T,0))}),E=(T,S,m)=>new Promise((g,y)=>{if(m===u.length)return g(h(S+1));const A=u[m];r(T+A,{pathExt:_},(N,O)=>{if(!N&&O)if(l.all)p.push(T+A);else return g(T+A);return g(E(T,S,m+1))})});return f?h(0).then(T=>f(null,T),f):h(0)},c=(a,l)=>{l=l||{};const{pathEnv:f,pathExt:d,pathExtExe:u}=i(a,l),_=[];for(let p=0;p<f.length;p++){const h=f[p],E=/^".*"$/.test(h)?h.slice(1,-1):h,T=t.join(E,a),S=!E&&/^\.[\\\/]/.test(a)?a.slice(0,2)+T:T;for(let m=0;m<d.length;m++){const g=S+d[m];try{if(r.sync(g,{pathExt:u}))if(l.all)_.push(g);else return g}catch{}}}if(l.all&&_.length)return _;if(l.nothrow)return null;throw s(a)};return Nh=o,o.sync=c,Nh}var Zu={exports:{}},nP;function VU(){if(nP)return Zu.exports;nP=1;const e=(t={})=>{const n=t.env||process.env;return(t.platform||process.platform)!=="win32"?"PATH":Object.keys(n).reverse().find(s=>s.toUpperCase()==="PATH")||"Path"};return Zu.exports=e,Zu.exports.default=e,Zu.exports}var Oh,rP;function Nte(){if(rP)return Oh;rP=1;const e=Mn,t=yte(),n=VU();function r(i,o){const c=i.options.env||process.env,a=process.cwd(),l=i.options.cwd!=null,f=l&&process.chdir!==void 0&&!process.chdir.disabled;if(f)try{process.chdir(i.options.cwd)}catch{}let d;try{d=t.sync(i.command,{path:c[n({env:c})],pathExt:o?e.delimiter:void 0})}catch{}finally{f&&process.chdir(a)}return d&&(d=e.resolve(l?i.options.cwd:"",d)),d}function s(i){return r(i)||r(i,!0)}return Oh=s,Oh}var Xu={},sP;function Ote(){if(sP)return Xu;sP=1;const e=/([()\][%!^"`<>&|;, *?])/g;function t(r){return r=r.replace(e,"^$1"),r}function n(r,s){return r=`${r}`,r=r.replace(/(?=(\\+?)?)\1"/g,'$1$1\\"'),r=r.replace(/(?=(\\+?)?)\1$/,"$1$1"),r=`"${r}"`,r=r.replace(e,"^$1"),s&&(r=r.replace(e,"^$1")),r}return Xu.command=t,Xu.argument=n,Xu}var bh,iP;function bte(){return iP||(iP=1,bh=/^#!(.*)/),bh}var Ih,oP;function Ite(){if(oP)return Ih;oP=1;const e=bte();return Ih=(t="")=>{const n=t.match(e);if(!n)return null;const[r,s]=n[0].replace(/#! ?/,"").split(" "),i=r.split("/").pop();return i==="env"?s:s?`${i} ${s}`:i},Ih}var Ch,aP;function Cte(){if(aP)return Ch;aP=1;const e=uu,t=Ite();function n(r){const i=Buffer.alloc(150);let o;try{o=e.openSync(r,"r"),e.readSync(o,i,0,150,0),e.closeSync(o)}catch{}return t(i.toString())}return Ch=n,Ch}var vh,cP;function vte(){if(cP)return vh;cP=1;const e=Mn,t=Nte(),n=Ote(),r=Cte(),s=process.platform==="win32",i=/\.(?:com|exe)$/i,o=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function c(f){f.file=t(f);const d=f.file&&r(f.file);return d?(f.args.unshift(f.file),f.command=d,t(f)):f.file}function a(f){if(!s)return f;const d=c(f),u=!i.test(d);if(f.options.forceShell||u){const _=o.test(d);f.command=e.normalize(f.command),f.command=n.command(f.command),f.args=f.args.map(h=>n.argument(h,_));const p=[f.command].concat(f.args).join(" ");f.args=["/d","/s","/c",`"${p}"`],f.command=process.env.comspec||"cmd.exe",f.options.windowsVerbatimArguments=!0}return f}function l(f,d,u){d&&!Array.isArray(d)&&(u=d,d=null),d=d?d.slice(0):[],u=Object.assign({},u);const _={command:f,args:d,options:u,file:void 0,original:{command:f,args:d}};return u.shell?_:a(_)}return vh=l,vh}var Ph,uP;function Pte(){if(uP)return Ph;uP=1;const e=process.platform==="win32";function t(i,o){return Object.assign(new Error(`${o} ${i.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${o} ${i.command}`,path:i.command,spawnargs:i.args})}function n(i,o){if(!e)return;const c=i.emit;i.emit=function(a,l){if(a==="exit"){const f=r(l,o);if(f)return c.call(i,"error",f)}return c.apply(i,arguments)}}function r(i,o){return e&&i===1&&!o.file?t(o.original,"spawn"):null}function s(i,o){return e&&i===1&&!o.file?t(o.original,"spawnSync"):null}return Ph={hookChildProcess:n,verifyENOENT:r,verifyENOENTSync:s,notFoundError:t},Ph}var lP;function Mte(){if(lP)return Us.exports;lP=1;const e=iu,t=vte(),n=Pte();function r(i,o,c){const a=t(i,o,c),l=e.spawn(a.command,a.args,a.options);return n.hookChildProcess(l,a),l}function s(i,o,c){const a=t(i,o,c),l=e.spawnSync(a.command,a.args,a.options);return l.error=l.error||n.verifyENOENTSync(l.status,a),l}return Us.exports=r,Us.exports.spawn=r,Us.exports.sync=s,Us.exports._parse=t,Us.exports._enoent=n,Us.exports}var Mh,dP;function wte(){return dP||(dP=1,Mh=e=>{const t=typeof e=="string"?`
`:10,n=typeof e=="string"?"\r":13;return e[e.length-1]===t&&(e=e.slice(0,e.length-1)),e[e.length-1]===n&&(e=e.slice(0,e.length-1)),e}),Mh}var cl={exports:{}};cl.exports;var fP;function Lte(){return fP||(fP=1,(function(e){const t=Mn,n=VU(),r=s=>{s={cwd:process.cwd(),path:process.env[n()],execPath:process.execPath,...s};let i,o=t.resolve(s.cwd);const c=[];for(;i!==o;)c.push(t.join(o,"node_modules/.bin")),i=o,o=t.resolve(o,"..");const a=t.resolve(s.cwd,s.execPath,"..");return c.push(a),c.concat(s.path).join(t.delimiter)};e.exports=r,e.exports.default=r,e.exports.env=s=>{s={env:process.env,...s};const i={...s.env},o=n({env:i});return s.path=i[o],i[o]=e.exports(s),i}})(cl)),cl.exports}var Ic={exports:{}},Qu={exports:{}},_P;function Dte(){if(_P)return Qu.exports;_P=1;const e=(t,n)=>{for(const r of Reflect.ownKeys(n))Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r));return t};return Qu.exports=e,Qu.exports.default=e,Qu.exports}var pP;function Ute(){if(pP)return Ic.exports;pP=1;const e=Dte(),t=new WeakMap,n=(r,s={})=>{if(typeof r!="function")throw new TypeError("Expected a function");let i,o=0;const c=r.displayName||r.name||"<anonymous>",a=function(...l){if(t.set(a,++o),o===1)i=r.apply(this,l),r=null;else if(s.throw===!0)throw new Error(`Function \`${c}\` can only be called once`);return i};return e(a,r),t.set(a,o),a};return Ic.exports=n,Ic.exports.default=n,Ic.exports.callCount=r=>{if(!t.has(r))throw new Error(`The given function \`${r.name}\` is not wrapped by the \`onetime\` package`);return t.get(r)},Ic.exports}var ks={},Cc={},vc={},hP;function kte(){if(hP)return vc;hP=1,Object.defineProperty(vc,"__esModule",{value:!0}),vc.SIGNALS=void 0;const e=[{name:"SIGHUP",number:1,action:"terminate",description:"Terminal closed",standard:"posix"},{name:"SIGINT",number:2,action:"terminate",description:"User interruption with CTRL-C",standard:"ansi"},{name:"SIGQUIT",number:3,action:"core",description:"User interruption with CTRL-\\",standard:"posix"},{name:"SIGILL",number:4,action:"core",description:"Invalid machine instruction",standard:"ansi"},{name:"SIGTRAP",number:5,action:"core",description:"Debugger breakpoint",standard:"posix"},{name:"SIGABRT",number:6,action:"core",description:"Aborted",standard:"ansi"},{name:"SIGIOT",number:6,action:"core",description:"Aborted",standard:"bsd"},{name:"SIGBUS",number:7,action:"core",description:"Bus error due to misaligned, non-existing address or paging error",standard:"bsd"},{name:"SIGEMT",number:7,action:"terminate",description:"Command should be emulated but is not implemented",standard:"other"},{name:"SIGFPE",number:8,action:"core",description:"Floating point arithmetic error",standard:"ansi"},{name:"SIGKILL",number:9,action:"terminate",description:"Forced termination",standard:"posix",forced:!0},{name:"SIGUSR1",number:10,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGSEGV",number:11,action:"core",description:"Segmentation fault",standard:"ansi"},{name:"SIGUSR2",number:12,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGPIPE",number:13,action:"terminate",description:"Broken pipe or socket",standard:"posix"},{name:"SIGALRM",number:14,action:"terminate",description:"Timeout or timer",standard:"posix"},{name:"SIGTERM",number:15,action:"terminate",description:"Termination",standard:"ansi"},{name:"SIGSTKFLT",number:16,action:"terminate",description:"Stack is empty or overflowed",standard:"other"},{name:"SIGCHLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"posix"},{name:"SIGCLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"other"},{name:"SIGCONT",number:18,action:"unpause",description:"Unpaused",standard:"posix",forced:!0},{name:"SIGSTOP",number:19,action:"pause",description:"Paused",standard:"posix",forced:!0},{name:"SIGTSTP",number:20,action:"pause",description:'Paused using CTRL-Z or "suspend"',standard:"posix"},{name:"SIGTTIN",number:21,action:"pause",description:"Background process cannot read terminal input",standard:"posix"},{name:"SIGBREAK",number:21,action:"terminate",description:"User interruption with CTRL-BREAK",standard:"other"},{name:"SIGTTOU",number:22,action:"pause",description:"Background process cannot write to terminal output",standard:"posix"},{name:"SIGURG",number:23,action:"ignore",description:"Socket received out-of-band data",standard:"bsd"},{name:"SIGXCPU",number:24,action:"core",description:"Process timed out",standard:"bsd"},{name:"SIGXFSZ",number:25,action:"core",description:"File too big",standard:"bsd"},{name:"SIGVTALRM",number:26,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGPROF",number:27,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGWINCH",number:28,action:"ignore",description:"Terminal window size changed",standard:"bsd"},{name:"SIGIO",number:29,action:"terminate",description:"I/O is available",standard:"other"},{name:"SIGPOLL",number:29,action:"terminate",description:"Watched event",standard:"other"},{name:"SIGINFO",number:29,action:"ignore",description:"Request for process information",standard:"other"},{name:"SIGPWR",number:30,action:"terminate",description:"Device running out of power",standard:"systemv"},{name:"SIGSYS",number:31,action:"core",description:"Invalid system call",standard:"other"},{name:"SIGUNUSED",number:31,action:"terminate",description:"Invalid system call",standard:"other"}];return vc.SIGNALS=e,vc}var xs={},EP;function $U(){if(EP)return xs;EP=1,Object.defineProperty(xs,"__esModule",{value:!0}),xs.SIGRTMAX=xs.getRealtimeSignals=void 0;const e=function(){const s=r-n+1;return Array.from({length:s},t)};xs.getRealtimeSignals=e;const t=function(s,i){return{name:`SIGRT${i+1}`,number:n+i,action:"terminate",description:"Application-specific signal (realtime)",standard:"posix"}},n=34,r=64;return xs.SIGRTMAX=r,xs}var TP;function xte(){if(TP)return Cc;TP=1,Object.defineProperty(Cc,"__esModule",{value:!0}),Cc.getSignals=void 0;var e=cu,t=kte(),n=$U();const r=function(){const i=(0,n.getRealtimeSignals)();return[...t.SIGNALS,...i].map(s)};Cc.getSignals=r;const s=function({name:i,number:o,description:c,action:a,forced:l=!1,standard:f}){const{signals:{[i]:d}}=e.constants,u=d!==void 0;return{name:i,number:u?d:o,description:c,supported:u,action:a,forced:l,standard:f}};return Cc}var SP;function Bte(){if(SP)return ks;SP=1,Object.defineProperty(ks,"__esModule",{value:!0}),ks.signalsByNumber=ks.signalsByName=void 0;var e=cu,t=xte(),n=$U();const r=function(){return(0,t.getSignals)().reduce(s,{})},s=function(f,{name:d,number:u,description:_,supported:p,action:h,forced:E,standard:T}){return{...f,[d]:{name:d,number:u,description:_,supported:p,action:h,forced:E,standard:T}}},i=r();ks.signalsByName=i;const o=function(){const f=(0,t.getSignals)(),d=n.SIGRTMAX+1,u=Array.from({length:d},(_,p)=>c(p,f));return Object.assign({},...u)},c=function(f,d){const u=a(f,d);if(u===void 0)return{};const{name:_,description:p,supported:h,action:E,forced:T,standard:S}=u;return{[f]:{name:_,number:f,description:p,supported:h,action:E,forced:T,standard:S}}},a=function(f,d){const u=d.find(({name:_})=>e.constants.signals[_]===f);return u!==void 0?u:d.find(_=>_.number===f)},l=o();return ks.signalsByNumber=l,ks}var wh,mP;function Gte(){if(mP)return wh;mP=1;const{signalsByName:e}=Bte(),t=({timedOut:r,timeout:s,errorCode:i,signal:o,signalDescription:c,exitCode:a,isCanceled:l})=>r?`timed out after ${s} milliseconds`:l?"was canceled":i!==void 0?`failed with ${i}`:o!==void 0?`was killed with ${o} (${c})`:a!==void 0?`failed with exit code ${a}`:"failed";return wh=({stdout:r,stderr:s,all:i,error:o,signal:c,exitCode:a,command:l,escapedCommand:f,timedOut:d,isCanceled:u,killed:_,parsed:{options:{timeout:p}}})=>{a=a===null?void 0:a,c=c===null?void 0:c;const h=c===void 0?void 0:e[c].description,E=o&&o.code,S=`Command ${t({timedOut:d,timeout:p,errorCode:E,signal:c,signalDescription:h,exitCode:a,isCanceled:u})}: ${l}`,m=Object.prototype.toString.call(o)==="[object Error]",g=m?`${S}
${o.message}`:S,y=[g,s,r].filter(Boolean).join(`
`);return m?(o.originalMessage=o.message,o.message=y):o=new Error(y),o.shortMessage=g,o.command=l,o.escapedCommand=f,o.exitCode=a,o.signal=c,o.signalDescription=h,o.stdout=r,o.stderr=s,i!==void 0&&(o.all=i),"bufferedData"in o&&delete o.bufferedData,o.failed=!0,o.timedOut=!!d,o.isCanceled=u,o.killed=_&&!d,o},wh}var Ju={exports:{}},gP;function Vte(){if(gP)return Ju.exports;gP=1;const e=["stdin","stdout","stderr"],t=r=>e.some(s=>r[s]!==void 0),n=r=>{if(!r)return;const{stdio:s}=r;if(s===void 0)return e.map(o=>r[o]);if(t(r))throw new Error(`It's not possible to provide \`stdio\` in combination with one of ${e.map(o=>`\`${o}\``).join(", ")}`);if(typeof s=="string")return s;if(!Array.isArray(s))throw new TypeError(`Expected \`stdio\` to be of type \`string\` or \`Array\`, got \`${typeof s}\``);const i=Math.max(s.length,e.length);return Array.from({length:i},(o,c)=>s[c])};return Ju.exports=n,Ju.exports.node=r=>{const s=n(r);return s==="ipc"?"ipc":s===void 0||typeof s=="string"?[s,s,s,"ipc"]:s.includes("ipc")?s:[...s,"ipc"]},Ju.exports}var Bs={exports:{}},Lh={exports:{}},AP;function $te(){return AP||(AP=1,(function(e){e.exports=["SIGABRT","SIGALRM","SIGHUP","SIGINT","SIGTERM"],process.platform!=="win32"&&e.exports.push("SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT"),process.platform==="linux"&&e.exports.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT","SIGUNUSED")})(Lh)),Lh.exports}var RP;function Hte(){if(RP)return Bs.exports;RP=1;var e=bn.process;const t=function(E){return E&&typeof E=="object"&&typeof E.removeListener=="function"&&typeof E.emit=="function"&&typeof E.reallyExit=="function"&&typeof E.listeners=="function"&&typeof E.kill=="function"&&typeof E.pid=="number"&&typeof E.on=="function"};if(!t(e))Bs.exports=function(){return function(){}};else{var n=yk,r=$te(),s=/^win/i.test(e.platform),i=Hr;typeof i!="function"&&(i=i.EventEmitter);var o;e.__signal_exit_emitter__?o=e.__signal_exit_emitter__:(o=e.__signal_exit_emitter__=new i,o.count=0,o.emitted={}),o.infinite||(o.setMaxListeners(1/0),o.infinite=!0),Bs.exports=function(E,T){if(!t(bn.process))return function(){};n.equal(typeof E,"function","a callback must be provided for exit handler"),f===!1&&d();var S="exit";T&&T.alwaysLast&&(S="afterexit");var m=function(){o.removeListener(S,E),o.listeners("exit").length===0&&o.listeners("afterexit").length===0&&c()};return o.on(S,E),m};var c=function(){!f||!t(bn.process)||(f=!1,r.forEach(function(T){try{e.removeListener(T,l[T])}catch{}}),e.emit=p,e.reallyExit=u,o.count-=1)};Bs.exports.unload=c;var a=function(T,S,m){o.emitted[T]||(o.emitted[T]=!0,o.emit(T,S,m))},l={};r.forEach(function(E){l[E]=function(){if(t(bn.process)){var S=e.listeners(E);S.length===o.count&&(c(),a("exit",null,E),a("afterexit",null,E),s&&E==="SIGHUP"&&(E="SIGINT"),e.kill(e.pid,E))}}}),Bs.exports.signals=function(){return r};var f=!1,d=function(){f||!t(bn.process)||(f=!0,o.count+=1,r=r.filter(function(T){try{return e.on(T,l[T]),!0}catch{return!1}}),e.emit=h,e.reallyExit=_)};Bs.exports.load=d;var u=e.reallyExit,_=function(T){t(bn.process)&&(e.exitCode=T||0,a("exit",e.exitCode,null),a("afterexit",e.exitCode,null),u.call(e,e.exitCode))},p=e.emit,h=function(T,S){if(T==="exit"&&t(bn.process)){S!==void 0&&(e.exitCode=S);var m=p.apply(this,arguments);return a("exit",e.exitCode,null),a("afterexit",e.exitCode,null),m}else return p.apply(this,arguments)}}return Bs.exports}var Dh,yP;function Fte(){if(yP)return Dh;yP=1;const e=cu,t=Hte(),n=1e3*5,r=(_,p="SIGTERM",h={})=>{const E=_(p);return s(_,p,h,E),E},s=(_,p,h,E)=>{if(!i(p,h,E))return;const T=c(h),S=setTimeout(()=>{_("SIGKILL")},T);S.unref&&S.unref()},i=(_,{forceKillAfterTimeout:p},h)=>o(_)&&p!==!1&&h,o=_=>_===e.constants.signals.SIGTERM||typeof _=="string"&&_.toUpperCase()==="SIGTERM",c=({forceKillAfterTimeout:_=!0})=>{if(_===!0)return n;if(!Number.isFinite(_)||_<0)throw new TypeError(`Expected the \`forceKillAfterTimeout\` option to be a non-negative integer, got \`${_}\` (${typeof _})`);return _},a=(_,p)=>{_.kill()&&(p.isCanceled=!0)},l=(_,p,h)=>{_.kill(p),h(Object.assign(new Error("Timed out"),{timedOut:!0,signal:p}))};return Dh={spawnedKill:r,spawnedCancel:a,setupTimeout:(_,{timeout:p,killSignal:h="SIGTERM"},E)=>{if(p===0||p===void 0)return E;let T;const S=new Promise((g,y)=>{T=setTimeout(()=>{l(_,h,y)},p)}),m=E.finally(()=>{clearTimeout(T)});return Promise.race([S,m])},validateTimeout:({timeout:_})=>{if(_!==void 0&&(!Number.isFinite(_)||_<0))throw new TypeError(`Expected the \`timeout\` option to be a non-negative integer, got \`${_}\` (${typeof _})`)},setExitHandler:async(_,{cleanup:p,detached:h},E)=>{if(!p||h)return E;const T=t(()=>{_.kill()});return E.finally(()=>{T()})}},Dh}var Uh,NP;function jte(){if(NP)return Uh;NP=1;const e=t=>t!==null&&typeof t=="object"&&typeof t.pipe=="function";return e.writable=t=>e(t)&&t.writable!==!1&&typeof t._write=="function"&&typeof t._writableState=="object",e.readable=t=>e(t)&&t.readable!==!1&&typeof t._read=="function"&&typeof t._readableState=="object",e.duplex=t=>e.writable(t)&&e.readable(t),e.transform=t=>e.duplex(t)&&typeof t._transform=="function",Uh=e,Uh}var Si={exports:{}},kh,OP;function qte(){if(OP)return kh;OP=1;const{PassThrough:e}=Sr;return kh=t=>{t={...t};const{array:n}=t;let{encoding:r}=t;const s=r==="buffer";let i=!1;n?i=!(r||s):r=r||"utf8",s&&(r=null);const o=new e({objectMode:i});r&&o.setEncoding(r);let c=0;const a=[];return o.on("data",l=>{a.push(l),i?c=a.length:c+=l.length}),o.getBufferedValue=()=>n?a:s?Buffer.concat(a,c):a.join(""),o.getBufferedLength=()=>c,o},kh}var bP;function Yte(){if(bP)return Si.exports;bP=1;const{constants:e}=GE,t=Sr,{promisify:n}=Gr,r=qte(),s=n(t.pipeline);class i extends Error{constructor(){super("maxBuffer exceeded"),this.name="MaxBufferError"}}async function o(c,a){if(!c)throw new Error("Expected a stream");a={maxBuffer:1/0,...a};const{maxBuffer:l}=a,f=r(a);return await new Promise((d,u)=>{const _=p=>{p&&f.getBufferedLength()<=e.MAX_LENGTH&&(p.bufferedData=f.getBufferedValue()),u(p)};(async()=>{try{await s(c,f),d()}catch(p){_(p)}})(),f.on("data",()=>{f.getBufferedLength()>l&&_(new i)})}),f.getBufferedValue()}return Si.exports=o,Si.exports.buffer=(c,a)=>o(c,{...a,encoding:"buffer"}),Si.exports.array=(c,a)=>o(c,{...a,array:!0}),Si.exports.MaxBufferError=i,Si.exports}var xh,IP;function Wte(){if(IP)return xh;IP=1;const{PassThrough:e}=Sr;return xh=function(){var t=[],n=new e({objectMode:!0});return n.setMaxListeners(0),n.add=r,n.isEmpty=s,n.on("unpipe",i),Array.prototype.slice.call(arguments).forEach(r),n;function r(o){return Array.isArray(o)?(o.forEach(r),this):(t.push(o),o.once("end",i.bind(null,o)),o.once("error",n.emit.bind(n,"error")),o.pipe(n,{end:!1}),this)}function s(){return t.length==0}function i(o){t=t.filter(function(c){return c!==o}),!t.length&&n.readable&&n.end()}},xh}var Bh,CP;function Kte(){if(CP)return Bh;CP=1;const e=jte(),t=Yte(),n=Wte(),r=(l,f)=>{f===void 0||l.stdin===void 0||(e(f)?f.pipe(l.stdin):l.stdin.end(f))},s=(l,{all:f})=>{if(!f||!l.stdout&&!l.stderr)return;const d=n();return l.stdout&&d.add(l.stdout),l.stderr&&d.add(l.stderr),d},i=async(l,f)=>{if(l){l.destroy();try{return await f}catch(d){return d.bufferedData}}},o=(l,{encoding:f,buffer:d,maxBuffer:u})=>{if(!(!l||!d))return f?t(l,{encoding:f,maxBuffer:u}):t.buffer(l,{maxBuffer:u})};return Bh={handleInput:r,makeAllStream:s,getSpawnedResult:async({stdout:l,stderr:f,all:d},{encoding:u,buffer:_,maxBuffer:p},h)=>{const E=o(l,{encoding:u,buffer:_,maxBuffer:p}),T=o(f,{encoding:u,buffer:_,maxBuffer:p}),S=o(d,{encoding:u,buffer:_,maxBuffer:p*2});try{return await Promise.all([h,E,T,S])}catch(m){return Promise.all([{error:m,signal:m.signal,timedOut:m.timedOut},i(l,E),i(f,T),i(d,S)])}},validateInputSync:({input:l})=>{if(e(l))throw new TypeError("The `input` option cannot be a stream in sync mode")}},Bh}var Gh,vP;function zte(){if(vP)return Gh;vP=1;const e=(async()=>{})().constructor.prototype,t=["then","catch","finally"].map(s=>[s,Reflect.getOwnPropertyDescriptor(e,s)]);return Gh={mergePromise:(s,i)=>{for(const[o,c]of t){const a=typeof i=="function"?(...l)=>Reflect.apply(c.value,i(),l):c.value.bind(i);Reflect.defineProperty(s,o,{...c,value:a})}return s},getSpawnedPromise:s=>new Promise((i,o)=>{s.on("exit",(c,a)=>{i({exitCode:c,signal:a})}),s.on("error",c=>{o(c)}),s.stdin&&s.stdin.on("error",c=>{o(c)})})},Gh}var Vh,PP;function Zte(){if(PP)return Vh;PP=1;const e=(a,l=[])=>Array.isArray(l)?[a,...l]:[a],t=/^[\w.-]+$/,n=/"/g,r=a=>typeof a!="string"||t.test(a)?a:`"${a.replace(n,'\\"')}"`,s=(a,l)=>e(a,l).join(" "),i=(a,l)=>e(a,l).map(f=>r(f)).join(" "),o=/ +/g;return Vh={joinCommand:s,getEscapedCommand:i,parseCommand:a=>{const l=[];for(const f of a.trim().split(o)){const d=l[l.length-1];d&&d.endsWith("\\")?l[l.length-1]=`${d.slice(0,-1)} ${f}`:l.push(f)}return l}},Vh}var MP;function Xte(){if(MP)return Ds.exports;MP=1;const e=Mn,t=iu,n=Mte(),r=wte(),s=Lte(),i=Ute(),o=Gte(),c=Vte(),{spawnedKill:a,spawnedCancel:l,setupTimeout:f,validateTimeout:d,setExitHandler:u}=Fte(),{handleInput:_,getSpawnedResult:p,makeAllStream:h,validateInputSync:E}=Kte(),{mergePromise:T,getSpawnedPromise:S}=zte(),{joinCommand:m,parseCommand:g,getEscapedCommand:y}=Zte(),A=1e3*1e3*100,N=({env:w,extendEnv:k,preferLocal:U,localDir:M,execPath:F})=>{const v=k?{...process.env,...w}:w;return U?s.env({env:v,cwd:M,execPath:F}):v},O=(w,k,U={})=>{const M=n._parse(w,k,U);return w=M.command,k=M.args,U=M.options,U={maxBuffer:A,buffer:!0,stripFinalNewline:!0,extendEnv:!0,preferLocal:!1,localDir:U.cwd||process.cwd(),execPath:process.execPath,encoding:"utf8",reject:!0,cleanup:!0,all:!1,windowsHide:!0,...U},U.env=N(U),U.stdio=c(U),process.platform==="win32"&&e.basename(w,".exe")==="cmd"&&k.unshift("/q"),{file:w,args:k,options:U,parsed:M}},b=(w,k,U)=>typeof k!="string"&&!Buffer.isBuffer(k)?U===void 0?void 0:"":w.stripFinalNewline?r(k):k,C=(w,k,U)=>{const M=O(w,k,U),F=m(w,k),v=y(w,k);d(M.options);let L;try{L=t.spawn(M.file,M.args,M.options)}catch(j){const q=new t.ChildProcess,z=Promise.reject(o({error:j,stdout:"",stderr:"",all:"",command:F,escapedCommand:v,parsed:M,timedOut:!1,isCanceled:!1,killed:!1}));return T(q,z)}const H=S(L),te=f(L,M.options,H),ce=u(L,M.options,te),ee={isCanceled:!1};L.kill=a.bind(null,L.kill.bind(L)),L.cancel=l.bind(null,L,ee);const B=i(async()=>{const[{error:j,exitCode:q,signal:z,timedOut:J},G,V,X]=await p(L,M.options,ce),K=b(M.options,G),se=b(M.options,V),ae=b(M.options,X);if(j||q!==0||z!==null){const _e=o({error:j,exitCode:q,signal:z,stdout:K,stderr:se,all:ae,command:F,escapedCommand:v,parsed:M,timedOut:J,isCanceled:ee.isCanceled,killed:L.killed});if(!M.options.reject)return _e;throw _e}return{command:F,escapedCommand:v,exitCode:0,stdout:K,stderr:se,all:ae,failed:!1,timedOut:!1,isCanceled:!1,killed:!1}});return _(L,M.options.input),L.all=h(L,M.options),T(L,B)};return Ds.exports=C,Ds.exports.sync=(w,k,U)=>{const M=O(w,k,U),F=m(w,k),v=y(w,k);E(M.options);let L;try{L=t.spawnSync(M.file,M.args,M.options)}catch(ce){throw o({error:ce,stdout:"",stderr:"",all:"",command:F,escapedCommand:v,parsed:M,timedOut:!1,isCanceled:!1,killed:!1})}const H=b(M.options,L.stdout,L.error),te=b(M.options,L.stderr,L.error);if(L.error||L.status!==0||L.signal!==null){const ce=o({stdout:H,stderr:te,error:L.error,signal:L.signal,exitCode:L.status,command:F,escapedCommand:v,parsed:M,timedOut:L.error&&L.error.code==="ETIMEDOUT",isCanceled:!1,killed:L.signal!==null});if(!M.options.reject)return ce;throw ce}return{command:F,escapedCommand:v,exitCode:0,stdout:H,stderr:te,failed:!1,timedOut:!1,isCanceled:!1,killed:!1}},Ds.exports.command=(w,k)=>{const[U,...M]=g(w);return C(U,M,k)},Ds.exports.commandSync=(w,k)=>{const[U,...M]=g(w);return C.sync(U,M,k)},Ds.exports.node=(w,k,U={})=>{k&&!Array.isArray(k)&&typeof k=="object"&&(U=k,k=[]);const M=c.node(U),F=process.execArgv.filter(H=>!H.startsWith("--inspect")),{nodePath:v=process.execPath,nodeOptions:L=F}=U;return C(v,[...L,w,...Array.isArray(k)?k:[]],{...U,stdin:void 0,stdout:void 0,stderr:void 0,stdio:M,shell:!1})},Ds.exports}var Qte=Xte();const HU=td(Qte),UE="_SHELL_ENV_DELIMITER_",Jte=`echo -n "${UE}"; command env; echo -n "${UE}"; exit`,FU={DISABLE_AUTO_UPDATE:"true",ZSH_TMUX_AUTOSTARTED:"true",ZSH_TMUX_AUTOSTART:"false"},ene=/(?:\u001B\][\s\S]*?(?:\u0007|\u001B\u005C|\u009C)|[\u001B\u009B][[\]()#;?]*(?:\d{1,4}(?:[;:]\d{0,4})*)?[\dA-PR-TZcf-nq-uy=><~])/g,jU=one(),tne=["/bin/zsh","/bin/bash"].filter(e=>e!==jU);function nne(e){if(Pi.platform==="win32")return Promise.resolve(Pi.env);const{shell:t,interactive:n,extraEnv:r}=sne(e),s=ine(n);return HU(t||jU,s,{env:{...FU,...r}}).then(({stdout:i})=>YU(i)).catch(i=>{if(t)throw i;return rne(s,r)})}function rne(e,t){return qU(e,t,0)}async function qU(e,t,n){const r=tne[n];if(r==null)return Pi.env;try{const{stdout:s}=await HU(r,e,{env:{...FU,...t}});return YU(s)}catch{}return qU(e,t,n+1)}function YU(e){const t=e.split(UE)[1],n={};for(const r of ane(t).split(`
`).filter(Boolean)){const[s,...i]=r.split("=");n[s]=i.join("=")}return n}function sne(e){return typeof e=="string"?{shell:e,interactive:!0,extraEnv:void 0}:{shell:e?.shell,interactive:e?.interactive??!0,extraEnv:e?.extraEnv}}function ine(e){return[e?"-ilc":"-lc",Jte]}function one(){const{env:e}=Pi;if(Pi.platform==="win32")return e.COMSPEC||"cmd.exe";try{const t=ri.userInfo().shell;if(t)return t}catch{}return Pi.platform==="darwin"?e.SHELL||"/bin/zsh":e.SHELL||"/bin/sh"}function ane(e){return e.replace(ene,"")}const WU="CODEX_SHELL",Ri=At("git");let el=null;async function cne(e,t,n,r){const s=lne(t.environment.setup,process.platform);if(!s||s.length===0)return null;const i=Date.now();if(r&&r.aborted)return{cwd:e,scriptPath:t.configPath,status:"failed",startedAt:i,finishedAt:Date.now(),error:"Setup script canceled",log:""};let o=null;try{const c=he.join(e,t.cwdRelativeToGitRoot);o=await me.promises.mkdtemp(he.join(ri.tmpdir(),"codex-local-environment-"));const a=he.join(o,`${xi.randomUUID()}-setup_script.sh`),l=he.join(o,`${xi.randomUUID()}-setup_exit_code.txt`),f=s.replace(/\r\n/g,`
`);await me.promises.writeFile(a,f,{mode:448});const d=`bash -xeo pipefail ${JSON.stringify(a)}; echo $? > ${JSON.stringify(l)}`,u=await une(process.platform,process.env),_=ou.spawn("bash",["-c",d],{stdio:["ignore","pipe","pipe"],cwd:c,env:u}),p=new Array,h=new Yg.StringDecoder("utf8"),E=new Yg.StringDecoder("utf8");let T="",S="";const m=(b,C,w)=>{n?.(w,b);const F=((w==="stdout"?T:S)+(w==="stdout"?h:E).write(b)).split(/\r?\n/),v=F.pop()??"";w==="stdout"?T=v:S=v;for(const L of F)L&&(p.push(L),C(`[${w}] ${L}`))},g=()=>{const b=(C,w)=>{const M=(C==="stdout"?T:S)+(C==="stdout"?h:E).end();C==="stdout"?T="":S="";for(const F of M.split(/\r?\n/))F&&(p.push(F),w(`[${C}] ${F}`))};b("stdout",C=>Ri().info(C)),b("stderr",C=>Ri().error(C))};_.stdout?.on("data",b=>m(b,C=>Ri().info(C),"stdout")),_.stderr?.on("data",b=>m(b,C=>Ri().error(C),"stderr"));const y=async()=>{try{const b=await me.promises.readFile(l,"utf8"),C=Number.parseInt(b.trim(),10);return Number.isNaN(C)?null:C}catch{return null}},A=async()=>{o!=null&&await me.promises.rm(o,{recursive:!0,force:!0})};let N=!1;const O=()=>{N=!0,_.kill()};return r&&r.addEventListener("abort",O),new Promise(b=>{_.once("error",C=>{r&&r.removeEventListener("abort",O),(async()=>(g(),await A(),b({scriptPath:a,cwd:c,status:"failed",startedAt:i,finishedAt:Date.now(),error:C?.message??"Failed to run setup script",log:p.join(`
`)})))()}),_.once("close",C=>{r&&r.removeEventListener("abort",O),(async()=>{const k=await y()??C;g(),await A();let U,M;N?(U="failed",M="Setup script canceled"):k===0?U="succeeded":(U="failed",M=`worktree_init.sh exited with code ${k??"unknown"}`),b({scriptPath:a,cwd:c,status:U,startedAt:i,finishedAt:Date.now(),error:M,log:p.join(`
`)})})()})})}catch(c){return o!=null&&await me.promises.rm(o,{recursive:!0,force:!0}),Ri().warning("[local-environment] setup script failed",{safe:{},sensitive:{error:c}}),{cwd:e,scriptPath:t.configPath,status:"failed",startedAt:i,finishedAt:Date.now(),error:String(c),log:""}}}async function une(e,t,n=()=>nne({interactive:!0,extraEnv:{[WU]:"1"}})){return e==="win32"?Promise.resolve({...t}):(el!=null||(el=(async()=>{try{const r=await n();return wP({...t,...r})}catch(r){return Ri().warning("[local-environment] failed to load shell env",{safe:{},sensitive:{error:r}}),wP({...t})}})()),el)}function wP(e){const{[WU]:t,...n}=e;return n}function lne(e,t){if(t==="darwin"){const n=e.darwin?.script;if(n&&n.length>0)return n}if(t==="linux"){const n=e.linux?.script;if(n&&n.length>0)return n}if(t==="win32"){const n=e.win32?.script;if(n&&n.length>0)return n}return e.script}async function KU(e,t,n,r,s,i){const c=["config",r==="local"?"--local":"--worktree",t,n],a=await ue(e,c,s,{signal:i});return a.success||r!=="worktree"?a.success:!a.stderr.toLowerCase().includes("worktreeconfig")||!(await ue(e,["config","extensions.worktreeConfig","true"],s,{signal:i})).success?!1:(await ue(e,c,s,{signal:i})).success}async function dne(e,t,n,r="worktree",s){return KU(e,PX,t,r,n,s)}const LP=At("syncedBranchConfig"),zU="codex-synced-branch.json",fne=gr({branch:pt(),lastSyncedTreeRef:pt()});async function ZU(e,t,n){const r=await Wd(e,t,n);return r?he.join(r,zU):null}function _ne(e){try{const t=fne.safeParse(JSON.parse(e));return t.success?t.data:(LP().warning("Invalid synced branch config",{safe:{parseErrorMessage:t.error.message??"unknown error"},sensitive:{}}),null)}catch(t){return LP().warning("Failed to parse synced branch config",{safe:{},sensitive:{error:t}}),null}}async function RS(e,t,n){const r=await ZU(e,t,n);if(!r)return null;try{const s=await et.readFile(r,t);return _ne(s)}catch(s){return s.code==="ENOENT",null}}async function pne(e,t,n,r){const s=await ZU(e,n,r);if(!s)throw new Error("No git repository found for synced branch config");const i=`${JSON.stringify(t,null,2)}
`;await et.writeFile(s,i,n)}async function hne(e,t,n,r,s){await pne(e,{branch:t,lastSyncedTreeRef:n},r,s)}async function Ene(e,t,n){return Kd(e,zU,t,n)}function Tne(e){return e.startsWith("refs/")?e:`refs/heads/${e}`}async function Sne({gitManager:e,workspaceRoot:t,startingState:n,localEnvironmentConfigPath:r,markAsCodexManaged:s=!0,hostConfig:i,signal:o,onLog:c}){if(o?.aborted)return{success:!1,error:new Error("Request canceled")};const l=(await e.getWorktreeRepository(t,i))?.root;if(!l)return{success:!1,error:new Error("Not a git repository")};if(o?.aborted)return{success:!1,error:new Error("Request canceled")};const[f,d]=await Promise.all([mne(l,n,i,o),jc(l,i,o)]),u=d?.branch??null,_=s&&f!=null&&f!==u,p=await mte(l,e,t,i);if(!p.success)return{success:!1,error:new Error("Failed to compute worktree path")};if(o?.aborted)return{success:!1,error:new Error("Request canceled")};const{worktreeGitRoot:h,worktreeWorkspaceRoot:E}=p,T=await Ete(l,h,n,e,i,s,{onLog:c,signal:o});if(!T.success)return{success:!1,error:T.error};if(o?.aborted)return{success:!1,error:new Error("Request canceled")};if(_&&f){const A=Tne(f),N=await GU(l,A,i,o);await hne(h,A,N,i,o)}if(c?.("info",cr.Buffer.from(`Worktree created at ${E}
`,"utf8")),await dne(E,r??MX,i,"worktree",o)||c?.("stderr",cr.Buffer.from(`Failed to store selected environment in git config
`,"utf8")),r==null)return c?.("info",cr.Buffer.from(`No local environment selected
`,"utf8")),{success:!0,worktreeGitRoot:h,worktreeWorkspaceRoot:E,setupResult:null};const g=await kee(r,i);if(g.type==="error")return c?.("stderr",cr.Buffer.from(`${g.error.message}
`,"utf8")),{success:!1,error:g.error};c?.("info",cr.Buffer.from(`Running setup script ${g.configPath}
`,"utf8"));const y=await cne(h,g,(A,N)=>{c?.(A,N)},o);return o?.aborted?{success:!1,error:new Error("Request canceled")}:y?.status==="failed"?(c?.("stderr",cr.Buffer.from(`${y.error??"Setup script failed"}
`,"utf8")),{success:!1,error:new Error(y.error??"Setup script failed")}):(y?.status==="succeeded"&&c?.("info",cr.Buffer.from(`Setup script completed
`,"utf8")),{success:!0,worktreeGitRoot:h,worktreeWorkspaceRoot:E,setupResult:y??null})}async function mne(e,t,n,r){return t.type==="branch"?t.branchName==="HEAD"?Wn(e,n,r):t.branchName:Wn(e,n,r)}async function gne(e,t,n){if(!xe(t)&&!me.existsSync(e))throw new Error(`ENOENT: path does not exist: ${e}`);const{success:r,stdout:s,stderr:i,code:o}=await ue(e,["rev-parse","--git-common-dir"],t,{signal:n});if(r&&s){const c=kt(t),a=c.isAbsolute(s)?s:c.resolve(e,s);return a}if(o===128&&i.toLowerCase().includes("not a git repository"))return null;throw new Error(`Failed to resolve git common dir: ${i||s||"Unknown error"}`)}async function XU(e,t,n){const r=await ue(e,["status","--porcelain=v1","-z"],t,{trim:!1,signal:n});if(!r.success)return{type:"error"};let s=0,i=0,o=0;const c=r.stdout;let a=0;for(;a<c.length&&!(a+1>=c.length);){const l=c[a],f=c[a+1];l==="?"&&f==="?"?o+=1:(l!==" "&&(s+=1),f!==" "&&(i+=1));const d=c.indexOf("\0",a);if(d===-1)break;if(a=d+1,l==="R"||l==="C"||f==="R"||f==="C"){const u=c.indexOf("\0",a);if(u===-1)break;a=u+1}}return{type:"success",stagedCount:s,unstagedCount:i,untrackedCount:o}}async function QU(e,t,n,r){const s=t.trim();if(!s)return null;const i=async E=>(await ue(e,["rev-parse","--verify","--quiet",E],n,{signal:r})).success,o=[],c=new Set,a=async E=>{const T=E?.trim();!T||c.has(T)||await i(T)&&(o.push(T),c.add(T))},l=await ue(e,["for-each-ref","--format=%(upstream:short)",`refs/heads/${s}`],n,{signal:r}),f=l.success?l.stdout.trim():null;await a(f),await a(s);const d=await ue(e,["remote"],n,{signal:r});if(d.success&&d.stdout){const E=d.stdout.split(`
`).map(N=>N.trim()).filter(N=>N.length>0),T=new Set(E),S=s.indexOf("/"),m=S>0?s.slice(0,S):null,g=m!=null&&T.has(m),y=g&&S+1<s.length?s.slice(S+1):null,A=[];for(const N of E){if(g&&N===m){y&&A.push(a(`refs/remotes/${N}/${y}`));continue}A.push(a(`${N}/${s}`),a(`refs/remotes/${N}/${s}`))}await Promise.all(A)}const u=o[0];if(!u)return null;const{success:_,stdout:p}=await ue(e,["merge-base","HEAD",u],n,{signal:r});if(!_||!p)return null;const h=p.trim();return h.length>0?h:null}async function Ane(e,t,n){const r=await hr(e,[],t,{trim:!1,allowedNonZeroExitCodes:[0,1],signal:n});return r.outputLimitExceeded||!r.success?{type:"error",error:mu(r)}:{type:"success",unifiedDiff:r.stdout,unifiedDiffBytes:r.stdoutBytes}}function JU(e,t,n){const r=Xl(he.relative(e,t));return n.map(s=>{const i=Xl(s),c=r.length>0&&(i===r||i.startsWith(`${r}/`))?e:t;return DU(e,c,s)})}async function Rne(e,t,n,r,s){const i=await t.getWorktreeRepository(e,n),o=i?.root;if(!o)return{stagedChanges:{type:"error",error:{type:"unknown"}},unstagedChanges:{type:"error",error:{type:"unknown"}}};const c=s==null?null:JU(o,e,s);if(c!=null){if(c.length===0)return{stagedChanges:{type:"success",unifiedDiff:"",unifiedDiffBytes:0},unstagedChanges:{type:"success",unifiedDiff:"",unifiedDiffBytes:0}};const f=await i.getUntrackedPaths(c),d=new Set(f.paths),u=f.success?c.filter(h=>!d.has(h)):c;if(u.length===0)return{stagedChanges:{type:"success",unifiedDiff:"",unifiedDiffBytes:0},unstagedChanges:{type:"success",unifiedDiff:"",unifiedDiffBytes:0}};const[_,p]=await Promise.all([hr(o,["--cached","--",...u],n,{trim:!1,allowedNonZeroExitCodes:[0,1],signal:r}),hr(o,["--",...u],n,{trim:!1,allowedNonZeroExitCodes:[0,1],signal:r})]);return{stagedChanges:$h(_),unstagedChanges:$h(p)}}const[a,l]=await Promise.all([hr(o,["--cached"],n,{trim:!1,allowedNonZeroExitCodes:[0,1],signal:r}),Ane(o,n,r)]);return{stagedChanges:$h(a),unstagedChanges:l}}function $h(e){return e.outputLimitExceeded||!e.success?{type:"error",error:mu(e)}:{type:"success",unifiedDiff:e.stdout,unifiedDiffBytes:e.stdoutBytes}}async function yne(e,t,n,r,s){const i=await gS(e,n,r);if(!i)return{untrackedChanges:{type:"error",error:{type:"unknown"}}};const o=s==null?null:JU(i,e,s);return o!=null&&o.length===0?{untrackedChanges:{type:"success",unifiedDiff:"",unifiedDiffBytes:0}}:o==null?{untrackedChanges:await DE(i,t,n)}:{untrackedChanges:await DE(i,t,n,{includePaths:o})}}async function Zd(e,t,n){const r=await ue(e,["worktree","list","--porcelain"],t,{signal:n});if(!r.success)throw new Error(r.stderr||r.stdout||"Failed to list worktrees for repository");return Nne(r.stdout??"")}function Nne(e){const t=[];let n=null;const r=e.split(/\r?\n/);for(const s of r){const i=s.trim();if(i.length===0){n&&(t.push(n),n=null);continue}if(i.startsWith("worktree ")){n&&t.push(n);const o=i.slice(9).trim();if(!o){n=null;continue}n={root:o,prunable:!1,locked:!1,headRef:{sha:"",type:"detached"}};continue}if(n){if(i.startsWith("HEAD ")){const o=i.slice(5).trim();n.headRef={sha:o,type:"detached"};continue}if(i.startsWith("branch ")){const o=i.slice(7).trim();o.startsWith("refs/heads/")?n.headRef={sha:n.headRef.sha,type:"branch",string:o.slice(11)}:n.headRef={sha:n.headRef.sha,type:"branch",string:o};continue}if(i==="detached"){n.headRef={sha:n.headRef.sha,type:"detached"};continue}if(i.startsWith("prunable")){n.prunable=!0;continue}i.startsWith("locked")&&(n.locked=!0)}}return n&&t.push(n),t}function One(e,t){const n=[t,e].filter(Boolean).join(`
`),{conflictedPaths:r,hasConflictHeader:s}=bne(n);return s||r.length>0?{errorType:"blocked-by-working-tree-changes",conflictedPaths:r}:{errorType:"unknown",conflictedPaths:[]}}function bne(e){const t=e.split(/\r?\n/),n=/^(error:\s*)?.*\bwould be overwritten by checkout:\s*$/i,r=new Set;let s=!1,i=!1;for(const o of t){const a=o.replace(/\r$/,"").trim();if(!s){n.test(a)&&(i=!0,s=!0);continue}if(a.length===0)continue;const l=a.toLowerCase();if(l.startsWith("please ")||l.startsWith("error:")||l==="aborting")break;r.add(a)}return{conflictedPaths:Array.from(r),hasConflictHeader:i}}const Ine="Stashed Codex worktree changes",Cne="refs/stash",DP="No local changes to save";async function su({cwd:e,branch:t,stashUncommitted:n=!1},r){const s=e.trim();if(!s)return{status:"error",error:"No workspace available for branch checkout",errorType:"unknown"};const i=t.trim();if(!i)return{status:"error",error:"Branch name is required",errorType:"unknown"};let o=null,c=null;if(n){const l=await ue(s,["stash","push","--include-untracked","-m",Ine],r,{trim:!1}),f=l.stdout.includes(DP)||l.stderr.includes(DP);if(!f&&!l.success){const d=l.stderr||l.stdout||"Failed to stash changes";return{status:"error",error:d,errorType:"failed-to-stash-changes",execOutput:tn({command:l.command,stdout:l.stdout,stderr:l.stderr,fallbackOutput:d})}}if(!f){c="stash@{0}";const d=await ue(s,["rev-parse","--verify",Cne],r);if(!d.success||d.stdout.length===0){const u=d.stderr||d.stdout||"Failed to resolve stash reference",_=await UP({cwd:s,stashRollbackRef:c,hostConfig:r}),p=_?`${u}
${_}`:u;return{status:"error",error:p,errorType:"failed-to-stash-changes",execOutput:tn({command:d.command,stdout:d.stdout,stderr:d.stderr,fallbackOutput:p})}}o=d.stdout}}const a=await ue(s,["checkout",i],r);if(!a.success){const l=await UP({cwd:s,stashRollbackRef:c,hostConfig:r}),f=a.stderr||a.stdout||"Failed to checkout branch",{errorType:d,conflictedPaths:u}=One(a.stdout,a.stderr),_=l?`${f}
${l}`:f;return{status:"error",error:_,errorType:d,conflictedPaths:u.length>0?u:void 0,execOutput:tn({command:a.command,stdout:a.stdout,stderr:a.stderr,fallbackOutput:_})}}return{status:"success",branch:i,stashRef:o}}async function UP({cwd:e,stashRollbackRef:t,hostConfig:n}){if(t==null)return null;const r=await ue(e,["stash","pop",t],n);return r.success?null:r.stderr||r.stdout||"Failed to restore stashed changes"}async function vne({cwd:e},t,n){const r=String(e).trim();if(!r)throw new Error("Workspace root is required");const s=await ue(r,["init"],n);if(!s.success)throw new Error(s.stderr||s.stdout||"Failed to run git init");return t.invalidateStableMetadata(),{success:!0}}async function ek(e,t,n,r){const s=await ue(e,["config","--get",...t],n,{signal:r});return s.success&&s.stdout?s.stdout:null}async function Pne(e,t,n,r,s){const c=await ue(e,["config",n==="local"?"--local":"--worktree","--get",t],r,{signal:s});return c.success&&c.stdout?c.stdout:null}async function kP(e,t,{includePaths:n,signal:r}={}){const s=["ls-files","--others","--exclude-standard","-z"];n&&n.length>0&&s.push("--",...n);const i=await ue(e,s,t,{trim:!1,signal:r});return i.success?{success:!0,paths:i.stdout.split("\0").map(c=>c.trim()).filter(c=>c.length>0)??[],gitRoot:e}:{success:!1,paths:[],gitRoot:e}}class Mne{constructor(t,n){this.root=t,this.hostConfig=n}shouldUseSlowUntrackedPathsCache=!1;async getConfigValue(t,n){return ek(this.root,[t],this.hostConfig,n)}async getConfigValueForScope(t,n,r){return Pne(this.root,t,n,this.hostConfig,r)}async setConfigValueForScope(t,n,r,s){return KU(this.root,t,n,r,this.hostConfig,s)}getUntrackedPaths=Object.assign(async t=>t!=null&&t.length>0?kP(this.root,this.hostConfig,{includePaths:t}):this.shouldUseSlowUntrackedPathsCache?this.getAllUntrackedPathsSlow():this.getAllUntrackedPathsFast(),{clear:()=>{this.shouldUseSlowUntrackedPathsCache=!1,this.getAllUntrackedPathsFast.clear(),this.getAllUntrackedPathsSlow.clear()},delete:t=>{t!=null&&t.length>0||(this.getAllUntrackedPathsFast.delete(),this.getAllUntrackedPathsSlow.delete())}});getUntrackedDiff=ki(async(t,n)=>{const r=await hr(this.root,["--no-index","--","/dev/null",t],this.hostConfig,{trim:!1,allowedNonZeroExitCodes:[0,1],signal:n});return r.outputLimitExceeded||!r.success?{type:"error",error:mu(r)}:{type:"success",unifiedDiff:r.stdout,unifiedDiffBytes:r.stdoutBytes}},{promise:!0,maxAge:2e3,length:1});fetchAllUntrackedPaths=async()=>{const t=Date.now(),n=await kP(this.root,this.hostConfig),r=Date.now()-t;return this.shouldUseSlowUntrackedPathsCache=r>=7e3,n};getAllUntrackedPathsFast=ki(async()=>this.fetchAllUntrackedPaths(),{promise:!0,maxAge:1e4});getAllUntrackedPathsSlow=ki(async()=>this.fetchAllUntrackedPaths(),{promise:!0,maxAge:2e4})}class wne{constructor(t,n){this.commonDir=t,this.hostConfig=n}worktreesByRoot=new Map;getCommonDir(){return this.commonDir}getRepository(t){const n=this.worktreesByRoot.get(t);if(n)return n;const r=new Mne(t,this.hostConfig);return this.worktreesByRoot.set(t,r),r}invalidateUntrackedPathsCache(){for(const t of this.worktreesByRoot.values())t.getUntrackedPaths.clear()}getOriginUrl=ki(async t=>await ek(this.commonDir,["remote.origin.url"],this.hostConfig,t),{length:0,promise:!0,maxAge:uS})}function Hh(e){return e?.id??"local"}class Lne{reposByKey=new Map;hasBackgroundedSinceLastForeground=!1;constructor(t){t.subscribe(n=>{this.handleAppEvent(n)})}async getRepoRepository(t,n){const r=await this.getStableMetadata(t,n);return r?this.getOrCreateRepo(r.commonDir,n):null}async getWorktreeRepository(t,n){const[r,s]=await Promise.all([this.getRepoRepository(t,n),this.getStableMetadata(t,n)]);return!r||!s?null:r.getRepository(s.root)}getRepoKey(t,n){return`${Hh(n)}|${t}`}getOrCreateRepo(t,n){const r=this.getRepoKey(t,n),s=this.reposByKey.get(r);if(s)return s;const i=new wne(t,n);return this.reposByKey.set(r,i),i}invalidateStableMetadata(){this.getStableMetadata.clear()}invalidateUntrackedPathsCache(t=null,n=null){if(t==null){for(const s of this.reposByKey.values())s.invalidateUntrackedPathsCache();return}const r=Hh(n);for(const[s,i]of this.reposByKey)s.startsWith(`${r}|`)&&i.invalidateUntrackedPathsCache()}getStableMetadata=ki(async(t,n)=>{const r=await gS(t,n);if(!r)return null;const s=await gne(r,n);return s?{root:r,commonDir:s}:null},{promise:!0,maxAge:uS,normalizer:([t,n])=>`${Hh(n)}|${t}`});handleAppEvent(t){switch(t.type){case"background":this.hasBackgroundedSinceLastForeground=!0;break;case"foreground":this.hasBackgroundedSinceLastForeground&&this.invalidateUntrackedPathsCache(null),this.hasBackgroundedSinceLastForeground=!1;break;case"turnComplete":this.invalidateUntrackedPathsCache(null);break}}}const tk=/^\d{6}-\d{4}-[0-9a-f]{8}$/i,nk=/^[0-9a-f]{4}$/i;async function rk(e=null){return xe(e)?Une(e):Dne()}async function Dne(){const e=xU();let t=[];try{t=await me.promises.readdir(e,{withFileTypes:!0})}catch{return[]}const n=t.filter(o=>o.isDirectory()),r=await Promise.all(n.map(async o=>{const c=he.join(e,o.name);try{const a=await me.promises.readdir(c,{withFileTypes:!0});return{parentName:o.name,parentPath:c,worktreeEntries:a}}catch{return null}})),s=[];for(const o of r){if(!o)continue;const c=nk.test(o.parentName);for(const a of o.worktreeEntries){if(!a.isDirectory()||!c&&!tk.test(a.name))continue;const l=he.join(o.parentPath,a.name),f=l;f&&s.push(Yd(l).then(async d=>await mS(l,d,null)?{dir:f,gitDir:d}:null))}}return(await Promise.all(s)).filter(o=>o!=null)}async function Une(e){let t;try{t=await JD(e)}catch{return[]}const n=he.posix.join(t,"worktrees");let r=[];try{r=await et.readdir(n,e)}catch{return[]}const s=await Promise.all(r.map(async c=>{const a=he.posix.join(n,c);try{if(!(await et.stat(a,e)).isDirectory())return null;const f=await et.readdir(a,e);return{parentName:c,parentPath:a,worktreeEntries:f}}catch{return null}})),i=[];for(const c of s){if(!c)continue;const a=nk.test(c.parentName);for(const l of c.worktreeEntries){if(!a&&!tk.test(l))continue;const f=he.posix.join(c.parentPath,l);i.push(et.stat(f,e).then(async d=>{if(!d.isDirectory())return null;const u=f;if(!u)return null;const _=await Yd(f,e);return await mS(f,_,e)?{dir:u,gitDir:_}:null}).catch(()=>null))}}return(await Promise.all(i)).filter(c=>c!=null)}const kE=At("threadConfig"),kne="codex-thread.json",xne=gr({version:uX(1),ownerThreadId:pt()});async function sk(e,t,n){return Kd(e,kne,t,n)}function Bne(e){try{const t=xne.safeParse(JSON.parse(e));return t.success?t.data:(kE().warning("Invalid thread config}",{safe:{},sensitive:{error:t.error.message}}),null)}catch(t){return kE().warning("Failed to parse thread config",{safe:{},sensitive:{error:t}}),null}}async function ik(e,t,n){const r=await sk(e,t,n);if(r==null)return null;try{const s=await et.readFile(r,t);return Bne(s)}catch(s){return s.code==="ENOENT"||kE().warning("Failed to read thread config",{safe:{},sensitive:{error:s}}),null}}async function Gne(e,t,n,r){const s=await sk(e,n,r);if(s==null)throw new Error("No git repository found for thread config");const i=`${JSON.stringify(t,null,2)}
`;await et.writeFile(s,i,n)}async function xP(e,t,n,r){await Gne(e,{version:1,ownerThreadId:t},n,r)}async function Vne(e,t,n,r,s){const i=await n.getWorktreeRepository(e,r);if(!i)return Ee({worktreeGitRoot:null,worktreeWorkspaceRoot:null,hasUncommittedChanges:!1});const o=await Zd(e,r,s),c=kt(r),a=c.relative(i.root,e),l=(await Promise.all(o.map(async _=>{const p=await Yd(_.root,r);if(!await mS(_.root,p,r)||(await ik(_.root,r,s))?.ownerThreadId!==t)return null;const T=a.length>0?c.join(_.root,a):_.root;if(T==null)return null;const S=await $ne(_.root,r);return{worktreeGitRoot:_.root,worktreeWorkspaceRoot:T,sortTimestamp:S}}))).filter(_=>_!=null);if(l.length===0)return Ee({worktreeGitRoot:null,worktreeWorkspaceRoot:null,hasUncommittedChanges:!1});l.sort((_,p)=>_.sortTimestamp!==p.sortTimestamp?p.sortTimestamp-_.sortTimestamp:p.worktreeGitRoot.localeCompare(_.worktreeGitRoot));const f=l[0],d=await ue(f.worktreeWorkspaceRoot,["status","--porcelain"],r,{signal:s,trim:!1}),u=d.success&&d.stdout.trim().length>0;return Ee({worktreeGitRoot:f.worktreeGitRoot,worktreeWorkspaceRoot:f.worktreeWorkspaceRoot,hasUncommittedChanges:u})}async function $ne(e,t){try{const r=await et.stat(e,t),s=Number(r.birthtimeMs??0);if(s>0)return s;const i=Number(r.mtimeMs??0);return i>0?i:0}catch{return 0}}const Fh=At("worktree-cleanup-service"),Hne=15,Fne=Date.parse("2026-02-21T00:00:00.000Z");class jne{keepCount;getCleanupInputs;hostConfig;deleteWorktree;running=!1;pending=!1;latestReason="created";constructor(t){this.getCleanupInputs=t.getCleanupInputs,this.hostConfig=t.hostConfig,this.deleteWorktree=t.deleteWorktree,this.keepCount=Math.max(1,t.keepCount??Hne)}trigger(t){this.latestReason=t,this.pending=!0,!this.running&&this.runCleanupLoop()}async runCleanupLoop(){if(!this.running){this.running=!0;try{for(;this.pending;){this.pending=!1;const t=this.latestReason;try{await this.runCleanup(t)}catch(n){Fh().warning("[worktree-cleanup] run-failed",{safe:{reason:t},sensitive:{error:n}})}}}finally{this.running=!1}}}async runCleanup(t){const n=await this.listCodexWorktreeRecords();if(n.length<=this.keepCount)return;const r=Array.from(new Set(n.map(a=>a.ownerThreadId).filter(a=>a!=null))),{threadMetadataById:s,pinnedThreadIds:i,protectPreMigrationOwnerlessWorktrees:o}=await this.getCleanupInputs(r),c=qne({records:n,keepCount:this.keepCount,threadMetadataById:s,pinnedThreadIds:i,protectPreMigrationOwnerlessWorktrees:o});c.candidates.length!==0&&await this.executeCleanupPlan({reason:t,totalRecords:n.length,plan:c})}async executeCleanupPlan({reason:t,totalRecords:n,plan:r}){const s="new-branch-cleanup",i=await Promise.all(r.candidates.map(async a=>{try{return await this.deleteWorktree({worktree:a.worktree.dir,reason:s,force:!0}),{deleted:!0}}catch(l){return Fh().warning("[worktree-cleanup] delete-failed",{safe:{reason:t,worktree:a.worktree.dir,ownerThreadId:a.ownerThreadId},sensitive:{error:l}}),{deleted:!1}}})),o=i.filter(a=>a.deleted).length,c=i.length-o;Fh().info("[worktree-cleanup] completed",{safe:{reason:t,total:n,candidates:r.candidates.length,deleted:o,failed:c},sensitive:{}})}async listCodexWorktreeRecords(){const t=await rk(this.hostConfig);return Promise.all(t.map(async n=>{const r=await this.getWorktreeTimestamps(n.dir),s=await ik(n.dir,this.hostConfig);return{worktree:n,ownerThreadId:s?.ownerThreadId??null,createdAtMs:r.createdAtMs}}))}async getWorktreeTimestamps(t){try{const n=await et.stat(t,this.hostConfig);return{createdAtMs:n.birthtimeMs>0?n.birthtimeMs:null}}catch{return{createdAtMs:null}}}}function BP(e){return e.ownerThreadId!=null||e.createdAtMs==null?!1:e.createdAtMs<Fne}function qne({records:e,keepCount:t,threadMetadataById:n,pinnedThreadIds:r,protectPreMigrationOwnerlessWorktrees:s=!1}){if(e.length<=t)return{candidates:[]};const i=new Set(r),o=e.filter(S=>S.ownerThreadId!=null),c=e.filter(BP),a=e.filter(S=>S.ownerThreadId==null&&!BP(S)),l=new Set(a.map(S=>String(S.worktree.dir)));if(s)for(const S of c)l.add(String(S.worktree.dir));for(const S of o)(i.has(S.ownerThreadId)||n[S.ownerThreadId]?.isInProgress===!0)&&l.add(String(S.worktree.dir));const f=(S,m)=>String(S.worktree.dir).localeCompare(String(m.worktree.dir)),d=(S,m)=>{const g=n[S.ownerThreadId]?.updatedAtMs??0,y=n[m.ownerThreadId]?.updatedAtMs??0;return g!==y?g-y:f(S,m)},u=(S,m)=>S.createdAtMs!==m.createdAtMs?(S.createdAtMs??Number.MAX_SAFE_INTEGER)-(m.createdAtMs??Number.MAX_SAFE_INTEGER):f(S,m),_=[],p=[];for(const S of c)l.has(String(S.worktree.dir))||_.push(S);for(const S of o)l.has(String(S.worktree.dir))||p.push(S);_.sort(u),p.sort(d);const h=[..._,...p],E=s?c.length:0,T=Math.max(0,e.length-E-t);return{candidates:h.slice(0,T)}}async function Yne(e,t){const n=[];for(const r of e)if(r)try{(await et.stat(r,t)).isDirectory()&&n.push(r)}catch{continue}return n}async function xE(e,t,n,{parentSha:r,message:s="Codex changes",coAuthor:i="Codex",signal:o}={}){const c=["commit-tree",t];r&&c.push("-p",r),c.push("-m",s),i&&c.push("-m",`Co-authored-by: ${i}`);const a=await ue(e,c,n,{signal:o});return!a.success||!a.stdout?{success:!1,error:a}:{success:!0,commitSha:a.stdout}}function oo(e){return/^[0-9a-f]{7,40}$/i.test(e)}const GP=1024;async function ok({gitRoot:e,env:t,signal:n,hostConfig:r,untrackedPathsPromise:s}){if(!s)return ue(e,["add","-A"],r,{env:t,signal:n});const i=await s;if(!i.success)return ue(e,["add","-A"],r,{env:t,signal:n});const o=await ue(e,["add","-u"],r,{env:t,signal:n});if(!o.success||i.paths.length===0)return o;for(const c of Wne(i.paths))if(!(await ue(e,["add","--",...c],r,{env:t,signal:n})).success)return ue(e,["add","-A"],r,{env:t,signal:n});return o}function Wne(e){const t=[];for(let n=0;n<e.length;n+=GP)t.push(e.slice(n,n+GP));return t}const Kne="GIT_INDEX_FILE";async function ak(e,t,n){const r=await zne(n);try{const s=await LU(r,e,n),i={[Kne]:s};return await t(i)}finally{await Zne(r,n)}}async function zne(e){if(!xe(e))return me.promises.mkdtemp(he.join(ri.tmpdir(),"codex-index-"));const t=await Wr({hostConfig:e,args:["sh","-lc",'mktemp -d "${TMPDIR:-/tmp}/codex-index-XXXXXX"'],timeoutMs:1e4}),{code:n,stdout:r,stderr:s}=await t.wait();if(n!==0||!r.trim()){const i=n==null?`${s}ssh command timed out`:s||r;throw new Error(`failed to create remote temp dir: ${i}`.trim())}return r.trim()}async function Zne(e,t){if(!xe(t)){await me.promises.rm(e,{recursive:!0,force:!0});return}await(await Wr({hostConfig:t,args:["sh","-lc",`rm -rf ${Lt(e)}`],timeoutMs:1e4})).wait()}async function ul(e,t){const n=t.hostConfig,r=await AS(e,n);if(!r)throw new Error("Failed to resolve git index path");return ak(r,async s=>{const i=await ok({gitRoot:e,env:s,signal:t.signal,hostConfig:n,untrackedPathsPromise:t.untrackedPathsPromise});if(!i.success)throw new Error(i.stderr||i.stdout||"Failed to stage working tree snapshot");const o=await ue(e,["write-tree"],n,{env:s,signal:t.signal}),c=o.success?o.stdout.trim():null;if(c){if(!oo(c))throw new Error(`Unexpected tree SHA: ${c}`)}else throw new Error("Failed to write working tree snapshot");return c},n)}const Xne="refs/codex/snapshots",Br=At("worktree-snapshot");async function Qne(e,t,n,r,s){const i=await e.getStableMetadata(t,n);if(!i)throw Br().warning("[worktree-snapshot] not-a-repository",{safe:{reason:r},sensitive:{}}),new Error(`Not in a git repository: ${t}`);const o=gu(i.root),c=yS(o);Br().info("[worktree-snapshot] start",{safe:{worktreeId:o,reason:r,hasHostConfig:n!=null},sensitive:{}});const a=await e.getWorktreeRepository(t,n);if(!a)throw new Error("Unable to resolve worktree repository for snapshot.");const l=a.getUntrackedPaths(),f=await ul(i.root,{hostConfig:n,signal:s,untrackedPathsPromise:l}),d=await ue(i.root,["rev-parse","HEAD"],n,{allowedNonZeroExitCodes:[128],signal:s}),u=d.success&&d.stdout?d.stdout.trim():null;let _=u;if(u){if((await GU(i.root,u,n,s)).trim()!==f){const E=await xE(i.root,f,n,{parentSha:u,message:VP(r),signal:s});if(!E.success)throw new Error("Failed to create synthetic commit");_=E.commitSha.trim()}}else{const h=await xE(i.root,f,n,{message:VP(r),signal:s});if(!h.success)throw new Error("Failed to create synthetic commit");_=h.commitSha.trim()}if(!_)throw new Error("Failed to compute snapshot commit");const p=await ue(i.root,["update-ref",c,_],n,{env:{GIT_TERMINAL_PROMPT:"0"},signal:s});if(!p.success)throw Br().warning("[worktree-snapshot] update-ref-failed",{safe:{worktreeId:o,reason:r,code:p.code,stderr:p.stderr},sensitive:{}}),new Error("Failed to update ref");return Br().info("[worktree-snapshot] success",{safe:{worktreeId:o,reason:r},sensitive:{snapshotRef:c,commitSha:_}}),{snapshotRef:c,worktreeId:o,repoRoot:i.root,commonDir:i.commonDir,commitSha:_}}async function Jne(e,t,n,r,s){const i=n,o=gu(i),c=yS(o),a=await Yne(t,r);if(a.length===0)throw new Error("No candidate workspace roots exist on disk");const l=(await Promise.all(a.map(async d=>{try{return await e.getStableMetadata(d,r)}catch{return null}}))).filter(d=>!!d);if(l.length===0)throw new Error("No candidate workspace roots are valid git repositories");const f=await Promise.all(l.map(async d=>{const u=await ue(d.root,["show-ref","--verify","--hash",c],r,{allowedNonZeroExitCodes:[128,1],env:{GIT_TERMINAL_PROMPT:"0"},signal:s});return{metadata:d,showRefResult:u}}));for(const{metadata:d,showRefResult:u}of f)if(!(u.code===128||u.code===1)){if(!u.success||!u.stdout)throw new Error(u.stderr||u.stdout||"Failed to resolve snapshot ref");return{snapshotRef:c,worktreeId:o,repoRoot:d.root,commonDir:d.commonDir,exists:!0,commitSha:u.stdout.trim()}}return{snapshotRef:c,worktreeId:o,exists:!1,commitSha:null}}async function ere(e,t,n,r){const s=gu(t),i=yS(s);Br().info("[worktree-restore] start",{safe:{worktreeId:s,snapshotRef:i,hasHostConfig:n!=null},sensitive:{}});const o=await ue(e,["worktree","add","--detach",t,i],n,{env:{GIT_TERMINAL_PROMPT:"0"},signal:r});if(!o.success)throw Br().warning("[worktree-restore] add-failed",{safe:{worktreeId:s,code:o.code},sensitive:{stderr:o.stderr,stdout:o.stdout}}),new Error(o.stderr||o.stdout||"Failed to restore worktree");const c=await bU(t,n);if(!c.success){Br().warning("[worktree-restore] mark-managed-failed",{safe:{worktreeId:s},sensitive:{error:c.error.message}});try{await Fs(t,n,!0)}catch{await et.rm(t,{recursive:!0,force:!0},n)}throw new Error(c.error.message)}return Br().info("[worktree-restore] success",{safe:{worktreeId:s},sensitive:{snapshotRef:i}}),!0}function yS(e){return`${Xne}/${e}`}function VP(e){return`Codex worktree snapshot: ${e}`}const tre=gr({state:pt().optional(),number:Vc().optional(),url:pt().optional()});Vd(tre);lu.promisify(ou.execFile);const $P={error:0,warning:1,info:2,debug:3,trace:4};function nre(e,t){return $P[e]<=$P[t]}lu.promisify(ou.execFile);gr({title:pt(),body:pt()});async function rre({root:e,diff:t,gitManager:n,hostConfig:r,signal:s,logger:i}){const o=await AS(e,r);return o?ak(o,c=>HP(e,t,n,r,s,i,c),r):(i&&i.warning("Unable to resolve git index path; applying without temp index"),HP(e,t,n,r,s,i))}async function HP(e,t,n,r,s,i,o){return(await sre(e,t,r,s,o)).success||i&&i.error("Failed to stage target worktree changes"),kU({cwd:e,diff:t,allowBinary:!0,revert:!1,env:o},n,r,{signal:s})}async function sre(e,t,n,r,s){const i=UU(t);if(i.length===0)return{success:!0,command:"git add",stdout:"",stderr:""};const o=await ire(e,i,n);return o.length===0?{success:!0,command:"git add",stdout:"",stderr:""}:ue(e,["add","--",...o],n,{env:s,signal:r})}async function ire(e,t,n){const r=kt(n),s=[];return await Promise.all(t.map(async i=>{const o=r.join(e,i);try{await et.stat(o,n),s.push(i)}catch{return}})),s}async function ore({sourceHeadRef:e,sourceTreeRef:t,destinationRoot:n,destinationHeadRef:r,gitManager:s,hostConfig:i,signal:o}){const c=FD("applyChanges"),a=await are(n,e,r,i,o);if(!a)return{status:"command-error"};const l=await hr(n,[a,t],i,{binary:!0,trim:!1,allowedNonZeroExitCodes:[0,1],signal:o});if(l.outputLimitExceeded||!l.success)return{status:"command-error",execOutput:tn(l)};const f=l.stdout;if(!f)return{status:"success"};const d=await rre({root:n,diff:f,gitManager:s,hostConfig:i,signal:o,logger:c});return d.status==="error"?{status:"command-error",execOutput:d.execOutput}:d.status==="partial-success"?{status:"partial-success",appliedPaths:d.appliedPaths,skippedPaths:d.skippedPaths,conflictedPaths:d.conflictedPaths}:{status:"success"}}async function are(e,t,n,r,s){const i=await ue(e,["merge-base",t,n],r,{allowedNonZeroExitCodes:[1],signal:s});if(!i.success||!i.stdout)return null;const o=i.stdout.trim();return o?o:null}const cre="Codex <noreply@openai.com>";function ure(e){const t=lre(e);return t!==void 0?t:cre}function lre(e){if(e==null)return e;const t=e.trim();return t||null}function dre(e,t){if(!t)return e;const n=fre(t);if(_re(e,n))return e;const r=e.trimEnd();if(!r)return n;const s=pre(r)?`
`:`

`;return`${r}${s}${n}`}function fre(e){return`Co-authored-by: ${e}`}function _re(e,t){const n=Ere(t);return new RegExp(`^${n}$`,"gim").test(e)}function pre(e){const t=e.split(/\r?\n/);let n=t.length-1,r=!1;for(;n>=0&&t[n]?.trim()!=="";){if(!hre(t[n]))return!1;r=!0,n-=1}return r}function hre(e){return/^[A-Za-z][A-Za-z0-9-]*:\s+\S/.test(e)}function Ere(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Tre(...e){const t=[],n=r=>{const s=r.trim();s.length!==0&&t.push(s)};for(const r of e)for(const s of r)n(s);return t}async function Sre(e,t,n,r,s,i){if(!n||n.trim().length===0)return{type:"error",error:{type:"unknown"}};const o=await hr(t,[n],s,{trim:!1,allowedNonZeroExitCodes:[0,1],signal:i});if(o.outputLimitExceeded||!o.success)return{type:"error",error:mu(o)};if(!r.success)return{type:"error",error:{type:"unknown"}};const c=await CU(e,r,i);if(!c.success)return{type:"error",error:c.error};const l=Tre([o.stdout],c.sections).join(`
`);return{type:"success",unifiedDiff:l,unifiedDiffBytes:Buffer.byteLength(l,"utf8")}}function NS(e){return e.startsWith("refs/heads/")?e.slice(11):e}async function mre(e,t,n,r){const s=await e.getWorktreeRepository(t,n),i=s?.root;if(!i)return{gitRoot:null,branch:null,baseBranch:null,baseBranchRemote:null,branchChanges:{type:"error",error:{type:"unknown"}}};const[o,c]=await Promise.all([Wn(i,n,r),jc(i,n,r)]);let a=o;if(!a){const E=await RS(t,n,r);a=E?NS(E.branch):null}if(!c)return{gitRoot:i,branch:a,baseBranch:null,baseBranchRemote:null,branchChanges:{type:"error",error:{type:"unknown"}}};const{branch:l,remote:f}=c,d=l,u=d.includes("/")?d:`${f}/${d}`,_=await QU(i,u,n,r);if(!_)return{gitRoot:i,branch:a,baseBranch:d,baseBranchRemote:f,branchChanges:{type:"error",error:{type:"unknown"}}};const p=await s.getUntrackedPaths(),h=await Sre(s.getUntrackedDiff,t,_,p,n,r);return{gitRoot:i,branch:a,baseBranch:d,baseBranchRemote:f,branchChanges:h}}const gre=At("git");async function Are(e,t,n){const r=await Wd(e,t,n);if(!r)return{lastModified:0};const s=he.join(r,"index");try{return{lastModified:(await me.promises.stat(s)).mtimeMs}}catch(i){return i.code==="ENOENT"?{lastModified:0}:(gre().error("Failed to read index info",{safe:{indexPath:s},sensitive:{error:i}}),{lastModified:0})}}async function FP(e,t,n,r){const{success:s,stdout:i}=await ue(e,["for-each-ref",`--count=${t}`,"--sort=-committerdate","refs/heads","--format=%(refname:short)"],n,{signal:r});return!s||!i?[]:i.split(`
`).map(o=>o.trim()).filter(o=>o.length>0)}async function Rre(e,t,n){const r=await ue(e,["config","--file",".gitmodules","--get-regexp","path"],t,{allowedNonZeroExitCodes:[1],signal:n});if(!r.success||!r.stdout)return[];const s=r.stdout.split(`
`).map(i=>i.trim()).filter(i=>i.length>0).map(i=>{const o=i.split(/\s+/),c=o[o.length-1]??"";return Xl(c)}).filter(i=>i.length>0);return Array.from(new Set(s))}async function yre(e,t,n){return{trackedChanges:await vU(e,t,n)}}const Nre=new RegExp("(?<=\\n)"),Ore=/^0+$/,Ql=3e4;async function bre(e,{cwd:t,oid:n,path:r,fallbackToDisk:s},i,o){const c=xe(i);try{const a=await e.getStableMetadata(t,i);if(!a)return{type:"error",error:{type:"unknown"}};const l=String(a.root),d=kt(i).join(l,r);if(!Ire(n))return s?qP(d,i):{type:"error",error:{type:"not-found"}};const u=await vre(l,n,i,o,c);return u.type==="success"?u:s&&u.error.type==="not-found"?qP(d,i):u}catch(a){return a.code==="ENOENT"?{type:"error",error:{type:"not-found"}}:{type:"error",error:{type:"unknown"}}}}function ck(e){return e.includes("No such file")||e.includes("cannot open")||e.includes("not found")}function BE(e){const t=e.split(Nre);return t.length===1&&t[0]===""?[]:(t.at(-1)===""&&t.pop(),t)}function Ire(e){return e?!Ore.test(e):!1}function jP(e){return e.code===128?"not-found":"unknown"}async function Cre(e,t){if(xe(t)){const{stdout:r,stderr:s,code:i}=await Wr({hostConfig:t,args:["wc","-c",e],timeoutMs:Ql}).then(a=>a.wait());if(i!==0){if(ck(s)){const a=new Error(`File not found: ${e}`);throw a.code="ENOENT",a}throw new Error(`Failed to stat remote file: ${e}`)}const o=r.trim().split(/\s+/)[0],c=Number.parseInt(o??"",10);if(Number.isNaN(c))throw new Error(`Failed to parse file size for ${e}`);return c}return(await oM.stat(e)).size}async function qP(e,t){if(await Cre(e,t)>Ci)return{type:"error",error:{type:"too-large",limitBytes:Ci}};if(xe(t)){const{stdout:s,stderr:i,code:o}=await Wr({hostConfig:t,args:["cat",e],timeoutMs:Ql}).then(c=>c.wait());return o!==0?ck(i)?{type:"error",error:{type:"not-found"}}:{type:"error",error:{type:"unknown"}}:{type:"success",lines:BE(s)}}const r=await oM.readFile(e,"utf8");return{type:"success",lines:BE(r)}}async function vre(e,t,n,r,s){const i=await ue(e,["cat-file","-s",t],n,{signal:r,timeoutMs:s?Ql:void 0});if(!i.success)return{type:"error",error:{type:jP(i)}};const o=Number.parseInt(i.stdout,10);if(!Number.isNaN(o)&&o>Ci)return{type:"error",error:{type:"too-large",limitBytes:Ci}};const c=await ue(e,["cat-file","-p",t],n,{maxOutputBytes:Ci,signal:r,timeoutMs:s?Ql:void 0,trim:!1});return c.outputLimitExceeded?{type:"error",error:{type:"too-large",limitBytes:Ci}}:c.success?{type:"success",lines:BE(c.stdout)}:{type:"error",error:{type:jP(c)}}}async function Ur({cwd:e,stashRef:t,mode:n="apply"},r){const s=e.trim();if(!s)return{status:"error",error:"No workspace available for stash apply"};const i=t.trim();if(!i)return{status:"error",error:"Stash reference is required"};const o=await Pre(s,i,r),c=await ue(s,["stash",n,o],r);if(!c.success){const a=c.stderr||c.stdout||"Failed to apply stash";return{status:"error",error:a,execOutput:tn({command:c.command,stdout:c.stdout,stderr:c.stderr,fallbackOutput:a})}}return{status:"success",stashRef:i,mode:n}}async function Pre(e,t,n){if(!oo(t))return t;const r=await ue(e,["stash","list","--format=%H %gd"],n);return!r.success||r.stdout.length===0?t:r.stdout.split(`
`).map(i=>i.trim()).filter(i=>i.length>0).map(i=>i.split(/\s+/,2)).find(([i])=>i===t)?.[1]??t}async function Vn({cwd:e,branch:t,stashRef:n,restoreBranchError:r,restoreStashError:s,hostConfig:i}){const o=[];return t==null?(o.push(r),o):((await su({cwd:e,branch:t,stashUncommitted:!1},i)).status==="error"&&o.push(r),n!=null&&(await Ur({cwd:e,stashRef:n,mode:"pop"},i)).status==="error"&&o.push(s),o)}async function Mre(e,{hostConfig:t,signal:n}){const r=[];if(e.sourceBranch.trim().length===0||e.sourceHeadSha.trim().length===0)return Ee({status:"error",error:"invalid-params",message:"Missing source branch or source HEAD SHA",rollbackErrors:[],warnings:r});let s=null,i=null,o=!1,c=!1;try{if(await Wn(e.sourceWorktreeCwd,t,n)==null)return Ee({status:"error",error:"source-not-on-branch",message:"Source worktree must be on a branch to move to local",rollbackErrors:[],warnings:r});const l=kt(t),f=l.normalize(l.resolve(e.localGitRoot)),d=l.normalize(l.resolve(e.sourceWorktreeRoot));if((await Zd(e.localGitRoot,t,n)).some(T=>{if(T.headRef.type!=="branch"||T.headRef.string!==e.sourceBranch)return!1;const S=l.normalize(l.resolve(T.root));return S!==f&&S!==d}))return Ee({status:"error",error:"branch-checked-out-elsewhere",message:"Branch is already checked out in another worktree",rollbackErrors:[],warnings:r});i=await Wn(e.localGitRoot,t,n);const p=await su({cwd:e.sourceWorktreeCwd,branch:e.sourceHeadSha,stashUncommitted:!0},t);if(p.status==="error")return Ee({status:"error",error:"source-detach-failed",message:p.error,rollbackErrors:[],warnings:r,execOutput:p.execOutput});s=p.stashRef,o=!0;const h=await XU(e.localGitRoot,t,n);if(h.type!=="success"){const T=await Vn({cwd:e.sourceWorktreeCwd,branch:e.sourceBranch,stashRef:s,restoreBranchError:"restore-source-branch-failed",restoreStashError:"restore-source-stash-failed",hostConfig:t});return Ee({status:"error",error:"local-status-check-failed",message:"Failed to read destination local status",rollbackErrors:T,warnings:r})}if(h.stagedCount+h.unstagedCount>0){const T=await Vn({cwd:e.sourceWorktreeCwd,branch:e.sourceBranch,stashRef:s,restoreBranchError:"restore-source-branch-failed",restoreStashError:"restore-source-stash-failed",hostConfig:t});return Ee({status:"error",error:"local-destination-has-tracked-changes",message:"You have uncommitted changes. Commit or stash them first.",rollbackErrors:T,warnings:r})}if(i!==e.sourceBranch){const T=await su({cwd:e.localGitRoot,branch:e.sourceBranch,stashUncommitted:!1},t);if(T.status==="error"){const S=await Vn({cwd:e.sourceWorktreeCwd,branch:e.sourceBranch,stashRef:s,restoreBranchError:"restore-source-branch-failed",restoreStashError:"restore-source-stash-failed",hostConfig:t});return Ee({status:"error",error:"checkout-local-failed",message:T.error,rollbackErrors:S,warnings:r,execOutput:T.execOutput})}c=!0}if(s!=null){const T=await Ur({cwd:e.localGitRoot,stashRef:s,mode:"apply"},t);if(T.status==="error"){let m=[];return m=[...m,...await Vn({cwd:e.localGitRoot,branch:i,stashRef:null,restoreBranchError:"restore-local-branch-failed",restoreStashError:"restore-local-stash-failed",hostConfig:t})],m=[...m,...await Vn({cwd:e.sourceWorktreeCwd,branch:e.sourceBranch,stashRef:s,restoreBranchError:"restore-source-branch-failed",restoreStashError:"restore-source-stash-failed",hostConfig:t})],Ee({status:"error",error:"apply-source-stash-failed",message:T.error,rollbackErrors:m,warnings:r,execOutput:T.execOutput})}(await Ur({cwd:e.localGitRoot,stashRef:s,mode:"drop"},t)).status==="error"&&r.push("drop-source-stash-failed")}return Ee({status:"success",warnings:r})}catch{let a=[];return c&&(a=[...a,...await Vn({cwd:e.localGitRoot,branch:i,stashRef:null,restoreBranchError:"restore-local-branch-failed",restoreStashError:"restore-local-stash-failed",hostConfig:t})]),o&&(a=[...a,...await Vn({cwd:e.sourceWorktreeCwd,branch:e.sourceBranch,stashRef:s,restoreBranchError:"restore-source-branch-failed",restoreStashError:"restore-source-stash-failed",hostConfig:t})]),Ee({status:"error",error:"unexpected-error",message:"Failed to move thread to local",rollbackErrors:a,warnings:r})}}async function wre(e,{hostConfig:t,signal:n}){const r=[];if(e.sourceBranch.trim().length===0)return Ee({status:"error",error:"invalid-params",message:"Missing source branch",rollbackErrors:[],warnings:r});const s=(e.worktreeCheckoutBranch??e.sourceBranch).trim();if(s.length===0)return Ee({status:"error",error:"invalid-params",message:"Missing worktree checkout branch",rollbackErrors:[],warnings:r});if(e.defaultBranch!=null&&e.defaultBranch===s)return Ee({status:"error",error:"default-branch-blocked",message:"Move to worktree is not available on the default branch",rollbackErrors:[],warnings:r});let i=null,o=null,c=null,a=!1,l=!1,f=!1;try{if(c=await Wn(e.localCwd,t,n),c==null)return Ee({status:"error",error:"local-not-on-branch",message:"Local repository must be on a branch to move to a worktree",rollbackErrors:[],warnings:r});if(c===e.sourceBranch){const u=e.defaultBranch!=null&&e.sourceBranch===e.defaultBranch||s!==e.sourceBranch,_=e.localCheckoutBranch?.trim()??"",p=_.length>0?_:u?e.sourceBranch:null;if(p==null)return Ee({status:"error",error:"invalid-params",message:"Missing local checkout branch",rollbackErrors:[],warnings:r});const h=await su({cwd:e.localCwd,branch:p,stashUncommitted:!0},t);if(h.status==="error")return Ee({status:"error",error:"checkout-local-failed",message:h.error,rollbackErrors:[],warnings:r,execOutput:h.execOutput});i=h.stashRef,a=!0}const d=await su({cwd:e.worktreeWorkspaceRoot,branch:s,stashUncommitted:e.stashTargetWorktree},t);if(d.status==="error"){let u=[];if(a&&(u=[...u,...await Vn({cwd:e.localCwd,branch:c,stashRef:i,restoreBranchError:"restore-local-branch-failed",restoreStashError:"restore-local-stash-failed",hostConfig:t})]),e.createdWorktree)try{await Fs(e.worktreeGitRoot,t,!0,n)}catch{u.push("cleanup-created-worktree-failed")}return Ee({status:"error",error:"checkout-worktree-failed",message:d.error,rollbackErrors:u,warnings:r,execOutput:d.execOutput})}if(o=d.stashRef,l=!0,o!=null&&r.push("stashed-target-worktree-changes"),i!=null){const u=await Ur({cwd:e.worktreeWorkspaceRoot,stashRef:i,mode:"apply"},t);if(u.status==="error"){let _=[];if(o!=null&&(await Ur({cwd:e.worktreeWorkspaceRoot,stashRef:o,mode:"pop"},t)).status==="error"&&_.push("restore-target-stash-failed"),a&&(_=[..._,...await Vn({cwd:e.localCwd,branch:c,stashRef:i,restoreBranchError:"restore-local-branch-failed",restoreStashError:"restore-local-stash-failed",hostConfig:t})]),e.createdWorktree)try{await Fs(e.worktreeGitRoot,t,!0,n)}catch{_.push("cleanup-created-worktree-failed")}return Ee({status:"error",error:"apply-source-stash-failed",message:u.error,rollbackErrors:_,warnings:r,execOutput:u.execOutput})}f=!0}return o!=null&&(await Ur({cwd:e.worktreeWorkspaceRoot,stashRef:o,mode:"drop"},t)).status==="error"&&r.push("drop-target-stash-failed"),i!=null&&(await Ur({cwd:e.localCwd,stashRef:i,mode:"drop"},t)).status==="error"&&r.push("drop-source-stash-failed"),Ee({status:"success",warnings:r})}catch{let d=[];if(!f&&o!=null&&(await Ur({cwd:e.worktreeWorkspaceRoot,stashRef:o,mode:"pop"},t)).status==="error"&&d.push("restore-target-stash-failed"),a&&(d=[...d,...await Vn({cwd:e.localCwd,branch:c,stashRef:f?null:i,restoreBranchError:"restore-local-branch-failed",restoreStashError:"restore-local-stash-failed",hostConfig:t})]),l&&!f&&e.createdWorktree)try{await Fs(e.worktreeGitRoot,t,!0,n)}catch{d.push("cleanup-created-worktree-failed")}return Ee({status:"error",error:"unexpected-error",message:"Failed to move thread to worktree",rollbackErrors:d,warnings:r})}}async function OS(e,t,n,r){const s=await ue(e,["rev-parse",t],n,{allowedNonZeroExitCodes:[128],signal:r}),i=s.success?s.stdout.trim():null;if(i&&!oo(i))throw new Error(`Unexpected ${t} SHA: ${i}`);return i?i:null}async function uk(e,t,n){const r=await OS(e,"HEAD",t,n);if(r&&!oo(r))throw new Error(`Unexpected HEAD SHA: ${r}`);return r?r:null}async function Lre(e,t,n,r){const s=await OS(e,`${t}^{tree}`,n,r);if(s&&!oo(s))throw new Error(`Unexpected ${t} SHA: ${s}`);return s?s:null}const YP=1024;async function Dre({gitRoot:e,targetRoot:t,branchName:n,headCommitSha:r,treeSha:s,targetCurrentBranch:i,hostConfig:o,signal:c}){const a=FD("syncedBranch.overwrite"),l=t?await uk(t,o,c):null,f=await Lre(e,r,o,c);if(!f)return{status:"command-error"};const u=s&&s!==f&&(!t||!(!i||i===n));let _;if(u){const T=await xE(e,s,o,{parentSha:r,signal:c});if(!T.success)return{status:"command-error",execOutput:tn({command:"git commit-tree",stdout:"",stderr:T.error.stderr,fallbackOutput:T.error.stderr||T.error.stdout||"Failed to create synthetic commit"})};_=T.commitSha}else _=r;const[p,h]=await Promise.all([e&&_!==r?await ue(e,["reset","--hard",_],o,{signal:c}):null,t?await ue(t,["update-ref",i?`refs/heads/${i}`:"HEAD",_],o,{signal:c}):e?await ue(e,["branch","-f",n,_],o,{signal:c}):null]),E=h&&!h.success?h:p?.success===!1?p:null;if(E){const T=E.stderr||E.stdout||"Failed to reset branch";return{status:"command-error",execOutput:tn({command:E.command,stdout:E.stdout,stderr:E.stderr,fallbackOutput:T})}}if(t){const T=await ue(t,["reset","--mixed","HEAD"],o,{signal:c});if(!T.success){const g=T.stderr||T.stdout||"Failed to reset index";return{status:"command-error",execOutput:tn({command:T.command,stdout:T.stdout,stderr:T.stderr,fallbackOutput:g})}}const S=s?s:f;l&&await kre({gitRoot:t,baseRef:l,treeToRestore:S,hostConfig:o,signal:c,logger:a});const m=await ue(t,["restore","--source",S,"--worktree","--","."],o,{signal:c});if(!m.success){const g=m.stderr||m.stdout||"Failed to restore working tree";return{status:"command-error",execOutput:tn({command:m.command,stdout:m.stdout,stderr:m.stderr,fallbackOutput:g})}}}return a.info("Synced branch applied to branch checkout"),{status:"success"}}async function Ure(e,t,n,r){let s=null;for(const i of xre(t)){const o=await ue(e,["clean","-fd","--",...i],n,{signal:r});if(!o.success){s=o;break}}return s}async function kre({gitRoot:e,baseRef:t,treeToRestore:n,hostConfig:r,signal:s,logger:i}){const o=await ue(e,["diff","--name-only","--diff-filter=D","--no-renames",t,n],r,{allowedNonZeroExitCodes:[1],signal:s});if(!o.success){i.warning("Failed to compute deleted paths before cleaning untracked files.");return}const c=o.stdout.length>0?o.stdout.split(`
`).map(l=>l.trim()).filter(l=>l.length>0):[];if(c.length===0)return;await Ure(e,c,r,s)&&i.warning("Failed to clean untracked files for deleted paths before restore.")}function xre(e){const t=[];for(let n=0;n<e.length;n+=YP)t.push(e.slice(n,n+YP));return t}async function Bre(e,t,n){const r=await ue(e,["ls-files","-u"],t,{signal:n});return r.success?r.stdout.trim().length>0:!1}async function Gre(e,t,n){const r=await RS(e,t,n);if(!r)return{branch:null,base:null,hasConflicts:!1};const s=await Bre(e,t,n);return{branch:NS(r.branch),base:r.lastSyncedTreeRef,hasConflicts:s}}const lk={filesChanged:0,linesAdded:0,linesRemoved:0};async function WP(e,t,n,r,s){const i=await hr(e,["--numstat",t,n],r,{allowedNonZeroExitCodes:[0,1],signal:s});return!i.success||!i.stdout?lk:Vre(i.stdout)}function Vre(e){const t=e.trim();if(!t)return lk;let n=0,r=0,s=0;for(const i of t.split(/\r?\n/)){const o=i.trim();if(!o)continue;const[c,a,...l]=o.split("	");!c||!a||l.length===0||(n+=1,r+=KP(c),s+=KP(a))}return{filesChanged:n,linesAdded:r,linesRemoved:s}}function KP(e){if(e==="-")return 0;const t=Number.parseInt(e,10);return Number.isFinite(t)?t:0}async function $re(e,t,n,r){return(await Zd(e,n,r)).find(i=>i.headRef.type!=="branch"?!1:i.headRef.string===t)?.root??null}async function Hre(e,t,n,r){const s=await OS(e,t,n,r);if(s&&!oo(s))throw new Error(`Unexpected ${t} SHA: ${s}`);return s?s:null}const Fre=At("git");async function jre(e,t,n,r){const s=await t.getWorktreeRepository(e,n);if(!s)throw new Error("Unable to resolve git root for synced branch status.");const i=s.root,o=s.getUntrackedPaths(),c=await RS(e,n,r);if(!c)throw new Error("No synced branch config found for the current worktree.");try{const a=NS(c.branch),l=ul(i,{hostConfig:n,signal:r,untrackedPathsPromise:o}),[f,d,u,_,p]=await Promise.all([$re(i,a,n,r),uk(i,n,r),l,Hre(i,c.branch,n,r),Wn(i,n,r)]);if(p)throw new Error("Worktree has a branch checked out.");if(d){if(!_)throw new Error("Unable to resolve synced branch head SHA.")}else throw new Error("Unable to resolve worktree head state.");const h=f==null?null:await t.getWorktreeRepository(f,n);let E;if(!f)E=Promise.resolve(null);else if(f===i)E=ul(f,{hostConfig:n,signal:r,untrackedPathsPromise:o});else if(h)E=ul(f,{hostConfig:n,signal:r,untrackedPathsPromise:h.getUntrackedPaths()});else throw new Error("Unable to resolve repository for synced branch worktree.");const T=MU(i,_,d,n,r),[S,m]=await Promise.all([T,E]),g=N=>({leftRef:N,rightRef:N,filesChanged:0,linesAdded:0,linesRemoved:0}),y=u?{...await WP(i,d,u,n,r),leftRef:d,rightRef:u}:g(d),A=f&&m?{...await WP(f,_,m,n,r),leftRef:_,rightRef:m}:g(_);return{branch:c.branch,worktreeSnapshot:{root:i,headCommitSha:d,workingTreeRef:u??void 0},branchSnapshot:f?{checkedOut:!0,snapshot:{root:f,headCommitSha:_,workingTreeRef:m??void 0}}:{checkedOut:!1,headCommitSha:_},localCommitsAhead:S?.leftAhead??0,worktreeCommitsAhead:S?.rightAhead??0,localUncommittedDiffStats:A,worktreeUncommittedDiffStats:y}}catch(a){throw Fre().warning("failed to collect synced branch status",{safe:{},sensitive:{error:a}}),a}}class qre{constructor(t){this.emit=t}}async function Yre(e,t){return Kd(e,"HEAD",t)}class Wre{constructor(t){this.options=t,this.emitHeadChangedDebounced=mh(()=>{const n={type:"git-repo-changed",changeType:"head",commonDir:this.options.commonDir,root:this.options.root};this.options.emit({type:"worker-event",event:n})},500),this.emitRemoteRefsChangedDebounced=mh(()=>{const n={type:"git-repo-changed",changeType:"remote-refs",commonDir:this.options.commonDir,root:this.options.root};this.options.emit({type:"worker-event",event:n})},500),this.emitSyncedBranchChangedDebounced=mh(()=>{const n={type:"git-repo-changed",changeType:"synced-branch",commonDir:this.options.commonDir,root:this.options.root};this.options.emit({type:"worker-event",event:n})},500)}logger=Fd("git-repo-watcher");watchers=[];emitHeadChangedDebounced;emitRemoteRefsChangedDebounced;emitSyncedBranchChangedDebounced;async start(){this.logger.info("Starting git repo watcher");const t=await Yre(this.options.root,this.options.hostConfig),n=await Ene(this.options.root,this.options.hostConfig);await this.tryWatch(t,this.emitHeadChangedDebounced),await this.tryWatch(he.join(this.options.commonDir,"FETCH_HEAD"),this.emitRemoteRefsChangedDebounced),await this.tryWatch(he.join(this.options.commonDir,"packed-refs"),this.emitRemoteRefsChangedDebounced),await this.tryWatch(n,this.emitSyncedBranchChangedDebounced)}dispose(){this.watchers.forEach(t=>{t.close()}),this.watchers.length=0}async tryWatch(t,n){if(t)try{const r=he.dirname(t),s=he.basename(t);let i=await zP(t);const o=me.watch(r,(c,a)=>{a&&a!==s||zP(t).then(l=>{c!=="rename"&&l===i||(i=l,n())})});this.watchers.push(o)}catch(r){this.logger.warning("Failed to watch git path",{safe:{},sensitive:{error:r,path:t}})}}}async function zP(e){try{return(await me.promises.stat(e)).mtimeMs}catch{return null}}const mi=At("git");class Kre extends qre{constructor(t,n,r={}){super(t),this.gitManager=n,this.dependencies=r}watchesByKey=new Map;inFlightRequests=new Map;canceledRequests=new Set;uncancelableRequestIds=new Set;worktreeDeletePromises=new Map;janitorByHostKey=new Map;hasLoggedMissingCleanupInputsProvider=!1;async handleRequest(t){const n=new AbortController,r=t.params.hostConfig??null,s=t.method!=="delete-worktree"&&t.method!=="invalidate-stable-metadata"&&t.method!=="git-init-repo";if(s){if(this.inFlightRequests.set(t.id,n),this.canceledRequests.has(t.id)){this.canceledRequests.delete(t.id),n.abort(),this.inFlightRequests.delete(t.id);return}}else this.uncancelableRequestIds.add(t.id),this.canceledRequests.delete(t.id);let i;try{switch(t.method){case"stable-metadata":{i=await this.handleResolveStableMetadata(t.params,{hostConfig:r});break}case"current-branch":{const c=await Wn(t.params.root,r,n.signal);i=Ee({branch:c});break}case"upstream-branch":{const c=await this.handleUpstreamBranch(t.params,{hostConfig:r,signal:n.signal});i=Ee(c);break}case"branch-ahead-count":{const c=await this.handleBranchAheadCount(t.params,{hostConfig:r,signal:n.signal});i=Ee(c);break}case"default-branch":{i=await this.handleDefaultBranch(t.params,{hostConfig:r,signal:n.signal});break}case"base-branch":{i=await this.handleBaseBranch(t.params,{hostConfig:r,signal:n.signal});break}case"recent-branches":{i=await this.handleRecentBranches(t.params,{hostConfig:r,signal:n.signal});break}case"branch-changes":{const c=await mre(this.gitManager,t.params.cwd,r,n.signal);i=Ee(c);break}case"status-summary":{const c=await XU(String(t.params.cwd),r,n.signal);i=Ee(c);break}case"staged-and-unstaged-changes":{const c=await Rne(String(t.params.cwd),this.gitManager,r,n.signal,t.params.paths);i=Ee(c);break}case"untracked-changes":{const c=await yne(String(t.params.cwd),this.gitManager,r,n.signal,t.params.paths);i=Ee(c);break}case"synced-branch":{const c=await Gre(t.params.cwd,r,n.signal);i=Ee(c);break}case"synced-branch-state":{const c=await jre(t.params.cwd,this.gitManager,r,n.signal);i=Ee(c);break}case"overwrite-repo":{const c=await Dre({...t.params,hostConfig:r,signal:n.signal});i=Ee(c);break}case"invalidate-stable-metadata":{this.gitManager.invalidateStableMetadata(),i=Ee({success:!0});break}case"git-init-repo":{i=Ee(await vne(t.params,this.gitManager,r));break}case"tracked-uncommitted-changes":{const c=await yre(t.params.cwd,r,n.signal);i=Ee(c);break}case"submodule-paths":{const c=await Rre(t.params.root,r,n.signal);i=Ee({paths:c});break}case"cat-file":{const c=await bre(this.gitManager,{cwd:t.params.cwd,oid:t.params.oid,path:t.params.path,fallbackToDisk:t.params.fallbackToDisk},r,n.signal);i=Ee(c);break}case"index-info":{const c=await Are(t.params.cwd,r,n.signal);i=Ee(c);break}case"config-value":{const c=await this.gitManager.getWorktreeRepository(t.params.root,r),a=c?await c.getConfigValueForScope(t.params.key,t.params.scope,n.signal):null;i=Ee({value:a});break}case"set-config-value":{const c=await this.gitManager.getWorktreeRepository(t.params.root,r),a=c?await c.setConfigValueForScope(t.params.key,t.params.value,t.params.scope,n.signal):!1;i=Ee({success:a});break}case"create-worktree":{i=await this.handleCreateWorktree(t.params,{hostConfig:r,signal:n.signal});break}case"codex-worktrees":{try{const c=await rk(r);i=Ee({worktrees:c})}catch(c){const a=c instanceof Error?c.message:String(c);i=hi(a)}break}case"list-worktrees":{const c=await Zd(t.params.cwd,r,n.signal);i=Ee({worktrees:c});break}case"resolve-worktree-for-thread":{i=await Vne(t.params.cwd,t.params.conversationId,this.gitManager,r,n.signal);break}case"worktree-snapshot-ref":{const c=await Jne(this.gitManager,t.params.candidateRoots,t.params.worktreePath,r,n.signal);i=Ee(c);break}case"restore-worktree":{const c=await ere(t.params.repoRoot,t.params.worktreePath,r,n.signal);if(c)try{await xP(t.params.worktreePath,t.params.conversationId,r,n.signal)}catch(a){mi().warning("[worktree-restore] failed to set restored worktree owner thread",{safe:{worktreePath:t.params.worktreePath,conversationId:t.params.conversationId},sensitive:{error:a}})}i=Ee({success:c});break}case"delete-worktree":{const c=await this.scheduleWorktreeDelete(t.params);i=Ee({success:!0,worktreeId:c});break}case"set-worktree-owner-thread":{try{await xP(t.params.worktree,t.params.conversationId,r,n.signal),i=Ee({success:!0})}catch{i=hi("Failed to set thread worktree owner")}break}case"move-thread-to-local":{i=await Mre(t.params,{hostConfig:r,signal:n.signal});break}case"move-thread-to-worktree":{i=await wre(t.params,{hostConfig:r,signal:n.signal});break}case"apply-changes":{const c=await ore({...t.params,gitManager:this.gitManager,hostConfig:r,signal:n.signal});i=Ee(c);break}case"commit":{const c=await this.gitManager.getWorktreeRepository(t.params.cwd,r);c?.getUntrackedPaths.clear();const a=c?.root,l=a??String(t.params.cwd);if(t.params.includeUnstaged){const _=a?await ok({gitRoot:a,env:process.env,signal:n.signal,hostConfig:r,untrackedPathsPromise:c.getUntrackedPaths()}):await ue(l,["add","-A"],r,{signal:n.signal});if(!_.success){const p=_.stderr||_.stdout||"Failed to stage changes";i=Ee({status:"error",error:p,execOutput:tn({command:_.command,stdout:_.stdout,stderr:_.stderr,fallbackOutput:p})});break}}const f=await ue(l,["commit","-m",dre(t.params.message,ure(t.params.commitAttribution))],r,{signal:n.signal});if(!f.success){const _=f.stderr||f.stdout||"Failed to commit changes";i=Ee({status:"error",error:_,execOutput:tn({command:f.command,stdout:f.stdout,stderr:f.stderr,fallbackOutput:_})});break}const d=await ue(l,["rev-parse","HEAD"],r,{signal:n.signal}),u=d.success?d.stdout:null;i=Ee({status:"success",commitSha:u});break}}}catch(c){i=hi(c)}finally{if(Zre(t.method)){const c=zre(t);this.gitManager.invalidateUntrackedPathsCache(c,r)}s?this.inFlightRequests.delete(t.id):this.uncancelableRequestIds.delete(t.id),this.canceledRequests.delete(t.id)}if(s&&n.signal.aborted)return;const o={id:t.id,method:t.method,result:i};this.emit({type:"worker-response",response:o})}async deleteWorktreeWithLimit(t){const n=gu(t.worktree);mi().info("[worktree-delete] worker-start",{safe:{worktreeId:n},sensitive:{reason:t.reason,force:t.force??!1,hasHostConfig:t.hostConfig!=null}});try{await Qne(this.gitManager,t.worktree,t.hostConfig,t.reason)}catch(r){mi().warning("[worktree-snapshot] failed to snapshot worktree",{safe:{worktreeId:n},sensitive:{error:r}})}try{await Fs(t.worktree,t.hostConfig,t.force??!1)}catch(r){throw mi().warning("[worktree-delete] worker-failed",{safe:{worktreeId:n},sensitive:{error:r}}),r}return mi().info("[worktree-delete] worker-success",{safe:{worktreeId:n},sensitive:{reason:t.reason,force:t.force??!1}}),n}async scheduleWorktreeDelete(t){const r=`${t.hostConfig?.id??"local"}|${t.worktree}`,s=this.worktreeDeletePromises.get(r);if(s)return s;const i=this.deleteWorktreeWithLimit(t);this.worktreeDeletePromises.set(r,i);try{return await i}finally{this.worktreeDeletePromises.delete(r)}}async handleResolveStableMetadata(t,{hostConfig:n}){const r=await this.gitManager.getStableMetadata(t.cwd,n);if(!r)return hi("Not a git repository");const s={commonDir:r.commonDir,root:r.root};return await this.ensureWatching(s,n),Ee(s)}async handleUpstreamBranch(t,{hostConfig:n,signal:r}){const s=await Wn(t.root,n,r),i=await ue(t.root,["rev-parse","--abbrev-ref","--symbolic-full-name","@{u}"],n,{signal:r,allowedNonZeroExitCodes:[128,1]}),o=i.success&&i.stdout?i.stdout:null;return o?{branch:s,upstream:{branch:o}}:{branch:s,upstream:null}}async handleBranchAheadCount(t,{hostConfig:n,signal:r}){const s=await jc(t.root,n,r),i=s?.branch??null;let o=s?.remote??null;o||(o=(await BU(t.root,n,r))[0]??null);const c=await ue(t.root,["rev-parse","--abbrev-ref","--symbolic-full-name","@{u}"],n,{signal:r,allowedNonZeroExitCodes:[128,1]}),a=c.success&&c.stdout?c.stdout:null,l=async()=>{if(!a)return 0;const E=await ue(t.root,["rev-list","--count",`${a}..HEAD`],n,{allowedNonZeroExitCodes:[128,1],signal:r});if(E.success&&E.stdout){const T=Number.parseInt(E.stdout,10);return Number.isNaN(T)?0:T}return 0},f=async()=>{if(!o)return null;const E=await ue(t.root,["rev-list","--count","HEAD","--not",`--remotes=${o}`],n,{allowedNonZeroExitCodes:[128,1],signal:r});if(E.success&&E.stdout){const T=Number.parseInt(E.stdout,10);return Number.isNaN(T)?null:T}return null},d=async()=>{if(!i)return 0;const E=i.includes("/")?i:o?`${o}/${i}`:i,T=await QU(t.root,E,n,r);if(T){const S=await ue(t.root,["rev-list","--count",`${T}..HEAD`],n,{allowedNonZeroExitCodes:[128,1],signal:r});if(S.success&&S.stdout){const m=Number.parseInt(S.stdout,10);return Number.isNaN(m)?0:m}}return 0},[u,_,p]=await Promise.all([l(),f(),d()]);let h=p;return _!=null?h=_:a!=null&&(h=u),{commitsAhead:h}}async handleDefaultBranch(t,{hostConfig:n,signal:r}){let i=(await jc(t.root,n,r))?.branch??null;return i||(i=(await FP(t.root,10,n,r)).find(c=>c==="main"||c==="master")??null),Ee({branch:i})}async handleBaseBranch(t,{hostConfig:n,signal:r}){const s=await jc(t.root,n,r);return Ee({local:s?.branch??null,remote:s?.remote??null})}async handleRecentBranches(t,{hostConfig:n,signal:r}){const s=Math.max(1,Math.min(t.limit??10,100)),i=await FP(t.root,s,n,r);return Ee({branches:i})}async handleCreateWorktree(t,{hostConfig:n,signal:r}){const s=this.emit.bind(this),i=t.streamId;if(!await this.gitManager.getRepoRepository(t.cwd,n))return hi("Not a git repository (not repo repository)");const c=await Sne({gitManager:this.gitManager,workspaceRoot:t.cwd,startingState:t.startingState,localEnvironmentConfigPath:t.localEnvironmentConfigPath,markAsCodexManaged:t.markAsCodexManaged??!0,hostConfig:n,signal:r,onLog:(a,l)=>{r.aborted||s({type:"worker-event",event:{type:"create-worktree-stream",streamId:i,stream:a,data:l}})}});return c.success?(this.requestWorktreeCleanup(n,"created"),Ee({worktreeGitRoot:c.worktreeGitRoot,worktreeWorkspaceRoot:c.worktreeWorkspaceRoot})):hi(c.error.message)}requestWorktreeCleanup(t,n){const r=this.getOrCreateWorktreeJanitor(t);if(!r){this.hasLoggedMissingCleanupInputsProvider||(this.hasLoggedMissingCleanupInputsProvider=!0,mi().warning("[worktree-cleanup] skipping because no cleanup-inputs provider is configured",{safe:{},sensitive:{}}));return}r.trigger(n)}getOrCreateWorktreeJanitor(t){const n=this.dependencies.getWorktreeCleanupInputs;if(!n)return null;const r=wU(t),s=this.janitorByHostKey.get(r);if(s)return s;const i=new jne({getCleanupInputs:o=>n({hostConfig:t,threadIds:o}),hostConfig:t,deleteWorktree:async({worktree:o,reason:c,force:a})=>{await this.scheduleWorktreeDelete({worktree:o,reason:c,force:a,hostConfig:t})}});return this.janitorByHostKey.set(r,i),i}getWatchKey(t,n){return`${n?.id??"local"}|${t}`}async ensureWatching(t,n){const r=this.getWatchKey(t.root,n);if(this.watchesByKey.get(r))return;const i=new Wre({commonDir:t.commonDir,root:t.root,hostConfig:n,emit:this.emit});this.watchesByKey.set(r,i),await i.start()}handleCancel(t){if(this.uncancelableRequestIds.has(t))return;const n=this.inFlightRequests.get(t);if(!n){this.canceledRequests.add(t);return}this.inFlightRequests.delete(t),n.abort()}}function zre(e){return typeof e.params.cwd=="string"?e.params.cwd:typeof e.params.localCwd=="string"?e.params.localCwd:typeof e.params.sourceWorktreeCwd=="string"?e.params.sourceWorktreeCwd:typeof e.params.worktreeWorkspaceRoot=="string"?e.params.worktreeWorkspaceRoot:typeof e.params.root=="string"?e.params.root:typeof e.params.localGitRoot=="string"?e.params.localGitRoot:typeof e.params.worktreeGitRoot=="string"?e.params.worktreeGitRoot:null}function Zre(e){switch(e){case"overwrite-repo":case"git-init-repo":case"create-worktree":case"restore-worktree":case"delete-worktree":case"apply-changes":case"commit":case"move-thread-to-local":case"move-thread-to-worktree":return!0;case"stable-metadata":case"current-branch":case"upstream-branch":case"branch-ahead-count":case"default-branch":case"base-branch":case"recent-branches":case"branch-changes":case"status-summary":case"staged-and-unstaged-changes":case"untracked-changes":case"tracked-uncommitted-changes":case"submodule-paths":case"cat-file":case"synced-branch":case"synced-branch-state":case"index-info":case"config-value":case"set-config-value":case"set-worktree-owner-thread":case"list-worktrees":case"codex-worktrees":case"resolve-worktree-for-thread":case"worktree-snapshot-ref":case"invalidate-stable-metadata":return!1}}function Xre(e,t,n,r={}){switch(e){case"git":return new Kre(n,t,r.git)}}function Qre(){const e=process.platform,t=process.env,n=ri.homedir();if(e==="darwin")return he.join(n,"Library","Logs","com.openai.codex");if(e==="win32"){const r=t.LOCALAPPDATA??he.join(n,"AppData","Local");return he.join(r,"Codex","Logs")}if(e==="linux"){const r=t.XDG_STATE_HOME??he.join(n,".local","state");return he.join(r,"codex","logs")}return he.join(n,".codex","logs")}const ZP=10*1024*1024,XP=5,QP=1e4,Jre=1024*1024,ese=15;function qc(e){return e.toString().padStart(2,"0")}function JP(e,t){const n=t.getUTCFullYear().toString(),r=qc(t.getUTCMonth()+1),s=qc(t.getUTCDate());return he.join(e,n,r,s)}function jh(e,t,n,r){return e>0?e:(n(new Error(`[file-logger] invalid ${r}`),{[r]:e}),t)}function eM(e,t,n,r,s){return`codex-desktop-${e}-${t}-t${n}-i${r}-${qc(s.getUTCHours())}${qc(s.getUTCMinutes())}${qc(s.getUTCSeconds())}`}let tM=0;function tse(){return tM+=1,tM}function nse(e,t,n,r){try{const s=new Date(Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate())),i=new Date(s);i.setUTCDate(i.getUTCDate()-(n-1));for(const o of me.readdirSync(e)){if(!/^\d{4}$/.test(o))continue;const c=Number(o);if(!Number.isFinite(c))continue;const a=he.join(e,o);for(const l of me.readdirSync(a)){if(!/^\d{2}$/.test(l))continue;const f=Number(l);if(!Number.isFinite(f)||f<1||f>12)continue;const d=he.join(a,l);for(const u of me.readdirSync(d)){if(!/^\d{2}$/.test(u))continue;const _=Number(u);if(!Number.isFinite(_)||_<1||_>31)continue;new Date(Date.UTC(c,f-1,_))<i&&me.rmSync(he.join(d,u),{recursive:!0,force:!0})}me.readdirSync(d).length===0&&me.rmSync(d,{recursive:!0,force:!0})}me.readdirSync(a).length===0&&me.rmSync(a,{recursive:!0,force:!0})}}catch(s){r(new Error("[file-logger] failed to prune old logs"),{rootDir:e,retentionDays:n,error:s instanceof Error?s.message:String(s)})}}function rse(e,t={}){const n=(m,g)=>e.nonFatalReporter.reportNonFatal(m,{kind:"file-based-logger",extra:g}),r=e.rootDir??Qre(),s=t.processId??process.pid,i=t.threadId??Jl.threadId??0,o=t.instanceId??tse(),c=e.appSessionId,a=t.now??(()=>new Date),l=e.maxSegmentBytes??ZP,f=e.maxSegments??XP,d=e.pendingLineLimit??QP,u=e.highWaterMarkBytes??Jre,_=ese,p=t.createStream??((m,g)=>me.createWriteStream(m,{flags:"w",highWaterMark:g})),h=jh(f,XP,n,"maxSegments"),E=jh(l,ZP,n,"maxSegmentBytes"),T=jh(d,QP,n,"pendingLineLimit"),S={logLine:()=>{}};try{const m=a();let g=JP(r,m);me.mkdirSync(g,{recursive:!0}),nse(r,m,_,n);let y=eM(c,s,i,o,m);const A=ee=>he.join(g,`${y}-${ee}.log`);let N=!1;const O=ee=>{N=!0,n(new Error("[file-logger] stream error"),{error:ee instanceof Error?ee.message:String(ee),rootDir:r,appSessionId:c,processId:s,threadId:i,instanceId:o})},b=ee=>(ee.on("error",x=>{O(x)}),ee);let C=0,w=0,k=b(p(A(C),u)),U=[],M=0,F=!1,v=0;const L=()=>{const ee=a(),x=JP(r,ee);x!==g&&(g=x,me.mkdirSync(g,{recursive:!0}),y=eM(c,s,i,o,ee),k.end(),C=0,w=0,v=0,k=b(p(A(C),u)))},H=()=>{k.end(),C=(C+1)%h,w=0,k=b(p(A(C),u))},te=()=>{if(v===0)return;const ee=`[file-logger] dropped ${v} lines due to backpressure
`;U.push({text:ee,bytes:Buffer.byteLength(ee)}),v=0},ce=()=>{if(N){U=[],M=0,v=0;return}if(F)return;F=!0;let ee=!1;try{for(;!(M>=U.length&&(te(),M>=U.length));){const x=U[M];w+x.bytes>E&&H();const B=k.write(x.text);if(w+=x.bytes,M+=1,!B){ee=!0,k.once("drain",()=>{F=!1,ce()});return}}U=[],M=0}catch(x){n(new Error("[file-logger] write failed"),{error:x instanceof Error?x.message:String(x),rootDir:r,appSessionId:c,processId:s,threadId:i,instanceId:o,maxSegments:h,maxSegmentBytes:E,pendingLineLimit:T}),U=[],M=0}finally{F&&!ee&&(F=!1)}};return{logLine:ee=>{if(!N)try{!F&&U.length===0&&L();const x=`${ee}
`;if(U.length-M>=T){v+=1;return}U.push({text:x,bytes:Buffer.byteLength(x)}),ce()}catch(x){n(new Error("[file-logger] logLine threw"),{error:x instanceof Error?x.message:String(x),rootDir:r,appSessionId:c,processId:s,threadId:i,instanceId:o})}}}}catch{return n(new Error("[file-logger] failed to initialize"),{rootDir:r,appSessionId:c,processId:s,threadId:i,instanceId:o}),S}}function sse(e,t){switch(e){case"error":console.error(t);break;case"warning":console.warn(t);break;case"info":console.info(t);break;case"debug":console.debug(t);break;case"trace":console.log(t);break}}function ise(e,t,n,r){const s=l=>l??{safe:{},sensitive:{}},i=rse({appSessionId:n,nonFatalReporter:e}),o=l=>{const f=new Date().toISOString();i.logLine(`${f} ${l}`)},c=l=>(f,d)=>{if(!nre(l,r))return;const u=s(d),_={...u.safe,...u.sensitive},p=Object.keys(_).length===0?f:`${f} ${aJ(_)}`;sse(l,p),o(`${l} ${p}`),t.log(l,f,u.safe)},a={trace:c("trace"),debug:c("debug"),info:c("info"),warning:c("warning"),error:c("error")};rJ({trace:a.trace,debug:a.debug,info:a.info,warning:a.warning,error:a.error,log:(l,f,d)=>{a[l](f,d)},dispose:()=>{}}),fJ(()=>!1)}function ose(e,t){switch(e){case"git":return{git:{getWorktreeCleanupInputs:async({hostConfig:r,threadIds:s})=>t.request({method:"worktree-cleanup-inputs",params:{hostKey:r?.id??"local",threadIds:s}})}}}}const ase="app:///";function cse(e,t){use(e,t)}function use(e,t){const n=HX(e.buildFlavor),r=VX(e.appVersion);E6({dsn:BX,environment:e.buildFlavor,release:r,dist:e.buildNumber??void 0,tracesSampleRate:n,integrations:s=>[...s,LH({root:t,prefix:ase})]}),FV("codex_app_session_id",e.codexAppSessionId),lJ({startSpan:(s,i)=>Ji(s,i)})}function lse(e,t){if(e==null){ny(null);return}ny({id:t??void 0,auth_method:e})}function nM(e){return typeof e=="object"&&e!=null}function dse(e){return e==="worktree-cleanup-inputs"}function fse(e){return nM(e)?e.type==="worker-main-rpc-response"&&typeof e.workerId=="string"&&typeof e.requestId=="string"&&dse(e.method)&&nM(e.result)&&(e.result.type==="ok"||e.result.type==="error"):!1}class _se{constructor(t,n){this.workerId=t,this.port=n}pending=new Map;request(t){const n=xi.randomUUID(),r={type:"worker-main-rpc-request",workerId:this.workerId,requestId:n,method:t.method,params:t.params},s=new Promise((i,o)=>{this.pending.set(n,{method:t.method,resolve:c=>{i(c)},reject:o})});try{this.port.postMessage(r)}catch(i){return this.pending.delete(n),Promise.reject(i instanceof Error?i:new Error(`Failed to send main RPC request: ${String(i)}`))}return s}handleMessage(t){if(!fse(t)||t.workerId!==this.workerId)return!1;const n=this.pending.get(t.requestId);return n?(this.pending.delete(t.requestId),n.method!==t.method?(n.reject(new Error("Mismatched main RPC response method")),!0):t.result.type==="ok"?(n.resolve(t.result.value),!0):(n.reject(new Error(t.result.error.message)),!0)):!0}dispose(){const t=new Error("Worker main RPC client disposed");for(const n of this.pending.values())n.reject(t);this.pending.clear()}}const{workerId:js,sentryInitOptions:vi,sentryRewriteFramesRoot:pse,maxLogLevel:hse}=Jl.workerData;cse(vi,pse);const dk=Uee((e,t,n)=>{Ye(e,{level:t==="fatal"?"fatal":"error",tags:n.tags,extra:n.extra})}),fk=new Lee({source:"codex-desktop",env:vi.buildFlavor,codexAppSessionId:vi.codexAppSessionId,buildInfo:{version:vi.appVersion,buildNumber:vi.buildNumber},reportFailure:e=>{dk.reportNonFatal("Datadog log sink failure",{kind:"datadog-log-sink-failure",tags:{failureType:e.type,reason:e.reason,workerId:js},extra:{failure:e}})}});ise(dk,fk,vi.codexAppSessionId,hse);const Xd=Jl.parentPort;if(!Xd)throw new Error("worker-entry must be run in a worker thread");const _k=new DJ,Ese=new Lne(_k),pk=new _se(js,Xd),rM=Xre(js,Ese,e=>{const t={...e,workerId:js};Xd.postMessage(t)},ose(js,pk));Xd.on("message",e=>{if(!pk.handleMessage(e)){if(e.type==="worker-sentry-user-update"){lse(e.authMethod,e.userId);const t=e.authMethod==null?null:{id:e.userId??void 0,authMethod:e.authMethod};fk.setUserInfo(t);return}else if(e.type==="worker-app-event"){_k.emit(e.event.type,e.event.at);return}else if(e.workerId!==js)return;switch(e.type){case"worker-request":{cS({op:"codex.worker.request",name:`${js}.${e.request.method}`},()=>rM.handleRequest(e.request));return}case"worker-request-cancel":{rM.handleCancel(e.id);return}case"worker-main-rpc-response":return}}});
//# sourceMappingURL=worker.js.map
